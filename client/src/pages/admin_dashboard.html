<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo - OFICRI</title>
    <link rel="stylesheet" href="/styles/admin.css">
    <link rel="icon" href="/assets/images/logoOficri2x2.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Glegoo&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="header">
        <div class="logo">  
            <img src="/assets/images/logoOficri2x2.png" alt="Logo Image" class="logo-image">
            <span class="logo-text">OFICRI Cusco - Panel Administrativo</span>
        </div>
    </div>

    <div class="dashboard-container">
        <div class="sidebar">
            <!-- Información del usuario en la barra lateral -->
            <div class="sidebar-user-info">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-details">
                    <div class="user-main">
                        <span id="username"></span>
                        <span id="user-role" class="user-role"></span>
                    </div>
                    <div class="user-secondary">
                        <span id="user-area" class="user-area"></span>
                        <span id="last-login" class="last-login"></span>
                    </div>
                </div>

                <div class="sidebar-divider"></div>

                <!-- Botones de navegación -->
                <button class="nav-btn active" data-target="users-section">
                    <i class="fas fa-users"></i> Gestión de Usuarios
                </button>
                <button class="nav-btn" data-target="roles-section">
                    <i class="fas fa-user-tag"></i> Gestión de Roles
                </button>
                <button class="nav-btn" data-target="areas-section">
                    <i class="fas fa-building"></i> Áreas Especializadas
                </button>
                <button class="nav-btn" data-target="logs-section">
                    <i class="fas fa-history"></i> Registros de Actividad
                </button>
            </div>

            <!-- Botón de cerrar sesión en la parte inferior -->
            <div class="sidebar-footer">
                <button id="logout-btn"><i class='bx bx-log-out'></i> Cerrar Sesión</button>
            </div>
        </div>

        <div class="main-content">
            <!-- Sección de Usuarios -->
            <div id="users-section" class="section active">
                <h2>Gestión de Usuarios</h2>
                <button id="addUserButton" class="action-btn">
                    <i class="fas fa-plus"></i> Agregar Usuario
                </button>
                <div class="table-container">
                    <table id="gestionUsuariosTable">
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Área</th>
                                <th>Nivel de Acceso</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los usuarios se cargarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sección de Roles -->
            <div id="roles-section" class="section">
                <h2>Gestión de Roles</h2>
                <button id="addRoleBtn" class="action-btn">
                    <i class="fas fa-plus"></i> Agregar Nuevo Rol
                </button>
                <div class="table-container">
                    <table id="rolesTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Nivel Acceso</th>
                                <th>Descripción</th>
                                <th>Permisos</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="roles-table-body">
                            <!-- Los roles se cargarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sección de Áreas -->
            <div id="areas-section" class="section">
                <h2>Áreas Especializadas</h2>
                <button id="addAreaButton" class="action-btn">
                    <i class="fas fa-plus"></i> Agregar Área
                </button>
                <div class="table-container">
                    <table id="areasEspecializadasTable">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Código</th>
                                <th>Tipo</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Sección de Registros de Actividad -->
            <div id="logs-section" class="section">
                <h2>Registros de Actividad</h2>
                <button id="reloadLogsBtn" class="action-btn">
                    <i class="fas fa-sync"></i> Actualizar Registros
                </button>
                <div class="table-container">
                    <table id="logsTable" class="table table-striped">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Usuario</th>
                                <th>Tipo de Evento</th>
                                <th>Detalles</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los registros se cargarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para agregar usuario -->
    <div id="userModal" class="modal fade" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="userModalLabel">Agregar Nuevo Usuario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createUserForm">
                        <div class="form-group mb-3">
                            <label for="username" class="form-label">Nombre de Usuario:</label>
                            <input type="text" class="form-control" id="username" name="username" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="password" class="form-label">Contraseña:</label>
                            <input type="password" class="form-control" id="password" name="password" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="area" class="form-label">Área:</label>
                            <select id="area" name="area" class="form-control area-select" required>
                                <option value="">Seleccione un área</option>
                            </select>
                        </div>
                        <div class="form-group mb-3">
                            <label class="form-label">Nivel de Acceso:</label>
                            <div class="privileges-container">
                                <div class="privilege-item">
                                    <label class="switch" for="priv-crear">
                                        <input type="checkbox" id="priv-crear" value="crear" name="privilegios">
                                        <span class="slider"></span>
                                    </label>
                                    <span class="privilege-label">
                                        <i class="fas fa-plus-circle"></i>
                                        Crear
                                    </span>
                                </div>
                                <div class="privilege-item">
                                    <label class="switch" for="priv-editar">
                                        <input type="checkbox" id="priv-editar" value="editar" name="privilegios">
                                        <span class="slider"></span>
                                    </label>
                                    <span class="privilege-label">
                                        <i class="fas fa-edit"></i>
                                        Editar
                                    </span>
                                </div>
                                <div class="privilege-item">
                                    <label class="switch" for="priv-eliminar">
                                        <input type="checkbox" id="priv-eliminar" value="eliminar" name="privilegios">
                                        <span class="slider"></span>
                                    </label>
                                    <span class="privilege-label">
                                        <i class="fas fa-trash-alt"></i>
                                        Eliminar
                                    </span>
                                </div>
                                <div class="privilege-item">
                                    <label class="switch" for="priv-ver">
                                        <input type="checkbox" id="priv-ver" value="ver" name="privilegios">
                                        <span class="slider"></span>
                                    </label>
                                    <span class="privilege-label">
                                        <i class="fas fa-eye"></i>
                                        Ver
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div id="error-message" class="error-message"></div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar usuario -->
    <div id="editUserModal" class="modal fade" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editUserModalLabel">Editar Usuario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editUserForm">
                        <div class="form-group">
                            <label for="edit-username">Nombre de Usuario:</label>
                            <input type="text" id="edit-username" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-area">Área:</label>
                            <select id="edit-area" class="form-control" required>
                                <!-- Las opciones se cargarán dinámicamente -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Privilegios:</label>
                            <div class="privileges-container">
                                <div class="privilege-item">
                                    <input type="checkbox" name="edit-privileges" value="crear" id="edit-crear">
                                    <label for="edit-crear">
                                        <i class="fas fa-plus-circle"></i> Crear
                                    </label>
                                </div>
                                <div class="privilege-item">
                                    <input type="checkbox" name="edit-privileges" value="editar" id="edit-editar">
                                    <label for="edit-editar">
                                        <i class="fas fa-edit"></i> Editar
                                    </label>
                                </div>
                                <div class="privilege-item">
                                    <input type="checkbox" name="edit-privileges" value="eliminar" id="edit-eliminar">
                                    <label for="edit-eliminar">
                                        <i class="fas fa-trash"></i> Eliminar
                                    </label>
                                </div>
                                <div class="privilege-item">
                                    <input type="checkbox" name="edit-privileges" value="ver" id="edit-ver">
                                    <label for="edit-ver">
                                        <i class="fas fa-eye"></i> Ver
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar área -->
    <div id="editAreaModal" class="modal">
        <div class="modal-content">
            <span class="close close-modal">&times;</span>
            <h2>Editar Área</h2>
            <form id="editAreaForm">
                <div class="form-group">
                    <label for="edit-nombreArea">Nombre del Área:</label>
                    <input type="text" id="edit-nombreArea" required>
                </div>
                <div class="form-group">
                    <label for="edit-codigoArea">Código del Área:</label>
                    <input type="text" id="edit-codigoArea" required>
                </div>
                <div class="form-group">
                    <label for="edit-tipoArea">Tipo de Área:</label>
                    <select id="edit-tipoArea" required>
                        <option value="1">Tipo 1</option>
                        <option value="2">Tipo 2</option>
                        <option value="3">Tipo 3</option>
                    </select>
                </div>
                <div id="edit-error-message" class="error-message"></div>
                <button type="submit" class="submit-btn">Actualizar</button>
            </form>
        </div>
    </div>

    <!-- Modal para agregar/editar rol -->
    <div id="roleModal" class="modal">
        <div class="modal-content">
            <span class="close close-modal">&times;</span>
            <h2 id="roleModalTitle">Agregar Nuevo Rol</h2>
            <form id="roleForm" data-mode="create">
                <div class="form-group">
                    <label for="nombreRol">Nombre del Rol:</label>
                    <input type="text" id="nombreRol" name="nombreRol" required>
                </div>
                
                <div class="form-group">
                    <label for="nivelAcceso">Nivel de Acceso:</label>
                    <select id="nivelAcceso" name="nivelAcceso" required>
                        <option value="1">1 - Administrador</option>
                        <option value="2">2 - Operador Mesa de Partes</option>
                        <option value="3">3 - Técnico Especialista</option>
                        <option value="4">4 - Jefe de Área</option>
                        <option value="5">5 - Visualizador</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="descripcion">Descripción:</label>
                    <textarea id="descripcion" name="descripcion" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Permisos:</label>
                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" id="puedeCrear" name="puedeCrear">
                            <span class="slider"></span>
                        </label>
                        <label for="puedeCrear">Puede Crear</label>
                    </div>
                    
                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" id="puedeEditar" name="puedeEditar">
                            <span class="slider"></span>
                        </label>
                        <label for="puedeEditar">Puede Editar</label>
                    </div>
                    
                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" id="puedeDerivar" name="puedeDerivar">
                            <span class="slider"></span>
                        </label>
                        <label for="puedeDerivar">Puede Derivar</label>
                    </div>
                    
                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" id="puedeAuditar" name="puedeAuditar">
                            <span class="slider"></span>
                        </label>
                        <label for="puedeAuditar">Puede Auditar</label>
                    </div>
                </div>
                
                <div id="role-error-message" class="error-message"></div>
                
                <div class="form-group">
                    <button type="submit" class="submit-btn">Guardar</button>
                    <button type="button" class="cancel-btn close-modal">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para mostrar información de IP -->
    <div class="modal fade" id="ipInfoModal" tabindex="-1" aria-labelledby="ipInfoModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ipInfoModalLabel">Información de IP</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="ip-info-container">
                        <div class="ip-info-item mb-3">
                            <strong>Dirección IP:</strong>
                            <span id="ip-address" class="ms-2"></span>
                        </div>
                        <div class="ip-info-item mb-3">
                            <strong>Ciudad:</strong>
                            <span id="ip-city" class="ms-2"></span>
                        </div>
                        <div class="ip-info-item mb-3">
                            <strong>País:</strong>
                            <span id="ip-country" class="ms-2"></span>
                        </div>
                        <div class="ip-info-item mb-3">
                            <strong>ISP:</strong>
                            <span id="ip-isp" class="ms-2"></span>
                        </div>
                        <div class="ip-info-item mb-3">
                            <strong>Organización:</strong>
                            <span id="ip-org" class="ms-2"></span>
                        </div>
                        <div id="ip-additional" class="mt-3">
                            <!-- Aquí se agregarán los badges dinámicamente -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para agregar área -->
    <div id="areaModal" class="modal fade" tabindex="-1" aria-labelledby="areaModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="areaModalLabel">Agregar Nueva Área</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createAreaForm">
                        <div class="form-group mb-3">
                            <label for="area-nombre" class="form-label">Nombre del Área:</label>
                            <input type="text" class="form-control" id="area-nombre" name="nombreArea" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="area-codigo" class="form-label">Código de Identificación:</label>
                            <input type="text" class="form-control" id="area-codigo" name="codigoIdentificacion">
                        </div>
                        <div class="form-group mb-3">
                            <label for="area-tipo" class="form-label">Tipo de Área:</label>
                            <select class="form-control" id="area-tipo" name="tipoArea" required>
                                <option value="">Seleccione un tipo</option>
                                <option value="General">General</option>
                                <option value="Especializada">Especializada</option>
                                <option value="Mesa de Partes">Mesa de Partes</option>
                            </select>
                        </div>
                        <div class="form-group mb-3">
                            <label for="area-estado" class="form-label">Estado:</label>
                            <select class="form-control" id="area-estado" name="estado" required>
                                <option value="1">Activo</option>
                                <option value="0">Inactivo</option>
                            </select>
                        </div>
                        <div id="area-error-message" class="error-message"></div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts base -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
    
    <!-- Scripts de la aplicación -->
    <script src="/js/clientAuth.js"></script>
    <script src="/js/frontendAuth.js"></script>
    <script src="/js/uiHelpers.js"></script>
    <script src="/js/common/uiHelpers.js"></script>
    <script src="/js/dashboard-common.js"></script>
    
    <!-- Módulos de administración -->
    <script src="/js/modules/admin/userManagement.js"></script>
    <script src="/js/modules/admin/areaManagement.js"></script>
    <script src="/js/modules/admin/adminRoles.js"></script>
    <script src="/js/modules/admin/activityLogs.js"></script>
    <script src="/js/modules/admin/logManagement.js"></script>
    <script src="/js/modules/admin/adminDashboard.js"></script>
    
    <!-- Inicialización -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (window.adminModules && window.adminModules.initAdminDashboard) {
                window.adminModules.initAdminDashboard();
            } else {
                console.error('No se pudo inicializar el dashboard de administración');
            }
        });
    </script>
</body>
</html>
