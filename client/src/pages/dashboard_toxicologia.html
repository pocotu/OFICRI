<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Química y toxicología forense - OFICRI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/styles/stylest_toxicologia.css">
    <link href="https://fonts.googleapis.com/css2?family=Glegoo&display=swap" rel="stylesheet">
    <!-- Google Fonts - Orbitron -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet">
    <link rel="icon" href="/assets/images/logoOficri2x2.png" type="image/x-icon">
    <!-- Bootstrap JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Cargar primero los scripts de autenticación y utilidades -->
    <script src="/js/clientAuth.js"></script>
    <script src="/js/frontendAuth.js"></script>
    <script src="/js/uiHelpers.js"></script>
    <!-- Cargar módulos específicos de toxicología -->
    <script src="/js/modules/toxicologia/toxicologiaDashboard.js"></script>
    <script src="/js/modules/toxicologia/caseManagement.js"></script>
    <script src="/js/modules/toxicologia/resultManagement.js"></script>
    <script src="/js/modules/toxicologia/sampleManagement.js"></script>
    <!-- Cargar scripts principales -->
    <script src="/js/dashboard-common.js"></script>
    <script src="/js/toxicologia.js"></script>
</head>
<body>
    <div class="body-overlay"></div>
    <div class="header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-auto">
                    <div class="logo">
                        <img src="/assets/images/logoOficri2x2.png" alt="Logo Image" class="logo-image">
                        <span class="logo-text">OFICRI Cusco</span>
                    </div>
                </div>
                <div class="col text-end">
                    <img src="/assets/images/logoPolicia2x2.png" alt="PNP Logo" class="pnp-logo">
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <!-- Sidebar with improved Bootstrap grid -->
        <div class="sidebar shadow-sm">
            <nav class="nav flex-column nav-links h-100">
                <div class="nav-item active" data-section="dashboard">
                    <a class="nav-link" href="#dashboard">
                        <i class='bx bxs-dashboard'></i>
                        <span>Panel Principal</span>
                    </a>
                </div>
                <div class="nav-item" data-section="documentos">
                    <a class="nav-link" href="#documentos">
                        <i class='bx bxs-file'></i>
                        <span>Documentos</span>
                    </a>
                </div>
                <div class="nav-item" data-section="agraviados">
                    <a class="nav-link" href="#agraviados">
                        <i class='bx bxs-user'></i>
                        <span>Agraviados</span>
                    </a>
                </div>
                <div class="nav-item" data-section="historial">
                    <a class="nav-link" href="#historial">
                        <i class='bx bx-history'></i>
                        <span>Historial</span>
                    </a>
                </div>
                <div class="nav-item mt-auto" data-section="logout">
                    <a class="nav-link" href="#" id="logout-btn">
                        <i class='bx bx-log-out'></i>
                        <span>Cerrar Sesión</span>
                    </a>
                </div>
            </nav>
        </div>

        <!-- Main content with Bootstrap grid -->
        <div class="main-content">
            <div class="container-fluid p-4">
                <!-- Dashboard Section -->
                <section id="dashboard" class="content-section active">
                    <div class="container-fluid py-4">
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="section-title text-center">
                                    <h1 class="h2 mb-4">QUÍMICA Y TOXICOLOGÍA FORENSE</h1>
                                </div>
                            </div>
                        </div>

                        <!-- Stats Cards -->
                        <div class="row g-3 mb-4">
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="card stat-box h-100 shadow-sm" data-filter="pending">
                                    <div class="card-body">
                                        <h3 class="card-title h5 mb-3">Documentos Pendientes</h3>
                                        <div class="number display-4 text-center">15</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="card stat-box h-100 shadow-sm" data-filter="processing">
                                    <div class="card-body">
                                        <h3 class="card-title h5 mb-3">En Proceso</h3>
                                        <div class="number display-4 text-center">8</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="card stat-box h-100 shadow-sm" data-filter="completed">
                                    <div class="card-body">
                                        <h3 class="card-title h5 mb-3">Completados</h3>
                                        <div class="number display-4 text-center">45</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="d-flex justify-content-end">
                                    <button class="btn btn-primary add-document-btn">
                                        <i class='bx bx-plus me-2'></i>Nuevo Documento
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Documents Table -->
                        <div class="row">
                            <div class="col-12">
                                <div class="card shadow-sm">
                                    <div class="card-header bg-light">
                                        <h2 class="h5 mb-0">Documentos Recientes</h2>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover align-middle">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>Nº RG</th>
                                                        <th>Fecha Ingreso</th>
                                                        <th>Documento</th>
                                                        <th>Procedencia</th>
                                                        <th>Agraviado</th>
                                                        <th>Tipo Examen</th>
                                                        <th>Delito/Infracción</th>
                                                        <th>Estado</th>
                                                        <th>Doc. Salida</th>
                                                        <th>Responsable</th>
                                                        <th>Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>1</td>
                                                        <td>02/01/2025</td>
                                                        <td>OF-002</td>
                                                        <td>C. OCONGATE</td>
                                                        <td>
                                                            <div class="d-flex flex-column">
                                                                <span class="fw-bold">Armando</span>
                                                                <span class="text-muted">Llanos Luna</span>
                                                            </div>
                                                        </td>
                                                        <td>TOXICOLÓGICO</td>
                                                        <td>DCLLS.</td>
                                                        <td><span class="badge bg-warning text-dark">Pendiente</span></td>
                                                        <td>---</td>
                                                        <td>PUMA</td>
                                                        <td>
                                                            <div class="btn-group">
                                                                <button class="btn btn-sm btn-outline-primary" title="Ver detalles">
                                                                    <i class='bx bx-show'></i>
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-secondary" title="Editar">
                                                                    <i class='bx bx-edit'></i>
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-success" title="Agregar documento">
                                                                    <i class='bx bx-file-plus'></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>3</td>
                                                        <td>02/01/2025</td>
                                                        <td>OF-006</td>
                                                        <td>C. WANCHÁQ</td>
                                                        <td>
                                                            <div class="d-flex flex-column">
                                                                <span class="fw-bold">Julio Cesar</span>
                                                                <span class="text-muted">Huillca Mejía</span>
                                                            </div>
                                                        </td>
                                                        <td>TOXICOLÓGICO</td>
                                                        <td>SUSTANCIA TOXICA</td>
                                                        <td><span class="badge bg-success">Completado</span></td>
                                                        <td>INF-001-2025</td>
                                                        <td>MENDOZA</td>
                                                        <td>
                                                            <div class="btn-group">
                                                                <button class="btn btn-sm btn-outline-primary" title="Ver detalles">
                                                                    <i class='bx bx-show'></i>
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-info" title="Descargar informe">
                                                                    <i class='bx bx-download'></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Other sections with Bootstrap grid -->
                <section id="documentos" class="content-section">
                    <div class="container-fluid py-4">
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="section-title">
                                    <h1 class="h2 mb-4">GESTIÓN DE DOCUMENTOS</h1>
                                </div>
                            </div>
                        </div>

                        <div class="card shadow-sm">
                            <div class="card-body">
                                <div class="row g-3 mb-4">
                                    <div class="col-12 col-md-6">
                                        <div class="input-group">
                                            <input type="text" 
                                                   class="form-control" 
                                                   placeholder="Buscar documento..." 
                                                   aria-label="Buscar documento">
                                            <button class="btn btn-outline-secondary" 
                                                    type="button"
                                                    title="Buscar documento">
                                                <i class='bx bx-search'></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="col-12 col-md-4">
                                        <select class="form-select" 
                                                aria-label="Filtrar por estado">
                                            <option value="">Todos los estados</option>
                                            <option value="pending">Pendiente</option>
                                            <option value="processing">En Proceso</option>
                                            <option value="completed">Completado</option>
                                        </select>
                                    </div>
                                    <div class="col-12 col-md-2">
                                        <button class="btn btn-primary w-100">
                                            <i class='bx bx-plus me-2'></i>Nuevo Documento
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Agraviados Section -->
                <section id="agraviados" class="content-section">
                    <div class="container-fluid py-4">
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="section-title">
                                    <h1 class="h2 mb-4">REGISTRO DE AGRAVIADOS</h1>
                                </div>
                            </div>
                        </div>

                        <div class="card shadow-sm">
                            <div class="card-body">
                                <div class="row g-3 mb-4">
                                    <div class="col-12 col-md-8">
                                        <div class="input-group">
                                            <input type="text" 
                                                   class="form-control" 
                                                   placeholder="Buscar agraviado..." 
                                                   aria-label="Buscar agraviado">
                                            <button class="btn btn-outline-secondary" 
                                                    type="button"
                                                    title="Buscar agraviado">
                                                <i class='bx bx-search'></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="col-12 col-md-4">
                                        <button class="btn btn-primary w-100">
                                            <i class='bx bx-user-plus me-2'></i>Nuevo Agraviado
                                        </button>
                                    </div>
                                </div>

                                <div class="row g-4" id="agraviados-grid">
                                    <!-- Grid content will be dynamically added -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Historial Section -->
                <section id="historial" class="content-section">
                    <div class="container-fluid py-4">
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="section-title">
                                    <h1 class="h2 mb-4">HISTORIAL DE ACTIVIDADES</h1>
                                </div>
                            </div>
                        </div>

                        <div class="card shadow-sm">
                            <div class="card-body">
                                <div class="row g-3 mb-4">
                                    <div class="col-12 col-md-4">
                                        <input type="date" 
                                               class="form-control" 
                                               id="fecha-inicio"
                                               aria-label="Fecha de inicio">
                                    </div>
                                    <div class="col-12 col-md-4">
                                        <input type="date" 
                                               class="form-control" 
                                               id="fecha-fin"
                                               aria-label="Fecha de fin">
                                    </div>
                                    <div class="col-12 col-md-4">
                                        <button class="btn btn-primary w-100">
                                            <i class='bx bx-filter me-2'></i>Filtrar
                                        </button>
                                    </div>
                                </div>

                                <div class="activity-timeline">
                                    <!-- Timeline content will be dynamically added -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Manejar navegación
            const navLinks = document.querySelectorAll('.nav-links li');
            const sections = document.querySelectorAll('.content-section');

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetSection = this.getAttribute('data-section');

                    // Actualizar navegación activa
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');

                    // Mostrar sección correspondiente
                    sections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === targetSection) {
                            section.classList.add('active');
                        }
                    });
                });
            });

            // Funcionalidad de búsqueda
            const searchInputs = document.querySelectorAll('.search-input');
            searchInputs.forEach(input => {
                input.addEventListener('input', function() {
                    // Implementar lógica de búsqueda
                    console.log('Buscando:', this.value);
                });
            });

            // Funcionalidad de filtros
            const filterSelect = document.querySelector('.filter-select');
            if (filterSelect) {
                filterSelect.addEventListener('change', function() {
                    // Implementar lógica de filtrado
                    console.log('Filtrado por:', this.value);
                });
            }

            // Funcionalidad de fechas en historial
            const dateInputs = document.querySelectorAll('.date-input');
            const filterBtn = document.querySelector('.filter-btn');
            if (filterBtn) {
                filterBtn.addEventListener('click', function() {
                    // Implementar filtrado por fechas
                    const inicio = document.getElementById('fecha-inicio').value;
                    const fin = document.getElementById('fecha-fin').value;
                    console.log('Filtrar desde:', inicio, 'hasta:', fin);
                });
            }

            const statBoxes = document.querySelectorAll('.stat-box');
            const tableRows = document.querySelectorAll('tbody tr');
            let activeFilter = null;

            function updateTableRows(filter) {
                tableRows.forEach(row => {
                    const statusCell = row.querySelector('.status');
                    if (!filter || statusCell.classList.contains(filter)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            }

            statBoxes.forEach(box => {
                box.addEventListener('click', function() {
                    const filter = this.dataset.filter;
                    
                    // Toggle active state
                    if (activeFilter === filter) {
                        // Si se hace clic en el mismo filtro, mostrar todos
                        activeFilter = null;
                        statBoxes.forEach(b => b.classList.remove('active'));
                        updateTableRows(null);
                    } else {
                        // Aplicar nuevo filtro
                        activeFilter = filter;
                        statBoxes.forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        updateTableRows(filter);
                    }
                });
            });

            // Actualizar contadores
            function updateCounters() {
                const counts = {
                    pending: 0,
                    processing: 0,
                    completed: 0
                };

                tableRows.forEach(row => {
                    const statusCell = row.querySelector('.status');
                    if (statusCell) {
                        for (let status in counts) {
                            if (statusCell.classList.contains(status)) {
                                counts[status]++;
                            }
                        }
                    }
                });

                // Actualizar números en los stat-boxes
                statBoxes.forEach(box => {
                    const filter = box.dataset.filter;
                    const numberElement = box.querySelector('.number');
                    if (numberElement) {
                        numberElement.textContent = counts[filter] || 0;
                    }
                });
            }

            // Llamar a updateCounters inicialmente
            updateCounters();
        });
    </script>
</body>
</html>