{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:05:59.459Z"}
{"level":"debug","message":"Executing query [m8o5jdtncn5uei4smml]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:05:59.483Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:05:59.522Z"}
{"level":"debug","message":"Executing query [m8o5jdutx4b7zwlg7l]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886359482\"]","timestamp":"2025-03-25T07:05:59.525Z"}
{"level":"debug","message":"Executing query [m8o5jduwy13p7xjrnqe]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886359482\"]","timestamp":"2025-03-25T07:05:59.529Z"}
{"level":"debug","message":"Executing query [m8o5jduyiaecx3kgtng]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742886359482\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:05:59.530Z"}
{"level":"debug","message":"Executing query [m8o5jdv5yi1imszg9x]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.537Z"}
{"level":"debug","message":"Executing query [m8o5jdv89cbm1xr7vbg]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886359482\"]","timestamp":"2025-03-25T07:05:59.540Z"}
{"level":"debug","message":"Executing query [m8o5jdvbvqj8jj6m6o]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1003]","timestamp":"2025-03-25T07:05:59.543Z"}
{"level":"debug","message":"Executing query [m8o5jdvg1ysn7xdex9i]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.548Z"}
{"level":"debug","message":"Executing query [m8o5jdvitjlmy02x0y]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.550Z"}
{"level":"debug","message":"Executing query [m8o5jdvlspuzu7yky4k]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.553Z"}
{"level":"debug","message":"Executing query [m8o5jdvoybjd7c8dee]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.556Z"}
{"level":"debug","message":"Executing query [m8o5jdvpoj8yl5bkpx]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.557Z"}
{"level":"debug","message":"Executing query [m8o5jdvs7rqg6j7m496]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.560Z"}
{"level":"debug","message":"Executing query [m8o5jdvvqc26u1cowni]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:05:59.563Z"}
{"level":"debug","message":"Executing query [m8o5jdvxqfcwgyqkw8e]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:05:59.565Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:05:59.566Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.679Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.682Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.684Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.686Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.688Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.692Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.694Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:05:59.697Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:05:59.699Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:05:59.700Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:05:59.701Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:05:59.702Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:05:59.921Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:00.964Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:06:01.147Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:06:01.153Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:01.211Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:06:01.228Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:01.278Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:01.760Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:01.902Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:01.925Z"}
{"level":"debug","message":"Executing query [m8o5jfpky1pftxav3pa]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:06:01.928Z"}
{"level":"debug","message":"Executing query [m8o5jfpni3fkbwra7vs]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:06:01.931Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o5jfpni3fkbwra7vs]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:06:01.933Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:01.936Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:02.065Z"}
{"level":"debug","message":"Executing query [m8o5jfthwc13nh0kz1b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:02.069Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:02.080Z"}
{"level":"debug","message":"Executing query [m8o5jftunvcdu6khig]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:02.082Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:06:02.085Z"}
{"level":"debug","message":"Executing query [m8o5jftx56j2qk2hyf]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:06:02.085Z"}
{"level":"debug","message":"Executing query [m8o5jfty2rmrrcmx4be]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:06:02.086Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:06:02.087Z"}
{"level":"debug","message":"Executing query [m8o5jfu04js47z206la]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:02.088Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:06:02.089Z"}
{"level":"debug","message":"Executing query [m8o5jfu5dqxe43lvnar]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:06:02.093Z"}
{"level":"debug","message":"Executing query [m8o5jfu9ikgl28sgdup]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:06:02.097Z"}
{"level":"debug","message":"Executing query [m8o5jfuby67dn5rp81]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[7]","timestamp":"2025-03-25T07:06:02.099Z"}
{"level":"debug","message":"Executing query [m8o5jfuhq7h99r8lpob]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:02.105Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:04.018Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:06:04.083Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:06:04.087Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:04.094Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:06:04.095Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:06:04.189Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:06:04.289Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:04.436Z"}
{"level":"debug","message":"Executing query [m8o5jhncow9w3m24y69]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:04.440Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:04.450Z"}
{"level":"debug","message":"Executing query [m8o5jhnnhanw6mcy2ym]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:04.451Z"}
{"level":"debug","message":"Executing query [m8o5jhnphxjjy6wnt5i]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886364439\"]","timestamp":"2025-03-25T07:06:04.453Z"}
{"level":"debug","message":"Executing query [m8o5jhnqjglwt7ijwyb]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742886364439\",\"TEST-OFICIO-1742886364439\",8596,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:04.454Z"}
{"level":"debug","message":"Executing query [m8o5jhnvhso2lbvrkdv]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.459Z"}
{"level":"debug","message":"Executing query [m8o5jhnxb5xyvn0acmv]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886364439\"]","timestamp":"2025-03-25T07:06:04.461Z"}
{"level":"debug","message":"Executing query [m8o5jhnyyqrjmu5py9a]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",9]","timestamp":"2025-03-25T07:06:04.462Z"}
{"level":"debug","message":"Executing query [m8o5jho0fpo2meul0uk]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.464Z"}
{"level":"debug","message":"Executing query [m8o5jho2oq0zmdqvybi]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.466Z"}
{"level":"debug","message":"Executing query [m8o5jho5trfv65dsa4n]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.469Z"}
{"level":"debug","message":"Executing query [m8o5jho7l4ml0ho0qzb]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.471Z"}
{"level":"debug","message":"Executing query [m8o5jhoaond09j2k7d]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.474Z"}
{"level":"debug","message":"Executing query [m8o5jhob8hjjatayi9t]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742886364475\",\"TEST-SP-OFICIO-1742886364475\",9589,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:06:04.476Z"}
{"level":"debug","message":"Executing query [m8o5jhog5nagqc3thtt]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886364475\"]","timestamp":"2025-03-25T07:06:04.480Z"}
{"level":"debug","message":"Executing query [m8o5jhoio9iysxbs9ac]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886364475\"]","timestamp":"2025-03-25T07:06:04.482Z"}
{"level":"debug","message":"Executing query [m8o5jholtdrw1mne9f]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:04.485Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:04.487Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:04.692Z"}
{"level":"debug","message":"Executing query [m8o5jhuf274r10shw2v]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:04.695Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:04.712Z"}
{"level":"debug","message":"Executing query [m8o5jhuw75rfymjs5n5]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:04.713Z"}
{"level":"debug","message":"Executing query [m8o5jhuy98xtkbgtyk7]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886364694\"]","timestamp":"2025-03-25T07:06:04.714Z"}
{"level":"debug","message":"Executing query [m8o5jhv0711dbpdcae]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742886364694\",\"TEST-OFI-FORENSE-1742886364694\",8433,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742886364694\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:04.716Z"}
{"level":"debug","message":"Executing query [m8o5jhv52o10n76jf4l]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.721Z"}
{"level":"debug","message":"Executing query [m8o5jhv7zcarbofii3]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886364694\"]","timestamp":"2025-03-25T07:06:04.723Z"}
{"level":"debug","message":"Executing query [m8o5jhv9vvkhn5emj9r]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",9]","timestamp":"2025-03-25T07:06:04.725Z"}
{"level":"debug","message":"Executing query [m8o5jhvbrjdk3dk7yp]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.727Z"}
{"level":"debug","message":"Executing query [m8o5jhvds8pn515rq1a]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.729Z"}
{"level":"debug","message":"Executing query [m8o5jhvf4vzlhao5cjp]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.731Z"}
{"level":"debug","message":"Executing query [m8o5jhvgdh7pzs12wfk]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.732Z"}
{"level":"debug","message":"Executing query [m8o5jhvjmppd18duygg]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.735Z"}
{"level":"debug","message":"Executing query [m8o5jhvlapdcxegss0s]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742886364737\",\"TEST-SP-OFI-FORENSE-1742886364737\",9534,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:06:04.737Z"}
{"level":"debug","message":"Executing query [m8o5jhvo9h5nviytf58]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886364737\"]","timestamp":"2025-03-25T07:06:04.740Z"}
{"level":"debug","message":"Executing query [m8o5jhvpqqy8iepcy1r]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886364737\"]","timestamp":"2025-03-25T07:06:04.741Z"}
{"level":"debug","message":"Executing query [m8o5jhvs57t8hz2l5r9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:04.744Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:04.745Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:05.476Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:05.519Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:06:05.520Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:06:05.620Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:06:05.621Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:06:05.622Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:06:05.622Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:06:05.623Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:06:05.623Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:05.956Z"}
{"level":"debug","message":"Executing query [m8o5jitj8gj4m24q5td]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:05.959Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:05.968Z"}
{"level":"debug","message":"Executing query [m8o5jitual79xdv10bo]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886365958\"]","timestamp":"2025-03-25T07:06:05.970Z"}
{"level":"debug","message":"Executing query [m8o5jitw91zsyi9a6kt]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742886365958\",true]","timestamp":"2025-03-25T07:06:05.972Z"}
{"level":"debug","message":"Executing query [m8o5jiu14trimmtss04]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.977Z"}
{"level":"debug","message":"Executing query [m8o5jiu345c7sjqjkq7]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886365958\"]","timestamp":"2025-03-25T07:06:05.979Z"}
{"level":"debug","message":"Executing query [m8o5jiu5vf83pvzkoh]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",9]","timestamp":"2025-03-25T07:06:05.981Z"}
{"level":"debug","message":"Executing query [m8o5jiu8fy9wkog43t8]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.984Z"}
{"level":"debug","message":"Executing query [m8o5jiua1xsucwharav]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.986Z"}
{"level":"debug","message":"Executing query [m8o5jiuelebdyzheufc]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.990Z"}
{"level":"debug","message":"Executing query [m8o5jiughjzps6sj6b5]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.992Z"}
{"level":"debug","message":"Executing query [m8o5jiukk38f95xxo09]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.996Z"}
{"level":"debug","message":"Executing query [m8o5jiuonjrwheu5pu]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:06.000Z"}
{"level":"debug","message":"Executing query [m8o5jiupgxwwlbzm1ea]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:06:06.001Z"}
{"level":"debug","message":"Executing query [m8o5jiur9knnbdff9p4]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:06.003Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:06.004Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:06.228Z"}
{"level":"debug","message":"Executing query [m8o5jj14udxpn5gmwc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:06.232Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:06.245Z"}
{"level":"debug","message":"Executing query [m8o5jj1ja4s0fd1c8vo]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:06.247Z"}
{"level":"debug","message":"Executing query [m8o5jj1mvoiclqradv]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:06:06.250Z"}
{"level":"debug","message":"Executing query [m8o5jj1o29ax6rxkn87]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:06:06.252Z"}
{"level":"debug","message":"Executing query [m8o5jj1q0z52k5nwx2x9]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:06:06.254Z"}
{"level":"debug","message":"Executing query [m8o5jj1ulwumlg8isu]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:06:06.258Z"}
{"level":"debug","message":"Executing query [m8o5jj1yiv4oboljmt]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[10,888,10,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:06:06.262Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:06:06.262Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 10, Área ID: 888, Rol ID: 888, Documento ID: 9","timestamp":"2025-03-25T07:06:06.265Z"}
{"level":"debug","message":"Executing query [m8o5jj23ko40003yv9k]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[9,10,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:06:06.267Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5jj23ko40003yv9k]","params":"[9,10,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:06:06.272Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:06:06.273Z"}
{"level":"debug","message":"Executing query [m8o5jj29xqb9zq0lkw]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[9]","timestamp":"2025-03-25T07:06:06.273Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5jj29xqb9zq0lkw]","params":"[9]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:06:06.276Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:06:06.276Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:06:06.277Z"}
{"level":"debug","message":"Executing query [m8o5jj2ebv96rh9o1cv]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[9,10,\"RESTAURAR\"]","timestamp":"2025-03-25T07:06:06.278Z"}
{"level":"debug","message":"Executing query [m8o5jj2k4evbcpzul4u]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[9]","timestamp":"2025-03-25T07:06:06.284Z"}
{"level":"debug","message":"Executing query [m8o5jj2o80o1fy2nzz6]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[9,10,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:06:06.288Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5jj2o80o1fy2nzz6]","params":"[9,10,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:06:06.292Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:06:06.292Z"}
{"level":"debug","message":"Executing query [m8o5jj2tvcvoid83adf]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[9]","timestamp":"2025-03-25T07:06:06.293Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5jj2tvcvoid83adf]","params":"[9]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:06:06.296Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:06:06.297Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:06:06.297Z"}
{"level":"debug","message":"Executing query [m8o5jj2ynn7qb22faxj]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[10,888,10,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:06:06.298Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:06:06.298Z"}
{"level":"debug","message":"Executing query [m8o5jj31qbq3h6k8wap]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:06:06.301Z"}
{"level":"debug","message":"Executing query [m8o5jj34p5oadkhknp9]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[10,\"DOCUMENTO\",10,\"ELIMINAR\"]","timestamp":"2025-03-25T07:06:06.304Z"}
{"level":"debug","message":"Executing query [m8o5jj37jwsfusx6bl]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.307Z"}
{"level":"debug","message":"Executing query [m8o5jj3cpbnli22o0x]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:06:06.312Z"}
{"level":"debug","message":"Executing query [m8o5jj3gxsey0xxwmg]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.316Z"}
{"level":"debug","message":"Executing query [m8o5jj3j8r2o8y9754h]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:06.319Z"}
{"level":"debug","message":"Executing query [m8o5jj3liy8p3wwsdk]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:06.321Z"}
{"level":"debug","message":"Executing query [m8o5jj3mwn24a2zzde8]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:06.322Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:06:06.326Z"}
{"level":"debug","message":"Executing query [m8o5jj3qftfmdqocqr]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:06.326Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:06.327Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:06.462Z"}
{"level":"debug","message":"Executing query [m8o5jj7lp8zrriew9h]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:06.465Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:06.484Z"}
{"level":"debug","message":"Executing query [m8o5jj88xfb6ekobfoc]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:06:06.488Z"}
{"level":"debug","message":"Executing query [m8o5jj89f1ua2docbjb]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:06:06.489Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:06:06.491Z"}
{"level":"debug","message":"Executing query [m8o5jj8b77goenh3ier]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:06:06.491Z"}
{"level":"debug","message":"Executing query [m8o5jj8cxhepblkj77r]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:06:06.492Z"}
{"level":"debug","message":"Executing query [m8o5jj8eaqas6f3qx7p]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:06:06.494Z"}
{"level":"debug","message":"Executing query [m8o5jj8ko8p3no3bwt]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.500Z"}
{"level":"debug","message":"Executing query [m8o5jj8nvwvfcbt7wlr]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.504Z"}
{"level":"debug","message":"Executing query [m8o5jj8r9pg509stewr]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",10]","timestamp":"2025-03-25T07:06:06.508Z"}
{"level":"debug","message":"Executing query [m8o5jj8vkzn1kvyq7l]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.511Z"}
{"level":"debug","message":"Executing query [m8o5jj8y0xm33nt45noq]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.514Z"}
{"level":"debug","message":"Executing query [m8o5jj91qfvstyqbzn]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.517Z"}
{"level":"debug","message":"Executing query [m8o5jj937lbs1ikm9vx]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:06.519Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:06.520Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:07.060Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:06:07.147Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:07.200Z"}
{"level":"debug","message":"Executing query [m8o5jjssbx46m19uce4]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:06:07.228Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:07.265Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:07.499Z"}
{"level":"debug","message":"Executing query [m8o5jk0ewby3bdrr8or]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:07.502Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:07.515Z"}
{"level":"debug","message":"Executing query [m8o5jk0spze9gps2gog]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:07.516Z"}
{"level":"debug","message":"Executing query [m8o5jk0vc2puna7in18]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886367501\"]","timestamp":"2025-03-25T07:06:07.519Z"}
{"level":"debug","message":"Executing query [m8o5jk0wuumiviu3yab]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742886367501\",\"TEST-OFI-QUIMICA-1742886367501\",5221,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:07.520Z"}
{"level":"debug","message":"Executing query [m8o5jk1304h3ga69dioh]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.527Z"}
{"level":"debug","message":"Executing query [m8o5jk15orkgpqmtrd]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886367501\"]","timestamp":"2025-03-25T07:06:07.529Z"}
{"level":"debug","message":"Executing query [m8o5jk17qhk596j1t48]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",5]","timestamp":"2025-03-25T07:06:07.531Z"}
{"level":"debug","message":"Executing query [m8o5jk19vm6m3lz514q]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.533Z"}
{"level":"debug","message":"Executing query [m8o5jk1cqa1w92l63kr]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.536Z"}
{"level":"debug","message":"Executing query [m8o5jk1fk6jkdjfpuzg]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.539Z"}
{"level":"debug","message":"Executing query [m8o5jk1h014khlp67iifp]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.541Z"}
{"level":"debug","message":"Executing query [m8o5jk1lr3mq63zah4o]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.545Z"}
{"level":"debug","message":"Executing query [m8o5jk1nwbg69xri16p]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:07.547Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:07.549Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:08.110Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:08.114Z"}
{"level":"debug","message":"Executing query [m8o5jkhfiay2lt6ciwo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:08.115Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:08.127Z"}
{"level":"debug","message":"Executing query [m8o5jkhsikp720kfxd8]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:06:08.128Z"}
{"level":"debug","message":"Executing query [m8o5jkht4yq9a6v3bu4]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:06:08.129Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:06:08.130Z"}
{"level":"debug","message":"Executing query [m8o5jkhuz01qitxmyb]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.131Z"}
{"level":"debug","message":"Executing query [m8o5jkhvcmucrbs9vkr]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.131Z"}
{"level":"debug","message":"Executing query [m8o5jkhxfruqm0gvfrm]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.133Z"}
{"level":"debug","message":"Executing query [m8o5jkhyzc5b3jwb3w]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:06:08.134Z"}
{"level":"debug","message":"Executing query [m8o5jki4tu5llj6lpl]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[11]","timestamp":"2025-03-25T07:06:08.140Z"}
{"level":"debug","message":"Executing query [m8o5jki68qriwwciwsv]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.142Z"}
{"level":"debug","message":"Executing query [m8o5jki895ltbt6e3mi]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",11]","timestamp":"2025-03-25T07:06:08.145Z"}
{"level":"debug","message":"Executing query [m8o5jkidfp2bs851vmr]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[11]","timestamp":"2025-03-25T07:06:08.149Z"}
{"level":"debug","message":"Executing query [m8o5jkigtn1k4hgefhh]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[11]","timestamp":"2025-03-25T07:06:08.152Z"}
{"level":"debug","message":"Executing query [m8o5jkijk62g5ivx2wm]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[11]","timestamp":"2025-03-25T07:06:08.155Z"}
{"level":"debug","message":"Executing query [m8o5jkilf06p1qjama]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.157Z"}
{"level":"debug","message":"Executing query [m8o5jkimb50gpe9npsc]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.158Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:06:08.159Z"}
{"level":"debug","message":"Executing query [m8o5jkinoyb2sqjs1zr]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:08.159Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:08.160Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:25.887Z"}
{"level":"debug","message":"Executing query [m8o5jy7onbef46ht2kl]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:25.908Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:25.940Z"}
{"level":"debug","message":"Executing query [m8o5jy8nfmrohf7yum4]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886385907\"]","timestamp":"2025-03-25T07:06:25.943Z"}
{"level":"debug","message":"Executing query [m8o5jy8r6dgekzhi07q]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886385907\"]","timestamp":"2025-03-25T07:06:25.947Z"}
{"level":"debug","message":"Executing query [m8o5jy8t95qweixxrxu]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742886385907\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:25.949Z"}
{"level":"debug","message":"Executing query [m8o5jy8z5s1ajnwlnza]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.955Z"}
{"level":"debug","message":"Executing query [m8o5jy924ukaf7pp27r]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886385907\"]","timestamp":"2025-03-25T07:06:25.958Z"}
{"level":"debug","message":"Executing query [m8o5jy94fs7cgff26ln]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1004]","timestamp":"2025-03-25T07:06:25.960Z"}
{"level":"debug","message":"Executing query [m8o5jy97rfebmctd8kd]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.963Z"}
{"level":"debug","message":"Executing query [m8o5jy99tx50kdzicg]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.965Z"}
{"level":"debug","message":"Executing query [m8o5jy9dahz1kffui1m]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.969Z"}
{"level":"debug","message":"Executing query [m8o5jy9f69cdxjedybu]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.971Z"}
{"level":"debug","message":"Executing query [m8o5jy9ho0xe8z9ykv]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.973Z"}
{"level":"debug","message":"Executing query [m8o5jy9kjfzreqx34cp]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.976Z"}
{"level":"debug","message":"Executing query [m8o5jy9m15ocjufyuhm]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:06:25.978Z"}
{"level":"debug","message":"Executing query [m8o5jy9nd6d7rqujrq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:25.979Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:25.981Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.084Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.087Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.089Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.091Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.092Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.096Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.098Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:06:26.101Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:06:26.103Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:06:26.104Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:06:26.106Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:06:26.107Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:26.333Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:27.315Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:06:27.489Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:06:27.495Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:27.554Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:06:27.568Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:27.619Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:28.069Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:28.190Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:28.212Z"}
{"level":"debug","message":"Executing query [m8o5jzzsedz3z7blznq]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:06:28.216Z"}
{"level":"debug","message":"Executing query [m8o5jzzuzk4ibhtib]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:06:28.218Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o5jzzuzk4ibhtib]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:06:28.220Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:28.221Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:28.360Z"}
{"level":"debug","message":"Executing query [m8o5k03vruce3dng2va]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:28.363Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:28.374Z"}
{"level":"debug","message":"Executing query [m8o5k047uqvjrnmiaoo]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:28.375Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:06:28.378Z"}
{"level":"debug","message":"Executing query [m8o5k04b19rhpm2xu2s]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:06:28.379Z"}
{"level":"debug","message":"Executing query [m8o5k04c5qhm0zq1do5]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:06:28.380Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:06:28.382Z"}
{"level":"debug","message":"Executing query [m8o5k04egwzsnjwvk]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:28.382Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:06:28.385Z"}
{"level":"debug","message":"Executing query [m8o5k04lcpia5s92pgv]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:06:28.389Z"}
{"level":"debug","message":"Executing query [m8o5k04okuqapfocfk]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:06:28.392Z"}
{"level":"debug","message":"Executing query [m8o5k04r0q1uu7fit0zb]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[9]","timestamp":"2025-03-25T07:06:28.395Z"}
{"level":"debug","message":"Executing query [m8o5k04vakfh97kpp9o]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:28.399Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:30.287Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:06:30.348Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:06:30.352Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:30.359Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:06:30.360Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:06:30.455Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:06:30.559Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:30.700Z"}
{"level":"debug","message":"Executing query [m8o5k1ww6yhvzosbusd]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:30.704Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:30.719Z"}
{"level":"debug","message":"Executing query [m8o5k1xc25tkfkpm5vxh]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:30.720Z"}
{"level":"debug","message":"Executing query [m8o5k1xeb1cg3kr0jeo]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886390703\"]","timestamp":"2025-03-25T07:06:30.722Z"}
{"level":"debug","message":"Executing query [m8o5k1xhe6kg53aeuzf]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742886390703\",\"TEST-OFICIO-1742886390703\",3555,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:30.726Z"}
{"level":"debug","message":"Executing query [m8o5k1xnm6shk4tfv1f]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.731Z"}
{"level":"debug","message":"Executing query [m8o5k1xq9yaiobr1bj4]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886390703\"]","timestamp":"2025-03-25T07:06:30.734Z"}
{"level":"debug","message":"Executing query [m8o5k1xsmb9vf8g20f]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",11]","timestamp":"2025-03-25T07:06:30.736Z"}
{"level":"debug","message":"Executing query [m8o5k1xx6l7kbv2hr7o]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.741Z"}
{"level":"debug","message":"Executing query [m8o5k1xzd1kqz7j6l6a]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.743Z"}
{"level":"debug","message":"Executing query [m8o5k1y3q76f0yxnesd]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.747Z"}
{"level":"debug","message":"Executing query [m8o5k1y4rshdv0v76h]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.749Z"}
{"level":"debug","message":"Executing query [m8o5k1y8mu1edccpa3]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.752Z"}
{"level":"debug","message":"Executing query [m8o5k1ybtbuda8rzs7]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742886390754\",\"TEST-SP-OFICIO-1742886390754\",8172,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:06:30.755Z"}
{"level":"debug","message":"Executing query [m8o5k1yf8kjvgth2ojn]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886390754\"]","timestamp":"2025-03-25T07:06:30.759Z"}
{"level":"debug","message":"Executing query [m8o5k1yhvy5cm7g6bv]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886390754\"]","timestamp":"2025-03-25T07:06:30.761Z"}
{"level":"debug","message":"Executing query [m8o5k1ykt8wrhbphkpc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:30.764Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:30.766Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:30.956Z"}
{"level":"debug","message":"Executing query [m8o5k24091uobektycr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:30.960Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:30.974Z"}
{"level":"debug","message":"Executing query [m8o5k24fc4cj68btuh]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:30.975Z"}
{"level":"debug","message":"Executing query [m8o5k24hp0zcx75286m]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886390958\"]","timestamp":"2025-03-25T07:06:30.977Z"}
{"level":"debug","message":"Executing query [m8o5k24jrjsx6bandpa]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742886390958\",\"TEST-OFI-FORENSE-1742886390958\",8388,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742886390958\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:30.979Z"}
{"level":"debug","message":"Executing query [m8o5k24nhyj69ke6034]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.983Z"}
{"level":"debug","message":"Executing query [m8o5k24qnzhhlkzinen]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886390958\"]","timestamp":"2025-03-25T07:06:30.986Z"}
{"level":"debug","message":"Executing query [m8o5k24sutzvbojrhva]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",11]","timestamp":"2025-03-25T07:06:30.988Z"}
{"level":"debug","message":"Executing query [m8o5k24vp6hqsr1vzv]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.991Z"}
{"level":"debug","message":"Executing query [m8o5k24x55g0qaid0e]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.993Z"}
{"level":"debug","message":"Executing query [m8o5k250jp0ilvzhmm]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.996Z"}
{"level":"debug","message":"Executing query [m8o5k252n218ak8im6]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.998Z"}
{"level":"debug","message":"Executing query [m8o5k2551sy9dagnwtq]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:31.001Z"}
{"level":"debug","message":"Executing query [m8o5k256nbdkhcxvswc]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742886391002\",\"TEST-SP-OFI-FORENSE-1742886391002\",1161,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:06:31.002Z"}
{"level":"debug","message":"Executing query [m8o5k259gepzfnkm7ok]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886391002\"]","timestamp":"2025-03-25T07:06:31.005Z"}
{"level":"debug","message":"Executing query [m8o5k25b5a1rzpi8ctw]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886391002\"]","timestamp":"2025-03-25T07:06:31.007Z"}
{"level":"debug","message":"Executing query [m8o5k25f4d9vjxb13n]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:31.011Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:31.013Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:31.984Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:32.031Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:06:32.033Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:06:32.123Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:06:32.124Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:06:32.124Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:06:32.125Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:06:32.125Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:06:32.125Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:32.443Z"}
{"level":"debug","message":"Executing query [m8o5k3990hlv2bi3mi3]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:32.446Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:32.457Z"}
{"level":"debug","message":"Executing query [m8o5k39mwrg11f8zz0t]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886392445\"]","timestamp":"2025-03-25T07:06:32.458Z"}
{"level":"debug","message":"Executing query [m8o5k39qvmb33t9zlgb]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742886392445\",true]","timestamp":"2025-03-25T07:06:32.462Z"}
{"level":"debug","message":"Executing query [m8o5k39t6f48uztuw98]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.465Z"}
{"level":"debug","message":"Executing query [m8o5k39wi2b5fpleal]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886392445\"]","timestamp":"2025-03-25T07:06:32.468Z"}
{"level":"debug","message":"Executing query [m8o5k39yhp52hm6qc5v]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",11]","timestamp":"2025-03-25T07:06:32.470Z"}
{"level":"debug","message":"Executing query [m8o5k3a1bsukr0ndlt9]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.473Z"}
{"level":"debug","message":"Executing query [m8o5k3a3krwg6d2ghkn]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.475Z"}
{"level":"debug","message":"Executing query [m8o5k3a8hz9vae2o3u5]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.480Z"}
{"level":"debug","message":"Executing query [m8o5k3aat9rd5p294b]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.482Z"}
{"level":"debug","message":"Executing query [m8o5k3abwvuxxow10c]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.483Z"}
{"level":"debug","message":"Executing query [m8o5k3aen5d1vez6nf]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.486Z"}
{"level":"debug","message":"Executing query [m8o5k3afkc1ofcyujj9]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:06:32.487Z"}
{"level":"debug","message":"Executing query [m8o5k3agizf4bb8w9xl]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:32.488Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:32.489Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:32.677Z"}
{"level":"debug","message":"Executing query [m8o5k3fs0ibr76mmv7do]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:32.680Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:32.688Z"}
{"level":"debug","message":"Executing query [m8o5k3g206ytwb563r3]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:32.690Z"}
{"level":"debug","message":"Executing query [m8o5k3g3qp4q28illxk]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:06:32.691Z"}
{"level":"debug","message":"Executing query [m8o5k3g49uc3jd0rg5]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:06:32.692Z"}
{"level":"debug","message":"Executing query [m8o5k3g6a16hhvzjafw]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:06:32.694Z"}
{"level":"debug","message":"Executing query [m8o5k3g8tcw2ngsx4rs]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:06:32.696Z"}
{"level":"debug","message":"Executing query [m8o5k3gbugpxrp5fyir]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[12,888,12,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:06:32.699Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:06:32.699Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 12, Área ID: 888, Rol ID: 888, Documento ID: 11","timestamp":"2025-03-25T07:06:32.703Z"}
{"level":"debug","message":"Executing query [m8o5k3gg5koxsn38t09]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[11,12,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:06:32.704Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5k3gg5koxsn38t09]","params":"[11,12,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:06:32.708Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:06:32.709Z"}
{"level":"debug","message":"Executing query [m8o5k3glkiq8b28i8m]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.709Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5k3glkiq8b28i8m]","params":"[11]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:06:32.711Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:06:32.712Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:06:32.712Z"}
{"level":"debug","message":"Executing query [m8o5k3gpgtkbx7pm0i5]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[11,12,\"RESTAURAR\"]","timestamp":"2025-03-25T07:06:32.713Z"}
{"level":"debug","message":"Executing query [m8o5k3gt05b2jeiw9rtu]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.717Z"}
{"level":"debug","message":"Executing query [m8o5k3gvla9inaa8e2]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[11,12,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:06:32.719Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5k3gvla9inaa8e2]","params":"[11,12,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:06:32.723Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:06:32.723Z"}
{"level":"debug","message":"Executing query [m8o5k3gzmqc513h9in]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.723Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5k3gzmqc513h9in]","params":"[11]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:06:32.725Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:06:32.726Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:06:32.726Z"}
{"level":"debug","message":"Executing query [m8o5k3h30tt4t9me9vw]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[12,888,12,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:06:32.727Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:06:32.727Z"}
{"level":"debug","message":"Executing query [m8o5k3h5fwugifne2fl]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:06:32.729Z"}
{"level":"debug","message":"Executing query [m8o5k3h8igbg1nshh1k]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[12,\"DOCUMENTO\",12,\"ELIMINAR\"]","timestamp":"2025-03-25T07:06:32.732Z"}
{"level":"debug","message":"Executing query [m8o5k3haeapghaumga]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.734Z"}
{"level":"debug","message":"Executing query [m8o5k3hdmi9dmw8ma3c]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:06:32.737Z"}
{"level":"debug","message":"Executing query [m8o5k3hg5twx0tjydfj]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.740Z"}
{"level":"debug","message":"Executing query [m8o5k3hi1o5m17jy3em]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:32.742Z"}
{"level":"debug","message":"Executing query [m8o5k3hk7nahm8ekk83]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:32.744Z"}
{"level":"debug","message":"Executing query [m8o5k3hnurb8yy2vin]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:32.747Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:06:32.750Z"}
{"level":"debug","message":"Executing query [m8o5k3hr279yux8rndk]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:32.751Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:32.752Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:32.853Z"}
{"level":"debug","message":"Executing query [m8o5k3kop3ln9qv14oe]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:32.856Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:32.869Z"}
{"level":"debug","message":"Executing query [m8o5k3l384bbsxbgx19]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:06:32.871Z"}
{"level":"debug","message":"Executing query [m8o5k3l4q6apme6mjcn]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:06:32.872Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:06:32.873Z"}
{"level":"debug","message":"Executing query [m8o5k3l6uhyl6wrpuf]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:06:32.874Z"}
{"level":"debug","message":"Executing query [m8o5k3l7t5xwv5zw73q]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:06:32.875Z"}
{"level":"debug","message":"Executing query [m8o5k3l84zztjlnet7e]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:06:32.876Z"}
{"level":"debug","message":"Executing query [m8o5k3lcdrp6vzlitp7]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.880Z"}
{"level":"debug","message":"Executing query [m8o5k3lfpwfeya7cxf]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.883Z"}
{"level":"debug","message":"Executing query [m8o5k3lhlciz1e8d9ce]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",12]","timestamp":"2025-03-25T07:06:32.885Z"}
{"level":"debug","message":"Executing query [m8o5k3lkm0rdjgpdunq]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.888Z"}
{"level":"debug","message":"Executing query [m8o5k3lmw0uvjomjpr8]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.890Z"}
{"level":"debug","message":"Executing query [m8o5k3lpbnllrz8i3pn]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.893Z"}
{"level":"debug","message":"Executing query [m8o5k3lryy821epaefn]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:32.895Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:32.896Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:33.275Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:06:33.337Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:33.384Z"}
{"level":"debug","message":"Executing query [m8o5k3zynrbsipl0m7m]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:06:33.406Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:33.434Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:33.607Z"}
{"level":"debug","message":"Executing query [m8o5k45l69dwwhbnzlm]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:33.609Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:33.618Z"}
{"level":"debug","message":"Executing query [m8o5k45vvwok4uddmp8]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:33.619Z"}
{"level":"debug","message":"Executing query [m8o5k45x7g5urymxm0e]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886393609\"]","timestamp":"2025-03-25T07:06:33.621Z"}
{"level":"debug","message":"Executing query [m8o5k45yr36rvlwxu3j]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742886393609\",\"TEST-OFI-QUIMICA-1742886393609\",5771,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:33.622Z"}
{"level":"debug","message":"Executing query [m8o5k463560igrb1ry6]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.627Z"}
{"level":"debug","message":"Executing query [m8o5k465zevurd8rrnb]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886393609\"]","timestamp":"2025-03-25T07:06:33.629Z"}
{"level":"debug","message":"Executing query [m8o5k467jsu2u53qj8n]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",6]","timestamp":"2025-03-25T07:06:33.631Z"}
{"level":"debug","message":"Executing query [m8o5k4697m5me53jtz]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.633Z"}
{"level":"debug","message":"Executing query [m8o5k46b41y8gxuqyex]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.636Z"}
{"level":"debug","message":"Executing query [m8o5k46eatzj4wmpd8c]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.638Z"}
{"level":"debug","message":"Executing query [m8o5k46g59680depgrb]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.640Z"}
{"level":"debug","message":"Executing query [m8o5k46j62l15vw6nmu]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.643Z"}
{"level":"debug","message":"Executing query [m8o5k46k6ybhcie7fam]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:33.644Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:33.645Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:34.131Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:34.135Z"}
{"level":"debug","message":"Executing query [m8o5k4ka6tzv6o9e06j]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:34.138Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:34.154Z"}
{"level":"debug","message":"Executing query [m8o5k4krhx32lg3ayzk]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:06:34.155Z"}
{"level":"debug","message":"Executing query [m8o5k4kttpscglgsko]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:06:34.157Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:06:34.159Z"}
{"level":"debug","message":"Executing query [m8o5k4kvnq6ssn7gr6]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.159Z"}
{"level":"debug","message":"Executing query [m8o5k4kxml6mtqc0vol]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.161Z"}
{"level":"debug","message":"Executing query [m8o5k4kzpp8hzqwsayd]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.163Z"}
{"level":"debug","message":"Executing query [m8o5k4l154vih6mwhj6]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:06:34.165Z"}
{"level":"debug","message":"Executing query [m8o5k4l9campcydtrd8]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[13]","timestamp":"2025-03-25T07:06:34.173Z"}
{"level":"debug","message":"Executing query [m8o5k4ldvn0x9ec3qhk]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.177Z"}
{"level":"debug","message":"Executing query [m8o5k4lgvuen02wcbaj]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",13]","timestamp":"2025-03-25T07:06:34.180Z"}
{"level":"debug","message":"Executing query [m8o5k4lje6a3rs37y98]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[13]","timestamp":"2025-03-25T07:06:34.183Z"}
{"level":"debug","message":"Executing query [m8o5k4lmmdumcrnhdom]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[13]","timestamp":"2025-03-25T07:06:34.186Z"}
{"level":"debug","message":"Executing query [m8o5k4lqfqleq1ak9p4]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[13]","timestamp":"2025-03-25T07:06:34.190Z"}
{"level":"debug","message":"Executing query [m8o5k4lsmb4vuot38uk]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.192Z"}
{"level":"debug","message":"Executing query [m8o5k4lu5k5y5kwc9kn]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.194Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:06:34.195Z"}
{"level":"debug","message":"Executing query [m8o5k4lws2iv7l3in2a]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:34.196Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:34.198Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.329Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.340Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.342Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.350Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.355Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.360Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.362Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:10:34.366Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:10:34.368Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:10:34.370Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:10:34.371Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:10:34.373Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:34.654Z"}
{"level":"debug","message":"Executing query [m8o5pa75uncrl1twlx8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:34.722Z"}
{"level":"debug","message":"Executing query [m8o5pa9984bqssj2xai]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886634718\"]","timestamp":"2025-03-25T07:10:34.797Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:34.800Z"}
{"level":"debug","message":"Executing query [m8o5pa9w2wvl3dd5cq6]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886634718\"]","timestamp":"2025-03-25T07:10:34.821Z"}
{"level":"debug","message":"Executing query [m8o5pa9zq4wenn7u4bo]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742886634718\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:10:34.823Z"}
{"level":"debug","message":"Executing query [m8o5paaf7r3kacjuehi]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.839Z"}
{"level":"debug","message":"Executing query [m8o5paarcfa1yv7z9v]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886634718\"]","timestamp":"2025-03-25T07:10:34.851Z"}
{"level":"debug","message":"Executing query [m8o5paavs8x56xvexx]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1005]","timestamp":"2025-03-25T07:10:34.855Z"}
{"level":"debug","message":"Executing query [m8o5pab1cbxfuxf2z2t]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.861Z"}
{"level":"debug","message":"Executing query [m8o5pab464b9dmxo3gt]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.864Z"}
{"level":"debug","message":"Executing query [m8o5pab8goouurjl78i]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.868Z"}
{"level":"debug","message":"Executing query [m8o5pabbb4ovprjevli]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.871Z"}
{"level":"debug","message":"Executing query [m8o5pabdcbjkmjuzyyc]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.873Z"}
{"level":"debug","message":"Executing query [m8o5pabgkm2vmkzes5r]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.876Z"}
{"level":"debug","message":"Executing query [m8o5pabjgfq2h8qmv8]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:10:34.879Z"}
{"level":"debug","message":"Executing query [m8o5pablal1c3w32ze9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:34.882Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:34.886Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:34.945Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.093Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.095Z"}
{"level":"debug","message":"Executing query [m8o5paiuabb4kh33wjv]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:35.142Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.223Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:34.977Z"}
{"level":"debug","message":"Executing query [m8o5pal8d9iq5lhyswg]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:10:35.228Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:10:35.240Z"}
{"level":"debug","message":"Executing query [m8o5pallewcrwk0kqtk]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:10:35.241Z"}
{"level":"debug","message":"Executing query [m8o5paloa4lxuy77ksb]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:10:35.244Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:10:35.248Z"}
{"level":"debug","message":"Executing query [m8o5paltyun2pmaeufd]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:10:35.249Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:10:35.224Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.296Z"}
{"level":"debug","message":"Executing query [m8o5panxpp7jhxy56na]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:10:35.326Z"}
{"level":"debug","message":"Executing query [m8o5pao4t5yd8ml4k1m]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:10:35.332Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.234Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o5pao4t5yd8ml4k1m]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:10:35.336Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:35.341Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:10:35.259Z"}
{"level":"debug","message":"Executing query [m8o5pap2amn33wknqpt]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:10:35.366Z"}
{"level":"debug","message":"Executing query [m8o5panytst9wiyallk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:35.329Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.415Z"}
{"level":"debug","message":"Executing query [m8o5paqo0ctanx458z8g]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:10:35.425Z"}
{"level":"debug","message":"Executing query [m8o5papikdgvytv8tp]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:10:35.382Z"}
{"level":"debug","message":"Executing query [m8o5paqshcmqd749w5]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[11]","timestamp":"2025-03-25T07:10:35.428Z"}
{"level":"debug","message":"Executing query [m8o5paqu33ay9044b8c]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886635325\"]","timestamp":"2025-03-25T07:10:35.430Z"}
{"level":"debug","message":"Executing query [m8o5paqxd9crtj1fecv]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742886635325\",\"TEST-OFI-FORENSE-1742886635325\",4797,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742886635325\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:10:35.433Z"}
{"level":"debug","message":"Executing query [m8o5par87ncdng2jnc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:35.444Z"}
{"level":"debug","message":"Executing query [m8o5parfvngyqb37crj]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.451Z"}
{"level":"debug","message":"Executing query [m8o5park3afcmzqmt5z]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886635325\"]","timestamp":"2025-03-25T07:10:35.456Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.381Z"}
{"level":"debug","message":"Executing query [m8o5parn10w5psiauwm]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",13]","timestamp":"2025-03-25T07:10:35.459Z"}
{"level":"debug","message":"Executing query [m8o5parvusqhmno7e1]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.467Z"}
{"level":"debug","message":"Executing query [m8o5parxwmgqsn6h2rd]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.469Z"}
{"level":"debug","message":"Executing query [m8o5pas1e823cyqajy]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.473Z"}
{"level":"debug","message":"Executing query [m8o5pas4m7l0zyvs3]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.476Z"}
{"level":"debug","message":"Executing query [m8o5pas8fevy7m2q1lw]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.481Z"}
{"level":"debug","message":"Executing query [m8o5pasb3hacue3kk9b]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742886635483\",\"TEST-SP-OFI-FORENSE-1742886635483\",9878,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:10:35.483Z"}
{"level":"debug","message":"Executing query [m8o5paslhik0f5dwp2f]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886635483\"]","timestamp":"2025-03-25T07:10:35.494Z"}
{"level":"debug","message":"Executing query [m8o5pasolkdlngbfj3]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886635483\"]","timestamp":"2025-03-25T07:10:35.496Z"}
{"level":"debug","message":"Executing query [m8o5passhuk15wx013q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:35.500Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:35.503Z"}
{"level":"debug","message":"Executing query [m8o5pare5l1zdeybsxd]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:35.451Z"}
{"level":"debug","message":"Executing query [m8o5pat9s04o3obpkh]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:10:35.518Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.524Z"}
{"level":"debug","message":"Executing query [m8o5patmjh5qscvmax9]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886635449\"]","timestamp":"2025-03-25T07:10:35.530Z"}
{"level":"debug","message":"Executing query [m8o5patp2tajj6bnaaj]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742886635449\",\"TEST-OFICIO-1742886635449\",5746,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:10:35.533Z"}
{"level":"debug","message":"Executing query [m8o5patyqgd44hyrt2h]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.542Z"}
{"level":"debug","message":"Executing query [m8o5pau3pc9b3gr4d1]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886635449\"]","timestamp":"2025-03-25T07:10:35.547Z"}
{"level":"debug","message":"Executing query [m8o5pau64kejy1wklfm]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",13]","timestamp":"2025-03-25T07:10:35.550Z"}
{"level":"debug","message":"Executing query [m8o5paue8zzvj1puymn]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.559Z"}
{"level":"debug","message":"Executing query [m8o5pauhoi4kd9t1emi]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.562Z"}
{"level":"debug","message":"Executing query [m8o5paunlrz562zgojh]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.567Z"}
{"level":"debug","message":"Executing query [m8o5pauqszerdm1cr4p]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.570Z"}
{"level":"debug","message":"Executing query [m8o5pauu7ms6c1m2cpn]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.574Z"}
{"level":"debug","message":"Executing query [m8o5pauxae2d957031d]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742886635577\",\"TEST-SP-OFICIO-1742886635577\",1437,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:10:35.577Z"}
{"level":"debug","message":"Executing query [m8o5pav23ptupqwpa7x]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886635577\"]","timestamp":"2025-03-25T07:10:35.582Z"}
{"level":"debug","message":"Executing query [m8o5pav43ajexc7aeks]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886635577\"]","timestamp":"2025-03-25T07:10:35.584Z"}
{"level":"debug","message":"Executing query [m8o5pav8sz1ilhan3c]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:35.588Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:35.590Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:10:35.285Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.773Z"}
{"level":"debug","message":"Executing query [m8o5pb0jwitxte06udh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:35.779Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.801Z"}
{"level":"debug","message":"Executing query [m8o5pb1d9pgkfu2efwd]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886635777\"]","timestamp":"2025-03-25T07:10:35.809Z"}
{"level":"debug","message":"Executing query [m8o5pb1fibdnuxgolm]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742886635777\",true]","timestamp":"2025-03-25T07:10:35.811Z"}
{"level":"debug","message":"Executing query [m8o5pb25nz92ix785w]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.837Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.840Z"}
{"level":"debug","message":"Executing query [m8o5pb2kt6268uh6ma]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:35.852Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.883Z"}
{"level":"debug","message":"Executing query [m8o5pb3fe0p4znmm57]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886635777\"]","timestamp":"2025-03-25T07:10:35.883Z"}
{"level":"debug","message":"Executing query [m8o5pb3o8p8xrhh8y0u]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:10:35.892Z"}
{"level":"debug","message":"Executing query [m8o5pb3q6tznithyfiw]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:10:35.894Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:10:35.896Z"}
{"level":"debug","message":"Executing query [m8o5pb3sq3j8oogiofk]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:10:35.896Z"}
{"level":"debug","message":"Executing query [m8o5pb3umur1h0mbjfe]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:10:35.898Z"}
{"level":"debug","message":"Executing query [m8o5pb3w7nx4r80ycpk]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:10:35.900Z"}
{"level":"debug","message":"Executing query [m8o5pb40gbp706wcd2b]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",13]","timestamp":"2025-03-25T07:10:35.904Z"}
{"level":"debug","message":"Executing query [m8o5pb45wzd8b2rrxu]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.909Z"}
{"level":"debug","message":"Executing query [m8o5pb45b7809qh6vpf]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.910Z"}
{"level":"debug","message":"Executing query [m8o5pb49d7pvg93aful]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.913Z"}
{"level":"debug","message":"Executing query [m8o5pb4ac58ituyjxqu]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.914Z"}
{"level":"debug","message":"Executing query [m8o5pb4dk07svsn59bo]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.917Z"}
{"level":"debug","message":"Executing query [m8o5pb4f91o95u3x094]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.919Z"}
{"level":"debug","message":"Executing query [m8o5pb4fc5a6klgv45]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",13]","timestamp":"2025-03-25T07:10:35.919Z"}
{"level":"debug","message":"Executing query [m8o5pb4hcklti74kznl]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.921Z"}
{"level":"debug","message":"Executing query [m8o5pb4tfx5o37654ft]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.933Z"}
{"level":"debug","message":"Executing query [m8o5pb4ugw8u5yklp7l]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.934Z"}
{"level":"debug","message":"Executing query [m8o5pb4ww3worznqk6]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:10:35.936Z"}
{"level":"debug","message":"Executing query [m8o5pb4wnumn6zdhgbs]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.936Z"}
{"level":"debug","message":"Executing query [m8o5pb4yb2hq1vn9oy6]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:35.938Z"}
{"level":"debug","message":"Executing query [m8o5pb50oc0x7bnnguc]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.940Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:35.940Z"}
{"level":"debug","message":"Executing query [m8o5pb52gkvgk0rvutu]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:35.942Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:35.945Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:36.071Z"}
{"level":"debug","message":"Executing query [m8o5pb8sny7nur0gwt8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:36.076Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:36.101Z"}
{"level":"debug","message":"Executing query [m8o5pb9h8hldn91buyw]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:10:36.101Z"}
{"level":"debug","message":"Executing query [m8o5pb9kcipwzpesdzv]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886636074\"]","timestamp":"2025-03-25T07:10:36.104Z"}
{"level":"debug","message":"Executing query [m8o5pb9mq07j21hlujs]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742886636074\",\"TEST-OFI-QUIMICA-1742886636074\",3393,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:10:36.106Z"}
{"level":"debug","message":"Executing query [m8o5pb9uum4yo4mxav]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.114Z"}
{"level":"debug","message":"Executing query [m8o5pb9zuz1dfi4l45s]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886636074\"]","timestamp":"2025-03-25T07:10:36.119Z"}
{"level":"debug","message":"Executing query [m8o5pba1fj8pcd9xkei]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",7]","timestamp":"2025-03-25T07:10:36.121Z"}
{"level":"debug","message":"Executing query [m8o5pba5694kzy9q8lm]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.125Z"}
{"level":"debug","message":"Executing query [m8o5pba9wujuwiqhewa]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.129Z"}
{"level":"debug","message":"Executing query [m8o5pbad8lsi0xcp3vm]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.133Z"}
{"level":"debug","message":"Executing query [m8o5pbagozymkuf11q]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.136Z"}
{"level":"debug","message":"Executing query [m8o5pbalsj9mu9zce0l]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.141Z"}
{"level":"debug","message":"Executing query [m8o5pbandhrfoin4eqh]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:36.143Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:36.145Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:10:35.517Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:10:35.518Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:10:35.519Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:10:35.521Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:10:35.522Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:10:35.522Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:36.095Z"}
{"level":"debug","message":"Executing query [m8o5pbamrpboxxh4cah]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:36.142Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:36.194Z"}
{"level":"debug","message":"Executing query [m8o5pbc7at0xrxvnfhh]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:10:36.199Z"}
{"level":"debug","message":"Executing query [m8o5pbcd5gok8dp7orb]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:10:36.205Z"}
{"level":"debug","message":"Executing query [m8o5pbcgmvjfqy10hni]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:10:36.208Z"}
{"level":"debug","message":"Executing query [m8o5pbcj2ppkjl3f0qo]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:10:36.212Z"}
{"level":"debug","message":"Executing query [m8o5pbcqd1amyuhggrs]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:10:36.218Z"}
{"level":"debug","message":"Executing query [m8o5pbcwyeijpw4fuj8]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[14,888,14,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:10:36.224Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:10:36.224Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 14, Área ID: 888, Rol ID: 888, Documento ID: 13","timestamp":"2025-03-25T07:10:36.230Z"}
{"level":"debug","message":"Executing query [m8o5pbd4j8vpmnk1so]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[13,14,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:10:36.232Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5pbd4j8vpmnk1so]","params":"[13,14,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:10:36.238Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:10:36.239Z"}
{"level":"debug","message":"Executing query [m8o5pbdb3z85mt0d7ym]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[13]","timestamp":"2025-03-25T07:10:36.239Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5pbdb3z85mt0d7ym]","params":"[13]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:10:36.241Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:10:36.242Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:10:36.242Z"}
{"level":"debug","message":"Executing query [m8o5pbdfffpp3ia18t9]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[13,14,\"RESTAURAR\"]","timestamp":"2025-03-25T07:10:36.243Z"}
{"level":"debug","message":"Executing query [m8o5pbdmclnljvzqz4t]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[13]","timestamp":"2025-03-25T07:10:36.251Z"}
{"level":"debug","message":"Executing query [m8o5pbdq73lceu8gr9p]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[13,14,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:10:36.254Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5pbdq73lceu8gr9p]","params":"[13,14,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:10:36.258Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:10:36.259Z"}
{"level":"debug","message":"Executing query [m8o5pbdvh1iit0xuey7]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[13]","timestamp":"2025-03-25T07:10:36.259Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5pbdvh1iit0xuey7]","params":"[13]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:10:36.271Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:10:36.272Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:10:36.272Z"}
{"level":"debug","message":"Executing query [m8o5pbe9xy5zf4ypmq]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[14,888,14,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:10:36.273Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:10:36.273Z"}
{"level":"debug","message":"Executing query [m8o5pbedlmnmliqtbd]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:10:36.277Z"}
{"level":"debug","message":"Executing query [m8o5pbeg27r727t0r3f]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[14,\"DOCUMENTO\",14,\"ELIMINAR\"]","timestamp":"2025-03-25T07:10:36.280Z"}
{"level":"debug","message":"Executing query [m8o5pbem22c3dm555yi]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[14]","timestamp":"2025-03-25T07:10:36.286Z"}
{"level":"debug","message":"Executing query [m8o5pbeueoeovd1a4zw]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:10:36.294Z"}
{"level":"debug","message":"Executing query [m8o5pbf1leq0ziydfna]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-25T07:10:36.301Z"}
{"level":"debug","message":"Executing query [m8o5pbf5ieyz69gnw9k]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:10:36.305Z"}
{"level":"debug","message":"Executing query [m8o5pbf7nlnhwqdbz0s]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:10:36.307Z"}
{"level":"debug","message":"Executing query [m8o5pbf9dt9cpprsxd5]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:10:36.309Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:10:36.318Z"}
{"level":"debug","message":"Executing query [m8o5pbfigji5lpw9ana]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:36.318Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:36.320Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:36.433Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:36.457Z"}
{"level":"debug","message":"Executing query [m8o5pbjfyjl6g3snzxg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:36.459Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:36.484Z"}
{"level":"debug","message":"Executing query [m8o5pbkb4y7yainfxev]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:10:36.491Z"}
{"level":"debug","message":"Executing query [m8o5pbkdab46snw5f6m]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:10:36.493Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:10:36.495Z"}
{"level":"debug","message":"Executing query [m8o5pbkfr36is7dllko]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.495Z"}
{"level":"debug","message":"Executing query [m8o5pbkggvkkw6c5ko]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.496Z"}
{"level":"debug","message":"Executing query [m8o5pbkjx6ckogf31g]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.499Z"}
{"level":"debug","message":"Executing query [m8o5pbklw3gzh9js6gk]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:10:36.501Z"}
{"level":"debug","message":"Executing query [m8o5pbks6twlhve40o3]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[15]","timestamp":"2025-03-25T07:10:36.508Z"}
{"level":"debug","message":"Executing query [m8o5pbkxvwzpk1d2aa]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.513Z"}
{"level":"debug","message":"Executing query [m8o5pbl04jnhsz6gxy4]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",15]","timestamp":"2025-03-25T07:10:36.516Z"}
{"level":"debug","message":"Executing query [m8o5pbl4veurfbap7d]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[15]","timestamp":"2025-03-25T07:10:36.520Z"}
{"level":"debug","message":"Executing query [m8o5pbl6yzaj5duw9s]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[15]","timestamp":"2025-03-25T07:10:36.522Z"}
{"level":"debug","message":"Executing query [m8o5pblaqau6jju561i]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[15]","timestamp":"2025-03-25T07:10:36.526Z"}
{"level":"debug","message":"Executing query [m8o5pblcx0bbiwexe]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.528Z"}
{"level":"debug","message":"Executing query [m8o5pblfby4tqrbtaji]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.531Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:10:36.532Z"}
{"level":"debug","message":"Executing query [m8o5pblgttz0jf3ssw]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:36.532Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:36.534Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:36.795Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:10:37.143Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:10:37.170Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:37.425Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:10:37.446Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:37.507Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:37.616Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:10:37.840Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:37.939Z"}
{"level":"debug","message":"Executing query [m8o5pcpi1mi3bj1qn1s]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:10:37.975Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:38.012Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:38.484Z"}
{"duration":"21ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:10:38.652Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:38.653Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:10:38.656Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:38.661Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:38.629Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:38.753Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:10:38.758Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:32.784Z"}
{"level":"debug","message":"Executing query [m8o623p6fajj9upzdr8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:32.826Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:32.875Z"}
{"level":"debug","message":"Executing query [m8o623rb4vh9ta01w16]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887232825\"]","timestamp":"2025-03-25T07:20:32.903Z"}
{"level":"debug","message":"Executing query [m8o623rj4a50z14rdh6]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887232825\"]","timestamp":"2025-03-25T07:20:32.911Z"}
{"level":"debug","message":"Executing query [m8o623rouwckbzgohop]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742887232825\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:20:32.916Z"}
{"level":"debug","message":"Executing query [m8o623sb72x6tirhvku]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.939Z"}
{"level":"debug","message":"Executing query [m8o623slwp67ph7kvd8]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887232825\"]","timestamp":"2025-03-25T07:20:32.949Z"}
{"level":"debug","message":"Executing query [m8o623soi1xiw6f4zgk]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1006]","timestamp":"2025-03-25T07:20:32.952Z"}
{"level":"debug","message":"Executing query [m8o623ssedx49pm6vmh]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.956Z"}
{"level":"debug","message":"Executing query [m8o623sviylgg1p315]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.959Z"}
{"level":"debug","message":"Executing query [m8o623szanprme6r7l]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.963Z"}
{"level":"debug","message":"Executing query [m8o623t3dzc0vgkjjc]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.967Z"}
{"level":"debug","message":"Executing query [m8o623t69p77bj6bnzr]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.970Z"}
{"level":"debug","message":"Executing query [m8o623tamtnv5hryian]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.974Z"}
{"level":"debug","message":"Executing query [m8o623tc1x14w06twdl]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:20:32.976Z"}
{"level":"debug","message":"Executing query [m8o623tdhg7hu2n9nu]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:32.977Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:32.979Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.153Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.159Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.165Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.172Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.176Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.179Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.185Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:20:33.190Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:33.898Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:20:33.192Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:20:33.201Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:20:33.204Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:20:33.207Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:35.688Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:20:36.018Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:20:36.026Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:36.102Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:20:36.122Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:36.185Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:36.763Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:36.969Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:37.009Z"}
{"level":"debug","message":"Executing query [m8o626xqo2hih9ez9kp]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:20:37.022Z"}
{"level":"debug","message":"Executing query [m8o626xvmg3aq7fvqeh]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:20:37.027Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o626xvmg3aq7fvqeh]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:20:37.030Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:37.032Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:37.218Z"}
{"level":"debug","message":"Executing query [m8o6273992l06jk0gkk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:37.221Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:37.235Z"}
{"level":"debug","message":"Executing query [m8o6273sfoh6cvvk8ac]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:20:37.240Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:20:37.241Z"}
{"level":"debug","message":"Executing query [m8o6273u52ed85lpx1n]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:20:37.242Z"}
{"level":"debug","message":"Executing query [m8o6273vfhwuqv0z09n]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:20:37.243Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:20:37.245Z"}
{"level":"debug","message":"Executing query [m8o6273xjjt44m3rlx]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:20:37.245Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:20:37.246Z"}
{"level":"debug","message":"Executing query [m8o62744i1y4bquy32]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:20:37.252Z"}
{"level":"debug","message":"Executing query [m8o62747em3l3l0y9sa]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:20:37.255Z"}
{"level":"debug","message":"Executing query [m8o627490p2qfjtd59ho]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[13]","timestamp":"2025-03-25T07:20:37.257Z"}
{"level":"debug","message":"Executing query [m8o6274el5wzpfzxetm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:37.263Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:40.453Z"}
{"duration":"12ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:20:40.553Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:20:40.559Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:40.567Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:20:40.569Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:20:40.730Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:20:40.894Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:41.180Z"}
{"level":"debug","message":"Executing query [m8o62a5m0qhaszyrcozp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:41.194Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:41.228Z"}
{"level":"debug","message":"Executing query [m8o62a6pan2qn05j5p9]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:20:41.233Z"}
{"level":"debug","message":"Executing query [m8o62a6sxupidaye9ye]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742887241193\"]","timestamp":"2025-03-25T07:20:41.236Z"}
{"level":"debug","message":"Executing query [m8o62a6ud67g53yrwnw]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742887241193\",\"TEST-OFICIO-1742887241193\",1381,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:20:41.239Z"}
{"level":"debug","message":"Executing query [m8o62a73rlswyaoet9]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.247Z"}
{"level":"debug","message":"Executing query [m8o62a76ryci2wnwuc]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742887241193\"]","timestamp":"2025-03-25T07:20:41.250Z"}
{"level":"debug","message":"Executing query [m8o62a7begvtvazlpsj]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",15]","timestamp":"2025-03-25T07:20:41.255Z"}
{"level":"debug","message":"Executing query [m8o62a7end777kzoh78]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.258Z"}
{"level":"debug","message":"Executing query [m8o62a7imp797b26wlh]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.262Z"}
{"level":"debug","message":"Executing query [m8o62a7qo78mg6hz5mq]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.270Z"}
{"level":"debug","message":"Executing query [m8o62a7t5fjt9xe5trk]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.273Z"}
{"level":"debug","message":"Executing query [m8o62a7xp91z1aic9h]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.277Z"}
{"level":"debug","message":"Executing query [m8o62a85qr71ny6009]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742887241285\",\"TEST-SP-OFICIO-1742887241285\",6317,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:20:41.285Z"}
{"level":"debug","message":"Executing query [m8o62a8arclmzq62mrd]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742887241285\"]","timestamp":"2025-03-25T07:20:41.290Z"}
{"level":"debug","message":"Executing query [m8o62a8g9xz53y47ia]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742887241285\"]","timestamp":"2025-03-25T07:20:41.296Z"}
{"level":"debug","message":"Executing query [m8o62a8kb2nqw1suktc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:41.300Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:41.302Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:41.697Z"}
{"level":"debug","message":"Executing query [m8o62ajqp70cyqzcv8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:41.702Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:41.730Z"}
{"level":"debug","message":"Executing query [m8o62akkizklhi8jgap]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:20:41.733Z"}
{"level":"debug","message":"Executing query [m8o62akoe3hxvxz5riv]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742887241700\"]","timestamp":"2025-03-25T07:20:41.736Z"}
{"level":"debug","message":"Executing query [m8o62akr20ac8zsjh10i]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742887241700\",\"TEST-OFI-FORENSE-1742887241700\",2759,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742887241700\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:20:41.740Z"}
{"level":"debug","message":"Executing query [m8o62al0md1dc72tngd]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.748Z"}
{"level":"debug","message":"Executing query [m8o62al3l24kkuqjwl]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742887241700\"]","timestamp":"2025-03-25T07:20:41.752Z"}
{"level":"debug","message":"Executing query [m8o62al84cei8fqu70x]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",15]","timestamp":"2025-03-25T07:20:41.756Z"}
{"level":"debug","message":"Executing query [m8o62alfbbbsz2ghxai]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.763Z"}
{"level":"debug","message":"Executing query [m8o62alkcs5qn6rlxk]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.768Z"}
{"level":"debug","message":"Executing query [m8o62alrswfvsq6hlbk]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.775Z"}
{"level":"debug","message":"Executing query [m8o62alu5ajbgacwg53]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.778Z"}
{"level":"debug","message":"Executing query [m8o62alz4k27kibofri]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.783Z"}
{"level":"debug","message":"Executing query [m8o62am5oxc2ig0zem]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742887241789\",\"TEST-SP-OFI-FORENSE-1742887241789\",8256,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:20:41.789Z"}
{"level":"debug","message":"Executing query [m8o62amalipqf2ted5o]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742887241789\"]","timestamp":"2025-03-25T07:20:41.794Z"}
{"level":"debug","message":"Executing query [m8o62amc7l3y8h6tux8]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742887241789\"]","timestamp":"2025-03-25T07:20:41.796Z"}
{"level":"debug","message":"Executing query [m8o62amo3mf36fuvvu9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:41.808Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:41.810Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:43.099Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:43.179Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:20:43.181Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:20:43.329Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:20:43.330Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:20:43.331Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:20:43.332Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:20:43.334Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:20:43.334Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:43.872Z"}
{"level":"debug","message":"Executing query [m8o62c84dcxxg5ayrfe]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:43.876Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:43.902Z"}
{"level":"debug","message":"Executing query [m8o62c8xysn2ny8eajq]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742887243875\"]","timestamp":"2025-03-25T07:20:43.905Z"}
{"level":"debug","message":"Executing query [m8o62c90lem7o51mqna]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742887243875\",true]","timestamp":"2025-03-25T07:20:43.908Z"}
{"level":"debug","message":"Executing query [m8o62c99giosakegl7]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.917Z"}
{"level":"debug","message":"Executing query [m8o62c9d4m7ci7l4234]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742887243875\"]","timestamp":"2025-03-25T07:20:43.921Z"}
{"level":"debug","message":"Executing query [m8o62c9hufq7yunpah]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",15]","timestamp":"2025-03-25T07:20:43.925Z"}
{"level":"debug","message":"Executing query [m8o62c9kdvokpy1foog]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.928Z"}
{"level":"debug","message":"Executing query [m8o62c9new93f57xt6c]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.931Z"}
{"level":"debug","message":"Executing query [m8o62c9xddq10ie26ad]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.941Z"}
{"level":"debug","message":"Executing query [m8o62c9zq36j51lzb4h]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.943Z"}
{"level":"debug","message":"Executing query [m8o62ca08tmz9pnu177]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.944Z"}
{"level":"debug","message":"Executing query [m8o62ca4a7wdxj8kttk]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.948Z"}
{"level":"debug","message":"Executing query [m8o62ca6egkac2xpvxk]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:20:43.950Z"}
{"level":"debug","message":"Executing query [m8o62ca88bqt5tz0tnn]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:43.952Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:43.954Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:44.291Z"}
{"level":"debug","message":"Executing query [m8o62cjtxu98y00trc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:44.297Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:44.315Z"}
{"level":"debug","message":"Executing query [m8o62ckcz558lnd7kc]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:20:44.316Z"}
{"level":"debug","message":"Executing query [m8o62ckd03iuk3j9c0ms]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:20:44.317Z"}
{"level":"debug","message":"Executing query [m8o62ckeb7zq9putajo]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:20:44.318Z"}
{"level":"debug","message":"Executing query [m8o62ckhw06nx05v9lo]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:20:44.321Z"}
{"level":"debug","message":"Executing query [m8o62ckneo46prlmn1]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:20:44.327Z"}
{"level":"debug","message":"Executing query [m8o62ckqo1ekeukya9]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[16,888,16,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:20:44.330Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:20:44.330Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 16, Área ID: 888, Rol ID: 888, Documento ID: 15","timestamp":"2025-03-25T07:20:44.344Z"}
{"level":"debug","message":"Executing query [m8o62cl5r5yjppkgk5i]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[15,16,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:20:44.345Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o62cl5r5yjppkgk5i]","params":"[15,16,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:20:44.353Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:20:44.354Z"}
{"level":"debug","message":"Executing query [m8o62clfrf54v72hr1]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[15]","timestamp":"2025-03-25T07:20:44.355Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o62clfrf54v72hr1]","params":"[15]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:20:44.357Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:20:44.358Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:20:44.358Z"}
{"level":"debug","message":"Executing query [m8o62cljhpmvqy7ke8]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[15,16,\"RESTAURAR\"]","timestamp":"2025-03-25T07:20:44.359Z"}
{"level":"debug","message":"Executing query [m8o62clpgyepenyi9vt]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[15]","timestamp":"2025-03-25T07:20:44.365Z"}
{"level":"debug","message":"Executing query [m8o62clskoeq1hh70f8]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[15,16,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:20:44.368Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o62clskoeq1hh70f8]","params":"[15,16,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:20:44.372Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:20:44.373Z"}
{"level":"debug","message":"Executing query [m8o62clxpwjcdqn0cab]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[15]","timestamp":"2025-03-25T07:20:44.373Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o62clxpwjcdqn0cab]","params":"[15]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:20:44.377Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:20:44.378Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:20:44.379Z"}
{"level":"debug","message":"Executing query [m8o62cm4pv8pqu69m2h]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[16,888,16,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:20:44.380Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:20:44.380Z"}
{"level":"debug","message":"Executing query [m8o62cm81oueqotjdz2]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:20:44.385Z"}
{"level":"debug","message":"Executing query [m8o62cmg39yu66jqaq2]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[16,\"DOCUMENTO\",16,\"ELIMINAR\"]","timestamp":"2025-03-25T07:20:44.392Z"}
{"level":"debug","message":"Executing query [m8o62cmjf2bvfd00jta]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.395Z"}
{"level":"debug","message":"Executing query [m8o62cmmeizohpuv7od]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:20:44.398Z"}
{"level":"debug","message":"Executing query [m8o62cmuo47t87fm3gm]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.406Z"}
{"level":"debug","message":"Executing query [m8o62cmzozrwxb8mll]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:20:44.411Z"}
{"level":"debug","message":"Executing query [m8o62cn40b1ejzx9xy1m]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:20:44.416Z"}
{"level":"debug","message":"Executing query [m8o62cn649d6bckagp3]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:20:44.418Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:20:44.421Z"}
{"level":"debug","message":"Executing query [m8o62cna9p24p5t2wul]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:44.422Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:44.423Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:44.646Z"}
{"level":"debug","message":"Executing query [m8o62cudlfmmwc668b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:44.678Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:44.727Z"}
{"level":"debug","message":"Executing query [m8o62cvxmj97esq6kzr]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:20:44.733Z"}
{"level":"debug","message":"Executing query [m8o62cw33o5zm945a33]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:20:44.739Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:20:44.742Z"}
{"level":"debug","message":"Executing query [m8o62cw6bm1919gct2]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:20:44.743Z"}
{"level":"debug","message":"Executing query [m8o62cw8pqa7dg7wqc]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:20:44.744Z"}
{"level":"debug","message":"Executing query [m8o62cwcogil4sjayae]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:20:44.748Z"}
{"level":"debug","message":"Executing query [m8o62cwl7lliylnznk]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.757Z"}
{"level":"debug","message":"Executing query [m8o62cwvj44l2s3fsw]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.767Z"}
{"level":"debug","message":"Executing query [m8o62cx0qsz0c8che09]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",16]","timestamp":"2025-03-25T07:20:44.772Z"}
{"level":"debug","message":"Executing query [m8o62cxlmpe3bmookva]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.793Z"}
{"level":"debug","message":"Executing query [m8o62cxovlh29zko3xs]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.796Z"}
{"level":"debug","message":"Executing query [m8o62cxvrljedzbx7o]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.803Z"}
{"level":"debug","message":"Executing query [m8o62cxzvfvaa4xus]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:44.807Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:44.809Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:45.699Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:20:45.795Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:45.871Z"}
{"level":"debug","message":"Executing query [m8o62dsbxo27oslpphl]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:20:45.900Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:45.954Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:46.243Z"}
{"level":"debug","message":"Executing query [m8o62e1y0x6mznocxd6j]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:46.246Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:46.261Z"}
{"level":"debug","message":"Executing query [m8o62e2fgokt7i7f7nc]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:20:46.263Z"}
{"level":"debug","message":"Executing query [m8o62e2isu2dx2ovd7]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742887246245\"]","timestamp":"2025-03-25T07:20:46.266Z"}
{"level":"debug","message":"Executing query [m8o62e2n2yx1f5wayp3]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742887246245\",\"TEST-OFI-QUIMICA-1742887246245\",8201,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:20:46.271Z"}
{"level":"debug","message":"Executing query [m8o62e2v55a5tv8tsrj]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.279Z"}
{"level":"debug","message":"Executing query [m8o62e305itx96htthc]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742887246245\"]","timestamp":"2025-03-25T07:20:46.284Z"}
{"level":"debug","message":"Executing query [m8o62e325zy2or2oj9e]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",8]","timestamp":"2025-03-25T07:20:46.286Z"}
{"level":"debug","message":"Executing query [m8o62e36ldm0a2nv2ej]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.290Z"}
{"level":"debug","message":"Executing query [m8o62e39j260txyx0ng]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.293Z"}
{"level":"debug","message":"Executing query [m8o62e3cz96kdn80t7c]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.296Z"}
{"level":"debug","message":"Executing query [m8o62e3e1ca92j88g7ei]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.298Z"}
{"level":"debug","message":"Executing query [m8o62e3hx9t1aj5n03i]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.301Z"}
{"level":"debug","message":"Executing query [m8o62e3jyfsa8s6jrco]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:46.303Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:46.305Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:47.005Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:47.010Z"}
{"level":"debug","message":"Executing query [m8o62en87ux64zerdo3]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:47.013Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:47.029Z"}
{"level":"debug","message":"Executing query [m8o62enr6avv34srzny]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:20:47.031Z"}
{"level":"debug","message":"Executing query [m8o62ens3ww2y14pl6l]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:20:47.033Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:20:47.033Z"}
{"level":"debug","message":"Executing query [m8o62enu2qklppxgt9q]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.034Z"}
{"level":"debug","message":"Executing query [m8o62env7yycaaxaz5k]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.035Z"}
{"level":"debug","message":"Executing query [m8o62enw48835ifsaey]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.036Z"}
{"level":"debug","message":"Executing query [m8o62enxyt37u8d4bl8]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:20:47.037Z"}
{"level":"debug","message":"Executing query [m8o62eo4pwiicgohved]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[17]","timestamp":"2025-03-25T07:20:47.044Z"}
{"level":"debug","message":"Executing query [m8o62eo7pxr9hr5hd0a]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.047Z"}
{"level":"debug","message":"Executing query [m8o62eo9xy3ukrivwrk]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",17]","timestamp":"2025-03-25T07:20:47.049Z"}
{"level":"debug","message":"Executing query [m8o62eocp5aj36nhg9b]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[17]","timestamp":"2025-03-25T07:20:47.052Z"}
{"level":"debug","message":"Executing query [m8o62eoewyxmia3z3ya]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[17]","timestamp":"2025-03-25T07:20:47.054Z"}
{"level":"debug","message":"Executing query [m8o62eol9awc5fpird6]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[17]","timestamp":"2025-03-25T07:20:47.061Z"}
{"level":"debug","message":"Executing query [m8o62eomh22r6cpcnu6]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.062Z"}
{"level":"debug","message":"Executing query [m8o62eona8kk1h8fsjh]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.063Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:20:47.064Z"}
{"level":"debug","message":"Executing query [m8o62eopuvidwqx2h1q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:47.065Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:47.066Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.474Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.488Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.491Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.505Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.520Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.527Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.532Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:21:29.538Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:21:29.541Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:21:29.543Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:21:29.544Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:21:29.546Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:29.806Z"}
{"level":"debug","message":"Executing query [m8o63bqaxr1x5e1bwm9]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:29.890Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:29.977Z"}
{"level":"debug","message":"Executing query [m8o63btai72b4jpm60d]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887289886\"]","timestamp":"2025-03-25T07:21:29.998Z"}
{"level":"debug","message":"Executing query [m8o63btw877jz440itl]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887289886\"]","timestamp":"2025-03-25T07:21:30.020Z"}
{"level":"debug","message":"Executing query [m8o63btztryq7awjdar]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742887289886\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:21:30.023Z"}
{"level":"debug","message":"Executing query [m8o63buckj08x5totid]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.036Z"}
{"level":"debug","message":"Executing query [m8o63buhldgk3wjiu1]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887289886\"]","timestamp":"2025-03-25T07:21:30.041Z"}
{"level":"debug","message":"Executing query [m8o63buoggl3hmn8clb]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1007]","timestamp":"2025-03-25T07:21:30.048Z"}
{"level":"debug","message":"Executing query [m8o63buup3e36bo4pvi]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.054Z"}
{"level":"debug","message":"Executing query [m8o63bv01us8ktzu9ko]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.060Z"}
{"level":"debug","message":"Executing query [m8o63bv46gizt1ng3fl]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.064Z"}
{"level":"debug","message":"Executing query [m8o63bv6vyhb1jzedg]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.067Z"}
{"level":"debug","message":"Executing query [m8o63bv9mjjjcarebjr]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.069Z"}
{"level":"debug","message":"Executing query [m8o63bvgm1pokgfy0lh]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.076Z"}
{"level":"debug","message":"Executing query [m8o63bvivs38is5t8fq]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:21:30.078Z"}
{"level":"debug","message":"Executing query [m8o63bvlj6b2173yzp]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:30.081Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:30.086Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:30.186Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:21:30.195Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:30.058Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:30.323Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:30.364Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:30.512Z"}
{"level":"debug","message":"Executing query [m8o63c82zy7g9cs8o5]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:21:30.531Z"}
{"level":"debug","message":"Executing query [m8o63c88afckw5v2aqc]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:21:30.536Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o63c88afckw5v2aqc]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:21:30.540Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:30.544Z"}
{"level":"debug","message":"Executing query [m8o63c5t5jd6s6ltkgh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:30.449Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:30.599Z"}
{"level":"debug","message":"Executing query [m8o63ca80hgherrc9nnn]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:21:30.608Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:21:30.613Z"}
{"level":"debug","message":"Executing query [m8o63caer89wobixhu9]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:21:30.614Z"}
{"level":"debug","message":"Executing query [m8o63caq21yyhgtcu3r]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:21:30.626Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:21:30.628Z"}
{"level":"debug","message":"Executing query [m8o63casixijnb9kuph]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:21:30.628Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:21:30.417Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:30.736Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:21:30.632Z"}
{"level":"debug","message":"Executing query [m8o63cejiu3r7qyldmc]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:21:30.767Z"}
{"level":"debug","message":"Executing query [m8o63cf1abfqzyblcjs]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:21:30.781Z"}
{"level":"debug","message":"Executing query [m8o63ce3h0ff87smacv]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:30.747Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:30.784Z"}
{"level":"debug","message":"Executing query [m8o63cf67rfcho118wi]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:21:30.786Z"}
{"level":"debug","message":"Executing query [m8o63cf7jch4wv2n84]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[15]","timestamp":"2025-03-25T07:21:30.787Z"}
{"level":"debug","message":"Executing query [m8o63cfa0pn3c7sb6kds]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742887290744\"]","timestamp":"2025-03-25T07:21:30.790Z"}
{"level":"debug","message":"Executing query [m8o63cferpubrmz89ym]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742887290744\",\"TEST-OFICIO-1742887290744\",4603,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:21:30.794Z"}
{"level":"debug","message":"Executing query [m8o63cfh2h336kv8naw]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:30.797Z"}
{"level":"debug","message":"Executing query [m8o63cflqnigufpa35i]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.801Z"}
{"level":"debug","message":"Executing query [m8o63cfrm9yz1m8mdq]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742887290744\"]","timestamp":"2025-03-25T07:21:30.807Z"}
{"level":"debug","message":"Executing query [m8o63cftxhjljeuamv]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",17]","timestamp":"2025-03-25T07:21:30.809Z"}
{"level":"debug","message":"Executing query [m8o63cfx6kcl5igqiqq]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.813Z"}
{"level":"debug","message":"Executing query [m8o63cg1n9s7ahpc9a]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.817Z"}
{"level":"debug","message":"Executing query [m8o63cg814jukt6ohos]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.824Z"}
{"level":"debug","message":"Executing query [m8o63cga5ff0r83d6fo]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.826Z"}
{"level":"debug","message":"Executing query [m8o63cgi2nvqee96h3c]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.834Z"}
{"level":"debug","message":"Executing query [m8o63cglvmibulmzesd]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742887290837\",\"TEST-SP-OFICIO-1742887290837\",7238,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:21:30.837Z"}
{"level":"debug","message":"Executing query [m8o63cgqwtalo4a3ts8]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742887290837\"]","timestamp":"2025-03-25T07:21:30.842Z"}
{"level":"debug","message":"Executing query [m8o63cguavxmjz7khui]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742887290837\"]","timestamp":"2025-03-25T07:21:30.846Z"}
{"level":"debug","message":"Executing query [m8o63cgzq7c9xjza5em]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:30.851Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:30.853Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:21:30.909Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:21:30.916Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:21:30.917Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:21:30.918Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:21:30.918Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:21:30.918Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:31.110Z"}
{"level":"debug","message":"Executing query [m8o63cpryyoyyrqz87r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:31.167Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:31.279Z"}
{"level":"debug","message":"Executing query [m8o63cszc9byw69foz]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:21:31.283Z"}
{"level":"debug","message":"Executing query [m8o63ctb9w6wu6wdqnl]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742887291165\"]","timestamp":"2025-03-25T07:21:31.295Z"}
{"level":"debug","message":"Executing query [m8o63ctiyret049icsd]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742887291165\",\"TEST-OFI-FORENSE-1742887291165\",2616,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742887291165\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:21:31.302Z"}
{"level":"debug","message":"Executing query [m8o63ctryjcyiawrp8]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.311Z"}
{"level":"debug","message":"Executing query [m8o63ctyprdbayspye]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742887291165\"]","timestamp":"2025-03-25T07:21:31.318Z"}
{"level":"debug","message":"Executing query [m8o63cu29zmvhrxxmac]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",17]","timestamp":"2025-03-25T07:21:31.322Z"}
{"level":"debug","message":"Executing query [m8o63cunxir0rjzd6tt]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.343Z"}
{"level":"debug","message":"Executing query [m8o63curbjhs4vpwaag]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.347Z"}
{"level":"debug","message":"Executing query [m8o63cv0588ggur2hp9]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.356Z"}
{"level":"debug","message":"Executing query [m8o63cv44y1ybz5gvum]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.360Z"}
{"level":"debug","message":"Executing query [m8o63cv8k61xstz99t9]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.365Z"}
{"level":"debug","message":"Executing query [m8o63cvct3qd6t04e0h]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742887291368\",\"TEST-SP-OFI-FORENSE-1742887291368\",1881,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:21:31.368Z"}
{"level":"debug","message":"Executing query [m8o63cvpevuaz18jblo]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742887291368\"]","timestamp":"2025-03-25T07:21:31.381Z"}
{"level":"debug","message":"Executing query [m8o63cvtj5ycrglesq]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742887291368\"]","timestamp":"2025-03-25T07:21:31.385Z"}
{"level":"debug","message":"Executing query [m8o63cw22fr424wueuq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:31.394Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:31.398Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:31.692Z"}
{"level":"debug","message":"Executing query [m8o63d6k8jhvfp0qa59]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:31.772Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:31.854Z"}
{"level":"debug","message":"Executing query [m8o63d95tzs94u7n2f8]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:21:31.865Z"}
{"level":"debug","message":"Executing query [m8o63d9ce3djcud6yrt]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:21:31.872Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:21:31.876Z"}
{"level":"debug","message":"Executing query [m8o63d9gygsdqysifgi]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:21:31.876Z"}
{"level":"debug","message":"Executing query [m8o63d9ig616cnstg47]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:21:31.878Z"}
{"level":"debug","message":"Executing query [m8o63d9l3q80pxdv5s7]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:21:31.881Z"}
{"level":"debug","message":"Executing query [m8o63d9zne45ayzti1a]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.895Z"}
{"level":"debug","message":"Executing query [m8o63da3yz7829fm1ri]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.899Z"}
{"level":"debug","message":"Executing query [m8o63da7cnb0xtptvjk]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",17]","timestamp":"2025-03-25T07:21:31.903Z"}
{"level":"debug","message":"Executing query [m8o63dalv8ubww9l5gj]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.917Z"}
{"level":"debug","message":"Executing query [m8o63dapjnaagwhxc8]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.921Z"}
{"level":"debug","message":"Executing query [m8o63daw00v64rt2lmgv]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.929Z"}
{"level":"debug","message":"Executing query [m8o63db1wco9ite217n]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:31.933Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:31.937Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:31.971Z"}
{"level":"debug","message":"Executing query [m8o63de12ljenlt3wfs]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:32.042Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:32.111Z"}
{"level":"debug","message":"Executing query [m8o63dg6w7u5dl7ztmd]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:21:32.118Z"}
{"level":"debug","message":"Executing query [m8o63dguow3kpilhgul]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:21:32.142Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:32.135Z"}
{"level":"debug","message":"Executing query [m8o63dh086ku2vyjnpu]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:21:32.148Z"}
{"level":"debug","message":"Executing query [m8o63dh50mjvvl2y4ifl]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:21:32.153Z"}
{"level":"debug","message":"Executing query [m8o63dhdze2t3zekvc8]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:21:32.161Z"}
{"level":"debug","message":"Executing query [m8o63dhn8o7gppo9qfu]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[17,888,18,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:21:32.171Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:21:32.171Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 18, Área ID: 888, Rol ID: 888, Documento ID: 17","timestamp":"2025-03-25T07:21:32.179Z"}
{"level":"debug","message":"Executing query [m8o63dhx62nzm6j4xvf]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[17,18,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:21:32.181Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o63dhx62nzm6j4xvf]","params":"[17,18,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:21:32.188Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:21:32.188Z"}
{"level":"debug","message":"Executing query [m8o63di5b84as6953p]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[17]","timestamp":"2025-03-25T07:21:32.189Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o63di5b84as6953p]","params":"[17]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:21:32.194Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:21:32.194Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:21:32.194Z"}
{"level":"debug","message":"Executing query [m8o63dickj13uqf0bn]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[17,18,\"RESTAURAR\"]","timestamp":"2025-03-25T07:21:32.196Z"}
{"level":"debug","message":"Executing query [m8o63dgrmvwmzjtkmfr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:32.140Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:32.194Z"}
{"level":"debug","message":"Executing query [m8o63dieqrwpgvowa9]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:21:32.199Z"}
{"level":"debug","message":"Executing query [m8o63diiwmusk84bj0b]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[17]","timestamp":"2025-03-25T07:21:32.202Z"}
{"level":"debug","message":"Executing query [m8o63dilaeq8f3msrrf]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742887292137\"]","timestamp":"2025-03-25T07:21:32.205Z"}
{"level":"debug","message":"Executing query [m8o63dio22h9rg3o6o4]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[17,18,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:21:32.208Z"}
{"level":"debug","message":"Executing query [m8o63dipm0obyinxfvo]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742887292137\",\"TEST-OFI-QUIMICA-1742887292137\",4050,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:21:32.209Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o63dio22h9rg3o6o4]","params":"[17,18,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:21:32.214Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:21:32.214Z"}
{"level":"debug","message":"Executing query [m8o63diu01chqz6r7mim]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[17]","timestamp":"2025-03-25T07:21:32.214Z"}
{"level":"debug","message":"Executing query [m8o63diw0bruz5ieo67v]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.216Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o63diu01chqz6r7mim]","params":"[17]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:21:32.223Z"}
{"level":"debug","message":"Executing query [m8o63dj5kld02tuuob]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742887292137\"]","timestamp":"2025-03-25T07:21:32.225Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:21:32.224Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:21:32.224Z"}
{"level":"debug","message":"Executing query [m8o63dj5f58hnyx5jlm]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[17,888,18,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:21:32.225Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:21:32.225Z"}
{"level":"debug","message":"Executing query [m8o63dj8vujb7ploqk]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",9]","timestamp":"2025-03-25T07:21:32.228Z"}
{"level":"debug","message":"Executing query [m8o63dj9g5c9s5m431]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:21:32.229Z"}
{"level":"debug","message":"Executing query [m8o63djdz0btu18uooq]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[18,\"DOCUMENTO\",18,\"ELIMINAR\"]","timestamp":"2025-03-25T07:21:32.233Z"}
{"level":"debug","message":"Executing query [m8o63djdjfzhs977hs9]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.233Z"}
{"level":"debug","message":"Executing query [m8o63djgay4mxssoied]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.236Z"}
{"level":"debug","message":"Executing query [m8o63djh136edlqbskw]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.237Z"}
{"level":"debug","message":"Executing query [m8o63djtxv4296lcv7]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.249Z"}
{"level":"debug","message":"Executing query [m8o63djxkn2zmfdoqxs]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.253Z"}
{"level":"debug","message":"Executing query [m8o63djzxwlhsj6bx08]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:21:32.255Z"}
{"level":"debug","message":"Executing query [m8o63dk35k3scqhgmzk]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.259Z"}
{"level":"debug","message":"Executing query [m8o63dkb1jeuciejvmv]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:32.267Z"}
{"level":"debug","message":"Executing query [m8o63dke287tg80kvhej]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[17]","timestamp":"2025-03-25T07:21:32.270Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:32.271Z"}
{"level":"debug","message":"Executing query [m8o63dkkv8yzffwqz7]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:21:32.276Z"}
{"level":"debug","message":"Executing query [m8o63dklrjj2k7lm8v]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:21:32.277Z"}
{"level":"debug","message":"Executing query [m8o63dknmz334gbdes]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:21:32.279Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:21:32.283Z"}
{"level":"debug","message":"Executing query [m8o63dks2wp4bwauzap]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:32.284Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:32.287Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:32.239Z"}
{"level":"debug","message":"Executing query [m8o63dmgssrpcxlxgxd]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:32.344Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:32.427Z"}
{"level":"debug","message":"Executing query [m8o63dp0xjtkw9zftj]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742887292340\"]","timestamp":"2025-03-25T07:21:32.437Z"}
{"level":"debug","message":"Executing query [m8o63dp3runwsu866vo]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742887292340\",true]","timestamp":"2025-03-25T07:21:32.440Z"}
{"level":"debug","message":"Executing query [m8o63dpccirwssj4tka]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.448Z"}
{"level":"debug","message":"Executing query [m8o63dpgq0r3phjrtqc]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742887292340\"]","timestamp":"2025-03-25T07:21:32.453Z"}
{"level":"debug","message":"Executing query [m8o63dpjlr8rs9u4qpj]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",18]","timestamp":"2025-03-25T07:21:32.455Z"}
{"level":"debug","message":"Executing query [m8o63dpw02n4hmxzu3qj]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.468Z"}
{"level":"debug","message":"Executing query [m8o63dq1a3ln2510kvs]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.474Z"}
{"level":"debug","message":"Executing query [m8o63dq6ooybl90ok88]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.478Z"}
{"level":"debug","message":"Executing query [m8o63dqaktwrv1t8j1f]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.482Z"}
{"level":"debug","message":"Executing query [m8o63dqek2y0hnztinn]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.486Z"}
{"level":"debug","message":"Executing query [m8o63dqps0uhfle3jms]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.497Z"}
{"level":"debug","message":"Executing query [m8o63dqsn5f5mc2xbds]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:21:32.500Z"}
{"level":"debug","message":"Executing query [m8o63dqu317sqjwj0p9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:32.502Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:32.505Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:32.771Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:32.804Z"}
{"level":"debug","message":"Executing query [m8o63dzbxibmai3f4x]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:32.807Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:32.867Z"}
{"level":"debug","message":"Executing query [m8o63e14u8aske6hqb]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:21:32.872Z"}
{"level":"debug","message":"Executing query [m8o63e18qotmyt5xcvi]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:21:32.877Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:21:32.879Z"}
{"level":"debug","message":"Executing query [m8o63e1b8v5ql8uq4pw]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.879Z"}
{"level":"debug","message":"Executing query [m8o63e1ditjueg8qyts]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.881Z"}
{"level":"debug","message":"Executing query [m8o63e1g9q4qeamm0qa]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.884Z"}
{"level":"debug","message":"Executing query [m8o63e1k4c5zg297g0e]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:21:32.888Z"}
{"level":"debug","message":"Executing query [m8o63e1qzma8vr819l8]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[19]","timestamp":"2025-03-25T07:21:32.894Z"}
{"level":"debug","message":"Executing query [m8o63e1uzvig9govp]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.898Z"}
{"level":"debug","message":"Executing query [m8o63e1xl1wzsblm3v]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",19]","timestamp":"2025-03-25T07:21:32.901Z"}
{"level":"debug","message":"Executing query [m8o63e22bv0un3q3a3p]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[19]","timestamp":"2025-03-25T07:21:32.906Z"}
{"level":"debug","message":"Executing query [m8o63e25o9tvscxj9im]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[19]","timestamp":"2025-03-25T07:21:32.909Z"}
{"level":"debug","message":"Executing query [m8o63e2embd6zetp6xc]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[19]","timestamp":"2025-03-25T07:21:32.918Z"}
{"level":"debug","message":"Executing query [m8o63e2geo1sxpn7lfl]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.920Z"}
{"level":"debug","message":"Executing query [m8o63e2i599htfhzql6]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.922Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:21:32.924Z"}
{"level":"debug","message":"Executing query [m8o63e2l8z8tdwbs10q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:32.925Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:32.928Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:32.467Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:21:33.006Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:21:33.032Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:33.342Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:21:33.385Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:33.506Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:33.863Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:21:34.156Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:34.289Z"}
{"level":"debug","message":"Executing query [m8o63f5vxvs0ngrrur]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:21:34.340Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:34.386Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:35.232Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:35.333Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:35.490Z"}
{"duration":"30ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:21:35.494Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:21:35.492Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:35.497Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:21:35.503Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:35.508Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T07:24:38.801Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T07:24:38.806Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.811Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.878Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.885Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.899Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.906Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.914Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:39.023Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:39.033Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:39.037Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T07:25:45.050Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T07:25:45.055Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.060Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.122Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.130Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.145Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.161Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.168Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.272Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.286Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.290Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:26:38.309Z"}
{"level":"error","message":"Error al actualizar permiso contextual: No se proporcionaron datos para actualizar","timestamp":"2025-03-25T07:26:38.398Z"}
{"fatal":true,"level":"error","message":"Error al conectar a la base de datos: Encoding not recognized: 'cesu8' (searched as: 'cesu8')","stack":"Error: Encoding not recognized: 'cesu8' (searched as: 'cesu8')\n    at Object.getCodec (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:104:23)\n    at Object.getDecoder (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:125:23)\n    at Object.<anonymous>.exports.decode (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\parsers\\string.js:20:23)\n    at Packet.readNullTerminatedString (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\packet.js:414:25)\n    at Function.fromPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\handshake.js:62:33)\n    at ClientHandshake.handshakeInit (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\client_handshake.js:112:40)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:45:22)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:26:42.425Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:29:12.649Z"}
{"level":"error","message":"Error al actualizar permiso contextual: No se proporcionaron datos para actualizar","timestamp":"2025-03-25T07:29:12.712Z"}
{"fatal":true,"level":"error","message":"Error al conectar a la base de datos: Encoding not recognized: 'cesu8' (searched as: 'cesu8')","stack":"Error: Encoding not recognized: 'cesu8' (searched as: 'cesu8')\n    at Object.getCodec (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:104:23)\n    at Object.getDecoder (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:125:23)\n    at Object.<anonymous>.exports.decode (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\parsers\\string.js:20:23)\n    at Packet.readNullTerminatedString (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\packet.js:414:25)\n    at Function.fromPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\handshake.js:62:33)\n    at ClientHandshake.handshakeInit (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\client_handshake.js:112:40)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:45:22)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:29:16.576Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:32:27.878Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:04.998Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:25.319Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.595Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.604Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.607Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.614Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.617Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.629Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.632Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:33:56.642Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:33:56.644Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:33:56.648Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:33:56.651Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:33:56.652Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:56.870Z"}
{"level":"debug","message":"Executing query [m8o6jc5w9yfm9p2n6t]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:56.948Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:57.037Z"}
{"level":"debug","message":"Executing query [m8o6jc8ojyoy3n2r41e]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888036944\"]","timestamp":"2025-03-25T07:33:57.048Z"}
{"level":"debug","message":"Executing query [m8o6jc9981c6x94iw3d]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888036944\"]","timestamp":"2025-03-25T07:33:57.069Z"}
{"level":"debug","message":"Executing query [m8o6jc9bt3lk00h72y8]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742888036944\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:33:57.072Z"}
{"level":"debug","message":"Executing query [m8o6jc9rna1sv63yjgc]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.087Z"}
{"level":"debug","message":"Executing query [m8o6jca29h0f3isk4y]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888036944\"]","timestamp":"2025-03-25T07:33:57.098Z"}
{"level":"debug","message":"Executing query [m8o6jca7v9dzgfmmew]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1008]","timestamp":"2025-03-25T07:33:57.104Z"}
{"level":"debug","message":"Executing query [m8o6jcagp5qgkql01i8]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.112Z"}
{"level":"debug","message":"Executing query [m8o6jcal62vw7h9et5i]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.117Z"}
{"level":"debug","message":"Executing query [m8o6jcas8claws5oo2c]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.124Z"}
{"level":"debug","message":"Executing query [m8o6jcaxume25ie58h]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.130Z"}
{"level":"debug","message":"Executing query [m8o6jcb1lupjg837fs9]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.133Z"}
{"level":"debug","message":"Executing query [m8o6jcb6k5ql6yx2nz8]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.138Z"}
{"level":"debug","message":"Executing query [m8o6jcb9a3vgr0oqkam]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:33:57.141Z"}
{"level":"debug","message":"Executing query [m8o6jcbcr64rdcyvw1h]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:57.144Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:57.148Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.480Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.529Z"}
{"level":"debug","message":"Executing query [m8o6jcpmujy46l18yeq]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:33:57.658Z"}
{"level":"debug","message":"Executing query [m8o6jcppjs3uao2k0qa]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:33:57.661Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:57.664Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o6jcppjs3uao2k0qa]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:33:57.668Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:57.671Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.655Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.785Z"}
{"level":"debug","message":"Executing query [m8o6jcskgfmrts9gf5n]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:57.765Z"}
{"level":"debug","message":"Executing query [m8o6jctbfzc79noc4b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:57.791Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:57.826Z"}
{"level":"debug","message":"Executing query [m8o6jcubxpbclh9ajxj]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:33:57.827Z"}
{"level":"debug","message":"Executing query [m8o6jcugd8devl4f2i]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742888037789\"]","timestamp":"2025-03-25T07:33:57.832Z"}
{"level":"debug","message":"Executing query [m8o6jcuihc8rfl040tj]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742888037789\",\"TEST-OFI-FORENSE-1742888037789\",8352,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742888037789\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:33:57.835Z"}
{"level":"debug","message":"Executing query [m8o6jcusvyk85w4l06d]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.844Z"}
{"level":"debug","message":"Executing query [m8o6jcuxcshtgya9qc]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742888037789\"]","timestamp":"2025-03-25T07:33:57.849Z"}
{"level":"debug","message":"Executing query [m8o6jcv0hqhineev61i]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",19]","timestamp":"2025-03-25T07:33:57.852Z"}
{"level":"debug","message":"Executing query [m8o6jcv5lctjy3ul2i]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.857Z"}
{"level":"debug","message":"Executing query [m8o6jcv8wa4xql2a9ee]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.860Z"}
{"level":"debug","message":"Executing query [m8o6jcvdhdbxo7mkur8]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.865Z"}
{"level":"debug","message":"Executing query [m8o6jcvhharmp1wbe6m]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.869Z"}
{"level":"debug","message":"Executing query [m8o6jcvkum8vjz1vdah]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.873Z"}
{"level":"debug","message":"Executing query [m8o6jcvp26hnjm9spsf]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742888037877\",\"TEST-SP-OFI-FORENSE-1742888037877\",7780,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:33:57.877Z"}
{"level":"debug","message":"Executing query [m8o6jcvs4d56vc9zfbm]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742888037877\"]","timestamp":"2025-03-25T07:33:57.881Z"}
{"level":"debug","message":"Executing query [m8o6jcvvppfnnx2rlgp]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742888037877\"]","timestamp":"2025-03-25T07:33:57.883Z"}
{"level":"debug","message":"Executing query [m8o6jcw03tmuq2y03b5]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:57.888Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:57.890Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:33:57.852Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.490Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:57.910Z"}
{"level":"debug","message":"Executing query [m8o6jcwqvib8qcli40q]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:33:57.917Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:33:57.925Z"}
{"level":"debug","message":"Executing query [m8o6jcx54hnp7jc5q5k]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:33:57.929Z"}
{"level":"debug","message":"Executing query [m8o6jcx9uk1n74vniog]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:33:57.933Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:33:57.935Z"}
{"level":"debug","message":"Executing query [m8o6jcxcr6p8suvvpxs]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:33:57.936Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:33:57.938Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:33:57.725Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.840Z"}
{"level":"debug","message":"Executing query [m8o6jcxr3sj36c74wo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:57.951Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:58.020Z"}
{"level":"debug","message":"Executing query [m8o6jczyqjajtprvylj]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:33:58.031Z"}
{"level":"debug","message":"Executing query [m8o6jd2i8akhjry5i99]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742888037949\"]","timestamp":"2025-03-25T07:33:58.122Z"}
{"level":"debug","message":"Executing query [m8o6jd2v1j1v6i592tg]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742888037949\",\"TEST-OFICIO-1742888037949\",6138,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:33:58.135Z"}
{"level":"debug","message":"Executing query [m8o6jd34093m536328ge]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.144Z"}
{"level":"debug","message":"Executing query [m8o6jd3ajqqlta0tqu]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742888037949\"]","timestamp":"2025-03-25T07:33:58.150Z"}
{"level":"debug","message":"Executing query [m8o6jd3djyt9ica06p]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",19]","timestamp":"2025-03-25T07:33:58.154Z"}
{"level":"debug","message":"Executing query [m8o6jd3n4n39o07ao14]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.163Z"}
{"level":"debug","message":"Executing query [m8o6jd3qo29tv1849g]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.166Z"}
{"level":"debug","message":"Executing query [m8o6jd42hsa6idl8qp]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.178Z"}
{"level":"debug","message":"Executing query [m8o6jd45ducgsfrz7d]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.181Z"}
{"level":"debug","message":"Executing query [m8o6jd4bdvvbrue0jz]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.187Z"}
{"level":"debug","message":"Executing query [m8o6jd4dtbnwo8aq5ys]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742888038189\",\"TEST-SP-OFICIO-1742888038189\",3390,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:33:58.189Z"}
{"level":"debug","message":"Executing query [m8o6jd4j527e2b3ox43]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742888038189\"]","timestamp":"2025-03-25T07:33:58.195Z"}
{"level":"debug","message":"Executing query [m8o6jd4l09z0ytja81ud]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742888038189\"]","timestamp":"2025-03-25T07:33:58.197Z"}
{"level":"debug","message":"Executing query [m8o6jd4pdjkfxyvbfs8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:58.201Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:58.204Z"}
{"level":"debug","message":"Executing query [m8o6jczi5uieqyxfj2o]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:33:58.014Z"}
{"level":"debug","message":"Executing query [m8o6jczwpb4ghiyz5uf]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:33:58.029Z"}
{"level":"debug","message":"Executing query [m8o6jd4u8rbrnf26ww6]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[17]","timestamp":"2025-03-25T07:33:58.206Z"}
{"level":"debug","message":"Executing query [m8o6jd56j4upbiz8kyd]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:58.218Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:33:58.305Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:33:58.384Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:33:58.385Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:33:58.386Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:33:58.386Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:33:58.386Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:58.828Z"}
{"level":"debug","message":"Executing query [m8o6jdn1gzfrss4e8r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:58.861Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:58.879Z"}
{"level":"debug","message":"Executing query [m8o6jdnm8h8kierd65c]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:33:58.882Z"}
{"level":"debug","message":"Executing query [m8o6jdnocqdk8uhhn96]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:33:58.884Z"}
{"level":"debug","message":"Executing query [m8o6jdnr7wb396wdekk]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:33:58.887Z"}
{"level":"debug","message":"Executing query [m8o6jdntgmp8jysrml4]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:33:58.889Z"}
{"level":"debug","message":"Executing query [m8o6jdo2bremxfl287b]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:33:58.898Z"}
{"level":"debug","message":"Executing query [m8o6jdoa6nqwur2aoj8]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[19,888,20,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:33:58.906Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:33:58.906Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 20, Área ID: 888, Rol ID: 888, Documento ID: 19","timestamp":"2025-03-25T07:33:58.914Z"}
{"level":"debug","message":"Executing query [m8o6jdolbnumjkor1d]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[19,20,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:33:58.917Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6jdolbnumjkor1d]","params":"[19,20,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:33:58.925Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:33:58.926Z"}
{"level":"debug","message":"Executing query [m8o6jdou4kj2dcngof]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.927Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6jdou4kj2dcngof]","params":"[19]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:33:58.931Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:33:58.932Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:33:58.933Z"}
{"level":"debug","message":"Executing query [m8o6jdp2xr3gn4t80v]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[19,20,\"RESTAURAR\"]","timestamp":"2025-03-25T07:33:58.934Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:58.912Z"}
{"level":"debug","message":"Executing query [m8o6jdp8g568uf0iuu]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.940Z"}
{"level":"debug","message":"Executing query [m8o6jdpcq7ros0ron3l]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[19,20,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:33:58.944Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6jdpcq7ros0ron3l]","params":"[19,20,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:33:58.949Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:33:58.949Z"}
{"level":"debug","message":"Executing query [m8o6jdph6ph6r6f0i5]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.949Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6jdph6ph6r6f0i5]","params":"[19]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:33:58.953Z"}
{"level":"debug","message":"Executing query [m8o6jdoljmkul4fx9we]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:58.918Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:33:58.953Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:33:58.954Z"}
{"level":"debug","message":"Executing query [m8o6jdpnmickjvzkrb]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[19,888,20,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:33:58.955Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:33:58.955Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:58.955Z"}
{"level":"debug","message":"Executing query [m8o6jdpye4s3a6msb1g]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:33:58.966Z"}
{"level":"debug","message":"Executing query [m8o6jdq7zkwru76xkh]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:33:58.975Z"}
{"level":"debug","message":"Executing query [m8o6jdq95tzrxt2850y]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[20,\"DOCUMENTO\",20,\"ELIMINAR\"]","timestamp":"2025-03-25T07:33:58.977Z"}
{"level":"debug","message":"Executing query [m8o6jdqbrkh0gqi7sug]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:33:58.979Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:33:58.981Z"}
{"level":"debug","message":"Executing query [m8o6jdqemlz94x8bkmm]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:33:58.982Z"}
{"level":"debug","message":"Executing query [m8o6jdqgcfcs4m72wgd]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[20]","timestamp":"2025-03-25T07:33:58.984Z"}
{"level":"debug","message":"Executing query [m8o6jdqgpvja833a50b]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:33:58.984Z"}
{"level":"debug","message":"Executing query [m8o6jdqjgc23o01gg76]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:33:58.987Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:58.908Z"}
{"level":"debug","message":"Executing query [m8o6jdqmzcse6gkuv1o]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:33:58.990Z"}
{"level":"debug","message":"Executing query [m8o6jdqqlbl69z3lbdm]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-25T07:33:58.994Z"}
{"level":"debug","message":"Executing query [m8o6jdqrzba0bydgez]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.995Z"}
{"level":"debug","message":"Executing query [m8o6jdqvymxf35mw7y]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-25T07:33:58.999Z"}
{"level":"debug","message":"Executing query [m8o6jdqw0uwkkuweh6g8]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:33:59.001Z"}
{"level":"debug","message":"Executing query [m8o6jdqzc4mtrvdf0iw]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:33:59.003Z"}
{"level":"debug","message":"Executing query [m8o6jdqyjfqw0vg5sgq]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",20]","timestamp":"2025-03-25T07:33:59.003Z"}
{"level":"debug","message":"Executing query [m8o6jdr0lkmad30huso]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:33:59.004Z"}
{"level":"debug","message":"Executing query [m8o6jdr3kufcp8pe3ba]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.007Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:33:59.009Z"}
{"level":"debug","message":"Executing query [m8o6jdr6y6mt8jo7so]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.010Z"}
{"level":"debug","message":"Executing query [m8o6jdr5kuzrmb367t]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:59.009Z"}
{"level":"debug","message":"Executing query [m8o6jdr98r1pl07x519]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.013Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:59.012Z"}
{"level":"debug","message":"Executing query [m8o6jdrb90wdmhsjfub]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:59.015Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:59.017Z"}
{"level":"debug","message":"Executing query [m8o6jdqcryl1im6w6yi]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:58.981Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:59.042Z"}
{"level":"debug","message":"Executing query [m8o6jdslzeekji9ya2]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742888038978\"]","timestamp":"2025-03-25T07:33:59.062Z"}
{"level":"debug","message":"Executing query [m8o6jdsrbk0fdsqpvea]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742888038978\",true]","timestamp":"2025-03-25T07:33:59.067Z"}
{"level":"debug","message":"Executing query [m8o6jdswfo5el8an02]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.072Z"}
{"level":"debug","message":"Executing query [m8o6jdt3x0imuwfrih]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742888038978\"]","timestamp":"2025-03-25T07:33:59.079Z"}
{"level":"debug","message":"Executing query [m8o6jdt5a7e3scfpinr]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",20]","timestamp":"2025-03-25T07:33:59.081Z"}
{"level":"debug","message":"Executing query [m8o6jdtcl29h0njebdg]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.089Z"}
{"level":"debug","message":"Executing query [m8o6jdth97pu04lm18]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.094Z"}
{"level":"debug","message":"Executing query [m8o6jdtm0x3g53ogi4fh]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.098Z"}
{"level":"debug","message":"Executing query [m8o6jdtrm7kl4lv27rp]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.103Z"}
{"level":"debug","message":"Executing query [m8o6jdtvnf77s0v7x4f]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.107Z"}
{"level":"debug","message":"Executing query [m8o6jdu4o85ldenyxcm]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.117Z"}
{"level":"debug","message":"Executing query [m8o6jdu83gba4k5leqn]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:33:59.120Z"}
{"level":"debug","message":"Executing query [m8o6jduaxex50gpf55a]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:59.122Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:59.125Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:59.216Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:59.898Z"}
{"level":"debug","message":"Executing query [m8o6jeiv5j1b4l87v9s]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:00.008Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:00.098Z"}
{"level":"debug","message":"Executing query [m8o6jelw45zg8bi2qr2]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:00.116Z"}
{"level":"debug","message":"Executing query [m8o6jem4mho4ui09uto]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742888040005\"]","timestamp":"2025-03-25T07:34:00.124Z"}
{"level":"debug","message":"Executing query [m8o6jem7v94g3i0gzim]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742888040005\",\"TEST-OFI-QUIMICA-1742888040005\",7599,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:34:00.127Z"}
{"level":"debug","message":"Executing query [m8o6jemgrk7b16oso0m]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.136Z"}
{"level":"debug","message":"Executing query [m8o6jemmfc8ewjf11xb]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742888040005\"]","timestamp":"2025-03-25T07:34:00.142Z"}
{"level":"debug","message":"Executing query [m8o6jempnsgsq70jmeh]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",10]","timestamp":"2025-03-25T07:34:00.145Z"}
{"level":"debug","message":"Executing query [m8o6jemvnp6p7lw3wg]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.151Z"}
{"level":"debug","message":"Executing query [m8o6jen05g57qoe9hi4]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.157Z"}
{"level":"debug","message":"Executing query [m8o6jen62wod4o8k5eg]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.162Z"}
{"level":"debug","message":"Executing query [m8o6jena177uf2jzub5]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.166Z"}
{"level":"debug","message":"Executing query [m8o6jenjxct01fsvwh]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.175Z"}
{"level":"debug","message":"Executing query [m8o6jenl9euy925k2x8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:00.177Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:00.181Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:00.322Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:00.353Z"}
{"level":"debug","message":"Executing query [m8o6jesk7qk0dzq7h]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:00.358Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:00.431Z"}
{"level":"debug","message":"Executing query [m8o6jeupi97ex8b57k]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:34:00.433Z"}
{"level":"debug","message":"Executing query [m8o6jeuysl4esnaquj]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:34:00.442Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:34:00.444Z"}
{"level":"debug","message":"Executing query [m8o6jev1s7m7uw0np5]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.445Z"}
{"level":"debug","message":"Executing query [m8o6jev3hoey5xtg7p9]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.447Z"}
{"level":"debug","message":"Executing query [m8o6jev6tn5qdm2mvzq]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.450Z"}
{"level":"debug","message":"Executing query [m8o6jevam4xuy6vajc]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:34:00.454Z"}
{"level":"debug","message":"Executing query [m8o6jevgz8vdvy2cfe]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[21]","timestamp":"2025-03-25T07:34:00.460Z"}
{"level":"debug","message":"Executing query [m8o6jevmwfhmnjff9dj]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.466Z"}
{"level":"debug","message":"Executing query [m8o6jevpdj2v2p2sol]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",21]","timestamp":"2025-03-25T07:34:00.469Z"}
{"level":"debug","message":"Executing query [m8o6jevsvn7o3myegx]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[21]","timestamp":"2025-03-25T07:34:00.472Z"}
{"level":"debug","message":"Executing query [m8o6jevwkww9jogy1eq]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[21]","timestamp":"2025-03-25T07:34:00.476Z"}
{"level":"debug","message":"Executing query [m8o6jew0x0or29j6qsi]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[21]","timestamp":"2025-03-25T07:34:00.480Z"}
{"level":"debug","message":"Executing query [m8o6jew2y4qo719pn7q]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.482Z"}
{"level":"debug","message":"Executing query [m8o6jew4b2eifapsp19]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.484Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:34:00.485Z"}
{"level":"debug","message":"Executing query [m8o6jew6m8u618ip3fq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:00.486Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:00.490Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:59.940Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:34:00.615Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:34:00.666Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:01.050Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:34:01.072Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:01.151Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:01.289Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:34:01.526Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:01.678Z"}
{"level":"debug","message":"Executing query [m8o6jfugpi2krn2zly]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:34:01.721Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:01.757Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:02.516Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:02.550Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:02.707Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:34:02.709Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:02.732Z"}
{"duration":"28ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:34:02.735Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:34:02.739Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:02.747Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.859Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.872Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.875Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.879Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.887Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.914Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.917Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:34:48.926Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:34:48.928Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:34:48.930Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:34:48.932Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:34:48.936Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:49.225Z"}
{"level":"debug","message":"Executing query [m8o6kgk6dwgxmf6h4d]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:49.302Z"}
{"level":"debug","message":"Executing query [m8o6kgnxuw5db301vrg]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888089292\"]","timestamp":"2025-03-25T07:34:49.437Z"}
{"level":"debug","message":"Executing query [m8o6kgozcezvrhvc74]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888089292\"]","timestamp":"2025-03-25T07:34:49.475Z"}
{"level":"debug","message":"Executing query [m8o6kgp27ndhgq6zkv3]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742888089292\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:34:49.478Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:49.484Z"}
{"level":"debug","message":"Executing query [m8o6kgptb210u259y9o]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.505Z"}
{"level":"debug","message":"Executing query [m8o6kgqr98u5d238a8m]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888089292\"]","timestamp":"2025-03-25T07:34:49.539Z"}
{"level":"debug","message":"Executing query [m8o6kgqvlnok77gobkr]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1009]","timestamp":"2025-03-25T07:34:49.543Z"}
{"level":"debug","message":"Executing query [m8o6kgr808uhav3eycsm]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.556Z"}
{"level":"debug","message":"Executing query [m8o6kgred2juz2wdki]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.562Z"}
{"level":"debug","message":"Executing query [m8o6kgs0dtdk2uhbk9g]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.584Z"}
{"level":"debug","message":"Executing query [m8o6kgsb0p3546p1s9x]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.596Z"}
{"level":"debug","message":"Executing query [m8o6kgsmuoziqk30kb]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.606Z"}
{"level":"debug","message":"Executing query [m8o6kgssbqnsixzdul9]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.612Z"}
{"level":"debug","message":"Executing query [m8o6kgsv5wdgyivpeed]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:34:49.615Z"}
{"level":"debug","message":"Executing query [m8o6kgsye7xaipgwad6]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:49.618Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:49.623Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:49.629Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:49.350Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:49.664Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:49.751Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:34:49.679Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:49.842Z"}
{"level":"debug","message":"Executing query [m8o6kgztqynl7orekzi]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:34:49.865Z"}
{"level":"debug","message":"Executing query [m8o6kh01git82qq7iie]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:34:49.874Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o6kh01git82qq7iie]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:34:49.884Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:49.887Z"}
{"level":"debug","message":"Executing query [m8o6kgy706sbttl8t1du]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:49.808Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:49.896Z"}
{"level":"debug","message":"Executing query [m8o6kh0yu9z8slgqaog]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:49.907Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:34:49.929Z"}
{"level":"debug","message":"Executing query [m8o6kh1makn8q1e6tzb]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:34:49.930Z"}
{"level":"debug","message":"Executing query [m8o6kh1pg0fjde8zubq]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:34:49.933Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:34:49.935Z"}
{"level":"debug","message":"Executing query [m8o6kh1sj8id00za15]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:49.936Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:34:49.939Z"}
{"level":"debug","message":"Executing query [m8o6kh4kvy27apo1hd]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:34:50.036Z"}
{"level":"debug","message":"Executing query [m8o6kh51taks92y4ls]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:34:50.054Z"}
{"level":"debug","message":"Executing query [m8o6kh54cmlwlic11i]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[19]","timestamp":"2025-03-25T07:34:50.057Z"}
{"level":"debug","message":"Executing query [m8o6kh5hzxrh0t7nm3]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:50.069Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:50.169Z"}
{"level":"debug","message":"Executing query [m8o6kh8mm5nab9g950q]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:50.182Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:50.217Z"}
{"level":"debug","message":"Executing query [m8o6kh9o5p8jrgmqjbb]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:50.220Z"}
{"level":"debug","message":"Executing query [m8o6kh9qrvucmwadsf]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742888090181\"]","timestamp":"2025-03-25T07:34:50.222Z"}
{"level":"debug","message":"Executing query [m8o6kh9sdfpo71mz0n]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742888090181\",\"TEST-OFICIO-1742888090181\",4826,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:34:50.224Z"}
{"level":"debug","message":"Executing query [m8o6kha01u9ikrfhye1]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.232Z"}
{"level":"debug","message":"Executing query [m8o6kha5fniccgnkvl5]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742888090181\"]","timestamp":"2025-03-25T07:34:50.238Z"}
{"level":"debug","message":"Executing query [m8o6khabiyn47rvx0i]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",21]","timestamp":"2025-03-25T07:34:50.243Z"}
{"level":"debug","message":"Executing query [m8o6khagqxaxiyg8dpo]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.248Z"}
{"level":"debug","message":"Executing query [m8o6khaju1f9byyt19f]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.251Z"}
{"level":"debug","message":"Executing query [m8o6khaw96qohk9ff6u]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.264Z"}
{"level":"debug","message":"Executing query [m8o6khb05rw1tseko6g]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.268Z"}
{"level":"debug","message":"Executing query [m8o6khb884m3dvl91pn]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.276Z"}
{"level":"debug","message":"Executing query [m8o6khbbfgtdhkfrc]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742888090279\",\"TEST-SP-OFICIO-1742888090279\",5435,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:34:50.279Z"}
{"level":"debug","message":"Executing query [m8o6khbi68edywlkj1k]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742888090279\"]","timestamp":"2025-03-25T07:34:50.286Z"}
{"level":"debug","message":"Executing query [m8o6khbkwsfl7cjk72]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742888090279\"]","timestamp":"2025-03-25T07:34:50.288Z"}
{"level":"debug","message":"Executing query [m8o6khboffbu2kx2u7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:50.292Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:50.294Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:50.282Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:34:50.217Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:34:50.358Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:34:50.368Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:34:50.368Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:34:50.371Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:34:50.380Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:34:50.380Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Executing query [m8o6khcznxn9lpgiu2]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:50.339Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:50.418Z"}
{"level":"debug","message":"Executing query [m8o6khfasap2vczmgq8]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:50.423Z"}
{"level":"debug","message":"Executing query [m8o6khfgfx0tf1gf92a]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742888090337\"]","timestamp":"2025-03-25T07:34:50.428Z"}
{"level":"debug","message":"Executing query [m8o6khfj1yec1miu8d3]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742888090337\",\"TEST-OFI-FORENSE-1742888090337\",4455,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742888090337\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:34:50.431Z"}
{"level":"debug","message":"Executing query [m8o6khfvue2okgt2b6]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.443Z"}
{"level":"debug","message":"Executing query [m8o6khg2um0lgi8zc4o]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742888090337\"]","timestamp":"2025-03-25T07:34:50.450Z"}
{"level":"debug","message":"Executing query [m8o6khg7vjiy09q8qps]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",21]","timestamp":"2025-03-25T07:34:50.456Z"}
{"level":"debug","message":"Executing query [m8o6khghhdcl55lhi9h]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.465Z"}
{"level":"debug","message":"Executing query [m8o6khgmd3tru6lfhle]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.470Z"}
{"level":"debug","message":"Executing query [m8o6khgq43enbct4ekg]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.474Z"}
{"level":"debug","message":"Executing query [m8o6khgtq59fnxdelx]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.477Z"}
{"level":"debug","message":"Executing query [m8o6khgzfg488ztsoe4]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.483Z"}
{"level":"debug","message":"Executing query [m8o6khh3vxtarxc87cg]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742888090487\",\"TEST-SP-OFI-FORENSE-1742888090487\",7587,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:34:50.487Z"}
{"level":"debug","message":"Executing query [m8o6khh78grrik1sro]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742888090487\"]","timestamp":"2025-03-25T07:34:50.491Z"}
{"level":"debug","message":"Executing query [m8o6khha8kyzly6cgb5]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742888090487\"]","timestamp":"2025-03-25T07:34:50.494Z"}
{"level":"debug","message":"Executing query [m8o6khhepzpwigxs6l]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:50.498Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:50.501Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:50.938Z"}
{"level":"debug","message":"Executing query [m8o6khtrny7sjdo8y2b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:50.943Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:50.963Z"}
{"level":"debug","message":"Executing query [m8o6khud5p890cyvxm4]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:34:50.966Z"}
{"level":"debug","message":"Executing query [m8o6khufon1wgs4x7p]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:34:50.968Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:34:50.970Z"}
{"level":"debug","message":"Executing query [m8o6khuibpki6puwbs5]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:34:50.970Z"}
{"level":"debug","message":"Executing query [m8o6khujqd3we6qh59p]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:34:50.972Z"}
{"level":"debug","message":"Executing query [m8o6khummvhskzvikv]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:34:50.974Z"}
{"level":"debug","message":"Executing query [m8o6khv3ecjicdogso9]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.991Z"}
{"level":"debug","message":"Executing query [m8o6khvdaxh1ghxhqwd]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.001Z"}
{"level":"debug","message":"Executing query [m8o6khvjj9l65x76d6]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",21]","timestamp":"2025-03-25T07:34:51.007Z"}
{"level":"debug","message":"Executing query [m8o6khvpf857rr6eb4]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.013Z"}
{"level":"debug","message":"Executing query [m8o6khvtmnc1unbf6lc]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.017Z"}
{"level":"debug","message":"Executing query [m8o6khvz35ifaluk8rc]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.023Z"}
{"level":"debug","message":"Executing query [m8o6khw18elmmojno4y]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:51.026Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:51.036Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:51.131Z"}
{"level":"debug","message":"Executing query [m8o6ki19hobdi7zo8sc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:51.214Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:51.153Z"}
{"level":"debug","message":"Executing query [m8o6ki4e30x003xzfj6]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742888091210\"]","timestamp":"2025-03-25T07:34:51.327Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:51.331Z"}
{"level":"debug","message":"Executing query [m8o6ki4nj99kcawht]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742888091210\",true]","timestamp":"2025-03-25T07:34:51.335Z"}
{"level":"debug","message":"Executing query [m8o6ki51zyr2ni7q83d]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.349Z"}
{"level":"debug","message":"Executing query [m8o6ki58rzkaisn0t88]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742888091210\"]","timestamp":"2025-03-25T07:34:51.356Z"}
{"level":"debug","message":"Executing query [m8o6ki5bxuc0fgmo32o]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",21]","timestamp":"2025-03-25T07:34:51.359Z"}
{"level":"debug","message":"Executing query [m8o6ki5h69godxwc67n]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.365Z"}
{"level":"debug","message":"Executing query [m8o6ki5kazxtvc3m3rm]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.368Z"}
{"level":"debug","message":"Executing query [m8o6ki5s2z5hx6e2u8y]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.377Z"}
{"level":"debug","message":"Executing query [m8o6ki5ykarh4wgr9p]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.382Z"}
{"level":"debug","message":"Executing query [m8o6ki62upmytegjdnk]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.386Z"}
{"level":"debug","message":"Executing query [m8o6ki69o7kekni9n9b]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.394Z"}
{"level":"debug","message":"Executing query [m8o6ki6c7ctocpa1nl7]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:34:51.396Z"}
{"level":"debug","message":"Executing query [m8o6ki6eqsny3x6bl4]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:51.399Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:51.404Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:51.537Z"}
{"level":"debug","message":"Executing query [m8o6kiae66bd3u9bs2m]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:51.543Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:51.596Z"}
{"level":"debug","message":"Executing query [m8o6kic0cb0qc8nmgyt]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:51.600Z"}
{"level":"debug","message":"Executing query [m8o6kicdqqgeef3hg5d]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742888091540\"]","timestamp":"2025-03-25T07:34:51.613Z"}
{"level":"debug","message":"Executing query [m8o6kichlnfwmbmp24o]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742888091540\",\"TEST-OFI-QUIMICA-1742888091540\",6828,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:34:51.617Z"}
{"level":"debug","message":"Executing query [m8o6kicqvjoalr2suv]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.626Z"}
{"level":"debug","message":"Executing query [m8o6kicuz9gaap8m3o]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742888091540\"]","timestamp":"2025-03-25T07:34:51.630Z"}
{"level":"debug","message":"Executing query [m8o6kicy86k5lbctc6h]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",11]","timestamp":"2025-03-25T07:34:51.634Z"}
{"level":"debug","message":"Executing query [m8o6kid3eo71t6n61p]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.640Z"}
{"level":"debug","message":"Executing query [m8o6kid7d3xhn8z4qj]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.643Z"}
{"level":"debug","message":"Executing query [m8o6kidc9dhhltktuy]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.648Z"}
{"level":"debug","message":"Executing query [m8o6kidi2m4jzwwq0vf]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.654Z"}
{"level":"debug","message":"Executing query [m8o6kidrh9ymdew1ydt]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.664Z"}
{"level":"debug","message":"Executing query [m8o6kidwpupn0tzfq2]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:51.668Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:51.671Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:51.540Z"}
{"level":"debug","message":"Executing query [m8o6kid9aa2rq5nb4r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:51.645Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:51.762Z"}
{"level":"debug","message":"Executing query [m8o6kigoejq975p1jy]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:34:51.768Z"}
{"level":"debug","message":"Executing query [m8o6kihgwii5iljg35]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:34:51.796Z"}
{"level":"debug","message":"Executing query [m8o6kihpwmb908zw2t]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:34:51.805Z"}
{"level":"debug","message":"Executing query [m8o6kihsd7vna2v594n]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:34:51.808Z"}
{"level":"debug","message":"Executing query [m8o6kii18uefircw8vr]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:34:51.817Z"}
{"level":"debug","message":"Executing query [m8o6kii6jxvjxbqo7ra]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[22,888,22,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:34:51.822Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:34:51.822Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 22, Área ID: 888, Rol ID: 888, Documento ID: 21","timestamp":"2025-03-25T07:34:51.827Z"}
{"level":"debug","message":"Executing query [m8o6kiicof4i9kxe8os]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[21,22,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:34:51.828Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6kiicof4i9kxe8os]","params":"[21,22,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:34:51.838Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:34:51.839Z"}
{"level":"debug","message":"Executing query [m8o6kiin4hikcavqjhd]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.839Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6kiin4hikcavqjhd]","params":"[21]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:34:51.846Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:34:51.847Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:34:51.847Z"}
{"level":"debug","message":"Executing query [m8o6kiiwxw2vh7cltaq]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[21,22,\"RESTAURAR\"]","timestamp":"2025-03-25T07:34:51.848Z"}
{"level":"debug","message":"Executing query [m8o6kij9rpcvwfcajfc]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.861Z"}
{"level":"debug","message":"Executing query [m8o6kijgo08c71w8369]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[21,22,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:34:51.868Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6kijgo08c71w8369]","params":"[21,22,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:34:51.873Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:34:51.873Z"}
{"level":"debug","message":"Executing query [m8o6kijmfpysotzw91]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.874Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6kijmfpysotzw91]","params":"[21]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:34:51.877Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:34:51.877Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:34:51.877Z"}
{"level":"debug","message":"Executing query [m8o6kijsd38abv6v6aj]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[22,888,22,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:34:51.880Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:34:51.880Z"}
{"level":"debug","message":"Executing query [m8o6kijzz7t158io9gr]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:34:51.887Z"}
{"level":"debug","message":"Executing query [m8o6kik34wy3cp9d57]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[22,\"DOCUMENTO\",22,\"ELIMINAR\"]","timestamp":"2025-03-25T07:34:51.891Z"}
{"level":"debug","message":"Executing query [m8o6kik8pyk8r1nxmxk]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[22]","timestamp":"2025-03-25T07:34:51.896Z"}
{"level":"debug","message":"Executing query [m8o6kikegrqfvpwyo0m]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:34:51.902Z"}
{"level":"debug","message":"Executing query [m8o6kikk6qto492n3z]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[22]","timestamp":"2025-03-25T07:34:51.908Z"}
{"level":"debug","message":"Executing query [m8o6kikqirvrq9eilnp]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:34:51.914Z"}
{"level":"debug","message":"Executing query [m8o6kiks6gl5op035ie]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:34:51.916Z"}
{"level":"debug","message":"Executing query [m8o6kikuh816om944x]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:34:51.918Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:34:51.924Z"}
{"level":"debug","message":"Executing query [m8o6kil0ajdu6h8pgg7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:51.924Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:51.927Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:52.160Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:52.198Z"}
{"level":"debug","message":"Executing query [m8o6kissbuexrzrk6h5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:52.204Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:52.270Z"}
{"level":"debug","message":"Executing query [m8o6kiun9yb4n24kksi]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:34:52.271Z"}
{"level":"debug","message":"Executing query [m8o6kiuqusjvyinotxc]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:34:52.274Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:34:52.276Z"}
{"level":"debug","message":"Executing query [m8o6kiuslsvv3efyipd]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.276Z"}
{"level":"debug","message":"Executing query [m8o6kiuuvoiffzpk07]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.278Z"}
{"level":"debug","message":"Executing query [m8o6kiuxoaespwcq65]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.281Z"}
{"level":"debug","message":"Executing query [m8o6kiv19ltqb76c08n]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:34:52.285Z"}
{"level":"debug","message":"Executing query [m8o6kiv8ggerv6yprld]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[23]","timestamp":"2025-03-25T07:34:52.292Z"}
{"level":"debug","message":"Executing query [m8o6kivcnbj9vzydwc]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.296Z"}
{"level":"debug","message":"Executing query [m8o6kivf0mcfffstqkf]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",23]","timestamp":"2025-03-25T07:34:52.299Z"}
{"level":"debug","message":"Executing query [m8o6kivkzm59mejb148]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[23]","timestamp":"2025-03-25T07:34:52.304Z"}
{"level":"debug","message":"Executing query [m8o6kivpu238k147mds]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[23]","timestamp":"2025-03-25T07:34:52.309Z"}
{"level":"debug","message":"Executing query [m8o6kivvsl5n4io7ay]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[23]","timestamp":"2025-03-25T07:34:52.315Z"}
{"level":"debug","message":"Executing query [m8o6kivza74gaw8swic]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.319Z"}
{"level":"debug","message":"Executing query [m8o6kiw1bngghukdytt]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.321Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:34:52.324Z"}
{"level":"debug","message":"Executing query [m8o6kiw51vrqohq674w]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:52.325Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:52.326Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:52.036Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:34:52.608Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:34:52.645Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:52.950Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:34:52.965Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:53.071Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:53.334Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:34:53.620Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:53.808Z"}
{"level":"debug","message":"Executing query [m8o6kk2k3wdr181r977]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:34:53.852Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:53.918Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:54.564Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:54.796Z"}
{"duration":"33ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:34:54.799Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:34:54.810Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:54.820Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:54.807Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:55.006Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:34:55.008Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:43:21.446Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.620Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.641Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.645Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.648Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.651Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.654Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.656Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:52:49.660Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:52:49.662Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:52:49.664Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:52:49.665Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:52:49.667Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.101Z"}
{"level":"debug","message":"Executing query [m8o77mk0u5tqays8k5d]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:50.160Z"}
{"level":"debug","message":"Executing query [m8o77mlrn74nlg2j4xo]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889170156\"]","timestamp":"2025-03-25T07:52:50.224Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:50.226Z"}
{"level":"debug","message":"Executing query [m8o77mmmrleo18ufxe]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889170156\"]","timestamp":"2025-03-25T07:52:50.254Z"}
{"level":"debug","message":"Executing query [m8o77mmpcziuu8tlfb5]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742889170156\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:52:50.257Z"}
{"level":"debug","message":"Executing query [m8o77mmza3hkw97cvdn]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.267Z"}
{"level":"debug","message":"Executing query [m8o77mn4ht3a6hmpa7]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889170156\"]","timestamp":"2025-03-25T07:52:50.272Z"}
{"level":"debug","message":"Executing query [m8o77mnae24ohu0od]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1010]","timestamp":"2025-03-25T07:52:50.278Z"}
{"level":"debug","message":"Executing query [m8o77mnj24fq56u29ff]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.287Z"}
{"level":"debug","message":"Executing query [m8o77mnnlgd9l0sp89]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.292Z"}
{"level":"debug","message":"Executing query [m8o77mnse2d2yf0a87i]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.296Z"}
{"level":"debug","message":"Executing query [m8o77mnvmbrxdmqkg6]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.300Z"}
{"level":"debug","message":"Executing query [m8o77mnyw94r31a9tf]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.302Z"}
{"level":"debug","message":"Executing query [m8o77mo3fuaufmwblcq]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.307Z"}
{"level":"debug","message":"Executing query [m8o77mo6c9qtnvw5f8h]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:52:50.310Z"}
{"level":"debug","message":"Executing query [m8o77mo8cughvvzyt45]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:50.312Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:50.315Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.289Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.361Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:50.477Z"}
{"level":"debug","message":"Executing query [m8o77msyujl9fgl40ne]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:52:50.482Z"}
{"level":"debug","message":"Executing query [m8o77mt2p5nu385qss8]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:52:50.486Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o77mt2p5nu385qss8]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:52:50.491Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:50.494Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.517Z"}
{"level":"debug","message":"Executing query [m8o77mvg83o5zzeqiy]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:50.573Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:50.641Z"}
{"level":"debug","message":"Executing query [m8o77mxhz6uogh2wieh]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:52:50.645Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:52:50.651Z"}
{"level":"debug","message":"Executing query [m8o77mxo9g9196fhekl]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:52:50.652Z"}
{"level":"debug","message":"Executing query [m8o77mxq77txieaydu3]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:52:50.654Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:52:50.656Z"}
{"level":"debug","message":"Executing query [m8o77mxt96ssdlibtgl]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:52:50.657Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:52:50.660Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:52:50.551Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.446Z"}
{"level":"debug","message":"Executing query [m8o77n03fnhbogiaqri]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:52:50.739Z"}
{"level":"debug","message":"Executing query [m8o77n0igwrgb9gxmi]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:52:50.755Z"}
{"level":"debug","message":"Executing query [m8o77n0lv685jraeue]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[21]","timestamp":"2025-03-25T07:52:50.757Z"}
{"level":"debug","message":"Executing query [m8o77n0r8mwnkx9stsy]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:50.763Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.842Z"}
{"level":"debug","message":"Executing query [m8o77n55yriod4vra4b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:50.921Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.934Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:52:50.825Z"}
{"level":"debug","message":"Executing query [m8o77n5vp4reh4ura7]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:50.947Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:50.978Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:50.982Z"}
{"level":"debug","message":"Executing query [m8o77n6ta4ucmolula9]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:52:50.981Z"}
{"level":"debug","message":"Executing query [m8o77n6wj0d11rx9qhf]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889170944\"]","timestamp":"2025-03-25T07:52:50.984Z"}
{"level":"debug","message":"Executing query [m8o77n70gf14vgsk8zw]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742889170944\",\"TEST-OFI-FORENSE-1742889170944\",3680,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742889170944\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:52:50.988Z"}
{"level":"debug","message":"Executing query [m8o77n78h5b91ul4n5a]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:50.996Z"}
{"level":"debug","message":"Executing query [m8o77n6zen3gvm5b5pm]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:52:50.987Z"}
{"level":"debug","message":"Executing query [m8o77n76ey3jy1vg0jc]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889170919\"]","timestamp":"2025-03-25T07:52:50.994Z"}
{"level":"debug","message":"Executing query [m8o77n7d1udqmrcknau]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889170944\"]","timestamp":"2025-03-25T07:52:51.001Z"}
{"level":"debug","message":"Executing query [m8o77n7cmnew1guw4wh]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742889170919\",\"TEST-OFICIO-1742889170919\",5914,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:52:51.000Z"}
{"level":"debug","message":"Executing query [m8o77n7lfno6go2vyd]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.009Z"}
{"level":"debug","message":"Executing query [m8o77n7mnmetmw5rujb]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",23]","timestamp":"2025-03-25T07:52:51.011Z"}
{"level":"debug","message":"Executing query [m8o77n7svggw1y0dmr]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.017Z"}
{"level":"debug","message":"Executing query [m8o77n7shsx6lau73w8]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889170919\"]","timestamp":"2025-03-25T07:52:51.016Z"}
{"level":"debug","message":"Executing query [m8o77n7v6jrdvw8a4rx]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.019Z"}
{"level":"debug","message":"Executing query [m8o77n7vflvglty1q77]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",23]","timestamp":"2025-03-25T07:52:51.019Z"}
{"level":"debug","message":"Executing query [m8o77n7z031h17veihly]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.023Z"}
{"level":"debug","message":"Executing query [m8o77n80likm4eaqh1]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.024Z"}
{"level":"debug","message":"Executing query [m8o77n82fbcrzehgv7k]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.026Z"}
{"level":"debug","message":"Executing query [m8o77n8413psfx2og23]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.028Z"}
{"level":"debug","message":"Executing query [m8o77n86d3gx76tceks]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.030Z"}
{"level":"debug","message":"Executing query [m8o77n89xtq92py16wo]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.033Z"}
{"level":"debug","message":"Executing query [m8o77n8ayocf528btw]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742889171034\",\"TEST-SP-OFI-FORENSE-1742889171034\",3310,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:52:51.034Z"}
{"level":"debug","message":"Executing query [m8o77n8dzruaojl6849]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.037Z"}
{"level":"debug","message":"Executing query [m8o77n8hgz7teju4c9n]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889171034\"]","timestamp":"2025-03-25T07:52:51.041Z"}
{"level":"debug","message":"Executing query [m8o77n8ioflr2ite84q]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.042Z"}
{"level":"debug","message":"Executing query [m8o77n8j8h95qkzyh8j]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889171034\"]","timestamp":"2025-03-25T07:52:51.043Z"}
{"level":"debug","message":"Executing query [m8o77n8lsuacfd92xai]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742889171045\",\"TEST-SP-OFICIO-1742889171045\",7864,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:52:51.045Z"}
{"level":"debug","message":"Executing query [m8o77n8n9pnqpih3zh]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:51.047Z"}
{"level":"debug","message":"Executing query [m8o77n8p5ug9nqih89t]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889171045\"]","timestamp":"2025-03-25T07:52:51.049Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:51.049Z"}
{"level":"debug","message":"Executing query [m8o77n8rrmjvzosf7zi]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889171045\"]","timestamp":"2025-03-25T07:52:51.051Z"}
{"level":"debug","message":"Executing query [m8o77n8yz1wbyv3z8vr]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:51.058Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:51.061Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:52:51.199Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:52:51.201Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:52:51.202Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:52:51.203Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:52:51.207Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:52:51.207Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:51.785Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:51.724Z"}
{"level":"debug","message":"Executing query [m8o77nt9iyk0ohwqyl]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:51.789Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:51.808Z"}
{"level":"debug","message":"Executing query [m8o77ntwx867v5avzwa]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:52:51.812Z"}
{"level":"debug","message":"Executing query [m8o77ntz2po2nrtaov6]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:52:51.815Z"}
{"level":"debug","message":"Executing query [m8o77nu38600aw128ue]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:52:51.819Z"}
{"level":"debug","message":"Executing query [m8o77nu7cg2puqb71vo]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:52:51.823Z"}
{"level":"debug","message":"Executing query [m8o77nuc96o5s1zg1uw]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:52:51.828Z"}
{"level":"debug","message":"Executing query [m8o77nulog579tmidk]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[23,888,24,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:52:51.837Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:52:51.838Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 24, Área ID: 888, Rol ID: 888, Documento ID: 23","timestamp":"2025-03-25T07:52:51.843Z"}
{"level":"debug","message":"Executing query [m8o77nut5f0smku01t5]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[23,24,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:52:51.845Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o77nut5f0smku01t5]","params":"[23,24,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:52:51.855Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:52:51.855Z"}
{"level":"debug","message":"Executing query [m8o77nv379hjyv1r6h]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.855Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o77nv379hjyv1r6h]","params":"[23]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:52:51.860Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:52:51.860Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:52:51.860Z"}
{"level":"debug","message":"Executing query [m8o77nv9bnjlbdgrhgd]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[23,24,\"RESTAURAR\"]","timestamp":"2025-03-25T07:52:51.861Z"}
{"level":"debug","message":"Executing query [m8o77nvhvrpo3jcyqm]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.869Z"}
{"level":"debug","message":"Executing query [m8o77nvltewgi46gpba]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[23,24,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:52:51.873Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o77nvltewgi46gpba]","params":"[23,24,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:52:51.881Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:52:51.881Z"}
{"level":"debug","message":"Executing query [m8o77nvugc1cls0bsx]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.882Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o77nvugc1cls0bsx]","params":"[23]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:52:51.884Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:52:51.885Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:52:51.885Z"}
{"level":"debug","message":"Executing query [m8o77nvyvdqm2fb22t]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[23,888,24,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:52:51.886Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:52:51.886Z"}
{"level":"debug","message":"Executing query [m8o77nw1rz96f34sux]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:52:51.889Z"}
{"level":"debug","message":"Executing query [m8o77ntbpwpiahp41u8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:51.791Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:51.892Z"}
{"level":"debug","message":"Executing query [m8o77nw6kln4dzp7x6t]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[24,\"DOCUMENTO\",24,\"ELIMINAR\"]","timestamp":"2025-03-25T07:52:51.894Z"}
{"level":"debug","message":"Executing query [m8o77nway3b7g9lujg]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889171790\"]","timestamp":"2025-03-25T07:52:51.898Z"}
{"level":"debug","message":"Executing query [m8o77nwdk49z90up96]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742889171790\",true]","timestamp":"2025-03-25T07:52:51.901Z"}
{"level":"debug","message":"Executing query [m8o77nwbtugcuzvdsw]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.899Z"}
{"level":"debug","message":"Executing query [m8o77nwqb35c944xyv]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:52:51.914Z"}
{"level":"debug","message":"Executing query [m8o77nws646awir6x9]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.917Z"}
{"level":"debug","message":"Executing query [m8o77nwusggiccw9oed]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.918Z"}
{"level":"debug","message":"Executing query [m8o77nwxluq57dob4es]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:52:51.921Z"}
{"level":"debug","message":"Executing query [m8o77nwyt0dg2n2bzde]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889171790\"]","timestamp":"2025-03-25T07:52:51.922Z"}
{"level":"debug","message":"Executing query [m8o77nwzdus4iu0strq]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:52:51.923Z"}
{"level":"debug","message":"Executing query [m8o77nx1sdzob6ymst]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:52:51.925Z"}
{"level":"debug","message":"Executing query [m8o77nx1i6xeszu4hn]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",24]","timestamp":"2025-03-25T07:52:51.925Z"}
{"level":"debug","message":"Executing query [m8o77nx5titbgxamon]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.929Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:52:51.929Z"}
{"level":"debug","message":"Executing query [m8o77nx9ohao0j8pgi]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.933Z"}
{"level":"debug","message":"Executing query [m8o77nx63mnxqi1lolu]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:51.930Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:51.932Z"}
{"level":"debug","message":"Executing query [m8o77nxdemvxl1fyjnw]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.937Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:51.858Z"}
{"level":"debug","message":"Executing query [m8o77nxhcbjnggqkvof]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.941Z"}
{"level":"debug","message":"Executing query [m8o77nw3owhgskayjo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:51.891Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:51.940Z"}
{"level":"debug","message":"Executing query [m8o77nxjeancjdbtgq]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:52:51.943Z"}
{"level":"debug","message":"Executing query [m8o77nxk01vas626p3pz]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.945Z"}
{"level":"debug","message":"Executing query [m8o77nxm7z5j4i1cp7r]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:52:51.946Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:52:51.949Z"}
{"level":"debug","message":"Executing query [m8o77nxqiecvr4tv7e]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.951Z"}
{"level":"debug","message":"Executing query [m8o77nxr66kcf7shvpr]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:52:51.951Z"}
{"level":"debug","message":"Executing query [m8o77nxtk9qiw3i4d6o]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:52:51.953Z"}
{"level":"debug","message":"Executing query [m8o77nxuryi7ekpoq9]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:52:51.954Z"}
{"level":"debug","message":"Executing query [m8o77nxvrgxh3zfneh]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:51.955Z"}
{"level":"debug","message":"Executing query [m8o77nxwi38b7humsy]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:52:51.956Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:51.960Z"}
{"level":"debug","message":"Executing query [m8o77ny194dczt1rwas]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.961Z"}
{"level":"debug","message":"Executing query [m8o77ny5m44je58jrec]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.965Z"}
{"level":"debug","message":"Executing query [m8o77nyattxa6yw6iml]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",24]","timestamp":"2025-03-25T07:52:51.970Z"}
{"level":"debug","message":"Executing query [m8o77nyh45e3u49i3i4]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.977Z"}
{"level":"debug","message":"Executing query [m8o77nykso3mupssvs9]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.980Z"}
{"level":"debug","message":"Executing query [m8o77nynpaja8gs1fkr]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.983Z"}
{"level":"debug","message":"Executing query [m8o77nypmt8x0eztdf]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:51.985Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:51.987Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:52.240Z"}
{"level":"debug","message":"Executing query [m8o77o5vlo8erhuipa]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:52.243Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:52.268Z"}
{"level":"debug","message":"Executing query [m8o77o6mawkyesuo4eb]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:52:52.270Z"}
{"level":"debug","message":"Executing query [m8o77o6qv2cnj9hlko]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889172242\"]","timestamp":"2025-03-25T07:52:52.274Z"}
{"level":"debug","message":"Executing query [m8o77o6tplsl1k4aljg]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742889172242\",\"TEST-OFI-QUIMICA-1742889172242\",307,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:52:52.277Z"}
{"level":"debug","message":"Executing query [m8o77o71bw6wqysn48r]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.285Z"}
{"level":"debug","message":"Executing query [m8o77o75wt6ekje4mg]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889172242\"]","timestamp":"2025-03-25T07:52:52.289Z"}
{"level":"debug","message":"Executing query [m8o77o78kdkrxbrgi57]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",12]","timestamp":"2025-03-25T07:52:52.292Z"}
{"level":"debug","message":"Executing query [m8o77o7bzo596bw6lxr]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.295Z"}
{"level":"debug","message":"Executing query [m8o77o7ffj44vk3oide]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.299Z"}
{"level":"debug","message":"Executing query [m8o77o7kpmn7hgx7xpr]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.304Z"}
{"level":"debug","message":"Executing query [m8o77o7n332t4k5d9cw]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.307Z"}
{"level":"debug","message":"Executing query [m8o77o7r0llg3jgaxuu]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.311Z"}
{"level":"debug","message":"Executing query [m8o77o7tg3u21e4nhlw]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:52.313Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:52.315Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:51.751Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:52:52.463Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:52:52.501Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:52.854Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:52:52.905Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:52.721Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:52.996Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:53.049Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:53.063Z"}
{"level":"debug","message":"Executing query [m8o77osqlmy26ims3qp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:53.066Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:53.097Z"}
{"level":"debug","message":"Executing query [m8o77otrxfm1zh9hsf]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:52:53.103Z"}
{"level":"debug","message":"Executing query [m8o77ottzsv9a7j77o]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:52:53.105Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:52:53.106Z"}
{"level":"debug","message":"Executing query [m8o77otufn9p1kmx9n4]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.106Z"}
{"level":"debug","message":"Executing query [m8o77otwgxo85pwmiae]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.108Z"}
{"level":"debug","message":"Executing query [m8o77otye2t23rcwbbt]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.110Z"}
{"level":"debug","message":"Executing query [m8o77otzii244dy2wco]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:52:53.111Z"}
{"level":"debug","message":"Executing query [m8o77ou54wi4r5xfuca]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[25]","timestamp":"2025-03-25T07:52:53.117Z"}
{"level":"debug","message":"Executing query [m8o77ou9mok26no24w]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.121Z"}
{"level":"debug","message":"Executing query [m8o77oue7dqwzt0keba]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",25]","timestamp":"2025-03-25T07:52:53.126Z"}
{"level":"debug","message":"Executing query [m8o77oui6rwf8u5j7gt]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[25]","timestamp":"2025-03-25T07:52:53.131Z"}
{"level":"debug","message":"Executing query [m8o77oulf5n1gq841jt]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[25]","timestamp":"2025-03-25T07:52:53.133Z"}
{"level":"debug","message":"Executing query [m8o77ouowiuwtovu2z]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[25]","timestamp":"2025-03-25T07:52:53.137Z"}
{"level":"debug","message":"Executing query [m8o77ournzfqqnr3rth]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.139Z"}
{"level":"debug","message":"Executing query [m8o77ouszk3jhsuhc9g]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.140Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:52:53.141Z"}
{"level":"debug","message":"Executing query [m8o77ouuizbcl1bj6mk]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:53.142Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:53.143Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:53.798Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:52:53.958Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:54.056Z"}
{"level":"debug","message":"Executing query [m8o77pljffxrncb625]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:52:54.103Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:54.142Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:54.531Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:54.566Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:54.700Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:52:54.702Z"}
{"duration":"30ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:52:54.725Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:54.727Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:52:54.731Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:54.735Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:17.726Z"}
{"level":"debug","message":"Executing query [m8o787uinfw6voj0z1]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:17.754Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:17.789Z"}
{"level":"debug","message":"Executing query [m8o787vjewdi1s9nuc]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889197753\"]","timestamp":"2025-03-25T07:53:17.791Z"}
{"level":"debug","message":"Executing query [m8o787vma4erz4u778b]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889197753\"]","timestamp":"2025-03-25T07:53:17.794Z"}
{"level":"debug","message":"Executing query [m8o787vnnt86jesde6n]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742889197753\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:53:17.795Z"}
{"level":"debug","message":"Executing query [m8o787vrkpgjyhu6vxs]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.799Z"}
{"level":"debug","message":"Executing query [m8o787vv2jx46ylnl9q]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889197753\"]","timestamp":"2025-03-25T07:53:17.803Z"}
{"level":"debug","message":"Executing query [m8o787vxa0d1pg50gu9]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1011]","timestamp":"2025-03-25T07:53:17.805Z"}
{"level":"debug","message":"Executing query [m8o787w1xkys4kecv9k]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.809Z"}
{"level":"debug","message":"Executing query [m8o787w2dxzxjk4ku1q]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.811Z"}
{"level":"debug","message":"Executing query [m8o787w6mwni1zi17sm]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.814Z"}
{"level":"debug","message":"Executing query [m8o787w8hjtjapmdm38]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.816Z"}
{"level":"debug","message":"Executing query [m8o787wagx63yy3v8q]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.818Z"}
{"level":"debug","message":"Executing query [m8o787wcsgxxjrvtfec]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.820Z"}
{"level":"debug","message":"Executing query [m8o787wdgymtc7gg1gu]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:53:17.821Z"}
{"level":"debug","message":"Executing query [m8o787wfttombbu1ouq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:17.823Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:17.824Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.916Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.918Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.920Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.922Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.926Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.928Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.929Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:53:17.932Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:53:17.933Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:53:17.935Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:53:17.937Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:53:17.939Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:18.132Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:19.202Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:53:19.377Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:53:19.382Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:19.435Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:53:19.453Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:19.501Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:19.970Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:20.219Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:20.235Z"}
{"level":"debug","message":"Executing query [m8o789rhcwv6lod38u6]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:53:20.237Z"}
{"level":"debug","message":"Executing query [m8o789rkqwhrwhnwbdi]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:53:20.240Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o789rkqwhrwhnwbdi]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:53:20.246Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:20.249Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:20.359Z"}
{"level":"debug","message":"Executing query [m8o789uz06wqvm9j84kg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:20.363Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:20.381Z"}
{"level":"debug","message":"Executing query [m8o789vj53vg04olb6f]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:53:20.383Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:53:20.384Z"}
{"level":"debug","message":"Executing query [m8o789vloynnb3l4ca]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:53:20.385Z"}
{"level":"debug","message":"Executing query [m8o789vm9d3yxjp4v]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:53:20.386Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:53:20.388Z"}
{"level":"debug","message":"Executing query [m8o789vojt0jqfsuoaf]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:53:20.388Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:53:20.390Z"}
{"level":"debug","message":"Executing query [m8o789vvo44x24i9wm]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:53:20.395Z"}
{"level":"debug","message":"Executing query [m8o789vytg1vi1c677s]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:53:20.398Z"}
{"level":"debug","message":"Executing query [m8o789w12wkwyebcsl7]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[23]","timestamp":"2025-03-25T07:53:20.401Z"}
{"level":"debug","message":"Executing query [m8o789w54n2fsb6h2im]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:20.405Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:22.271Z"}
{"duration":"6ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:53:22.334Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:53:22.338Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:22.344Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:53:22.346Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:53:22.439Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:53:22.537Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:22.671Z"}
{"level":"debug","message":"Executing query [m8o78bn6xmzbmlkcd99]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:22.674Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:22.692Z"}
{"level":"debug","message":"Executing query [m8o78bnqmi16ic3dldj]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:53:22.695Z"}
{"level":"debug","message":"Executing query [m8o78bnts388uk5tyro]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889202673\"]","timestamp":"2025-03-25T07:53:22.697Z"}
{"level":"debug","message":"Executing query [m8o78bnuiwodjhqmu2]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742889202673\",\"TEST-OFICIO-1742889202673\",64,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:53:22.698Z"}
{"level":"debug","message":"Executing query [m8o78bo19zn83x059pv]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.705Z"}
{"level":"debug","message":"Executing query [m8o78bo5quwb8onelnk]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889202673\"]","timestamp":"2025-03-25T07:53:22.709Z"}
{"level":"debug","message":"Executing query [m8o78bo8b9wvv8v51v]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",25]","timestamp":"2025-03-25T07:53:22.712Z"}
{"level":"debug","message":"Executing query [m8o78bocsft2cuuxqas]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.716Z"}
{"level":"debug","message":"Executing query [m8o78bogmg5mpjp009]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.720Z"}
{"level":"debug","message":"Executing query [m8o78bom07o9vsy1oscj]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.726Z"}
{"level":"debug","message":"Executing query [m8o78bopgu8xjwg1mkt]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.729Z"}
{"level":"debug","message":"Executing query [m8o78bosxxaxbihxm7]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.732Z"}
{"level":"debug","message":"Executing query [m8o78bou6g7fzu9czmi]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742889202734\",\"TEST-SP-OFICIO-1742889202734\",17,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:53:22.734Z"}
{"level":"debug","message":"Executing query [m8o78bozjeehlpngfhl]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889202734\"]","timestamp":"2025-03-25T07:53:22.739Z"}
{"level":"debug","message":"Executing query [m8o78bp1zpto71z7jjl]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889202734\"]","timestamp":"2025-03-25T07:53:22.741Z"}
{"level":"debug","message":"Executing query [m8o78bp5s226dh5p5q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:22.745Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:22.747Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:22.986Z"}
{"level":"debug","message":"Executing query [m8o78bvxe89f217vnn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:22.989Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:23.003Z"}
{"level":"debug","message":"Executing query [m8o78bwcbdbdw4mnqhm]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:53:23.004Z"}
{"level":"debug","message":"Executing query [m8o78bwfozemla5e7io]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889202988\"]","timestamp":"2025-03-25T07:53:23.007Z"}
{"level":"debug","message":"Executing query [m8o78bwgr4ng0wjs0ne]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742889202988\",\"TEST-OFI-FORENSE-1742889202988\",8730,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742889202988\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:53:23.008Z"}
{"level":"debug","message":"Executing query [m8o78bwlsm0iqvy4qd]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.013Z"}
{"level":"debug","message":"Executing query [m8o78bwqtlxl2nxdhbb]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889202988\"]","timestamp":"2025-03-25T07:53:23.019Z"}
{"level":"debug","message":"Executing query [m8o78bwtyn9g59g77gb]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",25]","timestamp":"2025-03-25T07:53:23.021Z"}
{"level":"debug","message":"Executing query [m8o78bwxa0t6vvci1q]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.025Z"}
{"level":"debug","message":"Executing query [m8o78bx0cszhf2ncakt]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.028Z"}
{"level":"debug","message":"Executing query [m8o78bx4ywx697s4vd]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.032Z"}
{"level":"debug","message":"Executing query [m8o78bx7xli2f9cdgrp]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.035Z"}
{"level":"debug","message":"Executing query [m8o78bxaj18bxpelgra]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.038Z"}
{"level":"debug","message":"Executing query [m8o78bxdhkpfiijereg]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742889203041\",\"TEST-SP-OFI-FORENSE-1742889203041\",6383,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:53:23.041Z"}
{"level":"debug","message":"Executing query [m8o78bxkk7wx2qeo4c]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889203041\"]","timestamp":"2025-03-25T07:53:23.048Z"}
{"level":"debug","message":"Executing query [m8o78bxmuerzi1hiu8]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889203041\"]","timestamp":"2025-03-25T07:53:23.050Z"}
{"level":"debug","message":"Executing query [m8o78bxr31b2tvj0dmf]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:23.055Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:23.058Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:24.082Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:24.216Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:53:24.221Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:53:24.358Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:53:24.359Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:53:24.359Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:53:24.360Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:53:24.360Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:53:24.360Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:24.872Z"}
{"level":"debug","message":"Executing query [m8o78dcba8kjk0kjlci]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:24.875Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:24.888Z"}
{"level":"debug","message":"Executing query [m8o78dcqfxtocejgz0f]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889204874\"]","timestamp":"2025-03-25T07:53:24.890Z"}
{"level":"debug","message":"Executing query [m8o78dcrghi3lla2o0t]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742889204874\",true]","timestamp":"2025-03-25T07:53:24.891Z"}
{"level":"debug","message":"Executing query [m8o78dd2fun17menl2l]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.902Z"}
{"level":"debug","message":"Executing query [m8o78dd6eo62bopuibj]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889204874\"]","timestamp":"2025-03-25T07:53:24.906Z"}
{"level":"debug","message":"Executing query [m8o78dd8tsaod545rn]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",25]","timestamp":"2025-03-25T07:53:24.908Z"}
{"level":"debug","message":"Executing query [m8o78ddg7w5lv0fyhoe]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.916Z"}
{"level":"debug","message":"Executing query [m8o78ddlzhdt7fm17i]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.921Z"}
{"level":"debug","message":"Executing query [m8o78ddq7kwcaih6nvx]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.926Z"}
{"level":"debug","message":"Executing query [m8o78ddto625v9gimt]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.929Z"}
{"level":"debug","message":"Executing query [m8o78ddvuldm66p884]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.931Z"}
{"level":"debug","message":"Executing query [m8o78ddzvfrrh7ebwk]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.935Z"}
{"level":"debug","message":"Executing query [m8o78de0zuq735syi6]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:53:24.937Z"}
{"level":"debug","message":"Executing query [m8o78de2ls4jbqa6z8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:24.938Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:24.939Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:25.195Z"}
{"level":"debug","message":"Executing query [m8o78dlamu4fcl5u0n8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:25.198Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:25.210Z"}
{"level":"debug","message":"Executing query [m8o78dln9a4uj9hje0e]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:53:25.211Z"}
{"level":"debug","message":"Executing query [m8o78dlp4yivi8fznvj]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:53:25.213Z"}
{"level":"debug","message":"Executing query [m8o78dlq2px30q1x7x7]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:53:25.214Z"}
{"level":"debug","message":"Executing query [m8o78dlsx7e23wclvfi]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:53:25.216Z"}
{"level":"debug","message":"Executing query [m8o78dlw6olrntuseyv]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:53:25.220Z"}
{"level":"debug","message":"Executing query [m8o78dlz6d7i86gla3c]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[26,888,26,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:53:25.223Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:53:25.223Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 26, Área ID: 888, Rol ID: 888, Documento ID: 25","timestamp":"2025-03-25T07:53:25.226Z"}
{"level":"debug","message":"Executing query [m8o78dm3ojf89bt7ej]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[25,26,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:53:25.227Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o78dm3ojf89bt7ej]","params":"[25,26,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:53:25.231Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:53:25.232Z"}
{"level":"debug","message":"Executing query [m8o78dm85c2da0559jq]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[25]","timestamp":"2025-03-25T07:53:25.232Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o78dm85c2da0559jq]","params":"[25]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:53:25.234Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:53:25.235Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:53:25.235Z"}
{"level":"debug","message":"Executing query [m8o78dmc2uovtx2ka5e]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[25,26,\"RESTAURAR\"]","timestamp":"2025-03-25T07:53:25.236Z"}
{"level":"debug","message":"Executing query [m8o78dmibg28srdrao]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[25]","timestamp":"2025-03-25T07:53:25.243Z"}
{"level":"debug","message":"Executing query [m8o78dmo4yim81sqpys]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[25,26,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:53:25.248Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o78dmo4yim81sqpys]","params":"[25,26,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:53:25.251Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:53:25.251Z"}
{"level":"debug","message":"Executing query [m8o78dms1ri1bizmx73]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[25]","timestamp":"2025-03-25T07:53:25.252Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o78dms1ri1bizmx73]","params":"[25]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:53:25.254Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:53:25.255Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:53:25.255Z"}
{"level":"debug","message":"Executing query [m8o78dmwxztw2xdsez]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[26,888,26,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:53:25.256Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:53:25.256Z"}
{"level":"debug","message":"Executing query [m8o78dn0bdr8adnpaw8]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:53:25.260Z"}
{"level":"debug","message":"Executing query [m8o78dn48f6jw27txv5]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[26,\"DOCUMENTO\",26,\"ELIMINAR\"]","timestamp":"2025-03-25T07:53:25.264Z"}
{"level":"debug","message":"Executing query [m8o78dn67vv1e6yydj9]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.266Z"}
{"level":"debug","message":"Executing query [m8o78dnal7rp51ea4pg]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:53:25.271Z"}
{"level":"debug","message":"Executing query [m8o78dne9tqwnzn21oj]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.274Z"}
{"level":"debug","message":"Executing query [m8o78dnh73emidqerwu]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:53:25.277Z"}
{"level":"debug","message":"Executing query [m8o78dniszcfmrr6yl]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:53:25.278Z"}
{"level":"debug","message":"Executing query [m8o78dnj7nimhm8dsep]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:53:25.279Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:53:25.282Z"}
{"level":"debug","message":"Executing query [m8o78dnnwko6jvyda4]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:25.283Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:25.284Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:25.408Z"}
{"level":"debug","message":"Executing query [m8o78dr7dd1at3rq60f]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:25.411Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:25.433Z"}
{"level":"debug","message":"Executing query [m8o78drvnz5jkd2dp8]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:53:25.435Z"}
{"level":"debug","message":"Executing query [m8o78drx2eowaq6xbdi]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:53:25.437Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:53:25.439Z"}
{"level":"debug","message":"Executing query [m8o78ds0liwpj6ibd5r]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:53:25.440Z"}
{"level":"debug","message":"Executing query [m8o78ds433xtjqz1os6]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:53:25.444Z"}
{"level":"debug","message":"Executing query [m8o78ds76w6kq2g2g6f]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:53:25.447Z"}
{"level":"debug","message":"Executing query [m8o78dsed7c7igkv63q]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.454Z"}
{"level":"debug","message":"Executing query [m8o78dsibqyhargua9]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.458Z"}
{"level":"debug","message":"Executing query [m8o78dsmllq352mt5q]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",26]","timestamp":"2025-03-25T07:53:25.462Z"}
{"level":"debug","message":"Executing query [m8o78dspvc521uc2du]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.465Z"}
{"level":"debug","message":"Executing query [m8o78dsrzdskornmsi]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.467Z"}
{"level":"debug","message":"Executing query [m8o78dsvcjj1pkct4d]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.471Z"}
{"level":"debug","message":"Executing query [m8o78dsxlol6nhpn30k]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:25.473Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:25.475Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:25.730Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:26.196Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:53:26.258Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:26.303Z"}
{"level":"debug","message":"Executing query [m8o78egwo5842x2masa]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:53:26.336Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:26.383Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:26.611Z"}
{"level":"debug","message":"Executing query [m8o78eole95kpc3a6nb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:26.613Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:26.626Z"}
{"level":"debug","message":"Executing query [m8o78ep0en4fpyqoait]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:53:26.628Z"}
{"level":"debug","message":"Executing query [m8o78ep2vtqmqwagvj]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889206613\"]","timestamp":"2025-03-25T07:53:26.630Z"}
{"level":"debug","message":"Executing query [m8o78ep3qwunu85sede]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742889206613\",\"TEST-OFI-QUIMICA-1742889206613\",13,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:53:26.631Z"}
{"level":"debug","message":"Executing query [m8o78epbkctk59lu1a]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.639Z"}
{"level":"debug","message":"Executing query [m8o78epe27l5cz03f8c]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889206613\"]","timestamp":"2025-03-25T07:53:26.642Z"}
{"level":"debug","message":"Executing query [m8o78ephhq3sb946xyo]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",13]","timestamp":"2025-03-25T07:53:26.645Z"}
{"level":"debug","message":"Executing query [m8o78epkill4qvf2ml]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.648Z"}
{"level":"debug","message":"Executing query [m8o78epmtc2giny8qpi]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.650Z"}
{"level":"debug","message":"Executing query [m8o78epp1r7z2y6p152]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.653Z"}
{"level":"debug","message":"Executing query [m8o78epqoo8012ufg3]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.654Z"}
{"level":"debug","message":"Executing query [m8o78ept1443rixvex9l]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.657Z"}
{"level":"debug","message":"Executing query [m8o78epvkxd8v6wwnb9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:26.659Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:26.660Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:27.241Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:27.245Z"}
{"level":"debug","message":"Executing query [m8o78f66cfy4qnqsmft]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:27.246Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:27.257Z"}
{"level":"debug","message":"Executing query [m8o78f6jiq7ijn92uz]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:53:27.259Z"}
{"level":"debug","message":"Executing query [m8o78f6ky7em0mal6uc]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:53:27.260Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:53:27.261Z"}
{"level":"debug","message":"Executing query [m8o78f6loqbyslfna2]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.261Z"}
{"level":"debug","message":"Executing query [m8o78f6m8fpy8kek8o9]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.262Z"}
{"level":"debug","message":"Executing query [m8o78f6otbjmz2vzls]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.264Z"}
{"level":"debug","message":"Executing query [m8o78f6p9dj9bezghts]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:53:27.265Z"}
{"level":"debug","message":"Executing query [m8o78f6v7alcrlar4j3]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[27]","timestamp":"2025-03-25T07:53:27.271Z"}
{"level":"debug","message":"Executing query [m8o78f6xj7z0vdmzhl]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.273Z"}
{"level":"debug","message":"Executing query [m8o78f6zso01skp5wj8]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",27]","timestamp":"2025-03-25T07:53:27.275Z"}
{"level":"debug","message":"Executing query [m8o78f72bu34ub0dlws]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[27]","timestamp":"2025-03-25T07:53:27.278Z"}
{"level":"debug","message":"Executing query [m8o78f73o79l7158d9e]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[27]","timestamp":"2025-03-25T07:53:27.279Z"}
{"level":"debug","message":"Executing query [m8o78f75phgwy9q6evr]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[27]","timestamp":"2025-03-25T07:53:27.282Z"}
{"level":"debug","message":"Executing query [m8o78f78lrsdl6voia]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.284Z"}
{"level":"debug","message":"Executing query [m8o78f7a9bk36hou8zo]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.286Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:53:27.287Z"}
{"level":"debug","message":"Executing query [m8o78f7bp686jiojmze]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:27.287Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:27.288Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:48.864Z"}
{"level":"debug","message":"Executing query [m8o7glomuz3o1a46m7s]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:48.934Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.882Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:49.021Z"}
{"level":"debug","message":"Executing query [m8o7glrbg5543w0umrf]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889588927\"]","timestamp":"2025-03-25T07:59:49.032Z"}
{"level":"debug","message":"Executing query [m8o7glrw4r1746hune]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889588927\"]","timestamp":"2025-03-25T07:59:49.052Z"}
{"level":"debug","message":"Executing query [m8o7glrz25wn5fa5m54]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742889588927\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:59:49.055Z"}
{"level":"debug","message":"Executing query [m8o7glscdtrq2c161c4]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.068Z"}
{"level":"debug","message":"Executing query [m8o7glsh0ny333q5n4xk]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889588927\"]","timestamp":"2025-03-25T07:59:49.074Z"}
{"level":"debug","message":"Executing query [m8o7glsn4gppexyn4t6]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1012]","timestamp":"2025-03-25T07:59:49.080Z"}
{"level":"debug","message":"Executing query [m8o7glst2pgx2x308h7]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.085Z"}
{"level":"debug","message":"Executing query [m8o7glsyvnopp4jv3k]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.090Z"}
{"level":"debug","message":"Executing query [m8o7glt7nuozul1djmm]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.099Z"}
{"level":"debug","message":"Executing query [m8o7gltbfpo839osvys]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.103Z"}
{"level":"debug","message":"Executing query [m8o7glteit9cmf7196]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.106Z"}
{"level":"debug","message":"Executing query [m8o7glti491ri8xmu38]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.110Z"}
{"level":"debug","message":"Executing query [m8o7gltkh99pwjjs14h]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:59:49.112Z"}
{"level":"debug","message":"Executing query [m8o7gltnbibeuzd0ue]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:49.116Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:49.121Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:59:49.432Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.720Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.637Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:49.924Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.634Z"}
{"level":"debug","message":"Executing query [m8o7gmgj3k6k26ic7sd]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:59:49.939Z"}
{"level":"debug","message":"Executing query [m8o7gmgryesp6jin8h]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:59:49.947Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o7gmgryesp6jin8h]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:59:49.959Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:49.962Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.889Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.936Z"}
{"level":"debug","message":"Executing query [m8o7gmi0hljbsdu7t2]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:49.992Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.979Z"}
{"level":"debug","message":"Executing query [m8o7gmi1iynwfbtkm6]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:49.993Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.028Z"}
{"level":"debug","message":"Executing query [m8o7gmj2vydg4dldf8g]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:59:50.030Z"}
{"level":"debug","message":"Executing query [m8o7gmj5o8ar0rinly]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889589991\"]","timestamp":"2025-03-25T07:59:50.033Z"}
{"level":"debug","message":"Executing query [m8o7gmj79y8s29fisw]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742889589991\",\"TEST-OFI-FORENSE-1742889589991\",5836,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742889589991\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:59:50.035Z"}
{"level":"debug","message":"Executing query [m8o7gmjg9niv4dtpa2c]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.044Z"}
{"level":"debug","message":"Executing query [m8o7gmjld1wyk9is9gn]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889589991\"]","timestamp":"2025-03-25T07:59:50.049Z"}
{"level":"debug","message":"Executing query [m8o7gmjqo26a1vb0fwp]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",27]","timestamp":"2025-03-25T07:59:50.054Z"}
{"level":"debug","message":"Executing query [m8o7gmjwqg4z0yhjsu]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.060Z"}
{"level":"debug","message":"Executing query [m8o7gmk0cljm0qt65oe]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.064Z"}
{"level":"debug","message":"Executing query [m8o7gmk3jwncfd0lxw8]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.068Z"}
{"level":"debug","message":"Executing query [m8o7gmk6ck2opy2x0n5]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.070Z"}
{"level":"debug","message":"Executing query [m8o7gmkcexm6742t1p7]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.076Z"}
{"level":"debug","message":"Executing query [m8o7gmkgnapzezbzylm]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742889590080\",\"TEST-SP-OFI-FORENSE-1742889590080\",9003,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:59:50.080Z"}
{"level":"debug","message":"Executing query [m8o7gmkpcw5kvyg47x5]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889590080\"]","timestamp":"2025-03-25T07:59:50.089Z"}
{"level":"debug","message":"Executing query [m8o7gmkr01ycusph5wu4]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889590080\"]","timestamp":"2025-03-25T07:59:50.091Z"}
{"level":"debug","message":"Executing query [m8o7gmhcba9618uzn6l]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:49.968Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.068Z"}
{"level":"debug","message":"Executing query [m8o7gmkzfq1l1k1fnh]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.099Z"}
{"level":"debug","message":"Executing query [m8o7gmky4127846gk9w]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:59:50.098Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:50.101Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.069Z"}
{"level":"debug","message":"Executing query [m8o7gmkd60alofrlyg]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:59:50.078Z"}
{"level":"debug","message":"Executing query [m8o7gmkq0n593iwpc30a]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889589991\"]","timestamp":"2025-03-25T07:59:50.094Z"}
{"level":"debug","message":"Executing query [m8o7gml02l8hqdi8fpp]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742889589991\",\"TEST-OFICIO-1742889589991\",7682,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:59:50.100Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:59:50.105Z"}
{"level":"debug","message":"Executing query [m8o7gml6lvl2lqloz8g]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:59:50.106Z"}
{"level":"debug","message":"Executing query [m8o7gmm44c92iniiz7m]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:59:50.140Z"}
{"level":"debug","message":"Executing query [m8o7gmmi4dbp69ooix2]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.154Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:59:50.153Z"}
{"level":"debug","message":"Executing query [m8o7gmmh45il2kosapf]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:59:50.153Z"}
{"level":"debug","message":"Executing query [m8o7gmmva7nhv2e88y]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889589991\"]","timestamp":"2025-03-25T07:59:50.167Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:59:50.173Z"}
{"level":"debug","message":"Executing query [m8o7gmn49mf36pbih4]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",27]","timestamp":"2025-03-25T07:59:50.176Z"}
{"level":"debug","message":"Executing query [m8o7gmn8hdnctl5dx4n]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.181Z"}
{"level":"debug","message":"Executing query [m8o7gmnclez5aei429]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.184Z"}
{"level":"debug","message":"Executing query [m8o7gmngis6zai3ux2b]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.188Z"}
{"level":"debug","message":"Executing query [m8o7gmnkgfejyd0zn4r]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.192Z"}
{"level":"debug","message":"Executing query [m8o7gmnqcszcyp5okou]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.198Z"}
{"level":"debug","message":"Executing query [m8o7gmnt2xh8jtwc9kc]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742889590201\",\"TEST-SP-OFICIO-1742889590201\",5906,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:59:50.201Z"}
{"level":"debug","message":"Executing query [m8o7gmnywpxpb1cs0e]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889590201\"]","timestamp":"2025-03-25T07:59:50.206Z"}
{"level":"debug","message":"Executing query [m8o7gmo1fcd147bswg]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889590201\"]","timestamp":"2025-03-25T07:59:50.209Z"}
{"level":"debug","message":"Executing query [m8o7gmo8up6zyvvsb68]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.216Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:50.219Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:59:50.218Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:59:50.219Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:59:50.220Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:59:50.221Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:59:50.222Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:59:50.222Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Executing query [m8o7gmpu9qoqv4cazqr]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:59:50.274Z"}
{"level":"debug","message":"Executing query [m8o7gmqijpaay7bp2fl]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:59:50.298Z"}
{"level":"debug","message":"Executing query [m8o7gmqlclo2nizj4m]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[25]","timestamp":"2025-03-25T07:59:50.301Z"}
{"level":"debug","message":"Executing query [m8o7gmqs2ou13m7kbz5]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.308Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:59:49.897Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:50.644Z"}
{"level":"debug","message":"Executing query [m8o7gn094xehm6q1q5g]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:50.650Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.673Z"}
{"level":"debug","message":"Executing query [m8o7gn10u3b7x5o45sc]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:59:50.676Z"}
{"level":"debug","message":"Executing query [m8o7gn12bt3fi3n9via]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:59:50.678Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:59:50.680Z"}
{"level":"debug","message":"Executing query [m8o7gn15opzs5u1w4lo]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:59:50.681Z"}
{"level":"debug","message":"Executing query [m8o7gn17y5im8cei67c]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:59:50.683Z"}
{"level":"debug","message":"Executing query [m8o7gn1ads6zy84x2p7]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:59:50.686Z"}
{"level":"debug","message":"Executing query [m8o7gn1mu4h329983n]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.698Z"}
{"level":"debug","message":"Executing query [m8o7gn1qysjtjhm5g]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.702Z"}
{"level":"debug","message":"Executing query [m8o7gn1vnhkwppwa5w]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",27]","timestamp":"2025-03-25T07:59:50.707Z"}
{"level":"debug","message":"Executing query [m8o7gn1z5qhfineuhd2]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.712Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:50.698Z"}
{"level":"debug","message":"Executing query [m8o7gn22esaq977ew16]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.714Z"}
{"level":"debug","message":"Executing query [m8o7gn29yjozhexhf9m]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.721Z"}
{"level":"debug","message":"Executing query [m8o7gn2babx6tdjjsd]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.723Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:50.725Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:50.712Z"}
{"level":"debug","message":"Executing query [m8o7gn1wmfcsjtks82]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:50.708Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.737Z"}
{"level":"debug","message":"Executing query [m8o7gn2rdew74akes2d]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:59:50.739Z"}
{"level":"debug","message":"Executing query [m8o7gn2tozc9havv2eq]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:59:50.741Z"}
{"level":"debug","message":"Executing query [m8o7gn2wvpnueu80wm]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:59:50.744Z"}
{"level":"debug","message":"Executing query [m8o7gn2yt9wbeu8mxsq]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:59:50.746Z"}
{"level":"debug","message":"Executing query [m8o7gn29md1khvi22o]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:50.721Z"}
{"level":"debug","message":"Executing query [m8o7gn32bw7utfvxw8j]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:59:50.751Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.751Z"}
{"level":"debug","message":"Executing query [m8o7gn38fk5omg4hhgp]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889590718\"]","timestamp":"2025-03-25T07:59:50.756Z"}
{"level":"debug","message":"Executing query [m8o7gn38vtti5o05ej]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[27,888,28,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:59:50.756Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:59:50.756Z"}
{"level":"debug","message":"Executing query [m8o7gn3azbne7qlj5p9]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742889590718\",true]","timestamp":"2025-03-25T07:59:50.759Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 28, Área ID: 888, Rol ID: 888, Documento ID: 27","timestamp":"2025-03-25T07:59:50.762Z"}
{"level":"debug","message":"Executing query [m8o7gn3gxx1ba2ra3c]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[27,28,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:59:50.764Z"}
{"level":"debug","message":"Executing query [m8o7gn3k99wfu6wgo79]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.768Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o7gn3gxx1ba2ra3c]","params":"[27,28,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:59:50.770Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:59:50.770Z"}
{"level":"debug","message":"Executing query [m8o7gn3n794wqi3hs2q]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.771Z"}
{"level":"debug","message":"Executing query [m8o7gn3sk5cnb3pv398]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889590718\"]","timestamp":"2025-03-25T07:59:50.776Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o7gn3n794wqi3hs2q]","params":"[27]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:59:50.774Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:59:50.775Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:59:50.775Z"}
{"level":"debug","message":"Executing query [m8o7gn3svdpmye6vkii]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[27,28,\"RESTAURAR\"]","timestamp":"2025-03-25T07:59:50.776Z"}
{"level":"debug","message":"Executing query [m8o7gn3vn4d2z0mab2r]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",28]","timestamp":"2025-03-25T07:59:50.779Z"}
{"level":"debug","message":"Executing query [m8o7gn3zpuej9op7wp]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.783Z"}
{"level":"debug","message":"Executing query [m8o7gn431pzl1gwa4x]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.787Z"}
{"level":"debug","message":"Executing query [m8o7gn48gd1pulviqzb]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[27,28,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:59:50.792Z"}
{"level":"debug","message":"Executing query [m8o7gn477jk4o36ix6m]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.791Z"}
{"level":"debug","message":"Executing query [m8o7gn4dxn1dryx4yts]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.797Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o7gn48gd1pulviqzb]","params":"[27,28,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:59:50.800Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:59:50.800Z"}
{"level":"debug","message":"Executing query [m8o7gn4gqc0wuljpae]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.800Z"}
{"level":"debug","message":"Executing query [m8o7gn4gshufpx8mpad]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.800Z"}
{"level":"debug","message":"Executing query [m8o7gn4igqq0vqpdhvo]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.802Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o7gn4gqc0wuljpae]","params":"[27]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:59:50.803Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:59:50.804Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:59:50.804Z"}
{"level":"debug","message":"Executing query [m8o7gn4lwg44aqxmltp]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[27,888,28,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:59:50.805Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:59:50.805Z"}
{"level":"debug","message":"Executing query [m8o7gn4mnft7uegb0bl]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.806Z"}
{"level":"debug","message":"Executing query [m8o7gn4ouxvzm2rd1mb]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:59:50.808Z"}
{"level":"debug","message":"Executing query [m8o7gn4r4c6a5vhvd9w]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.811Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:50.813Z"}
{"level":"debug","message":"Executing query [m8o7gn4y4vmfm27i28v]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:59:50.818Z"}
{"level":"debug","message":"Executing query [m8o7gn5dhmwb6xl01jg]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[28,\"DOCUMENTO\",28,\"ELIMINAR\"]","timestamp":"2025-03-25T07:59:50.833Z"}
{"level":"debug","message":"Executing query [m8o7gn5hsauksr5bhs]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.837Z"}
{"level":"debug","message":"Executing query [m8o7gn5nsrmhhv3hyfc]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:59:50.844Z"}
{"level":"debug","message":"Executing query [m8o7gn5taqkyxp6izjq]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.849Z"}
{"level":"debug","message":"Executing query [m8o7gn5ycg44zorxesm]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:59:50.854Z"}
{"level":"debug","message":"Executing query [m8o7gn605e5nueph2cq]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:59:50.856Z"}
{"level":"debug","message":"Executing query [m8o7gn6222kshzwiyww]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:59:50.858Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:59:50.863Z"}
{"level":"debug","message":"Executing query [m8o7gn67l7qsj9pilpa]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.863Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:50.868Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:51.175Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:51.208Z"}
{"level":"debug","message":"Executing query [m8o7gnfy87jckkrzoic]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:51.215Z"}
{"level":"debug","message":"Executing query [m8o7gngn66igvnfhbuk]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:59:51.240Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:51.246Z"}
{"level":"debug","message":"Executing query [m8o7gnh8ivvqpyhp9ts]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:59:51.260Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:59:51.263Z"}
{"level":"debug","message":"Executing query [m8o7gnhc21j2lw49vei]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.264Z"}
{"level":"debug","message":"Executing query [m8o7gnhht2yemb0lfbj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.269Z"}
{"level":"debug","message":"Executing query [m8o7gnhk33c845b8bd]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.272Z"}
{"level":"debug","message":"Executing query [m8o7gnhmw87ukljbe4d]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:59:51.274Z"}
{"level":"debug","message":"Executing query [m8o7gni77s3hdq2gtek]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[29]","timestamp":"2025-03-25T07:59:51.295Z"}
{"level":"debug","message":"Executing query [m8o7gnibkwphwru391p]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.299Z"}
{"level":"debug","message":"Executing query [m8o7gnifr8z6sryrmor]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",29]","timestamp":"2025-03-25T07:59:51.303Z"}
{"level":"debug","message":"Executing query [m8o7gnil2ch9jgriqzw]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[29]","timestamp":"2025-03-25T07:59:51.309Z"}
{"level":"debug","message":"Executing query [m8o7gnio3dcvjp19dfq]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[29]","timestamp":"2025-03-25T07:59:51.312Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:51.123Z"}
{"level":"debug","message":"Executing query [m8o7gniy15fqs5qtrpk]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[29]","timestamp":"2025-03-25T07:59:51.322Z"}
{"level":"debug","message":"Executing query [m8o7gnj1vjbmbzv88us]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.325Z"}
{"level":"debug","message":"Executing query [m8o7gnj3dgue1xyow4]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.327Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:59:51.328Z"}
{"level":"debug","message":"Executing query [m8o7gnj4sn5gcr0wjz9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:51.328Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:51.331Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:51.350Z"}
{"level":"debug","message":"Executing query [m8o7gnl6sd59ffl3yj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:51.403Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:51.484Z"}
{"level":"debug","message":"Executing query [m8o7gnnwoxfiz82awks]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:59:51.500Z"}
{"level":"debug","message":"Executing query [m8o7gno26xjz1ehqts3]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889591401\"]","timestamp":"2025-03-25T07:59:51.506Z"}
{"level":"debug","message":"Executing query [m8o7gno59hhvbsoylch]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742889591401\",\"TEST-OFI-QUIMICA-1742889591401\",6080,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:59:51.509Z"}
{"level":"debug","message":"Executing query [m8o7gnof63reatrf5w8]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.519Z"}
{"level":"debug","message":"Executing query [m8o7gnoqfyqax4gq4ts]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889591401\"]","timestamp":"2025-03-25T07:59:51.530Z"}
{"level":"debug","message":"Executing query [m8o7gnouwjzco0w70f]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",14]","timestamp":"2025-03-25T07:59:51.534Z"}
{"level":"debug","message":"Executing query [m8o7gnp6os2y7lx45ur]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.546Z"}
{"level":"debug","message":"Executing query [m8o7gnpb6xw6cv08v8d]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.551Z"}
{"level":"debug","message":"Executing query [m8o7gnpf760mowmlsuh]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.555Z"}
{"level":"debug","message":"Executing query [m8o7gnpjkankc11xqyk]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.559Z"}
{"level":"debug","message":"Executing query [m8o7gnpoczefeu70p2w]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.564Z"}
{"level":"debug","message":"Executing query [m8o7gnpqbdd8b1gavq4]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:51.566Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:51.568Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:51.972Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:59:52.345Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:59:52.365Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:52.598Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:59:52.696Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:52.782Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:52.938Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:59:53.108Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:53.218Z"}
{"level":"debug","message":"Executing query [m8o7gp0vyh5wgnah8pp]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:59:53.263Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:53.312Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.896Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.908Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.911Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.914Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.920Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.923Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:59:48.929Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:59:48.931Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:59:48.933Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:59:48.936Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:59:48.938Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:53.912Z"}
{"duration":"3ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:59:54.124Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:54.008Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:54.126Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:59:54.136Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:54.143Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:54.173Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:59:54.176Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T14:57:56.487Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T14:57:56.497Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T14:57:56.500Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T14:57:56.510Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T14:57:56.514Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T14:57:56.517Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T14:57:56.522Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T14:57:56.528Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T14:57:56.531Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T14:57:56.533Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T14:57:56.534Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T14:57:56.536Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:56.693Z"}
{"level":"debug","message":"Executing query [m8omebk0ak5qlxh9q29]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:56.736Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:56.873Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:56.948Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:57.067Z"}
{"level":"debug","message":"Executing query [m8omebuqbfms8q4z08v]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:57.123Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:56.917Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T14:57:57.095Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:57.448Z"}
{"level":"debug","message":"Executing query [m8omec3xdhvywg4g6xq]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:57.454Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T14:57:57.437Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T14:57:57.576Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:57.547Z"}
{"level":"debug","message":"Executing query [m8omec85oeu5nrj5uki]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:57.605Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T14:57:57.577Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T14:57:57.577Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T14:57:57.578Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T14:57:57.579Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T14:57:57.579Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:58.022Z"}
{"level":"debug","message":"Executing query [m8omecl188cdu45k4rk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:58.070Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:58.133Z"}
{"level":"debug","message":"Executing query [m8omecnw3gffrx33dxg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:58.172Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:58.250Z"}
{"level":"debug","message":"Executing query [m8omedcv21pbvyngfd7]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:59.071Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.214Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.214Z"}
{"executionTime":2481,"level":"warn","message":"Slow query detected [m8omebk0ak5qlxh9q29] - 2481ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-25T14:57:59.217Z"}
{"executionTime":1149,"level":"warn","message":"Slow query detected [m8omecl188cdu45k4rk] - 1149ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-25T14:57:59.218Z"}
{"executionTime":1047,"level":"warn","message":"Slow query detected [m8omecnw3gffrx33dxg] - 1047ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-25T14:57:59.219Z"}
{"level":"debug","message":"Executing query [m8omedgyr4v5c9l7q0l]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742914676733\"]","timestamp":"2025-03-25T14:57:59.218Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.220Z"}
{"level":"debug","message":"Executing query [m8omedgz9q8ffhvmvja]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T14:57:59.219Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.221Z"}
{"level":"debug","message":"Executing query [m8omedgzue0wc0bbrx]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T14:57:59.219Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.221Z"}
{"executionTime":2098,"level":"warn","message":"Slow query detected [m8omebuqbfms8q4z08v] - 2098ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-25T14:57:59.220Z"}
{"level":"debug","message":"Executing query [m8omedh0uktb7gtpew]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742914678170\"]","timestamp":"2025-03-25T14:57:59.220Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.222Z"}
{"level":"debug","message":"Executing query [m8omedh4zmnr4i5zxfo]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T14:57:59.225Z"}
{"executionTime":1618,"level":"warn","message":"Slow query detected [m8omec85oeu5nrj5uki] - 1618ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-25T14:57:59.223Z"}
{"level":"debug","message":"Executing query [m8omedh39avg33cxcul]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T14:57:59.224Z"}
{"level":"debug","message":"Executing query [m8omedh0511op2zltj]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T14:57:59.221Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T14:57:59.225Z"}
{"level":"debug","message":"Executing query [m8omedh52arf1vo62w6]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T14:57:59.225Z"}
{"level":"debug","message":"Executing query [m8omedh56aq8efsojyj]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742914678170\",true]","timestamp":"2025-03-25T14:57:59.225Z"}
{"level":"debug","message":"Executing query [m8omedh7ietyetayhs]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T14:57:59.227Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.224Z"}
{"level":"debug","message":"Executing query [m8omedh7k7qspmgdsvs]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T14:57:59.227Z"}
{"level":"debug","message":"Executing query [m8omedh9xdssi96br3s]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742914677604\"]","timestamp":"2025-03-25T14:57:59.229Z"}
{"level":"debug","message":"Executing query [m8omedh337f3l1yu98v]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T14:57:59.223Z"}
{"level":"debug","message":"Executing query [m8omedh9fdga0ewnzl7]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T14:57:59.229Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T14:57:59.229Z"}
{"level":"debug","message":"Executing query [m8omedhamx2pvu1b93d]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T14:57:59.230Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T14:57:59.226Z"}
{"level":"debug","message":"Executing query [m8omedh65936adoder7]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T14:57:59.226Z"}
{"level":"debug","message":"Executing query [m8omedhagi237g0nc4u]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T14:57:59.230Z"}
{"level":"debug","message":"Executing query [m8omedhdq8dnud07ezr]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742914677604\",\"TEST-OFICIO-1742914677604\",1044,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T14:57:59.233Z"}
{"level":"debug","message":"Executing query [m8omedh9eavty30eq48]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T14:57:59.230Z"}
{"level":"debug","message":"Executing query [m8omedhejp3n0aoi7h]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.234Z"}
{"level":"debug","message":"Executing query [m8omedhdqigsr7han]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T14:57:59.233Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.234Z"}
{"level":"debug","message":"Executing query [m8omedhd0k1qavrrbj5e]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T14:57:59.234Z"}
{"level":"debug","message":"Executing query [m8omedhjmhzqh658yeb]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T14:57:59.239Z"}
{"level":"debug","message":"Executing query [m8omedhjvgfl0bfxymg]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742914678170\"]","timestamp":"2025-03-25T14:57:59.240Z"}
{"executionTime":1785,"level":"warn","message":"Slow query detected [m8omec3xdhvywg4g6xq] - 1785ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-25T14:57:59.238Z"}
{"level":"debug","message":"Executing query [m8omedhigep93biunrm]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T14:57:59.238Z"}
{"level":"debug","message":"Executing query [m8omedhkr9el5jrxgyf]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.240Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8omedhd0k1qavrrbj5e]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T14:57:59.240Z"}
{"level":"debug","message":"Executing query [m8omedhmvjm3i38zi4g]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.242Z"}
{"level":"debug","message":"Executing query [m8omedhotpz41fo98pm]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[30,888,30,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T14:57:59.244Z\",\"ACTIVO\"]","timestamp":"2025-03-25T14:57:59.244Z"}
{"level":"debug","message":"Executing query [m8omedhnbgwxkk02het]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",29]","timestamp":"2025-03-25T14:57:59.243Z"}
{"level":"debug","message":"Executing query [m8omedhptwxodxpmim]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742914677451\"]","timestamp":"2025-03-25T14:57:59.245Z"}
{"level":"debug","message":"Executing query [m8omedhqeciu8kobk7s]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.246Z"}
{"level":"debug","message":"Executing query [m8omedhs5wpgttjmc9o]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742914677451\",\"TEST-OFI-FORENSE-1742914677451\",899,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742914677451\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T14:57:59.248Z"}
{"level":"debug","message":"Executing query [m8omedhrprb1nmzcevo]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742914677604\"]","timestamp":"2025-03-25T14:57:59.247Z"}
{"level":"debug","message":"Executing query [m8omedhscu6njzumqc5]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.248Z"}
{"level":"debug","message":"Executing query [m8omedhuqvgyymqr0n]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",29]","timestamp":"2025-03-25T14:57:59.250Z"}
{"level":"debug","message":"Executing query [m8omedhugaz9p6mtkrt]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.250Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 30, Área ID: 888, Rol ID: 888, Documento ID: 29","timestamp":"2025-03-25T14:57:59.250Z"}
{"level":"debug","message":"Executing query [m8omedhvvfce17ae87d]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[29,30,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T14:57:59.251Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:57:59.242Z"}
{"level":"debug","message":"Executing query [m8omedhu469cs92b569]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",29]","timestamp":"2025-03-25T14:57:59.250Z"}
{"level":"debug","message":"Executing query [m8omedi1vhdo0rxwmh]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.257Z"}
{"level":"debug","message":"Executing query [m8omedi39eecldvgjv]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.259Z"}
{"level":"debug","message":"Executing query [m8omedi2rbyh9g7y4r]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.258Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omedhvvfce17ae87d]","params":"[29,30,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T14:57:59.260Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T14:57:59.260Z"}
{"level":"debug","message":"Executing query [m8omedi5ujggh2k2s3k]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.261Z"}
{"level":"debug","message":"Executing query [m8omedi1ywrc10n1ed]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.257Z"}
{"level":"debug","message":"Executing query [m8omedi5y2vvfcfxhx]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.261Z"}
{"level":"debug","message":"Executing query [m8omedi4ecvwh4crkpg]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.260Z"}
{"level":"debug","message":"Executing query [m8omedi4azc1a11oycf]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.261Z"}
{"level":"debug","message":"Executing query [m8omedi8iw0qjptm87q]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.264Z"}
{"level":"debug","message":"Executing query [m8omedi8nmvchqd7zho]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742914677451\"]","timestamp":"2025-03-25T14:57:59.264Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omedi5ujggh2k2s3k]","params":"[29]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T14:57:59.265Z"}
{"level":"debug","message":"Executing query [m8omedicn6e5im9beb]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",29]","timestamp":"2025-03-25T14:57:59.268Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T14:57:59.266Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T14:57:59.266Z"}
{"level":"debug","message":"Executing query [m8omedibn4p8pjp6lnp]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[29,30,\"RESTAURAR\"]","timestamp":"2025-03-25T14:57:59.267Z"}
{"level":"debug","message":"Executing query [m8omedieyu27cj8atw]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.270Z"}
{"level":"debug","message":"Executing query [m8omedig04cc3c57r6sy]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.272Z"}
{"level":"debug","message":"Executing query [m8omedim1ysih2y6fp8]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.278Z"}
{"level":"debug","message":"Executing query [m8omediow9ps15thb4k]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.280Z"}
{"level":"debug","message":"Executing query [m8omedijm2t2kovo8fs]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.275Z"}
{"level":"debug","message":"Executing query [m8omediljco5uxbxz2f]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T14:57:59.277Z"}
{"level":"debug","message":"Executing query [m8omedipzabx2dqe9gi]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:57:59.281Z"}
{"level":"debug","message":"Executing query [m8omedisvbjtp45t2xf]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[29,30,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T14:57:59.284Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:57:59.283Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omedisvbjtp45t2xf]","params":"[29,30,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T14:57:59.290Z"}
{"level":"debug","message":"Executing query [m8omedikg6xrzwk3ezn]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.276Z"}
{"level":"debug","message":"Executing query [m8omedinm45x8g42rra]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.279Z"}
{"level":"debug","message":"Executing query [m8omediu9wxj9ohjtd]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.286Z"}
{"level":"debug","message":"Executing query [m8omedii54im1bq55zi]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.274Z"}
{"level":"debug","message":"Executing query [m8omedixuyxwy5kh0r]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.289Z"}
{"level":"debug","message":"Executing query [m8omedimwyo8bp93po]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:57:59.278Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:57:59.281Z"}
{"level":"debug","message":"Executing query [m8omedip7medxkejiu3]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742914679281\",\"TEST-SP-OFICIO-1742914679281\",921,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T14:57:59.281Z"}
{"level":"debug","message":"Executing query [m8omediugw0g7w63msk]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742914679281\"]","timestamp":"2025-03-25T14:57:59.286Z"}
{"level":"debug","message":"Executing query [m8omedixcniuvcfsjz]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742914679281\"]","timestamp":"2025-03-25T14:57:59.289Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T14:57:59.290Z"}
{"level":"debug","message":"Executing query [m8omediyel1aqd4imqj]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.290Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omediyel1aqd4imqj]","params":"[29]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T14:57:59.293Z"}
{"level":"debug","message":"Executing query [m8omedj1yxl0x8vp8mj]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.293Z"}
{"level":"debug","message":"Executing query [m8omedj1qji80hg903r]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:57:59.293Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T14:57:59.293Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T14:57:59.293Z"}
{"level":"debug","message":"Executing query [m8omedj2zsreoarevw]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[30,888,30,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T14:57:59.294Z\",\"ACTIVO\"]","timestamp":"2025-03-25T14:57:59.294Z"}
{"level":"debug","message":"Executing query [m8omedj4ozg223ocn3]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742914679296\",\"TEST-SP-OFI-FORENSE-1742914679296\",8510,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T14:57:59.296Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:57:59.296Z"}
{"level":"debug","message":"Executing query [m8omedj8ogh0gb41gjg]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T14:57:59.300Z"}
{"level":"debug","message":"Executing query [m8omedj9t1d8z24hqjl]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742914679296\"]","timestamp":"2025-03-25T14:57:59.301Z"}
{"level":"debug","message":"Executing query [m8omedjcoeue71y0d0e]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742914679296\"]","timestamp":"2025-03-25T14:57:59.304Z"}
{"level":"debug","message":"Executing query [m8omedjevyynoczrohm]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742914676733\"]","timestamp":"2025-03-25T14:57:59.306Z"}
{"level":"debug","message":"Executing query [m8omedjgrbr6wqmmlzm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:57:59.308Z"}
{"level":"debug","message":"Executing query [m8omedjd50wr4ncmfsg]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[30,\"DOCUMENTO\",30,\"ELIMINAR\"]","timestamp":"2025-03-25T14:57:59.305Z"}
{"level":"debug","message":"Executing query [m8omedji5fofremh88]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[30]","timestamp":"2025-03-25T14:57:59.310Z"}
{"level":"debug","message":"Executing query [m8omedjgxqrvtvu64ne]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742914676733\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T14:57:59.308Z"}
{"level":"debug","message":"Executing query [m8omedjnpkyxy3j1e3]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T14:57:59.315Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:57:59.311Z"}
{"level":"debug","message":"Executing query [m8omedjru77ayrxufpr]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T14:57:59.319Z"}
{"level":"debug","message":"Executing query [m8omedjsodu57i0uqr]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[30]","timestamp":"2025-03-25T14:57:59.321Z"}
{"level":"debug","message":"Executing query [m8omedjx6g5ylrogv0g]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T14:57:59.325Z"}
{"level":"debug","message":"Executing query [m8omedjx7qwhw2rvz8d]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742914676733\"]","timestamp":"2025-03-25T14:57:59.325Z"}
{"level":"debug","message":"Executing query [m8omedjzuhpx1cl5xb]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T14:57:59.327Z"}
{"level":"debug","message":"Executing query [m8omedk1eca8s47s3an]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T14:57:59.329Z"}
{"level":"debug","message":"Executing query [m8omedk1xg1oecfrree]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1013]","timestamp":"2025-03-25T14:57:59.329Z"}
{"level":"debug","message":"Executing query [m8omedk5ntl2nau4yfd]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T14:57:59.334Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T14:57:59.334Z"}
{"level":"debug","message":"Executing query [m8omedk6tiazvxtao3]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:57:59.334Z"}
{"level":"debug","message":"Executing query [m8omedk9htbz3kzvsmc]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T14:57:59.337Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:57:59.337Z"}
{"level":"debug","message":"Executing query [m8omedkgbcmklvej19k]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T14:57:59.344Z"}
{"level":"debug","message":"Executing query [m8omedkjj3v67enn5ed]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T14:57:59.347Z"}
{"level":"debug","message":"Executing query [m8omedkmg8wzbf9xbos]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T14:57:59.350Z"}
{"level":"debug","message":"Executing query [m8omedkq8m0ox5yr9oa]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T14:57:59.355Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T14:57:59.232Z"}
{"level":"debug","message":"Executing query [m8omedkp1qgsqgzybu3]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T14:57:59.353Z"}
{"level":"debug","message":"Executing query [m8omedktjb7mkey2r2n]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T14:57:59.357Z"}
{"level":"debug","message":"Executing query [m8omedkv46vwvyb2y8a]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:57:59.359Z"}
{"level":"debug","message":"Executing query [m8omedkuqwi7i8a8umh]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T14:57:59.359Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:57:59.362Z"}
{"level":"debug","message":"Executing query [m8omedkynvz82qajmhf]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[27]","timestamp":"2025-03-25T14:57:59.362Z"}
{"level":"debug","message":"Executing query [m8omedl3kv5a2oonapg]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:57:59.367Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:59.652Z"}
{"level":"debug","message":"Executing query [m8omedt5tc2pdci9yxj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:59.657Z"}
{"level":"debug","message":"Executing query [m8omedw0wel515eiyb]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T14:57:59.760Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.762Z"}
{"level":"debug","message":"Executing query [m8omedw57kfbexaij2l]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742914679655\"]","timestamp":"2025-03-25T14:57:59.765Z"}
{"level":"debug","message":"Executing query [m8omedw7smc7ht9utx]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742914679655\",\"TEST-OFI-QUIMICA-1742914679655\",7938,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T14:57:59.767Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:59.603Z"}
{"level":"debug","message":"Executing query [m8omedwe80epxi6xhi]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[15]","timestamp":"2025-03-25T14:57:59.774Z"}
{"level":"debug","message":"Executing query [m8omedwjkteyq10s64]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742914679655\"]","timestamp":"2025-03-25T14:57:59.779Z"}
{"level":"debug","message":"Executing query [m8omedwlsekmehwmk3n]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",15]","timestamp":"2025-03-25T14:57:59.781Z"}
{"level":"debug","message":"Executing query [m8omedwpzhtpcxy7x0k]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[15]","timestamp":"2025-03-25T14:57:59.785Z"}
{"level":"debug","message":"Executing query [m8omedwst8zhkp0jx3]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[15]","timestamp":"2025-03-25T14:57:59.788Z"}
{"level":"debug","message":"Executing query [m8omedwxkh07tuokr5r]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[15]","timestamp":"2025-03-25T14:57:59.793Z"}
{"level":"debug","message":"Executing query [m8omedx0gp2n1d1manj]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[15]","timestamp":"2025-03-25T14:57:59.796Z"}
{"level":"debug","message":"Executing query [m8omedx3x4rybpfn14]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[15]","timestamp":"2025-03-25T14:57:59.799Z"}
{"level":"debug","message":"Executing query [m8omedx654syvnkr9ih]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:57:59.802Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:57:59.804Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:58.369Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T14:57:59.558Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T14:57:59.579Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.944Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:59.920Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:59.934Z"}
{"level":"debug","message":"Executing query [m8omee0wb3a72e0wtkw]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:59.936Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.961Z"}
{"level":"debug","message":"Executing query [m8omee1npn2salyb19]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T14:57:59.963Z"}
{"level":"debug","message":"Executing query [m8omee1qch0dnmzk6kr]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T14:57:59.966Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T14:57:59.969Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T14:57:59.971Z"}
{"level":"debug","message":"Executing query [m8omee1tvdfajuktvql]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T14:57:59.969Z"}
{"level":"debug","message":"Executing query [m8omee1v2vknpn7sopj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T14:57:59.971Z"}
{"level":"debug","message":"Executing query [m8omee1zn7eem49im3]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T14:57:59.975Z"}
{"level":"debug","message":"Executing query [m8omee20biykxnvy1e]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T14:57:59.976Z"}
{"level":"debug","message":"Executing query [m8omee28zx6aoglixrm]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[31]","timestamp":"2025-03-25T14:57:59.984Z"}
{"level":"debug","message":"Executing query [m8omee2d1mf8j03zozu]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T14:57:59.989Z"}
{"level":"debug","message":"Executing query [m8omee2h46wcjz6qy14]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",31]","timestamp":"2025-03-25T14:57:59.993Z"}
{"level":"debug","message":"Executing query [m8omee2m2gnylzz91m7]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[31]","timestamp":"2025-03-25T14:57:59.998Z"}
{"level":"debug","message":"Executing query [m8omee2pkftt3q11xeh]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[31]","timestamp":"2025-03-25T14:58:00.001Z"}
{"level":"debug","message":"Executing query [m8omee2xdv7yi33a6ff]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[31]","timestamp":"2025-03-25T14:58:00.009Z"}
{"level":"debug","message":"Executing query [m8omee325ms4dryyel8]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T14:58:00.014Z"}
{"level":"debug","message":"Executing query [m8omee35ng0npk6ch0b]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T14:58:00.017Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T14:58:00.019Z"}
{"level":"debug","message":"Executing query [m8omee3780q8sbv0b3g]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:58:00.019Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:58:00.021Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:58:00.088Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:58:00.678Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T14:58:00.894Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:58:00.976Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:58:00.864Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:58:00.861Z"}
{"level":"debug","message":"Executing query [m8omeeuqhg7c9bxryt7]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T14:58:01.010Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:58:01.023Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T14:58:01.026Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:58:01.041Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:58:01.047Z"}
{"duration":"26ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T14:58:01.051Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T14:58:01.057Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:58:01.062Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:06:06.079Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:06:06.097Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:06:06.106Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:06:06.112Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:06:06.117Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:06:06.127Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:06:06.132Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:06:06.137Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:06:06.139Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:06:06.142Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:06:06.144Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T15:06:06.146Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:06.330Z"}
{"level":"debug","message":"Executing query [m8omotdx5nut1qzkrxc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:06.405Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:06.474Z"}
{"level":"debug","message":"Executing query [m8omotfyacrefh54r8s]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915166401\"]","timestamp":"2025-03-25T15:06:06.478Z"}
{"level":"debug","message":"Executing query [m8omothf1nfeclze65g]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915166401\"]","timestamp":"2025-03-25T15:06:06.531Z"}
{"level":"debug","message":"Executing query [m8omothi14azkiltkowj]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742915166401\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:06:06.534Z"}
{"level":"debug","message":"Executing query [m8omothuuy4mbd997j]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T15:06:06.546Z"}
{"level":"debug","message":"Executing query [m8omothzxfg3jzr5qed]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915166401\"]","timestamp":"2025-03-25T15:06:06.551Z"}
{"level":"debug","message":"Executing query [m8omoti7et4bcgasliv]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1014]","timestamp":"2025-03-25T15:06:06.559Z"}
{"level":"debug","message":"Executing query [m8omotic5vls1lfkkpw]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T15:06:06.564Z"}
{"level":"debug","message":"Executing query [m8omotif23cdzs391co]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T15:06:06.567Z"}
{"level":"debug","message":"Executing query [m8omotijy6wjt9ylp8]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T15:06:06.571Z"}
{"level":"debug","message":"Executing query [m8omotimwuyql7w1ltd]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T15:06:06.574Z"}
{"level":"debug","message":"Executing query [m8omotipauxbhu4e449]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T15:06:06.577Z"}
{"level":"debug","message":"Executing query [m8omotivc3hq5stji9m]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T15:06:06.583Z"}
{"level":"debug","message":"Executing query [m8omotix2j7n4upoevw]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T15:06:06.585Z"}
{"level":"debug","message":"Executing query [m8omotj0j7xad648mxj]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:06.588Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:06.590Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T15:06:06.624Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:06.759Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:06.779Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:06.622Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:06.899Z"}
{"level":"debug","message":"Executing query [m8omotrvvon2211wxdp]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T15:06:06.907Z"}
{"level":"debug","message":"Executing query [m8omotrzre1q9rp838]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T15:06:06.911Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8omotrzre1q9rp838]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T15:06:06.916Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:06.920Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:06.890Z"}
{"level":"debug","message":"Executing query [m8omotsyuxuoboh915]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:06.946Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:07.014Z"}
{"level":"debug","message":"Executing query [m8omotuwf1qqhh038gj]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T15:06:07.016Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T15:06:07.021Z"}
{"level":"debug","message":"Executing query [m8omotv2mawxh4kx87h]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T15:06:07.022Z"}
{"level":"debug","message":"Executing query [m8omotv4q6rfbntv3ki]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T15:06:07.024Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T15:06:07.026Z"}
{"level":"debug","message":"Executing query [m8omotv6xx7unm8o22]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T15:06:07.026Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T15:06:07.029Z"}
{"level":"debug","message":"Executing query [m8omotxfce19zwyvvra]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T15:06:07.107Z"}
{"level":"debug","message":"Executing query [m8omotxprzx9li5y89]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T15:06:07.118Z"}
{"level":"debug","message":"Executing query [m8omotxuejuo4fwrv49]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[29]","timestamp":"2025-03-25T15:06:07.122Z"}
{"level":"debug","message":"Executing query [m8omoty3fg124hm8k0t]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:07.131Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T15:06:06.953Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:07.221Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T15:06:07.138Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T15:06:07.139Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T15:06:07.140Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T15:06:07.141Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T15:06:07.142Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T15:06:07.142Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:07.276Z"}
{"level":"debug","message":"Executing query [m8omou24ut3e8q55je]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:07.276Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:07.347Z"}
{"level":"debug","message":"Executing query [m8omou48bmc96owdylq]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:06:07.352Z"}
{"level":"debug","message":"Executing query [m8omou4d55fhl0ortrw]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742915167274\"]","timestamp":"2025-03-25T15:06:07.358Z"}
{"level":"debug","message":"Executing query [m8omou4ggdnfb77butp]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742915167274\",\"TEST-OFI-FORENSE-1742915167274\",8921,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742915167274\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:06:07.360Z"}
{"level":"debug","message":"Executing query [m8omou4qls5hrxv2cj]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.370Z"}
{"level":"debug","message":"Executing query [m8omou4wnn97rdd0dvs]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742915167274\"]","timestamp":"2025-03-25T15:06:07.376Z"}
{"level":"debug","message":"Executing query [m8omou50lmwo31yd4p8]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",31]","timestamp":"2025-03-25T15:06:07.380Z"}
{"level":"debug","message":"Executing query [m8omou540dqoixk9yo68]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.384Z"}
{"level":"debug","message":"Executing query [m8omou57znfwbn6ivx]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.387Z"}
{"level":"debug","message":"Executing query [m8omou5ce1tkanbd2qc]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.392Z"}
{"level":"debug","message":"Executing query [m8omou5fmshokyyatso]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.395Z"}
{"level":"debug","message":"Executing query [m8omou5jpk2zeh4bj4]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.399Z"}
{"level":"debug","message":"Executing query [m8omou5madag4fawva]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742915167402\",\"TEST-SP-OFI-FORENSE-1742915167402\",6356,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T15:06:07.402Z"}
{"level":"debug","message":"Executing query [m8omou5serwu0gaj07r]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742915167402\"]","timestamp":"2025-03-25T15:06:07.409Z"}
{"level":"debug","message":"Executing query [m8omou5vbe7mpgmv1fc]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742915167402\"]","timestamp":"2025-03-25T15:06:07.411Z"}
{"level":"debug","message":"Executing query [m8omou5z0ofl5tsqk7as]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:07.415Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:07.419Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:07.382Z"}
{"level":"debug","message":"Executing query [m8omou5cu45jjm288xr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:07.392Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:07.447Z"}
{"level":"debug","message":"Executing query [m8omou6xnidx6kd75cj]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742915167389\"]","timestamp":"2025-03-25T15:06:07.449Z"}
{"level":"debug","message":"Executing query [m8omou6zpnmsgfnn7g9]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742915167389\",true]","timestamp":"2025-03-25T15:06:07.451Z"}
{"level":"debug","message":"Executing query [m8omou3obkb5s6sxfiw]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:07.332Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:07.448Z"}
{"level":"debug","message":"Executing query [m8omou77c3lr6vfvlkb]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.459Z"}
{"level":"debug","message":"Executing query [m8omou7cjsxcsfnkm2]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742915167389\"]","timestamp":"2025-03-25T15:06:07.464Z"}
{"level":"debug","message":"Executing query [m8omou7goh24yl6aebi]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",31]","timestamp":"2025-03-25T15:06:07.468Z"}
{"level":"debug","message":"Executing query [m8omou7flcbdxyoxk1l]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:06:07.467Z"}
{"level":"debug","message":"Executing query [m8omou7khrj1w1vp7nc]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.472Z"}
{"level":"debug","message":"Executing query [m8omou7nugldj1q989]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.476Z"}
{"level":"debug","message":"Executing query [m8omou7rjglwqfqtc68]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.480Z"}
{"level":"debug","message":"Executing query [m8omou7u40pylr5c9a]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.482Z"}
{"level":"debug","message":"Executing query [m8omou7wr914gw9vet]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.484Z"}
{"level":"debug","message":"Executing query [m8omou80hdws8pgqw99]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.488Z"}
{"level":"debug","message":"Executing query [m8omou82hppe3vvyoyt]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T15:06:07.490Z"}
{"level":"debug","message":"Executing query [m8omou82gkx9ofdbn2l]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742915167325\"]","timestamp":"2025-03-25T15:06:07.490Z"}
{"level":"debug","message":"Executing query [m8omou84yw770s9jhfe]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:07.492Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:07.494Z"}
{"level":"debug","message":"Executing query [m8omou8eqc1r9clkcs]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742915167325\",\"TEST-OFICIO-1742915167325\",6082,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:06:07.502Z"}
{"level":"debug","message":"Executing query [m8omou8ld6h7h0tk1ri]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.509Z"}
{"level":"debug","message":"Executing query [m8omou8rgap2pgvmgbw]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742915167325\"]","timestamp":"2025-03-25T15:06:07.515Z"}
{"level":"debug","message":"Executing query [m8omou8uef34tk959rv]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",31]","timestamp":"2025-03-25T15:06:07.518Z"}
{"level":"debug","message":"Executing query [m8omou8yhxmaeiqytul]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.522Z"}
{"level":"debug","message":"Executing query [m8omou92gknzndeiylc]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.526Z"}
{"level":"debug","message":"Executing query [m8omou9790j9n1w78wa]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.531Z"}
{"level":"debug","message":"Executing query [m8omou9bdxl18x78esa]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.535Z"}
{"level":"debug","message":"Executing query [m8omou9fwx67k2dhn0q]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.539Z"}
{"level":"debug","message":"Executing query [m8omou9ifk29yd9a24j]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742915167542\",\"TEST-SP-OFICIO-1742915167542\",9862,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T15:06:07.543Z"}
{"level":"debug","message":"Executing query [m8omou9mxyajqksge5k]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742915167542\"]","timestamp":"2025-03-25T15:06:07.546Z"}
{"level":"debug","message":"Executing query [m8omou9q49f6ynjya9n]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742915167542\"]","timestamp":"2025-03-25T15:06:07.550Z"}
{"level":"debug","message":"Executing query [m8omou9u9jsno684weo]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:07.554Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:07.556Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:07.554Z"}
{"level":"debug","message":"Executing query [m8omoubgop11p42flyn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:07.612Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:07.707Z"}
{"level":"debug","message":"Executing query [m8omoue9f9aj9s8vij8]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T15:06:07.713Z"}
{"level":"debug","message":"Executing query [m8omouegpd06ux6mcop]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T15:06:07.720Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T15:06:07.724Z"}
{"level":"debug","message":"Executing query [m8omouektqsp81sje5]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T15:06:07.724Z"}
{"level":"debug","message":"Executing query [m8omouencgnmv2zn1jo]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T15:06:07.727Z"}
{"level":"debug","message":"Executing query [m8omoueqmi55n5ek77j]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T15:06:07.730Z"}
{"level":"debug","message":"Executing query [m8omouexv5875rejoi8]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.737Z"}
{"level":"debug","message":"Executing query [m8omouf29o8wad0d45]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.742Z"}
{"level":"debug","message":"Executing query [m8omouf7mqreneyjj6s]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",31]","timestamp":"2025-03-25T15:06:07.747Z"}
{"level":"debug","message":"Executing query [m8omoufcb6sp435dig9]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.752Z"}
{"level":"debug","message":"Executing query [m8omouffkf765sf727]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.755Z"}
{"level":"debug","message":"Executing query [m8omoufkzjlo22a4g89]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.760Z"}
{"level":"debug","message":"Executing query [m8omoufmyf0c0j5emc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:07.762Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:07.764Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:07.614Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:07.820Z"}
{"level":"debug","message":"Executing query [m8omouirnagr7vgcp9m]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:07.875Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:07.944Z"}
{"level":"debug","message":"Executing query [m8omoukrkxx451n0dk]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:06:07.947Z"}
{"level":"debug","message":"Executing query [m8omoukvdyrjkj2jumr]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T15:06:07.951Z"}
{"level":"debug","message":"Executing query [m8omoukyqcj1r2qo1za]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T15:06:07.954Z"}
{"level":"debug","message":"Executing query [m8omoul0gezmln9bs9k]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T15:06:07.956Z"}
{"level":"debug","message":"Executing query [m8omoul62ewesr47ar1]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T15:06:07.962Z"}
{"level":"debug","message":"Executing query [m8omoulan7ssnv36jdr]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[32,888,32,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T15:06:07.966Z\",\"ACTIVO\"]","timestamp":"2025-03-25T15:06:07.966Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 32, Área ID: 888, Rol ID: 888, Documento ID: 31","timestamp":"2025-03-25T15:06:07.970Z"}
{"level":"debug","message":"Executing query [m8omoulfe73p98kpd1v]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[31,32,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T15:06:07.971Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omoulfe73p98kpd1v]","params":"[31,32,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T15:06:07.978Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T15:06:07.979Z"}
{"level":"debug","message":"Executing query [m8omouln2b99v3gmarx]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.979Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omouln2b99v3gmarx]","params":"[31]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T15:06:07.982Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T15:06:07.983Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T15:06:07.983Z"}
{"level":"debug","message":"Executing query [m8omouls2142kfjhipe]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[31,32,\"RESTAURAR\"]","timestamp":"2025-03-25T15:06:07.984Z"}
{"level":"debug","message":"Executing query [m8omoulyjpy6o1dmqu]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.990Z"}
{"level":"debug","message":"Executing query [m8omoum1326v6qr4fox]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[31,32,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T15:06:07.993Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omoum1326v6qr4fox]","params":"[31,32,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T15:06:07.998Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T15:06:07.998Z"}
{"level":"debug","message":"Executing query [m8omoum68f78ivcrb8]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.998Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omoum68f78ivcrb8]","params":"[31]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T15:06:08.002Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T15:06:08.002Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T15:06:08.002Z"}
{"level":"debug","message":"Executing query [m8omoumbvd6yrgc3zm8]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[32,888,32,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T15:06:08.003Z\",\"ACTIVO\"]","timestamp":"2025-03-25T15:06:08.003Z"}
{"level":"debug","message":"Executing query [m8omoumgnjb3l5g2g5]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T15:06:08.008Z"}
{"level":"debug","message":"Executing query [m8omoummmphtbpbe27h]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[32,\"DOCUMENTO\",32,\"ELIMINAR\"]","timestamp":"2025-03-25T15:06:08.014Z"}
{"level":"debug","message":"Executing query [m8omoumtafrepxs5wyf]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[32]","timestamp":"2025-03-25T15:06:08.022Z"}
{"level":"debug","message":"Executing query [m8omoumzsvkgsodn8bg]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T15:06:08.027Z"}
{"level":"debug","message":"Executing query [m8omoun48niub3y64jh]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[32]","timestamp":"2025-03-25T15:06:08.032Z"}
{"level":"debug","message":"Executing query [m8omoun9q3r2ip8pgqr]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:06:08.037Z"}
{"level":"debug","message":"Executing query [m8omouncqr1c56ru2nm]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:06:08.040Z"}
{"level":"debug","message":"Executing query [m8omounedrb8hp8kpn6]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:06:08.042Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T15:06:08.047Z"}
{"level":"debug","message":"Executing query [m8omounjtzw6bibkfq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:08.047Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:08.050Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:08.048Z"}
{"level":"debug","message":"Executing query [m8omouot516e0ktf7eh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:08.094Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:08.136Z"}
{"level":"debug","message":"Executing query [m8omouq4i4loi1nyct]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:06:08.140Z"}
{"level":"debug","message":"Executing query [m8omouq94ru7hfnn8vv]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742915168092\"]","timestamp":"2025-03-25T15:06:08.145Z"}
{"level":"debug","message":"Executing query [m8omouqbj5wlabb8o6k]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742915168092\",\"TEST-OFI-QUIMICA-1742915168092\",4919,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:06:08.147Z"}
{"level":"debug","message":"Executing query [m8omouqixlmlehxv1nf]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[16]","timestamp":"2025-03-25T15:06:08.154Z"}
{"level":"debug","message":"Executing query [m8omouqnti6hrg6ykae]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742915168092\"]","timestamp":"2025-03-25T15:06:08.159Z"}
{"level":"debug","message":"Executing query [m8omouqqtp7woydh0am]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",16]","timestamp":"2025-03-25T15:06:08.162Z"}
{"level":"debug","message":"Executing query [m8omouqu9t6rx5e3h3e]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[16]","timestamp":"2025-03-25T15:06:08.167Z"}
{"level":"debug","message":"Executing query [m8omouqyo5pmj3ae3nd]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[16]","timestamp":"2025-03-25T15:06:08.170Z"}
{"level":"debug","message":"Executing query [m8omour3r3kugupb1ch]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[16]","timestamp":"2025-03-25T15:06:08.175Z"}
{"level":"debug","message":"Executing query [m8omour5jlq45jjn9q]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[16]","timestamp":"2025-03-25T15:06:08.177Z"}
{"level":"debug","message":"Executing query [m8omour9ilg4ihhj26]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[16]","timestamp":"2025-03-25T15:06:08.181Z"}
{"level":"debug","message":"Executing query [m8omourcews0awhpfir]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:08.184Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:08.186Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:08.157Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:08.174Z"}
{"level":"debug","message":"Executing query [m8omour4rdox6ttvx6j]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:08.177Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:08.214Z"}
{"level":"debug","message":"Executing query [m8omousafga5jp48ymk]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T15:06:08.218Z"}
{"level":"debug","message":"Executing query [m8omouscb51y7h26k8t]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T15:06:08.220Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T15:06:08.222Z"}
{"level":"debug","message":"Executing query [m8omousf59scf8xirle]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:06:08.223Z"}
{"level":"debug","message":"Executing query [m8omoushguwg5bxh1f]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:06:08.225Z"}
{"level":"debug","message":"Executing query [m8omouskkccunppub6]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:06:08.228Z"}
{"level":"debug","message":"Executing query [m8omousl4el97k4zcim]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T15:06:08.229Z"}
{"level":"debug","message":"Executing query [m8omousrbig26ivjbgk]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[33]","timestamp":"2025-03-25T15:06:08.235Z"}
{"level":"debug","message":"Executing query [m8omousve3lg782l88]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:06:08.239Z"}
{"level":"debug","message":"Executing query [m8omousxfsv6kyrhlwv]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",33]","timestamp":"2025-03-25T15:06:08.242Z"}
{"level":"debug","message":"Executing query [m8omout2081ze2z3hqfv]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[33]","timestamp":"2025-03-25T15:06:08.246Z"}
{"level":"debug","message":"Executing query [m8omout47jzf0ptt7xc]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[33]","timestamp":"2025-03-25T15:06:08.248Z"}
{"level":"debug","message":"Executing query [m8omout75nbu174ex9k]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[33]","timestamp":"2025-03-25T15:06:08.251Z"}
{"level":"debug","message":"Executing query [m8omout9ukpti4j4d3e]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:06:08.253Z"}
{"level":"debug","message":"Executing query [m8omouta5btxyzsj9ei]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:06:08.254Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T15:06:08.256Z"}
{"level":"debug","message":"Executing query [m8omoutcpb48o2snw8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:08.256Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:08.258Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:08.448Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T15:06:08.660Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T15:06:08.674Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:08.874Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T15:06:08.891Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:08.958Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:09.009Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T15:06:09.177Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:09.287Z"}
{"level":"debug","message":"Executing query [m8omovmsnntu6bnbl7h]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T15:06:09.316Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:09.352Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:09.776Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:09.945Z"}
{"duration":"28ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T15:06:09.948Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T15:06:09.956Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:09.960Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:09.936Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:10.064Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T15:06:10.066Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T15:08:24.221Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T15:08:24.224Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.227Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.280Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.286Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.300Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.306Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.311Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.392Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.400Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.403Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:47.820Z"}
{"level":"debug","message":"Executing query [m8omuujnyhh944c2exa]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:47.843Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:47.880Z"}
{"level":"debug","message":"Executing query [m8omuukrq7yhhnaukk]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915447842\"]","timestamp":"2025-03-25T15:10:47.883Z"}
{"level":"debug","message":"Executing query [m8omuukve95mq7qjdrj]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915447842\"]","timestamp":"2025-03-25T15:10:47.887Z"}
{"level":"debug","message":"Executing query [m8omuukwemja70z4y8i]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742915447842\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:10:47.888Z"}
{"level":"debug","message":"Executing query [m8omuul3dz74mhx1k3]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1015]","timestamp":"2025-03-25T15:10:47.895Z"}
{"level":"debug","message":"Executing query [m8omuul55iopuz8u2tx]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915447842\"]","timestamp":"2025-03-25T15:10:47.897Z"}
{"level":"debug","message":"Executing query [m8omuul879l6gqcwlso]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1015]","timestamp":"2025-03-25T15:10:47.900Z"}
{"level":"debug","message":"Executing query [m8omuulbvdz5h75mlc]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1015]","timestamp":"2025-03-25T15:10:47.903Z"}
{"level":"debug","message":"Executing query [m8omuulehiw3i61hiv]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1015]","timestamp":"2025-03-25T15:10:47.906Z"}
{"level":"debug","message":"Executing query [m8omuulir4iivk514v]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1015]","timestamp":"2025-03-25T15:10:47.910Z"}
{"level":"debug","message":"Executing query [m8omuullb9nmjkz752r]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1015]","timestamp":"2025-03-25T15:10:47.913Z"}
{"level":"debug","message":"Executing query [m8omuulm1o96sq7s1c1]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1015]","timestamp":"2025-03-25T15:10:47.914Z"}
{"level":"debug","message":"Executing query [m8omuulqnif1twxmwq]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1015]","timestamp":"2025-03-25T15:10:47.918Z"}
{"level":"debug","message":"Executing query [m8omuulsdb9gxwoj92v]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T15:10:47.920Z"}
{"level":"debug","message":"Executing query [m8omuululcufq9ay6b]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:47.922Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:47.924Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:10:48.016Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:10:48.019Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:10:48.020Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:10:48.022Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:10:48.028Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:10:48.031Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:10:48.033Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:10:48.036Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:10:48.039Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:10:48.040Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:10:48.042Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T15:10:48.043Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:48.226Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:49.177Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T15:10:49.320Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T15:10:49.326Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:49.381Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T15:10:49.395Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:49.438Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:49.924Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:50.044Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:50.062Z"}
{"level":"debug","message":"Executing query [m8omuw9cq0daqacdllb]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T15:10:50.064Z"}
{"level":"debug","message":"Executing query [m8omuw9f11w865s3a0pg]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T15:10:50.067Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8omuw9f11w865s3a0pg]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T15:10:50.069Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:50.071Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:50.188Z"}
{"level":"debug","message":"Executing query [m8omuwcv38f2ud5sfu7]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:50.191Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:50.205Z"}
{"level":"debug","message":"Executing query [m8omuwdbc6dp7swa1al]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T15:10:50.207Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T15:10:50.208Z"}
{"level":"debug","message":"Executing query [m8omuwdcaj5e0soq47e]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T15:10:50.208Z"}
{"level":"debug","message":"Executing query [m8omuwdd2q1l4ivi414]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T15:10:50.209Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T15:10:50.210Z"}
{"level":"debug","message":"Executing query [m8omuwde4yw06lg6cmr]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T15:10:50.210Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T15:10:50.212Z"}
{"level":"debug","message":"Executing query [m8omuwdk5jf0pmwk4z8]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T15:10:50.216Z"}
{"level":"debug","message":"Executing query [m8omuwdnoi3gx1zffqj]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T15:10:50.219Z"}
{"level":"debug","message":"Executing query [m8omuwdpckb6pugzvj8]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[31]","timestamp":"2025-03-25T15:10:50.221Z"}
{"level":"debug","message":"Executing query [m8omuwdutcftgi9tuf9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:50.226Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:51.980Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T15:10:52.042Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T15:10:52.048Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:52.056Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T15:10:52.059Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T15:10:52.160Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T15:10:52.262Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:52.393Z"}
{"level":"debug","message":"Executing query [m8omuy230e56m8udpcb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:52.395Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:52.407Z"}
{"level":"debug","message":"Executing query [m8omuy2gv9cvc3p4x6h]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:10:52.408Z"}
{"level":"debug","message":"Executing query [m8omuy2ijrt7c52t36n]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742915452395\"]","timestamp":"2025-03-25T15:10:52.410Z"}
{"level":"debug","message":"Executing query [m8omuy2j1ypun7w953l]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742915452395\",\"TEST-OFICIO-1742915452395\",157,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:10:52.411Z"}
{"level":"debug","message":"Executing query [m8omuy2p4j8dxf475wu]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.417Z"}
{"level":"debug","message":"Executing query [m8omuy2tb11c8l0x0l8]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742915452395\"]","timestamp":"2025-03-25T15:10:52.421Z"}
{"level":"debug","message":"Executing query [m8omuy2vqzufxrupc5b]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",33]","timestamp":"2025-03-25T15:10:52.423Z"}
{"level":"debug","message":"Executing query [m8omuy2ydy65co165rh]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.426Z"}
{"level":"debug","message":"Executing query [m8omuy30o5mygtewh2]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.428Z"}
{"level":"debug","message":"Executing query [m8omuy330uihrip18p2]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.431Z"}
{"level":"debug","message":"Executing query [m8omuy362jgpugcon1h]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.434Z"}
{"level":"debug","message":"Executing query [m8omuy3989jw6e9a44w]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.437Z"}
{"level":"debug","message":"Executing query [m8omuy3amrwub20p6h]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742915452438\",\"TEST-SP-OFICIO-1742915452438\",5475,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T15:10:52.438Z"}
{"level":"debug","message":"Executing query [m8omuy3ebiljbrwu88r]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742915452438\"]","timestamp":"2025-03-25T15:10:52.442Z"}
{"level":"debug","message":"Executing query [m8omuy3gj0tzbzbkgh]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742915452438\"]","timestamp":"2025-03-25T15:10:52.444Z"}
{"level":"debug","message":"Executing query [m8omuy3lxqav82vmzc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:52.449Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:52.450Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:52.632Z"}
{"level":"debug","message":"Executing query [m8omuy8rjd1gth7aa6]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:52.635Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:52.647Z"}
{"level":"debug","message":"Executing query [m8omuy96tmvb6qvzg19]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:10:52.650Z"}
{"level":"debug","message":"Executing query [m8omuy97ije343y2dcn]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742915452633\"]","timestamp":"2025-03-25T15:10:52.651Z"}
{"level":"debug","message":"Executing query [m8omuy99w28fx09jzbd]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742915452633\",\"TEST-OFI-FORENSE-1742915452633\",7910,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742915452633\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:10:52.653Z"}
{"level":"debug","message":"Executing query [m8omuy9dtl7osioitmb]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.657Z"}
{"level":"debug","message":"Executing query [m8omuy9g5wsno6dwrae]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742915452633\"]","timestamp":"2025-03-25T15:10:52.660Z"}
{"level":"debug","message":"Executing query [m8omuy9hppd6p1in2fo]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",33]","timestamp":"2025-03-25T15:10:52.661Z"}
{"level":"debug","message":"Executing query [m8omuy9ltasl2ylqkof]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.665Z"}
{"level":"debug","message":"Executing query [m8omuy9nodjda4qz1b]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.667Z"}
{"level":"debug","message":"Executing query [m8omuy9qm1pacqi2ca]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.670Z"}
{"level":"debug","message":"Executing query [m8omuy9slqgjh6376hd]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.672Z"}
{"level":"debug","message":"Executing query [m8omuy9upuqzn42h31g]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.674Z"}
{"level":"debug","message":"Executing query [m8omuy9xhjdbsvah5mg]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742915452677\",\"TEST-SP-OFI-FORENSE-1742915452677\",2795,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T15:10:52.677Z"}
{"level":"debug","message":"Executing query [m8omuya0eqf8771p1zr]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742915452677\"]","timestamp":"2025-03-25T15:10:52.680Z"}
{"level":"debug","message":"Executing query [m8omuya1gyh7u6pamo]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742915452677\"]","timestamp":"2025-03-25T15:10:52.681Z"}
{"level":"debug","message":"Executing query [m8omuya49eomj17lazi]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:52.684Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:52.686Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:53.486Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:53.533Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T15:10:53.534Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T15:10:53.628Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T15:10:53.629Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T15:10:53.630Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T15:10:53.631Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T15:10:53.632Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T15:10:53.632Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:54.004Z"}
{"level":"debug","message":"Executing query [m8omuzau63k5xa6pwnh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:54.007Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:54.018Z"}
{"level":"debug","message":"Executing query [m8omuzb7gyb67y570yq]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742915454006\"]","timestamp":"2025-03-25T15:10:54.019Z"}
{"level":"debug","message":"Executing query [m8omuzb8mu6068q4ujr]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742915454006\",true]","timestamp":"2025-03-25T15:10:54.021Z"}
{"level":"debug","message":"Executing query [m8omuzbf9fp128z235b]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.027Z"}
{"level":"debug","message":"Executing query [m8omuzbhscezlq74gp]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742915454006\"]","timestamp":"2025-03-25T15:10:54.029Z"}
{"level":"debug","message":"Executing query [m8omuzbkbtid5jq6joo]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",33]","timestamp":"2025-03-25T15:10:54.032Z"}
{"level":"debug","message":"Executing query [m8omuzboc9chorcfs27]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.036Z"}
{"level":"debug","message":"Executing query [m8omuzbq6tkfe5mb3bn]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.039Z"}
{"level":"debug","message":"Executing query [m8omuzbui1mtrpp69x]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.042Z"}
{"level":"debug","message":"Executing query [m8omuzbvff7hqiir705]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.043Z"}
{"level":"debug","message":"Executing query [m8omuzbyhf2ujbif8cd]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.046Z"}
{"level":"debug","message":"Executing query [m8omuzc1d0dzbcdxxbu]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.049Z"}
{"level":"debug","message":"Executing query [m8omuzc2n2ie30rkmim]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T15:10:54.050Z"}
{"level":"debug","message":"Executing query [m8omuzc5stzr3t66ufb]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:54.053Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:54.054Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:54.228Z"}
{"level":"debug","message":"Executing query [m8omuzh2eksws9s1494]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:54.230Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:54.241Z"}
{"level":"debug","message":"Executing query [m8omuzhezo2mih2bam8]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:10:54.242Z"}
{"level":"debug","message":"Executing query [m8omuzhf66u9oaq2jdi]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T15:10:54.243Z"}
{"level":"debug","message":"Executing query [m8omuzhgixaabmefj4d]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T15:10:54.244Z"}
{"level":"debug","message":"Executing query [m8omuzhh0fmb5wu2hz04]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T15:10:54.245Z"}
{"level":"debug","message":"Executing query [m8omuzhmqg6rhglcrut]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T15:10:54.250Z"}
{"level":"debug","message":"Executing query [m8omuzhq86dalb6mv4v]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[34,888,34,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T15:10:54.254Z\",\"ACTIVO\"]","timestamp":"2025-03-25T15:10:54.254Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 34, Área ID: 888, Rol ID: 888, Documento ID: 33","timestamp":"2025-03-25T15:10:54.257Z"}
{"level":"debug","message":"Executing query [m8omuzhu5bytxkei5hg]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[33,34,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T15:10:54.258Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omuzhu5bytxkei5hg]","params":"[33,34,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T15:10:54.264Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T15:10:54.264Z"}
{"level":"debug","message":"Executing query [m8omuzi0oubqecmk0sl]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.264Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omuzi0oubqecmk0sl]","params":"[33]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T15:10:54.269Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T15:10:54.270Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T15:10:54.270Z"}
{"level":"debug","message":"Executing query [m8omuzi7cp8mpzuoyy]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[33,34,\"RESTAURAR\"]","timestamp":"2025-03-25T15:10:54.271Z"}
{"level":"debug","message":"Executing query [m8omuzicxgmvgdzu3ql]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.276Z"}
{"level":"debug","message":"Executing query [m8omuziepgfpkzsy0pp]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[33,34,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T15:10:54.278Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omuziepgfpkzsy0pp]","params":"[33,34,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T15:10:54.282Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T15:10:54.282Z"}
{"level":"debug","message":"Executing query [m8omuzij903ykw2a10u]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.283Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omuzij903ykw2a10u]","params":"[33]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T15:10:54.285Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T15:10:54.285Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T15:10:54.285Z"}
{"level":"debug","message":"Executing query [m8omuzim0ca8y7fh5stt]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[34,888,34,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T15:10:54.286Z\",\"ACTIVO\"]","timestamp":"2025-03-25T15:10:54.286Z"}
{"level":"debug","message":"Executing query [m8omuziqiy4nn3jgci]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T15:10:54.290Z"}
{"level":"debug","message":"Executing query [m8omuzitsz0dgffxtmm]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[34,\"DOCUMENTO\",34,\"ELIMINAR\"]","timestamp":"2025-03-25T15:10:54.293Z"}
{"level":"debug","message":"Executing query [m8omuzixu890g7c8ti]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[34]","timestamp":"2025-03-25T15:10:54.297Z"}
{"level":"debug","message":"Executing query [m8omuzj0l93qaaph0z]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T15:10:54.300Z"}
{"level":"debug","message":"Executing query [m8omuzj471udc9ytsxi]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[34]","timestamp":"2025-03-25T15:10:54.304Z"}
{"level":"debug","message":"Executing query [m8omuzj7sma9vtdmelf]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:10:54.307Z"}
{"level":"debug","message":"Executing query [m8omuzj8vejze7t6rki]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:10:54.308Z"}
{"level":"debug","message":"Executing query [m8omuzj9wf0mngvoo6m]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:10:54.309Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T15:10:54.313Z"}
{"level":"debug","message":"Executing query [m8omuzjdzg0vcsk0n7e]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:54.313Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:54.314Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:54.412Z"}
{"level":"debug","message":"Executing query [m8omuzm74ndkimswtr4]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:54.415Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:54.424Z"}
{"level":"debug","message":"Executing query [m8omuzmi4gekvxh5lul]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T15:10:54.426Z"}
{"level":"debug","message":"Executing query [m8omuzmkbs4c8fxtg9j]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T15:10:54.428Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T15:10:54.429Z"}
{"level":"debug","message":"Executing query [m8omuzmlk26pe4hrji]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T15:10:54.429Z"}
{"level":"debug","message":"Executing query [m8omuzmmkczba2htzok]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T15:10:54.430Z"}
{"level":"debug","message":"Executing query [m8omuzmnb0uiy2m6wwb]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T15:10:54.431Z"}
{"level":"debug","message":"Executing query [m8omuzmrdy97ick5v6t]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[34]","timestamp":"2025-03-25T15:10:54.435Z"}
{"level":"debug","message":"Executing query [m8omuzmuqcdv75kgdok]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[34]","timestamp":"2025-03-25T15:10:54.438Z"}
{"level":"debug","message":"Executing query [m8omuzmwae4hzdpop7m]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",34]","timestamp":"2025-03-25T15:10:54.440Z"}
{"level":"debug","message":"Executing query [m8omuzmz612xhe0gyel]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[34]","timestamp":"2025-03-25T15:10:54.444Z"}
{"level":"debug","message":"Executing query [m8omuzn1wbxag3mgye]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[34]","timestamp":"2025-03-25T15:10:54.445Z"}
{"level":"debug","message":"Executing query [m8omuzn4k0nruzknxk]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[34]","timestamp":"2025-03-25T15:10:54.448Z"}
{"level":"debug","message":"Executing query [m8omuzn6q7jjkf9vif]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:54.450Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:54.451Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:54.618Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:55.024Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T15:10:55.087Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:55.136Z"}
{"level":"debug","message":"Executing query [m8omv06v6pnc40a3ge7]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T15:10:55.159Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:55.186Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:55.367Z"}
{"level":"debug","message":"Executing query [m8omv0cpwy0ginxquvr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:55.369Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:55.382Z"}
{"level":"debug","message":"Executing query [m8omv0d3ei217yg9ly7]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:10:55.383Z"}
{"level":"debug","message":"Executing query [m8omv0d6j2ecxqk21mq]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742915455368\"]","timestamp":"2025-03-25T15:10:55.386Z"}
{"level":"debug","message":"Executing query [m8omv0d7sq6qja8mta9]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742915455368\",\"TEST-OFI-QUIMICA-1742915455368\",1000,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:10:55.387Z"}
{"level":"debug","message":"Executing query [m8omv0dd9oqzzmmcfpu]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[17]","timestamp":"2025-03-25T15:10:55.393Z"}
{"level":"debug","message":"Executing query [m8omv0dg98zxb5lxauh]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742915455368\"]","timestamp":"2025-03-25T15:10:55.396Z"}
{"level":"debug","message":"Executing query [m8omv0dh9vm7o1mzr1d]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",17]","timestamp":"2025-03-25T15:10:55.397Z"}
{"level":"debug","message":"Executing query [m8omv0dloo4mxnidrk]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[17]","timestamp":"2025-03-25T15:10:55.401Z"}
{"level":"debug","message":"Executing query [m8omv0dn821mj2nr02y]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[17]","timestamp":"2025-03-25T15:10:55.403Z"}
{"level":"debug","message":"Executing query [m8omv0dqz6zi9vtm0o]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[17]","timestamp":"2025-03-25T15:10:55.406Z"}
{"level":"debug","message":"Executing query [m8omv0ds0yqb4dizxxsj]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[17]","timestamp":"2025-03-25T15:10:55.408Z"}
{"level":"debug","message":"Executing query [m8omv0dwmioxa8ogiae]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[17]","timestamp":"2025-03-25T15:10:55.412Z"}
{"level":"debug","message":"Executing query [m8omv0dzdxrfslue6el]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:55.415Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:55.416Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:55.965Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:55.969Z"}
{"level":"debug","message":"Executing query [m8omv0tf140zr1wwfhr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:55.971Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:55.980Z"}
{"level":"debug","message":"Executing query [m8omv0tq7ssiq2c9e6v]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T15:10:55.982Z"}
{"level":"debug","message":"Executing query [m8omv0tsa8alu9dla9k]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T15:10:55.984Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T15:10:55.985Z"}
{"level":"debug","message":"Executing query [m8omv0ttpatjbxse1f]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:10:55.985Z"}
{"level":"debug","message":"Executing query [m8omv0tu2vrauq0t7tk]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:10:55.986Z"}
{"level":"debug","message":"Executing query [m8omv0tvjvtodh5imvi]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:10:55.987Z"}
{"level":"debug","message":"Executing query [m8omv0tw3a9jdrl742a]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T15:10:55.988Z"}
{"level":"debug","message":"Executing query [m8omv0u2vg399h4nzb]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[35]","timestamp":"2025-03-25T15:10:55.994Z"}
{"level":"debug","message":"Executing query [m8omv0u6dv03jf8665g]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:10:55.998Z"}
{"level":"debug","message":"Executing query [m8omv0u8f93fsimzc74]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",35]","timestamp":"2025-03-25T15:10:56.000Z"}
{"level":"debug","message":"Executing query [m8omv0udlhwbqus6n1s]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[35]","timestamp":"2025-03-25T15:10:56.005Z"}
{"level":"debug","message":"Executing query [m8omv0uffl2l974rv2]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[35]","timestamp":"2025-03-25T15:10:56.007Z"}
{"level":"debug","message":"Executing query [m8omv0uiqsp7sbk9a6]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[35]","timestamp":"2025-03-25T15:10:56.010Z"}
{"level":"debug","message":"Executing query [m8omv0ujrkfr38po74k]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:10:56.012Z"}
{"level":"debug","message":"Executing query [m8omv0uk8rtf3c9i84j]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:10:56.012Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T15:10:56.013Z"}
{"level":"debug","message":"Executing query [m8omv0ulbu9cm1cxvq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:56.013Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:56.014Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:13:55.886Z"}
{"level":"debug","message":"Executing query [m8omyvnoj4w07s8mny]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:13:55.908Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:13:55.943Z"}
{"level":"debug","message":"Executing query [m8omyvoqeoby05f3cbe]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915635907\"]","timestamp":"2025-03-25T15:13:55.947Z"}
{"level":"debug","message":"Executing query [m8omyvoutzgnbm6903l]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915635907\"]","timestamp":"2025-03-25T15:13:55.950Z"}
{"level":"debug","message":"Executing query [m8omyvov96aq03qctba]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742915635907\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:13:55.951Z"}
{"level":"debug","message":"Executing query [m8omyvp2pl3pmnbdy7k]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1016]","timestamp":"2025-03-25T15:13:55.958Z"}
{"level":"debug","message":"Executing query [m8omyvp5r93ijffhhni]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915635907\"]","timestamp":"2025-03-25T15:13:55.961Z"}
{"level":"debug","message":"Executing query [m8omyvp8ad4c8yps5gb]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1016]","timestamp":"2025-03-25T15:13:55.964Z"}
{"level":"debug","message":"Executing query [m8omyvpc7q0nqi28107]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1016]","timestamp":"2025-03-25T15:13:55.968Z"}
{"level":"debug","message":"Executing query [m8omyvpeis6k6v5uwns]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1016]","timestamp":"2025-03-25T15:13:55.970Z"}
{"level":"debug","message":"Executing query [m8omyvpgfb7dhigvn4c]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1016]","timestamp":"2025-03-25T15:13:55.973Z"}
{"level":"debug","message":"Executing query [m8omyvpk1ocwek9xcra]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1016]","timestamp":"2025-03-25T15:13:55.976Z"}
{"level":"debug","message":"Executing query [m8omyvplju4y9ael27]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1016]","timestamp":"2025-03-25T15:13:55.977Z"}
{"level":"debug","message":"Executing query [m8omyvpnud686o6qu7e]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1016]","timestamp":"2025-03-25T15:13:55.979Z"}
{"level":"debug","message":"Executing query [m8omyvpq9goqm1gll9u]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T15:13:55.982Z"}
{"level":"debug","message":"Executing query [m8omyvps2s71d49ulyt]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:13:55.984Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:13:55.986Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:13:56.081Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:13:56.084Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:13:56.086Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:13:56.088Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:13:56.090Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:13:56.095Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:13:56.097Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:13:56.100Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:13:56.101Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:13:56.103Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:13:56.104Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T15:13:56.106Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:13:56.284Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:13:57.218Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T15:13:57.359Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T15:13:57.365Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:13:57.417Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T15:13:57.431Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:13:57.478Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:13:58.056Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:13:58.287Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:13:58.304Z"}
{"level":"debug","message":"Executing query [m8omyxi9bek4fr1mppm]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T15:13:58.306Z"}
{"level":"debug","message":"Executing query [m8omyxictx0ontue4pc]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T15:13:58.308Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8omyxictx0ontue4pc]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T15:13:58.310Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:13:58.311Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:13:58.411Z"}
{"level":"debug","message":"Executing query [m8omyxlaspr2h4lk1jn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:13:58.414Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:13:58.430Z"}
{"level":"debug","message":"Executing query [m8omyxls6zemqjxzvth]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T15:13:58.432Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T15:13:58.434Z"}
{"level":"debug","message":"Executing query [m8omyxlv4vvyh2tew76]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T15:13:58.435Z"}
{"level":"debug","message":"Executing query [m8omyxlx55rysr7fsdk]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T15:13:58.437Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T15:13:58.439Z"}
{"level":"debug","message":"Executing query [m8omyxm0p7514t2h2xp]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T15:13:58.440Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T15:13:58.442Z"}
{"level":"debug","message":"Executing query [m8omyxm79r7y5jssdx5]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T15:13:58.447Z"}
{"level":"debug","message":"Executing query [m8omyxmgc0g21ntj4bu]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T15:13:58.456Z"}
{"level":"debug","message":"Executing query [m8omyxmis1baidtzmbs]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[33]","timestamp":"2025-03-25T15:13:58.458Z"}
{"level":"debug","message":"Executing query [m8omyxmo1cajwvf9t5q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:13:58.464Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:00.128Z"}
{"duration":"8ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T15:14:00.194Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:00.195Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T15:14:00.197Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:00.204Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T15:14:00.300Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T15:14:00.398Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:00.519Z"}
{"level":"debug","message":"Executing query [m8omyz7tsm00r5lvy5m]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:14:00.521Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:00.531Z"}
{"level":"debug","message":"Executing query [m8omyz85ex4orty9nnp]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:14:00.533Z"}
{"level":"debug","message":"Executing query [m8omyz87gxbg0z00xr8]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742915640520\"]","timestamp":"2025-03-25T15:14:00.535Z"}
{"level":"debug","message":"Executing query [m8omyz88ip9vgmlxhr]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742915640520\",\"TEST-OFICIO-1742915640520\",5512,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:14:00.537Z"}
{"level":"debug","message":"Executing query [m8omyz8dj41tftan2xe]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.541Z"}
{"level":"debug","message":"Executing query [m8omyz8gpatlpo6mclg]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742915640520\"]","timestamp":"2025-03-25T15:14:00.545Z"}
{"level":"debug","message":"Executing query [m8omyz8lujncdez03d]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",35]","timestamp":"2025-03-25T15:14:00.549Z"}
{"level":"debug","message":"Executing query [m8omyz8psublh4wjxub]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.553Z"}
{"level":"debug","message":"Executing query [m8omyz8rcia08serctm]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.555Z"}
{"level":"debug","message":"Executing query [m8omyz8t0mq7qi372zd]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.558Z"}
{"level":"debug","message":"Executing query [m8omyz8v2cnx7s0y26]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.560Z"}
{"level":"debug","message":"Executing query [m8omyz8y0ueb8wygbxjj]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.562Z"}
{"level":"debug","message":"Executing query [m8omyz913f5dlxuzl0u]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742915640565\",\"TEST-SP-OFICIO-1742915640565\",8760,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T15:14:00.565Z"}
{"level":"debug","message":"Executing query [m8omyz94qfnfwpjoq4m]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742915640565\"]","timestamp":"2025-03-25T15:14:00.568Z"}
{"level":"debug","message":"Executing query [m8omyz952skp5fvhye]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742915640565\"]","timestamp":"2025-03-25T15:14:00.569Z"}
{"level":"debug","message":"Executing query [m8omyz9863b7ocri7c]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:14:00.572Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:00.573Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:00.754Z"}
{"level":"debug","message":"Executing query [m8omyzedpwyrd9v0ac]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:14:00.757Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:00.766Z"}
{"level":"debug","message":"Executing query [m8omyzen4gxfs052y0l]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:14:00.768Z"}
{"level":"debug","message":"Executing query [m8omyzepfvdajz6k58u]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742915640756\"]","timestamp":"2025-03-25T15:14:00.769Z"}
{"level":"debug","message":"Executing query [m8omyzeq4hzz34zt76f]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742915640756\",\"TEST-OFI-FORENSE-1742915640756\",638,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742915640756\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:14:00.770Z"}
{"level":"debug","message":"Executing query [m8omyzex7iaeyk9r7io]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.777Z"}
{"level":"debug","message":"Executing query [m8omyzf0wlz6722t9lq]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742915640756\"]","timestamp":"2025-03-25T15:14:00.780Z"}
{"level":"debug","message":"Executing query [m8omyzf3r7t51333ggc]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",35]","timestamp":"2025-03-25T15:14:00.783Z"}
{"level":"debug","message":"Executing query [m8omyzf7vlvn83znqtr]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.787Z"}
{"level":"debug","message":"Executing query [m8omyzf9w1e7auti7v9]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.789Z"}
{"level":"debug","message":"Executing query [m8omyzfcvhaljh9p63i]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.792Z"}
{"level":"debug","message":"Executing query [m8omyzfflzk6z05z0a7]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.795Z"}
{"level":"debug","message":"Executing query [m8omyzfhw7f5osn1x3]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.797Z"}
{"level":"debug","message":"Executing query [m8omyzfit5tesdvfqk]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742915640798\",\"TEST-SP-OFI-FORENSE-1742915640798\",1195,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T15:14:00.798Z"}
{"level":"debug","message":"Executing query [m8omyzfmkd9ow32gst]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742915640798\"]","timestamp":"2025-03-25T15:14:00.802Z"}
{"level":"debug","message":"Executing query [m8omyzfowhq7rorkl5r]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742915640798\"]","timestamp":"2025-03-25T15:14:00.804Z"}
{"level":"debug","message":"Executing query [m8omyzfqvh67bklg86p]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:14:00.806Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:00.808Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:01.616Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:01.664Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T15:14:01.666Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T15:14:01.756Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T15:14:01.757Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T15:14:01.758Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T15:14:01.759Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T15:14:01.760Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T15:14:01.760Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:02.123Z"}
{"level":"debug","message":"Executing query [m8omz0gdwxhbfjp9vq]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:14:02.125Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:02.135Z"}
{"level":"debug","message":"Executing query [m8omz0gpy5gfjcf93fs]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742915642124\"]","timestamp":"2025-03-25T15:14:02.137Z"}
{"level":"debug","message":"Executing query [m8omz0gqly3ttot26nb]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742915642124\",true]","timestamp":"2025-03-25T15:14:02.139Z"}
{"level":"debug","message":"Executing query [m8omz0gwlpfvugbbmx]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.144Z"}
{"level":"debug","message":"Executing query [m8omz0gyagx8f2u16lw]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742915642124\"]","timestamp":"2025-03-25T15:14:02.146Z"}
{"level":"debug","message":"Executing query [m8omz0h1wnmah9sr4u]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",35]","timestamp":"2025-03-25T15:14:02.149Z"}
{"level":"debug","message":"Executing query [m8omz0h4e5zb0bamgw9]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.152Z"}
{"level":"debug","message":"Executing query [m8omz0h69cbqkuefoq]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.154Z"}
{"level":"debug","message":"Executing query [m8omz0ha94vf031ihvo]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.158Z"}
{"level":"debug","message":"Executing query [m8omz0hc07enfhcetz85]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.160Z"}
{"level":"debug","message":"Executing query [m8omz0hh0wgvilmtqof]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.165Z"}
{"level":"debug","message":"Executing query [m8omz0hl26jz8dmx6th]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.169Z"}
{"level":"debug","message":"Executing query [m8omz0hmb6k1a77ozuk]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T15:14:02.170Z"}
{"level":"debug","message":"Executing query [m8omz0ho7tfuokvd34a]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:14:02.172Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:02.172Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:02.343Z"}
{"level":"debug","message":"Executing query [m8omz0mh436h6ubttq5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:14:02.345Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:02.355Z"}
{"level":"debug","message":"Executing query [m8omz0mtzg6s3n0m56]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:14:02.357Z"}
{"level":"debug","message":"Executing query [m8omz0muhwbp5gnd6pe]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T15:14:02.358Z"}
{"level":"debug","message":"Executing query [m8omz0mv6llcfjyf6xn]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T15:14:02.359Z"}
{"level":"debug","message":"Executing query [m8omz0mwblb8ee55wk]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T15:14:02.360Z"}
{"level":"debug","message":"Executing query [m8omz0n0jpk6ru0g9i9]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T15:14:02.364Z"}
{"level":"debug","message":"Executing query [m8omz0n3msgdkuwbcna]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[36,888,36,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T15:14:02.367Z\",\"ACTIVO\"]","timestamp":"2025-03-25T15:14:02.367Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 36, Área ID: 888, Rol ID: 888, Documento ID: 35","timestamp":"2025-03-25T15:14:02.371Z"}
{"level":"debug","message":"Executing query [m8omz0n813h4ja34jrjo]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[35,36,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T15:14:02.372Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omz0n813h4ja34jrjo]","params":"[35,36,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T15:14:02.376Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T15:14:02.377Z"}
{"level":"debug","message":"Executing query [m8omz0ndeq8l0wgjywn]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.377Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omz0ndeq8l0wgjywn]","params":"[35]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T15:14:02.379Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T15:14:02.380Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T15:14:02.380Z"}
{"level":"debug","message":"Executing query [m8omz0nh9gqn3qr126]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[35,36,\"RESTAURAR\"]","timestamp":"2025-03-25T15:14:02.381Z"}
{"level":"debug","message":"Executing query [m8omz0nmlkx0dpu87m]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.386Z"}
{"level":"debug","message":"Executing query [m8omz0noey8ew0k0pt5]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[35,36,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T15:14:02.388Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omz0noey8ew0k0pt5]","params":"[35,36,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T15:14:02.392Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T15:14:02.392Z"}
{"level":"debug","message":"Executing query [m8omz0nt8j7mf79duza]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.393Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omz0nt8j7mf79duza]","params":"[35]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T15:14:02.394Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T15:14:02.395Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T15:14:02.395Z"}
{"level":"debug","message":"Executing query [m8omz0nw1570w1pgl8q]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[36,888,36,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T15:14:02.396Z\",\"ACTIVO\"]","timestamp":"2025-03-25T15:14:02.396Z"}
{"level":"debug","message":"Executing query [m8omz0nzo4dwgvr5a7]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T15:14:02.399Z"}
{"level":"debug","message":"Executing query [m8omz0o2r6mcr6v8dqi]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[36,\"DOCUMENTO\",36,\"ELIMINAR\"]","timestamp":"2025-03-25T15:14:02.402Z"}
{"level":"debug","message":"Executing query [m8omz0o3q0gb7css1d]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[36]","timestamp":"2025-03-25T15:14:02.403Z"}
{"level":"debug","message":"Executing query [m8omz0o7nwtinew4xss]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T15:14:02.407Z"}
{"level":"debug","message":"Executing query [m8omz0oal2h8lfykr6]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[36]","timestamp":"2025-03-25T15:14:02.410Z"}
{"level":"debug","message":"Executing query [m8omz0oegoophx09jic]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:14:02.414Z"}
{"level":"debug","message":"Executing query [m8omz0ofh3c06689xza]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:14:02.415Z"}
{"level":"debug","message":"Executing query [m8omz0og24rht2u9am4]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:14:02.416Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T15:14:02.419Z"}
{"level":"debug","message":"Executing query [m8omz0ojstq4ma1018]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:14:02.419Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:02.421Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:02.519Z"}
{"level":"debug","message":"Executing query [m8omz0rewwr9evmxjb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:14:02.522Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:02.532Z"}
{"level":"debug","message":"Executing query [m8omz0rpl9brmp3je6c]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T15:14:02.533Z"}
{"level":"debug","message":"Executing query [m8omz0rqf8hqk72fh2p]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T15:14:02.534Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T15:14:02.535Z"}
{"level":"debug","message":"Executing query [m8omz0rrvx2fuf2rs5]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T15:14:02.535Z"}
{"level":"debug","message":"Executing query [m8omz0rtnqplsac8759]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T15:14:02.537Z"}
{"level":"debug","message":"Executing query [m8omz0rx4qvjnq3qh3b]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T15:14:02.541Z"}
{"level":"debug","message":"Executing query [m8omz0s3c6n3jsdzdj]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[36]","timestamp":"2025-03-25T15:14:02.548Z"}
{"level":"debug","message":"Executing query [m8omz0s81str973o6gk]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[36]","timestamp":"2025-03-25T15:14:02.552Z"}
{"level":"debug","message":"Executing query [m8omz0sa7tyvnbftjkj]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",36]","timestamp":"2025-03-25T15:14:02.554Z"}
{"level":"debug","message":"Executing query [m8omz0sehg2qxkxeyyn]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[36]","timestamp":"2025-03-25T15:14:02.558Z"}
{"level":"debug","message":"Executing query [m8omz0sf86uq31fb02r]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[36]","timestamp":"2025-03-25T15:14:02.559Z"}
{"level":"debug","message":"Executing query [m8omz0simlx1wobekp]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[36]","timestamp":"2025-03-25T15:14:02.562Z"}
{"level":"debug","message":"Executing query [m8omz0sj132tn7sls5q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:14:02.563Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:02.565Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:02.727Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:03.113Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T15:14:03.168Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:03.222Z"}
{"level":"debug","message":"Executing query [m8omz1c1r9tuixalvk]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T15:14:03.266Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:03.296Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:03.486Z"}
{"level":"debug","message":"Executing query [m8omz1i9wu4f5teoz3]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:14:03.490Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:03.499Z"}
{"level":"debug","message":"Executing query [m8omz1ikwye8yxiky2]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:14:03.500Z"}
{"level":"debug","message":"Executing query [m8omz1imdv24yr0mwqo]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742915643489\"]","timestamp":"2025-03-25T15:14:03.502Z"}
{"level":"debug","message":"Executing query [m8omz1ios0zuxupmfac]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742915643489\",\"TEST-OFI-QUIMICA-1742915643489\",9182,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:14:03.504Z"}
{"level":"debug","message":"Executing query [m8omz1iua7chqw3uo27]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[18]","timestamp":"2025-03-25T15:14:03.510Z"}
{"level":"debug","message":"Executing query [m8omz1ix3scw8gtx4ar]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742915643489\"]","timestamp":"2025-03-25T15:14:03.513Z"}
{"level":"debug","message":"Executing query [m8omz1j3i7e7z2w1dg8]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",18]","timestamp":"2025-03-25T15:14:03.519Z"}
{"level":"debug","message":"Executing query [m8omz1j6rp9bso8o1vc]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[18]","timestamp":"2025-03-25T15:14:03.522Z"}
{"level":"debug","message":"Executing query [m8omz1j9335jc82l7k]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[18]","timestamp":"2025-03-25T15:14:03.525Z"}
{"level":"debug","message":"Executing query [m8omz1jc659qmssw8aq]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[18]","timestamp":"2025-03-25T15:14:03.528Z"}
{"level":"debug","message":"Executing query [m8omz1jf4afq64qxsgz]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[18]","timestamp":"2025-03-25T15:14:03.531Z"}
{"level":"debug","message":"Executing query [m8omz1jixoaz140ndhq]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[18]","timestamp":"2025-03-25T15:14:03.534Z"}
{"level":"debug","message":"Executing query [m8omz1jjvctwoi9447i]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:14:03.535Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:03.537Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:04.214Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:04.217Z"}
{"level":"debug","message":"Executing query [m8omz22jg6kllrr1q48]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:14:04.219Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:04.228Z"}
{"level":"debug","message":"Executing query [m8omz22tv2ww0lj3jz9]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T15:14:04.229Z"}
{"level":"debug","message":"Executing query [m8omz22u1mry1lde436]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T15:14:04.230Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T15:14:04.232Z"}
{"level":"debug","message":"Executing query [m8omz22wu6wby75f169]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:14:04.232Z"}
{"level":"debug","message":"Executing query [m8omz22xlzyhofgwztj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:14:04.233Z"}
{"level":"debug","message":"Executing query [m8omz22zo5hhq7mdes]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:14:04.235Z"}
{"level":"debug","message":"Executing query [m8omz22zcaj4xptlr5j]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T15:14:04.235Z"}
{"level":"debug","message":"Executing query [m8omz235hrovr94xok]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[37]","timestamp":"2025-03-25T15:14:04.241Z"}
{"level":"debug","message":"Executing query [m8omz237pw0ko16jnsa]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:14:04.243Z"}
{"level":"debug","message":"Executing query [m8omz23a4elx7nt6z3e]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",37]","timestamp":"2025-03-25T15:14:04.246Z"}
{"level":"debug","message":"Executing query [m8omz23d002cfc02j8tvq]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[37]","timestamp":"2025-03-25T15:14:04.249Z"}
{"level":"debug","message":"Executing query [m8omz23elh82cl8c5es]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[37]","timestamp":"2025-03-25T15:14:04.250Z"}
{"level":"debug","message":"Executing query [m8omz23im9bbb4tvjfo]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[37]","timestamp":"2025-03-25T15:14:04.254Z"}
{"level":"debug","message":"Executing query [m8omz23ke1svmh88dj]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:14:04.256Z"}
{"level":"debug","message":"Executing query [m8omz23kznmlbc8foml]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:14:04.256Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T15:14:04.257Z"}
{"level":"debug","message":"Executing query [m8omz23l9khqbpemotd]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:14:04.257Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:04.259Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:23:29.326Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:23:29.344Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:23:29.349Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:23:29.368Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:23:29.392Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:23:29.404Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:23:29.407Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:23:29.415Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:23:29.417Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:23:29.419Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:23:29.421Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T15:23:29.424Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:29.659Z"}
{"level":"debug","message":"Executing query [m8onb6g46w0x18d041g]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:29.764Z"}
{"level":"debug","message":"Executing query [m8onb6ih9bjczuzg3vi]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742916209760\"]","timestamp":"2025-03-25T15:23:29.849Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:29.853Z"}
{"level":"debug","message":"Executing query [m8onb6jihvuxrakpso7]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742916209760\"]","timestamp":"2025-03-25T15:23:29.887Z"}
{"level":"debug","message":"Executing query [m8onb6jnivsufikq7nt]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742916209760\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:23:29.891Z"}
{"level":"debug","message":"Executing query [m8onb6k17y04lz1qbsx]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1017]","timestamp":"2025-03-25T15:23:29.905Z"}
{"level":"debug","message":"Executing query [m8onb6k7jskqfkaaac]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742916209760\"]","timestamp":"2025-03-25T15:23:29.911Z"}
{"level":"debug","message":"Executing query [m8onb6khea9avave45s]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1017]","timestamp":"2025-03-25T15:23:29.922Z"}
{"level":"debug","message":"Executing query [m8onb6kog902u2jdm14]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1017]","timestamp":"2025-03-25T15:23:29.928Z"}
{"level":"debug","message":"Executing query [m8onb6ksfutuh6qh5l]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1017]","timestamp":"2025-03-25T15:23:29.932Z"}
{"level":"debug","message":"Executing query [m8onb6kwtjywsqplbup]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1017]","timestamp":"2025-03-25T15:23:29.936Z"}
{"level":"debug","message":"Executing query [m8onb6l1ba3x0dkvjpk]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1017]","timestamp":"2025-03-25T15:23:29.941Z"}
{"level":"debug","message":"Executing query [m8onb6l4eck71swpg5r]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1017]","timestamp":"2025-03-25T15:23:29.944Z"}
{"level":"debug","message":"Executing query [m8onb6l9w5j9d6qjds8]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1017]","timestamp":"2025-03-25T15:23:29.949Z"}
{"level":"debug","message":"Executing query [m8onb6lcmocq457xrhc]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T15:23:29.952Z"}
{"level":"debug","message":"Executing query [m8onb6lelhnk1msa7gp]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:29.954Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:29.958Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T15:23:30.031Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:30.257Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:30.226Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:30.040Z"}
{"level":"debug","message":"Executing query [m8onb6u75rt4sr4ugv4]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:30.271Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:30.395Z"}
{"level":"debug","message":"Executing query [m8onb6xp0g8ifgu62bx]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:23:30.397Z"}
{"level":"debug","message":"Executing query [m8onb6xt5o72a4jm4h]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742916210269\"]","timestamp":"2025-03-25T15:23:30.401Z"}
{"level":"debug","message":"Executing query [m8onb6xvtpoz71nodfd]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742916210269\",\"TEST-OFICIO-1742916210269\",3177,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:23:30.403Z"}
{"level":"debug","message":"Executing query [m8onb6y7ezw133gfvl4]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.415Z"}
{"level":"debug","message":"Executing query [m8onb6yblllbur8ljho]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742916210269\"]","timestamp":"2025-03-25T15:23:30.419Z"}
{"level":"debug","message":"Executing query [m8onb6yfwt9pwztsb9]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",37]","timestamp":"2025-03-25T15:23:30.423Z"}
{"level":"debug","message":"Executing query [m8onb6yklbvb74c2qpb]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.428Z"}
{"level":"debug","message":"Executing query [m8onb6yn379okn2h3il]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.431Z"}
{"level":"debug","message":"Executing query [m8onb6ywvt6yn0kw6e]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.440Z"}
{"level":"debug","message":"Executing query [m8onb6z0v9dvfvq6w7]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.444Z"}
{"level":"debug","message":"Executing query [m8onb6z8xf6nhrb9z3o]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.452Z"}
{"level":"debug","message":"Executing query [m8onb6zapsqrfe7sxi7]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742916210454\",\"TEST-SP-OFICIO-1742916210454\",774,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T15:23:30.455Z"}
{"level":"debug","message":"Executing query [m8onb6zhkrsiifg5mt]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742916210454\"]","timestamp":"2025-03-25T15:23:30.461Z"}
{"level":"debug","message":"Executing query [m8onb6zkfd8cby8q89u]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742916210454\"]","timestamp":"2025-03-25T15:23:30.464Z"}
{"level":"debug","message":"Executing query [m8onb6zouynfcdmwy8g]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:30.469Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:30.473Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T15:23:30.432Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:30.535Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:30.658Z"}
{"level":"debug","message":"Executing query [m8onb75749mzkiqsea6]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T15:23:30.668Z"}
{"level":"debug","message":"Executing query [m8onb75ca3ad9gr2855]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T15:23:30.673Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8onb75ca3ad9gr2855]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T15:23:30.677Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:30.681Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:30.598Z"}
{"level":"debug","message":"Executing query [m8onb754vvkc4i8gxt]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:30.665Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:30.734Z"}
{"level":"debug","message":"Executing query [m8onb779xfbjtfe7lp]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T15:23:30.741Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T15:23:30.745Z"}
{"level":"debug","message":"Executing query [m8onb77ea3e1fmz3lwr]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T15:23:30.746Z"}
{"level":"debug","message":"Executing query [m8onb77g8unnwmu9kgr]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T15:23:30.748Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T15:23:30.750Z"}
{"level":"debug","message":"Executing query [m8onb77ilimvvraxiz]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T15:23:30.750Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T15:23:30.773Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:30.747Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T15:23:30.752Z"}
{"level":"debug","message":"Executing query [m8onb7a5jeswan6ml7c]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T15:23:30.845Z"}
{"level":"debug","message":"Executing query [m8onb7almgt6kkld8ym]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T15:23:30.862Z"}
{"level":"debug","message":"Executing query [m8onb7az929lzaxca9]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[35]","timestamp":"2025-03-25T15:23:30.876Z"}
{"level":"debug","message":"Executing query [m8onb7975s08iysgl7]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:30.811Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:30.875Z"}
{"level":"debug","message":"Executing query [m8onb7b3hkuclyv8zjj]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:23:30.879Z"}
{"level":"debug","message":"Executing query [m8onb7baccrtc8c1v2v]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742916210809\"]","timestamp":"2025-03-25T15:23:30.886Z"}
{"level":"debug","message":"Executing query [m8onb7beoly2x1qyie]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742916210809\",\"TEST-OFI-FORENSE-1742916210809\",5312,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742916210810\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:23:30.890Z"}
{"level":"debug","message":"Executing query [m8onb7bni8bxngw1ain]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:30.899Z"}
{"level":"debug","message":"Executing query [m8onb7bo77je4tum264]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.900Z"}
{"level":"debug","message":"Executing query [m8onb7bv7q4co50hesu]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742916210809\"]","timestamp":"2025-03-25T15:23:30.907Z"}
{"level":"debug","message":"Executing query [m8onb7bz01egnj1zjczv]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",37]","timestamp":"2025-03-25T15:23:30.911Z"}
{"level":"debug","message":"Executing query [m8onb7c4o512lw73oa]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.916Z"}
{"level":"debug","message":"Executing query [m8onb7c7vzzy5ylrfdf]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.919Z"}
{"level":"debug","message":"Executing query [m8onb7cdgav936pt6ja]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.925Z"}
{"level":"debug","message":"Executing query [m8onb7chfo946mspxsl]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.929Z"}
{"level":"debug","message":"Executing query [m8onb7cnuvb3dwlho6]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.935Z"}
{"level":"debug","message":"Executing query [m8onb7cqdeytz12ccwn]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742916210938\",\"TEST-SP-OFI-FORENSE-1742916210938\",5149,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T15:23:30.938Z"}
{"level":"debug","message":"Executing query [m8onb7d0f706b6kkg3p]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742916210938\"]","timestamp":"2025-03-25T15:23:30.948Z"}
{"level":"debug","message":"Executing query [m8onb7d333o2nph9gtd]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742916210938\"]","timestamp":"2025-03-25T15:23:30.951Z"}
{"level":"debug","message":"Executing query [m8onb7d6sx0y8oruwiq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:30.954Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:30.957Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T15:23:30.774Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T15:23:30.775Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T15:23:30.776Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T15:23:30.777Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T15:23:30.777Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:31.143Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:31.148Z"}
{"level":"debug","message":"Executing query [m8onb7ip288g2n34vp3]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:31.153Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:31.181Z"}
{"level":"debug","message":"Executing query [m8onb7jjwubi5cs0vgf]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T15:23:31.183Z"}
{"level":"debug","message":"Executing query [m8onb7jmoszw6ppt8ac]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T15:23:31.186Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T15:23:31.188Z"}
{"level":"debug","message":"Executing query [m8onb7jp48xyf16vt5c]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T15:23:31.189Z"}
{"level":"debug","message":"Executing query [m8onb7jsl77f8spxn]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T15:23:31.192Z"}
{"level":"debug","message":"Executing query [m8onb7jvbee1g5uuoce]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T15:23:31.196Z"}
{"level":"debug","message":"Executing query [m8onb7k4txws871jut7]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.204Z"}
{"level":"debug","message":"Executing query [m8onb7kax0dfys3f81]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.210Z"}
{"level":"debug","message":"Executing query [m8onb7kfw1778kx2y59]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",37]","timestamp":"2025-03-25T15:23:31.215Z"}
{"level":"debug","message":"Executing query [m8onb7ilybg7n3hv77m]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:31.150Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:31.213Z"}
{"level":"debug","message":"Executing query [m8onb7kkpsxzeub64i9]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.220Z"}
{"level":"debug","message":"Executing query [m8onb7kpiyagvz6ox9b]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.225Z"}
{"level":"debug","message":"Executing query [m8onb7kuhictvbq55b]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.230Z"}
{"level":"debug","message":"Executing query [m8onb7kujif56k2wmyp]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:23:31.230Z"}
{"level":"debug","message":"Executing query [m8onb7kxjhcsogeqdkn]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:31.233Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:31.235Z"}
{"level":"debug","message":"Executing query [m8onb7kzy4zsrkfyifd]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T15:23:31.235Z"}
{"level":"debug","message":"Executing query [m8onb7l2pm532xckuq8]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T15:23:31.238Z"}
{"level":"debug","message":"Executing query [m8onb7l6gek9vpcn84n]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T15:23:31.242Z"}
{"level":"debug","message":"Executing query [m8onb7la7uptg3tccqf]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T15:23:31.247Z"}
{"level":"debug","message":"Executing query [m8onb7lf8o1nfbb5o97]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[37,888,38,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T15:23:31.251Z\",\"ACTIVO\"]","timestamp":"2025-03-25T15:23:31.251Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 38, Área ID: 888, Rol ID: 888, Documento ID: 37","timestamp":"2025-03-25T15:23:31.258Z"}
{"level":"debug","message":"Executing query [m8onb7lndvfibb2rho]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[37,38,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T15:23:31.259Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8onb7lndvfibb2rho]","params":"[37,38,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T15:23:31.268Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T15:23:31.268Z"}
{"level":"debug","message":"Executing query [m8onb7lxxbkdkw3yayt]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.269Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8onb7lxxbkdkw3yayt]","params":"[37]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T15:23:31.274Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T15:23:31.275Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T15:23:31.275Z"}
{"level":"debug","message":"Executing query [m8onb7m4q62ui5y0yua]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[37,38,\"RESTAURAR\"]","timestamp":"2025-03-25T15:23:31.276Z"}
{"level":"debug","message":"Executing query [m8onb7mfhqy4eeisofr]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.287Z"}
{"level":"debug","message":"Executing query [m8onb7mje3zj9it34n4]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[37,38,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T15:23:31.291Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8onb7mje3zj9it34n4]","params":"[37,38,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T15:23:31.298Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T15:23:31.299Z"}
{"level":"debug","message":"Executing query [m8onb7mrupfz7imoh9j]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.299Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8onb7mrupfz7imoh9j]","params":"[37]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T15:23:31.307Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T15:23:31.308Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T15:23:31.308Z"}
{"level":"debug","message":"Executing query [m8onb7n1qznew1zeyge]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[37,888,38,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T15:23:31.309Z\",\"ACTIVO\"]","timestamp":"2025-03-25T15:23:31.309Z"}
{"level":"debug","message":"Executing query [m8onb7n61na04tskigh]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T15:23:31.314Z"}
{"level":"debug","message":"Executing query [m8onb7nb29jkq17y7n7]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[38,\"DOCUMENTO\",38,\"ELIMINAR\"]","timestamp":"2025-03-25T15:23:31.319Z"}
{"level":"debug","message":"Executing query [m8onb7ng88bmdapgsww]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[38]","timestamp":"2025-03-25T15:23:31.324Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:31.201Z"}
{"level":"debug","message":"Executing query [m8onb7nqo22euta22la]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T15:23:31.334Z"}
{"level":"debug","message":"Executing query [m8onb7nw7skzgsjg8pw]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.340Z"}
{"level":"debug","message":"Executing query [m8onb7o175pvng70czf]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:23:31.345Z"}
{"level":"debug","message":"Executing query [m8onb7o2l4jg0o11zjc]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:23:31.346Z"}
{"level":"debug","message":"Executing query [m8onb7o4phoiewgn4cg]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:23:31.348Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T15:23:31.353Z"}
{"level":"debug","message":"Executing query [m8onb7o9dkwj3i798su]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:31.353Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:31.356Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:31.579Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:31.618Z"}
{"level":"debug","message":"Executing query [m8onb7w7an5v84dk4y]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:31.639Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:31.686Z"}
{"level":"debug","message":"Executing query [m8onb7xps77kw3dz1ws]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:23:31.693Z"}
{"level":"debug","message":"Executing query [m8onb7xvp3xujxvhh0a]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742916211637\"]","timestamp":"2025-03-25T15:23:31.699Z"}
{"level":"debug","message":"Executing query [m8onb7xx28fu2n25upt]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742916211637\",\"TEST-OFI-QUIMICA-1742916211637\",1512,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:23:31.701Z"}
{"level":"debug","message":"Executing query [m8onb7y6bp8aido2m1p]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[19]","timestamp":"2025-03-25T15:23:31.710Z"}
{"level":"debug","message":"Executing query [m8onb7wydqfug1vm1bp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:31.667Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:31.713Z"}
{"level":"debug","message":"Executing query [m8onb7ybrxcyvtuckx]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742916211637\"]","timestamp":"2025-03-25T15:23:31.715Z"}
{"level":"debug","message":"Executing query [m8onb7yf4bh2kicmhhk]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",19]","timestamp":"2025-03-25T15:23:31.719Z"}
{"level":"debug","message":"Executing query [m8onb7yfabs3i270r4a]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742916211665\"]","timestamp":"2025-03-25T15:23:31.720Z"}
{"level":"debug","message":"Executing query [m8onb7yjgdsw0445t98]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742916211665\",true]","timestamp":"2025-03-25T15:23:31.723Z"}
{"level":"debug","message":"Executing query [m8onb7yksn4iu9tpq5m]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[19]","timestamp":"2025-03-25T15:23:31.724Z"}
{"level":"debug","message":"Executing query [m8onb7yol55p9c4oyyk]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[19]","timestamp":"2025-03-25T15:23:31.728Z"}
{"level":"debug","message":"Executing query [m8onb7yrvs5dlzccy3]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-25T15:23:31.731Z"}
{"level":"debug","message":"Executing query [m8onb7yvzbg21en17t]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[19]","timestamp":"2025-03-25T15:23:31.735Z"}
{"level":"debug","message":"Executing query [m8onb7yz3e67vi2vkoe]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[19]","timestamp":"2025-03-25T15:23:31.739Z"}
{"level":"debug","message":"Executing query [m8onb7yzyvg5efr9k7h]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742916211665\"]","timestamp":"2025-03-25T15:23:31.739Z"}
{"level":"debug","message":"Executing query [m8onb7z2m1x2stx9t0a]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",38]","timestamp":"2025-03-25T15:23:31.742Z"}
{"level":"debug","message":"Executing query [m8onb7z4l1xa67l0qvo]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[19]","timestamp":"2025-03-25T15:23:31.744Z"}
{"level":"debug","message":"Executing query [m8onb7z6nt88dy5i4hn]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-25T15:23:31.746Z"}
{"level":"debug","message":"Executing query [m8onb7z67xf2joho5hx]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:31.746Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:31.749Z"}
{"level":"debug","message":"Executing query [m8onb7z993pbpdrsrx]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-25T15:23:31.749Z"}
{"level":"debug","message":"Executing query [m8onb7zdudxta4bz9w]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-25T15:23:31.753Z"}
{"level":"debug","message":"Executing query [m8onb7zg3clhsirk6re]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-25T15:23:31.756Z"}
{"level":"debug","message":"Executing query [m8onb7zimvdg17vaiy8]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-25T15:23:31.758Z"}
{"level":"debug","message":"Executing query [m8onb7zmhstqvfrgtit]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-25T15:23:31.762Z"}
{"level":"debug","message":"Executing query [m8onb7zon9i5hy4mqdk]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T15:23:31.764Z"}
{"level":"debug","message":"Executing query [m8onb7zqaq1gszm2jtg]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:31.766Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:31.769Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:31.778Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:31.789Z"}
{"level":"debug","message":"Executing query [m8onb80gmi2cv254iwg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:31.793Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:31.825Z"}
{"level":"debug","message":"Executing query [m8onb81fxjgdnwepy4n]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T15:23:31.827Z"}
{"level":"debug","message":"Executing query [m8onb81huqvta1opuib]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T15:23:31.829Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T15:23:31.830Z"}
{"level":"debug","message":"Executing query [m8onb81jpff1zrm3m1d]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:23:31.831Z"}
{"level":"debug","message":"Executing query [m8onb81kjhc3xx369u]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:23:31.832Z"}
{"level":"debug","message":"Executing query [m8onb81mi1dpd79fnhh]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:23:31.834Z"}
{"level":"debug","message":"Executing query [m8onb81npf6ni03kw8]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T15:23:31.835Z"}
{"level":"debug","message":"Executing query [m8onb81u4fg1at74ew3]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[39]","timestamp":"2025-03-25T15:23:31.842Z"}
{"level":"debug","message":"Executing query [m8onb81yod3x3m43qhj]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:23:31.846Z"}
{"level":"debug","message":"Executing query [m8onb821d5nxyg86v1w]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",39]","timestamp":"2025-03-25T15:23:31.849Z"}
{"level":"debug","message":"Executing query [m8onb824ce9w9j1e72f]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[39]","timestamp":"2025-03-25T15:23:31.852Z"}
{"level":"debug","message":"Executing query [m8onb826kiyyw34bu5r]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[39]","timestamp":"2025-03-25T15:23:31.854Z"}
{"level":"debug","message":"Executing query [m8onb82aqv0aso4ojd]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[39]","timestamp":"2025-03-25T15:23:31.858Z"}
{"level":"debug","message":"Executing query [m8onb82bc64wqaob74b]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:23:31.860Z"}
{"level":"debug","message":"Executing query [m8onb82d5lixc4s9uw7]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:23:31.861Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T15:23:31.862Z"}
{"level":"debug","message":"Executing query [m8onb82ebencojzyphu]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:31.862Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:31.863Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:32.013Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T15:23:32.359Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T15:23:32.379Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:32.632Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T15:23:32.662Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:32.732Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:32.784Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T15:23:32.986Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:33.136Z"}
{"level":"debug","message":"Executing query [m8onb92v1v8zifndtiy]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T15:23:33.176Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:33.219Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:33.833Z"}
{"duration":"20ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T15:23:33.988Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:33.993Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T15:23:33.997Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:34.001Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:33.926Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:34.032Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T15:23:34.034Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T17:29:54.699Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T17:29:54.715Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T17:29:54.719Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T17:29:54.723Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T17:29:54.727Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T17:29:54.731Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T17:29:54.734Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:29:54.738Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:29:54.740Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:29:54.743Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:29:54.746Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T17:29:54.749Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:55.158Z"}
{"level":"debug","message":"Executing query [m8ortrfypxr800ivdl]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:55.247Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:55.328Z"}
{"level":"debug","message":"Executing query [m8ortribfwh8dr4q99w]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742923795242\"]","timestamp":"2025-03-25T17:29:55.331Z"}
{"level":"debug","message":"Executing query [m8ortriwa58ckjttldi]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742923795242\"]","timestamp":"2025-03-25T17:29:55.352Z"}
{"level":"debug","message":"Executing query [m8ortrj0sg4fs3a6ev]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742923795242\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:29:55.356Z"}
{"level":"debug","message":"Executing query [m8ortrjc3p4qbjssq1e]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1018]","timestamp":"2025-03-25T17:29:55.368Z"}
{"level":"debug","message":"Executing query [m8ortrjil9k0ag7efwk]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742923795242\"]","timestamp":"2025-03-25T17:29:55.374Z"}
{"level":"debug","message":"Executing query [m8ortrjmn0qs8gt9nl]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1018]","timestamp":"2025-03-25T17:29:55.378Z"}
{"level":"debug","message":"Executing query [m8ortrjznva7ynfxw5]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1018]","timestamp":"2025-03-25T17:29:55.391Z"}
{"level":"debug","message":"Executing query [m8ortrk4xhsy4wp8fh]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1018]","timestamp":"2025-03-25T17:29:55.396Z"}
{"level":"debug","message":"Executing query [m8ortrk9e056jsd4cob]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1018]","timestamp":"2025-03-25T17:29:55.401Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:55.341Z"}
{"level":"debug","message":"Executing query [m8ortrkcwnjneovbiyi]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1018]","timestamp":"2025-03-25T17:29:55.405Z"}
{"level":"debug","message":"Executing query [m8ortrki96oh4f1fug]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1018]","timestamp":"2025-03-25T17:29:55.410Z"}
{"level":"debug","message":"Executing query [m8ortrkmyjruxjyqpn]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1018]","timestamp":"2025-03-25T17:29:55.414Z"}
{"level":"debug","message":"Executing query [m8ortrkpmc0g2wmaayn]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T17:29:55.417Z"}
{"level":"debug","message":"Executing query [m8ortrksrougnllf5ea]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:55.420Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:55.424Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T17:29:55.345Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:55.231Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:55.587Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:55.591Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:55.708Z"}
{"level":"debug","message":"Executing query [m8ortrt8i1fih40b2ys]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T17:29:55.724Z"}
{"level":"debug","message":"Executing query [m8ortrtb45vehdbmr7v]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T17:29:55.728Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8ortrtb45vehdbmr7v]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T17:29:55.733Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:55.737Z"}
{"level":"debug","message":"Executing query [m8ortrrtplovcmwnasd]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:55.673Z"}
{"level":"debug","message":"Executing query [m8ortruf5q4l43fex8g]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T17:29:55.767Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:55.770Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T17:29:55.774Z"}
{"level":"debug","message":"Executing query [m8ortrunbpsap3xtc7e]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T17:29:55.775Z"}
{"level":"debug","message":"Executing query [m8ortruut2axr4pwlbm]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T17:29:55.782Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T17:29:55.786Z"}
{"level":"debug","message":"Executing query [m8ortruznqane1jagpd]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T17:29:55.787Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T17:29:55.790Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:55.740Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T17:29:55.741Z"}
{"level":"debug","message":"Executing query [m8ortrxskk8pmg1v71j]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T17:29:55.889Z"}
{"level":"debug","message":"Executing query [m8ortry2jhxpdlk48]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T17:29:55.899Z"}
{"level":"debug","message":"Executing query [m8ortry6zj3z390y5tf]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[37]","timestamp":"2025-03-25T17:29:55.902Z"}
{"level":"debug","message":"Executing query [m8ortrwaau6zjyogbww]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:55.835Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:55.902Z"}
{"level":"debug","message":"Executing query [m8ortryaql1mdiz2d2]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:29:55.906Z"}
{"level":"debug","message":"Executing query [m8ortryd8hfgwvqkysc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:55.909Z"}
{"level":"debug","message":"Executing query [m8ortryo47n11ic0cuh]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742923795831\"]","timestamp":"2025-03-25T17:29:55.920Z"}
{"level":"debug","message":"Executing query [m8ortrysszg1iquotsq]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742923795831\",\"TEST-OFICIO-1742923795831\",8663,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:29:55.924Z"}
{"level":"debug","message":"Executing query [m8ortrz3mfm6z4h73h]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[39]","timestamp":"2025-03-25T17:29:55.935Z"}
{"level":"debug","message":"Executing query [m8ortrzau4ks9hi98ae]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742923795831\"]","timestamp":"2025-03-25T17:29:55.942Z"}
{"level":"debug","message":"Executing query [m8ortrzk4lsp16ex85]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",39]","timestamp":"2025-03-25T17:29:55.952Z"}
{"level":"debug","message":"Executing query [m8ortrzqy5t2nbmonq]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[39]","timestamp":"2025-03-25T17:29:55.958Z"}
{"level":"debug","message":"Executing query [m8ortrzu1gfxmj9992uh]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[39]","timestamp":"2025-03-25T17:29:55.962Z"}
{"level":"debug","message":"Executing query [m8orts00uyz9fbqz1zn]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[39]","timestamp":"2025-03-25T17:29:55.968Z"}
{"level":"debug","message":"Executing query [m8orts043zwqbaxm0ut]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[39]","timestamp":"2025-03-25T17:29:55.972Z"}
{"level":"debug","message":"Executing query [m8orts08u0x8u0cysn]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[39]","timestamp":"2025-03-25T17:29:55.976Z"}
{"level":"debug","message":"Executing query [m8orts0c8ozxfdsr1xq]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742923795980\",\"TEST-SP-OFICIO-1742923795980\",3890,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T17:29:55.980Z"}
{"level":"debug","message":"Executing query [m8orts0j1lb8fvqvymb]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742923795980\"]","timestamp":"2025-03-25T17:29:55.987Z"}
{"level":"debug","message":"Executing query [m8orts0ljmvj7i230d]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742923795980\"]","timestamp":"2025-03-25T17:29:55.989Z"}
{"level":"debug","message":"Executing query [m8orts0qps8g2j86ep]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:55.994Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:55.997Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T17:29:56.100Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T17:29:56.101Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T17:29:56.102Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T17:29:56.103Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T17:29:56.105Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T17:29:56.105Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:56.136Z"}
{"level":"debug","message":"Executing query [m8orts6kz5m0zxosvb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:56.204Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:56.268Z"}
{"level":"debug","message":"Executing query [m8orts8he28mhcz9vu]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:29:56.273Z"}
{"level":"debug","message":"Executing query [m8orts8loy4u28s74br]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742923796188\"]","timestamp":"2025-03-25T17:29:56.278Z"}
{"level":"debug","message":"Executing query [m8orts8o4kufcj0roxx]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742923796188\",\"TEST-OFI-FORENSE-1742923796188\",9014,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742923796188\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:29:56.280Z"}
{"level":"debug","message":"Executing query [m8orts8x8nr18a07e6j]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.289Z"}
{"level":"debug","message":"Executing query [m8orts93o1ot57ind4f]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742923796188\"]","timestamp":"2025-03-25T17:29:56.295Z"}
{"level":"debug","message":"Executing query [m8orts989phbt8hz6un]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",39]","timestamp":"2025-03-25T17:29:56.300Z"}
{"level":"debug","message":"Executing query [m8orts9cjthrlzvkmlk]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.304Z"}
{"level":"debug","message":"Executing query [m8orts9g9bsiy2kalc]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.308Z"}
{"level":"debug","message":"Executing query [m8orts9lpnouh87bhri]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.313Z"}
{"level":"debug","message":"Executing query [m8orts9p67hugim9a95]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.317Z"}
{"level":"debug","message":"Executing query [m8orts9uoqelru3mcd]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.322Z"}
{"level":"debug","message":"Executing query [m8orts9z3uj0l54eb3]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742923796327\",\"TEST-SP-OFI-FORENSE-1742923796327\",8087,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T17:29:56.327Z"}
{"level":"debug","message":"Executing query [m8ortsa4vd69crb1oec]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742923796327\"]","timestamp":"2025-03-25T17:29:56.333Z"}
{"level":"debug","message":"Executing query [m8ortsa7cov2xmd43ml]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742923796327\"]","timestamp":"2025-03-25T17:29:56.336Z"}
{"level":"debug","message":"Executing query [m8ortsabmrd7pycyy2l]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:56.339Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:56.342Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:56.428Z"}
{"level":"debug","message":"Executing query [m8ortsd1gj65nrp6fn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:56.437Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:56.463Z"}
{"level":"debug","message":"Executing query [m8ortsds1mtnmcchspp]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:29:56.464Z"}
{"level":"debug","message":"Executing query [m8ortsdw4vn20ecyej3]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T17:29:56.468Z"}
{"level":"debug","message":"Executing query [m8ortsdyg1gmypi8m5]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T17:29:56.471Z"}
{"level":"debug","message":"Executing query [m8ortse2878btxr52mk]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T17:29:56.474Z"}
{"level":"debug","message":"Executing query [m8ortse6b2nmqdtopep]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T17:29:56.479Z"}
{"level":"debug","message":"Executing query [m8ortsebbxlz75x2ll9]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[39,888,40,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T17:29:56.483Z\",\"ACTIVO\"]","timestamp":"2025-03-25T17:29:56.484Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 40, Área ID: 888, Rol ID: 888, Documento ID: 39","timestamp":"2025-03-25T17:29:56.489Z"}
{"level":"debug","message":"Executing query [m8ortseiuo05i63auq]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[39,40,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T17:29:56.490Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8ortseiuo05i63auq]","params":"[39,40,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T17:29:56.501Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T17:29:56.501Z"}
{"level":"debug","message":"Executing query [m8ortseu5xikfietlew]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.502Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8ortseu5xikfietlew]","params":"[39]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T17:29:56.509Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T17:29:56.509Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T17:29:56.509Z"}
{"level":"debug","message":"Executing query [m8ortsf24sypsh5r662]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[39,40,\"RESTAURAR\"]","timestamp":"2025-03-25T17:29:56.510Z"}
{"level":"debug","message":"Executing query [m8ortsfnwyr8aiz591i]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.532Z"}
{"level":"debug","message":"Executing query [m8ortsfrycmr2etirs]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[39,40,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T17:29:56.535Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8ortsfrycmr2etirs]","params":"[39,40,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T17:29:56.543Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T17:29:56.544Z"}
{"level":"debug","message":"Executing query [m8ortsg07w91bsgn0hp]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.544Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8ortsg07w91bsgn0hp]","params":"[39]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T17:29:56.548Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T17:29:56.549Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T17:29:56.549Z"}
{"level":"debug","message":"Executing query [m8ortsg69njmq1xabm7]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[39,888,40,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T17:29:56.550Z\",\"ACTIVO\"]","timestamp":"2025-03-25T17:29:56.550Z"}
{"level":"debug","message":"Executing query [m8ortsg9jn4z1bywbe]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T17:29:56.553Z"}
{"level":"debug","message":"Executing query [m8ortsgdfcvmhgf8qof]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[40,\"DOCUMENTO\",40,\"ELIMINAR\"]","timestamp":"2025-03-25T17:29:56.557Z"}
{"level":"debug","message":"Executing query [m8ortsgwi2vcvjttioa]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.576Z"}
{"level":"debug","message":"Executing query [m8ortsh1enoz1rtzk4m]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T17:29:56.581Z"}
{"level":"debug","message":"Executing query [m8ortsh65mrn5428s07]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.586Z"}
{"level":"debug","message":"Executing query [m8ortshalgjblw5mtt]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:29:56.590Z"}
{"level":"debug","message":"Executing query [m8ortshcgr3n4jh6rm]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:29:56.592Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:56.504Z"}
{"level":"debug","message":"Executing query [m8ortshffbb5d8i4br6]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:29:56.595Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T17:29:56.599Z"}
{"level":"debug","message":"Executing query [m8ortshk61f91we2qo8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:56.600Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:56.602Z"}
{"level":"debug","message":"Executing query [m8ortsgqiw9n4co922n]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:56.570Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:56.650Z"}
{"level":"debug","message":"Executing query [m8ortsj2sroky3ajszl]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:29:56.654Z"}
{"level":"debug","message":"Executing query [m8ortsj73ku9sncr7fk]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:29:56.659Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T17:29:56.661Z"}
{"level":"debug","message":"Executing query [m8ortsj9swgcohzb07]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T17:29:56.662Z"}
{"level":"debug","message":"Executing query [m8ortsjd4wmjz01j87]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T17:29:56.665Z"}
{"level":"debug","message":"Executing query [m8ortsjfs8elxuilxi]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T17:29:56.667Z"}
{"level":"debug","message":"Executing query [m8ortsjnaswzmc80g3]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.675Z"}
{"level":"debug","message":"Executing query [m8ortsjramwa1wwri6q]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.680Z"}
{"level":"debug","message":"Executing query [m8ortsjxe3a56opmlvb]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",40]","timestamp":"2025-03-25T17:29:56.685Z"}
{"level":"debug","message":"Executing query [m8ortsk299qrj12sr4r]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.691Z"}
{"level":"debug","message":"Executing query [m8ortsk65kragem1ffe]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.695Z"}
{"level":"debug","message":"Executing query [m8ortskbx8t8bl9tre]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.699Z"}
{"level":"debug","message":"Executing query [m8ortskegge2v3ohd1w]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:56.702Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:56.705Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:56.784Z"}
{"level":"debug","message":"Executing query [m8ortsntw73u1vie86r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:56.825Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:56.895Z"}
{"level":"debug","message":"Executing query [m8ortspw2yv4t5405od]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742923796823\"]","timestamp":"2025-03-25T17:29:56.900Z"}
{"level":"debug","message":"Executing query [m8ortspzed12obu8vtu]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742923796823\",true]","timestamp":"2025-03-25T17:29:56.903Z"}
{"level":"debug","message":"Executing query [m8ortsq70sabfuavy7xo]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.911Z"}
{"level":"debug","message":"Executing query [m8ortsqd5o7jk3deuhn]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742923796823\"]","timestamp":"2025-03-25T17:29:56.917Z"}
{"level":"debug","message":"Executing query [m8ortsqg8b1wyaap5pl]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",40]","timestamp":"2025-03-25T17:29:56.920Z"}
{"level":"debug","message":"Executing query [m8ortsqlpttc9kkgj6k]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.925Z"}
{"level":"debug","message":"Executing query [m8ortsqohtd8p098bg]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.929Z"}
{"level":"debug","message":"Executing query [m8ortsqvkbrj40845ia]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.935Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:56.922Z"}
{"level":"debug","message":"Executing query [m8ortsqyv1mrwy4mpr]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.939Z"}
{"level":"debug","message":"Executing query [m8ortsr2stnenvoa41]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.942Z"}
{"level":"debug","message":"Executing query [m8ortsr66hqziz0bkwb]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.946Z"}
{"level":"debug","message":"Executing query [m8ortsr9blxo1n0pvio]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T17:29:56.949Z"}
{"level":"debug","message":"Executing query [m8ortsrbeb9t0aj8ee7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:56.951Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:56.956Z"}
{"level":"debug","message":"Executing query [m8ortsqp4hq1q7pts07]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:56.929Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:56.966Z"}
{"level":"debug","message":"Executing query [m8ortsrskqxgsf0opas]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:29:56.968Z"}
{"level":"debug","message":"Executing query [m8ortsrzrtong5dlf]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742923796927\"]","timestamp":"2025-03-25T17:29:56.975Z"}
{"level":"debug","message":"Executing query [m8ortss1vk34lcattup]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742923796927\",\"TEST-OFI-QUIMICA-1742923796927\",4204,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:29:56.977Z"}
{"level":"debug","message":"Executing query [m8ortss8xkr3fde490q]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[20]","timestamp":"2025-03-25T17:29:56.984Z"}
{"level":"debug","message":"Executing query [m8ortssdos0gmnpka5]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742923796927\"]","timestamp":"2025-03-25T17:29:56.989Z"}
{"level":"debug","message":"Executing query [m8ortssgavy4qj4yunr]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",20]","timestamp":"2025-03-25T17:29:56.992Z"}
{"level":"debug","message":"Executing query [m8ortsslyk8aqezteu]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[20]","timestamp":"2025-03-25T17:29:56.997Z"}
{"level":"debug","message":"Executing query [m8ortssp34omum99xdm]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[20]","timestamp":"2025-03-25T17:29:57.001Z"}
{"level":"debug","message":"Executing query [m8ortsssvqvql18vxul]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[20]","timestamp":"2025-03-25T17:29:57.004Z"}
{"level":"debug","message":"Executing query [m8ortssvg1ec3qfhzz]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[20]","timestamp":"2025-03-25T17:29:57.007Z"}
{"level":"debug","message":"Executing query [m8ortst0rend2qspqh]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[20]","timestamp":"2025-03-25T17:29:57.012Z"}
{"level":"debug","message":"Executing query [m8ortst3cfj3jsha4ml]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:57.015Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:57.016Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:57.112Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:57.482Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:57.492Z"}
{"level":"debug","message":"Executing query [m8ortt6ej1ja9a4nft8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:57.494Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:57.520Z"}
{"level":"debug","message":"Executing query [m8ortt77dgj1swoqdrd]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:29:57.523Z"}
{"level":"debug","message":"Executing query [m8ortt7ae6619ug3vtl]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:29:57.526Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T17:29:57.528Z"}
{"level":"debug","message":"Executing query [m8ortt7cx274ibkes5g]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:29:57.528Z"}
{"level":"debug","message":"Executing query [m8ortt7diwhw3xqo1y]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:29:57.530Z"}
{"level":"debug","message":"Executing query [m8ortt7fiz8d30z3w5d]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:29:57.531Z"}
{"level":"debug","message":"Executing query [m8ortt7gk6kyksoly]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T17:29:57.532Z"}
{"level":"debug","message":"Executing query [m8ortt7mjsya8w8x3e]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[41]","timestamp":"2025-03-25T17:29:57.538Z"}
{"level":"debug","message":"Executing query [m8ortt7qxtl9ksc2hk]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:29:57.542Z"}
{"level":"debug","message":"Executing query [m8ortt7txel2ytvv2ci]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",41]","timestamp":"2025-03-25T17:29:57.545Z"}
{"level":"debug","message":"Executing query [m8ortt7ydcdimqhviz4]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[41]","timestamp":"2025-03-25T17:29:57.550Z"}
{"level":"debug","message":"Executing query [m8ortt80xocveqm3vfc]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[41]","timestamp":"2025-03-25T17:29:57.552Z"}
{"level":"debug","message":"Executing query [m8ortt84vlgbwtli9e]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[41]","timestamp":"2025-03-25T17:29:57.556Z"}
{"level":"debug","message":"Executing query [m8ortt86slbncf5evhq]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:29:57.558Z"}
{"level":"debug","message":"Executing query [m8ortt870fos5wpimeid]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:29:57.559Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T17:29:57.561Z"}
{"level":"debug","message":"Executing query [m8ortt89oukawjp05p]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:57.561Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:57.563Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:30:00.208Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:30:00.432Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:30:00.525Z"}
{"level":"debug","message":"Executing query [m8ortvk1gwgpvbuztlg]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T17:30:00.577Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:30:00.614Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:30:00.420Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:30:00.675Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T17:30:00.686Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:30:00.822Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T17:30:00.835Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:30:00.888Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:30:08.450Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:30:08.559Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T17:30:08.561Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:30:08.514Z"}
{"duration":"28ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T17:30:08.686Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:30:08.689Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T17:30:08.692Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:30:08.697Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:32.588Z"}
{"level":"debug","message":"Executing query [m8orx4v74f29rc2xsb5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:32.611Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:32.660Z"}
{"level":"debug","message":"Executing query [m8orx4wnydhjdwa4jg]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742923952610\"]","timestamp":"2025-03-25T17:32:32.663Z"}
{"level":"debug","message":"Executing query [m8orx4wrulnwkmol5fb]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742923952610\"]","timestamp":"2025-03-25T17:32:32.667Z"}
{"level":"debug","message":"Executing query [m8orx4wt0uhce1y2ggp]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742923952610\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:32:32.669Z"}
{"level":"debug","message":"Executing query [m8orx4x1dtdodrr1jp]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1019]","timestamp":"2025-03-25T17:32:32.677Z"}
{"level":"debug","message":"Executing query [m8orx4x65ojfuap2e5t]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742923952610\"]","timestamp":"2025-03-25T17:32:32.682Z"}
{"level":"debug","message":"Executing query [m8orx4x9i8y08euotf8]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1019]","timestamp":"2025-03-25T17:32:32.685Z"}
{"level":"debug","message":"Executing query [m8orx4xd2os9tig5jz8]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1019]","timestamp":"2025-03-25T17:32:32.689Z"}
{"level":"debug","message":"Executing query [m8orx4xghza4j8thxg7]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1019]","timestamp":"2025-03-25T17:32:32.692Z"}
{"level":"debug","message":"Executing query [m8orx4xjd9mazmlmwd5]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1019]","timestamp":"2025-03-25T17:32:32.696Z"}
{"level":"debug","message":"Executing query [m8orx4xmaupje95cncf]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1019]","timestamp":"2025-03-25T17:32:32.698Z"}
{"level":"debug","message":"Executing query [m8orx4xp0n0o9kjl20o]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1019]","timestamp":"2025-03-25T17:32:32.701Z"}
{"level":"debug","message":"Executing query [m8orx4xsuvyf3b22e6i]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1019]","timestamp":"2025-03-25T17:32:32.704Z"}
{"level":"debug","message":"Executing query [m8orx4xv7hee67a0jn9]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T17:32:32.707Z"}
{"level":"debug","message":"Executing query [m8orx4xx5b9w5famre]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:32.709Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:32.711Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:32:32.810Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:32:32.812Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:32:32.814Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:32:32.815Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:32:32.818Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:32:32.822Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:32:32.825Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:32:32.828Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:32:32.830Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:32:32.832Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:32:32.833Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T17:32:32.835Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:33.019Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:33.997Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:32:34.142Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T17:32:34.147Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:34.203Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T17:32:34.217Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:34.263Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:34.918Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:35.124Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:35.140Z"}
{"level":"debug","message":"Executing query [m8orx6tjzbfyqiqgpvg]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T17:32:35.143Z"}
{"level":"debug","message":"Executing query [m8orx6tlntvsb775rmm]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T17:32:35.145Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8orx6tlntvsb775rmm]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T17:32:35.148Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:35.149Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:35.258Z"}
{"level":"debug","message":"Executing query [m8orx6wtj7id37z80w8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:35.261Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:35.279Z"}
{"level":"debug","message":"Executing query [m8orx6xc756t31vejcv]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T17:32:35.280Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T17:32:35.283Z"}
{"level":"debug","message":"Executing query [m8orx6xg1bxvezvgotk]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T17:32:35.284Z"}
{"level":"debug","message":"Executing query [m8orx6xjp1xnw3l9el]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T17:32:35.287Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T17:32:35.289Z"}
{"level":"debug","message":"Executing query [m8orx6xmiquzpmkasa]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T17:32:35.290Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T17:32:35.292Z"}
{"level":"debug","message":"Executing query [m8orx6xviuglgpqfwa]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T17:32:35.299Z"}
{"level":"debug","message":"Executing query [m8orx6y7mdanugz7o]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T17:32:35.311Z"}
{"level":"debug","message":"Executing query [m8orx6ybm8a9wledq5k]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[39]","timestamp":"2025-03-25T17:32:35.315Z"}
{"level":"debug","message":"Executing query [m8orx6yj8owvn3pkzz9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:35.323Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:37.083Z"}
{"duration":"6ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T17:32:37.146Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T17:32:37.150Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:37.158Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T17:32:37.159Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T17:32:37.262Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T17:32:37.368Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:37.495Z"}
{"level":"debug","message":"Executing query [m8orx8mz2yk3jzz5kae]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:37.499Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:37.508Z"}
{"level":"debug","message":"Executing query [m8orx8nanydjxjensue]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:32:37.510Z"}
{"level":"debug","message":"Executing query [m8orx8ncvhoelrtkobr]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742923957498\"]","timestamp":"2025-03-25T17:32:37.512Z"}
{"level":"debug","message":"Executing query [m8orx8ne3ew7xata2x8]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742923957498\",\"TEST-OFICIO-1742923957498\",3911,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:32:37.514Z"}
{"level":"debug","message":"Executing query [m8orx8nlo6i9xhtp7r]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.521Z"}
{"level":"debug","message":"Executing query [m8orx8nox8nqv6m6f7i]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742923957498\"]","timestamp":"2025-03-25T17:32:37.524Z"}
{"level":"debug","message":"Executing query [m8orx8nu3gtj4llmpng]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",41]","timestamp":"2025-03-25T17:32:37.530Z"}
{"level":"debug","message":"Executing query [m8orx8ny2oa4puzayr7]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.534Z"}
{"level":"debug","message":"Executing query [m8orx8o1gh0oqc8hkpm]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.537Z"}
{"level":"debug","message":"Executing query [m8orx8o5n3l4pf62zgi]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.541Z"}
{"level":"debug","message":"Executing query [m8orx8o7gmvzjjph0re]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.543Z"}
{"level":"debug","message":"Executing query [m8orx8ob738zvq7zyhs]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.547Z"}
{"level":"debug","message":"Executing query [m8orx8oet9x8orq3ryb]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742923957550\",\"TEST-SP-OFICIO-1742923957550\",3254,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T17:32:37.550Z"}
{"level":"debug","message":"Executing query [m8orx8ok94oasb4bpon]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742923957550\"]","timestamp":"2025-03-25T17:32:37.556Z"}
{"level":"debug","message":"Executing query [m8orx8omk4s8gnp5ige]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742923957550\"]","timestamp":"2025-03-25T17:32:37.558Z"}
{"level":"debug","message":"Executing query [m8orx8ot6nfdybhlrfg]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:37.566Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:37.568Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:37.775Z"}
{"level":"debug","message":"Executing query [m8orx8uqixl3349l8r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:37.778Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:37.787Z"}
{"level":"debug","message":"Executing query [m8orx8v0ophbb18pl7d]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:32:37.788Z"}
{"level":"debug","message":"Executing query [m8orx8v3w1pkkibiwzp]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742923957777\"]","timestamp":"2025-03-25T17:32:37.791Z"}
{"level":"debug","message":"Executing query [m8orx8v49rvrd3nbbdg]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742923957777\",\"TEST-OFI-FORENSE-1742923957777\",5451,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742923957777\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:32:37.792Z"}
{"level":"debug","message":"Executing query [m8orx8varw2skasrhq]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.798Z"}
{"level":"debug","message":"Executing query [m8orx8vdvkuzgj0lk48]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742923957777\"]","timestamp":"2025-03-25T17:32:37.801Z"}
{"level":"debug","message":"Executing query [m8orx8vfdvorv0ynvht]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",41]","timestamp":"2025-03-25T17:32:37.803Z"}
{"level":"debug","message":"Executing query [m8orx8vjbgalmlema64]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.807Z"}
{"level":"debug","message":"Executing query [m8orx8vn2mgbow35r9m]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.811Z"}
{"level":"debug","message":"Executing query [m8orx8vqx81n8bkmrl]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.814Z"}
{"level":"debug","message":"Executing query [m8orx8vu4yha9ger2xs]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.818Z"}
{"level":"debug","message":"Executing query [m8orx8vxdsx7atq9a1g]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.821Z"}
{"level":"debug","message":"Executing query [m8orx8vyuqixques67]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742923957822\",\"TEST-SP-OFI-FORENSE-1742923957822\",2427,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T17:32:37.822Z"}
{"level":"debug","message":"Executing query [m8orx8w2o6tu66y9tpm]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742923957822\"]","timestamp":"2025-03-25T17:32:37.826Z"}
{"level":"debug","message":"Executing query [m8orx8w4wz4kkvgx5b]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742923957822\"]","timestamp":"2025-03-25T17:32:37.828Z"}
{"level":"debug","message":"Executing query [m8orx8w7pum5amxhz0f]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:37.831Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:37.833Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:38.626Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:38.676Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T17:32:38.678Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T17:32:38.776Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T17:32:38.777Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T17:32:38.778Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T17:32:38.778Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T17:32:38.779Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T17:32:38.779Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:39.146Z"}
{"level":"debug","message":"Executing query [m8orx9wssd8er1ufqa]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:39.148Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:39.158Z"}
{"level":"debug","message":"Executing query [m8orx9x46c34c8k19w]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742923959147\"]","timestamp":"2025-03-25T17:32:39.160Z"}
{"level":"debug","message":"Executing query [m8orx9x54k6r5gc3czs]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742923959147\",true]","timestamp":"2025-03-25T17:32:39.161Z"}
{"level":"debug","message":"Executing query [m8orx9xbxuv1fyzt06]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.168Z"}
{"level":"debug","message":"Executing query [m8orx9xfe71uyjpcuwr]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742923959147\"]","timestamp":"2025-03-25T17:32:39.171Z"}
{"level":"debug","message":"Executing query [m8orx9xi02kxhmctabo]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",41]","timestamp":"2025-03-25T17:32:39.174Z"}
{"level":"debug","message":"Executing query [m8orx9xmlbtcq7jve5n]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.179Z"}
{"level":"debug","message":"Executing query [m8orx9xp50ihlpacxlb]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.181Z"}
{"level":"debug","message":"Executing query [m8orx9xsrn982ymiu7k]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.184Z"}
{"level":"debug","message":"Executing query [m8orx9xvnl6vxqz6h7]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.187Z"}
{"level":"debug","message":"Executing query [m8orx9xyn256711tr0f]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.190Z"}
{"level":"debug","message":"Executing query [m8orx9y2hcv7a9376pn]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.194Z"}
{"level":"debug","message":"Executing query [m8orx9y3vga33avfuz]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T17:32:39.195Z"}
{"level":"debug","message":"Executing query [m8orx9y5kckwvieh0wj]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:39.197Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:39.198Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:39.378Z"}
{"level":"debug","message":"Executing query [m8orxa39bf0uvmm61o8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:39.381Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:39.390Z"}
{"level":"debug","message":"Executing query [m8orxa3k46n38s82wph]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:32:39.392Z"}
{"level":"debug","message":"Executing query [m8orxa3mwjoet4mitra]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T17:32:39.394Z"}
{"level":"debug","message":"Executing query [m8orxa3n9h3ej6g4a0s]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T17:32:39.395Z"}
{"level":"debug","message":"Executing query [m8orxa3oqrtvh7n0m3c]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T17:32:39.396Z"}
{"level":"debug","message":"Executing query [m8orxa3t0zqm1b6159m]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T17:32:39.401Z"}
{"level":"debug","message":"Executing query [m8orxa3xx9d7aij8f6]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[42,888,42,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T17:32:39.405Z\",\"ACTIVO\"]","timestamp":"2025-03-25T17:32:39.405Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 42, Área ID: 888, Rol ID: 888, Documento ID: 41","timestamp":"2025-03-25T17:32:39.409Z"}
{"level":"debug","message":"Executing query [m8orxa43cnp8ulufpct]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[41,42,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T17:32:39.411Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8orxa43cnp8ulufpct]","params":"[41,42,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T17:32:39.416Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T17:32:39.416Z"}
{"level":"debug","message":"Executing query [m8orxa49ycftl9r74ur]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.417Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8orxa49ycftl9r74ur]","params":"[41]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T17:32:39.419Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T17:32:39.419Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T17:32:39.419Z"}
{"level":"debug","message":"Executing query [m8orxa4dvccgf8y7s4]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[41,42,\"RESTAURAR\"]","timestamp":"2025-03-25T17:32:39.421Z"}
{"level":"debug","message":"Executing query [m8orxa4ia8i2q5ov7nq]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.426Z"}
{"level":"debug","message":"Executing query [m8orxa4lknugwl0ilo]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[41,42,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T17:32:39.429Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8orxa4lknugwl0ilo]","params":"[41,42,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T17:32:39.432Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T17:32:39.433Z"}
{"level":"debug","message":"Executing query [m8orxa4p4o78ns2gvbq]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.433Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8orxa4p4o78ns2gvbq]","params":"[41]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T17:32:39.436Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T17:32:39.437Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T17:32:39.437Z"}
{"level":"debug","message":"Executing query [m8orxa4umbi1c33ge6r]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[42,888,42,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T17:32:39.438Z\",\"ACTIVO\"]","timestamp":"2025-03-25T17:32:39.438Z"}
{"level":"debug","message":"Executing query [m8orxa4wz6jilf3oac9]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T17:32:39.440Z"}
{"level":"debug","message":"Executing query [m8orxa4z1s427379p6m]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[42,\"DOCUMENTO\",42,\"ELIMINAR\"]","timestamp":"2025-03-25T17:32:39.443Z"}
{"level":"debug","message":"Executing query [m8orxa51o6vq290z88]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[42]","timestamp":"2025-03-25T17:32:39.445Z"}
{"level":"debug","message":"Executing query [m8orxa55exvfdrom8o]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T17:32:39.449Z"}
{"level":"debug","message":"Executing query [m8orxa58pi38hkox2q]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[42]","timestamp":"2025-03-25T17:32:39.452Z"}
{"level":"debug","message":"Executing query [m8orxa5bqrp7jl10ds]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:32:39.455Z"}
{"level":"debug","message":"Executing query [m8orxa5dahq06fnn8t]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:32:39.457Z"}
{"level":"debug","message":"Executing query [m8orxa5e0ew5rg06inoo]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:32:39.458Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T17:32:39.461Z"}
{"level":"debug","message":"Executing query [m8orxa5hbwfkh2tnu9v]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:39.461Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:39.462Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:39.567Z"}
{"level":"debug","message":"Executing query [m8orxa8i61fh3gffu6l]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:39.570Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:39.584Z"}
{"level":"debug","message":"Executing query [m8orxa8xd2r73bvoz9j]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:32:39.585Z"}
{"level":"debug","message":"Executing query [m8orxa8yzkxzatpi1vh]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:32:39.586Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T17:32:39.588Z"}
{"level":"debug","message":"Executing query [m8orxa91lblf9afw0f]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T17:32:39.589Z"}
{"level":"debug","message":"Executing query [m8orxa92bkq4l16d78m]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T17:32:39.591Z"}
{"level":"debug","message":"Executing query [m8orxa94bsoxwi555z]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T17:32:39.592Z"}
{"level":"debug","message":"Executing query [m8orxa988x8f079wcdt]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[42]","timestamp":"2025-03-25T17:32:39.596Z"}
{"level":"debug","message":"Executing query [m8orxa9anqd4losu3lk]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[42]","timestamp":"2025-03-25T17:32:39.598Z"}
{"level":"debug","message":"Executing query [m8orxa9de37cdumord]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",42]","timestamp":"2025-03-25T17:32:39.601Z"}
{"level":"debug","message":"Executing query [m8orxa9gar1hulmga3]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[42]","timestamp":"2025-03-25T17:32:39.604Z"}
{"level":"debug","message":"Executing query [m8orxa9iq615b4jwvth]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[42]","timestamp":"2025-03-25T17:32:39.606Z"}
{"level":"debug","message":"Executing query [m8orxa9l746k80qvdzk]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[42]","timestamp":"2025-03-25T17:32:39.609Z"}
{"level":"debug","message":"Executing query [m8orxa9n3kw1465fkk2]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:39.611Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:39.612Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:39.782Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:40.185Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:32:40.239Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:40.293Z"}
{"level":"debug","message":"Executing query [m8orxatpyn2vo4f8k7]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T17:32:40.333Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:40.368Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:40.561Z"}
{"level":"debug","message":"Executing query [m8orxb03nlczdqni47]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:40.564Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:40.573Z"}
{"level":"debug","message":"Executing query [m8orxb0fq1gm75plq5]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:32:40.575Z"}
{"level":"debug","message":"Executing query [m8orxb0hers4m350vhg]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742923960563\"]","timestamp":"2025-03-25T17:32:40.577Z"}
{"level":"debug","message":"Executing query [m8orxb0i15pjjbpxqpm]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742923960563\",\"TEST-OFI-QUIMICA-1742923960563\",4480,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:32:40.578Z"}
{"level":"debug","message":"Executing query [m8orxb0njoqlrmimste]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[21]","timestamp":"2025-03-25T17:32:40.583Z"}
{"level":"debug","message":"Executing query [m8orxb0paed2kpdd3h]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742923960563\"]","timestamp":"2025-03-25T17:32:40.585Z"}
{"level":"debug","message":"Executing query [m8orxb0rsxlqyd5rkhq]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",21]","timestamp":"2025-03-25T17:32:40.587Z"}
{"level":"debug","message":"Executing query [m8orxb0wworesg0psgg]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[21]","timestamp":"2025-03-25T17:32:40.592Z"}
{"level":"debug","message":"Executing query [m8orxb0xzho6z9j4pa]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[21]","timestamp":"2025-03-25T17:32:40.593Z"}
{"level":"debug","message":"Executing query [m8orxb11ehhb5il4gd]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[21]","timestamp":"2025-03-25T17:32:40.597Z"}
{"level":"debug","message":"Executing query [m8orxb1398k6a7zppp]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[21]","timestamp":"2025-03-25T17:32:40.599Z"}
{"level":"debug","message":"Executing query [m8orxb163eqlgjocdjc]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[21]","timestamp":"2025-03-25T17:32:40.602Z"}
{"level":"debug","message":"Executing query [m8orxb188nyy3epojvb]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:40.604Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:40.605Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:41.938Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:41.942Z"}
{"level":"debug","message":"Executing query [m8orxc2f4dimmx4px8i]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:41.943Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:41.953Z"}
{"level":"debug","message":"Executing query [m8orxc2qr0g1p3bj1c]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:32:41.954Z"}
{"level":"debug","message":"Executing query [m8orxc2r3uz5we4m0fo]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:32:41.956Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T17:32:41.957Z"}
{"level":"debug","message":"Executing query [m8orxc2ux1bkwjjx33i]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:32:41.958Z"}
{"level":"debug","message":"Executing query [m8orxc2vfvtyrj3ead]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:32:41.959Z"}
{"level":"debug","message":"Executing query [m8orxc2wb48stcg41l]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:32:41.960Z"}
{"level":"debug","message":"Executing query [m8orxc2xzufh7itfnbj]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T17:32:41.961Z"}
{"level":"debug","message":"Executing query [m8orxc31ha0cyv3m0yd]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[43]","timestamp":"2025-03-25T17:32:41.965Z"}
{"level":"debug","message":"Executing query [m8orxc32emtqv0fjt4t]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:32:41.966Z"}
{"level":"debug","message":"Executing query [m8orxc34fvdmh5u1lna]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",43]","timestamp":"2025-03-25T17:32:41.968Z"}
{"level":"debug","message":"Executing query [m8orxc37vve7rwtas1d]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[43]","timestamp":"2025-03-25T17:32:41.971Z"}
{"level":"debug","message":"Executing query [m8orxc395w4vmpw4k8v]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[43]","timestamp":"2025-03-25T17:32:41.973Z"}
{"level":"debug","message":"Executing query [m8orxc3cbjii36h4hid]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[43]","timestamp":"2025-03-25T17:32:41.976Z"}
{"level":"debug","message":"Executing query [m8orxc3eufsh2r5mzbj]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:32:41.978Z"}
{"level":"debug","message":"Executing query [m8orxc3fnur2hn1j2yj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:32:41.979Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T17:32:41.980Z"}
{"level":"debug","message":"Executing query [m8orxc3hk0il75ojvy7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:41.981Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:41.982Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:23.366Z"}
{"level":"debug","message":"Executing query [m8ory81nbl2wvx4puu5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:23.387Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:23.414Z"}
{"level":"debug","message":"Executing query [m8ory82igjvlysl9dy]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742924003386\"]","timestamp":"2025-03-25T17:33:23.418Z"}
{"level":"debug","message":"Executing query [m8ory82m4vtcljjt2mf]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742924003386\"]","timestamp":"2025-03-25T17:33:23.422Z"}
{"level":"debug","message":"Executing query [m8ory82pbxugpz23qgp]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742924003386\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:33:23.425Z"}
{"level":"debug","message":"Executing query [m8ory82y3vumpju3z4h]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1020]","timestamp":"2025-03-25T17:33:23.434Z"}
{"level":"debug","message":"Executing query [m8ory831b0nvtcer5n]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742924003386\"]","timestamp":"2025-03-25T17:33:23.437Z"}
{"level":"debug","message":"Executing query [m8ory83430tqbogmtaq]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1020]","timestamp":"2025-03-25T17:33:23.440Z"}
{"level":"debug","message":"Executing query [m8ory8375dw7pwkpkwe]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1020]","timestamp":"2025-03-25T17:33:23.443Z"}
{"level":"debug","message":"Executing query [m8ory83aoz43ynryy68]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1020]","timestamp":"2025-03-25T17:33:23.446Z"}
{"level":"debug","message":"Executing query [m8ory83e1lan2mfnbkr]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1020]","timestamp":"2025-03-25T17:33:23.450Z"}
{"level":"debug","message":"Executing query [m8ory83glbafek9hft7]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1020]","timestamp":"2025-03-25T17:33:23.452Z"}
{"level":"debug","message":"Executing query [m8ory83igawzara181]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1020]","timestamp":"2025-03-25T17:33:23.454Z"}
{"level":"debug","message":"Executing query [m8ory83lvqm1e5lj14d]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1020]","timestamp":"2025-03-25T17:33:23.457Z"}
{"level":"debug","message":"Executing query [m8ory83o4o5kc43o2ue]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T17:33:23.460Z"}
{"level":"debug","message":"Executing query [m8ory83q67ecxlm57t]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:23.462Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:23.464Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:33:23.557Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:33:23.559Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:33:23.561Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:33:23.563Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:33:23.566Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:33:23.568Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:33:23.572Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:33:23.576Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:33:23.577Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:33:23.579Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:33:23.580Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T17:33:23.581Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:23.763Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:24.761Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:33:24.905Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T17:33:24.910Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:24.967Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T17:33:24.980Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:25.026Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:25.621Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:25.850Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:25.866Z"}
{"level":"debug","message":"Executing query [m8ory9yl6c7vwbuqra]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T17:33:25.869Z"}
{"level":"debug","message":"Executing query [m8ory9yn2535k9yy1ogi]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T17:33:25.871Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8ory9yn2535k9yy1ogi]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T17:33:25.873Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:25.874Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:25.976Z"}
{"level":"debug","message":"Executing query [m8orya1nvq80fcf790o]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:25.979Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:25.996Z"}
{"level":"debug","message":"Executing query [m8orya26nz09ookpy8l]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T17:33:25.998Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T17:33:25.999Z"}
{"level":"debug","message":"Executing query [m8orya282o5hf1zhm3j]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T17:33:26.000Z"}
{"level":"debug","message":"Executing query [m8orya2a7gkk36py93m]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T17:33:26.002Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T17:33:26.004Z"}
{"level":"debug","message":"Executing query [m8orya2csp8kapil8dm]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T17:33:26.004Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T17:33:26.006Z"}
{"level":"debug","message":"Executing query [m8orya2jx6ii9ptnqm]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T17:33:26.011Z"}
{"level":"debug","message":"Executing query [m8orya2m4ihw4s07da]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T17:33:26.014Z"}
{"level":"debug","message":"Executing query [m8orya2wmn9ssfxawf]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[41]","timestamp":"2025-03-25T17:33:26.024Z"}
{"level":"debug","message":"Executing query [m8orya31z9pngz9zm0k]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:26.029Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:27.686Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T17:33:27.745Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T17:33:27.751Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:27.759Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T17:33:27.761Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T17:33:27.854Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T17:33:27.955Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:28.078Z"}
{"level":"debug","message":"Executing query [m8orybo1f8dsw2k9z2j]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:28.081Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:28.090Z"}
{"level":"debug","message":"Executing query [m8oryboc59wjtqqn6er]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:33:28.092Z"}
{"level":"debug","message":"Executing query [m8oryboebgejn3zi55]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742924008080\"]","timestamp":"2025-03-25T17:33:28.094Z"}
{"level":"debug","message":"Executing query [m8orybof34t7dk04d6i]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742924008080\",\"TEST-OFICIO-1742924008080\",4751,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:33:28.095Z"}
{"level":"debug","message":"Executing query [m8orybolj12o54yn61s]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.101Z"}
{"level":"debug","message":"Executing query [m8orybonhfcueptc2n]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742924008080\"]","timestamp":"2025-03-25T17:33:28.103Z"}
{"level":"debug","message":"Executing query [m8orybotteaeytkyak]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",43]","timestamp":"2025-03-25T17:33:28.109Z"}
{"level":"debug","message":"Executing query [m8orybowcna8ai0oymu]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.112Z"}
{"level":"debug","message":"Executing query [m8orybozu1ly3bq8tsr]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.115Z"}
{"level":"debug","message":"Executing query [m8orybp23uqai5enpei]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.118Z"}
{"level":"debug","message":"Executing query [m8orybp4qgapw1yd9ql]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.120Z"}
{"level":"debug","message":"Executing query [m8orybp7sba3738kmh]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.123Z"}
{"level":"debug","message":"Executing query [m8orybp8his4khmgauv]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742924008124\",\"TEST-SP-OFICIO-1742924008124\",201,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T17:33:28.124Z"}
{"level":"debug","message":"Executing query [m8orybpbw28jp9ygxlf]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742924008124\"]","timestamp":"2025-03-25T17:33:28.127Z"}
{"level":"debug","message":"Executing query [m8orybpdzfgr9ggfmt]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742924008124\"]","timestamp":"2025-03-25T17:33:28.129Z"}
{"level":"debug","message":"Executing query [m8orybpf07ebflm3toso]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:28.131Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:28.132Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:28.314Z"}
{"level":"debug","message":"Executing query [m8orybul2p53svwcu6u]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:28.317Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:28.326Z"}
{"level":"debug","message":"Executing query [m8orybuvowmrf9tp7ee]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:33:28.327Z"}
{"level":"debug","message":"Executing query [m8orybuyoxm1oi6908i]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742924008316\"]","timestamp":"2025-03-25T17:33:28.330Z"}
{"level":"debug","message":"Executing query [m8orybuzkbh0brfz94k]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742924008316\",\"TEST-OFI-FORENSE-1742924008316\",3391,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742924008316\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:33:28.331Z"}
{"level":"debug","message":"Executing query [m8orybv5xnatjxo43ba]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.337Z"}
{"level":"debug","message":"Executing query [m8orybv88iocqauouuk]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742924008316\"]","timestamp":"2025-03-25T17:33:28.340Z"}
{"level":"debug","message":"Executing query [m8orybv9d6rnw60wqk4]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",43]","timestamp":"2025-03-25T17:33:28.341Z"}
{"level":"debug","message":"Executing query [m8orybve94fiwj4cew7]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.346Z"}
{"level":"debug","message":"Executing query [m8orybvglujv12x7u1p]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.348Z"}
{"level":"debug","message":"Executing query [m8orybvkr2szx72n0t9]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.352Z"}
{"level":"debug","message":"Executing query [m8orybvmjs90onvnlen]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.354Z"}
{"level":"debug","message":"Executing query [m8orybvpzikwobx34pc]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.357Z"}
{"level":"debug","message":"Executing query [m8orybvrg16jnz936a7]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742924008359\",\"TEST-SP-OFI-FORENSE-1742924008359\",3933,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T17:33:28.359Z"}
{"level":"debug","message":"Executing query [m8orybvuq8tr0i58c1]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742924008359\"]","timestamp":"2025-03-25T17:33:28.363Z"}
{"level":"debug","message":"Executing query [m8orybvwbmqum2j40qi]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742924008359\"]","timestamp":"2025-03-25T17:33:28.364Z"}
{"level":"debug","message":"Executing query [m8orybvz6fsndkqomce]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:28.367Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:28.368Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:29.155Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:29.201Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T17:33:29.204Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T17:33:29.296Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T17:33:29.297Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T17:33:29.298Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T17:33:29.298Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T17:33:29.299Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T17:33:29.299Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:29.687Z"}
{"level":"debug","message":"Executing query [m8orycwqggp4vchykn5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:29.690Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:29.700Z"}
{"level":"debug","message":"Executing query [m8orycx15aaa3qnw2do]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742924009690\"]","timestamp":"2025-03-25T17:33:29.701Z"}
{"level":"debug","message":"Executing query [m8orycx3vls09d1a2gl]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742924009690\",true]","timestamp":"2025-03-25T17:33:29.703Z"}
{"level":"debug","message":"Executing query [m8orycxaepq71xe9z66]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.710Z"}
{"level":"debug","message":"Executing query [m8orycxdbkhwz69b2mj]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742924009690\"]","timestamp":"2025-03-25T17:33:29.713Z"}
{"level":"debug","message":"Executing query [m8orycxf62m9kow5va8]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",43]","timestamp":"2025-03-25T17:33:29.715Z"}
{"level":"debug","message":"Executing query [m8orycxioj0vicknb4p]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.718Z"}
{"level":"debug","message":"Executing query [m8orycxkl2uc1949kts]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.720Z"}
{"level":"debug","message":"Executing query [m8orycxm9ic7atbu2sp]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.722Z"}
{"level":"debug","message":"Executing query [m8orycxpnvkbqzpcg2k]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.725Z"}
{"level":"debug","message":"Executing query [m8orycxtdg0t1ujmmt6]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.729Z"}
{"level":"debug","message":"Executing query [m8orycxwlwqj0653dhb]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.732Z"}
{"level":"debug","message":"Executing query [m8orycxxvu8apgy22tl]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T17:33:29.734Z"}
{"level":"debug","message":"Executing query [m8orycxzkd4ntgvvsxp]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:29.735Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:29.735Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:29.909Z"}
{"level":"debug","message":"Executing query [m8oryd2xljbf1us7iu]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:29.913Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:29.922Z"}
{"level":"debug","message":"Executing query [m8oryd37cxhzhe32155]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:33:29.923Z"}
{"level":"debug","message":"Executing query [m8oryd396gzvd1t1i4m]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T17:33:29.925Z"}
{"level":"debug","message":"Executing query [m8oryd3akmossfyo59o]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T17:33:29.926Z"}
{"level":"debug","message":"Executing query [m8oryd3b8ifc7mldk1c]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T17:33:29.927Z"}
{"level":"debug","message":"Executing query [m8oryd3gi3omtl0epa]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T17:33:29.932Z"}
{"level":"debug","message":"Executing query [m8oryd3jvnv8g6otape]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[44,888,44,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T17:33:29.935Z\",\"ACTIVO\"]","timestamp":"2025-03-25T17:33:29.935Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 44, Área ID: 888, Rol ID: 888, Documento ID: 43","timestamp":"2025-03-25T17:33:29.939Z"}
{"level":"debug","message":"Executing query [m8oryd3oxep8qch0e7k]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[43,44,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T17:33:29.940Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8oryd3oxep8qch0e7k]","params":"[43,44,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T17:33:29.945Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T17:33:29.946Z"}
{"level":"debug","message":"Executing query [m8oryd3u7rj2ud2qo83]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.946Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8oryd3u7rj2ud2qo83]","params":"[43]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T17:33:29.949Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T17:33:29.950Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T17:33:29.950Z"}
{"level":"debug","message":"Executing query [m8oryd3zgj3xmhyovxt]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[43,44,\"RESTAURAR\"]","timestamp":"2025-03-25T17:33:29.951Z"}
{"level":"debug","message":"Executing query [m8oryd45xnzkxm0lp9n]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.957Z"}
{"level":"debug","message":"Executing query [m8oryd4765btgkn9w8n]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[43,44,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T17:33:29.959Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8oryd4765btgkn9w8n]","params":"[43,44,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T17:33:29.965Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T17:33:29.966Z"}
{"level":"debug","message":"Executing query [m8oryd4fbr2qjgfnkbh]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.967Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8oryd4fbr2qjgfnkbh]","params":"[43]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T17:33:29.969Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T17:33:29.970Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T17:33:29.970Z"}
{"level":"debug","message":"Executing query [m8oryd4jclynzvrab5r]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[44,888,44,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T17:33:29.971Z\",\"ACTIVO\"]","timestamp":"2025-03-25T17:33:29.971Z"}
{"level":"debug","message":"Executing query [m8oryd4m51ykeq3eaqe]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T17:33:29.974Z"}
{"level":"debug","message":"Executing query [m8oryd4puyd3tsfmf3]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[44,\"DOCUMENTO\",44,\"ELIMINAR\"]","timestamp":"2025-03-25T17:33:29.977Z"}
{"level":"debug","message":"Executing query [m8oryd4rifub95hiuz9]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[44]","timestamp":"2025-03-25T17:33:29.979Z"}
{"level":"debug","message":"Executing query [m8oryd4umtwjljj54w]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T17:33:29.982Z"}
{"level":"debug","message":"Executing query [m8oryd4yntqa2oosmk]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[44]","timestamp":"2025-03-25T17:33:29.986Z"}
{"level":"debug","message":"Executing query [m8oryd51zow0jvkzrp]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:33:29.989Z"}
{"level":"debug","message":"Executing query [m8oryd523ak6k125e8m]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:33:29.990Z"}
{"level":"debug","message":"Executing query [m8oryd53shq7rejurvp]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:33:29.991Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T17:33:29.994Z"}
{"level":"debug","message":"Executing query [m8oryd57zw0hee83mo]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:29.995Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:29.996Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:30.094Z"}
{"level":"debug","message":"Executing query [m8oryd8115ro89251ja]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:30.097Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:30.110Z"}
{"level":"debug","message":"Executing query [m8oryd8fhic6dc3kq7t]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:33:30.111Z"}
{"level":"debug","message":"Executing query [m8oryd8hdzr4ywf0xlo]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:33:30.113Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T17:33:30.115Z"}
{"level":"debug","message":"Executing query [m8oryd8j36ns7kifs6]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T17:33:30.115Z"}
{"level":"debug","message":"Executing query [m8oryd8k2zz8b6s6wz3]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T17:33:30.116Z"}
{"level":"debug","message":"Executing query [m8oryd8lerl3inao6gf]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T17:33:30.117Z"}
{"level":"debug","message":"Executing query [m8oryd8p3b02fkqh1vt]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[44]","timestamp":"2025-03-25T17:33:30.121Z"}
{"level":"debug","message":"Executing query [m8oryd8sf64cwazhk05]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[44]","timestamp":"2025-03-25T17:33:30.124Z"}
{"level":"debug","message":"Executing query [m8oryd8u2n16zyvk6q2]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",44]","timestamp":"2025-03-25T17:33:30.126Z"}
{"level":"debug","message":"Executing query [m8oryd8xsgvw1m45cv]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[44]","timestamp":"2025-03-25T17:33:30.129Z"}
{"level":"debug","message":"Executing query [m8oryd8zubzslzlpyw9]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[44]","timestamp":"2025-03-25T17:33:30.131Z"}
{"level":"debug","message":"Executing query [m8oryd92va498ciqsa]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[44]","timestamp":"2025-03-25T17:33:30.134Z"}
{"level":"debug","message":"Executing query [m8oryd93bc3c6uz1oc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:30.135Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:30.137Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:30.305Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:30.697Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:33:30.752Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:30.800Z"}
{"level":"debug","message":"Executing query [m8oryds5d5xi81onlkv]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T17:33:30.821Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:30.854Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:31.037Z"}
{"level":"debug","message":"Executing query [m8orydy7bo73nzyc3wu]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:31.039Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:31.048Z"}
{"level":"debug","message":"Executing query [m8orydyidkdk17nr1i6]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:33:31.050Z"}
{"level":"debug","message":"Executing query [m8orydyk6cdg8s7cu0t]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742924011039\"]","timestamp":"2025-03-25T17:33:31.052Z"}
{"level":"debug","message":"Executing query [m8orydymvq4s81awd1d]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742924011039\",\"TEST-OFI-QUIMICA-1742924011039\",9999,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:33:31.054Z"}
{"level":"debug","message":"Executing query [m8orydyssbszhdq330j]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[22]","timestamp":"2025-03-25T17:33:31.060Z"}
{"level":"debug","message":"Executing query [m8orydyv4mpb2womg17]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742924011039\"]","timestamp":"2025-03-25T17:33:31.063Z"}
{"level":"debug","message":"Executing query [m8orydyy3lf4rjchqhb]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",22]","timestamp":"2025-03-25T17:33:31.066Z"}
{"level":"debug","message":"Executing query [m8orydz1nbgvsqa20nq]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[22]","timestamp":"2025-03-25T17:33:31.069Z"}
{"level":"debug","message":"Executing query [m8orydz4nmvtrzdywd]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[22]","timestamp":"2025-03-25T17:33:31.072Z"}
{"level":"debug","message":"Executing query [m8orydz71x9knc83du3j]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[22]","timestamp":"2025-03-25T17:33:31.075Z"}
{"level":"debug","message":"Executing query [m8orydz8tzv65pup6qk]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[22]","timestamp":"2025-03-25T17:33:31.076Z"}
{"level":"debug","message":"Executing query [m8orydzc5ymz4re94qd]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[22]","timestamp":"2025-03-25T17:33:31.080Z"}
{"level":"debug","message":"Executing query [m8orydzeqcay0la27pj]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:31.082Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:31.086Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:32.420Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:32.423Z"}
{"level":"debug","message":"Executing query [m8oryf0p4754wpmn82h]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:32.425Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:32.435Z"}
{"level":"debug","message":"Executing query [m8oryf10yjehmg8e6vm]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:33:32.436Z"}
{"level":"debug","message":"Executing query [m8oryf11uvxwspt26pf]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:33:32.437Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T17:33:32.438Z"}
{"level":"debug","message":"Executing query [m8oryf131euyz01ebxi]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:33:32.439Z"}
{"level":"debug","message":"Executing query [m8oryf14rwxgjvebvpj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:33:32.440Z"}
{"level":"debug","message":"Executing query [m8oryf168te4qbabf1y]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:33:32.442Z"}
{"level":"debug","message":"Executing query [m8oryf16r7xatupj94]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T17:33:32.442Z"}
{"level":"debug","message":"Executing query [m8oryf1c79qkcl1yhgh]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[45]","timestamp":"2025-03-25T17:33:32.448Z"}
{"level":"debug","message":"Executing query [m8oryf1fy1rcq7f0uv]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:33:32.451Z"}
{"level":"debug","message":"Executing query [m8oryf1gxwgs1026zum]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",45]","timestamp":"2025-03-25T17:33:32.452Z"}
{"level":"debug","message":"Executing query [m8oryf1kgghaqkdwl5]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[45]","timestamp":"2025-03-25T17:33:32.456Z"}
{"level":"debug","message":"Executing query [m8oryf1lygp921o49mj]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[45]","timestamp":"2025-03-25T17:33:32.457Z"}
{"level":"debug","message":"Executing query [m8oryf25a42f4g6z8a5]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[45]","timestamp":"2025-03-25T17:33:32.477Z"}
{"level":"debug","message":"Executing query [m8oryf26kndmucgqd2s]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:33:32.478Z"}
{"level":"debug","message":"Executing query [m8oryf27imwcj9ryhul]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:33:32.479Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T17:33:32.480Z"}
{"level":"debug","message":"Executing query [m8oryf28o9xhe78pwqj]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:32.481Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:32.482Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T17:34:29.522Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T17:34:29.526Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T17:34:29.527Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T17:34:29.527Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T17:34:29.528Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T17:34:29.528Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:34:43.055Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:34:43.085Z"}
{"level":"debug","message":"Executing query [m8orzxjkop9nxy6jce]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:34:43.089Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:34:43.124Z"}
{"level":"debug","message":"Executing query [m8orzxknh54w15amwwk]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:34:43.127Z"}
{"level":"debug","message":"Executing query [m8orzxkq6zkwq2dfcc]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:34:43.130Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T17:34:43.132Z"}
{"level":"debug","message":"Executing query [m8orzxktlw5sfxpjmr]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:34:43.133Z"}
{"level":"debug","message":"Executing query [m8orzxku27fifou27f5]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:34:43.134Z"}
{"level":"debug","message":"Executing query [m8orzxky2m45h53we3w]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:34:43.138Z"}
{"level":"debug","message":"Executing query [m8orzxkztjroawc7ykg]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T17:34:43.139Z"}
{"level":"debug","message":"Executing query [m8orzxl7q2vmoi4hjx]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[46]","timestamp":"2025-03-25T17:34:43.147Z"}
{"level":"debug","message":"Executing query [m8orzxlafs39m61sbgu]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:34:43.151Z"}
{"level":"debug","message":"Executing query [m8orzxlf2lyeic4465w]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",46]","timestamp":"2025-03-25T17:34:43.155Z"}
{"level":"debug","message":"Executing query [m8orzxlki561xkcemn]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[46]","timestamp":"2025-03-25T17:34:43.160Z"}
{"level":"debug","message":"Executing query [m8orzxlmz7ltktyfyd]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[46]","timestamp":"2025-03-25T17:34:43.162Z"}
{"level":"debug","message":"Executing query [m8orzxlpn6jk1t8w6jn]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[46]","timestamp":"2025-03-25T17:34:43.165Z"}
{"level":"debug","message":"Executing query [m8orzxlrlx21qoft7v]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:34:43.167Z"}
{"level":"debug","message":"Executing query [m8orzxlsmvspw3ry0gd]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:34:43.168Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T17:34:43.169Z"}
{"level":"debug","message":"Executing query [m8orzxlubzmt0k0ank]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:34:43.170Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:34:43.172Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:34:57.269Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:34:57.450Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T17:34:57.461Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:34:57.578Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T17:34:57.592Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:34:57.641Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:35:34.768Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:35:34.954Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:35:35.074Z"}
{"level":"debug","message":"Executing query [m8os11oi6an3ohpmcqk]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T17:35:35.106Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:35:35.143Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T17:36:13.184Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T17:36:13.187Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.191Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.236Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.243Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.255Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.261Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.265Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.343Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.353Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.356Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T17:37:56.644Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T17:37:56.648Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.651Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.701Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.707Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.720Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.726Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.731Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.814Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.823Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.826Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:42.085Z"}
{"level":"debug","message":"Executing query [m8osw26xvafgnypicvt]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:42.106Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:42.137Z"}
{"level":"debug","message":"Executing query [m8osw27wrzsllqx38jl]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742925582105\"]","timestamp":"2025-03-25T17:59:42.140Z"}
{"level":"debug","message":"Executing query [m8osw27zuv3m2uorckj]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742925582105\"]","timestamp":"2025-03-25T17:59:42.143Z"}
{"level":"debug","message":"Executing query [m8osw281j5ad2fhlwzm]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742925582105\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:59:42.145Z"}
{"level":"debug","message":"Executing query [m8osw286s3jzc1vs76]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T17:59:42.150Z"}
{"level":"debug","message":"Executing query [m8osw289k9ue0bend2]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742925582105\"]","timestamp":"2025-03-25T17:59:42.153Z"}
{"level":"debug","message":"Executing query [m8osw28bsoj8emx772o]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",6]","timestamp":"2025-03-25T17:59:42.155Z"}
{"level":"debug","message":"Executing query [m8osw28eu72xj0m5o5]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T17:59:42.158Z"}
{"level":"debug","message":"Executing query [m8osw28gj1c13c9b9zi]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T17:59:42.160Z"}
{"level":"debug","message":"Executing query [m8osw28jy88gpx5ti2]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T17:59:42.163Z"}
{"level":"debug","message":"Executing query [m8osw28lsrmlr1965pn]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T17:59:42.165Z"}
{"level":"debug","message":"Executing query [m8osw28ngjlcniti7p]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T17:59:42.167Z"}
{"level":"debug","message":"Executing query [m8osw28p7hmk13l3fqo]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T17:59:42.169Z"}
{"level":"debug","message":"Executing query [m8osw28rck81nbt8p0d]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T17:59:42.171Z"}
{"level":"debug","message":"Executing query [m8osw28sewafiiyxjo9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:42.172Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:42.173Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:59:42.261Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:59:42.263Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:59:42.265Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:59:42.266Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:59:42.268Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:59:42.271Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:59:42.273Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:59:42.276Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:59:42.277Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:59:42.278Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:59:42.279Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T17:59:42.280Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:42.459Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:43.290Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:59:43.414Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T17:59:43.419Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:43.486Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T17:59:43.502Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:43.553Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:44.164Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:44.352Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:44.367Z"}
{"level":"debug","message":"Executing query [m8osw3xuykw1gpjrap]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T17:59:44.370Z"}
{"level":"debug","message":"Executing query [m8osw3xxr88emjmkqw]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T17:59:44.373Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8osw3xxr88emjmkqw]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T17:59:44.375Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:44.376Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:44.469Z"}
{"level":"debug","message":"Executing query [m8osw40oqsaiyghple]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:44.472Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:44.493Z"}
{"level":"debug","message":"Executing query [m8osw41bvxv81bgbsy]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T17:59:44.495Z"}
{"level":"debug","message":"Executing query [m8osw41eji5vjgmovir]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T17:59:44.498Z"}
{"level":"debug","message":"Executing query [m8osw41hhyubbp198g7]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T17:59:44.501Z"}
{"level":"debug","message":"Executing query [m8osw41jm1bjwhf6l3]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T17:59:44.503Z"}
{"level":"info","message":"Usando Mesa ID: 1, Áreas ID: 1/2, Usuarios ID: 1/2, Documento ID: 1","timestamp":"2025-03-25T17:59:44.506Z"}
{"level":"debug","message":"Executing query [m8osw41o4exl43fibie]: DELETE FROM Derivacion WHERE IDDocumento = ? AND IDAreaOrigen = ? AND IDAreaDestino = ?","params":"[1,1,2]","timestamp":"2025-03-25T17:59:44.508Z"}
{"level":"debug","message":"Executing query [m8osw41zn9wf0gnprdm]: INSERT INTO Derivacion (\n          IDDocumento, IDMesaPartes, IDAreaOrigen, IDAreaDestino, \n          IDUsuarioDeriva, EstadoDerivacion, Observacion\n        ) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[1,1,1,2,1,\"PENDIENTE\",\"Derivación creada para pruebas automatizadas\"]","timestamp":"2025-03-25T17:59:44.519Z"}
{"level":"debug","message":"Executing query [m8osw427za8ssvxx95]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[5]","timestamp":"2025-03-25T17:59:44.527Z"}
{"level":"debug","message":"Executing query [m8osw42cxwvvjemoso]: UPDATE Derivacion SET EstadoDerivacion = ?, Observacion = ?, FechaRecepcion = ?, IDUsuarioRecibe = ? WHERE IDDerivacion = ?","params":"[\"RECIBIDO\",\"Derivación actualizada en pruebas\",\"2025-03-25 17:59:44\",2,5]","timestamp":"2025-03-25T17:59:44.532Z"}
{"level":"debug","message":"Executing query [m8osw42izsv5yoevdt]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[5]","timestamp":"2025-03-25T17:59:44.538Z"}
{"level":"debug","message":"Executing query [m8osw42l80mzycva1o]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T17:59:44.542Z"}
{"level":"debug","message":"Executing query [m8osw42o73xvwoxylm]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T17:59:44.544Z"}
{"level":"debug","message":"Executing query [m8osw42rcxuk0gjtej]: DELETE FROM Derivacion WHERE IDDerivacion = ?","params":"[5]","timestamp":"2025-03-25T17:59:44.547Z"}
{"level":"debug","message":"Executing query [m8osw42vrox2yhdz4]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[5]","timestamp":"2025-03-25T17:59:44.551Z"}
{"level":"debug","message":"Executing query [m8osw42xttnq9an26z]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[1]","timestamp":"2025-03-25T17:59:44.553Z"}
{"level":"debug","message":"Executing query [m8osw432e8heeiv8lxt]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:44.558Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:45.995Z"}
{"duration":"6ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T17:59:46.052Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T17:59:46.056Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:46.062Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T17:59:46.065Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T17:59:46.153Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T17:59:46.247Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:46.363Z"}
{"level":"debug","message":"Executing query [m8osw5h9mkldfefy9h]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:46.365Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:46.377Z"}
{"level":"debug","message":"Executing query [m8osw5hn6xemvu3wumu]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:59:46.379Z"}
{"level":"debug","message":"Executing query [m8osw5hpaob14e66oo]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742925586365\"]","timestamp":"2025-03-25T17:59:46.381Z"}
{"level":"debug","message":"Executing query [m8osw5hrmehpuoc0oge]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742925586365\",\"TEST-OFICIO-1742925586365\",350,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:59:46.383Z"}
{"level":"debug","message":"Executing query [m8osw5hxf82uoqwjrp]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.389Z"}
{"level":"debug","message":"Executing query [m8osw5i1bdl3ty8cfz]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742925586365\"]","timestamp":"2025-03-25T17:59:46.393Z"}
{"level":"debug","message":"Executing query [m8osw5i27ingmkk6aca]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",3]","timestamp":"2025-03-25T17:59:46.395Z"}
{"level":"debug","message":"Executing query [m8osw5i66wjqdj62xbr]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.398Z"}
{"level":"debug","message":"Executing query [m8osw5i870wl4c97igl]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.400Z"}
{"level":"debug","message":"Executing query [m8osw5ibmcdqwt28vej]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.403Z"}
{"level":"debug","message":"Executing query [m8osw5icfyhmx6w5o48]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.404Z"}
{"level":"debug","message":"Executing query [m8osw5iguyfl8lk3pw]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.408Z"}
{"level":"debug","message":"Executing query [m8osw5ihta3ybzbns3]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742925586409\",\"TEST-SP-OFICIO-1742925586409\",5062,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T17:59:46.409Z"}
{"level":"debug","message":"Executing query [m8osw5ikwi0izidv6a]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742925586409\"]","timestamp":"2025-03-25T17:59:46.412Z"}
{"level":"debug","message":"Executing query [m8osw5il0goxfva3uxj]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742925586409\"]","timestamp":"2025-03-25T17:59:46.413Z"}
{"level":"debug","message":"Executing query [m8osw5iot9olfts375]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:46.416Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:46.417Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:46.585Z"}
{"level":"debug","message":"Executing query [m8osw5nft0b6lrmi8at]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:46.587Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:46.595Z"}
{"level":"debug","message":"Executing query [m8osw5np56f5m9hfhs9]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:59:46.597Z"}
{"level":"debug","message":"Executing query [m8osw5nr0n4rzzmzco3]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742925586586\"]","timestamp":"2025-03-25T17:59:46.599Z"}
{"level":"debug","message":"Executing query [m8osw5nsmz4kqjyxlh]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742925586586\",\"TEST-OFI-FORENSE-1742925586586\",4416,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742925586586\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:59:46.600Z"}
{"level":"debug","message":"Executing query [m8osw5nxocat4dg0q1e]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.606Z"}
{"level":"debug","message":"Executing query [m8osw5o0gj0k1pzzbp]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742925586586\"]","timestamp":"2025-03-25T17:59:46.608Z"}
{"level":"debug","message":"Executing query [m8osw5o2gongbprfrqu]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",3]","timestamp":"2025-03-25T17:59:46.610Z"}
{"level":"debug","message":"Executing query [m8osw5o6hu0ey0lsfo]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.614Z"}
{"level":"debug","message":"Executing query [m8osw5o8tkworymyayn]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.616Z"}
{"level":"debug","message":"Executing query [m8osw5oa1w2ntyh7j4a]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.618Z"}
{"level":"debug","message":"Executing query [m8osw5odvp7fdrhhyp]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.621Z"}
{"level":"debug","message":"Executing query [m8osw5ofddzmvm88oia]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.623Z"}
{"level":"debug","message":"Executing query [m8osw5oho4rb0pbu7p9]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742925586625\",\"TEST-SP-OFI-FORENSE-1742925586625\",3264,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T17:59:46.625Z"}
{"level":"debug","message":"Executing query [m8osw5okmb7dciadqp]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742925586625\"]","timestamp":"2025-03-25T17:59:46.628Z"}
{"level":"debug","message":"Executing query [m8osw5omwjne74uveks]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742925586625\"]","timestamp":"2025-03-25T17:59:46.630Z"}
{"level":"debug","message":"Executing query [m8osw5orbimppj3i7sd]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:46.635Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:46.636Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:47.339Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:47.383Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T17:59:47.385Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T17:59:47.471Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T17:59:47.471Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T17:59:47.472Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T17:59:47.472Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T17:59:47.473Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T17:59:47.473Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:47.807Z"}
{"level":"debug","message":"Executing query [m8osw6lectjb3kify6r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:47.810Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:47.820Z"}
{"level":"debug","message":"Executing query [m8osw6lqfaapknuj83]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742925587809\"]","timestamp":"2025-03-25T17:59:47.822Z"}
{"level":"debug","message":"Executing query [m8osw6lsqu1dzraaxil]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742925587809\",true]","timestamp":"2025-03-25T17:59:47.824Z"}
{"level":"debug","message":"Executing query [m8osw6lz6p7ysqkmhzc]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T17:59:47.831Z"}
{"level":"debug","message":"Executing query [m8osw6m1myinl1bgrc]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742925587809\"]","timestamp":"2025-03-25T17:59:47.833Z"}
{"level":"debug","message":"Executing query [m8osw6m2ewxemfpkhkp]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",3]","timestamp":"2025-03-25T17:59:47.834Z"}
{"level":"debug","message":"Executing query [m8osw6m6wailbgnkskn]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T17:59:47.838Z"}
{"level":"debug","message":"Executing query [m8osw6m75psn5blb2eh]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T17:59:47.839Z"}
{"level":"debug","message":"Executing query [m8osw6maq8yfrhd90jd]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T17:59:47.842Z"}
{"level":"debug","message":"Executing query [m8osw6mcfq6f73rnfca]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T17:59:47.844Z"}
{"level":"debug","message":"Executing query [m8osw6me7o70wev1fr2]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T17:59:47.846Z"}
{"level":"debug","message":"Executing query [m8osw6milwfsfo8ap7]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T17:59:47.850Z"}
{"level":"debug","message":"Executing query [m8osw6mk74rng70kqca]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T17:59:47.852Z"}
{"level":"debug","message":"Executing query [m8osw6mlvh1t3rfu5ul]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:47.853Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:47.854Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:48.014Z"}
{"level":"debug","message":"Executing query [m8osw6r5wtd9kci6buh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:48.017Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:48.024Z"}
{"level":"debug","message":"Executing query [m8osw6re7a2y2z5a8ba]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:59:48.026Z"}
{"level":"debug","message":"Executing query [m8osw6rg4hn4fj3pd56]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T17:59:48.028Z"}
{"level":"debug","message":"Executing query [m8osw6rhbu0nm7a7oe]: INSERT INTO AreaEspecializada (IDArea, NombreArea, CodigoIdentificacion, TipoArea, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Área Papelera\",\"TEST-PAPELERA\",\"PRUEBA\",1]","timestamp":"2025-03-25T17:59:48.029Z"}
{"level":"debug","message":"Executing query [m8osw6rmqt45q850l7]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T17:59:48.034Z"}
{"level":"debug","message":"Executing query [m8osw6ro0k865crm5rz7]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","timestamp":"2025-03-25T17:59:48.037Z"}
{"level":"debug","message":"Executing query [m8osw6rs13jny9c5q9pr]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T17:59:48.040Z"}
{"level":"debug","message":"Executing query [m8osw6rvz5y19lwvuj]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T17:59:48.043Z"}
{"level":"debug","message":"Executing query [m8osw6rzq6uxnrulgn]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[4,888,9,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T17:59:48.047Z\",\"ACTIVO\"]","timestamp":"2025-03-25T17:59:48.047Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 9, Área ID: 888, Rol ID: 888, Documento ID: 8","timestamp":"2025-03-25T17:59:48.050Z"}
{"level":"debug","message":"Executing query [m8osw6s4r5lkooiywd8]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[8,9,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T17:59:48.052Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8osw6s4r5lkooiywd8]","params":"[8,9,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T17:59:48.055Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T17:59:48.056Z"}
{"level":"debug","message":"Executing query [m8osw6s9lls1a0ni5r]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[8]","timestamp":"2025-03-25T17:59:48.057Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8osw6s9lls1a0ni5r]","params":"[8]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T17:59:48.059Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T17:59:48.059Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T17:59:48.060Z"}
{"level":"debug","message":"Executing query [m8osw6scb9h5wj5aen]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[8,9,\"RESTAURAR\"]","timestamp":"2025-03-25T17:59:48.060Z"}
{"level":"debug","message":"Executing query [m8osw6sii8n335dolpr]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[8]","timestamp":"2025-03-25T17:59:48.066Z"}
{"level":"debug","message":"Executing query [m8osw6sk444uhqjxhkg]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[8,9,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T17:59:48.068Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8osw6sk444uhqjxhkg]","params":"[8,9,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T17:59:48.072Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T17:59:48.072Z"}
{"level":"debug","message":"Executing query [m8osw6sp3r23q1xcalc]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[8]","timestamp":"2025-03-25T17:59:48.073Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8osw6sp3r23q1xcalc]","params":"[8]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T17:59:48.074Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T17:59:48.075Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T17:59:48.075Z"}
{"level":"debug","message":"Executing query [m8osw6ss0dth04as8wv]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[4,888,9,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T17:59:48.076Z\",\"ACTIVO\"]","timestamp":"2025-03-25T17:59:48.076Z"}
{"level":"debug","message":"Executing query [m8osw6sv7m5fkj1bz6t]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T17:59:48.079Z"}
{"level":"debug","message":"Executing query [m8osw6sxbo15ni5v0x9]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[9,\"DOCUMENTO\",9,\"ELIMINAR\"]","timestamp":"2025-03-25T17:59:48.082Z"}
{"level":"debug","message":"Executing query [m8osw6szwvttqupyup]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[9]","timestamp":"2025-03-25T17:59:48.083Z"}
{"level":"debug","message":"Executing query [m8osw6t3x05pmn7itk]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T17:59:48.087Z"}
{"level":"debug","message":"Executing query [m8osw6t6n8ss3pyjjro]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[4]","timestamp":"2025-03-25T17:59:48.090Z"}
{"level":"debug","message":"Executing query [m8osw6tbs5i5dgjoyer]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:59:48.095Z"}
{"level":"debug","message":"Executing query [m8osw6tfzen9wkkg4er]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:59:48.099Z"}
{"level":"debug","message":"Executing query [m8osw6tgphczfqypbsf]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:59:48.100Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T17:59:48.103Z"}
{"level":"debug","message":"Executing query [m8osw6tj0xb0jgy8bpd]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:48.103Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:48.104Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:48.198Z"}
{"level":"debug","message":"Executing query [m8osw6w8coho051rzk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:48.200Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:48.211Z"}
{"level":"debug","message":"Executing query [m8osw6wk3de7gv2kr7j]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:59:48.212Z"}
{"level":"debug","message":"Executing query [m8osw6wmat91s3tene]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:59:48.214Z"}
{"level":"debug","message":"Executing query [m8osw6woyl6vo1jn73j]: INSERT INTO AreaEspecializada (IDArea, NombreArea, CodigoIdentificacion, TipoArea, IsActive, Descripcion) VALUES (?, ?, ?, ?, ?, ?)","params":"[999,\"Área de Prueba\",\"TEST-AREA\",\"PRUEBA\",1,\"Área creada para pruebas\"]","timestamp":"2025-03-25T17:59:48.216Z"}
{"level":"debug","message":"Executing query [m8osw6wrtkq2f5xgtsi]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[999,\"Rol de Prueba\",\"Rol creado para pruebas\",1,255]","timestamp":"2025-03-25T17:59:48.219Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T17:59:48.222Z"}
{"level":"debug","message":"Executing query [m8osw6wuml7oehj12ap]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T17:59:48.222Z"}
{"level":"debug","message":"Executing query [m8osw6wwybl16zds16f]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T17:59:48.224Z"}
{"level":"debug","message":"Executing query [m8osw6wxl7jkg0wwnai]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T17:59:48.225Z"}
{"level":"debug","message":"Executing query [m8osw6x2pw726sdbu1]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T17:59:48.230Z"}
{"level":"debug","message":"Executing query [m8osw6x5kvrs8ck0459]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T17:59:48.233Z"}
{"level":"debug","message":"Executing query [m8osw6x8clxx15uqxbl]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",12]","timestamp":"2025-03-25T17:59:48.236Z"}
{"level":"debug","message":"Executing query [m8osw6xba57ec3ck2q8]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T17:59:48.239Z"}
{"level":"debug","message":"Executing query [m8osw6xco57j3ctocz]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T17:59:48.240Z"}
{"level":"debug","message":"Executing query [m8osw6xfv7spc2gqkys]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T17:59:48.243Z"}
{"level":"debug","message":"Executing query [m8osw6xhl1qdrzunh1]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:48.245Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:48.246Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:48.396Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:48.739Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:59:48.794Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:48.832Z"}
{"level":"debug","message":"Executing query [m8osw7ecrd3q4u80rfk]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T17:59:48.852Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:48.880Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:49.074Z"}
{"level":"debug","message":"Executing query [m8osw7kmgb97yxa33v7]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:49.078Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:49.088Z"}
{"level":"debug","message":"Executing query [m8osw7kyr5vabcg9g3r]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:59:49.090Z"}
{"level":"debug","message":"Executing query [m8osw7kzhvwgd7nn3mo]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742925589077\"]","timestamp":"2025-03-25T17:59:49.091Z"}
{"level":"debug","message":"Executing query [m8osw7l1itb0omt8kc]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742925589077\",\"TEST-OFI-QUIMICA-1742925589077\",1070,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:59:49.093Z"}
{"level":"debug","message":"Executing query [m8osw7l8e24sqymxm7]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T17:59:49.100Z"}
{"level":"debug","message":"Executing query [m8osw7lau2twg0d00i]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742925589077\"]","timestamp":"2025-03-25T17:59:49.102Z"}
{"level":"debug","message":"Executing query [m8osw7ld5uji2uz6kwu]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",3]","timestamp":"2025-03-25T17:59:49.106Z"}
{"level":"debug","message":"Executing query [m8osw7lhy53aeqe647c]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T17:59:49.109Z"}
{"level":"debug","message":"Executing query [m8osw7lkjyw8hvkj2t]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T17:59:49.112Z"}
{"level":"debug","message":"Executing query [m8osw7lo66d6wo0qiw]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T17:59:49.116Z"}
{"level":"debug","message":"Executing query [m8osw7lraq4nzyy2956]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T17:59:49.119Z"}
{"level":"debug","message":"Executing query [m8osw7lux0eh8by760r]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T17:59:49.123Z"}
{"level":"debug","message":"Executing query [m8osw7lxwhbgoc17n6]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:49.125Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:49.129Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:50.290Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:50.293Z"}
{"level":"debug","message":"Executing query [m8osw8ieljdp4wz88u]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:50.294Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:50.303Z"}
{"level":"debug","message":"Executing query [m8osw8ipmjp79lez7mb]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:59:50.305Z"}
{"level":"debug","message":"Executing query [m8osw8iq8jsvbs69khi]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:59:50.306Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T17:59:50.307Z"}
{"level":"debug","message":"Executing query [m8osw8ise5r3ihzu84]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:59:50.308Z"}
{"level":"debug","message":"Executing query [m8osw8iuxxtaw4fc08l]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:59:50.310Z"}
{"level":"debug","message":"Executing query [m8osw8ivko9z4wruc1]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:59:50.311Z"}
{"level":"debug","message":"Executing query [m8osw8iw2v8gzspsqen]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T17:59:50.312Z"}
{"level":"debug","message":"Executing query [m8osw8j1kaymootfuz]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[10]","timestamp":"2025-03-25T17:59:50.317Z"}
{"level":"debug","message":"Executing query [m8osw8j3sa55b44y95]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:59:50.319Z"}
{"level":"debug","message":"Executing query [m8osw8j59miucg64gfk]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",10]","timestamp":"2025-03-25T17:59:50.321Z"}
{"level":"debug","message":"Executing query [m8osw8j91ltb0h19dwz]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[10]","timestamp":"2025-03-25T17:59:50.325Z"}
{"level":"debug","message":"Executing query [m8osw8ja1nnd1lgdvjf]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[10]","timestamp":"2025-03-25T17:59:50.326Z"}
{"level":"debug","message":"Executing query [m8osw8jdj5t0tdtwnu]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[10]","timestamp":"2025-03-25T17:59:50.329Z"}
{"level":"debug","message":"Executing query [m8osw8jfz41szrk3hk8]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:59:50.331Z"}
{"level":"debug","message":"Executing query [m8osw8jfbtfkwac2qmu]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:59:50.331Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T17:59:50.332Z"}
{"level":"debug","message":"Executing query [m8osw8jg91g83tx28]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:50.332Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:50.333Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T18:02:25.854Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T18:02:25.858Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:25.861Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:25.906Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:25.912Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:25.946Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:25.952Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:25.958Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:25.962Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:25.971Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:26.052Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:26.059Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:26.063Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T18:17:08.692Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T18:17:08.695Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.699Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.747Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.752Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.784Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.790Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.795Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.799Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.810Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.890Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.899Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.904Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T21:32:40.467Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T21:32:40.470Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.473Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.555Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.560Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.572Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.609Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.617Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.697Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.712Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.715Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T21:46:19.369Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T21:46:19.373Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.376Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.424Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.432Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.448Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.457Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.463Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.551Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.558Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.564Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T21:47:44.664Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T21:47:44.667Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.670Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.717Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.723Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.734Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.739Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.743Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.820Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.831Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.836Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:04.885Z"}
{"level":"debug","message":"Executing query [m8p16wizce5tgqbg98d]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:04.908Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:04.947Z"}
{"level":"debug","message":"Executing query [m8p16wk65oymyzx5bii]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742939524906\"]","timestamp":"2025-03-25T21:52:04.950Z"}
{"level":"debug","message":"Executing query [m8p16wk90usaajfizxy]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742939524906\"]","timestamp":"2025-03-25T21:52:04.953Z"}
{"level":"debug","message":"Executing query [m8p16wkahnennp27rd8]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742939524906\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T21:52:04.955Z"}
{"level":"debug","message":"Executing query [m8p16wkimrnovz4coqr]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T21:52:04.962Z"}
{"level":"debug","message":"Executing query [m8p16wkkt33nzr477wj]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742939524906\"]","timestamp":"2025-03-25T21:52:04.964Z"}
{"level":"debug","message":"Executing query [m8p16wknjjuytwn29ha]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",6]","timestamp":"2025-03-25T21:52:04.967Z"}
{"level":"debug","message":"Executing query [m8p16wkr6ki9ld6jtvf]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T21:52:04.971Z"}
{"level":"debug","message":"Executing query [m8p16wktz69vto4xpun]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T21:52:04.973Z"}
{"level":"debug","message":"Executing query [m8p16wkxjwy5gc2spuo]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T21:52:04.977Z"}
{"level":"debug","message":"Executing query [m8p16wkz5kyc02ymked]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T21:52:04.979Z"}
{"level":"debug","message":"Executing query [m8p16wl1pggs8ysoqog]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T21:52:04.981Z"}
{"level":"debug","message":"Executing query [m8p16wl56wgzixythhu]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T21:52:04.985Z"}
{"level":"debug","message":"Executing query [m8p16wl7cnbhixxc2y6]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T21:52:04.987Z"}
{"level":"debug","message":"Executing query [m8p16wlagf8ruy8dv3u]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:04.990Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:04.992Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T21:52:05.085Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T21:52:05.087Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T21:52:05.088Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T21:52:05.090Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T21:52:05.093Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T21:52:05.098Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T21:52:05.100Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T21:52:05.103Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T21:52:05.104Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T21:52:05.105Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T21:52:05.106Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T21:52:05.109Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:05.284Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:06.279Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T21:52:06.437Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T21:52:06.442Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:06.501Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T21:52:06.512Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:06.555Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:07.122Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:07.309Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:07.323Z"}
{"level":"debug","message":"Executing query [m8p16ye6cav6bqcdcgi]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T21:52:07.326Z"}
{"level":"debug","message":"Executing query [m8p16ye81hwz1gn9dzx]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T21:52:07.328Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p16ye81hwz1gn9dzx]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T21:52:07.331Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:07.333Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:07.429Z"}
{"level":"debug","message":"Executing query [m8p16yh4ikyz7kudne]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:07.432Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:07.445Z"}
{"level":"debug","message":"Executing query [m8p16yhirus6kv6h54]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T21:52:07.446Z"}
{"level":"debug","message":"Executing query [m8p16yhsvsi2h4ylbj]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T21:52:07.456Z"}
{"level":"debug","message":"Executing query [m8p16yhug6mtbj3ogr5]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T21:52:07.458Z"}
{"level":"debug","message":"Executing query [m8p16yhv79f61y2cwh]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T21:52:07.459Z"}
{"level":"info","message":"Usando Mesa ID: 1, Áreas ID: 1/2, Usuarios ID: 1/2, Documento ID: 1","timestamp":"2025-03-25T21:52:07.466Z"}
{"level":"debug","message":"Executing query [m8p16yi4boayl3wxyp9]: DELETE FROM Derivacion WHERE IDDocumento = ? AND IDAreaOrigen = ? AND IDAreaDestino = ?","params":"[1,1,2]","timestamp":"2025-03-25T21:52:07.468Z"}
{"level":"debug","message":"Executing query [m8p16yi68z3vyy1qmqq]: INSERT INTO Derivacion (\n          IDDocumento, IDMesaPartes, IDAreaOrigen, IDAreaDestino, \n          IDUsuarioDeriva, EstadoDerivacion, Observacion\n        ) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[1,1,1,2,1,\"PENDIENTE\",\"Derivación creada para pruebas automatizadas\"]","timestamp":"2025-03-25T21:52:07.470Z"}
{"level":"debug","message":"Executing query [m8p16yibw9a9e2kq1db]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[5]","timestamp":"2025-03-25T21:52:07.475Z"}
{"level":"debug","message":"Executing query [m8p16yifzv4jpeaaprq]: UPDATE Derivacion SET EstadoDerivacion = ?, Observacion = ?, FechaRecepcion = ?, IDUsuarioRecibe = ? WHERE IDDerivacion = ?","params":"[\"RECIBIDO\",\"Derivación actualizada en pruebas\",\"2025-03-25 21:52:07\",2,5]","timestamp":"2025-03-25T21:52:07.479Z"}
{"level":"debug","message":"Executing query [m8p16yii3wkkh82w8re]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[5]","timestamp":"2025-03-25T21:52:07.482Z"}
{"level":"debug","message":"Executing query [m8p16yikz4am2twl3cd]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T21:52:07.484Z"}
{"level":"debug","message":"Executing query [m8p16yimxclxz68m5bm]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T21:52:07.486Z"}
{"level":"debug","message":"Executing query [m8p16yinwzncm96f7ic]: DELETE FROM Derivacion WHERE IDDerivacion = ?","params":"[5]","timestamp":"2025-03-25T21:52:07.488Z"}
{"level":"debug","message":"Executing query [m8p16yir38mq3grn1u]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[5]","timestamp":"2025-03-25T21:52:07.491Z"}
{"level":"debug","message":"Executing query [m8p16yitga8e0w0v16p]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[1]","timestamp":"2025-03-25T21:52:07.493Z"}
{"level":"debug","message":"Executing query [m8p16yiwkr1udngd4d]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:07.496Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:09.419Z"}
{"duration":"5ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T21:52:09.478Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T21:52:09.482Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:09.488Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T21:52:09.490Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T21:52:09.580Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T21:52:09.674Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:09.794Z"}
{"level":"debug","message":"Executing query [m8p170aslk321p8lsr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:09.796Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:09.805Z"}
{"level":"debug","message":"Executing query [m8p170b2macs1schqi9]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T21:52:09.806Z"}
{"level":"debug","message":"Executing query [m8p170b3k9qployvg9]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742939529795\"]","timestamp":"2025-03-25T21:52:09.807Z"}
{"level":"debug","message":"Executing query [m8p170b6y098bvpytpg]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742939529795\",\"TEST-OFICIO-1742939529795\",949,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T21:52:09.810Z"}
{"level":"debug","message":"Executing query [m8p170bcd8titxfrm5v]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T21:52:09.816Z"}
{"level":"debug","message":"Executing query [m8p170bfnf11vxsggh]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742939529795\"]","timestamp":"2025-03-25T21:52:09.819Z"}
{"level":"debug","message":"Executing query [m8p170bhhj5ih6zqak]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",3]","timestamp":"2025-03-25T21:52:09.821Z"}
{"level":"debug","message":"Executing query [m8p170bk1wdqq2bgvgc]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T21:52:09.824Z"}
{"level":"debug","message":"Executing query [m8p170bmur6u57xwjz]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T21:52:09.826Z"}
{"level":"debug","message":"Executing query [m8p170bpr0aa1a0jil]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T21:52:09.829Z"}
{"level":"debug","message":"Executing query [m8p170brl7mxqmshmle]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T21:52:09.831Z"}
{"level":"debug","message":"Executing query [m8p170buv3xt5mdo2no]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T21:52:09.834Z"}
{"level":"debug","message":"Executing query [m8p170bwxlh82y5s9yq]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742939529836\",\"TEST-SP-OFICIO-1742939529836\",9391,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T21:52:09.836Z"}
{"level":"debug","message":"Executing query [m8p170c7r2zmjke8dc]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742939529836\"]","timestamp":"2025-03-25T21:52:09.847Z"}
{"level":"debug","message":"Executing query [m8p170c9d64wy6ccve8]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742939529836\"]","timestamp":"2025-03-25T21:52:09.849Z"}
{"level":"debug","message":"Executing query [m8p170ccidbqpcajss7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:09.853Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:09.854Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:10.026Z"}
{"level":"debug","message":"Executing query [m8p170h9rnvgs2re9l]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:10.029Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:10.037Z"}
{"level":"debug","message":"Executing query [m8p170hi3xa47blc83m]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T21:52:10.038Z"}
{"level":"debug","message":"Executing query [m8p170hkvvmiyrbef5e]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742939530028\"]","timestamp":"2025-03-25T21:52:10.040Z"}
{"level":"debug","message":"Executing query [m8p170hmpxsk03uc8gf]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742939530028\",\"TEST-OFI-FORENSE-1742939530028\",6819,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742939530028\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T21:52:10.042Z"}
{"level":"debug","message":"Executing query [m8p170hti501vq4cpkf]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T21:52:10.049Z"}
{"level":"debug","message":"Executing query [m8p170hvhyon4s18e9d]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742939530028\"]","timestamp":"2025-03-25T21:52:10.051Z"}
{"level":"debug","message":"Executing query [m8p170hycw4kr8m2clb]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",3]","timestamp":"2025-03-25T21:52:10.054Z"}
{"level":"debug","message":"Executing query [m8p170i1391fpxp4evt]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T21:52:10.058Z"}
{"level":"debug","message":"Executing query [m8p170i4tg7kv2p34k]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T21:52:10.060Z"}
{"level":"debug","message":"Executing query [m8p170i7xz1tt7zsqpf]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T21:52:10.063Z"}
{"level":"debug","message":"Executing query [m8p170i8x844r6ccgp9]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T21:52:10.064Z"}
{"level":"debug","message":"Executing query [m8p170ich5n13p1klyc]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T21:52:10.068Z"}
{"level":"debug","message":"Executing query [m8p170ietir82ar4kz]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742939530070\",\"TEST-SP-OFI-FORENSE-1742939530070\",6575,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T21:52:10.070Z"}
{"level":"debug","message":"Executing query [m8p170ih6io63efapee]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742939530070\"]","timestamp":"2025-03-25T21:52:10.073Z"}
{"level":"debug","message":"Executing query [m8p170ijym2z8pno1p8]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742939530070\"]","timestamp":"2025-03-25T21:52:10.075Z"}
{"level":"debug","message":"Executing query [m8p170in7t2wung9mwm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:10.079Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:10.080Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:10.795Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:10.840Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T21:52:10.841Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T21:52:10.930Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T21:52:10.931Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T21:52:10.932Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T21:52:10.932Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T21:52:10.933Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T21:52:10.933Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:11.286Z"}
{"level":"debug","message":"Executing query [m8p171g9woypnxvadho]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:11.289Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:11.302Z"}
{"level":"debug","message":"Executing query [m8p171gpb1bt002nrkk]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742939531288\"]","timestamp":"2025-03-25T21:52:11.305Z"}
{"level":"debug","message":"Executing query [m8p171gr8hdoawny6hw]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742939531288\",true]","timestamp":"2025-03-25T21:52:11.307Z"}
{"level":"debug","message":"Executing query [m8p171gwmnyfve096ck]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T21:52:11.312Z"}
{"level":"debug","message":"Executing query [m8p171gzt8dpyk3auy]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742939531288\"]","timestamp":"2025-03-25T21:52:11.315Z"}
{"level":"debug","message":"Executing query [m8p171h1ak6d57nhov]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",3]","timestamp":"2025-03-25T21:52:11.317Z"}
{"level":"debug","message":"Executing query [m8p171h4ft23edu1ocd]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T21:52:11.320Z"}
{"level":"debug","message":"Executing query [m8p171h5ebrpe02a9er]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T21:52:11.321Z"}
{"level":"debug","message":"Executing query [m8p171h962sfgkcm05]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T21:52:11.325Z"}
{"level":"debug","message":"Executing query [m8p171hariwqcmevtk]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T21:52:11.326Z"}
{"level":"debug","message":"Executing query [m8p171hcmmlue1zbdb]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T21:52:11.328Z"}
{"level":"debug","message":"Executing query [m8p171hfpy4gluxbmp]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T21:52:11.331Z"}
{"level":"debug","message":"Executing query [m8p171hhk8g54195y9l]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T21:52:11.333Z"}
{"level":"debug","message":"Executing query [m8p171hipbi29qs84ws]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:11.334Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:11.335Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:11.497Z"}
{"level":"debug","message":"Executing query [m8p171m4uc9rlz4fu9q]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:11.500Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:11.508Z"}
{"level":"debug","message":"Executing query [m8p171mdtggjuk2ky8b]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T21:52:11.509Z"}
{"level":"debug","message":"Executing query [m8p171mfawe7u0bw50o]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T21:52:11.511Z"}
{"level":"debug","message":"Executing query [m8p171mgibobw2lviy]: INSERT INTO AreaEspecializada (IDArea, NombreArea, CodigoIdentificacion, TipoArea, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Área Papelera\",\"TEST-PAPELERA\",\"PRUEBA\",1]","timestamp":"2025-03-25T21:52:11.512Z"}
{"level":"debug","message":"Executing query [m8p171mll8lrpp1zwy]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T21:52:11.517Z"}
{"level":"debug","message":"Executing query [m8p171mm64w8ql5tsqu]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","timestamp":"2025-03-25T21:52:11.518Z"}
{"level":"debug","message":"Executing query [m8p171mpy807iqc4jb]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T21:52:11.521Z"}
{"level":"debug","message":"Executing query [m8p171msue9kbil1mrn]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T21:52:11.524Z"}
{"level":"debug","message":"Executing query [m8p171n9np813061bu]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[4,888,9,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T21:52:11.541Z\",\"ACTIVO\"]","timestamp":"2025-03-25T21:52:11.541Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 9, Área ID: 888, Rol ID: 888, Documento ID: 8","timestamp":"2025-03-25T21:52:11.545Z"}
{"level":"debug","message":"Executing query [m8p171neumzu7myqqt]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[8,9,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T21:52:11.546Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p171neumzu7myqqt]","params":"[8,9,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T21:52:11.550Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T21:52:11.551Z"}
{"level":"debug","message":"Executing query [m8p171nja6orn52vicf]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[8]","timestamp":"2025-03-25T21:52:11.551Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p171nja6orn52vicf]","params":"[8]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T21:52:11.554Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T21:52:11.554Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T21:52:11.555Z"}
{"level":"debug","message":"Executing query [m8p171nnu8kincpv5s]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[8,9,\"RESTAURAR\"]","timestamp":"2025-03-25T21:52:11.555Z"}
{"level":"debug","message":"Executing query [m8p171ns7wbzqy1s21n]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[8]","timestamp":"2025-03-25T21:52:11.560Z"}
{"level":"debug","message":"Executing query [m8p171nu28fcc4kxwo1]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[8,9,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T21:52:11.562Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p171nu28fcc4kxwo1]","params":"[8,9,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T21:52:11.566Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T21:52:11.567Z"}
{"level":"debug","message":"Executing query [m8p171nzz8cucq28lw]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[8]","timestamp":"2025-03-25T21:52:11.567Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p171nzz8cucq28lw]","params":"[8]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T21:52:11.569Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T21:52:11.570Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T21:52:11.570Z"}
{"level":"debug","message":"Executing query [m8p171o36dbnz7xu0v]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[4,888,9,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T21:52:11.571Z\",\"ACTIVO\"]","timestamp":"2025-03-25T21:52:11.571Z"}
{"level":"debug","message":"Executing query [m8p171o7c267xzsguqv]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T21:52:11.575Z"}
{"level":"debug","message":"Executing query [m8p171oace2xh3ybxlu]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[9,\"DOCUMENTO\",9,\"ELIMINAR\"]","timestamp":"2025-03-25T21:52:11.578Z"}
{"level":"debug","message":"Executing query [m8p171oe108rsbw7v8yk]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[9]","timestamp":"2025-03-25T21:52:11.582Z"}
{"level":"debug","message":"Executing query [m8p171ohiuqnaxb81a]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T21:52:11.585Z"}
{"level":"debug","message":"Executing query [m8p171olyntagha09ph]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[4]","timestamp":"2025-03-25T21:52:11.589Z"}
{"level":"debug","message":"Executing query [m8p171ooo6p0w36jr8]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T21:52:11.592Z"}
{"level":"debug","message":"Executing query [m8p171oqlw0dm1csmei]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T21:52:11.594Z"}
{"level":"debug","message":"Executing query [m8p171ot8liqg136r98]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T21:52:11.597Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T21:52:11.600Z"}
{"level":"debug","message":"Executing query [m8p171oxj215f1zljj]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:11.601Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:11.602Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:11.698Z"}
{"level":"debug","message":"Executing query [m8p171rpcw0rjv20zaj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:11.701Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:11.715Z"}
{"level":"debug","message":"Executing query [m8p171s4w3jag813jp]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T21:52:11.716Z"}
{"level":"debug","message":"Executing query [m8p171s6bo9qpfq8tx]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T21:52:11.718Z"}
{"level":"debug","message":"Executing query [m8p171s83xu8v5tnpof]: INSERT INTO AreaEspecializada (IDArea, NombreArea, CodigoIdentificacion, TipoArea, IsActive, Descripcion) VALUES (?, ?, ?, ?, ?, ?)","params":"[999,\"Área de Prueba\",\"TEST-AREA\",\"PRUEBA\",1,\"Área creada para pruebas\"]","timestamp":"2025-03-25T21:52:11.720Z"}
{"level":"debug","message":"Executing query [m8p171sbt2unppjfrv]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[999,\"Rol de Prueba\",\"Rol creado para pruebas\",1,255]","timestamp":"2025-03-25T21:52:11.723Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T21:52:11.726Z"}
{"level":"debug","message":"Executing query [m8p171sfexl0qv260i]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T21:52:11.727Z"}
{"level":"debug","message":"Executing query [m8p171sgsnpl61heos]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T21:52:11.728Z"}
{"level":"debug","message":"Executing query [m8p171sih5lkbwphwlj]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T21:52:11.730Z"}
{"level":"debug","message":"Executing query [m8p171sm63tlfu9pyaw]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T21:52:11.734Z"}
{"level":"debug","message":"Executing query [m8p171sp8r8m2umow2r]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T21:52:11.737Z"}
{"level":"debug","message":"Executing query [m8p171st4neoy22m36e]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",12]","timestamp":"2025-03-25T21:52:11.742Z"}
{"level":"debug","message":"Executing query [m8p171swcvpjvdgq12c]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T21:52:11.744Z"}
{"level":"debug","message":"Executing query [m8p171sztjnwx4b8aw9]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T21:52:11.747Z"}
{"level":"debug","message":"Executing query [m8p171t2aovz5mo0l49]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T21:52:11.750Z"}
{"level":"debug","message":"Executing query [m8p171t4hpf8imzmnre]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:11.752Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:11.754Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:11.925Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:12.285Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T21:52:12.339Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:12.378Z"}
{"level":"debug","message":"Executing query [m8p172b6k0b5zg00z4]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T21:52:12.402Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:12.432Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:12.609Z"}
{"level":"debug","message":"Executing query [m8p172h0k36qn2a4nct]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:12.612Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:12.621Z"}
{"level":"debug","message":"Executing query [m8p172hbnx9qrx21gfo]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T21:52:12.623Z"}
{"level":"debug","message":"Executing query [m8p172hd77ot0hby3wk]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742939532611\"]","timestamp":"2025-03-25T21:52:12.625Z"}
{"level":"debug","message":"Executing query [m8p172hfl10b5fqyjjj]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742939532611\",\"TEST-OFI-QUIMICA-1742939532611\",484,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T21:52:12.627Z"}
{"level":"debug","message":"Executing query [m8p172hmx8l6y1z275]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T21:52:12.634Z"}
{"level":"debug","message":"Executing query [m8p172hpu4rrkt9ytnd]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742939532611\"]","timestamp":"2025-03-25T21:52:12.637Z"}
{"level":"debug","message":"Executing query [m8p172hrtn39ku037zr]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",3]","timestamp":"2025-03-25T21:52:12.639Z"}
{"level":"debug","message":"Executing query [m8p172hwbckboce4r1n]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T21:52:12.644Z"}
{"level":"debug","message":"Executing query [m8p172hyfbxnrky1vl]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T21:52:12.646Z"}
{"level":"debug","message":"Executing query [m8p172i1j8rd62wt5ea]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T21:52:12.649Z"}
{"level":"debug","message":"Executing query [m8p172i3gmid6am43ji]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T21:52:12.651Z"}
{"level":"debug","message":"Executing query [m8p172i65snu6c63zql]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T21:52:12.654Z"}
{"level":"debug","message":"Executing query [m8p172i75hz62ynjcbt]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:12.655Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:12.657Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:13.866Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:13.869Z"}
{"level":"debug","message":"Executing query [m8p173fzbaclcikjtf]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:13.871Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:13.879Z"}
{"level":"debug","message":"Executing query [m8p173g85a9n3bjlgxh]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T21:52:13.880Z"}
{"level":"debug","message":"Executing query [m8p173gacu61lm2aww]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T21:52:13.882Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T21:52:13.884Z"}
{"level":"debug","message":"Executing query [m8p173gcvbduge8tqia]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T21:52:13.884Z"}
{"level":"debug","message":"Executing query [m8p173geqv339grc9pa]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T21:52:13.886Z"}
{"level":"debug","message":"Executing query [m8p173gfjdsfre5h6hp]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T21:52:13.887Z"}
{"level":"debug","message":"Executing query [m8p173gg1edxi1s24kf]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T21:52:13.889Z"}
{"level":"debug","message":"Executing query [m8p173gmi35qthg4989]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[10]","timestamp":"2025-03-25T21:52:13.894Z"}
{"level":"debug","message":"Executing query [m8p173go6m99eb3q1wi]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T21:52:13.896Z"}
{"level":"debug","message":"Executing query [m8p173gqe4c97ql0n85]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",10]","timestamp":"2025-03-25T21:52:13.898Z"}
{"level":"debug","message":"Executing query [m8p173gt60vqwcpms1]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[10]","timestamp":"2025-03-25T21:52:13.901Z"}
{"level":"debug","message":"Executing query [m8p173gu49i9ul4rj9y]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[10]","timestamp":"2025-03-25T21:52:13.902Z"}
{"level":"debug","message":"Executing query [m8p173gxqj2jcykucqa]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[10]","timestamp":"2025-03-25T21:52:13.905Z"}
{"level":"debug","message":"Executing query [m8p173gz27m7wwqdndp]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T21:52:13.907Z"}
{"level":"debug","message":"Executing query [m8p173h1v4xzlof0wkj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T21:52:13.909Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T21:52:13.909Z"}
{"level":"debug","message":"Executing query [m8p173h1hw42nk25kw7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:13.909Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:13.910Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:00.690Z"}
{"level":"debug","message":"Executing query [m8p1kyjsiovj899udms]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:03:00.712Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:03:00.753Z"}
{"level":"debug","message":"Executing query [m8p1kykz86cov775nfn]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742940180712\"]","timestamp":"2025-03-25T22:03:00.755Z"}
{"level":"debug","message":"Executing query [m8p1kyl426f2yrz6uax]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742940180712\"]","timestamp":"2025-03-25T22:03:00.760Z"}
{"level":"debug","message":"Executing query [m8p1kyl6o4nmnw8gul]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742940180712\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:03:00.762Z"}
{"level":"debug","message":"Executing query [m8p1kylbomhim12mxig]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1000]","timestamp":"2025-03-25T22:03:00.767Z"}
{"level":"debug","message":"Executing query [m8p1kylegzhapr9g9zp]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742940180712\"]","timestamp":"2025-03-25T22:03:00.770Z"}
{"level":"debug","message":"Executing query [m8p1kylh0susxysaoick]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1000]","timestamp":"2025-03-25T22:03:00.773Z"}
{"level":"debug","message":"Executing query [m8p1kyllpu3wq301l4f]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1000]","timestamp":"2025-03-25T22:03:00.777Z"}
{"level":"debug","message":"Executing query [m8p1kylncuagq4jnq8p]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1000]","timestamp":"2025-03-25T22:03:00.779Z"}
{"level":"debug","message":"Executing query [m8p1kylq1sekpu40gy8]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1000]","timestamp":"2025-03-25T22:03:00.782Z"}
{"level":"debug","message":"Executing query [m8p1kyltlbmzfg5uax]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1000]","timestamp":"2025-03-25T22:03:00.785Z"}
{"level":"debug","message":"Executing query [m8p1kylwcg7zj4pbjjm]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1000]","timestamp":"2025-03-25T22:03:00.788Z"}
{"level":"debug","message":"Executing query [m8p1kylzik2u7k1asn]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1000]","timestamp":"2025-03-25T22:03:00.791Z"}
{"level":"debug","message":"Executing query [m8p1kym0k18xc27cpf]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:03:00.793Z"}
{"level":"debug","message":"Executing query [m8p1kym33gr466pbrdf]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:03:00.795Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:03:00.797Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:03:00.901Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:03:00.904Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:03:00.906Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:03:00.908Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:03:00.910Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:03:00.915Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:03:00.918Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:03:00.921Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:03:00.922Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:03:00.923Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:03:00.926Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T22:03:00.927Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:01.163Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:02.265Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:03:02.458Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T22:03:02.464Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:03:02.544Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T22:03:02.560Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:03:02.614Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:03.461Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:03.748Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:03:03.766Z"}
{"level":"debug","message":"Executing query [m8p1l0wprtax3tkncz]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T22:03:03.769Z"}
{"level":"debug","message":"Executing query [m8p1l0wrj69q7a95t2e]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T22:03:03.771Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p1l0wrj69q7a95t2e]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T22:03:03.775Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:03:03.777Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:03.908Z"}
{"level":"debug","message":"Executing query [m8p1l10ptopf4lclz5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:03:03.913Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:03:03.940Z"}
{"level":"debug","message":"Executing query [m8p1l11irqpadz7p3g]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:03:03.943Z"}
{"level":"debug","message":"Executing query [m8p1l11kgm0uf8kam0k]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T22:03:03.944Z"}
{"level":"debug","message":"Executing query [m8p1l11nzwdgrc4c17]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T22:03:03.947Z"}
{"level":"debug","message":"Executing query [m8p1l11p19zqxgu89th]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:03:03.949Z"}
{"level":"info","message":"Usando Mesa ID: 1, Áreas ID: 1/2, Usuarios ID: 1/2, Documento ID: 2","timestamp":"2025-03-25T22:03:03.951Z"}
{"level":"debug","message":"Executing query [m8p1l11uo2rmunzo8j]: DELETE FROM Derivacion WHERE IDDocumento = ? AND IDAreaOrigen = ? AND IDAreaDestino = ?","params":"[2,1,2]","timestamp":"2025-03-25T22:03:03.954Z"}
{"level":"debug","message":"Executing query [m8p1l11wskj8iptsez]: INSERT INTO Derivacion (\n          IDDocumento, IDMesaPartes, IDAreaOrigen, IDAreaDestino, \n          IDUsuarioDeriva, EstadoDerivacion, Observacion\n        ) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[2,1,1,2,1,\"PENDIENTE\",\"Derivación creada para pruebas automatizadas\"]","timestamp":"2025-03-25T22:03:03.956Z"}
{"level":"debug","message":"Executing query [m8p1l123t7v0o8q1aa]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[6]","timestamp":"2025-03-25T22:03:03.963Z"}
{"level":"debug","message":"Executing query [m8p1l127px8i32i6dw]: UPDATE Derivacion SET EstadoDerivacion = ?, Observacion = ?, FechaRecepcion = ?, IDUsuarioRecibe = ? WHERE IDDerivacion = ?","params":"[\"RECIBIDO\",\"Derivación actualizada en pruebas\",\"2025-03-25 22:03:03\",2,6]","timestamp":"2025-03-25T22:03:03.967Z"}
{"level":"debug","message":"Executing query [m8p1l12bzs0vndz6av]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[6]","timestamp":"2025-03-25T22:03:03.971Z"}
{"level":"debug","message":"Executing query [m8p1l12fu0j05is5hm]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T22:03:03.975Z"}
{"level":"debug","message":"Executing query [m8p1l12h1rej3ycczusj]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T22:03:03.977Z"}
{"level":"debug","message":"Executing query [m8p1l12jytei65fvux]: DELETE FROM Derivacion WHERE IDDerivacion = ?","params":"[6]","timestamp":"2025-03-25T22:03:03.979Z"}
{"level":"debug","message":"Executing query [m8p1l12nkkzttdktnb]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[6]","timestamp":"2025-03-25T22:03:03.983Z"}
{"level":"debug","message":"Executing query [m8p1l12pvetlwfrnohl]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[2]","timestamp":"2025-03-25T22:03:03.985Z"}
{"level":"debug","message":"Executing query [m8p1l12twjqm3io28m]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:03:03.989Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:05.784Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T22:03:05.850Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T22:03:05.854Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:03:05.862Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:03:05.864Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T22:03:05.962Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T22:03:06.067Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:06.236Z"}
{"level":"debug","message":"Executing query [m8p1l2tjsz5g006dk5o]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:03:06.247Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:03:06.260Z"}
{"level":"debug","message":"Executing query [m8p1l2tyekwappkncia]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:03:06.262Z"}
{"level":"debug","message":"Executing query [m8p1l2u0v9sj3gzwl6h]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742940186246\"]","timestamp":"2025-03-25T22:03:06.264Z"}
{"level":"debug","message":"Executing query [m8p1l2u3is32wf4aah]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742940186246\",\"TEST-OFICIO-1742940186246\",8777,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:03:06.267Z"}
{"level":"debug","message":"Executing query [m8p1l2u9kygwshsj5z9]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[5]","timestamp":"2025-03-25T22:03:06.273Z"}
{"level":"debug","message":"Executing query [m8p1l2ucbj0cvsaln9r]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742940186246\"]","timestamp":"2025-03-25T22:03:06.276Z"}
{"level":"debug","message":"Executing query [m8p1l2ufse7z7xvzlve]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",5]","timestamp":"2025-03-25T22:03:06.279Z"}
{"level":"debug","message":"Executing query [m8p1l2uj32w67gpyrxm]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[5]","timestamp":"2025-03-25T22:03:06.283Z"}
{"level":"debug","message":"Executing query [m8p1l2ulyggo1vgzvoh]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[5]","timestamp":"2025-03-25T22:03:06.285Z"}
{"level":"debug","message":"Executing query [m8p1l2uq90gnsvq45eb]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[5]","timestamp":"2025-03-25T22:03:06.290Z"}
{"level":"debug","message":"Executing query [m8p1l2uszebydzydbm]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[5]","timestamp":"2025-03-25T22:03:06.292Z"}
{"level":"debug","message":"Executing query [m8p1l2uwhg8fnwhhg6]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[5]","timestamp":"2025-03-25T22:03:06.296Z"}
{"level":"debug","message":"Executing query [m8p1l2uyhdlo0dfliar]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742940186298\",\"TEST-SP-OFICIO-1742940186298\",7812,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T22:03:06.298Z"}
{"level":"debug","message":"Executing query [m8p1l2v2e64pubn0lm]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742940186298\"]","timestamp":"2025-03-25T22:03:06.302Z"}
{"level":"debug","message":"Executing query [m8p1l2v3b7ecq0hm5e5]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742940186298\"]","timestamp":"2025-03-25T22:03:06.303Z"}
{"level":"debug","message":"Executing query [m8p1l2v83wou36jve4a]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:03:06.308Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:03:06.310Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:06.562Z"}
{"level":"debug","message":"Executing query [m8p1l32et3oj9h0a4uk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:03:06.566Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:03:06.578Z"}
{"level":"debug","message":"Executing query [m8p1l32stk4j3ufswfs]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:03:06.580Z"}
{"level":"debug","message":"Executing query [m8p1l32uomrgjoqqjx8]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742940186566\"]","timestamp":"2025-03-25T22:03:06.582Z"}
{"level":"debug","message":"Executing query [m8p1l32vor4yymvhkg]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742940186566\",\"TEST-OFI-FORENSE-1742940186566\",1440,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742940186566\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:03:06.583Z"}
{"level":"debug","message":"Executing query [m8p1l333cc7wzh8oj16]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[5]","timestamp":"2025-03-25T22:03:06.591Z"}
{"level":"debug","message":"Executing query [m8p1l33bg91m3bqabyg]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742940186566\"]","timestamp":"2025-03-25T22:03:06.599Z"}
{"level":"debug","message":"Executing query [m8p1l33efy6qrt77mbk]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",5]","timestamp":"2025-03-25T22:03:06.602Z"}
{"level":"debug","message":"Executing query [m8p1l33i92fcece7gsc]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[5]","timestamp":"2025-03-25T22:03:06.606Z"}
{"level":"debug","message":"Executing query [m8p1l33k74v8vgs3l7k]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[5]","timestamp":"2025-03-25T22:03:06.608Z"}
{"level":"debug","message":"Executing query [m8p1l33o6e4w9rcrq2y]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[5]","timestamp":"2025-03-25T22:03:06.612Z"}
{"level":"debug","message":"Executing query [m8p1l33r9a2t7dpypxc]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[5]","timestamp":"2025-03-25T22:03:06.615Z"}
{"level":"debug","message":"Executing query [m8p1l33uxve6ceofbz]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[5]","timestamp":"2025-03-25T22:03:06.618Z"}
{"level":"debug","message":"Executing query [m8p1l33xocoeuk10txf]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742940186621\",\"TEST-SP-OFI-FORENSE-1742940186621\",7155,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T22:03:06.621Z"}
{"level":"debug","message":"Executing query [m8p1l3405jndoiw8jk]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742940186621\"]","timestamp":"2025-03-25T22:03:06.624Z"}
{"level":"debug","message":"Executing query [m8p1l3424sflzdgrdi]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742940186621\"]","timestamp":"2025-03-25T22:03:06.626Z"}
{"level":"debug","message":"Executing query [m8p1l346jfy28qyi2nt]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:03:06.630Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:03:06.631Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:07.594Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:03:07.639Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:03:07.642Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T22:03:07.739Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T22:03:07.740Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T22:03:07.740Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T22:03:07.741Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T22:03:07.741Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T22:03:07.741Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:08.206Z"}
{"level":"debug","message":"Executing query [m8p1l4c0ywg6fpne0i]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:03:08.208Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:03:08.225Z"}
{"level":"debug","message":"Executing query [m8p1l4cjxuvrxcczv9e]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742940188207\"]","timestamp":"2025-03-25T22:03:08.227Z"}
{"level":"debug","message":"Executing query [m8p1l4cla481ggpxsn]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742940188207\",true]","timestamp":"2025-03-25T22:03:08.229Z"}
{"level":"debug","message":"Executing query [m8p1l4csn4j4ckw3lkr]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[5]","timestamp":"2025-03-25T22:03:08.236Z"}
{"level":"debug","message":"Executing query [m8p1l4cw0ji6aar0e9mi]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742940188207\"]","timestamp":"2025-03-25T22:03:08.240Z"}
{"level":"debug","message":"Executing query [m8p1l4cyht1wm4uj0tg]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",5]","timestamp":"2025-03-25T22:03:08.242Z"}
{"level":"debug","message":"Executing query [m8p1l4d1o12mo4ogqg]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[5]","timestamp":"2025-03-25T22:03:08.245Z"}
{"level":"debug","message":"Executing query [m8p1l4d4jg7lsinby2f]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[5]","timestamp":"2025-03-25T22:03:08.248Z"}
{"level":"debug","message":"Executing query [m8p1l4d75svoxmluulb]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[5]","timestamp":"2025-03-25T22:03:08.251Z"}
{"level":"debug","message":"Executing query [m8p1l4d90b8uyq7x97g7]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[5]","timestamp":"2025-03-25T22:03:08.253Z"}
{"level":"debug","message":"Executing query [m8p1l4db9olxnqih6x7]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[5]","timestamp":"2025-03-25T22:03:08.255Z"}
{"level":"debug","message":"Executing query [m8p1l4dftekt2lmwatg]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[5]","timestamp":"2025-03-25T22:03:08.259Z"}
{"level":"debug","message":"Executing query [m8p1l4dh3n1f1xbii16]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:03:08.261Z"}
{"level":"debug","message":"Executing query [m8p1l4dikabazn59ff]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:03:08.262Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:03:08.264Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:08.492Z"}
{"level":"debug","message":"Executing query [m8p1l4k0q1vpjp8n69]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:03:08.496Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:03:08.506Z"}
{"level":"debug","message":"Executing query [m8p1l4kdp9xmk42z15k]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:03:08.509Z"}
{"level":"debug","message":"Executing query [m8p1l4kek4bs9vrs3pa]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T22:03:08.510Z"}
{"level":"debug","message":"Executing query [m8p1l4kgl635p4vn0mo]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T22:03:08.512Z"}
{"level":"debug","message":"Executing query [m8p1l4khch37wbeqwko]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T22:03:08.513Z"}
{"level":"debug","message":"Executing query [m8p1l4ko546csrqjxg]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T22:03:08.520Z"}
{"level":"debug","message":"Executing query [m8p1l4kugn9udsuot7j]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[6,888,11,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T22:03:08.526Z\",\"ACTIVO\"]","timestamp":"2025-03-25T22:03:08.527Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 11, Área ID: 888, Rol ID: 888, Documento ID: 10","timestamp":"2025-03-25T22:03:08.534Z"}
{"level":"debug","message":"Executing query [m8p1l4l3pi53ursy41]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[10,11,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T22:03:08.535Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p1l4l3pi53ursy41]","params":"[10,11,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T22:03:08.544Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T22:03:08.545Z"}
{"level":"debug","message":"Executing query [m8p1l4ldx8lwyceowc]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[10]","timestamp":"2025-03-25T22:03:08.545Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p1l4ldx8lwyceowc]","params":"[10]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T22:03:08.548Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T22:03:08.550Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T22:03:08.550Z"}
{"level":"debug","message":"Executing query [m8p1l4lkrjg5jsftww]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[10,11,\"RESTAURAR\"]","timestamp":"2025-03-25T22:03:08.552Z"}
{"level":"debug","message":"Executing query [m8p1l4lr46s41ftbp8s]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[10]","timestamp":"2025-03-25T22:03:08.559Z"}
{"level":"debug","message":"Executing query [m8p1l4lwgmy1ml5jqkw]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[10,11,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T22:03:08.564Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p1l4lwgmy1ml5jqkw]","params":"[10,11,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T22:03:08.569Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T22:03:08.570Z"}
{"level":"debug","message":"Executing query [m8p1l4m3hds0bvtbivo]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[10]","timestamp":"2025-03-25T22:03:08.571Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p1l4m3hds0bvtbivo]","params":"[10]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T22:03:08.574Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T22:03:08.575Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T22:03:08.575Z"}
{"level":"debug","message":"Executing query [m8p1l4m9bgvm6rn251a]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[6,888,11,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T22:03:08.577Z\",\"ACTIVO\"]","timestamp":"2025-03-25T22:03:08.578Z"}
{"level":"debug","message":"Executing query [m8p1l4mej3chg7e0asb]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T22:03:08.582Z"}
{"level":"debug","message":"Executing query [m8p1l4mi9v09mxtjkgg]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[11,\"DOCUMENTO\",11,\"ELIMINAR\"]","timestamp":"2025-03-25T22:03:08.586Z"}
{"level":"debug","message":"Executing query [m8p1l4mmb7lx2ssaxgw]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[11]","timestamp":"2025-03-25T22:03:08.591Z"}
{"level":"debug","message":"Executing query [m8p1l4msqphp6hxi08]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T22:03:08.596Z"}
{"level":"debug","message":"Executing query [m8p1l4mxo01k2dn26j]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[6]","timestamp":"2025-03-25T22:03:08.601Z"}
{"level":"debug","message":"Executing query [m8p1l4n1rf6nrhaenq]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:03:08.605Z"}
{"level":"debug","message":"Executing query [m8p1l4n3h6gxneneru8]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:03:08.607Z"}
{"level":"debug","message":"Executing query [m8p1l4n5czmapljqny]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:03:08.609Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T22:03:08.615Z"}
{"level":"debug","message":"Executing query [m8p1l4nbo34jm2ykrhh]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:03:08.615Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:03:08.617Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:08.776Z"}
{"level":"debug","message":"Executing query [m8p1l4rvsv4pt3kfi2t]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:03:08.779Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:03:08.801Z"}
{"level":"debug","message":"Executing query [m8p1l4sjjf9za3k57r]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:03:08.803Z"}
{"level":"debug","message":"Executing query [m8p1l4skql0jhp88tei]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:03:08.804Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T22:03:08.806Z"}
{"level":"debug","message":"Executing query [m8p1l4sm4umjo81j2x]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T22:03:08.807Z"}
{"level":"debug","message":"Executing query [m8p1l4spkhln6mpu3l]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T22:03:08.809Z"}
{"level":"debug","message":"Executing query [m8p1l4sre5kjf6y1sk]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T22:03:08.811Z"}
{"level":"debug","message":"Executing query [m8p1l4sxy3tdqmmzei]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[14]","timestamp":"2025-03-25T22:03:08.817Z"}
{"level":"debug","message":"Executing query [m8p1l4t0cswhh2rikqi]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[14]","timestamp":"2025-03-25T22:03:08.820Z"}
{"level":"debug","message":"Executing query [m8p1l4t4kg94g3c27y]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",14]","timestamp":"2025-03-25T22:03:08.824Z"}
{"level":"debug","message":"Executing query [m8p1l4t7qhv3zdfy9ug]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[14]","timestamp":"2025-03-25T22:03:08.827Z"}
{"level":"debug","message":"Executing query [m8p1l4ta734ccap6mks]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[14]","timestamp":"2025-03-25T22:03:08.830Z"}
{"level":"debug","message":"Executing query [m8p1l4tdvtoi5phdzui]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[14]","timestamp":"2025-03-25T22:03:08.833Z"}
{"level":"debug","message":"Executing query [m8p1l4tgwit81vjitof]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:03:08.836Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:03:08.838Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:09.056Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:09.568Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:03:09.630Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:03:09.680Z"}
{"level":"debug","message":"Executing query [m8p1l5hm2du4xctm93g]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T22:03:09.706Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:03:09.738Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:09.937Z"}
{"level":"debug","message":"Executing query [m8p1l5o5tlpzja8oet]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:03:09.941Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:03:09.955Z"}
{"level":"debug","message":"Executing query [m8p1l5ol697golqtx3r]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:03:09.957Z"}
{"level":"debug","message":"Executing query [m8p1l5ontn7w0op7cv]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742940189941\"]","timestamp":"2025-03-25T22:03:09.959Z"}
{"level":"debug","message":"Executing query [m8p1l5oprknmn16xrzd]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742940189941\",\"TEST-OFI-QUIMICA-1742940189941\",5463,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:03:09.961Z"}
{"level":"debug","message":"Executing query [m8p1l5owtaunglys24]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[4]","timestamp":"2025-03-25T22:03:09.968Z"}
{"level":"debug","message":"Executing query [m8p1l5oznq98u7fsq68]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742940189941\"]","timestamp":"2025-03-25T22:03:09.971Z"}
{"level":"debug","message":"Executing query [m8p1l5p1bjolullfjv4]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",4]","timestamp":"2025-03-25T22:03:09.973Z"}
{"level":"debug","message":"Executing query [m8p1l5p53bteq3kq6me]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[4]","timestamp":"2025-03-25T22:03:09.977Z"}
{"level":"debug","message":"Executing query [m8p1l5p7cupe692p9w]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[4]","timestamp":"2025-03-25T22:03:09.979Z"}
{"level":"debug","message":"Executing query [m8p1l5pco1g1trclii]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[4]","timestamp":"2025-03-25T22:03:09.984Z"}
{"level":"debug","message":"Executing query [m8p1l5pentmfojii2q]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[4]","timestamp":"2025-03-25T22:03:09.986Z"}
{"level":"debug","message":"Executing query [m8p1l5piqjpa4k3yht]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[4]","timestamp":"2025-03-25T22:03:09.990Z"}
{"level":"debug","message":"Executing query [m8p1l5pkx6dzvccxyd]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:03:09.992Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:03:09.993Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:11.802Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:03:11.805Z"}
{"level":"debug","message":"Executing query [m8p1l73yte1r5uicgsk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:03:11.806Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:03:11.817Z"}
{"level":"debug","message":"Executing query [m8p1l74bmk39ltvgic]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:03:11.819Z"}
{"level":"debug","message":"Executing query [m8p1l74cmbinb78h1t]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:03:11.820Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T22:03:11.822Z"}
{"level":"debug","message":"Executing query [m8p1l74ea1hxi97aswb]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:03:11.822Z"}
{"level":"debug","message":"Executing query [m8p1l74gri1t06eeuhn]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:03:11.824Z"}
{"level":"debug","message":"Executing query [m8p1l74ijhupxhiamm8]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:03:11.826Z"}
{"level":"debug","message":"Executing query [m8p1l74jtjwxvj8vga]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T22:03:11.827Z"}
{"level":"debug","message":"Executing query [m8p1l74pubr1jzzzxk]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[12]","timestamp":"2025-03-25T22:03:11.833Z"}
{"level":"debug","message":"Executing query [m8p1l74s8zh4ogjjfjx]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:03:11.836Z"}
{"level":"debug","message":"Executing query [m8p1l74udglfag3esrt]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",12]","timestamp":"2025-03-25T22:03:11.838Z"}
{"level":"debug","message":"Executing query [m8p1l74xnj4itmq4orm]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[12]","timestamp":"2025-03-25T22:03:11.841Z"}
{"level":"debug","message":"Executing query [m8p1l74zwlfza3nae1p]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[12]","timestamp":"2025-03-25T22:03:11.843Z"}
{"level":"debug","message":"Executing query [m8p1l753zpm0k9i8b1]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[12]","timestamp":"2025-03-25T22:03:11.847Z"}
{"level":"debug","message":"Executing query [m8p1l7554cq8aqrpl52]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:03:11.849Z"}
{"level":"debug","message":"Executing query [m8p1l7572ts1kdwwt9x]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:03:11.851Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T22:03:11.852Z"}
{"level":"debug","message":"Executing query [m8p1l758oe6s04r70y]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:03:11.852Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:03:11.853Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:18.884Z"}
{"level":"debug","message":"Executing query [m8p1mmvtc8t33p2r0p]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:04:18.905Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:04:18.945Z"}
{"level":"debug","message":"Executing query [m8p1mmx0dhium6o3o]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742940258904\"]","timestamp":"2025-03-25T22:04:18.948Z"}
{"level":"debug","message":"Executing query [m8p1mmx41qqdaun7ifp]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742940258904\"]","timestamp":"2025-03-25T22:04:18.952Z"}
{"level":"debug","message":"Executing query [m8p1mmx69t60uob9757]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742940258904\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:04:18.954Z"}
{"level":"debug","message":"Executing query [m8p1mmxd5bk73f0cjgr]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1001]","timestamp":"2025-03-25T22:04:18.962Z"}
{"level":"debug","message":"Executing query [m8p1mmxhwoz2itzc2j]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742940258904\"]","timestamp":"2025-03-25T22:04:18.965Z"}
{"level":"debug","message":"Executing query [m8p1mmxklzubq06l1eh]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1001]","timestamp":"2025-03-25T22:04:18.968Z"}
{"level":"debug","message":"Executing query [m8p1mmxpnlz4zzof4od]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1001]","timestamp":"2025-03-25T22:04:18.973Z"}
{"level":"debug","message":"Executing query [m8p1mmxszgxevm3focs]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1001]","timestamp":"2025-03-25T22:04:18.976Z"}
{"level":"debug","message":"Executing query [m8p1mmxv4uavvlmlzd]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1001]","timestamp":"2025-03-25T22:04:18.979Z"}
{"level":"debug","message":"Executing query [m8p1mmxzn88f1jzqdf]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1001]","timestamp":"2025-03-25T22:04:18.983Z"}
{"level":"debug","message":"Executing query [m8p1mmy0eplw4paq8iw]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1001]","timestamp":"2025-03-25T22:04:18.984Z"}
{"level":"debug","message":"Executing query [m8p1mmy4nngxhwwe34o]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1001]","timestamp":"2025-03-25T22:04:18.988Z"}
{"level":"debug","message":"Executing query [m8p1mmy6tnpcb2gy]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:04:18.990Z"}
{"level":"debug","message":"Executing query [m8p1mmy8cipbmtml33i]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:04:18.992Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:04:18.995Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:04:19.095Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:04:19.099Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:04:19.101Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:04:19.102Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:04:19.105Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:04:19.109Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:04:19.113Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:04:19.122Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:04:19.125Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:04:19.127Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:04:19.129Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T22:04:19.133Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:19.450Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:20.598Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:04:20.789Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T22:04:20.796Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:04:20.868Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T22:04:20.884Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:04:20.936Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:21.691Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:21.810Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:04:21.827Z"}
{"level":"debug","message":"Executing query [m8p1mp52jz5hwdfowep]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T22:04:21.830Z"}
{"level":"debug","message":"Executing query [m8p1mp54eo4yb4mxb27]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T22:04:21.833Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p1mp54eo4yb4mxb27]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T22:04:21.835Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:04:21.837Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:21.980Z"}
{"level":"debug","message":"Executing query [m8p1mp9b7x6ovu1kgbr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:04:21.983Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:04:22.004Z"}
{"level":"debug","message":"Executing query [m8p1mp9z1srzw87cgjs]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:04:22.007Z"}
{"level":"debug","message":"Executing query [m8p1mpa1beo3ke46sjh]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T22:04:22.009Z"}
{"level":"debug","message":"Executing query [m8p1mpa3n435oitu639]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T22:04:22.012Z"}
{"level":"debug","message":"Executing query [m8p1mpa7adxmjcgfg1o]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:04:22.015Z"}
{"level":"info","message":"Usando Mesa ID: 1, Áreas ID: 1/2, Usuarios ID: 1/2, Documento ID: 3","timestamp":"2025-03-25T22:04:22.017Z"}
{"level":"debug","message":"Executing query [m8p1mpaanv92uh8spks]: DELETE FROM Derivacion WHERE IDDocumento = ? AND IDAreaOrigen = ? AND IDAreaDestino = ?","params":"[3,1,2]","timestamp":"2025-03-25T22:04:22.018Z"}
{"level":"debug","message":"Executing query [m8p1mpanaewxyghl5rq]: INSERT INTO Derivacion (\n          IDDocumento, IDMesaPartes, IDAreaOrigen, IDAreaDestino, \n          IDUsuarioDeriva, EstadoDerivacion, Observacion\n        ) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[3,1,1,2,1,\"PENDIENTE\",\"Derivación creada para pruebas automatizadas\"]","timestamp":"2025-03-25T22:04:22.032Z"}
{"level":"debug","message":"Executing query [m8p1mpavwzg7jbx00pl]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[7]","timestamp":"2025-03-25T22:04:22.039Z"}
{"level":"debug","message":"Executing query [m8p1mpaz01ete022zw86]: UPDATE Derivacion SET EstadoDerivacion = ?, Observacion = ?, FechaRecepcion = ?, IDUsuarioRecibe = ? WHERE IDDerivacion = ?","params":"[\"RECIBIDO\",\"Derivación actualizada en pruebas\",\"2025-03-25 22:04:22\",2,7]","timestamp":"2025-03-25T22:04:22.043Z"}
{"level":"debug","message":"Executing query [m8p1mpb4823f7e96txg]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[7]","timestamp":"2025-03-25T22:04:22.048Z"}
{"level":"debug","message":"Executing query [m8p1mpb7q59pdq02vt]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T22:04:22.051Z"}
{"level":"debug","message":"Executing query [m8p1mpb9rz4w0i38kks]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T22:04:22.053Z"}
{"level":"debug","message":"Executing query [m8p1mpbcdm7jkt5su99]: DELETE FROM Derivacion WHERE IDDerivacion = ?","params":"[7]","timestamp":"2025-03-25T22:04:22.056Z"}
{"level":"debug","message":"Executing query [m8p1mpbgl5srzc3j4ji]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[7]","timestamp":"2025-03-25T22:04:22.060Z"}
{"level":"debug","message":"Executing query [m8p1mpbiq3kvo7qthfp]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[3]","timestamp":"2025-03-25T22:04:22.062Z"}
{"level":"debug","message":"Executing query [m8p1mpbmtwz11dt11ma]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:04:22.066Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:23.891Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T22:04:23.953Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T22:04:23.956Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:04:23.965Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:04:23.967Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T22:04:24.064Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T22:04:24.170Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:24.342Z"}
{"level":"debug","message":"Executing query [m8p1mr2xq5z3we8lglj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:04:24.345Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:04:24.358Z"}
{"level":"debug","message":"Executing query [m8p1mr3b21d3h1t16fq]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:04:24.359Z"}
{"level":"debug","message":"Executing query [m8p1mr3emf2bcbsii6k]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742940264344\"]","timestamp":"2025-03-25T22:04:24.362Z"}
{"level":"debug","message":"Executing query [m8p1mr3jlre2baaobmi]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742940264344\",\"TEST-OFICIO-1742940264344\",6006,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:04:24.367Z"}
{"level":"debug","message":"Executing query [m8p1mr3rl0xry8b6ugc]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[7]","timestamp":"2025-03-25T22:04:24.375Z"}
{"level":"debug","message":"Executing query [m8p1mr3vb86gg8pq25i]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742940264344\"]","timestamp":"2025-03-25T22:04:24.379Z"}
{"level":"debug","message":"Executing query [m8p1mr3x8kuwujacvdp]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",7]","timestamp":"2025-03-25T22:04:24.381Z"}
{"level":"debug","message":"Executing query [m8p1mr41vehzmaey2m8]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[7]","timestamp":"2025-03-25T22:04:24.385Z"}
{"level":"debug","message":"Executing query [m8p1mr449d96p8mlx4]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[7]","timestamp":"2025-03-25T22:04:24.388Z"}
{"level":"debug","message":"Executing query [m8p1mr48x5nvax8ukhj]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[7]","timestamp":"2025-03-25T22:04:24.392Z"}
{"level":"debug","message":"Executing query [m8p1mr4a99eeq033gan]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[7]","timestamp":"2025-03-25T22:04:24.394Z"}
{"level":"debug","message":"Executing query [m8p1mr4evdhraxt1tdj]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[7]","timestamp":"2025-03-25T22:04:24.398Z"}
{"level":"debug","message":"Executing query [m8p1mr4gpqqjr834udh]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742940264400\",\"TEST-SP-OFICIO-1742940264400\",9948,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T22:04:24.400Z"}
{"level":"debug","message":"Executing query [m8p1mr4kwutqami64ac]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742940264400\"]","timestamp":"2025-03-25T22:04:24.404Z"}
{"level":"debug","message":"Executing query [m8p1mr4l29t1fuubn78]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742940264400\"]","timestamp":"2025-03-25T22:04:24.405Z"}
{"level":"debug","message":"Executing query [m8p1mr4prhvos4nqxm8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:04:24.409Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:04:24.411Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:24.665Z"}
{"level":"debug","message":"Executing query [m8p1mrbyppy0tf3oeus]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:04:24.670Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:04:24.684Z"}
{"level":"debug","message":"Executing query [m8p1mrceyls0aky3enc]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:04:24.686Z"}
{"level":"debug","message":"Executing query [m8p1mrchlzh63hadlk]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742940264668\"]","timestamp":"2025-03-25T22:04:24.689Z"}
{"level":"debug","message":"Executing query [m8p1mrcj7806bqnoqgk]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742940264668\",\"TEST-OFI-FORENSE-1742940264668\",7764,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742940264668\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:04:24.691Z"}
{"level":"debug","message":"Executing query [m8p1mrcpwmxpw6dktup]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[7]","timestamp":"2025-03-25T22:04:24.697Z"}
{"level":"debug","message":"Executing query [m8p1mrctv3tnhe5a3of]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742940264668\"]","timestamp":"2025-03-25T22:04:24.701Z"}
{"level":"debug","message":"Executing query [m8p1mrcw7k88iwqk63m]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",7]","timestamp":"2025-03-25T22:04:24.704Z"}
{"level":"debug","message":"Executing query [m8p1mrd0x95qq4drn8]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[7]","timestamp":"2025-03-25T22:04:24.708Z"}
{"level":"debug","message":"Executing query [m8p1mrd3iwuqwcjk6g]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[7]","timestamp":"2025-03-25T22:04:24.711Z"}
{"level":"debug","message":"Executing query [m8p1mrd6t95xzirldqc]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[7]","timestamp":"2025-03-25T22:04:24.714Z"}
{"level":"debug","message":"Executing query [m8p1mrdacxg1rkmm0t7]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[7]","timestamp":"2025-03-25T22:04:24.718Z"}
{"level":"debug","message":"Executing query [m8p1mrdeie0uwmj6qhm]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[7]","timestamp":"2025-03-25T22:04:24.722Z"}
{"level":"debug","message":"Executing query [m8p1mrdg49oo0nnk31w]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742940264724\",\"TEST-SP-OFI-FORENSE-1742940264724\",2535,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T22:04:24.724Z"}
{"level":"debug","message":"Executing query [m8p1mrdjqtp1cye3mub]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742940264724\"]","timestamp":"2025-03-25T22:04:24.727Z"}
{"level":"debug","message":"Executing query [m8p1mrdm6dd1kqsojko]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742940264724\"]","timestamp":"2025-03-25T22:04:24.730Z"}
{"level":"debug","message":"Executing query [m8p1mrdpkk3qmrd1j1]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:04:24.733Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:04:24.734Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:25.829Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:04:25.879Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:04:25.880Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T22:04:25.978Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T22:04:25.980Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T22:04:25.980Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T22:04:25.981Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T22:04:25.982Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T22:04:25.982Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:26.424Z"}
{"level":"debug","message":"Executing query [m8p1msor0q2206byj62]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:04:26.427Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:04:26.440Z"}
{"level":"debug","message":"Executing query [m8p1msp50oc6cqfzp3ro]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742940266427\"]","timestamp":"2025-03-25T22:04:26.441Z"}
{"level":"debug","message":"Executing query [m8p1msp7f73wt5z2ybq]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742940266427\",true]","timestamp":"2025-03-25T22:04:26.443Z"}
{"level":"debug","message":"Executing query [m8p1mspf8uprxyu3n5]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[7]","timestamp":"2025-03-25T22:04:26.451Z"}
{"level":"debug","message":"Executing query [m8p1mspiy09jgxp32f8]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742940266427\"]","timestamp":"2025-03-25T22:04:26.454Z"}
{"level":"debug","message":"Executing query [m8p1mspku6bfirk63m]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",7]","timestamp":"2025-03-25T22:04:26.456Z"}
{"level":"debug","message":"Executing query [m8p1mspoli2w1m4wnt]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[7]","timestamp":"2025-03-25T22:04:26.460Z"}
{"level":"debug","message":"Executing query [m8p1mspq6zuwncl3zfv]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[7]","timestamp":"2025-03-25T22:04:26.462Z"}
{"level":"debug","message":"Executing query [m8p1msptzfj6y435rfr]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[7]","timestamp":"2025-03-25T22:04:26.465Z"}
{"level":"debug","message":"Executing query [m8p1mspwco3hswgi6a]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[7]","timestamp":"2025-03-25T22:04:26.468Z"}
{"level":"debug","message":"Executing query [m8p1msq2buafwue2kyu]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[7]","timestamp":"2025-03-25T22:04:26.474Z"}
{"level":"debug","message":"Executing query [m8p1msq52xwgf4mpnsf]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[7]","timestamp":"2025-03-25T22:04:26.477Z"}
{"level":"debug","message":"Executing query [m8p1msq97vs2awpuejq]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:04:26.481Z"}
{"level":"debug","message":"Executing query [m8p1msqa37h18hoc9wg]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:04:26.482Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:04:26.483Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:26.722Z"}
{"level":"debug","message":"Executing query [m8p1msx13hjbd4i63e9]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:04:26.725Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:04:26.738Z"}
{"level":"debug","message":"Executing query [m8p1msxgejzn6yxowln]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:04:26.740Z"}
{"level":"debug","message":"Executing query [m8p1msxh0941f291q3nv]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T22:04:26.741Z"}
{"level":"debug","message":"Executing query [m8p1msxkm3ocuxvf3sb]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T22:04:26.744Z"}
{"level":"debug","message":"Executing query [m8p1msxm5yl4lz03of]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T22:04:26.746Z"}
{"level":"debug","message":"Executing query [m8p1msxrm30ax3jl75]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T22:04:26.751Z"}
{"level":"debug","message":"Executing query [m8p1msxvqwrivkpkhrh]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[8,888,13,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T22:04:26.755Z\",\"ACTIVO\"]","timestamp":"2025-03-25T22:04:26.755Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 13, Área ID: 888, Rol ID: 888, Documento ID: 12","timestamp":"2025-03-25T22:04:26.760Z"}
{"level":"debug","message":"Executing query [m8p1msy12aaoqga5h4v]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[12,13,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T22:04:26.761Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p1msy12aaoqga5h4v]","params":"[12,13,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T22:04:26.766Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T22:04:26.767Z"}
{"level":"debug","message":"Executing query [m8p1msy71djvrfyquwj]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[12]","timestamp":"2025-03-25T22:04:26.767Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p1msy71djvrfyquwj]","params":"[12]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T22:04:26.771Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T22:04:26.772Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T22:04:26.772Z"}
{"level":"debug","message":"Executing query [m8p1msydsewyznmmwha]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[12,13,\"RESTAURAR\"]","timestamp":"2025-03-25T22:04:26.773Z"}
{"level":"debug","message":"Executing query [m8p1msyl1paryr5sjod]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[12]","timestamp":"2025-03-25T22:04:26.781Z"}
{"level":"debug","message":"Executing query [m8p1msyngmzyb77n4ga]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[12,13,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T22:04:26.783Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p1msyngmzyb77n4ga]","params":"[12,13,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T22:04:26.788Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T22:04:26.789Z"}
{"level":"debug","message":"Executing query [m8p1msytmgs903snjzj]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[12]","timestamp":"2025-03-25T22:04:26.789Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p1msytmgs903snjzj]","params":"[12]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T22:04:26.793Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T22:04:26.793Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T22:04:26.794Z"}
{"level":"debug","message":"Executing query [m8p1msyzuo6g1szloyb]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[8,888,13,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T22:04:26.795Z\",\"ACTIVO\"]","timestamp":"2025-03-25T22:04:26.795Z"}
{"level":"debug","message":"Executing query [m8p1msz231xijvgpgby]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T22:04:26.798Z"}
{"level":"debug","message":"Executing query [m8p1msz6wod2cr6od6]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[13,\"DOCUMENTO\",13,\"ELIMINAR\"]","timestamp":"2025-03-25T22:04:26.802Z"}
{"level":"debug","message":"Executing query [m8p1msz9r9n2jetzfsm]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[13]","timestamp":"2025-03-25T22:04:26.805Z"}
{"level":"debug","message":"Executing query [m8p1mszdwq37731slep]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T22:04:26.809Z"}
{"level":"debug","message":"Executing query [m8p1mszhjzs7uxp83si]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[8]","timestamp":"2025-03-25T22:04:26.813Z"}
{"level":"debug","message":"Executing query [m8p1mszl89xgkayaw5]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:04:26.817Z"}
{"level":"debug","message":"Executing query [m8p1mszm3ipu5uz065m]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:04:26.818Z"}
{"level":"debug","message":"Executing query [m8p1mszo2bpxm72umss]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:04:26.820Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T22:04:26.824Z"}
{"level":"debug","message":"Executing query [m8p1mszte01xh071wk]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:04:26.825Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:04:26.828Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:26.965Z"}
{"level":"debug","message":"Executing query [m8p1mt3s5bvydpa7dem]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:04:26.968Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:04:26.981Z"}
{"level":"debug","message":"Executing query [m8p1mt46jc005yj43kn]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:04:26.982Z"}
{"level":"debug","message":"Executing query [m8p1mt4el05wjursjj]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:04:26.990Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T22:04:26.993Z"}
{"level":"debug","message":"Executing query [m8p1mt4irfgtkzy3l2]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T22:04:26.994Z"}
{"level":"debug","message":"Executing query [m8p1mt4kh5tlitm1jd7]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T22:04:26.996Z"}
{"level":"debug","message":"Executing query [m8p1mt4mavz0cjcx6xd]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T22:04:26.998Z"}
{"level":"debug","message":"Executing query [m8p1mt4uil84ke10vgc]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T22:04:27.006Z"}
{"level":"debug","message":"Executing query [m8p1mt4zdy3dnot120e]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T22:04:27.011Z"}
{"level":"debug","message":"Executing query [m8p1mt53xjb7621mr9]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",16]","timestamp":"2025-03-25T22:04:27.015Z"}
{"level":"debug","message":"Executing query [m8p1mt59si9z709v5qh]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T22:04:27.022Z"}
{"level":"debug","message":"Executing query [m8p1mt5c2t6sjxeqbe7]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T22:04:27.024Z"}
{"level":"debug","message":"Executing query [m8p1mt5gjbj4jgez57n]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T22:04:27.028Z"}
{"level":"debug","message":"Executing query [m8p1mt5jznpppzw8qd]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:04:27.031Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:04:27.032Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:27.322Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:27.884Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:04:27.939Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:04:27.987Z"}
{"level":"debug","message":"Executing query [m8p1mtwpcrl7z55eneg]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T22:04:28.009Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:04:28.043Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:28.234Z"}
{"level":"debug","message":"Executing query [m8p1mu32zox6ei5sboi]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:04:28.238Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:04:28.247Z"}
{"level":"debug","message":"Executing query [m8p1mu3cpbn3oykx72]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:04:28.248Z"}
{"level":"debug","message":"Executing query [m8p1mu3e6z75h7q6739]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742940268237\"]","timestamp":"2025-03-25T22:04:28.250Z"}
{"level":"debug","message":"Executing query [m8p1mu3g46g517g1g6q]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742940268237\",\"TEST-OFI-QUIMICA-1742940268237\",8255,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:04:28.252Z"}
{"level":"debug","message":"Executing query [m8p1mu3lgv3hvs457xk]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T22:04:28.257Z"}
{"level":"debug","message":"Executing query [m8p1mu3o2px611i74x]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742940268237\"]","timestamp":"2025-03-25T22:04:28.260Z"}
{"level":"debug","message":"Executing query [m8p1mu3qva0mh6szmz]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",5]","timestamp":"2025-03-25T22:04:28.262Z"}
{"level":"debug","message":"Executing query [m8p1mu3t5ez06ib69ki]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T22:04:28.265Z"}
{"level":"debug","message":"Executing query [m8p1mu3vq61t2nqkhbd]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T22:04:28.267Z"}
{"level":"debug","message":"Executing query [m8p1mu3zpqmdwizc4mc]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T22:04:28.271Z"}
{"level":"debug","message":"Executing query [m8p1mu41mj5j7zbme6]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T22:04:28.273Z"}
{"level":"debug","message":"Executing query [m8p1mu43ivbew1xp5]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T22:04:28.276Z"}
{"level":"debug","message":"Executing query [m8p1mu45iya1fjxuor]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:04:28.277Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:04:28.282Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:30.148Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:04:30.150Z"}
{"level":"debug","message":"Executing query [m8p1mvk8i510q14tbhp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:04:30.153Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:04:30.163Z"}
{"level":"debug","message":"Executing query [m8p1mvklkodtkl809jk]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:04:30.165Z"}
{"level":"debug","message":"Executing query [m8p1mvkni005isadev]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:04:30.167Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T22:04:30.168Z"}
{"level":"debug","message":"Executing query [m8p1mvkpcy08mxfkud]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:04:30.169Z"}
{"level":"debug","message":"Executing query [m8p1mvkq3hbvcnxlfs6]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:04:30.170Z"}
{"level":"debug","message":"Executing query [m8p1mvkryn2vty7oe6c]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:04:30.171Z"}
{"level":"debug","message":"Executing query [m8p1mvksyip8423ibwl]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T22:04:30.172Z"}
{"level":"debug","message":"Executing query [m8p1mvkwz9air75dv89]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[14]","timestamp":"2025-03-25T22:04:30.176Z"}
{"level":"debug","message":"Executing query [m8p1mvky481inp3tgkh]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:04:30.178Z"}
{"level":"debug","message":"Executing query [m8p1mvl017jv1mq0m1l]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",14]","timestamp":"2025-03-25T22:04:30.180Z"}
{"level":"debug","message":"Executing query [m8p1mvl4h8gru4wusb5]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[14]","timestamp":"2025-03-25T22:04:30.185Z"}
{"level":"debug","message":"Executing query [m8p1mvl7fq9pcsud3u8]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[14]","timestamp":"2025-03-25T22:04:30.187Z"}
{"level":"debug","message":"Executing query [m8p1mvlad5c8y8tlzwq]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[14]","timestamp":"2025-03-25T22:04:30.190Z"}
{"level":"debug","message":"Executing query [m8p1mvlc9pgcp821257]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:04:30.192Z"}
{"level":"debug","message":"Executing query [m8p1mvld8bnv94iuzzj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:04:30.193Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T22:04:30.195Z"}
{"level":"debug","message":"Executing query [m8p1mvlfwvh38jk6pjm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:04:30.195Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:04:30.197Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:20.456Z"}
{"level":"debug","message":"Executing query [m8p1nye4wkf15m2e4l9]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:05:20.477Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:05:20.515Z"}
{"level":"debug","message":"Executing query [m8p1nyf8t8147pp7zqj]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742940320476\"]","timestamp":"2025-03-25T22:05:20.516Z"}
{"level":"debug","message":"Executing query [m8p1nyfcpkny32tqxxa]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742940320476\"]","timestamp":"2025-03-25T22:05:20.520Z"}
{"level":"debug","message":"Executing query [m8p1nyfes7m6w7r8np]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742940320476\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:05:20.522Z"}
{"level":"debug","message":"Executing query [m8p1nyfm4m6qldcgmm9]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1002]","timestamp":"2025-03-25T22:05:20.530Z"}
{"level":"debug","message":"Executing query [m8p1nyfpdaihedpmqoe]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742940320476\"]","timestamp":"2025-03-25T22:05:20.533Z"}
{"level":"debug","message":"Executing query [m8p1nyftiowhsolm0pk]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1002]","timestamp":"2025-03-25T22:05:20.537Z"}
{"level":"debug","message":"Executing query [m8p1nyfyd4fuonwtlpl]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1002]","timestamp":"2025-03-25T22:05:20.542Z"}
{"level":"debug","message":"Executing query [m8p1nyg10i9zoqmxvhy8]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1002]","timestamp":"2025-03-25T22:05:20.545Z"}
{"level":"debug","message":"Executing query [m8p1nyg4k9w5o0v9cz]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1002]","timestamp":"2025-03-25T22:05:20.548Z"}
{"level":"debug","message":"Executing query [m8p1nyg7i27n1rrlm8g]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1002]","timestamp":"2025-03-25T22:05:20.551Z"}
{"level":"debug","message":"Executing query [m8p1nyg9kzgwe8g4g7a]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1002]","timestamp":"2025-03-25T22:05:20.553Z"}
{"level":"debug","message":"Executing query [m8p1nygc4iobtv5rec7]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1002]","timestamp":"2025-03-25T22:05:20.556Z"}
{"level":"debug","message":"Executing query [m8p1nygeovy0ms1gpg9]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:05:20.558Z"}
{"level":"debug","message":"Executing query [m8p1nyggc8sb2dhe9tp]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:05:20.560Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:05:20.562Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:05:20.663Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:05:20.665Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:05:20.668Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:05:20.669Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:05:20.671Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:05:20.677Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:05:20.679Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:05:20.683Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:05:20.684Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:05:20.685Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:05:20.686Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T22:05:20.688Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:20.914Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:22.011Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:05:22.208Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T22:05:22.215Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:05:22.283Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T22:05:22.300Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:05:22.355Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:23.086Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:23.213Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:05:23.232Z"}
{"level":"debug","message":"Executing query [m8p1o0ir9bg57jhp7dr]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T22:05:23.235Z"}
{"level":"debug","message":"Executing query [m8p1o0iv4bubxzdac9m]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T22:05:23.239Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p1o0iv4bubxzdac9m]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T22:05:23.241Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:05:23.244Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:23.386Z"}
{"level":"debug","message":"Executing query [m8p1o0n1grdxj6z3nke]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:05:23.389Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:05:23.412Z"}
{"level":"debug","message":"Executing query [m8p1o0nq2si2j4homx]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:05:23.414Z"}
{"level":"debug","message":"Executing query [m8p1o0ns94ti9u3tv48]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T22:05:23.416Z"}
{"level":"debug","message":"Executing query [m8p1o0nurpzfar8xpsp]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T22:05:23.418Z"}
{"level":"debug","message":"Executing query [m8p1o0nwbifwkeujx4b]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:05:23.420Z"}
{"level":"info","message":"Usando Mesa ID: 1, Áreas ID: 1/2, Usuarios ID: 1/2, Documento ID: 4","timestamp":"2025-03-25T22:05:23.421Z"}
{"level":"debug","message":"Executing query [m8p1o0nyhwr71hovr3c]: DELETE FROM Derivacion WHERE IDDocumento = ? AND IDAreaOrigen = ? AND IDAreaDestino = ?","params":"[4,1,2]","timestamp":"2025-03-25T22:05:23.422Z"}
{"level":"debug","message":"Executing query [m8p1o0o0jt1ee99hrk]: INSERT INTO Derivacion (\n          IDDocumento, IDMesaPartes, IDAreaOrigen, IDAreaDestino, \n          IDUsuarioDeriva, EstadoDerivacion, Observacion\n        ) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[4,1,1,2,1,\"PENDIENTE\",\"Derivación creada para pruebas automatizadas\"]","timestamp":"2025-03-25T22:05:23.424Z"}
{"level":"debug","message":"Executing query [m8p1o0oavg5fbxeh04]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[8]","timestamp":"2025-03-25T22:05:23.434Z"}
{"level":"debug","message":"Executing query [m8p1o0ofp8mo57sew6]: UPDATE Derivacion SET EstadoDerivacion = ?, Observacion = ?, FechaRecepcion = ?, IDUsuarioRecibe = ? WHERE IDDerivacion = ?","params":"[\"RECIBIDO\",\"Derivación actualizada en pruebas\",\"2025-03-25 22:05:23\",2,8]","timestamp":"2025-03-25T22:05:23.439Z"}
{"level":"debug","message":"Executing query [m8p1o0oj9jec6wkoktt]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[8]","timestamp":"2025-03-25T22:05:23.443Z"}
{"level":"debug","message":"Executing query [m8p1o0onp5btzvlrps]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T22:05:23.447Z"}
{"level":"debug","message":"Executing query [m8p1o0op9odwsdpfhl5]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T22:05:23.449Z"}
{"level":"debug","message":"Executing query [m8p1o0ork2t7g4svi2]: DELETE FROM Derivacion WHERE IDDerivacion = ?","params":"[8]","timestamp":"2025-03-25T22:05:23.451Z"}
{"level":"debug","message":"Executing query [m8p1o0ovidxo85p25d]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[8]","timestamp":"2025-03-25T22:05:23.455Z"}
{"level":"debug","message":"Executing query [m8p1o0oxqanvb24v5f]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[4]","timestamp":"2025-03-25T22:05:23.457Z"}
{"level":"debug","message":"Executing query [m8p1o0p2u2ieiu48aqk]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:05:23.462Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:25.282Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T22:05:25.345Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T22:05:25.350Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:05:25.358Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:05:25.360Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T22:05:25.460Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T22:05:25.565Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:25.737Z"}
{"level":"debug","message":"Executing query [m8p1o2gdrlqbrhz0m7]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:05:25.742Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:05:25.755Z"}
{"level":"debug","message":"Executing query [m8p1o2gs44um57maab4]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:05:25.756Z"}
{"level":"debug","message":"Executing query [m8p1o2gvgfmqc93pr3k]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742940325740\"]","timestamp":"2025-03-25T22:05:25.759Z"}
{"level":"debug","message":"Executing query [m8p1o2h0votvw2glq8]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742940325740\",\"TEST-OFICIO-1742940325740\",526,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:05:25.764Z"}
{"level":"debug","message":"Executing query [m8p1o2h8nheueivfmcc]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T22:05:25.772Z"}
{"level":"debug","message":"Executing query [m8p1o2hcy7kfcwfsy6g]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742940325740\"]","timestamp":"2025-03-25T22:05:25.776Z"}
{"level":"debug","message":"Executing query [m8p1o2hfimdbnv690bc]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",9]","timestamp":"2025-03-25T22:05:25.779Z"}
{"level":"debug","message":"Executing query [m8p1o2hjrozmva0amz]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T22:05:25.783Z"}
{"level":"debug","message":"Executing query [m8p1o2hm6ln01smahvk]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T22:05:25.786Z"}
{"level":"debug","message":"Executing query [m8p1o2hp1bqj5mgxq9v]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T22:05:25.789Z"}
{"level":"debug","message":"Executing query [m8p1o2hr9h2gttgkwu]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T22:05:25.791Z"}
{"level":"debug","message":"Executing query [m8p1o2hvsrm1aeag8ar]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T22:05:25.796Z"}
{"level":"debug","message":"Executing query [m8p1o2hxjbmztw73u3j]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742940325797\",\"TEST-SP-OFICIO-1742940325797\",7492,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T22:05:25.797Z"}
{"level":"debug","message":"Executing query [m8p1o2i2oliaah92uk]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742940325797\"]","timestamp":"2025-03-25T22:05:25.802Z"}
{"level":"debug","message":"Executing query [m8p1o2i4eghq2i0ugl]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742940325797\"]","timestamp":"2025-03-25T22:05:25.804Z"}
{"level":"debug","message":"Executing query [m8p1o2i8ptdjlflyecs]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:05:25.808Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:05:25.809Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:26.062Z"}
{"level":"debug","message":"Executing query [m8p1o2peeqlc7k1fgxt]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:05:26.066Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:05:26.077Z"}
{"level":"debug","message":"Executing query [m8p1o2prbuvs733cje]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:05:26.079Z"}
{"level":"debug","message":"Executing query [m8p1o2ps8i0ubno2kwl]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742940326065\"]","timestamp":"2025-03-25T22:05:26.080Z"}
{"level":"debug","message":"Executing query [m8p1o2pu1xbj7g5mtrt]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742940326065\",\"TEST-OFI-FORENSE-1742940326065\",1887,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742940326065\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:05:26.082Z"}
{"level":"debug","message":"Executing query [m8p1o2q1ejqqu5ltrq]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T22:05:26.089Z"}
{"level":"debug","message":"Executing query [m8p1o2q552v8kbnd7i]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742940326065\"]","timestamp":"2025-03-25T22:05:26.093Z"}
{"level":"debug","message":"Executing query [m8p1o2q8avmbuq6mc19]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",9]","timestamp":"2025-03-25T22:05:26.096Z"}
{"level":"debug","message":"Executing query [m8p1o2qct3u3kzcg03]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T22:05:26.100Z"}
{"level":"debug","message":"Executing query [m8p1o2qebrkxbmztth]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T22:05:26.102Z"}
{"level":"debug","message":"Executing query [m8p1o2qi84cegge2vgm]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T22:05:26.106Z"}
{"level":"debug","message":"Executing query [m8p1o2qktc8zan708nk]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T22:05:26.108Z"}
{"level":"debug","message":"Executing query [m8p1o2qnvc8b7l1gube]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T22:05:26.112Z"}
{"level":"debug","message":"Executing query [m8p1o2qq4vdgvwu1kek]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742940326114\",\"TEST-SP-OFI-FORENSE-1742940326114\",3242,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T22:05:26.114Z"}
{"level":"debug","message":"Executing query [m8p1o2qu029zf1fn13lz]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742940326114\"]","timestamp":"2025-03-25T22:05:26.118Z"}
{"level":"debug","message":"Executing query [m8p1o2qwb2itm7hb857]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742940326114\"]","timestamp":"2025-03-25T22:05:26.120Z"}
{"level":"debug","message":"Executing query [m8p1o2qzr15teqtx6aj]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:05:26.123Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:05:26.125Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:27.189Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:05:27.240Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:05:27.242Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T22:05:27.345Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T22:05:27.346Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T22:05:27.347Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T22:05:27.348Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T22:05:27.349Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T22:05:27.349Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:27.805Z"}
{"level":"debug","message":"Executing query [m8p1o41u56ophgkewnk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:05:27.810Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:05:27.838Z"}
{"level":"debug","message":"Executing query [m8p1o42tsmf4iwm2piq]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742940327809\"]","timestamp":"2025-03-25T22:05:27.845Z"}
{"level":"debug","message":"Executing query [m8p1o42yk4qs1xukeni]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742940327809\",true]","timestamp":"2025-03-25T22:05:27.850Z"}
{"level":"debug","message":"Executing query [m8p1o434dr0q7psxhh]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T22:05:27.857Z"}
{"level":"debug","message":"Executing query [m8p1o438nuqqaxyvzv]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742940327809\"]","timestamp":"2025-03-25T22:05:27.861Z"}
{"level":"debug","message":"Executing query [m8p1o43dfq1647bahzm]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",9]","timestamp":"2025-03-25T22:05:27.865Z"}
{"level":"debug","message":"Executing query [m8p1o43j9or1vqxhaun]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T22:05:27.871Z"}
{"level":"debug","message":"Executing query [m8p1o43m9mvyqr4s79]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T22:05:27.874Z"}
{"level":"debug","message":"Executing query [m8p1o43ssy7bs1v7ml]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T22:05:27.880Z"}
{"level":"debug","message":"Executing query [m8p1o43w8l027ttgsl8]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T22:05:27.884Z"}
{"level":"debug","message":"Executing query [m8p1o4455ukzzh2jrqt]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T22:05:27.893Z"}
{"level":"debug","message":"Executing query [m8p1o44bl3iniel4nw]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T22:05:27.899Z"}
{"level":"debug","message":"Executing query [m8p1o44e4pcjgr88w1m]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:05:27.902Z"}
{"level":"debug","message":"Executing query [m8p1o44in804mhbp3q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:05:27.906Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:05:27.908Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:28.200Z"}
{"level":"debug","message":"Executing query [m8p1o4cs6hlm07nv0da]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:05:28.204Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:05:28.219Z"}
{"level":"debug","message":"Executing query [m8p1o4d9ogfw9m3pgk]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:05:28.221Z"}
{"level":"debug","message":"Executing query [m8p1o4dbiroenv6amjd]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T22:05:28.224Z"}
{"level":"debug","message":"Executing query [m8p1o4ddn70zhquwfj]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T22:05:28.225Z"}
{"level":"debug","message":"Executing query [m8p1o4dflv1zlur0xyl]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T22:05:28.227Z"}
{"level":"debug","message":"Executing query [m8p1o4di64al0x89px5]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T22:05:28.230Z"}
{"level":"debug","message":"Executing query [m8p1o4dmy35alvmcnbd]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[10,888,15,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T22:05:28.234Z\",\"ACTIVO\"]","timestamp":"2025-03-25T22:05:28.234Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 15, Área ID: 888, Rol ID: 888, Documento ID: 14","timestamp":"2025-03-25T22:05:28.238Z"}
{"level":"debug","message":"Executing query [m8p1o4dsjrccnnmxe3b]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[14,15,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T22:05:28.240Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p1o4dsjrccnnmxe3b]","params":"[14,15,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T22:05:28.245Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T22:05:28.245Z"}
{"level":"debug","message":"Executing query [m8p1o4dypshgr0oxfd]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[14]","timestamp":"2025-03-25T22:05:28.246Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p1o4dypshgr0oxfd]","params":"[14]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T22:05:28.248Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T22:05:28.249Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T22:05:28.249Z"}
{"level":"debug","message":"Executing query [m8p1o4e360snb5q0hya]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[14,15,\"RESTAURAR\"]","timestamp":"2025-03-25T22:05:28.251Z"}
{"level":"debug","message":"Executing query [m8p1o4e8ko0m5v1ndua]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[14]","timestamp":"2025-03-25T22:05:28.256Z"}
{"level":"debug","message":"Executing query [m8p1o4ec371upkpeb6y]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[14,15,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T22:05:28.260Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p1o4ec371upkpeb6y]","params":"[14,15,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T22:05:28.263Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T22:05:28.265Z"}
{"level":"debug","message":"Executing query [m8p1o4ehlwmusltzh6]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[14]","timestamp":"2025-03-25T22:05:28.265Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p1o4ehlwmusltzh6]","params":"[14]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T22:05:28.268Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T22:05:28.269Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T22:05:28.269Z"}
{"level":"debug","message":"Executing query [m8p1o4emt7v4e4gq4u]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[10,888,15,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T22:05:28.270Z\",\"ACTIVO\"]","timestamp":"2025-03-25T22:05:28.270Z"}
{"level":"debug","message":"Executing query [m8p1o4eqeqv2fauy85s]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T22:05:28.274Z"}
{"level":"debug","message":"Executing query [m8p1o4eto5cudfv1w4b]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[15,\"DOCUMENTO\",15,\"ELIMINAR\"]","timestamp":"2025-03-25T22:05:28.277Z"}
{"level":"debug","message":"Executing query [m8p1o4ex5spnv4jhpzl]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[15]","timestamp":"2025-03-25T22:05:28.281Z"}
{"level":"debug","message":"Executing query [m8p1o4f13to7k5lmush]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T22:05:28.285Z"}
{"level":"debug","message":"Executing query [m8p1o4f5dwjkpzyb8r]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[10]","timestamp":"2025-03-25T22:05:28.289Z"}
{"level":"debug","message":"Executing query [m8p1o4f971ohvd5ilgd]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:05:28.293Z"}
{"level":"debug","message":"Executing query [m8p1o4fb6ix6ovc92i9]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:05:28.295Z"}
{"level":"debug","message":"Executing query [m8p1o4fc0mt45r0mpah]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:05:28.296Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T22:05:28.301Z"}
{"level":"debug","message":"Executing query [m8p1o4fh26j0m6l6womj]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:05:28.301Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:05:28.303Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:28.446Z"}
{"level":"debug","message":"Executing query [m8p1o4jlpuvnx6p4ln]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:05:28.449Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:05:28.469Z"}
{"level":"debug","message":"Executing query [m8p1o4k6x70j9r5sffj]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:05:28.470Z"}
{"level":"debug","message":"Executing query [m8p1o4k9zu1v18hw8x]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:05:28.473Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T22:05:28.475Z"}
{"level":"debug","message":"Executing query [m8p1o4kc9covm3bldvq]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T22:05:28.476Z"}
{"level":"debug","message":"Executing query [m8p1o4kd4xu5vial9oi]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T22:05:28.477Z"}
{"level":"debug","message":"Executing query [m8p1o4kgg4bia8t7nim]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T22:05:28.480Z"}
{"level":"debug","message":"Executing query [m8p1o4kn609d0ckisk7]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[18]","timestamp":"2025-03-25T22:05:28.488Z"}
{"level":"debug","message":"Executing query [m8p1o4ks5wci2zml0va]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[18]","timestamp":"2025-03-25T22:05:28.492Z"}
{"level":"debug","message":"Executing query [m8p1o4kwjivhpwh3mv]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",18]","timestamp":"2025-03-25T22:05:28.496Z"}
{"level":"debug","message":"Executing query [m8p1o4kziglbh884yih]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[18]","timestamp":"2025-03-25T22:05:28.499Z"}
{"level":"debug","message":"Executing query [m8p1o4l3hyiwqio6b2w]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[18]","timestamp":"2025-03-25T22:05:28.503Z"}
{"level":"debug","message":"Executing query [m8p1o4l6oy8885zvvea]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[18]","timestamp":"2025-03-25T22:05:28.506Z"}
{"level":"debug","message":"Executing query [m8p1o4l9p1yipsmgfmr]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:05:28.509Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:05:28.511Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:28.729Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:29.205Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:05:29.279Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:05:29.350Z"}
{"level":"debug","message":"Executing query [m8p1o5a2hbtmaiz5igc]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T22:05:29.403Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:05:29.442Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:29.653Z"}
{"level":"debug","message":"Executing query [m8p1o5h4nynd4yffezl]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:05:29.656Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:05:29.665Z"}
{"level":"debug","message":"Executing query [m8p1o5hfjpj64x5lwoi]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:05:29.667Z"}
{"level":"debug","message":"Executing query [m8p1o5hhn5o5aw1ox4]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742940329656\"]","timestamp":"2025-03-25T22:05:29.669Z"}
{"level":"debug","message":"Executing query [m8p1o5hj8oemvbngkqx]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742940329656\",\"TEST-OFI-QUIMICA-1742940329656\",8149,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:05:29.671Z"}
{"level":"debug","message":"Executing query [m8p1o5hpe1xeiwnz9g]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T22:05:29.677Z"}
{"level":"debug","message":"Executing query [m8p1o5hr93q92pj3u]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742940329656\"]","timestamp":"2025-03-25T22:05:29.679Z"}
{"level":"debug","message":"Executing query [m8p1o5hu6fa5he7jz3w]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",6]","timestamp":"2025-03-25T22:05:29.682Z"}
{"level":"debug","message":"Executing query [m8p1o5hy3708ls5ze7x]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T22:05:29.686Z"}
{"level":"debug","message":"Executing query [m8p1o5i2plz2zij5bb]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T22:05:29.690Z"}
{"level":"debug","message":"Executing query [m8p1o5i5xnm0b4q8st]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T22:05:29.693Z"}
{"level":"debug","message":"Executing query [m8p1o5i8awngd6gpkyd]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T22:05:29.696Z"}
{"level":"debug","message":"Executing query [m8p1o5ibascvgjnp5ua]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T22:05:29.699Z"}
{"level":"debug","message":"Executing query [m8p1o5icmv9nbldzvno]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:05:29.700Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:05:29.702Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:31.685Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:05:31.688Z"}
{"level":"debug","message":"Executing query [m8p1o71m45hk2lavwmu]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:05:31.690Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:05:31.699Z"}
{"level":"debug","message":"Executing query [m8p1o71whgf0exbj2us]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:05:31.700Z"}
{"level":"debug","message":"Executing query [m8p1o71xq7m5vqe4hbl]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:05:31.701Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T22:05:31.703Z"}
{"level":"debug","message":"Executing query [m8p1o71zdhw0rb36cmp]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:05:31.703Z"}
{"level":"debug","message":"Executing query [m8p1o720e4nwtw7td6a]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:05:31.704Z"}
{"level":"debug","message":"Executing query [m8p1o721yhrbvjj3xhh]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:05:31.705Z"}
{"level":"debug","message":"Executing query [m8p1o7227q2czjsmqw7]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T22:05:31.706Z"}
{"level":"debug","message":"Executing query [m8p1o727e6fau0bu7ap]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[16]","timestamp":"2025-03-25T22:05:31.711Z"}
{"level":"debug","message":"Executing query [m8p1o729bno98zphyn9]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:05:31.713Z"}
{"level":"debug","message":"Executing query [m8p1o72byyjmeun4je]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",16]","timestamp":"2025-03-25T22:05:31.715Z"}
{"level":"debug","message":"Executing query [m8p1o72fkp112o8p89c]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[16]","timestamp":"2025-03-25T22:05:31.719Z"}
{"level":"debug","message":"Executing query [m8p1o72g6nj9l7l7brx]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[16]","timestamp":"2025-03-25T22:05:31.721Z"}
{"level":"debug","message":"Executing query [m8p1o72kzt8lkhr531]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[16]","timestamp":"2025-03-25T22:05:31.724Z"}
{"level":"debug","message":"Executing query [m8p1o72ln9lnu53qsz]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:05:31.725Z"}
{"level":"debug","message":"Executing query [m8p1o72npe5q8m5e1bm]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:05:31.727Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T22:05:31.727Z"}
{"level":"debug","message":"Executing query [m8p1o72o5ms8269dd6s]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:05:31.728Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:05:31.729Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:17:36.053Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:17:36.062Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:17:36.065Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:17:36.068Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:17:36.071Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:17:36.080Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:17:36.094Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:17:36.107Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:17:36.108Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:17:36.110Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:17:36.112Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T22:17:36.114Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:36.306Z"}
{"level":"debug","message":"Executing query [m8p23q701qn02kz47lu]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:17:36.348Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:17:36.440Z"}
{"level":"debug","message":"Executing query [m8p23q9m9jsyv3esr1f]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941056345\"]","timestamp":"2025-03-25T22:17:36.442Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:36.397Z"}
{"level":"debug","message":"Executing query [m8p23qcjxnl2j8h8sp]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941056345\"]","timestamp":"2025-03-25T22:17:36.547Z"}
{"level":"debug","message":"Executing query [m8p23qct01h0hjzmz00q]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742941056345\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:17:36.557Z"}
{"level":"debug","message":"Executing query [m8p23qd77gw27r3axzw]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T22:17:36.572Z"}
{"level":"debug","message":"Executing query [m8p23qdegpxfb48y4to]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941056345\"]","timestamp":"2025-03-25T22:17:36.578Z"}
{"level":"debug","message":"Executing query [m8p23qdh3w4ihskbpvw]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",6]","timestamp":"2025-03-25T22:17:36.581Z"}
{"level":"debug","message":"Executing query [m8p23qdmeahm90xjqbe]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T22:17:36.586Z"}
{"level":"debug","message":"Executing query [m8p23qdqe8v9p1v8qz]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T22:17:36.590Z"}
{"level":"debug","message":"Executing query [m8p23qdui39kvh7kjo]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T22:17:36.594Z"}
{"level":"debug","message":"Executing query [m8p23qdxm54vou4z06f]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T22:17:36.597Z"}
{"level":"debug","message":"Executing query [m8p23qe1zbjy8wjvyc]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T22:17:36.601Z"}
{"level":"debug","message":"Executing query [m8p23qe52zyo3ovnuli]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T22:17:36.605Z"}
{"level":"debug","message":"Executing query [m8p23qe7t64ufqvx4z]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:17:36.607Z"}
{"level":"debug","message":"Executing query [m8p23qeasitpjwijene]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:17:36.610Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:17:36.612Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:36.418Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T22:17:36.516Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:36.670Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T22:17:36.694Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:36.698Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:17:36.755Z"}
{"level":"debug","message":"Executing query [m8p23qik439wag5mfuu]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T22:17:36.764Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:36.702Z"}
{"level":"debug","message":"Executing query [m8p23qiigv2ggk7fy5k]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:17:36.762Z"}
{"level":"debug","message":"Executing query [m8p23qirt0zkdvnooh]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T22:17:36.771Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p23qirt0zkdvnooh]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T22:17:36.779Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:17:36.781Z"}
{"level":"debug","message":"Executing query [m8p23qhwmjy7gik5ca]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:17:36.740Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:17:36.822Z"}
{"level":"debug","message":"Executing query [m8p23qk8684xephcztl]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:17:36.824Z"}
{"level":"debug","message":"Executing query [m8p23qked7r6njv31eu]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:17:36.830Z"}
{"level":"debug","message":"Executing query [m8p23qkglbjqpg07fd]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742941056761\"]","timestamp":"2025-03-25T22:17:36.832Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:17:36.836Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T22:17:36.843Z"}
{"level":"debug","message":"Executing query [m8p23qks08m4l7ph1bv9]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T22:17:36.844Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p23qkglbjqpg07fd]","params":"[\"TEST-DOSAJE-1742941056761\"]","query":"DELETE FROM Dosaje WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:17:36.837Z"}
{"level":"debug","message":"Executing query [m8p23qkrie6vzl3dc9]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742941056761\"]","timestamp":"2025-03-25T22:17:36.843Z"}
{"level":"debug","message":"Executing query [m8p23qkuo8n9rcgnju]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T22:17:36.846Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p23qkrie6vzl3dc9]","params":"[\"TEST-DOSAJE-1742941056761\"]","query":"SELECT * FROM Dosaje WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:17:36.845Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T22:17:36.849Z"}
{"level":"debug","message":"Executing query [m8p23qkyqefiaenwi7a]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:17:36.850Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T22:17:36.854Z"}
{"level":"debug","message":"Executing query [m8p23ql3hm2ybarxgb]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742941056855\",\"TEST-SP-OFICIO-1742941056855\",7108,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T22:17:36.855Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p23ql3hm2ybarxgb]","params":"[1,\"TEST-SP-DOSAJE-1742941056855\",\"TEST-SP-OFICIO-1742941056855\",7108,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","query":"CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:17:36.869Z"}
{"level":"debug","message":"Executing query [m8p23qljn45gnxoy3o]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:17:36.871Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:17:36.873Z"}
{"level":"debug","message":"Executing query [m8p23qmyl35irzvf0z]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T22:17:36.922Z"}
{"level":"debug","message":"Executing query [m8p23qn5bnwa9t7hf3]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T22:17:36.929Z"}
{"level":"debug","message":"Executing query [m8p23qn8qjwlkk16qvm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:17:36.932Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:36.989Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T22:17:37.038Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T22:17:37.039Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T22:17:37.039Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T22:17:37.040Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T22:17:37.040Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T22:17:37.040Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Executing query [m8p23qp1ethbb4k4tge]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:17:36.997Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:17:37.047Z"}
{"level":"debug","message":"Executing query [m8p23qqjc7wjdemsecb]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:17:37.051Z"}
{"level":"debug","message":"Executing query [m8p23qqoo1rffaj8bq9]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742941056992\"]","timestamp":"2025-03-25T22:17:37.056Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p23qqoo1rffaj8bq9]","params":"[\"TEST-FORENSE-1742941056992\"]","query":"DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:17:37.061Z"}
{"level":"debug","message":"Executing query [m8p23qr0y4ju7x30fxl]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742941056992\"]","timestamp":"2025-03-25T22:17:37.068Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p23qr0y4ju7x30fxl]","params":"[\"TEST-FORENSE-1742941056992\"]","query":"SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:17:37.071Z"}
{"level":"debug","message":"Executing query [m8p23qr7r86wdofdhys]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742941057075\",\"TEST-SP-OFI-FORENSE-1742941057075\",2054,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T22:17:37.075Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p23qr7r86wdofdhys]","params":"[1,\"TEST-SP-FORENSE-1742941057075\",\"TEST-SP-OFI-FORENSE-1742941057075\",2054,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","query":"CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:17:37.080Z"}
{"level":"debug","message":"Executing query [m8p23qrdq15rqeaubw]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:17:37.081Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:17:37.084Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:37.278Z"}
{"level":"debug","message":"Executing query [m8p23qwz14vk8f19xyc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:17:37.284Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:17:37.313Z"}
{"level":"debug","message":"Executing query [m8p23qxxewyyn7vd66s]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:17:37.317Z"}
{"level":"debug","message":"Executing query [m8p23qxzq13eqyuy2]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T22:17:37.319Z"}
{"level":"debug","message":"Executing query [m8p23qy1u49wx4j9p]: INSERT INTO AreaEspecializada (IDArea, NombreArea, CodigoIdentificacion, TipoArea, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Área Papelera\",\"TEST-PAPELERA\",\"PRUEBA\",1]","timestamp":"2025-03-25T22:17:37.321Z"}
{"level":"debug","message":"Executing query [m8p23qy5lpib57ysk4i]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T22:17:37.326Z"}
{"level":"debug","message":"Executing query [m8p23qygvz4t6j75scn]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","timestamp":"2025-03-25T22:17:37.336Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'NivelAcceso' in 'field list'","level":"error","message":"Database query error [m8p23qygvz4t6j75scn]","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","query":"INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:17:37.339Z"}
{"level":"error","message":"Error en la configuración de las pruebas de papelera: Unknown column 'NivelAcceso' in 'field list'","timestamp":"2025-03-25T22:17:37.340Z"}
{"level":"debug","message":"Executing query [m8p23qyn3sdi0rhaxkr]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:17:37.343Z"}
{"level":"debug","message":"Executing query [m8p23qyqivy5lm07tth]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:17:37.346Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p23qyqivy5lm07tth]","params":"[\"TESTPAP123\"]","query":"DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","timestamp":"2025-03-25T22:17:37.347Z"}
{"level":"error","message":"Error al eliminar usuario TESTPAP123: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:17:37.348Z"}
{"level":"debug","message":"Executing query [m8p23qysiz5ils5329n]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:17:37.348Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:17:37.350Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:37.338Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:37.527Z"}
{"level":"debug","message":"Executing query [m8p23r4kwtg61tccitp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:17:37.556Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:17:37.587Z"}
{"level":"debug","message":"Executing query [m8p23r5hu1zny5fxpbh]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:17:37.589Z"}
{"level":"debug","message":"Executing query [m8p23r5keqt0k5rgy58]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742941057554\"]","timestamp":"2025-03-25T22:17:37.592Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p23r5keqt0k5rgy58]","params":"[\"TEST-QUIMICA-1742941057554\"]","query":"DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:17:37.596Z"}
{"level":"debug","message":"Executing query [m8p23r5tim5itrjm0wl]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742941057554\"]","timestamp":"2025-03-25T22:17:37.601Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p23r5tim5itrjm0wl]","params":"[\"TEST-QUIMICA-1742941057554\"]","query":"SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:17:37.604Z"}
{"level":"debug","message":"Executing query [m8p23r5ygk0rxvrgrje]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:17:37.606Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:17:37.607Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:37.606Z"}
{"level":"debug","message":"Executing query [m8p23r799fjrp1z3sjw]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:17:37.653Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:17:37.704Z"}
{"level":"debug","message":"Executing query [m8p23r8rdkjqzk6mi6]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:17:37.707Z"}
{"level":"debug","message":"Executing query [m8p23r8vephz1jcwbem]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:17:37.711Z"}
{"level":"debug","message":"Executing query [m8p23r8xcosdd45ut8]: INSERT INTO AreaEspecializada (IDArea, NombreArea, CodigoIdentificacion, TipoArea, IsActive, Descripcion) VALUES (?, ?, ?, ?, ?, ?)","params":"[999,\"Área de Prueba\",\"TEST-AREA\",\"PRUEBA\",1,\"Área creada para pruebas\"]","timestamp":"2025-03-25T22:17:37.713Z"}
{"level":"debug","message":"Executing query [m8p23r92np066k76g5o]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[999,\"Rol de Prueba\",\"Rol creado para pruebas\",1,255]","timestamp":"2025-03-25T22:17:37.718Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'NivelAcceso' in 'field list'","level":"error","message":"Database query error [m8p23r92np066k76g5o]","params":"[999,\"Rol de Prueba\",\"Rol creado para pruebas\",1,255]","query":"INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:17:37.720Z"}
{"level":"error","message":"Error en la configuración de las pruebas: Unknown column 'NivelAcceso' in 'field list'","timestamp":"2025-03-25T22:17:37.721Z"}
{"level":"debug","message":"Executing query [m8p23r9df8pes63bqtm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:17:37.729Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:17:37.732Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:37.731Z"}
{"level":"debug","message":"Executing query [m8p23ravht1f8glpqmp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:17:37.784Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:17:37.831Z"}
{"level":"debug","message":"Executing query [m8p23rcbb157x4bp0yg]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742941057782\"]","timestamp":"2025-03-25T22:17:37.836Z"}
{"level":"debug","message":"Executing query [m8p23rcf3ol6fwawjlq]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742941057782\",true]","timestamp":"2025-03-25T22:17:37.839Z"}
{"level":"debug","message":"Executing query [m8p23rcmzy0ctpjjp5]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[1]","timestamp":"2025-03-25T22:17:37.846Z"}
{"level":"debug","message":"Executing query [m8p23rcs99mz0lmm5h]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742941057782\"]","timestamp":"2025-03-25T22:17:37.852Z"}
{"level":"debug","message":"Executing query [m8p23rcvvc1hrkhd9p]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",1]","timestamp":"2025-03-25T22:17:37.855Z"}
{"level":"debug","message":"Executing query [m8p23rczqux5lojbco]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[1]","timestamp":"2025-03-25T22:17:37.859Z"}
{"level":"debug","message":"Executing query [m8p23rd25cgpzhdl0qk]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[1]","timestamp":"2025-03-25T22:17:37.862Z"}
{"level":"debug","message":"Executing query [m8p23rd6y7h1kaqnjwh]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[1]","timestamp":"2025-03-25T22:17:37.866Z"}
{"level":"debug","message":"Executing query [m8p23rd9cawp42vclz5]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[1]","timestamp":"2025-03-25T22:17:37.869Z"}
{"level":"debug","message":"Executing query [m8p23rdck8fo0b8v8kb]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[1]","timestamp":"2025-03-25T22:17:37.872Z"}
{"level":"debug","message":"Executing query [m8p23rdgm4n3xfhlxro]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[1]","timestamp":"2025-03-25T22:17:37.876Z"}
{"level":"debug","message":"Executing query [m8p23rdjek4jtlci5ok]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:17:37.879Z"}
{"level":"debug","message":"Executing query [m8p23rdl6yae0gx6gg3]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:17:37.881Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:17:37.884Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:37.889Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:37.897Z"}
{"level":"debug","message":"Executing query [m8p23re3drc7x2qn8m]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:17:37.900Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:17:37.931Z"}
{"level":"debug","message":"Executing query [m8p23rf1ku7x31sqmr]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:17:37.933Z"}
{"level":"debug","message":"Executing query [m8p23rf49vztb3dxhx]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:17:37.936Z"}
{"level":"debug","message":"Executing query [m8p23rf6kj8smhmhqd]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[999,\"Rol de Prueba\",\"Rol creado para pruebas\",1,255]","timestamp":"2025-03-25T22:17:37.938Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'NivelAcceso' in 'field list'","level":"error","message":"Database query error [m8p23rf6kj8smhmhqd]","params":"[999,\"Rol de Prueba\",\"Rol creado para pruebas\",1,255]","query":"INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:17:37.942Z"}
{"level":"error","message":"Error en la configuración de las pruebas: Unknown column 'NivelAcceso' in 'field list'","timestamp":"2025-03-25T22:17:37.942Z"}
{"level":"debug","message":"Executing query [m8p23rffcqyekw1zecf]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:17:37.947Z"}
{"level":"debug","message":"Executing query [m8p23rfh5mvycbfr7bl]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:17:37.949Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T22:17:37.952Z"}
{"level":"debug","message":"Executing query [m8p23rfk79sy4xzicel]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:17:37.952Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:17:37.955Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:38.352Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:17:38.583Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T22:17:38.596Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:17:38.774Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T22:17:38.792Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:17:38.845Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:38.675Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:17:38.904Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:17:39.002Z"}
{"level":"debug","message":"Executing query [m8p23s9sb3rysmztwl9]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T22:17:39.040Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p23s9sb3rysmztwl9]","params":"[]","query":"SELECT * FROM v_permisos_contextuales","timestamp":"2025-03-25T22:17:39.043Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:17:39.043Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:17:39.044Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:17:39.072Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:41.119Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:17:41.110Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:17:41.254Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:17:41.256Z"}
{"duration":"25ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T22:17:41.276Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:17:41.280Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T22:17:41.284Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:17:41.289Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:35.635Z"}
{"level":"debug","message":"Executing query [m8p28uuj04jp7he1o2fl]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:21:35.659Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:21:35.690Z"}
{"level":"debug","message":"Executing query [m8p28uvil9j3qyq80de]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941295658\"]","timestamp":"2025-03-25T22:21:35.694Z"}
{"level":"debug","message":"Executing query [m8p28uvnv6vezqnkb2p]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941295658\"]","timestamp":"2025-03-25T22:21:35.699Z"}
{"level":"debug","message":"Executing query [m8p28uvqre12tbhicg]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742941295658\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:21:35.702Z"}
{"level":"debug","message":"Executing query [m8p28uvyfoy232z254w]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1000]","timestamp":"2025-03-25T22:21:35.711Z"}
{"level":"debug","message":"Executing query [m8p28uw3er4npyy6zw]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941295658\"]","timestamp":"2025-03-25T22:21:35.715Z"}
{"level":"debug","message":"Executing query [m8p28uw5uj7tbwbz0k]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1000]","timestamp":"2025-03-25T22:21:35.717Z"}
{"level":"debug","message":"Executing query [m8p28uwa046q9b0z1vwa]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1000]","timestamp":"2025-03-25T22:21:35.722Z"}
{"level":"debug","message":"Executing query [m8p28uwdv54uzxzj8u]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1000]","timestamp":"2025-03-25T22:21:35.725Z"}
{"level":"debug","message":"Executing query [m8p28uwh18yow33040n]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1000]","timestamp":"2025-03-25T22:21:35.729Z"}
{"level":"debug","message":"Executing query [m8p28uwkdvbltemqwco]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1000]","timestamp":"2025-03-25T22:21:35.732Z"}
{"level":"debug","message":"Executing query [m8p28uwmz4d32kblqwn]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1000]","timestamp":"2025-03-25T22:21:35.734Z"}
{"level":"debug","message":"Executing query [m8p28uwpqefzpt7nogq]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1000]","timestamp":"2025-03-25T22:21:35.737Z"}
{"level":"debug","message":"Executing query [m8p28uwrj2hjm20x6tm]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:21:35.739Z"}
{"level":"debug","message":"Executing query [m8p28uwuf1715c9rwqm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:21:35.742Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:21:35.744Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:21:35.852Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:21:35.854Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:21:35.856Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:21:35.858Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:21:35.861Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:21:35.862Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:21:35.867Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:21:35.871Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:21:35.873Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:21:35.874Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:21:35.876Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T22:21:35.877Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:36.085Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:37.235Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:21:37.403Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T22:21:37.410Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:21:37.474Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T22:21:37.487Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:21:37.537Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:38.260Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:38.503Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:21:38.520Z"}
{"level":"debug","message":"Executing query [m8p28x22mqziorhpve]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T22:21:38.522Z"}
{"level":"debug","message":"Executing query [m8p28x23fvge4tkqfin]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T22:21:38.524Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p28x23fvge4tkqfin]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T22:21:38.525Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:21:38.527Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:38.646Z"}
{"level":"debug","message":"Executing query [m8p28x5q9ujgytdpxqt]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:21:38.654Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:21:38.667Z"}
{"level":"debug","message":"Executing query [m8p28x654k8pkxoadl]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:21:38.669Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T22:21:38.671Z"}
{"level":"debug","message":"Executing query [m8p28x68bdlld6qyzff]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T22:21:38.672Z"}
{"level":"debug","message":"Executing query [m8p28x69hayuf2yh9zr]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T22:21:38.673Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T22:21:38.674Z"}
{"level":"debug","message":"Executing query [m8p28x6btbqfzrq2p7j]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:21:38.675Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T22:21:38.675Z"}
{"level":"debug","message":"Executing query [m8p28x6gib878szp8om]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T22:21:38.680Z"}
{"level":"debug","message":"Executing query [m8p28x6j2v0iu1pkc0y]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T22:21:38.683Z"}
{"level":"debug","message":"Executing query [m8p28x6md6wsr043pn7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:21:38.686Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:40.563Z"}
{"duration":"8ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T22:21:40.632Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T22:21:40.636Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:21:40.645Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:21:40.647Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T22:21:40.758Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T22:21:40.875Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:41.025Z"}
{"level":"debug","message":"Executing query [m8p28yzofdqwjf43i3f]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:21:41.028Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:21:41.039Z"}
{"level":"debug","message":"Executing query [m8p28z01n0tps0sy3jc]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:21:41.041Z"}
{"level":"debug","message":"Executing query [m8p28z034jalvmz51se]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742941301027\"]","timestamp":"2025-03-25T22:21:41.043Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p28z034jalvmz51se]","params":"[\"TEST-DOSAJE-1742941301027\"]","query":"DELETE FROM Dosaje WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:21:41.044Z"}
{"level":"debug","message":"Executing query [m8p28z09u4fi7kdyqa]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742941301027\"]","timestamp":"2025-03-25T22:21:41.049Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p28z09u4fi7kdyqa]","params":"[\"TEST-DOSAJE-1742941301027\"]","query":"SELECT * FROM Dosaje WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:21:41.050Z"}
{"level":"debug","message":"Executing query [m8p28z0deixvdvox8v]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742941301053\",\"TEST-SP-OFICIO-1742941301053\",2571,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T22:21:41.053Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p28z0deixvdvox8v]","params":"[1,\"TEST-SP-DOSAJE-1742941301053\",\"TEST-SP-OFICIO-1742941301053\",2571,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","query":"CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:21:41.055Z"}
{"level":"debug","message":"Executing query [m8p28z0gkapcmtint5q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:21:41.056Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:21:41.057Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:41.274Z"}
{"level":"debug","message":"Executing query [m8p28z6lu67iix6uth]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:21:41.278Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:21:41.292Z"}
{"level":"debug","message":"Executing query [m8p28z71wy738vqmolo]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:21:41.293Z"}
{"level":"debug","message":"Executing query [m8p28z73erdn7429z6m]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742941301277\"]","timestamp":"2025-03-25T22:21:41.295Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p28z73erdn7429z6m]","params":"[\"TEST-FORENSE-1742941301277\"]","query":"DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:21:41.298Z"}
{"level":"debug","message":"Executing query [m8p28z79m4j9qr715uk]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742941301277\"]","timestamp":"2025-03-25T22:21:41.301Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p28z79m4j9qr715uk]","params":"[\"TEST-FORENSE-1742941301277\"]","query":"SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:21:41.302Z"}
{"level":"debug","message":"Executing query [m8p28z7dced7dxctdxj]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742941301305\",\"TEST-SP-OFI-FORENSE-1742941301305\",3599,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T22:21:41.305Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p28z7dced7dxctdxj]","params":"[1,\"TEST-SP-FORENSE-1742941301305\",\"TEST-SP-OFI-FORENSE-1742941301305\",3599,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","query":"CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:21:41.307Z"}
{"level":"debug","message":"Executing query [m8p28z7ho32cjtv4u7h]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:21:41.309Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:21:41.311Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:42.349Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:21:42.410Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:21:42.412Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T22:21:42.526Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T22:21:42.527Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T22:21:42.527Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T22:21:42.528Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T22:21:42.529Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T22:21:42.529Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:42.948Z"}
{"level":"debug","message":"Executing query [m8p290h3q0twqsttd5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:21:42.951Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:21:42.966Z"}
{"level":"debug","message":"Executing query [m8p290hk4rdhweuxejb]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742941302950\"]","timestamp":"2025-03-25T22:21:42.968Z"}
{"level":"debug","message":"Executing query [m8p290hmfb97dkft2dj]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742941302950\",true]","timestamp":"2025-03-25T22:21:42.970Z"}
{"level":"debug","message":"Executing query [m8p290hs50zj1gdeq1a]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[2]","timestamp":"2025-03-25T22:21:42.976Z"}
{"level":"debug","message":"Executing query [m8p290hvcsisrwyq6m]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742941302950\"]","timestamp":"2025-03-25T22:21:42.979Z"}
{"level":"debug","message":"Executing query [m8p290hx00n8u6mu9oa9]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",2]","timestamp":"2025-03-25T22:21:42.981Z"}
{"level":"debug","message":"Executing query [m8p290i0nqca7cagbu]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[2]","timestamp":"2025-03-25T22:21:42.984Z"}
{"level":"debug","message":"Executing query [m8p290i233apu1vbpaa]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[2]","timestamp":"2025-03-25T22:21:42.986Z"}
{"level":"debug","message":"Executing query [m8p290i4g2k3uvc5b3]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[2]","timestamp":"2025-03-25T22:21:42.988Z"}
{"level":"debug","message":"Executing query [m8p290i6pd5qr8p92v]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[2]","timestamp":"2025-03-25T22:21:42.990Z"}
{"level":"debug","message":"Executing query [m8p290i86xgvukn0gih]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[2]","timestamp":"2025-03-25T22:21:42.992Z"}
{"level":"debug","message":"Executing query [m8p290ibzkcs0y5xuxk]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[2]","timestamp":"2025-03-25T22:21:42.995Z"}
{"level":"debug","message":"Executing query [m8p290id5q3ku93d8c6]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:21:42.997Z"}
{"level":"debug","message":"Executing query [m8p290ifxurc4gns4l]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:21:42.999Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:21:43.000Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:43.203Z"}
{"level":"debug","message":"Executing query [m8p290o6v5tyltg2frm]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:21:43.206Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:21:43.217Z"}
{"level":"debug","message":"Executing query [m8p290oige7y3kgup46]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:21:43.218Z"}
{"level":"debug","message":"Executing query [m8p290okwdzn0te8ulf]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T22:21:43.220Z"}
{"level":"debug","message":"Executing query [m8p290olkbjjio9dbj]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T22:21:43.221Z"}
{"level":"debug","message":"Executing query [m8p290on7wwyxijhox6]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","timestamp":"2025-03-25T22:21:43.223Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'NivelAcceso' in 'field list'","level":"error","message":"Database query error [m8p290on7wwyxijhox6]","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","query":"INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:21:43.224Z"}
{"level":"error","message":"Error en la configuración de las pruebas de papelera: Unknown column 'NivelAcceso' in 'field list'","timestamp":"2025-03-25T22:21:43.225Z"}
{"level":"debug","message":"Executing query [m8p290otc10zd6kf2wb]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:21:43.229Z"}
{"level":"debug","message":"Executing query [m8p290oub36mixselll]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:21:43.230Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p290oub36mixselll]","params":"[\"TESTPAP123\"]","query":"DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","timestamp":"2025-03-25T22:21:43.233Z"}
{"level":"error","message":"Error al eliminar usuario TESTPAP123: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:21:43.233Z"}
{"level":"debug","message":"Executing query [m8p290oyyx72217xw8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:21:43.234Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:21:43.235Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:43.353Z"}
{"level":"debug","message":"Executing query [m8p290sfciqjgntgg2o]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:21:43.359Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:21:43.369Z"}
{"level":"debug","message":"Executing query [m8p290sqg24ees9usug]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:21:43.370Z"}
{"level":"debug","message":"Executing query [m8p290srro2zl91ss9]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:21:43.371Z"}
{"level":"debug","message":"Executing query [m8p290st8mbrblvkrpk]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, Permisos) VALUES (?, ?, ?, ?)","params":"[999,\"Rol de Prueba\",\"Rol creado para pruebas\",255]","timestamp":"2025-03-25T22:21:43.373Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T22:21:43.380Z"}
{"level":"debug","message":"Executing query [m8p290t15fbi2tk5lhh]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T22:21:43.381Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p290t15fbi2tk5lhh]","params":"[999,999]","query":"DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","timestamp":"2025-03-25T22:21:43.383Z"}
{"level":"debug","message":"Error al limpiar datos previos: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:21:43.384Z"}
{"level":"debug","message":"Executing query [m8p290t4mkp8w7tc34]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T22:21:43.384Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p290t4mkp8w7tc34]","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","query":"INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:21:43.385Z"}
{"level":"error","message":"Error al crear permiso contextual: Table 'oficri_sistema.permisocontextual' doesn't exist","timestamp":"2025-03-25T22:21:43.386Z"}
{"level":"debug","message":"Executing query [m8p290t9xxqcqerioe]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[null]","timestamp":"2025-03-25T22:21:43.389Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p290t9xxqcqerioe]","params":"[null]","query":"SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","timestamp":"2025-03-25T22:21:43.390Z"}
{"level":"error","message":"Error al obtener permiso contextual desde vista: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:21:43.390Z"}
{"level":"debug","message":"Executing query [m8p290tcwdxitgb1t5]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:21:43.392Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:21:43.394Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:43.660Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:44.118Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:21:44.187Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:21:44.240Z"}
{"level":"debug","message":"Executing query [m8p291iagonrdq2y3c]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T22:21:44.291Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p291iagonrdq2y3c]","params":"[]","query":"SELECT * FROM v_permisos_contextuales","timestamp":"2025-03-25T22:21:44.293Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:21:44.294Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:21:44.295Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:21:44.332Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:44.557Z"}
{"level":"debug","message":"Executing query [m8p291psp68gcfqdv6c]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:21:44.560Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:21:44.571Z"}
{"level":"debug","message":"Executing query [m8p291q5oa633rlruha]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:21:44.573Z"}
{"level":"debug","message":"Executing query [m8p291q7k2ovahisqfg]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742941304559\"]","timestamp":"2025-03-25T22:21:44.575Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p291q7k2ovahisqfg]","params":"[\"TEST-QUIMICA-1742941304559\"]","query":"DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:21:44.577Z"}
{"level":"debug","message":"Executing query [m8p291qcygfy5q695n8]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742941304559\"]","timestamp":"2025-03-25T22:21:44.580Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p291qcygfy5q695n8]","params":"[\"TEST-QUIMICA-1742941304559\"]","query":"SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:21:44.582Z"}
{"level":"debug","message":"Executing query [m8p291qgrv2dyipr2s]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:21:44.584Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:21:44.590Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:46.747Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:21:46.751Z"}
{"level":"debug","message":"Executing query [m8p293epusggu7eb54]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:21:46.753Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:21:46.764Z"}
{"level":"debug","message":"Executing query [m8p293f10jho9bl8re3]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:21:46.765Z"}
{"level":"debug","message":"Executing query [m8p293f3kwdctmajhy]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:21:46.767Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T22:21:46.769Z"}
{"level":"debug","message":"Executing query [m8p293f6j1dhfzjcjso]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:21:46.770Z"}
{"level":"debug","message":"Executing query [m8p293f713s7kgw5ppmn]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:21:46.771Z"}
{"level":"debug","message":"Executing query [m8p293f8qu8o8arzkgi]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:21:46.773Z"}
{"level":"debug","message":"Executing query [m8p293f90imwsc7j48lt]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T22:21:46.773Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'Grado' in 'field list'","level":"error","message":"Database query error [m8p293f90imwsc7j48lt]","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:21:46.774Z"}
{"level":"error","message":"Error al crear usuario: Unknown column 'Grado' in 'field list'","timestamp":"2025-03-25T22:21:46.775Z"}
{"level":"debug","message":"Executing query [m8p293fer8i64ndsbxc]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:21:46.778Z"}
{"level":"error","message":"Error al obtener usuario por CIP: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveLength\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected length: \u001b[32m1\u001b[39m\nReceived length: \u001b[31m0\u001b[39m\nReceived array:  \u001b[31m[]\u001b[39m","timestamp":"2025-03-25T22:21:46.780Z"}
{"level":"debug","message":"Executing query [m8p293fjdkt1mo7of7f]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:21:46.783Z"}
{"level":"debug","message":"Executing query [m8p293fk8l5wu3noqu9]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:21:46.784Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T22:21:46.785Z"}
{"level":"debug","message":"Executing query [m8p293flxffctj8qand]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:21:46.785Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:21:46.786Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:10.001Z"}
{"level":"debug","message":"Executing query [m8p2avnqp8tc6gok4c]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:23:10.022Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:23:10.061Z"}
{"level":"debug","message":"Executing query [m8p2avowwzhqvdxx07]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941390021\"]","timestamp":"2025-03-25T22:23:10.064Z"}
{"level":"debug","message":"Executing query [m8p2avp0bvxbirx146i]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941390021\"]","timestamp":"2025-03-25T22:23:10.068Z"}
{"level":"debug","message":"Executing query [m8p2avp25uq4cb5o13l]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742941390021\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:23:10.071Z"}
{"level":"debug","message":"Executing query [m8p2avp95arp4ejjtjv]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1001]","timestamp":"2025-03-25T22:23:10.077Z"}
{"level":"debug","message":"Executing query [m8p2avpd4zic13ud2kp]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941390021\"]","timestamp":"2025-03-25T22:23:10.081Z"}
{"level":"debug","message":"Executing query [m8p2avpfg1ddg996k4p]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1001]","timestamp":"2025-03-25T22:23:10.083Z"}
{"level":"debug","message":"Executing query [m8p2avpijicotj2c7e]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1001]","timestamp":"2025-03-25T22:23:10.086Z"}
{"level":"debug","message":"Executing query [m8p2avpl9w9fb23fz6b]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1001]","timestamp":"2025-03-25T22:23:10.089Z"}
{"level":"debug","message":"Executing query [m8p2avppqo6d7fc8eob]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1001]","timestamp":"2025-03-25T22:23:10.093Z"}
{"level":"debug","message":"Executing query [m8p2avptk7vjujjsv6]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1001]","timestamp":"2025-03-25T22:23:10.097Z"}
{"level":"debug","message":"Executing query [m8p2avpuubx1gswsbgd]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1001]","timestamp":"2025-03-25T22:23:10.098Z"}
{"level":"debug","message":"Executing query [m8p2avpydj0gq33ycz]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1001]","timestamp":"2025-03-25T22:23:10.102Z"}
{"level":"debug","message":"Executing query [m8p2avq0f4711dinnad]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:23:10.104Z"}
{"level":"debug","message":"Executing query [m8p2avq2520q3g6fwsy]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:23:10.106Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:23:10.107Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:23:10.213Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:23:10.216Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:23:10.218Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:23:10.221Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:23:10.223Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:23:10.228Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:23:10.230Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:23:10.233Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:23:10.235Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:23:10.236Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:23:10.237Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T22:23:10.238Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:10.448Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:11.536Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:23:11.698Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T22:23:11.707Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:23:11.769Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T22:23:11.783Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:23:11.832Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:12.568Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:12.802Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:23:12.819Z"}
{"level":"debug","message":"Executing query [m8p2axthrcbf49njdb]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T22:23:12.821Z"}
{"level":"debug","message":"Executing query [m8p2axtjpm50o0ogzws]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T22:23:12.823Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p2axtjpm50o0ogzws]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T22:23:12.827Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:23:12.828Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:12.946Z"}
{"level":"debug","message":"Executing query [m8p2axx6o93sxamdnq]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:23:12.954Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:23:12.969Z"}
{"level":"debug","message":"Executing query [m8p2axxne4c7sib1jcr]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:23:12.971Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T22:23:12.973Z"}
{"level":"debug","message":"Executing query [m8p2axxpl7z3sqofwl]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T22:23:12.973Z"}
{"level":"debug","message":"Executing query [m8p2axxrqc1y96zei8]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T22:23:12.975Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T22:23:12.977Z"}
{"level":"debug","message":"Executing query [m8p2axxuufi5x742ps]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:23:12.978Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T22:23:12.980Z"}
{"level":"debug","message":"Executing query [m8p2axy2mbna40a501d]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T22:23:12.986Z"}
{"level":"debug","message":"Executing query [m8p2axyd54f5g7n81yx]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T22:23:12.997Z"}
{"level":"debug","message":"Executing query [m8p2axyhhz5eif0cw49]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:23:13.001Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:14.891Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T22:23:14.968Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T22:23:14.972Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:23:14.980Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:23:14.982Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T22:23:15.090Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T22:23:15.203Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:15.340Z"}
{"level":"debug","message":"Executing query [m8p2azrjeor97q8blt9]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:23:15.343Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:23:15.354Z"}
{"level":"debug","message":"Executing query [m8p2azrw9d1aj4pg4gq]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:23:15.356Z"}
{"level":"debug","message":"Executing query [m8p2azryl5gcsbj8vag]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742941395342\"]","timestamp":"2025-03-25T22:23:15.358Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2azryl5gcsbj8vag]","params":"[\"TEST-DOSAJE-1742941395342\"]","query":"DELETE FROM Dosaje WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:23:15.361Z"}
{"level":"debug","message":"Executing query [m8p2azs4q1ltesu5vtf]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742941395342\"]","timestamp":"2025-03-25T22:23:15.364Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2azs4q1ltesu5vtf]","params":"[\"TEST-DOSAJE-1742941395342\"]","query":"SELECT * FROM Dosaje WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:23:15.367Z"}
{"level":"debug","message":"Executing query [m8p2azs9t0pa3i4ttrc]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742941395369\",\"TEST-SP-OFICIO-1742941395369\",3384,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T22:23:15.369Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2azs9t0pa3i4ttrc]","params":"[1,\"TEST-SP-DOSAJE-1742941395369\",\"TEST-SP-OFICIO-1742941395369\",3384,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","query":"CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:23:15.375Z"}
{"level":"debug","message":"Executing query [m8p2azsgqqxye3oap6]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:23:15.376Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:23:15.377Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:15.593Z"}
{"level":"debug","message":"Executing query [m8p2azyk036t24g6ofue]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:23:15.596Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:23:15.606Z"}
{"level":"debug","message":"Executing query [m8p2azywbjvs85g8o74]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:23:15.608Z"}
{"level":"debug","message":"Executing query [m8p2azyys4tf6n5veds]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742941395595\"]","timestamp":"2025-03-25T22:23:15.610Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2azyys4tf6n5veds]","params":"[\"TEST-FORENSE-1742941395595\"]","query":"DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:23:15.613Z"}
{"level":"debug","message":"Executing query [m8p2azz4r7paqbaemld]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742941395595\"]","timestamp":"2025-03-25T22:23:15.616Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2azz4r7paqbaemld]","params":"[\"TEST-FORENSE-1742941395595\"]","query":"SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:23:15.618Z"}
{"level":"debug","message":"Executing query [m8p2azz8l6e2o1uwjvc]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742941395620\",\"TEST-SP-OFI-FORENSE-1742941395620\",1067,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T22:23:15.620Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2azz8l6e2o1uwjvc]","params":"[1,\"TEST-SP-FORENSE-1742941395620\",\"TEST-SP-OFI-FORENSE-1742941395620\",1067,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","query":"CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:23:15.623Z"}
{"level":"debug","message":"Executing query [m8p2azzch2mf03bsuxg]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:23:15.624Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:23:15.625Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:16.613Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:23:16.667Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:23:16.669Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T22:23:16.789Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T22:23:16.791Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T22:23:16.791Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T22:23:16.792Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T22:23:16.793Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T22:23:16.793Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:17.202Z"}
{"level":"debug","message":"Executing query [m8p2b1791v18xp85693i]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:23:17.206Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:23:17.216Z"}
{"level":"debug","message":"Executing query [m8p2b17mdlzusvwcew4]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742941397204\"]","timestamp":"2025-03-25T22:23:17.218Z"}
{"level":"debug","message":"Executing query [m8p2b17op1ge9aas0z]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742941397204\",true]","timestamp":"2025-03-25T22:23:17.220Z"}
{"level":"debug","message":"Executing query [m8p2b17ul6zvqwo2iv]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T22:23:17.226Z"}
{"level":"debug","message":"Executing query [m8p2b17xsaxjzk7jfw]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742941397204\"]","timestamp":"2025-03-25T22:23:17.229Z"}
{"level":"debug","message":"Executing query [m8p2b17zqdmf9ov1io]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",3]","timestamp":"2025-03-25T22:23:17.231Z"}
{"level":"debug","message":"Executing query [m8p2b182fc2fsq7a8ft]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T22:23:17.234Z"}
{"level":"debug","message":"Executing query [m8p2b18429pzt6pyxwm]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T22:23:17.236Z"}
{"level":"debug","message":"Executing query [m8p2b187o3vode9nom]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T22:23:17.239Z"}
{"level":"debug","message":"Executing query [m8p2b189mw52ougskco]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T22:23:17.241Z"}
{"level":"debug","message":"Executing query [m8p2b18asi4svpf99o]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T22:23:17.242Z"}
{"level":"debug","message":"Executing query [m8p2b18drw69kd7xc2h]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T22:23:17.245Z"}
{"level":"debug","message":"Executing query [m8p2b18f2j8xlr0gth9]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:23:17.247Z"}
{"level":"debug","message":"Executing query [m8p2b18hljvuzrh3sg]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:23:17.249Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:23:17.250Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:17.442Z"}
{"level":"debug","message":"Executing query [m8p2b1dx7a95sqhmax8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:23:17.445Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:23:17.460Z"}
{"level":"debug","message":"Executing query [m8p2b1edvhnw7tidosi]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:23:17.461Z"}
{"level":"debug","message":"Executing query [m8p2b1efu61bqirb40e]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T22:23:17.463Z"}
{"level":"debug","message":"Executing query [m8p2b1egc31jdx1muap]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T22:23:17.464Z"}
{"level":"debug","message":"Executing query [m8p2b1ehx8ydb50uxu]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","timestamp":"2025-03-25T22:23:17.465Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'NivelAcceso' in 'field list'","level":"error","message":"Database query error [m8p2b1ehx8ydb50uxu]","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","query":"INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:23:17.466Z"}
{"level":"error","message":"Error en la configuración de las pruebas de papelera: Unknown column 'NivelAcceso' in 'field list'","timestamp":"2025-03-25T22:23:17.467Z"}
{"level":"debug","message":"Executing query [m8p2b1emsqth46g1qsj]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:23:17.471Z"}
{"level":"debug","message":"Executing query [m8p2b1eonw2wifkwgyn]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:23:17.472Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p2b1eonw2wifkwgyn]","params":"[\"TESTPAP123\"]","query":"DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","timestamp":"2025-03-25T22:23:17.474Z"}
{"level":"error","message":"Error al eliminar usuario TESTPAP123: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:23:17.474Z"}
{"level":"debug","message":"Executing query [m8p2b1erb2m4i001h3]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:23:17.475Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:23:17.476Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:17.605Z"}
{"level":"debug","message":"Executing query [m8p2b1ife034fcb5dnl]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:23:17.608Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:23:17.619Z"}
{"level":"debug","message":"Executing query [m8p2b1isl5rikdn5gy]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:23:17.620Z"}
{"level":"debug","message":"Executing query [m8p2b1it5111zdyerux]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:23:17.622Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T22:23:17.623Z"}
{"level":"debug","message":"Executing query [m8p2b1iwy2vv88xbxe]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T22:23:17.624Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p2b1iwy2vv88xbxe]","params":"[999,999]","query":"DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","timestamp":"2025-03-25T22:23:17.625Z"}
{"level":"debug","message":"Error al limpiar datos previos: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:23:17.625Z"}
{"level":"debug","message":"Executing query [m8p2b1iyysjeavcvkdn]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T22:23:17.626Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p2b1iyysjeavcvkdn]","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","query":"INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:23:17.627Z"}
{"level":"error","message":"Error al crear permiso contextual: Table 'oficri_sistema.permisocontextual' doesn't exist","timestamp":"2025-03-25T22:23:17.628Z"}
{"level":"debug","message":"Executing query [m8p2b1j3p8t7s0tep7m]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[null]","timestamp":"2025-03-25T22:23:17.632Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p2b1j3p8t7s0tep7m]","params":"[null]","query":"SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","timestamp":"2025-03-25T22:23:17.633Z"}
{"level":"error","message":"Error al obtener permiso contextual desde vista: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:23:17.633Z"}
{"level":"debug","message":"Executing query [m8p2b1j7rpkpa9ptlai]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:23:17.635Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:23:17.637Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:17.840Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:18.251Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:23:18.318Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:23:18.376Z"}
{"level":"debug","message":"Executing query [m8p2b24lft2cxrgkoa]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T22:23:18.405Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p2b24lft2cxrgkoa]","params":"[]","query":"SELECT * FROM v_permisos_contextuales","timestamp":"2025-03-25T22:23:18.418Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:23:18.419Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:23:18.419Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:23:18.453Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:18.673Z"}
{"level":"debug","message":"Executing query [m8p2b2c4lm9n1uy2zhl]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:23:18.676Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:23:18.688Z"}
{"level":"debug","message":"Executing query [m8p2b2chj470t750htn]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:23:18.689Z"}
{"level":"debug","message":"Executing query [m8p2b2cjsocez392nyh]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742941398675\"]","timestamp":"2025-03-25T22:23:18.691Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2b2cjsocez392nyh]","params":"[\"TEST-QUIMICA-1742941398675\"]","query":"DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:23:18.693Z"}
{"level":"debug","message":"Executing query [m8p2b2cop1u51fghyo]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742941398675\"]","timestamp":"2025-03-25T22:23:18.696Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2b2cop1u51fghyo]","params":"[\"TEST-QUIMICA-1742941398675\"]","query":"SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:23:18.698Z"}
{"level":"debug","message":"Executing query [m8p2b2ctsohir5noxye]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:23:18.701Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:23:18.702Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:20.979Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:23:20.982Z"}
{"level":"debug","message":"Executing query [m8p2b448rcmpkk13cp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:23:20.984Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:23:20.998Z"}
{"level":"debug","message":"Executing query [m8p2b44nutzcnmkmxi]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:23:20.999Z"}
{"level":"debug","message":"Executing query [m8p2b44orvvndfp6kug]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:23:21.001Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T22:23:21.001Z"}
{"level":"debug","message":"Executing query [m8p2b44qunf99cp9wni]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:23:21.002Z"}
{"level":"debug","message":"Executing query [m8p2b44q7wjcqwwj1l8]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:23:21.002Z"}
{"level":"debug","message":"Executing query [m8p2b44to2focnyeyfr]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:23:21.005Z"}
{"level":"debug","message":"Executing query [m8p2b44u1t9ycajymwb]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T22:23:21.006Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'Grado' in 'field list'","level":"error","message":"Database query error [m8p2b44u1t9ycajymwb]","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:23:21.007Z"}
{"level":"error","message":"Error al crear usuario: Unknown column 'Grado' in 'field list'","timestamp":"2025-03-25T22:23:21.008Z"}
{"level":"debug","message":"Executing query [m8p2b44y3gvhhd21sg3]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:23:21.010Z"}
{"level":"error","message":"Error al obtener usuario por CIP: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveLength\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected length: \u001b[32m1\u001b[39m\nReceived length: \u001b[31m0\u001b[39m\nReceived array:  \u001b[31m[]\u001b[39m","timestamp":"2025-03-25T22:23:21.013Z"}
{"level":"debug","message":"Executing query [m8p2b453sxr3q9pffms]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:23:21.015Z"}
{"level":"debug","message":"Executing query [m8p2b454l44wkcmmcwb]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:23:21.016Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T22:23:21.017Z"}
{"level":"debug","message":"Executing query [m8p2b456d5kn8o41z7f]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:23:21.018Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:23:21.019Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:42.039Z"}
{"level":"debug","message":"Executing query [m8p2cuofxerdzuyq9b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:24:42.063Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:24:42.105Z"}
{"level":"debug","message":"Executing query [m8p2cupnvmjoqcu8fw]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941482062\"]","timestamp":"2025-03-25T22:24:42.107Z"}
{"level":"debug","message":"Executing query [m8p2cupqr4gxw8g0rm]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941482062\"]","timestamp":"2025-03-25T22:24:42.110Z"}
{"level":"debug","message":"Executing query [m8p2cupt7nu9mdw6qkw]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742941482062\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:24:42.113Z"}
{"level":"debug","message":"Executing query [m8p2cupx1o4ram8xbyq]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1002]","timestamp":"2025-03-25T22:24:42.117Z"}
{"level":"debug","message":"Executing query [m8p2cuq0vhr2tbs14cm]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941482062\"]","timestamp":"2025-03-25T22:24:42.120Z"}
{"level":"debug","message":"Executing query [m8p2cuq29y4weudo85]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1002]","timestamp":"2025-03-25T22:24:42.122Z"}
{"level":"debug","message":"Executing query [m8p2cuq6j53u3lt3im]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1002]","timestamp":"2025-03-25T22:24:42.126Z"}
{"level":"debug","message":"Executing query [m8p2cuq76i02808zqh7]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1002]","timestamp":"2025-03-25T22:24:42.127Z"}
{"level":"debug","message":"Executing query [m8p2cuqarnj6obpm8j8]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1002]","timestamp":"2025-03-25T22:24:42.130Z"}
{"level":"debug","message":"Executing query [m8p2cuqcgi8q596xj05]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1002]","timestamp":"2025-03-25T22:24:42.133Z"}
{"level":"debug","message":"Executing query [m8p2cuqegkpqzlk18tp]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1002]","timestamp":"2025-03-25T22:24:42.134Z"}
{"level":"debug","message":"Executing query [m8p2cuqh0c2k8w5299c]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1002]","timestamp":"2025-03-25T22:24:42.137Z"}
{"level":"debug","message":"Executing query [m8p2cuqjocdz0ftz2r8]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:24:42.139Z"}
{"level":"debug","message":"Executing query [m8p2cuqk18c9y1fu0s2]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:24:42.140Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:24:42.142Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:24:42.246Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:24:42.248Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:24:42.249Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:24:42.250Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:24:42.252Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:24:42.255Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:24:42.257Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:24:42.259Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:24:42.260Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:24:42.261Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:24:42.261Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T22:24:42.262Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:42.475Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:43.450Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:24:43.598Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T22:24:43.603Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:24:43.652Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T22:24:43.662Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:24:43.700Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:44.462Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:44.603Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:24:44.616Z"}
{"level":"debug","message":"Executing query [m8p2cwne5gi2tfm4vbr]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T22:24:44.618Z"}
{"level":"debug","message":"Executing query [m8p2cwng6cfn1do0zw5]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T22:24:44.620Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p2cwng6cfn1do0zw5]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T22:24:44.622Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:24:44.623Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:44.740Z"}
{"level":"debug","message":"Executing query [m8p2cwqvcobchcs5vhh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:24:44.743Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:24:44.796Z"}
{"level":"debug","message":"Executing query [m8p2cwsdboto59p9qyt]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:24:44.797Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T22:24:44.800Z"}
{"level":"debug","message":"Executing query [m8p2cwsg0ewtltoe2wvi]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T22:24:44.800Z"}
{"level":"debug","message":"Executing query [m8p2cwsib375y0gtmkv]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T22:24:44.802Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T22:24:44.803Z"}
{"level":"debug","message":"Executing query [m8p2cwsje60yr33dhc8]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:24:44.803Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T22:24:44.805Z"}
{"level":"debug","message":"Executing query [m8p2cwsqi2z0a0v7t6]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T22:24:44.810Z"}
{"level":"debug","message":"Executing query [m8p2cwsvoqr93qwvjq]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T22:24:44.815Z"}
{"level":"debug","message":"Executing query [m8p2cwtgux65jltn3jm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:24:44.836Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:46.765Z"}
{"duration":"9ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T22:24:46.844Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T22:24:46.850Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:24:46.857Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:24:46.859Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T22:24:46.972Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T22:24:47.071Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:47.201Z"}
{"level":"debug","message":"Executing query [m8p2cyn7757nkwk3gp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:24:47.203Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:24:47.213Z"}
{"level":"debug","message":"Executing query [m8p2cyni6irtpefftk6]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:24:47.214Z"}
{"level":"debug","message":"Executing query [m8p2cynkenu2n5m3p]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742941487202\"]","timestamp":"2025-03-25T22:24:47.216Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2cynkenu2n5m3p]","params":"[\"TEST-DOSAJE-1742941487202\"]","query":"DELETE FROM Dosaje WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:24:47.218Z"}
{"level":"debug","message":"Executing query [m8p2cyno91uubhbi8el]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742941487202\"]","timestamp":"2025-03-25T22:24:47.220Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2cyno91uubhbi8el]","params":"[\"TEST-DOSAJE-1742941487202\"]","query":"SELECT * FROM Dosaje WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:24:47.222Z"}
{"level":"debug","message":"Executing query [m8p2cynsstlrsashuuo]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742941487224\",\"TEST-SP-OFICIO-1742941487224\",9940,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T22:24:47.224Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2cynsstlrsashuuo]","params":"[1,\"TEST-SP-DOSAJE-1742941487224\",\"TEST-SP-OFICIO-1742941487224\",9940,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","query":"CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:24:47.228Z"}
{"level":"debug","message":"Executing query [m8p2cynx7ioo2ol07c]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:24:47.229Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:24:47.230Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:47.434Z"}
{"level":"debug","message":"Executing query [m8p2cyto0315cji87oxk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:24:47.437Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:24:47.447Z"}
{"level":"debug","message":"Executing query [m8p2cyu0dohqf6ozi5d]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:24:47.448Z"}
{"level":"debug","message":"Executing query [m8p2cyu1jg77hinw5v]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742941487436\"]","timestamp":"2025-03-25T22:24:47.449Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2cyu1jg77hinw5v]","params":"[\"TEST-FORENSE-1742941487436\"]","query":"DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:24:47.450Z"}
{"level":"debug","message":"Executing query [m8p2cyu5vnrku3xalgr]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742941487436\"]","timestamp":"2025-03-25T22:24:47.453Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2cyu5vnrku3xalgr]","params":"[\"TEST-FORENSE-1742941487436\"]","query":"SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:24:47.454Z"}
{"level":"debug","message":"Executing query [m8p2cyu84x4yegl2n95]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742941487456\",\"TEST-SP-OFI-FORENSE-1742941487456\",6121,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T22:24:47.456Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2cyu84x4yegl2n95]","params":"[1,\"TEST-SP-FORENSE-1742941487456\",\"TEST-SP-OFI-FORENSE-1742941487456\",6121,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","query":"CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:24:47.457Z"}
{"level":"debug","message":"Executing query [m8p2cyuaitigdwb8b6p]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:24:47.458Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:24:47.459Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:48.472Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:24:48.523Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:24:48.525Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T22:24:48.627Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T22:24:48.627Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T22:24:48.628Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T22:24:48.628Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T22:24:48.628Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T22:24:48.628Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:49.039Z"}
{"level":"debug","message":"Executing query [m8p2d02a2re9bnl27to]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:24:49.042Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:24:49.053Z"}
{"level":"debug","message":"Executing query [m8p2d02oxy6n5loxk6]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742941489041\"]","timestamp":"2025-03-25T22:24:49.056Z"}
{"level":"debug","message":"Executing query [m8p2d02qn79se8l7twq]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742941489041\",true]","timestamp":"2025-03-25T22:24:49.058Z"}
{"level":"debug","message":"Executing query [m8p2d02uhcn037kyry8]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[4]","timestamp":"2025-03-25T22:24:49.062Z"}
{"level":"debug","message":"Executing query [m8p2d02xh8fn8hmlxh]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742941489041\"]","timestamp":"2025-03-25T22:24:49.065Z"}
{"level":"debug","message":"Executing query [m8p2d02ybvfdndgpgbq]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",4]","timestamp":"2025-03-25T22:24:49.066Z"}
{"level":"debug","message":"Executing query [m8p2d032xobvncbmo1r]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[4]","timestamp":"2025-03-25T22:24:49.070Z"}
{"level":"debug","message":"Executing query [m8p2d034fsrdj5msjd]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[4]","timestamp":"2025-03-25T22:24:49.072Z"}
{"level":"debug","message":"Executing query [m8p2d0394u830lukgzu]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[4]","timestamp":"2025-03-25T22:24:49.077Z"}
{"level":"debug","message":"Executing query [m8p2d03bb89k5e52os4]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[4]","timestamp":"2025-03-25T22:24:49.079Z"}
{"level":"debug","message":"Executing query [m8p2d03dn0czssfqor]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[4]","timestamp":"2025-03-25T22:24:49.081Z"}
{"level":"debug","message":"Executing query [m8p2d03h1jkcsuy7cl4]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[4]","timestamp":"2025-03-25T22:24:49.085Z"}
{"level":"debug","message":"Executing query [m8p2d03j727b3hydsiu]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:24:49.087Z"}
{"level":"debug","message":"Executing query [m8p2d03liysmly426ob]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:24:49.089Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:24:49.091Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:49.298Z"}
{"level":"debug","message":"Executing query [m8p2d09gp5tqbew9qgb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:24:49.300Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:24:49.313Z"}
{"level":"debug","message":"Executing query [m8p2d09uf3ytenl1mxr]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:24:49.314Z"}
{"level":"debug","message":"Executing query [m8p2d09v9jfh4drr0ne]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T22:24:49.315Z"}
{"level":"debug","message":"Executing query [m8p2d09w1pzyurdzl5a]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T22:24:49.316Z"}
{"level":"debug","message":"Executing query [m8p2d09wpo41e91bq6r]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","timestamp":"2025-03-25T22:24:49.316Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'NivelAcceso' in 'field list'","level":"error","message":"Database query error [m8p2d09wpo41e91bq6r]","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","query":"INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:24:49.317Z"}
{"level":"error","message":"Error en la configuración de las pruebas de papelera: Unknown column 'NivelAcceso' in 'field list'","timestamp":"2025-03-25T22:24:49.318Z"}
{"level":"debug","message":"Executing query [m8p2d0a1n455lal58kc]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:24:49.321Z"}
{"level":"debug","message":"Executing query [m8p2d0a2t2ussgevx9]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:24:49.322Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p2d0a2t2ussgevx9]","params":"[\"TESTPAP123\"]","query":"DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","timestamp":"2025-03-25T22:24:49.323Z"}
{"level":"error","message":"Error al eliminar usuario TESTPAP123: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:24:49.323Z"}
{"level":"debug","message":"Executing query [m8p2d0a3si2n5yxi1ve]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:24:49.323Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:24:49.323Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:49.447Z"}
{"level":"debug","message":"Executing query [m8p2d0dlf1zzkdhngok]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:24:49.449Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:24:49.460Z"}
{"level":"debug","message":"Executing query [m8p2d0dwy727tcq6v6]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:24:49.460Z"}
{"level":"debug","message":"Executing query [m8p2d0dx3nwr48yfmr3]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:24:49.461Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T22:24:49.462Z"}
{"level":"debug","message":"Executing query [m8p2d0dytwvac6cpdw]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T22:24:49.462Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p2d0dytwvac6cpdw]","params":"[999,999]","query":"DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","timestamp":"2025-03-25T22:24:49.463Z"}
{"level":"debug","message":"Error al limpiar datos previos: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:24:49.463Z"}
{"level":"debug","message":"Executing query [m8p2d0e0tzscdleyyp]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T22:24:49.464Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p2d0e0tzscdleyyp]","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","query":"INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:24:49.465Z"}
{"level":"error","message":"Error al crear permiso contextual: Table 'oficri_sistema.permisocontextual' doesn't exist","timestamp":"2025-03-25T22:24:49.465Z"}
{"level":"debug","message":"Executing query [m8p2d0e4qvda6h29aok]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[null]","timestamp":"2025-03-25T22:24:49.468Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p2d0e4qvda6h29aok]","params":"[null]","query":"SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","timestamp":"2025-03-25T22:24:49.469Z"}
{"level":"error","message":"Error al obtener permiso contextual desde vista: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:24:49.469Z"}
{"level":"debug","message":"Executing query [m8p2d0e6zgi982myloe]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:24:49.470Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:24:49.471Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:49.665Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:50.077Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:24:50.154Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:24:50.198Z"}
{"level":"debug","message":"Executing query [m8p2d0yyrnjpc1d4d5h]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T22:24:50.218Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p2d0yyrnjpc1d4d5h]","params":"[]","query":"SELECT * FROM v_permisos_contextuales","timestamp":"2025-03-25T22:24:50.219Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:24:50.219Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:24:50.220Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:24:50.245Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:50.459Z"}
{"level":"debug","message":"Executing query [m8p2d15pvnmvanhitzk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:24:50.461Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:24:50.471Z"}
{"level":"debug","message":"Executing query [m8p2d160sdje00z0ecg]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:24:50.472Z"}
{"level":"debug","message":"Executing query [m8p2d162yciv8g74kj]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742941490461\"]","timestamp":"2025-03-25T22:24:50.474Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2d162yciv8g74kj]","params":"[\"TEST-QUIMICA-1742941490461\"]","query":"DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:24:50.475Z"}
{"level":"debug","message":"Executing query [m8p2d165d7etebo4i4a]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742941490461\"]","timestamp":"2025-03-25T22:24:50.477Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2d165d7etebo4i4a]","params":"[\"TEST-QUIMICA-1742941490461\"]","query":"SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:24:50.479Z"}
{"level":"debug","message":"Executing query [m8p2d169cxcqt6cicx]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:24:50.481Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:24:50.482Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:52.799Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:24:52.802Z"}
{"level":"debug","message":"Executing query [m8p2d2yr4rmion87dch]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:24:52.803Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:24:52.814Z"}
{"level":"debug","message":"Executing query [m8p2d2z211bwu0xqkvsd]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:24:52.814Z"}
{"level":"debug","message":"Executing query [m8p2d2z3yxft7igx9oj]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:24:52.815Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T22:24:52.816Z"}
{"level":"debug","message":"Executing query [m8p2d2z4sjb6w3eorc]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:24:52.816Z"}
{"level":"debug","message":"Executing query [m8p2d2z513nclhxyr1x]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:24:52.817Z"}
{"level":"debug","message":"Executing query [m8p2d2z67i1oq9413aq]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:24:52.818Z"}
{"level":"debug","message":"Executing query [m8p2d2z7edf4e6bxr8g]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T22:24:52.819Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'Grado' in 'field list'","level":"error","message":"Database query error [m8p2d2z7edf4e6bxr8g]","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:24:52.820Z"}
{"level":"error","message":"Error al crear usuario: Unknown column 'Grado' in 'field list'","timestamp":"2025-03-25T22:24:52.820Z"}
{"level":"debug","message":"Executing query [m8p2d2za3ujtkvei5e2]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:24:52.822Z"}
{"level":"error","message":"Error al obtener usuario por CIP: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []","timestamp":"2025-03-25T22:24:52.824Z"}
{"level":"debug","message":"Executing query [m8p2d2zd1lxqdp2r2fv]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:24:52.825Z"}
{"level":"debug","message":"Executing query [m8p2d2zf0kq2b40v3fja]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:24:52.827Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T22:24:52.828Z"}
{"level":"debug","message":"Executing query [m8p2d2zgxjhbsaxep6c]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:24:52.828Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:24:52.829Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:22.584Z"}
{"level":"debug","message":"Executing query [m8p2f09cp3k9xf7qxuc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:26:22.608Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:26:22.655Z"}
{"level":"debug","message":"Executing query [m8p2f0apkngkh3cp7u]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941582607\"]","timestamp":"2025-03-25T22:26:22.657Z"}
{"level":"debug","message":"Executing query [m8p2f0atyeyw02p2kfl]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941582607\"]","timestamp":"2025-03-25T22:26:22.661Z"}
{"level":"debug","message":"Executing query [m8p2f0awiqohdjwm2ar]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742941582607\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:26:22.664Z"}
{"level":"debug","message":"Executing query [m8p2f0b3od67yl9qls]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T22:26:22.671Z"}
{"level":"debug","message":"Executing query [m8p2f0b7k323ufrtpyk]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941582607\"]","timestamp":"2025-03-25T22:26:22.675Z"}
{"level":"debug","message":"Executing query [m8p2f0bawrjlbyjy1o8]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1003]","timestamp":"2025-03-25T22:26:22.678Z"}
{"level":"debug","message":"Executing query [m8p2f0bek3rvxz9efd]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T22:26:22.682Z"}
{"level":"debug","message":"Executing query [m8p2f0bgno9u5iklphs]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T22:26:22.684Z"}
{"level":"debug","message":"Executing query [m8p2f0bmfg77vfgicgk]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T22:26:22.690Z"}
{"level":"debug","message":"Executing query [m8p2f0bpo9qzv7sngha]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T22:26:22.693Z"}
{"level":"debug","message":"Executing query [m8p2f0briq6jbnm6htj]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T22:26:22.695Z"}
{"level":"debug","message":"Executing query [m8p2f0bv9eu6knc5bjf]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T22:26:22.699Z"}
{"level":"debug","message":"Executing query [m8p2f0by0fysaino352d]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:26:22.702Z"}
{"level":"debug","message":"Executing query [m8p2f0c1skbpfv2u8r]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:26:22.705Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:26:22.707Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:26:22.822Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:26:22.824Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:26:22.827Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:23.055Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:26:22.829Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:26:22.831Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:26:22.837Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:26:22.839Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:26:22.842Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:26:22.843Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:26:22.844Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:26:22.846Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T22:26:22.847Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:24.142Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:26:24.297Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T22:26:24.304Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:26:24.366Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T22:26:24.379Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:26:24.433Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:25.230Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:25.366Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:26:25.383Z"}
{"level":"debug","message":"Executing query [m8p2f2eiuyv6dwgz25j]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T22:26:25.386Z"}
{"level":"debug","message":"Executing query [m8p2f2ekzbpb5n3b0d8]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T22:26:25.388Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p2f2ekzbpb5n3b0d8]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T22:26:25.390Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:26:25.392Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:25.511Z"}
{"level":"debug","message":"Executing query [m8p2f2i2oxr8f8hzszq]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:26:25.514Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:26:25.533Z"}
{"level":"debug","message":"Executing query [m8p2f2ioh6sokmk4nt5]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:26:25.536Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T22:26:25.538Z"}
{"level":"debug","message":"Executing query [m8p2f2ir2i8z39qsvti]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T22:26:25.539Z"}
{"level":"debug","message":"Executing query [m8p2f2itf46m8z942tc]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T22:26:25.541Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T22:26:25.543Z"}
{"level":"debug","message":"Executing query [m8p2f2ivd1hxpie19id]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:26:25.543Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T22:26:25.545Z"}
{"level":"debug","message":"Executing query [m8p2f2j20rf0wzki7b9]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T22:26:25.550Z"}
{"level":"debug","message":"Executing query [m8p2f2jdy7qhe9jehs]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T22:26:25.561Z"}
{"level":"debug","message":"Executing query [m8p2f2jglpbrklqzpnf]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:26:25.564Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:27.452Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T22:26:27.524Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T22:26:27.529Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:26:27.538Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:26:27.540Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T22:26:27.657Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T22:26:27.770Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:27.911Z"}
{"level":"debug","message":"Executing query [m8p2f4cqu1zf3gujfe]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:26:27.914Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:26:27.925Z"}
{"level":"debug","message":"Executing query [m8p2f4d3b0zs5rsl6n]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:26:27.927Z"}
{"level":"debug","message":"Executing query [m8p2f4d5vi30mak52b]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742941587913\"]","timestamp":"2025-03-25T22:26:27.929Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2f4d5vi30mak52b]","params":"[\"TEST-DOSAJE-1742941587913\"]","query":"DELETE FROM Dosaje WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:26:27.932Z"}
{"level":"debug","message":"Executing query [m8p2f4dbtli8dlvyndd]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742941587913\"]","timestamp":"2025-03-25T22:26:27.935Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2f4dbtli8dlvyndd]","params":"[\"TEST-DOSAJE-1742941587913\"]","query":"SELECT * FROM Dosaje WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:26:27.937Z"}
{"level":"debug","message":"Executing query [m8p2f4dggm6nk0omemr]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742941587940\",\"TEST-SP-OFICIO-1742941587940\",4721,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T22:26:27.940Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2f4dggm6nk0omemr]","params":"[1,\"TEST-SP-DOSAJE-1742941587940\",\"TEST-SP-OFICIO-1742941587940\",4721,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","query":"CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:26:27.946Z"}
{"level":"debug","message":"Executing query [m8p2f4dntx26c91zc98]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:26:27.947Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:26:27.948Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:28.173Z"}
{"level":"debug","message":"Executing query [m8p2f4k100p4vjsrnx0mk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:26:28.177Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:26:28.188Z"}
{"level":"debug","message":"Executing query [m8p2f4kekhja4m3n5i]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:26:28.190Z"}
{"level":"debug","message":"Executing query [m8p2f4kfahpqhk2r7gh]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742941588176\"]","timestamp":"2025-03-25T22:26:28.191Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2f4kfahpqhk2r7gh]","params":"[\"TEST-FORENSE-1742941588176\"]","query":"DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:26:28.193Z"}
{"level":"debug","message":"Executing query [m8p2f4klhopftm4wl7g]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742941588176\"]","timestamp":"2025-03-25T22:26:28.197Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2f4klhopftm4wl7g]","params":"[\"TEST-FORENSE-1742941588176\"]","query":"SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:26:28.199Z"}
{"level":"debug","message":"Executing query [m8p2f4kqwf5sv1gh0f]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742941588201\",\"TEST-SP-OFI-FORENSE-1742941588202\",4138,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T22:26:28.202Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2f4kqwf5sv1gh0f]","params":"[1,\"TEST-SP-FORENSE-1742941588201\",\"TEST-SP-OFI-FORENSE-1742941588202\",4138,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","query":"CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:26:28.203Z"}
{"level":"debug","message":"Executing query [m8p2f4ktr522usbizas]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:26:28.205Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:26:28.206Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:29.198Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:26:29.254Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:26:29.256Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T22:26:29.365Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T22:26:29.366Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T22:26:29.366Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T22:26:29.367Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T22:26:29.368Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T22:26:29.368Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:29.794Z"}
{"level":"debug","message":"Executing query [m8p2f5t1maz3hcgnbq]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:26:29.797Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:26:29.809Z"}
{"level":"debug","message":"Executing query [m8p2f5tfsgmnytirvqg]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742941589796\"]","timestamp":"2025-03-25T22:26:29.811Z"}
{"level":"debug","message":"Executing query [m8p2f5th6k9r2503xtg]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742941589796\",true]","timestamp":"2025-03-25T22:26:29.813Z"}
{"level":"debug","message":"Executing query [m8p2f5tn5clww6cqd3o]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[5]","timestamp":"2025-03-25T22:26:29.819Z"}
{"level":"debug","message":"Executing query [m8p2f5tqinusza2cs7]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742941589796\"]","timestamp":"2025-03-25T22:26:29.822Z"}
{"level":"debug","message":"Executing query [m8p2f5tsyv15ze62ukb]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",5]","timestamp":"2025-03-25T22:26:29.824Z"}
{"level":"debug","message":"Executing query [m8p2f5twh1lmq4tzds7]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[5]","timestamp":"2025-03-25T22:26:29.828Z"}
{"level":"debug","message":"Executing query [m8p2f5ty80o0anwyeu]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[5]","timestamp":"2025-03-25T22:26:29.830Z"}
{"level":"debug","message":"Executing query [m8p2f5u1fs53i82hwjt]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[5]","timestamp":"2025-03-25T22:26:29.833Z"}
{"level":"debug","message":"Executing query [m8p2f5u3a4458yrdmgi]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[5]","timestamp":"2025-03-25T22:26:29.835Z"}
{"level":"debug","message":"Executing query [m8p2f5u5r25ny3bxdm]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[5]","timestamp":"2025-03-25T22:26:29.837Z"}
{"level":"debug","message":"Executing query [m8p2f5u790bg0qq5f4m]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[5]","timestamp":"2025-03-25T22:26:29.839Z"}
{"level":"debug","message":"Executing query [m8p2f5u9p6otrvadygm]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:26:29.841Z"}
{"level":"debug","message":"Executing query [m8p2f5ubg3j9f9gf8e]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:26:29.843Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:26:29.844Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:30.047Z"}
{"level":"debug","message":"Executing query [m8p2f603miacvzpoqrd]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:26:30.051Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:26:30.065Z"}
{"level":"debug","message":"Executing query [m8p2f60j7aiu8j1a329]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:26:30.067Z"}
{"level":"debug","message":"Executing query [m8p2f60k88bzovaopvc]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T22:26:30.068Z"}
{"level":"debug","message":"Executing query [m8p2f60nf36d94tvvob]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T22:26:30.071Z"}
{"level":"debug","message":"Executing query [m8p2f60osw2cey1plhc]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","timestamp":"2025-03-25T22:26:30.072Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'NivelAcceso' in 'field list'","level":"error","message":"Database query error [m8p2f60osw2cey1plhc]","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","query":"INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:26:30.073Z"}
{"level":"error","message":"Error en la configuración de las pruebas de papelera: Unknown column 'NivelAcceso' in 'field list'","timestamp":"2025-03-25T22:26:30.074Z"}
{"level":"debug","message":"Executing query [m8p2f60uzz0v8ry5g9]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:26:30.078Z"}
{"level":"debug","message":"Executing query [m8p2f60vf8a8beiie1d]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:26:30.079Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p2f60vf8a8beiie1d]","params":"[\"TESTPAP123\"]","query":"DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","timestamp":"2025-03-25T22:26:30.081Z"}
{"level":"error","message":"Error al eliminar usuario TESTPAP123: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:26:30.081Z"}
{"level":"debug","message":"Executing query [m8p2f60xqo80mcn9oda]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:26:30.081Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:26:30.082Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:30.211Z"}
{"level":"debug","message":"Executing query [m8p2f64my53cuz3ta]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:26:30.214Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:26:30.225Z"}
{"level":"debug","message":"Executing query [m8p2f64yg6ku24t3tcf]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:26:30.226Z"}
{"level":"debug","message":"Executing query [m8p2f64zelx5qetf4a9]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:26:30.227Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T22:26:30.229Z"}
{"level":"debug","message":"Executing query [m8p2f6527146m6hc18]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T22:26:30.230Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p2f6527146m6hc18]","params":"[999,999]","query":"DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","timestamp":"2025-03-25T22:26:30.231Z"}
{"level":"debug","message":"Error al limpiar datos previos: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:26:30.232Z"}
{"level":"debug","message":"Executing query [m8p2f6559dp9uev9ctc]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T22:26:30.233Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p2f6559dp9uev9ctc]","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","query":"INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:26:30.234Z"}
{"level":"error","message":"Error al crear permiso contextual: Table 'oficri_sistema.permisocontextual' doesn't exist","timestamp":"2025-03-25T22:26:30.234Z"}
{"level":"debug","message":"Executing query [m8p2f659q2iclr40qm9]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[null]","timestamp":"2025-03-25T22:26:30.238Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p2f659q2iclr40qm9]","params":"[null]","query":"SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","timestamp":"2025-03-25T22:26:30.239Z"}
{"level":"error","message":"Error al obtener permiso contextual desde vista: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:26:30.239Z"}
{"level":"debug","message":"Executing query [m8p2f65dsstkslu26d]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:26:30.241Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:26:30.242Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:30.442Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:30.884Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:26:30.949Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:26:31.008Z"}
{"level":"debug","message":"Executing query [m8p2f6rtjy08d4vtcwi]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T22:26:31.049Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p2f6rtjy08d4vtcwi]","params":"[]","query":"SELECT * FROM v_permisos_contextuales","timestamp":"2025-03-25T22:26:31.052Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:26:31.053Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:26:31.053Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:26:31.084Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:31.307Z"}
{"level":"debug","message":"Executing query [m8p2f6z2nttwrtdu7jp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:26:31.310Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:26:31.321Z"}
{"level":"debug","message":"Executing query [m8p2f6zf6yipu93qqyn]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:26:31.323Z"}
{"level":"debug","message":"Executing query [m8p2f6zgzudov6908o9]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742941591309\"]","timestamp":"2025-03-25T22:26:31.324Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2f6zgzudov6908o9]","params":"[\"TEST-QUIMICA-1742941591309\"]","query":"DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:26:31.325Z"}
{"level":"debug","message":"Executing query [m8p2f6zlnyubbj845x]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742941591309\"]","timestamp":"2025-03-25T22:26:31.329Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2f6zlnyubbj845x]","params":"[\"TEST-QUIMICA-1742941591309\"]","query":"SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:26:31.330Z"}
{"level":"debug","message":"Executing query [m8p2f6zpuabdg5jurhm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:26:31.333Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:26:31.338Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:33.681Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:26:33.684Z"}
{"level":"debug","message":"Executing query [m8p2f8t2r46gvzew82]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:26:33.686Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:26:33.698Z"}
{"level":"debug","message":"Executing query [m8p2f8tfqr76r1m3seq]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:26:33.699Z"}
{"level":"debug","message":"Executing query [m8p2f8tgfucr43wa5rd]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:26:33.700Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T22:26:33.702Z"}
{"level":"debug","message":"Executing query [m8p2f8tikcvaq9ib12s]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:26:33.702Z"}
{"level":"debug","message":"Executing query [m8p2f8tjj9dmt9r7xub]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:26:33.703Z"}
{"level":"debug","message":"Executing query [m8p2f8tl0iixau8ls7jv]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:26:33.705Z"}
{"level":"debug","message":"Executing query [m8p2f8tmy7ycvjwn57]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T22:26:33.706Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'Grado' in 'field list'","level":"error","message":"Database query error [m8p2f8tmy7ycvjwn57]","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:26:33.706Z"}
{"level":"error","message":"Error al crear usuario: Unknown column 'Grado' in 'field list'","timestamp":"2025-03-25T22:26:33.707Z"}
{"level":"debug","message":"Executing query [m8p2f8tqoyfxxi35q8f]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:26:33.710Z"}
{"level":"error","message":"Error al obtener usuario por CIP: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveLength\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected length: \u001b[32m1\u001b[39m\nReceived length: \u001b[31m0\u001b[39m\nReceived array:  \u001b[31m[]\u001b[39m","timestamp":"2025-03-25T22:26:33.713Z"}
{"level":"debug","message":"Executing query [m8p2f8tv61s8tnzdieb]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:26:33.715Z"}
{"level":"debug","message":"Executing query [m8p2f8twud2vg2kf6cc]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:26:33.716Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T22:26:33.717Z"}
{"level":"debug","message":"Executing query [m8p2f8typuzgwmh21hd]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:26:33.718Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:26:33.719Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:27:45.192Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:27:45.201Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:27:45.208Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:27:45.211Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:27:45.213Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:27:45.217Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:27:45.220Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:27:45.227Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:27:45.230Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:27:45.232Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:27:45.235Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T22:27:45.236Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:45.378Z"}
{"level":"debug","message":"Executing query [m8p2gs5zqlndof1ijb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:27:45.431Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:27:45.484Z"}
{"level":"debug","message":"Executing query [m8p2gs7kiaz7bmgn13r]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941665428\"]","timestamp":"2025-03-25T22:27:45.488Z"}
{"level":"debug","message":"Executing query [m8p2gs82y7lrfie5h6h]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941665428\"]","timestamp":"2025-03-25T22:27:45.506Z"}
{"level":"debug","message":"Executing query [m8p2gs84wsrevdjzdta]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742941665428\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:27:45.508Z"}
{"level":"debug","message":"Executing query [m8p2gs8ees99azzkynr]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T22:27:45.518Z"}
{"level":"debug","message":"Executing query [m8p2gs8jssywmlsszr]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941665428\"]","timestamp":"2025-03-25T22:27:45.523Z"}
{"level":"debug","message":"Executing query [m8p2gs8m459lj4pvwvn]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1004]","timestamp":"2025-03-25T22:27:45.526Z"}
{"level":"debug","message":"Executing query [m8p2gs8rzz9mrkb6l4]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T22:27:45.531Z"}
{"level":"debug","message":"Executing query [m8p2gs8uv9omox227fc]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T22:27:45.534Z"}
{"level":"debug","message":"Executing query [m8p2gs8zenyozweunp5]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T22:27:45.539Z"}
{"level":"debug","message":"Executing query [m8p2gs924sr0mofez5i]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T22:27:45.542Z"}
{"level":"debug","message":"Executing query [m8p2gs94e7moi1d5j6p]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T22:27:45.544Z"}
{"level":"debug","message":"Executing query [m8p2gs97vgmv4h02b1s]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T22:27:45.548Z"}
{"level":"debug","message":"Executing query [m8p2gs9963oifeaqrq2]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:27:45.550Z"}
{"level":"debug","message":"Executing query [m8p2gs9cj2hgjlvaobe]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:27:45.552Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:27:45.554Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:45.694Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:45.546Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T22:27:45.631Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:45.803Z"}
{"level":"debug","message":"Executing query [m8p2gsgfcrw03fc4e0q]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:27:45.807Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:27:45.830Z"}
{"level":"debug","message":"Executing query [m8p2gsh5fyoukij2zfb]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:27:45.833Z"}
{"level":"debug","message":"Executing query [m8p2gsh7eig3ja1z0l6]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742941665805\"]","timestamp":"2025-03-25T22:27:45.836Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2gsh7eig3ja1z0l6]","params":"[\"TEST-DOSAJE-1742941665805\"]","query":"DELETE FROM Dosaje WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:27:45.837Z"}
{"level":"debug","message":"Executing query [m8p2gshhh9r1ps9mcv4]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742941665805\"]","timestamp":"2025-03-25T22:27:45.846Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2gshhh9r1ps9mcv4]","params":"[\"TEST-DOSAJE-1742941665805\"]","query":"SELECT * FROM Dosaje WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:27:45.847Z"}
{"level":"debug","message":"Executing query [m8p2gshmg2fj078spn4]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742941665850\",\"TEST-SP-OFICIO-1742941665850\",4469,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T22:27:45.850Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2gshmg2fj078spn4]","params":"[1,\"TEST-SP-DOSAJE-1742941665850\",\"TEST-SP-OFICIO-1742941665850\",4469,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","query":"CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:27:45.853Z"}
{"level":"debug","message":"Executing query [m8p2gshrq9t7nykpc8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:27:45.855Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:45.800Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T22:27:45.812Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:27:45.857Z"}
{"level":"debug","message":"Executing query [m8p2gsjgxaunlhim16p]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T22:27:45.916Z"}
{"level":"debug","message":"Executing query [m8p2gsjm6od1shb4cby]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T22:27:45.922Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p2gsjm6od1shb4cby]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T22:27:45.926Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:27:45.932Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:27:45.936Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:45.937Z"}
{"level":"debug","message":"Executing query [m8p2gsloyt0zfqtzqbk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:27:45.997Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:27:46.055Z"}
{"level":"debug","message":"Executing query [m8p2gsnf5wheai5029o]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:27:46.060Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T22:27:46.065Z"}
{"level":"debug","message":"Executing query [m8p2gsnlznl2oizxsen]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T22:27:46.065Z"}
{"level":"debug","message":"Executing query [m8p2gsnpq0zewfwpf1k]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T22:27:46.069Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T22:27:46.071Z"}
{"level":"debug","message":"Executing query [m8p2gsnrpyhbjyoho1]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:27:46.071Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T22:27:46.074Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T22:27:46.121Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T22:27:46.122Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T22:27:46.123Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T22:27:46.124Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T22:27:46.125Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T22:27:46.125Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Executing query [m8p2gspo1dggp6qvwl1i]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T22:27:46.140Z"}
{"level":"debug","message":"Executing query [m8p2gspt98i9mggq3t]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T22:27:46.145Z"}
{"level":"debug","message":"Executing query [m8p2gspvoh2lguowo9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:27:46.148Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:46.212Z"}
{"level":"debug","message":"Executing query [m8p2gstxhr40x5yzec5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:27:46.293Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:27:46.340Z"}
{"level":"debug","message":"Executing query [m8p2gsvb381vlpozyqe]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:27:46.343Z"}
{"level":"debug","message":"Executing query [m8p2gsvfnwqkbf5izl]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742941666292\"]","timestamp":"2025-03-25T22:27:46.347Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2gsvfnwqkbf5izl]","params":"[\"TEST-FORENSE-1742941666292\"]","query":"DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:27:46.350Z"}
{"level":"debug","message":"Executing query [m8p2gsvln48hpzqnf29]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742941666292\"]","timestamp":"2025-03-25T22:27:46.353Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2gsvln48hpzqnf29]","params":"[\"TEST-FORENSE-1742941666292\"]","query":"SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:27:46.355Z"}
{"level":"debug","message":"Executing query [m8p2gsvpr0vz959vapg]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742941666357\",\"TEST-SP-OFI-FORENSE-1742941666357\",6382,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T22:27:46.357Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2gsvpr0vz959vapg]","params":"[1,\"TEST-SP-FORENSE-1742941666357\",\"TEST-SP-OFI-FORENSE-1742941666357\",6382,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","query":"CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:27:46.360Z"}
{"level":"debug","message":"Executing query [m8p2gsvtgqjtkx73ald]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:27:46.361Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:46.368Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:27:46.363Z"}
{"level":"debug","message":"Executing query [m8p2gsw5yuil43omdyk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:27:46.373Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:27:46.415Z"}
{"level":"debug","message":"Executing query [m8p2gsxgxtimnw0cvyd]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742941666371\"]","timestamp":"2025-03-25T22:27:46.420Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:46.407Z"}
{"level":"debug","message":"Executing query [m8p2gsxarbwq7qc0f6r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:27:46.414Z"}
{"level":"debug","message":"Executing query [m8p2gsxkrtfze2odzt]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742941666371\",true]","timestamp":"2025-03-25T22:27:46.424Z"}
{"level":"debug","message":"Executing query [m8p2gsxr6m5pcdj6dag]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[6]","timestamp":"2025-03-25T22:27:46.431Z"}
{"level":"debug","message":"Executing query [m8p2gsxwwv6lambt56l]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742941666371\"]","timestamp":"2025-03-25T22:27:46.436Z"}
{"level":"debug","message":"Executing query [m8p2gsxzvd4eousgrwe]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",6]","timestamp":"2025-03-25T22:27:46.439Z"}
{"level":"debug","message":"Executing query [m8p2gsxzdzac94co4r4]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:27:46.439Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:27:46.440Z"}
{"level":"debug","message":"Executing query [m8p2gsy2ahdbb4s0a9n]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[6]","timestamp":"2025-03-25T22:27:46.443Z"}
{"level":"debug","message":"Executing query [m8p2gsy1i0b3vkkrct]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:27:46.441Z"}
{"level":"debug","message":"Executing query [m8p2gsy58ve778r0yad]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[6]","timestamp":"2025-03-25T22:27:46.445Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T22:27:46.443Z"}
{"level":"debug","message":"Executing query [m8p2gsy4dgj0lgo1ay7]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T22:27:46.444Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p2gsy4dgj0lgo1ay7]","params":"[999,999]","query":"DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","timestamp":"2025-03-25T22:27:46.446Z"}
{"level":"debug","message":"Executing query [m8p2gsy9js0o67o4on9]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[6]","timestamp":"2025-03-25T22:27:46.449Z"}
{"level":"debug","message":"Error al limpiar datos previos: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:27:46.446Z"}
{"level":"debug","message":"Executing query [m8p2gsy7jwso0xcbpye]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T22:27:46.447Z"}
{"level":"debug","message":"Executing query [m8p2gsycrpttnabipzo]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[6]","timestamp":"2025-03-25T22:27:46.452Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p2gsy7jwso0xcbpye]","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","query":"INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:27:46.449Z"}
{"level":"debug","message":"Executing query [m8p2gsyegaf38blp6m5]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[6]","timestamp":"2025-03-25T22:27:46.454Z"}
{"level":"debug","message":"Executing query [m8p2gsyit5luqh4eq8]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[6]","timestamp":"2025-03-25T22:27:46.458Z"}
{"level":"debug","message":"Executing query [m8p2gsykul9cmdjsu3]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:27:46.460Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:46.412Z"}
{"level":"debug","message":"Executing query [m8p2gsync1bjulkegns]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:27:46.463Z"}
{"level":"debug","message":"Executing query [m8p2gsyhgx13vttb0oo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:27:46.458Z"}
{"level":"error","message":"Error al crear permiso contextual: Table 'oficri_sistema.permisocontextual' doesn't exist","timestamp":"2025-03-25T22:27:46.450Z"}
{"level":"debug","message":"Executing query [m8p2gsyfyxyxuebxi6]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[null]","timestamp":"2025-03-25T22:27:46.455Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:27:46.465Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p2gsyfyxyxuebxi6]","params":"[null]","query":"SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","timestamp":"2025-03-25T22:27:46.462Z"}
{"level":"error","message":"Error al obtener permiso contextual desde vista: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:27:46.462Z"}
{"level":"debug","message":"Executing query [m8p2gsyoiwnfptj11gk]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:27:46.464Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:27:46.467Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:27:46.504Z"}
{"level":"debug","message":"Executing query [m8p2gszz0uswo6wznvv]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:27:46.511Z"}
{"level":"debug","message":"Executing query [m8p2gt03fj7bez0s59]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T22:27:46.515Z"}
{"level":"debug","message":"Executing query [m8p2gt05dct8uy9z6g9]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T22:27:46.517Z"}
{"level":"debug","message":"Executing query [m8p2gt07x9603sesrs7]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","timestamp":"2025-03-25T22:27:46.519Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'NivelAcceso' in 'field list'","level":"error","message":"Database query error [m8p2gt07x9603sesrs7]","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","query":"INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:27:46.521Z"}
{"level":"error","message":"Error en la configuración de las pruebas de papelera: Unknown column 'NivelAcceso' in 'field list'","timestamp":"2025-03-25T22:27:46.522Z"}
{"level":"debug","message":"Executing query [m8p2gt0emlju063hrfo]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:27:46.526Z"}
{"level":"debug","message":"Executing query [m8p2gt0g46ib9lc5elq]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:27:46.528Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p2gt0g46ib9lc5elq]","params":"[\"TESTPAP123\"]","query":"DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","timestamp":"2025-03-25T22:27:46.529Z"}
{"level":"error","message":"Error al eliminar usuario TESTPAP123: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:27:46.530Z"}
{"level":"debug","message":"Executing query [m8p2gt0iecdoktsgsr]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:27:46.530Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:27:46.532Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:46.836Z"}
{"level":"debug","message":"Executing query [m8p2gta9j5peze2f3k]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:27:46.881Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:27:46.928Z"}
{"level":"debug","message":"Executing query [m8p2gtboyf1hpgdwzng]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:27:46.932Z"}
{"level":"debug","message":"Executing query [m8p2gtbs7ybbyu1ft55]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742941666879\"]","timestamp":"2025-03-25T22:27:46.937Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2gtbs7ybbyu1ft55]","params":"[\"TEST-QUIMICA-1742941666879\"]","query":"DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:27:46.939Z"}
{"level":"debug","message":"Executing query [m8p2gtc1qt569moowba]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742941666879\"]","timestamp":"2025-03-25T22:27:46.945Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2gtc1qt569moowba]","params":"[\"TEST-QUIMICA-1742941666879\"]","query":"SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:27:46.948Z"}
{"level":"debug","message":"Executing query [m8p2gtc88aw9gatoxqf]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:27:46.952Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:27:46.956Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:46.889Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:47.232Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:47.277Z"}
{"level":"debug","message":"Executing query [m8p2gtlcls7hx5xs5d]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:27:47.280Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:27:47.328Z"}
{"level":"debug","message":"Executing query [m8p2gtmr7m3gt60e6or]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:27:47.331Z"}
{"level":"debug","message":"Executing query [m8p2gtmv1ldyez9ywz]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:27:47.335Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T22:27:47.337Z"}
{"level":"debug","message":"Executing query [m8p2gtmxjls0sqyk6vq]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:27:47.337Z"}
{"level":"debug","message":"Executing query [m8p2gtmz0zg4bjlj54z]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:27:47.339Z"}
{"level":"debug","message":"Executing query [m8p2gtn12m6xlw6y8ex]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:27:47.341Z"}
{"level":"debug","message":"Executing query [m8p2gtn2z00z7b4gp1]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T22:27:47.342Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'Grado' in 'field list'","level":"error","message":"Database query error [m8p2gtn2z00z7b4gp1]","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:27:47.343Z"}
{"level":"error","message":"Error al crear usuario: Unknown column 'Grado' in 'field list'","timestamp":"2025-03-25T22:27:47.344Z"}
{"level":"debug","message":"Executing query [m8p2gtn78oyk140ff3l]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:27:47.347Z"}
{"level":"error","message":"Error al obtener usuario por CIP: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveLength\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected length: \u001b[32m1\u001b[39m\nReceived length: \u001b[31m0\u001b[39m\nReceived array:  \u001b[31m[]\u001b[39m","timestamp":"2025-03-25T22:27:47.350Z"}
{"level":"debug","message":"Executing query [m8p2gtncklxed5jrjw]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:27:47.352Z"}
{"level":"debug","message":"Executing query [m8p2gtnd39ef5gsfhcu]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:27:47.353Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T22:27:47.354Z"}
{"level":"debug","message":"Executing query [m8p2gtnfg30tkfsycs]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:27:47.355Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:27:47.356Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:47.084Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:27:47.350Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T22:27:47.366Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:27:47.565Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T22:27:47.582Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:27:47.653Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:47.865Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:27:48.048Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:27:48.167Z"}
{"level":"debug","message":"Executing query [m8p2gub72vq5u4iq06i]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T22:27:48.211Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p2gub72vq5u4iq06i]","params":"[]","query":"SELECT * FROM v_permisos_contextuales","timestamp":"2025-03-25T22:27:48.212Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:27:48.213Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:27:48.213Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:27:48.244Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:48.734Z"}
{"duration":"24ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T22:27:48.909Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:27:48.916Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T22:27:48.923Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:27:48.930Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:27:48.941Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:27:49.066Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:27:49.068Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:29:17.573Z"}
{"level":"debug","message":"Executing query [m8p2ira9l9037d7kwx]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:29:17.601Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:29:17.636Z"}
{"level":"debug","message":"Executing query [m8p2irbagjdru9eh27u]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:29:17.639Z"}
{"level":"debug","message":"Executing query [m8p2irbhhq5mqeu4nyl]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742941757599\"]","timestamp":"2025-03-25T22:29:17.645Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2irbhhq5mqeu4nyl]","params":"[\"TEST-FORENSE-1742941757599\"]","query":"DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:29:17.647Z"}
{"level":"debug","message":"Executing query [m8p2irbsmn153781bwk]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742941757599\"]","timestamp":"2025-03-25T22:29:17.656Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2irbsmn153781bwk]","params":"[\"TEST-FORENSE-1742941757599\"]","query":"SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:29:17.659Z"}
{"level":"debug","message":"Executing query [m8p2irc0f5b1rsodfi9]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742941757664\",\"TEST-SP-OFI-FORENSE-1742941757664\",6372,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T22:29:17.664Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2irc0f5b1rsodfi9]","params":"[1,\"TEST-SP-FORENSE-1742941757664\",\"TEST-SP-OFI-FORENSE-1742941757664\",6372,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","query":"CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:29:17.666Z"}
{"level":"debug","message":"Executing query [m8p2irc4m49wszpfnk]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:29:17.668Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:29:17.671Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:30.970Z"}
{"level":"debug","message":"Executing query [m8p2kbwwtc4yjb0dr9d]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:30:30.992Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:30:31.017Z"}
{"level":"debug","message":"Executing query [m8p2kbxn5v7ymn0z1nq]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:30:31.019Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2kbxn5v7ymn0z1nq]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:30:31.021Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:30:31.021Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:39.959Z"}
{"level":"debug","message":"Executing query [m8p2kiuho4gm9c8aqsd]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:30:39.978Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:30:40.010Z"}
{"level":"debug","message":"Executing query [m8p2kivghbwhrili3k5]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941839977\"]","timestamp":"2025-03-25T22:30:40.012Z"}
{"level":"debug","message":"Executing query [m8p2kivj8ui65j4puob]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941839977\"]","timestamp":"2025-03-25T22:30:40.015Z"}
{"level":"debug","message":"Executing query [m8p2kivknl4dd0vjtll]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742941839977\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:30:40.016Z"}
{"level":"debug","message":"Executing query [m8p2kivqt3hjlz9glt]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T22:30:40.022Z"}
{"level":"debug","message":"Executing query [m8p2kivtyyb2m8riq2]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742941839977\"]","timestamp":"2025-03-25T22:30:40.025Z"}
{"level":"debug","message":"Executing query [m8p2kivviuix5onrywc]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1005]","timestamp":"2025-03-25T22:30:40.027Z"}
{"level":"debug","message":"Executing query [m8p2kivzch5f5z5lgkk]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T22:30:40.031Z"}
{"level":"debug","message":"Executing query [m8p2kiw1nxthfphzusj]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T22:30:40.033Z"}
{"level":"debug","message":"Executing query [m8p2kiw3d13n18oyxda]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T22:30:40.035Z"}
{"level":"debug","message":"Executing query [m8p2kiw5r95g7x9qnc]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T22:30:40.037Z"}
{"level":"debug","message":"Executing query [m8p2kiw756szeiliat]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T22:30:40.039Z"}
{"level":"debug","message":"Executing query [m8p2kiw9fpuwu8xt1l9]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T22:30:40.041Z"}
{"level":"debug","message":"Executing query [m8p2kiwbmn91gif70c]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:30:40.043Z"}
{"level":"debug","message":"Executing query [m8p2kiwc06supchqz8a6]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:30:40.044Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:30:40.046Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:30:40.135Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:30:40.137Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:30:40.139Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:30:40.141Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:30:40.143Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:30:40.147Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:30:40.149Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:30:40.152Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:30:40.153Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:30:40.155Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:30:40.156Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T22:30:40.157Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:40.327Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:41.172Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:30:41.300Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T22:30:41.305Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:30:41.354Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T22:30:41.365Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:30:41.401Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:42.123Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:42.348Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:30:42.361Z"}
{"level":"debug","message":"Executing query [m8p2kkosoacvv5gpeg9]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T22:30:42.364Z"}
{"level":"debug","message":"Executing query [m8p2kkou0y5prdibe75]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T22:30:42.366Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p2kkou0y5prdibe75]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T22:30:42.367Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:30:42.369Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:42.471Z"}
{"level":"debug","message":"Executing query [m8p2kkrtx6nw73l39ba]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:30:42.473Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:30:42.493Z"}
{"level":"debug","message":"Executing query [m8p2kkse2d7vckla6ec]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:30:42.494Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T22:30:42.497Z"}
{"level":"debug","message":"Executing query [m8p2kksiwh7pwau38iq]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T22:30:42.498Z"}
{"level":"debug","message":"Executing query [m8p2kksjvoghghkht6l]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T22:30:42.499Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T22:30:42.501Z"}
{"level":"debug","message":"Executing query [m8p2kksmomzz30hw2i]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:30:42.502Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T22:30:42.504Z"}
{"level":"debug","message":"Executing query [m8p2kksuz1mni37lue8]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T22:30:42.510Z"}
{"level":"debug","message":"Executing query [m8p2kkt5686rsps1lqp]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T22:30:42.521Z"}
{"level":"debug","message":"Executing query [m8p2kkt89qadxti0f1]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:30:42.524Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:44.222Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T22:30:44.285Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T22:30:44.289Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:30:44.298Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:30:44.300Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T22:30:44.402Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T22:30:44.508Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:44.631Z"}
{"level":"debug","message":"Executing query [m8p2kmfu195rfnr38wh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:30:44.634Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:30:44.644Z"}
{"level":"debug","message":"Executing query [m8p2kmg5okec98d06xc]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:30:44.645Z"}
{"level":"debug","message":"Executing query [m8p2kmg7wm6vll7gqo]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742941844633\"]","timestamp":"2025-03-25T22:30:44.647Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2kmg7wm6vll7gqo]","params":"[\"TEST-DOSAJE-1742941844633\"]","query":"DELETE FROM Dosaje WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:30:44.648Z"}
{"level":"debug","message":"Executing query [m8p2kmgcvtcwxqu90ds]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742941844633\"]","timestamp":"2025-03-25T22:30:44.652Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2kmgcvtcwxqu90ds]","params":"[\"TEST-DOSAJE-1742941844633\"]","query":"SELECT * FROM Dosaje WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:30:44.657Z"}
{"level":"debug","message":"Executing query [m8p2kmgj4qnib2m2ldw]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742941844659\",\"TEST-SP-OFICIO-1742941844659\",5322,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T22:30:44.659Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2kmgj4qnib2m2ldw]","params":"[1,\"TEST-SP-DOSAJE-1742941844659\",\"TEST-SP-OFICIO-1742941844659\",5322,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","query":"CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:30:44.661Z"}
{"level":"debug","message":"Executing query [m8p2kmgm8fo7ef7n4l]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:30:44.662Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:30:44.664Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:44.879Z"}
{"level":"debug","message":"Executing query [m8p2kmmqagcmz3o3sc6]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:30:44.882Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:30:44.891Z"}
{"level":"debug","message":"Executing query [m8p2kmn1egf45yjdgnf]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:30:44.893Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2kmn1egf45yjdgnf]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:30:44.894Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:30:44.895Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:45.737Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:30:45.782Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:30:45.783Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T22:30:45.889Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T22:30:45.890Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T22:30:45.891Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T22:30:45.891Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T22:30:45.893Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T22:30:45.893Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:46.281Z"}
{"level":"debug","message":"Executing query [m8p2knpodelrzi3igya]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:30:46.284Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:30:46.296Z"}
{"level":"debug","message":"Executing query [m8p2knq2krfmh7a406b]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742941846283\"]","timestamp":"2025-03-25T22:30:46.298Z"}
{"level":"debug","message":"Executing query [m8p2knq43oxp30z9uhh]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742941846283\",true]","timestamp":"2025-03-25T22:30:46.300Z"}
{"level":"debug","message":"Executing query [m8p2knqacextv9aouc8]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[7]","timestamp":"2025-03-25T22:30:46.306Z"}
{"level":"debug","message":"Executing query [m8p2knqdiadyc0pg2sa]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742941846283\"]","timestamp":"2025-03-25T22:30:46.309Z"}
{"level":"debug","message":"Executing query [m8p2knqfjsdus4bclmb]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",7]","timestamp":"2025-03-25T22:30:46.311Z"}
{"level":"debug","message":"Executing query [m8p2knqi7i08itxwjv4]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[7]","timestamp":"2025-03-25T22:30:46.314Z"}
{"level":"debug","message":"Executing query [m8p2knql3b3pfkeze0f]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[7]","timestamp":"2025-03-25T22:30:46.317Z"}
{"level":"debug","message":"Executing query [m8p2knqotk17bdq1lx]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[7]","timestamp":"2025-03-25T22:30:46.320Z"}
{"level":"debug","message":"Executing query [m8p2knqryvt1hvg24z]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[7]","timestamp":"2025-03-25T22:30:46.323Z"}
{"level":"debug","message":"Executing query [m8p2knqs5g7ltfp38k]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[7]","timestamp":"2025-03-25T22:30:46.324Z"}
{"level":"debug","message":"Executing query [m8p2knqwh6h2dbeba05]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[7]","timestamp":"2025-03-25T22:30:46.329Z"}
{"level":"debug","message":"Executing query [m8p2knqz4tw3oj689k6]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:30:46.331Z"}
{"level":"debug","message":"Executing query [m8p2knr0jhzqhjkxxy]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:30:46.332Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:30:46.333Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:46.521Z"}
{"level":"debug","message":"Executing query [m8p2knwcbb68gmbf3ov]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:30:46.525Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:30:46.534Z"}
{"level":"debug","message":"Executing query [m8p2knwnyxtdwgbicda]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:30:46.535Z"}
{"level":"debug","message":"Executing query [m8p2knwo8sq9afrtyta]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T22:30:46.536Z"}
{"level":"debug","message":"Executing query [m8p2knwqwi4q8nua72h]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T22:30:46.538Z"}
{"level":"debug","message":"Executing query [m8p2knwra5nl02rkne]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","timestamp":"2025-03-25T22:30:46.539Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'NivelAcceso' in 'field list'","level":"error","message":"Database query error [m8p2knwra5nl02rkne]","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","query":"INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:30:46.541Z"}
{"level":"error","message":"Error en la configuración de las pruebas de papelera: Unknown column 'NivelAcceso' in 'field list'","timestamp":"2025-03-25T22:30:46.542Z"}
{"level":"debug","message":"Executing query [m8p2knwyaccj92oc5uf]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:30:46.546Z"}
{"level":"debug","message":"Executing query [m8p2knwzvpzbn3cad88]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:30:46.547Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p2knwzvpzbn3cad88]","params":"[\"TESTPAP123\"]","query":"DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","timestamp":"2025-03-25T22:30:46.548Z"}
{"level":"error","message":"Error al eliminar usuario TESTPAP123: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:30:46.549Z"}
{"level":"debug","message":"Executing query [m8p2knx1y1w8e9xsi5c]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:30:46.549Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:30:46.550Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:46.682Z"}
{"level":"debug","message":"Executing query [m8p2ko0w2ad97bwz3rp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:30:46.688Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:30:46.698Z"}
{"level":"debug","message":"Executing query [m8p2ko17jngj367t16]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:30:46.699Z"}
{"level":"debug","message":"Executing query [m8p2ko18mqhyo2pw61]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:30:46.700Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T22:30:46.701Z"}
{"level":"debug","message":"Executing query [m8p2ko1a2xtwceo01v7]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T22:30:46.702Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p2ko1a2xtwceo01v7]","params":"[999,999]","query":"DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","timestamp":"2025-03-25T22:30:46.703Z"}
{"level":"debug","message":"Error al limpiar datos previos: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:30:46.703Z"}
{"level":"debug","message":"Executing query [m8p2ko1dk5ejsergnq]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T22:30:46.705Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p2ko1dk5ejsergnq]","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","query":"INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:30:46.706Z"}
{"level":"error","message":"Error al crear permiso contextual: Table 'oficri_sistema.permisocontextual' doesn't exist","timestamp":"2025-03-25T22:30:46.706Z"}
{"level":"debug","message":"Executing query [m8p2ko1ghimbkqc63l]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[null]","timestamp":"2025-03-25T22:30:46.708Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p2ko1ghimbkqc63l]","params":"[null]","query":"SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","timestamp":"2025-03-25T22:30:46.710Z"}
{"level":"error","message":"Error al obtener permiso contextual desde vista: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:30:46.710Z"}
{"level":"debug","message":"Executing query [m8p2ko1lmj8n2t9aec]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:30:46.713Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:30:46.714Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:46.884Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:47.298Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:30:47.358Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:30:47.411Z"}
{"level":"debug","message":"Executing query [m8p2kom5ckt2m0x1lw7]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T22:30:47.453Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p2kom5ckt2m0x1lw7]","params":"[]","query":"SELECT * FROM v_permisos_contextuales","timestamp":"2025-03-25T22:30:47.457Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:30:47.458Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:30:47.458Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:30:47.490Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:47.705Z"}
{"level":"debug","message":"Executing query [m8p2kot8cpbm6hgh3wu]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:30:47.708Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:30:47.717Z"}
{"level":"debug","message":"Executing query [m8p2kotj6dizirrivgn]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:30:47.719Z"}
{"level":"debug","message":"Executing query [m8p2kotlui36n7apkv]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742941847707\"]","timestamp":"2025-03-25T22:30:47.721Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2kotlui36n7apkv]","params":"[\"TEST-QUIMICA-1742941847707\"]","query":"DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:30:47.722Z"}
{"level":"debug","message":"Executing query [m8p2kotpamuzl4s50f4]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742941847707\"]","timestamp":"2025-03-25T22:30:47.725Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2kotpamuzl4s50f4]","params":"[\"TEST-QUIMICA-1742941847707\"]","query":"SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:30:47.726Z"}
{"level":"debug","message":"Executing query [m8p2kottzgbtbyfz6t]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:30:47.729Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:30:47.733Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:49.849Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:30:49.853Z"}
{"level":"debug","message":"Executing query [m8p2kqgu1sjbp7ghxaj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:30:49.854Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:30:49.865Z"}
{"level":"debug","message":"Executing query [m8p2kqh65vzj47d2lsj]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:30:49.866Z"}
{"level":"debug","message":"Executing query [m8p2kqh7nlixof55xam]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:30:49.867Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T22:30:49.868Z"}
{"level":"debug","message":"Executing query [m8p2kqh8qkkg2yoakdb]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:30:49.868Z"}
{"level":"debug","message":"Executing query [m8p2kqh9cy8c5qsblwq]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:30:49.869Z"}
{"level":"debug","message":"Executing query [m8p2kqhc2yxjaoyyd5s]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:30:49.872Z"}
{"level":"debug","message":"Executing query [m8p2kqhdl9qbv4z2uqo]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T22:30:49.873Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'Grado' in 'field list'","level":"error","message":"Database query error [m8p2kqhdl9qbv4z2uqo]","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:30:49.874Z"}
{"level":"error","message":"Error al crear usuario: Unknown column 'Grado' in 'field list'","timestamp":"2025-03-25T22:30:49.874Z"}
{"level":"debug","message":"Executing query [m8p2kqhhujyfwq8v7uj]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:30:49.877Z"}
{"level":"error","message":"Error al obtener usuario por CIP: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveLength\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected length: \u001b[32m1\u001b[39m\nReceived length: \u001b[31m0\u001b[39m\nReceived array:  \u001b[31m[]\u001b[39m","timestamp":"2025-03-25T22:30:49.880Z"}
{"level":"debug","message":"Executing query [m8p2kqhmds0vouwtdzj]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:30:49.882Z"}
{"level":"debug","message":"Executing query [m8p2kqhnhaku6y2zmih]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:30:49.883Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T22:30:49.884Z"}
{"level":"debug","message":"Executing query [m8p2kqhp8aukv0skrzj]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:30:49.885Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:30:49.886Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:31:19.469Z"}
{"level":"debug","message":"Executing query [m8p2ldc444yty21wndm]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:31:19.492Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:31:19.521Z"}
{"level":"debug","message":"Executing query [m8p2ldd0b8iywrlvpyt]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:31:19.524Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2ldd0b8iywrlvpyt]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:31:19.527Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:31:19.528Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:34:23.823Z"}
{"level":"debug","message":"Executing query [m8p2pbl3uqa01bogv]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:34:23.847Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:34:23.881Z"}
{"level":"debug","message":"Executing query [m8p2pbm4kofdb2glp7d]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:34:23.884Z"}
{"level":"debug","message":"Executing query [m8p2pbma8husrpo4nsb]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742942063845\"]","timestamp":"2025-03-25T22:34:23.890Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2pbma8husrpo4nsb]","params":"[\"TEST-QUIMICA-1742942063845\"]","query":"DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:34:23.892Z"}
{"level":"debug","message":"Executing query [m8p2pbmj0hbjnhry1pm6]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742942063845\"]","timestamp":"2025-03-25T22:34:23.899Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2pbmj0hbjnhry1pm6]","params":"[\"TEST-QUIMICA-1742942063845\"]","query":"SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:34:23.901Z"}
{"level":"debug","message":"Executing query [m8p2pbmpdpz9xs23k9n]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:34:23.905Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:34:23.907Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:35:24.147Z"}
{"level":"debug","message":"Executing query [m8p2qm4rp4mu8dna5lr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:35:24.171Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:35:24.200Z"}
{"level":"debug","message":"Executing query [m8p2qm5nx5l90arubdf]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:35:24.203Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2qm5nx5l90arubdf]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:35:24.205Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:35:24.207Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:36:01.296Z"}
{"level":"debug","message":"Executing query [m8p2resokkhmdr87iu]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:36:01.321Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:36:01.354Z"}
{"level":"debug","message":"Executing query [m8p2retp3h15467v9d3]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:36:01.357Z"}
{"level":"debug","message":"Executing query [m8p2retuv3p5yq0ztke]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742942161318\"]","timestamp":"2025-03-25T22:36:01.362Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2retuv3p5yq0ztke]","params":"[\"TEST-DOSAJE-1742942161318\"]","query":"DELETE FROM Dosaje WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:36:01.364Z"}
{"level":"debug","message":"Executing query [m8p2reu3ot0u8zntys]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742942161318\"]","timestamp":"2025-03-25T22:36:01.371Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2reu3ot0u8zntys]","params":"[\"TEST-DOSAJE-1742942161318\"]","query":"SELECT * FROM Dosaje WHERE NumeroRegistro = ?","timestamp":"2025-03-25T22:36:01.373Z"}
{"level":"debug","message":"Executing query [m8p2reu9l388cawcers]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742942161377\",\"TEST-SP-OFICIO-1742942161377\",8852,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T22:36:01.377Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2reu9l388cawcers]","params":"[1,\"TEST-SP-DOSAJE-1742942161377\",\"TEST-SP-OFICIO-1742942161377\",8852,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","query":"CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:36:01.379Z"}
{"level":"debug","message":"Executing query [m8p2reue6kf7utgaxwu]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:36:01.382Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:36:01.384Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:37:06.807Z"}
{"level":"debug","message":"Executing query [m8p2stcjw7218zf4bpb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:37:06.835Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:37:06.868Z"}
{"level":"debug","message":"Executing query [m8p2stdjmxu4xfgkyjm]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:37:06.872Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2stdjmxu4xfgkyjm]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:37:06.874Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:37:06.875Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:38:23.596Z"}
{"level":"debug","message":"Executing query [m8p2uglk76l01frzagh]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:23.624Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:38:23.658Z"}
{"level":"debug","message":"Executing query [m8p2ugmnbija2f5dptb]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:23.663Z"}
{"level":"debug","message":"Executing query [m8p2ugmsst25for5yaa]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:23.668Z"}
{"level":"debug","message":"Executing query [m8p2ugmxqts54zrxyai]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:23.673Z"}
{"level":"debug","message":"Executing query [m8p2ugmz99p8tk9h99v]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:23.675Z"}
{"level":"debug","message":"Executing query [m8p2ugn0mopjvqolms]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:23.676Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8p2ugn0mopjvqolms]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-25T22:38:23.678Z"}
{"level":"warn","message":"La tabla 'DocumentoArchivo' no existe en la base de datos.","timestamp":"2025-03-25T22:38:23.679Z"}
{"level":"debug","message":"Executing query [m8p2ugn36c1tib8ixt4]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:23.679Z"}
{"level":"debug","message":"Executing query [m8p2ugn5wunvetnvu6o]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:23.681Z"}
{"level":"debug","message":"Executing query [m8p2ugn6uyzxn6cmtxs]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:23.682Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p2ugn6uyzxn6cmtxs]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T22:38:23.684Z"}
{"level":"warn","message":"La tabla 'Papelera' no existe en la base de datos.","timestamp":"2025-03-25T22:38:23.685Z"}
{"level":"debug","message":"Executing query [m8p2ugn9769bicbze8g]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:23.685Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2ugn9769bicbze8g]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:38:23.686Z"}
{"level":"warn","message":"La tabla 'ForenseDigital' no existe en la base de datos.","timestamp":"2025-03-25T22:38:23.687Z"}
{"level":"debug","message":"Executing query [m8p2ugnboea8nxz2gfj]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:23.687Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2ugnboea8nxz2gfj]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:38:23.688Z"}
{"level":"warn","message":"La tabla 'QuimicaToxicologiaForense' no existe en la base de datos.","timestamp":"2025-03-25T22:38:23.689Z"}
{"level":"debug","message":"Executing query [m8p2ugndhf3tu6s8fze]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:23.689Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2ugndhf3tu6s8fze]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:38:23.690Z"}
{"level":"warn","message":"La tabla 'Dosaje' no existe en la base de datos.","timestamp":"2025-03-25T22:38:23.691Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:38:23.748Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:38:37.353Z"}
{"level":"debug","message":"Executing query [m8p2ur7nuzt0n26itur]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:37.379Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:38:37.411Z"}
{"level":"debug","message":"Executing query [m8p2ur8o9k51kllq7eb]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:37.416Z"}
{"level":"debug","message":"Executing query [m8p2ur8q6trm6jaqzby]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:37.418Z"}
{"level":"debug","message":"Executing query [m8p2ur8tezjea23s7a]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:37.421Z"}
{"level":"debug","message":"Executing query [m8p2ur8vipnio7fi7en]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:37.423Z"}
{"level":"debug","message":"Executing query [m8p2ur8wyjjsr3ibj3]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:37.424Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8p2ur8wyjjsr3ibj3]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-25T22:38:37.426Z"}
{"level":"warn","message":"La tabla 'DocumentoArchivo' no existe en la base de datos.","timestamp":"2025-03-25T22:38:37.427Z"}
{"level":"debug","message":"Executing query [m8p2ur8zwgtb07xnm1l]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:37.427Z"}
{"level":"debug","message":"Executing query [m8p2ur91lxan8qklh6l]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:37.429Z"}
{"level":"debug","message":"Executing query [m8p2ur924dhw3eedk9t]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:37.430Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p2ur924dhw3eedk9t]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T22:38:37.431Z"}
{"level":"warn","message":"La tabla 'Papelera' no existe en la base de datos.","timestamp":"2025-03-25T22:38:37.432Z"}
{"level":"debug","message":"Executing query [m8p2ur944a7m4wctoav]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:37.432Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2ur944a7m4wctoav]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:38:37.435Z"}
{"level":"warn","message":"La tabla 'ForenseDigital' no existe en la base de datos.","timestamp":"2025-03-25T22:38:37.435Z"}
{"level":"debug","message":"Executing query [m8p2ur98r1foul7h30c]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:37.436Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2ur98r1foul7h30c]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:38:37.437Z"}
{"level":"warn","message":"La tabla 'QuimicaToxicologiaForense' no existe en la base de datos.","timestamp":"2025-03-25T22:38:37.438Z"}
{"level":"debug","message":"Executing query [m8p2ur9aihfpk5yznlh]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:38:37.438Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2ur9aihfpk5yznlh]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:38:37.440Z"}
{"level":"warn","message":"La tabla 'Dosaje' no existe en la base de datos.","timestamp":"2025-03-25T22:38:37.440Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:38:37.494Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:39:14.061Z"}
{"level":"debug","message":"Executing query [m8p2vjjwfgd2pde55k]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:14.109Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:39:14.144Z"}
{"level":"debug","message":"Executing query [m8p2vjl3zd79bae5gdr]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:14.151Z"}
{"level":"debug","message":"Executing query [m8p2vjl5fy7o4hofyie]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:14.153Z"}
{"level":"debug","message":"Executing query [m8p2vjl9e81o2570jih]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:14.157Z"}
{"level":"debug","message":"Executing query [m8p2vjlbn100beakk2]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:14.159Z"}
{"level":"debug","message":"Executing query [m8p2vjldm7ngqte4jon]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:14.161Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8p2vjldm7ngqte4jon]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-25T22:39:14.164Z"}
{"level":"warn","message":"La tabla 'DocumentoArchivo' no existe en la base de datos.","timestamp":"2025-03-25T22:39:14.166Z"}
{"level":"debug","message":"Executing query [m8p2vjlinkp5oqjwjdn]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:14.166Z"}
{"level":"debug","message":"Executing query [m8p2vjlm3ac1t3qg4px]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:14.170Z"}
{"level":"debug","message":"Executing query [m8p2vjlpka5b3paz4a]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:14.173Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p2vjlpka5b3paz4a]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T22:39:14.174Z"}
{"level":"warn","message":"La tabla 'Papelera' no existe en la base de datos.","timestamp":"2025-03-25T22:39:14.176Z"}
{"level":"debug","message":"Executing query [m8p2vjltao6gbpvnbya]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:14.177Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2vjltao6gbpvnbya]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:39:14.179Z"}
{"level":"warn","message":"La tabla 'ForenseDigital' no existe en la base de datos.","timestamp":"2025-03-25T22:39:14.180Z"}
{"level":"debug","message":"Executing query [m8p2vjlxj9qgbea7pgs]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:14.181Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2vjlxj9qgbea7pgs]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:39:14.182Z"}
{"level":"warn","message":"La tabla 'QuimicaToxicologiaForense' no existe en la base de datos.","timestamp":"2025-03-25T22:39:14.184Z"}
{"level":"debug","message":"Executing query [m8p2vjm0pdnjlu8381f]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:14.184Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2vjm0pdnjlu8381f]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:39:14.186Z"}
{"level":"warn","message":"La tabla 'Dosaje' no existe en la base de datos.","timestamp":"2025-03-25T22:39:14.187Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:39:14.202Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:39:33.464Z"}
{"level":"debug","message":"Executing query [m8p2vyisdurncr0cfib]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:33.508Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:39:33.543Z"}
{"level":"debug","message":"Executing query [m8p2vyjzjxx4okt8ki]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:33.551Z"}
{"level":"debug","message":"Executing query [m8p2vyk351d82i8nlhu]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:33.555Z"}
{"level":"debug","message":"Executing query [m8p2vyk544azisj3h3o]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:33.557Z"}
{"level":"debug","message":"Executing query [m8p2vyk9b8yru72drvj]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:33.561Z"}
{"level":"debug","message":"Executing query [m8p2vykbsm2s7om08n]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:33.563Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8p2vykbsm2s7om08n]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-25T22:39:33.565Z"}
{"level":"warn","message":"La tabla 'DocumentoArchivo' no existe en la base de datos.","timestamp":"2025-03-25T22:39:33.567Z"}
{"level":"debug","message":"Executing query [m8p2vykgk69nm6mad2g]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:33.568Z"}
{"level":"debug","message":"Executing query [m8p2vyki10q8xuzidnc]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:33.570Z"}
{"level":"debug","message":"Executing query [m8p2vyklil93ob5bptj]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:33.573Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p2vyklil93ob5bptj]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T22:39:33.575Z"}
{"level":"warn","message":"La tabla 'Papelera' no existe en la base de datos.","timestamp":"2025-03-25T22:39:33.576Z"}
{"level":"debug","message":"Executing query [m8p2vyko4s9zy6f4c3p]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:33.576Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2vyko4s9zy6f4c3p]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:39:33.577Z"}
{"level":"warn","message":"La tabla 'ForenseDigital' no existe en la base de datos.","timestamp":"2025-03-25T22:39:33.579Z"}
{"level":"debug","message":"Executing query [m8p2vykse35go400ykb]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:33.580Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2vykse35go400ykb]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:39:33.581Z"}
{"level":"warn","message":"La tabla 'QuimicaToxicologiaForense' no existe en la base de datos.","timestamp":"2025-03-25T22:39:33.583Z"}
{"level":"debug","message":"Executing query [m8p2vykvn8sjcabbl1]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:39:33.583Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2vykvn8sjcabbl1]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:39:33.584Z"}
{"level":"warn","message":"La tabla 'Dosaje' no existe en la base de datos.","timestamp":"2025-03-25T22:39:33.586Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:39:33.603Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:40:19.298Z"}
{"level":"debug","message":"Executing query [m8p2wxvf11ltokgk1p69]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T22:40:19.324Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:40:19.354Z"}
{"level":"debug","message":"Executing query [m8p2wxwfr3tw9wnx5nh]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-25T22:40:19.359Z"}
{"level":"debug","message":"Executing query [m8p2wxwicgul0qeeyjv]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-25T22:40:19.362Z"}
{"level":"debug","message":"Executing query [m8p2wxwkql5gxbe8g1]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:40:19.365Z"}
{"level":"debug","message":"Executing query [m8p2wxwm8sdfmfujaa]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:40:19.367Z"}
{"level":"debug","message":"Executing query [m8p2wxwowi07ibvsos9]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-25T22:40:19.368Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8p2wxwowi07ibvsos9]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-25T22:40:19.370Z"}
{"level":"warn","message":"La tabla 'DocumentoArchivo' no existe en la base de datos.","timestamp":"2025-03-25T22:40:19.372Z"}
{"level":"debug","message":"Executing query [m8p2wxwsavpshy9uvb7]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-25T22:40:19.372Z"}
{"level":"debug","message":"Executing query [m8p2wxwu5zexs1fxsyc]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:40:19.374Z"}
{"level":"debug","message":"Executing query [m8p2wxwwwy80g1xx5a]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T22:40:19.376Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p2wxwwwy80g1xx5a]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T22:40:19.378Z"}
{"level":"warn","message":"La tabla 'Papelera' no existe en la base de datos.","timestamp":"2025-03-25T22:40:19.379Z"}
{"level":"debug","message":"Executing query [m8p2wxwz6bwwxn9s6z5]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:40:19.379Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p2wxwz6bwwxn9s6z5]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:40:19.380Z"}
{"level":"warn","message":"La tabla 'ForenseDigital' no existe en la base de datos.","timestamp":"2025-03-25T22:40:19.381Z"}
{"level":"debug","message":"Executing query [m8p2wxx2ohrjl07qpmk]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:40:19.382Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p2wxx2ohrjl07qpmk]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:40:19.383Z"}
{"level":"warn","message":"La tabla 'QuimicaToxicologiaForense' no existe en la base de datos.","timestamp":"2025-03-25T22:40:19.383Z"}
{"level":"debug","message":"Executing query [m8p2wxx480xf2vxixhj]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:40:19.384Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p2wxx480xf2vxixhj]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:40:19.385Z"}
{"level":"warn","message":"La tabla 'Dosaje' no existe en la base de datos.","timestamp":"2025-03-25T22:40:19.386Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:40:19.394Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:42:43.788Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:42:43.802Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:42:43.806Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:42:43.818Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:42:43.824Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:42:43.830Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:42:43.833Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:42:43.840Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:42:43.841Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:42:43.843Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:42:43.845Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T22:42:43.847Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:44.011Z"}
{"level":"debug","message":"Executing query [m8p301kgs217ngpex]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:42:44.080Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:42:44.132Z"}
{"level":"debug","message":"Executing query [m8p301m0a98d0rzffdu]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742942564077\"]","timestamp":"2025-03-25T22:42:44.136Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:44.096Z"}
{"level":"debug","message":"Executing query [m8p301mkjonlv64ecvf]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742942564077\"]","timestamp":"2025-03-25T22:42:44.156Z"}
{"level":"debug","message":"Executing query [m8p301mnhcuji3jyc0l]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742942564077\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:42:44.159Z"}
{"level":"debug","message":"Executing query [m8p301mxa2vts4bwucs]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T22:42:44.169Z"}
{"level":"debug","message":"Executing query [m8p301n1jvwfsi2xhym]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742942564077\"]","timestamp":"2025-03-25T22:42:44.173Z"}
{"level":"debug","message":"Executing query [m8p301n5nse1ackn7k8]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1006]","timestamp":"2025-03-25T22:42:44.177Z"}
{"level":"debug","message":"Executing query [m8p301nc06e7rycq5gjm]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T22:42:44.184Z"}
{"level":"debug","message":"Executing query [m8p301nfugj9xb3dg09]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T22:42:44.187Z"}
{"level":"debug","message":"Executing query [m8p301nlt1hkmyszx1]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T22:42:44.193Z"}
{"level":"debug","message":"Executing query [m8p301npw3fzqgbo6xc]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T22:42:44.197Z"}
{"level":"debug","message":"Executing query [m8p301nrlyklce3fmm]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T22:42:44.199Z"}
{"level":"debug","message":"Executing query [m8p301nva1minbmews8]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T22:42:44.203Z"}
{"level":"debug","message":"Executing query [m8p301nxgdea2osqsaj]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:42:44.205Z"}
{"level":"debug","message":"Executing query [m8p301o0qquvjojn40j]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:42:44.208Z"}
{"level":"debug","message":"Executing query [m8p301mc3rc2bmtiubp]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:44.148Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:42:44.213Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:42:44.211Z"}
{"level":"debug","message":"Executing query [m8p301oc73v0vsdruuu]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:44.221Z"}
{"level":"debug","message":"Executing query [m8p301of8bjpgzliqu]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:44.224Z"}
{"level":"debug","message":"Executing query [m8p301okhy2ra41qokr]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:44.228Z"}
{"level":"debug","message":"Executing query [m8p301omahgrka91p3k]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:44.230Z"}
{"level":"debug","message":"Executing query [m8p301op23vn5t0k0dc]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:44.233Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8p301op23vn5t0k0dc]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-25T22:42:44.240Z"}
{"level":"warn","message":"La tabla 'DocumentoArchivo' no existe en la base de datos.","timestamp":"2025-03-25T22:42:44.241Z"}
{"level":"debug","message":"Executing query [m8p301oxne3xwu0btm]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:44.241Z"}
{"level":"debug","message":"Executing query [m8p301oz82pxo1z0jtx]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:44.243Z"}
{"level":"debug","message":"Executing query [m8p301p1ylkhysf63w]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:44.246Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p301p1ylkhysf63w]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T22:42:44.248Z"}
{"level":"warn","message":"La tabla 'Papelera' no existe en la base de datos.","timestamp":"2025-03-25T22:42:44.248Z"}
{"level":"debug","message":"Executing query [m8p301p5vhd2ok5f8l]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:44.249Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p301p5vhd2ok5f8l]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:42:44.252Z"}
{"level":"warn","message":"La tabla 'ForenseDigital' no existe en la base de datos.","timestamp":"2025-03-25T22:42:44.252Z"}
{"level":"debug","message":"Executing query [m8p301p8zkor6mipu4h]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:44.252Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p301p8zkor6mipu4h]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:42:44.254Z"}
{"level":"warn","message":"La tabla 'QuimicaToxicologiaForense' no existe en la base de datos.","timestamp":"2025-03-25T22:42:44.254Z"}
{"level":"debug","message":"Executing query [m8p301pbrdmwib7yx3]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:44.255Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p301pbrdmwib7yx3]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:42:44.256Z"}
{"level":"warn","message":"La tabla 'Dosaje' no existe en la base de datos.","timestamp":"2025-03-25T22:42:44.256Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:42:44.277Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:44.338Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:44.145Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:42:44.439Z"}
{"level":"debug","message":"Executing query [m8p301ulw1ye6a2r2bk]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T22:42:44.445Z"}
{"level":"debug","message":"Executing query [m8p301unidgqitb98p]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T22:42:44.447Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p301unidgqitb98p]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T22:42:44.449Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:42:44.452Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:44.423Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T22:42:44.404Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:44.464Z"}
{"level":"debug","message":"Executing query [m8p301wy6dmeq29jii4]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:42:44.530Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:44.533Z"}
{"level":"debug","message":"Executing query [m8p301x915sqiqia2nz]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:42:44.541Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:42:44.559Z"}
{"level":"debug","message":"Executing query [m8p301xtk4epiwfk91]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:44.561Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p301xtk4epiwfk91]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:42:44.563Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:42:44.563Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:42:44.591Z"}
{"level":"debug","message":"Executing query [m8p301yv1g0mmwsly25j]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:44.599Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T22:42:44.603Z"}
{"level":"debug","message":"Executing query [m8p301yzi2u49zdwbz]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T22:42:44.603Z"}
{"level":"debug","message":"Executing query [m8p301z3zm46lkd2iq]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T22:42:44.607Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T22:42:44.610Z"}
{"level":"debug","message":"Executing query [m8p301z7hrmukp7oofc]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:44.611Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:44.684Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T22:42:44.613Z"}
{"level":"debug","message":"Executing query [m8p3021fbjo8yqv17q]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T22:42:44.691Z"}
{"level":"debug","message":"Executing query [m8p3021kxgdofe9gxv]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T22:42:44.696Z"}
{"level":"debug","message":"Executing query [m8p3021orzmida7f1i]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:42:44.700Z"}
{"level":"debug","message":"Executing query [m8p3021bgb78qr5fwlg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:42:44.688Z"}
{"level":"debug","message":"Executing query [m8p3021u026m9l3e6r2q]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:44.706Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:42:44.708Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p3021u026m9l3e6r2q]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:42:44.709Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:42:44.709Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T22:42:44.600Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T22:42:44.795Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:45.054Z"}
{"level":"debug","message":"Executing query [m8p302blj6bs92qkqf]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:42:45.057Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:42:45.072Z"}
{"level":"debug","message":"Executing query [m8p302c2q6wc9loenzj]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:42:45.074Z"}
{"level":"debug","message":"Executing query [m8p302c49ovrgphd9mr]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:42:45.076Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T22:42:45.077Z"}
{"level":"debug","message":"Executing query [m8p302c63hv2yhr8iv7]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T22:42:45.078Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p302c63hv2yhr8iv7]","params":"[999,999]","query":"DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","timestamp":"2025-03-25T22:42:45.079Z"}
{"level":"debug","message":"Error al limpiar datos previos: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:42:45.080Z"}
{"level":"debug","message":"Executing query [m8p302c94m31gujlh1e]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T22:42:45.081Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p302c94m31gujlh1e]","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","query":"INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:42:45.082Z"}
{"level":"error","message":"Error al crear permiso contextual: Table 'oficri_sistema.permisocontextual' doesn't exist","timestamp":"2025-03-25T22:42:45.083Z"}
{"level":"debug","message":"Executing query [m8p302cgd72ppl2jm8]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[null]","timestamp":"2025-03-25T22:42:45.088Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p302cgd72ppl2jm8]","params":"[null]","query":"SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","timestamp":"2025-03-25T22:42:45.090Z"}
{"level":"error","message":"Error al obtener permiso contextual desde vista: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:42:45.090Z"}
{"level":"debug","message":"Executing query [m8p302ck1oemsgvn7l3]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:42:45.092Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:42:45.094Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T22:42:44.799Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T22:42:44.800Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T22:42:44.801Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T22:42:44.807Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T22:42:44.807Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:45.068Z"}
{"level":"debug","message":"Executing query [m8p302cz3wzcxw7ehlg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:42:45.107Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:42:45.160Z"}
{"level":"debug","message":"Executing query [m8p302eixdflk80zys]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:42:45.162Z"}
{"level":"debug","message":"Executing query [m8p302enjrw5af980yf]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T22:42:45.167Z"}
{"level":"debug","message":"Executing query [m8p302equfydbzv5zy]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T22:42:45.170Z"}
{"level":"debug","message":"Executing query [m8p302esknxwzuwpl1]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","timestamp":"2025-03-25T22:42:45.172Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'NivelAcceso' in 'field list'","level":"error","message":"Database query error [m8p302esknxwzuwpl1]","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","query":"INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:42:45.175Z"}
{"level":"error","message":"Error en la configuración de las pruebas de papelera: Unknown column 'NivelAcceso' in 'field list'","timestamp":"2025-03-25T22:42:45.176Z"}
{"level":"debug","message":"Executing query [m8p302f01oejcf6rtd0i]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:42:45.180Z"}
{"level":"debug","message":"Executing query [m8p302f290ofyn14cr]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:42:45.182Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:45.173Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p302f290ofyn14cr]","params":"[\"TESTPAP123\"]","query":"DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","timestamp":"2025-03-25T22:42:45.184Z"}
{"level":"error","message":"Error al eliminar usuario TESTPAP123: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:42:45.184Z"}
{"level":"debug","message":"Executing query [m8p302f475qo1hzasz4]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:42:45.185Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:42:45.187Z"}
{"level":"debug","message":"Executing query [m8p302exi2r7jd00gni]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:42:45.177Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:42:45.229Z"}
{"level":"debug","message":"Executing query [m8p302gjzhko9xvyb1]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:42:45.236Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p302gjzhko9xvyb1]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:42:45.239Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:42:45.240Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:45.198Z"}
{"level":"debug","message":"Executing query [m8p302h6iq2sos9mvhs]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:42:45.258Z"}
{"level":"debug","message":"Executing query [m8p302kkdtc093fujlh]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742942565254\"]","timestamp":"2025-03-25T22:42:45.380Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:42:45.382Z"}
{"level":"debug","message":"Executing query [m8p302kn3936qm5gub8]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742942565254\",true]","timestamp":"2025-03-25T22:42:45.383Z"}
{"level":"debug","message":"Executing query [m8p302kyzx3p9u6hdn]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[8]","timestamp":"2025-03-25T22:42:45.394Z"}
{"level":"debug","message":"Executing query [m8p302l40neile2nedvq]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742942565254\"]","timestamp":"2025-03-25T22:42:45.400Z"}
{"level":"debug","message":"Executing query [m8p302l78h9lru2gqz]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",8]","timestamp":"2025-03-25T22:42:45.404Z"}
{"level":"debug","message":"Executing query [m8p302lbuvrp2ysasd]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[8]","timestamp":"2025-03-25T22:42:45.407Z"}
{"level":"debug","message":"Executing query [m8p302lfekn9e23nms]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[8]","timestamp":"2025-03-25T22:42:45.411Z"}
{"level":"debug","message":"Executing query [m8p302lj2jz26d7ksap]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[8]","timestamp":"2025-03-25T22:42:45.415Z"}
{"level":"debug","message":"Executing query [m8p302lmwywggaqqs9l]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[8]","timestamp":"2025-03-25T22:42:45.418Z"}
{"level":"debug","message":"Executing query [m8p302lom9tciknecd]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[8]","timestamp":"2025-03-25T22:42:45.420Z"}
{"level":"debug","message":"Executing query [m8p302lsak8x9nuiq9]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[8]","timestamp":"2025-03-25T22:42:45.424Z"}
{"level":"debug","message":"Executing query [m8p302lts2wk2ypwbvq]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:42:45.426Z"}
{"level":"debug","message":"Executing query [m8p302lv587sur2nphd]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:42:45.427Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:42:45.430Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:45.564Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:45.689Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:45.739Z"}
{"level":"debug","message":"Executing query [m8p302umknt6fl7psw]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:42:45.742Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:42:45.798Z"}
{"level":"debug","message":"Executing query [m8p302w9dh6bavteca6]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:42:45.801Z"}
{"level":"debug","message":"Executing query [m8p302wda068dsmzswa]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:42:45.805Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T22:42:45.807Z"}
{"level":"debug","message":"Executing query [m8p302wfg70jhs3hvx9]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:42:45.807Z"}
{"level":"debug","message":"Executing query [m8p302whijhv1i2yz9n]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:42:45.809Z"}
{"level":"debug","message":"Executing query [m8p302wj15ihh4m8z9h]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:42:45.811Z"}
{"level":"debug","message":"Executing query [m8p302wlqqh248axqq]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T22:42:45.813Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'Grado' in 'field list'","level":"error","message":"Database query error [m8p302wlqqh248axqq]","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:42:45.814Z"}
{"level":"error","message":"Error al crear usuario: Unknown column 'Grado' in 'field list'","timestamp":"2025-03-25T22:42:45.815Z"}
{"level":"debug","message":"Executing query [m8p302wrizyj015sjv]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:42:45.819Z"}
{"level":"error","message":"Error al obtener usuario por CIP: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveLength\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected length: \u001b[32m1\u001b[39m\nReceived length: \u001b[31m0\u001b[39m\nReceived array:  \u001b[31m[]\u001b[39m","timestamp":"2025-03-25T22:42:45.822Z"}
{"level":"debug","message":"Executing query [m8p302wwr3pceqkblf9]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:42:45.824Z"}
{"level":"debug","message":"Executing query [m8p302wyculhm34m3t]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:42:45.826Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T22:42:45.828Z"}
{"level":"debug","message":"Executing query [m8p302x0tv8b5ofky2d]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:42:45.828Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:42:45.830Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:45.816Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:42:46.054Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T22:42:46.067Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:42:46.238Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T22:42:46.269Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:42:46.326Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:46.413Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:42:46.590Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:42:46.714Z"}
{"level":"debug","message":"Executing query [m8p303msobgumbok22k]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T22:42:46.756Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p303msobgumbok22k]","params":"[]","query":"SELECT * FROM v_permisos_contextuales","timestamp":"2025-03-25T22:42:46.757Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:42:46.758Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:42:46.758Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:42:46.794Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:47.474Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:42:47.616Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:42:47.619Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:42:47.504Z"}
{"duration":"26ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T22:42:47.732Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:42:47.733Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T22:42:47.737Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:42:47.741Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:43:05.633Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:43:05.652Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:43:05.664Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:43:05.667Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:43:05.672Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:43:05.675Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T22:43:05.680Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:43:05.685Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:43:05.687Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:43:05.689Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:43:05.691Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T22:43:05.693Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:05.883Z"}
{"level":"debug","message":"Executing query [m8p30ifr61xzdetwieq]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:43:05.943Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:43:05.998Z"}
{"level":"debug","message":"Executing query [m8p30iheowas27b8h7r]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742942585940\"]","timestamp":"2025-03-25T22:43:06.002Z"}
{"level":"debug","message":"Executing query [m8p30ii8a90b5l19woj]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742942585940\"]","timestamp":"2025-03-25T22:43:06.032Z"}
{"level":"debug","message":"Executing query [m8p30iiavm20jqpffwn]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742942585940\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:43:06.034Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:05.942Z"}
{"level":"debug","message":"Executing query [m8p30ih3ksw3o7qwy6]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:05.991Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:43:06.037Z"}
{"level":"debug","message":"Executing query [m8p30iijshe34ccnj1]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T22:43:06.043Z"}
{"level":"debug","message":"Executing query [m8p30iioqacptohje8q]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742942585940\"]","timestamp":"2025-03-25T22:43:06.048Z"}
{"level":"debug","message":"Executing query [m8p30iion536e75zyhn]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:06.048Z"}
{"level":"debug","message":"Executing query [m8p30iiqiv63as299f]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:06.050Z"}
{"level":"debug","message":"Executing query [m8p30iiruutz9p65ao]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1007]","timestamp":"2025-03-25T22:43:06.051Z"}
{"level":"debug","message":"Executing query [m8p30iis4eyr7ngjixf]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:06.052Z"}
{"level":"debug","message":"Executing query [m8p30iiu0z1gy0mqiu3]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:06.054Z"}
{"level":"debug","message":"Executing query [m8p30iiwzrv8ozlxi18]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:06.056Z"}
{"level":"debug","message":"Executing query [m8p30iixndsw8quej7k]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T22:43:06.057Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8p30iiwzrv8ozlxi18]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-25T22:43:06.058Z"}
{"level":"warn","message":"La tabla 'DocumentoArchivo' no existe en la base de datos.","timestamp":"2025-03-25T22:43:06.059Z"}
{"level":"debug","message":"Executing query [m8p30iizki7hcasicue]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:06.059Z"}
{"level":"debug","message":"Executing query [m8p30ij1r7mkw9n0i2]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T22:43:06.061Z"}
{"level":"debug","message":"Executing query [m8p30ij0jxzavawfrji]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:06.060Z"}
{"level":"debug","message":"Executing query [m8p30ij2xxaqsie0fms]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:06.062Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p30ij2xxaqsie0fms]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T22:43:06.064Z"}
{"level":"debug","message":"Executing query [m8p30ij5nkg9ctjzslf]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T22:43:06.065Z"}
{"level":"warn","message":"La tabla 'Papelera' no existe en la base de datos.","timestamp":"2025-03-25T22:43:06.064Z"}
{"level":"debug","message":"Executing query [m8p30ij5uhuch5kl55]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:06.065Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p30ij5uhuch5kl55]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:43:06.066Z"}
{"level":"warn","message":"La tabla 'ForenseDigital' no existe en la base de datos.","timestamp":"2025-03-25T22:43:06.067Z"}
{"level":"debug","message":"Executing query [m8p30ij7yceqv9fiue]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:06.067Z"}
{"level":"debug","message":"Executing query [m8p30ij8gar2aef0yxv]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T22:43:06.068Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p30ij7yceqv9fiue]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:43:06.068Z"}
{"level":"debug","message":"Executing query [m8p30ij990y7ayslmop]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T22:43:06.069Z"}
{"level":"warn","message":"La tabla 'QuimicaToxicologiaForense' no existe en la base de datos.","timestamp":"2025-03-25T22:43:06.069Z"}
{"level":"debug","message":"Executing query [m8p30ij9z57gk09jynn]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:06.069Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p30ij9z57gk09jynn]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:43:06.070Z"}
{"level":"debug","message":"Executing query [m8p30ijec7a3sdaqp2p]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T22:43:06.074Z"}
{"level":"debug","message":"Executing query [m8p30ijgoasm9aiaki]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:43:06.076Z"}
{"level":"debug","message":"Executing query [m8p30ijiuxknd9tkz07]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:43:06.078Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:43:06.081Z"}
{"level":"warn","message":"La tabla 'Dosaje' no existe en la base de datos.","timestamp":"2025-03-25T22:43:06.071Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:43:06.090Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:06.155Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:05.983Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:43:06.258Z"}
{"level":"debug","message":"Executing query [m8p30ioomqiycx9lo1]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T22:43:06.265Z"}
{"level":"debug","message":"Executing query [m8p30ioszpkxe6twjl]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T22:43:06.268Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p30ioszpkxe6twjl]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T22:43:06.270Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:43:06.272Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:06.266Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:06.283Z"}
{"level":"debug","message":"Executing query [m8p30iquvgfzrokl5a]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:43:06.342Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:43:06.389Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:06.385Z"}
{"level":"debug","message":"Executing query [m8p30isbkl2fq5t1s7]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:06.396Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T22:43:06.401Z"}
{"level":"debug","message":"Executing query [m8p30ishintiz4wl3t]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T22:43:06.401Z"}
{"level":"debug","message":"Executing query [m8p30iskgza97vhokqj]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T22:43:06.404Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T22:43:06.406Z"}
{"level":"debug","message":"Executing query [m8p30isn8tazrl6rmrb]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:06.407Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T22:43:06.409Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T22:43:06.301Z"}
{"level":"debug","message":"Executing query [m8p30is5u5xjzxkykl]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:43:06.390Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:43:06.420Z"}
{"level":"debug","message":"Executing query [m8p30it3fywf6ep586c]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:06.423Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p30it3fywf6ep586c]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:43:06.425Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:43:06.427Z"}
{"level":"debug","message":"Executing query [m8p30iulxyj1cjin50l]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T22:43:06.477Z"}
{"level":"debug","message":"Executing query [m8p30iv87jgiztk2j7k]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T22:43:06.500Z"}
{"level":"debug","message":"Executing query [m8p30ivgawjzbdrvgt]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:43:06.508Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T22:43:06.409Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:06.508Z"}
{"level":"debug","message":"Executing query [m8p30ivt211pos7irro]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:43:06.523Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:43:06.563Z"}
{"level":"debug","message":"Executing query [m8p30ix113yvtz4dmbic]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:06.565Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p30ix113yvtz4dmbic]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:43:06.567Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:43:06.567Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T22:43:06.697Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:06.941Z"}
{"level":"debug","message":"Executing query [m8p30j7k8yhfqhi6j4]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:43:06.944Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:43:06.963Z"}
{"level":"debug","message":"Executing query [m8p30j85o0oxyk6hxs]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:43:06.965Z"}
{"level":"debug","message":"Executing query [m8p30j87ku6aybh36dr]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:43:06.967Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T22:43:06.968Z"}
{"level":"debug","message":"Executing query [m8p30j8984lj3rgtst8]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T22:43:06.969Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p30j8984lj3rgtst8]","params":"[999,999]","query":"DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","timestamp":"2025-03-25T22:43:06.970Z"}
{"level":"debug","message":"Error al limpiar datos previos: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:43:06.971Z"}
{"level":"debug","message":"Executing query [m8p30j8co4eerqeh44a]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T22:43:06.972Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p30j8co4eerqeh44a]","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","query":"INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:43:06.974Z"}
{"level":"error","message":"Error al crear permiso contextual: Table 'oficri_sistema.permisocontextual' doesn't exist","timestamp":"2025-03-25T22:43:06.974Z"}
{"level":"debug","message":"Executing query [m8p30j8jfpa8w2pqto7]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[null]","timestamp":"2025-03-25T22:43:06.979Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p30j8jfpa8w2pqto7]","params":"[null]","query":"SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","timestamp":"2025-03-25T22:43:06.981Z"}
{"level":"error","message":"Error al obtener permiso contextual desde vista: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:43:06.982Z"}
{"level":"debug","message":"Executing query [m8p30j8nqsuog48z8qk]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:43:06.984Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:43:06.987Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:07.086Z"}
{"level":"debug","message":"Executing query [m8p30jbn28lxeai3l59]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:43:07.091Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:43:07.152Z"}
{"level":"debug","message":"Executing query [m8p30jdh436p23nq26m]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:43:07.157Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p30jdh436p23nq26m]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:43:07.161Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:43:07.161Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T22:43:06.698Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T22:43:06.699Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T22:43:06.700Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T22:43:06.701Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T22:43:06.701Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:07.060Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:07.212Z"}
{"level":"debug","message":"Executing query [m8p30jgddxdvmk0ho6]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:43:07.262Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:43:07.308Z"}
{"level":"debug","message":"Executing query [m8p30jhu33t7krhw5yt]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742942587260\"]","timestamp":"2025-03-25T22:43:07.314Z"}
{"level":"debug","message":"Executing query [m8p30jhw8xrke4ijon]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742942587260\",true]","timestamp":"2025-03-25T22:43:07.316Z"}
{"level":"debug","message":"Executing query [m8p30ji42ao331ytsmc]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T22:43:07.324Z"}
{"level":"debug","message":"Executing query [m8p30ji9me60xp0anu]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742942587260\"]","timestamp":"2025-03-25T22:43:07.329Z"}
{"level":"debug","message":"Executing query [m8p30jibdfr2vlb4hyt]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",9]","timestamp":"2025-03-25T22:43:07.331Z"}
{"level":"debug","message":"Executing query [m8p30jifiyvxumdkqq8]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T22:43:07.336Z"}
{"level":"debug","message":"Executing query [m8p30jijed2ak0qzz5h]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T22:43:07.339Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:07.287Z"}
{"level":"debug","message":"Executing query [m8p30jiofol1dpqlvff]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T22:43:07.344Z"}
{"level":"debug","message":"Executing query [m8p30jihql8wlggtu2l]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:43:07.337Z"}
{"level":"debug","message":"Executing query [m8p30jisx0pqct4wqho]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T22:43:07.348Z"}
{"level":"debug","message":"Executing query [m8p30jivb6fu7ru7728]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T22:43:07.351Z"}
{"level":"debug","message":"Executing query [m8p30jiz4xo6ta17k09]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T22:43:07.355Z"}
{"level":"debug","message":"Executing query [m8p30jj1qpn0f347frs]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:43:07.357Z"}
{"level":"debug","message":"Executing query [m8p30jj3yokkr56rdg]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:43:07.359Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:43:07.363Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:43:07.394Z"}
{"level":"debug","message":"Executing query [m8p30jk6dujptblrbaw]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:43:07.398Z"}
{"level":"debug","message":"Executing query [m8p30jkart7nx74d7yg]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T22:43:07.402Z"}
{"level":"debug","message":"Executing query [m8p30jkc0o2tbn8tocac]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T22:43:07.404Z"}
{"level":"debug","message":"Executing query [m8p30jke8hpw2r0hw0l]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","timestamp":"2025-03-25T22:43:07.406Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'NivelAcceso' in 'field list'","level":"error","message":"Database query error [m8p30jke8hpw2r0hw0l]","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","query":"INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:43:07.409Z"}
{"level":"error","message":"Error en la configuración de las pruebas de papelera: Unknown column 'NivelAcceso' in 'field list'","timestamp":"2025-03-25T22:43:07.409Z"}
{"level":"debug","message":"Executing query [m8p30jkm56513vvx34b]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:43:07.414Z"}
{"level":"debug","message":"Executing query [m8p30jkxjmn4u1m41uf]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:43:07.425Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p30jkxjmn4u1m41uf]","params":"[\"TESTPAP123\"]","query":"DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","timestamp":"2025-03-25T22:43:07.427Z"}
{"level":"error","message":"Error al eliminar usuario TESTPAP123: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:43:07.427Z"}
{"level":"debug","message":"Executing query [m8p30jkzpd4dygorq8r]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:43:07.427Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:43:07.430Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:07.742Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:07.788Z"}
{"level":"debug","message":"Executing query [m8p30jv2pg0t743r4w8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:43:07.790Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:43:07.842Z"}
{"level":"debug","message":"Executing query [m8p30jwojanze1w1yhc]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:43:07.848Z"}
{"level":"debug","message":"Executing query [m8p30jwrw2e4s0z33h9]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:43:07.851Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T22:43:07.853Z"}
{"level":"debug","message":"Executing query [m8p30jwtpcxc0peumu9]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:43:07.853Z"}
{"level":"debug","message":"Executing query [m8p30jwvwynspz8agx]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:43:07.855Z"}
{"level":"debug","message":"Executing query [m8p30jwxbccrwy9g0ha]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:43:07.858Z"}
{"level":"debug","message":"Executing query [m8p30jwzsra8lhryrne]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T22:43:07.859Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'Grado' in 'field list'","level":"error","message":"Database query error [m8p30jwzsra8lhryrne]","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:43:07.861Z"}
{"level":"error","message":"Error al crear usuario: Unknown column 'Grado' in 'field list'","timestamp":"2025-03-25T22:43:07.861Z"}
{"level":"debug","message":"Executing query [m8p30jx57a6frs270un]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:43:07.865Z"}
{"level":"error","message":"Error al obtener usuario por CIP: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveLength\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected length: \u001b[32m1\u001b[39m\nReceived length: \u001b[31m0\u001b[39m\nReceived array:  \u001b[31m[]\u001b[39m","timestamp":"2025-03-25T22:43:07.869Z"}
{"level":"debug","message":"Executing query [m8p30jxbghmzg22gat]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:43:07.871Z"}
{"level":"debug","message":"Executing query [m8p30jxc4tptltquxe]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:43:07.872Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T22:43:07.874Z"}
{"level":"debug","message":"Executing query [m8p30jxerk6x8cpbyf]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:43:07.875Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:43:07.877Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:07.611Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:43:07.910Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T22:43:07.923Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:43:08.095Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T22:43:08.110Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:43:08.178Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:08.284Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:43:08.455Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:43:08.573Z"}
{"level":"debug","message":"Executing query [m8p30khske0a896ro1o]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T22:43:08.608Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p30khske0a896ro1o]","params":"[]","query":"SELECT * FROM v_permisos_contextuales","timestamp":"2025-03-25T22:43:08.610Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:43:08.610Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:43:08.611Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:43:08.647Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:09.362Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:43:09.483Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:43:09.349Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:43:09.485Z"}
{"duration":"21ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T22:43:09.528Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:43:09.529Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T22:43:09.536Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:43:09.539Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:17.008Z"}
{"level":"debug","message":"Executing query [m8p33bl4q6uk9l6qg6]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:45:17.032Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:45:17.074Z"}
{"level":"debug","message":"Executing query [m8p33bmdjz9kpug09tn]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742942717031\"]","timestamp":"2025-03-25T22:45:17.077Z"}
{"level":"debug","message":"Executing query [m8p33bmhl72gq4pgrwi]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742942717031\"]","timestamp":"2025-03-25T22:45:17.081Z"}
{"level":"debug","message":"Executing query [m8p33bmjq27jc0m9x2]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742942717031\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:45:17.083Z"}
{"level":"debug","message":"Executing query [m8p33bmouzpnnqboyg]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T22:45:17.088Z"}
{"level":"debug","message":"Executing query [m8p33bmrgvwzmqayk3e]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742942717031\"]","timestamp":"2025-03-25T22:45:17.091Z"}
{"level":"debug","message":"Executing query [m8p33bmupaua0qtn5j]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1008]","timestamp":"2025-03-25T22:45:17.094Z"}
{"level":"debug","message":"Executing query [m8p33bmy66pzxmvu9ni]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T22:45:17.098Z"}
{"level":"debug","message":"Executing query [m8p33bn13v4o2lyapo1]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T22:45:17.101Z"}
{"level":"debug","message":"Executing query [m8p33bn4ntw6q80aqud]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T22:45:17.104Z"}
{"level":"debug","message":"Executing query [m8p33bn7vordchi9gij]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T22:45:17.107Z"}
{"level":"debug","message":"Executing query [m8p33bn9lsavefyfjfn]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T22:45:17.109Z"}
{"level":"debug","message":"Executing query [m8p33bncwzbj1wwgzw]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T22:45:17.112Z"}
{"level":"debug","message":"Executing query [m8p33bnei17djribqaq]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:45:17.115Z"}
{"level":"debug","message":"Executing query [m8p33bnh4iaqal4g7ff]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:45:17.117Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:45:17.118Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:45:17.226Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:45:17.228Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:45:17.230Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:45:17.232Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:45:17.235Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:45:17.240Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:45:17.241Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:45:17.244Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:45:17.247Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:45:17.248Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:45:17.249Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T22:45:17.250Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:17.432Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:18.457Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:45:18.607Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T22:45:18.614Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:45:18.678Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T22:45:18.692Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:45:18.741Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:19.113Z"}
{"level":"debug","message":"Executing query [m8p33d71chf3wothczc]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:19.117Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:45:19.131Z"}
{"level":"debug","message":"Executing query [m8p33d7irjkqepi6hgr]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:19.134Z"}
{"level":"debug","message":"Executing query [m8p33d7kwr5ui7hng2]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:19.136Z"}
{"level":"debug","message":"Executing query [m8p33d7lu7oba8jbwrc]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:19.137Z"}
{"level":"debug","message":"Executing query [m8p33d7mgielbg66du]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:19.138Z"}
{"level":"debug","message":"Executing query [m8p33d7n9awv4ltld9u]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:19.139Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8p33d7n9awv4ltld9u]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-25T22:45:19.140Z"}
{"level":"warn","message":"La tabla 'DocumentoArchivo' no existe en la base de datos.","timestamp":"2025-03-25T22:45:19.141Z"}
{"level":"debug","message":"Executing query [m8p33d7qmel1c6u81]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:19.142Z"}
{"level":"debug","message":"Executing query [m8p33d7r2vf9c1sfmb8]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:19.143Z"}
{"level":"debug","message":"Executing query [m8p33d7swc4g4a8lle7]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:19.144Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p33d7swc4g4a8lle7]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T22:45:19.145Z"}
{"level":"warn","message":"La tabla 'Papelera' no existe en la base de datos.","timestamp":"2025-03-25T22:45:19.146Z"}
{"level":"debug","message":"Executing query [m8p33d7ulu94dejobap]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:19.146Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p33d7ulu94dejobap]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:45:19.147Z"}
{"level":"warn","message":"La tabla 'ForenseDigital' no existe en la base de datos.","timestamp":"2025-03-25T22:45:19.148Z"}
{"level":"debug","message":"Executing query [m8p33d7wa289xclfouh]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:19.148Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p33d7wa289xclfouh]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:45:19.150Z"}
{"level":"warn","message":"La tabla 'QuimicaToxicologiaForense' no existe en la base de datos.","timestamp":"2025-03-25T22:45:19.150Z"}
{"level":"debug","message":"Executing query [m8p33d7z53bfcrrncl4]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:19.151Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p33d7z53bfcrrncl4]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:45:19.152Z"}
{"level":"warn","message":"La tabla 'Dosaje' no existe en la base de datos.","timestamp":"2025-03-25T22:45:19.152Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:45:19.157Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:19.695Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:19.830Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:45:19.850Z"}
{"level":"debug","message":"Executing query [m8p33driv4drw2xuq8l]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T22:45:19.854Z"}
{"level":"debug","message":"Executing query [m8p33drksmutf5oobve]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T22:45:19.856Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p33drksmutf5oobve]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T22:45:19.859Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:45:19.861Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:20.002Z"}
{"level":"debug","message":"Executing query [m8p33dvpy3w1eaf9oe]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:45:20.005Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:45:20.018Z"}
{"level":"debug","message":"Executing query [m8p33dw3is4b3x30jm]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:20.019Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T22:45:20.020Z"}
{"level":"debug","message":"Executing query [m8p33dw5actg7h5k0ns]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T22:45:20.021Z"}
{"level":"debug","message":"Executing query [m8p33dw6457xvt0lq7b]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T22:45:20.022Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T22:45:20.023Z"}
{"level":"debug","message":"Executing query [m8p33dw8tqwih3xqh1m]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:20.024Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T22:45:20.026Z"}
{"level":"debug","message":"Executing query [m8p33dwfo6opl3fzcrg]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T22:45:20.031Z"}
{"level":"debug","message":"Executing query [m8p33dwi9kpi47z78e]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T22:45:20.034Z"}
{"level":"debug","message":"Executing query [m8p33dwk4s96cmkzi3d]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:45:20.036Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:21.981Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T22:45:22.049Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T22:45:22.053Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:45:22.061Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:45:22.062Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T22:45:22.179Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T22:45:22.310Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:22.471Z"}
{"level":"debug","message":"Executing query [m8p33fsakcznje62zwf]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:45:22.474Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:45:22.486Z"}
{"level":"debug","message":"Executing query [m8p33fsnimbsp0gmil]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:22.487Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p33fsnimbsp0gmil]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:45:22.493Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:45:22.494Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:22.733Z"}
{"level":"debug","message":"Executing query [m8p33fzk3vaezaccj54]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:45:22.736Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:45:22.747Z"}
{"level":"debug","message":"Executing query [m8p33fzwoxjqv5f7iq8]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:22.748Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p33fzwoxjqv5f7iq8]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:45:22.750Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:45:22.750Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:23.706Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:45:23.761Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:45:23.763Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T22:45:23.873Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T22:45:23.874Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T22:45:23.875Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T22:45:23.876Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T22:45:23.876Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T22:45:23.876Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:24.299Z"}
{"level":"debug","message":"Executing query [m8p33h7316brv68558n]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:45:24.303Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:45:24.317Z"}
{"level":"debug","message":"Executing query [m8p33h7j2lwom3jprdp]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742942724302\"]","timestamp":"2025-03-25T22:45:24.319Z"}
{"level":"debug","message":"Executing query [m8p33h7klms22dwiwe]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742942724302\",true]","timestamp":"2025-03-25T22:45:24.320Z"}
{"level":"debug","message":"Executing query [m8p33h7qwmtbxr9t2ws]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[10]","timestamp":"2025-03-25T22:45:24.326Z"}
{"level":"debug","message":"Executing query [m8p33h7u9sva1f12qzj]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742942724302\"]","timestamp":"2025-03-25T22:45:24.330Z"}
{"level":"debug","message":"Executing query [m8p33h7wzvti5jdmrqh]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",10]","timestamp":"2025-03-25T22:45:24.332Z"}
{"level":"debug","message":"Executing query [m8p33h7ynae1x8j0xq8]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[10]","timestamp":"2025-03-25T22:45:24.334Z"}
{"level":"debug","message":"Executing query [m8p33h81goehnr99dgj]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[10]","timestamp":"2025-03-25T22:45:24.337Z"}
{"level":"debug","message":"Executing query [m8p33h84vrjgzhrismp]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[10]","timestamp":"2025-03-25T22:45:24.340Z"}
{"level":"debug","message":"Executing query [m8p33h867eebj1wigmh]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[10]","timestamp":"2025-03-25T22:45:24.342Z"}
{"level":"debug","message":"Executing query [m8p33h88b5wu7g41z9]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[10]","timestamp":"2025-03-25T22:45:24.344Z"}
{"level":"debug","message":"Executing query [m8p33h8bw0bqi8ogr]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[10]","timestamp":"2025-03-25T22:45:24.347Z"}
{"level":"debug","message":"Executing query [m8p33h8cjlqdf4oxel]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:45:24.348Z"}
{"level":"debug","message":"Executing query [m8p33h8e7qctjynewya]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:45:24.350Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:45:24.352Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:24.546Z"}
{"level":"debug","message":"Executing query [m8p33hdx9pymm8fflh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:45:24.549Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:45:24.559Z"}
{"level":"debug","message":"Executing query [m8p33he8qpo6kudsatk]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:45:24.560Z"}
{"level":"debug","message":"Executing query [m8p33hea53dtmoon8xr]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T22:45:24.562Z"}
{"level":"debug","message":"Executing query [m8p33hebo5cq74uo8x]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T22:45:24.563Z"}
{"level":"debug","message":"Executing query [m8p33hechq7o2zcfzj]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","timestamp":"2025-03-25T22:45:24.564Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'NivelAcceso' in 'field list'","level":"error","message":"Database query error [m8p33hechq7o2zcfzj]","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","query":"INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:45:24.566Z"}
{"level":"error","message":"Error en la configuración de las pruebas de papelera: Unknown column 'NivelAcceso' in 'field list'","timestamp":"2025-03-25T22:45:24.567Z"}
{"level":"debug","message":"Executing query [m8p33heilckqwgo7f2k]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:45:24.570Z"}
{"level":"debug","message":"Executing query [m8p33hekugzjjashrf]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T22:45:24.572Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p33hekugzjjashrf]","params":"[\"TESTPAP123\"]","query":"DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","timestamp":"2025-03-25T22:45:24.574Z"}
{"level":"error","message":"Error al eliminar usuario TESTPAP123: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:45:24.574Z"}
{"level":"debug","message":"Executing query [m8p33henev1wqddf2wf]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:45:24.575Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:45:24.576Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:24.707Z"}
{"level":"debug","message":"Executing query [m8p33hiirpwquabl7ck]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:45:24.714Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:45:24.725Z"}
{"level":"debug","message":"Executing query [m8p33hiv46eii5ggwnv]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:45:24.727Z"}
{"level":"debug","message":"Executing query [m8p33hiwncqzuhomdl]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:45:24.728Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T22:45:24.729Z"}
{"level":"debug","message":"Executing query [m8p33hixcr9zwy1a0cn]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T22:45:24.729Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextuallog' doesn't exist","level":"error","message":"Database query error [m8p33hixcr9zwy1a0cn]","params":"[999,999]","query":"DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","timestamp":"2025-03-25T22:45:24.730Z"}
{"level":"debug","message":"Error al limpiar datos previos: Table 'oficri_sistema.permisocontextuallog' doesn't exist","timestamp":"2025-03-25T22:45:24.731Z"}
{"level":"debug","message":"Executing query [m8p33hj0e01t3x6xbww]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T22:45:24.732Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p33hj0e01t3x6xbww]","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","query":"INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:45:24.733Z"}
{"level":"error","message":"Error al crear permiso contextual: Table 'oficri_sistema.permisocontextual' doesn't exist","timestamp":"2025-03-25T22:45:24.734Z"}
{"level":"debug","message":"Executing query [m8p33hj5581ba3417mf]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[null]","timestamp":"2025-03-25T22:45:24.737Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p33hj5581ba3417mf]","params":"[null]","query":"SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","timestamp":"2025-03-25T22:45:24.738Z"}
{"level":"error","message":"Error al obtener permiso contextual desde vista: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:45:24.739Z"}
{"level":"debug","message":"Executing query [m8p33hj91dyypfhuk2y]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:45:24.741Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:45:24.742Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:24.943Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:25.369Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:45:25.431Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:45:25.479Z"}
{"level":"debug","message":"Executing query [m8p33i4irutofmzh8h]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T22:45:25.506Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","level":"error","message":"Database query error [m8p33i4irutofmzh8h]","params":"[]","query":"SELECT * FROM v_permisos_contextuales","timestamp":"2025-03-25T22:45:25.507Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:45:25.508Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Table 'oficri_sistema.v_permisos_contextuales' doesn't exist","timestamp":"2025-03-25T22:45:25.508Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:45:25.536Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:25.756Z"}
{"level":"debug","message":"Executing query [m8p33ibjo52kc3ohszo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:45:25.759Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:45:25.774Z"}
{"level":"debug","message":"Executing query [m8p33ibzctf6nt28qtl]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:45:25.775Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p33ibzctf6nt28qtl]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:45:25.777Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:45:25.777Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:28.099Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:45:28.103Z"}
{"level":"debug","message":"Executing query [m8p33k4pkrbaptzztkf]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:45:28.105Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:45:28.120Z"}
{"level":"debug","message":"Executing query [m8p33k568wpv7ey62b8]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:45:28.123Z"}
{"level":"debug","message":"Executing query [m8p33k58a68vbxfyda]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:45:28.124Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T22:45:28.125Z"}
{"level":"debug","message":"Executing query [m8p33k5anwg2b9h8b7]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:45:28.126Z"}
{"level":"debug","message":"Executing query [m8p33k5bct1jnyg5xio]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:45:28.127Z"}
{"level":"debug","message":"Executing query [m8p33k5d02tmwzduovbt]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:45:28.129Z"}
{"level":"debug","message":"Executing query [m8p33k5etckkxgqwsh]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T22:45:28.130Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'Grado' in 'field list'","level":"error","message":"Database query error [m8p33k5etckkxgqwsh]","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:45:28.131Z"}
{"level":"error","message":"Error al crear usuario: Unknown column 'Grado' in 'field list'","timestamp":"2025-03-25T22:45:28.131Z"}
{"level":"debug","message":"Executing query [m8p33k5j3pxe4gevoge]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:45:28.135Z"}
{"level":"error","message":"Error al obtener usuario por CIP: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveLength\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected length: \u001b[32m1\u001b[39m\nReceived length: \u001b[31m0\u001b[39m\nReceived array:  \u001b[31m[]\u001b[39m","timestamp":"2025-03-25T22:45:28.137Z"}
{"level":"debug","message":"Executing query [m8p33k5nr7x2s8263zk]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:45:28.139Z"}
{"level":"debug","message":"Executing query [m8p33k5onp0n65bj9cj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:45:28.140Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T22:45:28.141Z"}
{"level":"debug","message":"Executing query [m8p33k5phaplg62pj75]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:45:28.141Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:45:28.143Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:12.463Z"}
{"level":"debug","message":"Executing query [m8p39nk5pdxd9piuqmn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:50:12.485Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:50:12.526Z"}
{"level":"debug","message":"Executing query [m8p39nld7t7dhe7z8zs]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742943012484\"]","timestamp":"2025-03-25T22:50:12.529Z"}
{"level":"debug","message":"Executing query [m8p39nlht7vttu8u4na]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742943012484\"]","timestamp":"2025-03-25T22:50:12.533Z"}
{"level":"debug","message":"Executing query [m8p39nlj3o46alnejio]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742943012484\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:50:12.535Z"}
{"level":"debug","message":"Executing query [m8p39nlsbsjoh5os1ng]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T22:50:12.544Z"}
{"level":"debug","message":"Executing query [m8p39nlvo858thz9il9]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742943012484\"]","timestamp":"2025-03-25T22:50:12.548Z"}
{"level":"debug","message":"Executing query [m8p39nlyvefqm8o3cx]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1009]","timestamp":"2025-03-25T22:50:12.550Z"}
{"level":"debug","message":"Executing query [m8p39nm28203rhi2a14]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T22:50:12.554Z"}
{"level":"debug","message":"Executing query [m8p39nm4v6f9ixbaweo]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T22:50:12.556Z"}
{"level":"debug","message":"Executing query [m8p39nm89yp28r04wde]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T22:50:12.560Z"}
{"level":"debug","message":"Executing query [m8p39nmab9rmoi6onb]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T22:50:12.562Z"}
{"level":"debug","message":"Executing query [m8p39nmccwuhqnjjpx7]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T22:50:12.564Z"}
{"level":"debug","message":"Executing query [m8p39nmg1qgb3fi5bry]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T22:50:12.568Z"}
{"level":"debug","message":"Executing query [m8p39nmhhfs6a52jwom]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:50:12.569Z"}
{"level":"debug","message":"Executing query [m8p39nmj9nxpfgw8ooe]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:50:12.571Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:50:12.573Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:50:12.682Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:50:12.685Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:50:12.687Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:50:12.690Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:50:12.692Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:50:12.696Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:50:12.699Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:50:12.702Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:50:12.704Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:50:12.705Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:50:12.707Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T22:50:12.708Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:12.913Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:14.270Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:50:14.438Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T22:50:14.444Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:50:14.497Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T22:50:14.511Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:50:14.558Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:14.945Z"}
{"level":"debug","message":"Executing query [m8p39pgk9pp1jfnfb4t]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:14.949Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:50:14.960Z"}
{"level":"debug","message":"Executing query [m8p39pgzm8xrjrrknr]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:14.963Z"}
{"level":"debug","message":"Executing query [m8p39ph0zbuhipl51g]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:14.964Z"}
{"level":"debug","message":"Executing query [m8p39ph17s7qgn7d7jd]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:14.965Z"}
{"level":"debug","message":"Executing query [m8p39ph2ieui5wr57pe]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:14.966Z"}
{"level":"debug","message":"Executing query [m8p39ph4qoydgm4wn]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:14.968Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8p39ph4qoydgm4wn]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-25T22:50:14.969Z"}
{"level":"warn","message":"La tabla 'DocumentoArchivo' no existe en la base de datos.","timestamp":"2025-03-25T22:50:14.970Z"}
{"level":"debug","message":"Executing query [m8p39ph6rs6yt20wl3s]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:14.970Z"}
{"level":"debug","message":"Executing query [m8p39ph7vjixjrsldu9]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:14.971Z"}
{"level":"debug","message":"Executing query [m8p39ph9urt7pvkosm]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:14.973Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p39ph9urt7pvkosm]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T22:50:14.974Z"}
{"level":"warn","message":"La tabla 'Papelera' no existe en la base de datos.","timestamp":"2025-03-25T22:50:14.975Z"}
{"level":"debug","message":"Executing query [m8p39phcpbnximtsgm]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:14.976Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p39phcpbnximtsgm]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:50:14.977Z"}
{"level":"warn","message":"La tabla 'ForenseDigital' no existe en la base de datos.","timestamp":"2025-03-25T22:50:14.978Z"}
{"level":"debug","message":"Executing query [m8p39phf8g72besppii]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:14.979Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p39phf8g72besppii]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:50:14.980Z"}
{"level":"warn","message":"La tabla 'QuimicaToxicologiaForense' no existe en la base de datos.","timestamp":"2025-03-25T22:50:14.981Z"}
{"level":"debug","message":"Executing query [m8p39phid2pvfgbzowl]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:14.982Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p39phid2pvfgbzowl]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:50:14.983Z"}
{"level":"warn","message":"La tabla 'Dosaje' no existe en la base de datos.","timestamp":"2025-03-25T22:50:14.983Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:50:14.989Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:15.455Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:15.683Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:50:15.702Z"}
{"level":"debug","message":"Executing query [m8p39q1lzjik8g5qceg]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T22:50:15.705Z"}
{"level":"debug","message":"Executing query [m8p39q1nmvitkeg0e6q]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T22:50:15.707Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p39q1nmvitkeg0e6q]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T22:50:15.709Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:50:15.711Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:15.832Z"}
{"level":"debug","message":"Executing query [m8p39q58fzjkewdux07]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:50:15.836Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:50:15.848Z"}
{"level":"debug","message":"Executing query [m8p39q5mu363egh6eb]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:15.850Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T22:50:15.851Z"}
{"level":"debug","message":"Executing query [m8p39q5naulnqhnuzrn]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T22:50:15.851Z"}
{"level":"debug","message":"Executing query [m8p39q5oo1k0g33e84]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T22:50:15.852Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T22:50:15.853Z"}
{"level":"debug","message":"Executing query [m8p39q5pkyumvkbbaqr]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:15.853Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T22:50:15.854Z"}
{"level":"debug","message":"Executing query [m8p39q5vmiw3878jeje]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T22:50:15.859Z"}
{"level":"debug","message":"Executing query [m8p39q5xxaqbsfqf8fe]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T22:50:15.861Z"}
{"level":"debug","message":"Executing query [m8p39q60vnzup7f41r]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:50:15.864Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:17.804Z"}
{"duration":"12ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T22:50:17.877Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:50:17.878Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T22:50:17.880Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:50:17.886Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T22:50:17.997Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T22:50:18.110Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:18.253Z"}
{"level":"debug","message":"Executing query [m8p39s0fdp9f4m2gvo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:50:18.255Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:50:18.265Z"}
{"level":"debug","message":"Executing query [m8p39s0rsnlw4t3dq7h]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:18.267Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p39s0rsnlw4t3dq7h]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:50:18.271Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:50:18.272Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:18.493Z"}
{"level":"debug","message":"Executing query [m8p39s75p3yfjjyutuk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:50:18.497Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:50:18.507Z"}
{"level":"debug","message":"Executing query [m8p39s7hch649pen9cn]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:18.509Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p39s7hch649pen9cn]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:50:18.511Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:50:18.512Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:19.528Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:50:19.582Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:50:19.585Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T22:50:19.694Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T22:50:19.695Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T22:50:19.696Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T22:50:19.696Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T22:50:19.698Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T22:50:19.698Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:20.105Z"}
{"level":"debug","message":"Executing query [m8p39tfxch7x30ujhwn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:50:20.109Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:50:20.123Z"}
{"level":"debug","message":"Executing query [m8p39tgd8judh15y0p6]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742943020108\"]","timestamp":"2025-03-25T22:50:20.125Z"}
{"level":"debug","message":"Executing query [m8p39tgg5ch7swh44yc]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742943020108\",true]","timestamp":"2025-03-25T22:50:20.128Z"}
{"level":"debug","message":"Executing query [m8p39tgneynd8vr815]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T22:50:20.135Z"}
{"level":"debug","message":"Executing query [m8p39tgpy1f3s22dzaj]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742943020108\"]","timestamp":"2025-03-25T22:50:20.137Z"}
{"level":"debug","message":"Executing query [m8p39tgrrsvrowefpn9]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",11]","timestamp":"2025-03-25T22:50:20.139Z"}
{"level":"debug","message":"Executing query [m8p39tgu4pmld7fl3l2]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T22:50:20.142Z"}
{"level":"debug","message":"Executing query [m8p39tgwxyinltnprzq]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T22:50:20.144Z"}
{"level":"debug","message":"Executing query [m8p39tgzsqf69kb8pxd]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T22:50:20.147Z"}
{"level":"debug","message":"Executing query [m8p39th2zi2iqq0vqu]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T22:50:20.150Z"}
{"level":"debug","message":"Executing query [m8p39th3rtve98z9nbo]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T22:50:20.151Z"}
{"level":"debug","message":"Executing query [m8p39th6zxfbsj6qwng]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T22:50:20.154Z"}
{"level":"debug","message":"Executing query [m8p39th8qpin6m8tz7k]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:50:20.156Z"}
{"level":"debug","message":"Executing query [m8p39th9nz1mx4codgp]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:50:20.157Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:50:20.158Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:20.368Z"}
{"level":"debug","message":"Executing query [m8p39tn8x2d4sqpm4c]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:50:20.372Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:50:20.383Z"}
{"level":"debug","message":"Executing query [m8p39tnlidgmy4adn0c]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:20.385Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p39tnlidgmy4adn0c]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T22:50:20.387Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:50:20.387Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:20.498Z"}
{"level":"debug","message":"Executing query [m8p39tqspgezho72o7k]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:50:20.500Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:50:20.518Z"}
{"level":"debug","message":"Executing query [m8p39trcfhqx9miq1jo]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:20.520Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p39trcfhqx9miq1jo]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-25T22:50:20.522Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:50:20.524Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:20.744Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:21.170Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:50:21.238Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:50:21.287Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Cannot read properties of undefined (reading 'query')","timestamp":"2025-03-25T22:50:21.326Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:50:21.357Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:21.567Z"}
{"level":"debug","message":"Executing query [m8p39ukisacijxpfnvr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:50:21.570Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:50:21.584Z"}
{"level":"debug","message":"Executing query [m8p39ukyzdk51yh3t]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:50:21.586Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p39ukyzdk51yh3t]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:50:21.587Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:50:21.588Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:23.886Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:50:23.890Z"}
{"level":"debug","message":"Executing query [m8p39wd04re2tvrw35g]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:50:23.892Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:50:23.902Z"}
{"level":"debug","message":"Executing query [m8p39wdbohrmvmjfv59]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:50:23.903Z"}
{"level":"debug","message":"Executing query [m8p39wdd55noijn9m28]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:50:23.905Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T22:50:23.907Z"}
{"level":"debug","message":"Executing query [m8p39wdfx0u211klbo]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:50:23.907Z"}
{"level":"debug","message":"Executing query [m8p39wdg44lszi0dg3i]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:50:23.908Z"}
{"level":"debug","message":"Executing query [m8p39wdii08afh8m5eq]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:50:23.910Z"}
{"level":"debug","message":"Executing query [m8p39wdjowl1sq547z]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T22:50:23.911Z"}
{"code":"ER_DATA_TOO_LONG","error":"Data too long for column 'CodigoCIP' at row 1","level":"error","message":"Database query error [m8p39wdjowl1sq547z]","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:50:23.912Z"}
{"level":"error","message":"Error al crear usuario: Data too long for column 'CodigoCIP' at row 1","timestamp":"2025-03-25T22:50:23.913Z"}
{"level":"debug","message":"Executing query [m8p39wdo77vw31a5rye]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:50:23.916Z"}
{"level":"error","message":"Error al obtener usuario por CIP: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveLength\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected length: \u001b[32m1\u001b[39m\nReceived length: \u001b[31m0\u001b[39m\nReceived array:  \u001b[31m[]\u001b[39m","timestamp":"2025-03-25T22:50:23.918Z"}
{"level":"debug","message":"Executing query [m8p39wdt8blzw7msgzu]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:50:23.921Z"}
{"level":"debug","message":"Executing query [m8p39wdu6z3yp76x19]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:50:23.922Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T22:50:23.922Z"}
{"level":"debug","message":"Executing query [m8p39wdvln6vhaylz5j]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:50:23.923Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:50:23.924Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:22.539Z"}
{"level":"debug","message":"Executing query [m8p3b5mzf5ise550qn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:51:22.571Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:51:22.633Z"}
{"level":"debug","message":"Executing query [m8p3b5ot8hk49g20emf]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742943082570\"]","timestamp":"2025-03-25T22:51:22.638Z"}
{"level":"debug","message":"Executing query [m8p3b5p0olnv6yu0z4r]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742943082570\"]","timestamp":"2025-03-25T22:51:22.644Z"}
{"level":"debug","message":"Executing query [m8p3b5p1w3e1rc4novf]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742943082570\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:51:22.645Z"}
{"level":"debug","message":"Executing query [m8p3b5p9cwixmgss5bm]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T22:51:22.653Z"}
{"level":"debug","message":"Executing query [m8p3b5pd4bq9cyp48q7]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742943082570\"]","timestamp":"2025-03-25T22:51:22.657Z"}
{"level":"debug","message":"Executing query [m8p3b5pfu5a6pcfw8ha]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1010]","timestamp":"2025-03-25T22:51:22.659Z"}
{"level":"debug","message":"Executing query [m8p3b5pj4zfm9n2100i]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T22:51:22.663Z"}
{"level":"debug","message":"Executing query [m8p3b5pl3144o6c2645]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T22:51:22.665Z"}
{"level":"debug","message":"Executing query [m8p3b5pp78yaugy32ug]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T22:51:22.669Z"}
{"level":"debug","message":"Executing query [m8p3b5pst2xei7u6dap]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T22:51:22.672Z"}
{"level":"debug","message":"Executing query [m8p3b5pu29b0tzicp55]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T22:51:22.674Z"}
{"level":"debug","message":"Executing query [m8p3b5pzs7qjjs7jyj]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T22:51:22.679Z"}
{"level":"debug","message":"Executing query [m8p3b5q2zycqmh2msy]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:51:22.682Z"}
{"level":"debug","message":"Executing query [m8p3b5q5vsm9hk42ud]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:51:22.685Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:51:22.687Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:51:22.810Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:51:22.812Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:51:22.814Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:51:22.816Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:51:22.819Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:51:22.823Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:51:22.825Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:51:22.828Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:51:22.830Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:23.041Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:51:22.832Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:51:22.833Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T22:51:22.834Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:24.056Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:51:24.226Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T22:51:24.231Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:51:24.290Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T22:51:24.304Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:51:24.358Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:24.716Z"}
{"level":"debug","message":"Executing query [m8p3b7ao1iagw6g5wsx]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:24.721Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:51:24.735Z"}
{"level":"debug","message":"Executing query [m8p3b7b5723l87io8ra]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:24.737Z"}
{"level":"debug","message":"Executing query [m8p3b7b744ec5b6nz6b]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:24.740Z"}
{"level":"debug","message":"Executing query [m8p3b7b9f7149hj5tio]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:24.741Z"}
{"level":"debug","message":"Executing query [m8p3b7ba3oykfoa50ex]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:24.742Z"}
{"level":"debug","message":"Executing query [m8p3b7bahdgs9t7i1ec]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:24.742Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8p3b7bahdgs9t7i1ec]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-25T22:51:24.743Z"}
{"level":"warn","message":"La tabla 'DocumentoArchivo' no existe en la base de datos.","timestamp":"2025-03-25T22:51:24.744Z"}
{"level":"debug","message":"Executing query [m8p3b7bc91xnurwnft]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:24.744Z"}
{"level":"debug","message":"Executing query [m8p3b7bd0cd9bo1quspo]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:24.745Z"}
{"level":"debug","message":"Executing query [m8p3b7bf2r3wbznrstp]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:24.747Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p3b7bf2r3wbznrstp]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T22:51:24.747Z"}
{"level":"warn","message":"La tabla 'Papelera' no existe en la base de datos.","timestamp":"2025-03-25T22:51:24.748Z"}
{"level":"debug","message":"Executing query [m8p3b7bgpivz3d0p33i]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:24.748Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p3b7bgpivz3d0p33i]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:51:24.749Z"}
{"level":"warn","message":"La tabla 'ForenseDigital' no existe en la base de datos.","timestamp":"2025-03-25T22:51:24.749Z"}
{"level":"debug","message":"Executing query [m8p3b7bij3o10c73tb8]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:24.750Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p3b7bij3o10c73tb8]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:51:24.750Z"}
{"level":"warn","message":"La tabla 'QuimicaToxicologiaForense' no existe en la base de datos.","timestamp":"2025-03-25T22:51:24.751Z"}
{"level":"debug","message":"Executing query [m8p3b7bjjtuzmbnrdla]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:24.751Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p3b7bjjtuzmbnrdla]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:51:24.752Z"}
{"level":"warn","message":"La tabla 'Dosaje' no existe en la base de datos.","timestamp":"2025-03-25T22:51:24.753Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:51:24.758Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:25.206Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:25.462Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:51:25.483Z"}
{"level":"debug","message":"Executing query [m8p3b7vxh9saglnywe]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T22:51:25.485Z"}
{"level":"debug","message":"Executing query [m8p3b7vzbppf6t5k1zd]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T22:51:25.487Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p3b7vzbppf6t5k1zd]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T22:51:25.489Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:51:25.490Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:25.617Z"}
{"level":"debug","message":"Executing query [m8p3b7zoyrestm2hets]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:51:25.620Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:51:25.633Z"}
{"level":"debug","message":"Executing query [m8p3b80213f75vap5m6n]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:25.634Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T22:51:25.636Z"}
{"level":"debug","message":"Executing query [m8p3b804jhyy6pde9]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T22:51:25.636Z"}
{"level":"debug","message":"Executing query [m8p3b805p5g6653muw]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T22:51:25.637Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T22:51:25.642Z"}
{"level":"debug","message":"Executing query [m8p3b80ap9gnanzqlnk]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:25.642Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T22:51:25.643Z"}
{"level":"debug","message":"Executing query [m8p3b80g98kssejlv9i]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T22:51:25.648Z"}
{"level":"debug","message":"Executing query [m8p3b80jf6z8uwfd03l]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T22:51:25.651Z"}
{"level":"debug","message":"Executing query [m8p3b80lu5x3prj9lg]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:51:25.653Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:27.533Z"}
{"duration":"11ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T22:51:27.608Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T22:51:27.614Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:51:27.622Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:51:27.624Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T22:51:27.733Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T22:51:27.869Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:28.017Z"}
{"level":"debug","message":"Executing query [m8p3b9ucg24ln3045c]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:51:28.020Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:51:28.034Z"}
{"level":"debug","message":"Executing query [m8p3b9usinfkkc3jpde]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:28.036Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p3b9usinfkkc3jpde]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:51:28.038Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:51:28.039Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:28.244Z"}
{"level":"debug","message":"Executing query [m8p3ba0ouz2a7t8uyjn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:51:28.248Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:51:28.259Z"}
{"level":"debug","message":"Executing query [m8p3ba117bgz8igq7un]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:28.261Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p3ba117bgz8igq7un]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:51:28.263Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:51:28.263Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:29.230Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:51:29.286Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:51:29.289Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T22:51:29.399Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T22:51:29.400Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T22:51:29.401Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T22:51:29.401Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T22:51:29.402Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T22:51:29.402Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:29.810Z"}
{"level":"debug","message":"Executing query [m8p3bb857uhhkjintct]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:51:29.813Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:51:29.828Z"}
{"level":"debug","message":"Executing query [m8p3bb8mqz5c30lzc38]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742943089812\"]","timestamp":"2025-03-25T22:51:29.830Z"}
{"level":"debug","message":"Executing query [m8p3bb8oax4z0k8c5r6]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742943089812\",true]","timestamp":"2025-03-25T22:51:29.832Z"}
{"level":"debug","message":"Executing query [m8p3bb8u4haud402php]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-25T22:51:29.838Z"}
{"level":"debug","message":"Executing query [m8p3bb8xwkj6o05bt89]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742943089812\"]","timestamp":"2025-03-25T22:51:29.841Z"}
{"level":"debug","message":"Executing query [m8p3bb8zwqgses83q9p]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",12]","timestamp":"2025-03-25T22:51:29.843Z"}
{"level":"debug","message":"Executing query [m8p3bb92cfhss7bxzn5]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-25T22:51:29.846Z"}
{"level":"debug","message":"Executing query [m8p3bb94xpletizztrd]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-25T22:51:29.848Z"}
{"level":"debug","message":"Executing query [m8p3bb97xpxcp6okyio]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-25T22:51:29.852Z"}
{"level":"debug","message":"Executing query [m8p3bb999t3zt1kj1z4]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-25T22:51:29.853Z"}
{"level":"debug","message":"Executing query [m8p3bb9abur1sk22ti9]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-25T22:51:29.854Z"}
{"level":"debug","message":"Executing query [m8p3bb9eplk7lpyngx]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-25T22:51:29.858Z"}
{"level":"debug","message":"Executing query [m8p3bb9f3tu09q26g7i]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:51:29.859Z"}
{"level":"debug","message":"Executing query [m8p3bb9gq7fdgab7j6]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:51:29.861Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:51:29.861Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:30.067Z"}
{"level":"debug","message":"Executing query [m8p3bbf9f7cxum5wo9j]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:51:30.070Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:51:30.081Z"}
{"level":"debug","message":"Executing query [m8p3bbfmzybzullf9qo]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:30.082Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p3bbfmzybzullf9qo]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T22:51:30.083Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:51:30.084Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:30.198Z"}
{"level":"debug","message":"Executing query [m8p3bbixj5554pyt0um]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:51:30.201Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:51:30.217Z"}
{"level":"debug","message":"Executing query [m8p3bbjf6sj65n9wh5k]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:30.219Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p3bbjf6sj65n9wh5k]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-25T22:51:30.220Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:51:30.220Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:30.407Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:30.839Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:51:30.893Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:51:30.950Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Cannot read properties of undefined (reading 'query')","timestamp":"2025-03-25T22:51:31.009Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:51:31.040Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:31.269Z"}
{"level":"debug","message":"Executing query [m8p3bccn4rxqqeqxw8s]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:51:31.272Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:51:31.287Z"}
{"level":"debug","message":"Executing query [m8p3bcd5azzgpjdcugq]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:51:31.289Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p3bcd5azzgpjdcugq]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:51:31.290Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:51:31.291Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:33.571Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:51:33.575Z"}
{"level":"debug","message":"Executing query [m8p3be4p0kiscob3sa8r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:51:33.577Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:51:33.589Z"}
{"level":"debug","message":"Executing query [m8p3be52jeyknx8ci08]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:51:33.590Z"}
{"level":"debug","message":"Executing query [m8p3be545qnalbh8e86]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:51:33.592Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T22:51:33.594Z"}
{"level":"debug","message":"Executing query [m8p3be56hny4k2s76ru]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:51:33.594Z"}
{"level":"debug","message":"Executing query [m8p3be58x4xtwickyhh]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:51:33.596Z"}
{"level":"debug","message":"Executing query [m8p3be594kieta751c4]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:51:33.597Z"}
{"level":"debug","message":"Executing query [m8p3be5amck5iis4ms]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T22:51:33.598Z"}
{"code":"ER_DATA_TOO_LONG","error":"Data too long for column 'CodigoCIP' at row 1","level":"error","message":"Database query error [m8p3be5amck5iis4ms]","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:51:33.599Z"}
{"level":"error","message":"Error al crear usuario: Data too long for column 'CodigoCIP' at row 1","timestamp":"2025-03-25T22:51:33.600Z"}
{"level":"debug","message":"Executing query [m8p3be5fe56c1p9wa1n]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:51:33.603Z"}
{"level":"error","message":"Error al obtener usuario por CIP: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveLength\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected length: \u001b[32m1\u001b[39m\nReceived length: \u001b[31m0\u001b[39m\nReceived array:  \u001b[31m[]\u001b[39m","timestamp":"2025-03-25T22:51:33.605Z"}
{"level":"debug","message":"Executing query [m8p3be5kij0fhh3l34r]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:51:33.608Z"}
{"level":"debug","message":"Executing query [m8p3be5lzbk33embb5]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:51:33.609Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T22:51:33.610Z"}
{"level":"debug","message":"Executing query [m8p3be5m3hcc3bbt6k6]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:51:33.610Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:51:33.611Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:28.486Z"}
{"level":"debug","message":"Executing query [m8p3ckiltokga08cc8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:52:28.509Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:52:28.545Z"}
{"level":"debug","message":"Executing query [m8p3ckjnljobk6fy57s]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742943148508\"]","timestamp":"2025-03-25T22:52:28.547Z"}
{"level":"debug","message":"Executing query [m8p3ckjqghiv7xidki4]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742943148508\"]","timestamp":"2025-03-25T22:52:28.550Z"}
{"level":"debug","message":"Executing query [m8p3ckjsjjndfa7bs4b]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742943148508\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T22:52:28.552Z"}
{"level":"debug","message":"Executing query [m8p3ckjz8qocx8kga13]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T22:52:28.559Z"}
{"level":"debug","message":"Executing query [m8p3ckk1eaqzsde0u3o]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742943148508\"]","timestamp":"2025-03-25T22:52:28.561Z"}
{"level":"debug","message":"Executing query [m8p3ckk3ve93fc8ykmc]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1011]","timestamp":"2025-03-25T22:52:28.563Z"}
{"level":"debug","message":"Executing query [m8p3ckk712ytwolse0mc]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T22:52:28.567Z"}
{"level":"debug","message":"Executing query [m8p3ckk8nfaiyob7nd]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T22:52:28.569Z"}
{"level":"debug","message":"Executing query [m8p3ckkbjtqfx6ot3j9]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T22:52:28.572Z"}
{"level":"debug","message":"Executing query [m8p3ckkdolqa77qwv6]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T22:52:28.573Z"}
{"level":"debug","message":"Executing query [m8p3ckkehkbf5epmkp5]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T22:52:28.574Z"}
{"level":"debug","message":"Executing query [m8p3ckkhqqrmdzx6ek]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T22:52:28.577Z"}
{"level":"debug","message":"Executing query [m8p3ckki3eokhzdfrj3]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:52:28.578Z"}
{"level":"debug","message":"Executing query [m8p3ckkka017uic8bel]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:52:28.580Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:52:28.581Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:52:28.680Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:52:28.681Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:52:28.682Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:52:28.684Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:28.895Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:52:28.685Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:52:28.688Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T22:52:28.689Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:52:28.691Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:52:28.692Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:52:28.693Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T22:52:28.694Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T22:52:28.694Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:29.876Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:52:30.028Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T22:52:30.034Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:52:30.081Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T22:52:30.091Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:52:30.129Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:30.465Z"}
{"level":"debug","message":"Executing query [m8p3cm10hxmpr15qf7]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:30.468Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:52:30.483Z"}
{"level":"debug","message":"Executing query [m8p3cm1gd8wubmhze3j]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:30.484Z"}
{"level":"debug","message":"Executing query [m8p3cm1g2ez2dc0rh7r]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:30.484Z"}
{"level":"debug","message":"Executing query [m8p3cm1hj6gb7l3ufm]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:30.485Z"}
{"level":"debug","message":"Executing query [m8p3cm1i2k3mc25dfaf]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:30.486Z"}
{"level":"debug","message":"Executing query [m8p3cm1iq38ljfxwfkc]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:30.486Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8p3cm1iq38ljfxwfkc]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-25T22:52:30.488Z"}
{"level":"warn","message":"La tabla 'DocumentoArchivo' no existe en la base de datos.","timestamp":"2025-03-25T22:52:30.488Z"}
{"level":"debug","message":"Executing query [m8p3cm1kuj4fpj5d6a]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:30.488Z"}
{"level":"debug","message":"Executing query [m8p3cm1lddc619fyia]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:30.489Z"}
{"level":"debug","message":"Executing query [m8p3cm1m0ezglvwnmekc]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:30.490Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p3cm1m0ezglvwnmekc]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T22:52:30.490Z"}
{"level":"warn","message":"La tabla 'Papelera' no existe en la base de datos.","timestamp":"2025-03-25T22:52:30.491Z"}
{"level":"debug","message":"Executing query [m8p3cm1nfap2t280r2v]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:30.491Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p3cm1nfap2t280r2v]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:52:30.491Z"}
{"level":"warn","message":"La tabla 'ForenseDigital' no existe en la base de datos.","timestamp":"2025-03-25T22:52:30.491Z"}
{"level":"debug","message":"Executing query [m8p3cm1oywhprmiogoc]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:30.492Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p3cm1oywhprmiogoc]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:52:30.492Z"}
{"level":"warn","message":"La tabla 'QuimicaToxicologiaForense' no existe en la base de datos.","timestamp":"2025-03-25T22:52:30.492Z"}
{"level":"debug","message":"Executing query [m8p3cm1on6zp62gyhgg]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:30.492Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p3cm1on6zp62gyhgg]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:52:30.493Z"}
{"level":"warn","message":"La tabla 'Dosaje' no existe en la base de datos.","timestamp":"2025-03-25T22:52:30.493Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:52:30.496Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:31.004Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:31.121Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:52:31.140Z"}
{"level":"debug","message":"Executing query [m8p3cmjr4ogu5d8es1k]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T22:52:31.144Z"}
{"level":"debug","message":"Executing query [m8p3cmjtqg8yrd6ndp]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T22:52:31.145Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p3cmjtqg8yrd6ndp]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T22:52:31.146Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:52:31.147Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:31.284Z"}
{"level":"debug","message":"Executing query [m8p3cmnr7uhwwa9isjw]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:52:31.287Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:52:31.298Z"}
{"level":"debug","message":"Executing query [m8p3cmo2f7l75ddv2z4]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:31.298Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T22:52:31.299Z"}
{"level":"debug","message":"Executing query [m8p3cmo4nxv3ssx0hdh]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T22:52:31.300Z"}
{"level":"debug","message":"Executing query [m8p3cmo5jvdzyo5ktgh]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T22:52:31.301Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T22:52:31.302Z"}
{"level":"debug","message":"Executing query [m8p3cmo60i6l09egq79m]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:31.302Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T22:52:31.303Z"}
{"level":"debug","message":"Executing query [m8p3cmoaast8hm5xwnu]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T22:52:31.306Z"}
{"level":"debug","message":"Executing query [m8p3cmodveucp4uxavd]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T22:52:31.309Z"}
{"level":"debug","message":"Executing query [m8p3cmoeym5kf2yss1]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:52:31.310Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:33.288Z"}
{"duration":"8ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T22:52:33.356Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T22:52:33.360Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:52:33.364Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:52:33.366Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T22:52:33.462Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T22:52:33.550Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:33.660Z"}
{"level":"debug","message":"Executing query [m8p3cohq0r6d9oeus7q]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:52:33.662Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:52:33.671Z"}
{"level":"debug","message":"Executing query [m8p3cohz50zajzwd7m3]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:33.671Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p3cohz50zajzwd7m3]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:52:33.673Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:52:33.673Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:33.837Z"}
{"level":"debug","message":"Executing query [m8p3comnozqeemtdh3]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:52:33.839Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:52:33.850Z"}
{"level":"debug","message":"Executing query [m8p3comz5b2zgfa21se]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:33.851Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p3comz5b2zgfa21se]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:52:33.852Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:52:33.852Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:34.634Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:52:34.682Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:52:34.683Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T22:52:34.774Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T22:52:34.775Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T22:52:34.775Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T22:52:34.775Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T22:52:34.776Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T22:52:34.776Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:35.096Z"}
{"level":"debug","message":"Executing query [m8p3cplm30p5481udht]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:52:35.098Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:52:35.107Z"}
{"level":"debug","message":"Executing query [m8p3cplw39vkmx0dayu]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742943155097\"]","timestamp":"2025-03-25T22:52:35.108Z"}
{"level":"debug","message":"Executing query [m8p3cplxy3cfmsrsoae]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742943155097\",true]","timestamp":"2025-03-25T22:52:35.109Z"}
{"level":"debug","message":"Executing query [m8p3cpm2theoqborwy]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T22:52:35.114Z"}
{"level":"debug","message":"Executing query [m8p3cpm46nkst2gdn89]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742943155097\"]","timestamp":"2025-03-25T22:52:35.116Z"}
{"level":"debug","message":"Executing query [m8p3cpm5ihrkv7y2hk]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",13]","timestamp":"2025-03-25T22:52:35.117Z"}
{"level":"debug","message":"Executing query [m8p3cpm800go7mopsg66]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T22:52:35.120Z"}
{"level":"debug","message":"Executing query [m8p3cpm98qu9rcy7y5p]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T22:52:35.121Z"}
{"level":"debug","message":"Executing query [m8p3cpmbgklqxkkux4h]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T22:52:35.123Z"}
{"level":"debug","message":"Executing query [m8p3cpmcz8kc1ajno4o]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T22:52:35.124Z"}
{"level":"debug","message":"Executing query [m8p3cpmdvu5jungny5]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T22:52:35.125Z"}
{"level":"debug","message":"Executing query [m8p3cpmgw4u2rybiwas]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T22:52:35.128Z"}
{"level":"debug","message":"Executing query [m8p3cpmhiuf6khg3fen]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T22:52:35.129Z"}
{"level":"debug","message":"Executing query [m8p3cpmitlurizjp4en]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:52:35.130Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:52:35.131Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:35.289Z"}
{"level":"debug","message":"Executing query [m8p3cpqzbkc8mhtepnn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:52:35.292Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:52:35.300Z"}
{"level":"debug","message":"Executing query [m8p3cpr947x6d7fmb49]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:35.301Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p3cpr947x6d7fmb49]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T22:52:35.301Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:52:35.302Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:35.401Z"}
{"level":"debug","message":"Executing query [m8p3cpu3mm58ezq8yj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:52:35.403Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:52:35.416Z"}
{"level":"debug","message":"Executing query [m8p3cpugu85j4jdeep8]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:35.416Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p3cpugu85j4jdeep8]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-25T22:52:35.417Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:52:35.418Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:35.581Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:35.932Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:52:35.987Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:52:36.019Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Cannot read properties of undefined (reading 'query')","timestamp":"2025-03-25T22:52:36.045Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:52:36.069Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:36.255Z"}
{"level":"debug","message":"Executing query [m8p3cqht5c698v5v05o]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:52:36.257Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:52:36.267Z"}
{"level":"debug","message":"Executing query [m8p3cqi4giiacq5wwft]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:52:36.268Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p3cqi4giiacq5wwft]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:52:36.268Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:52:36.269Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:38.618Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:52:38.621Z"}
{"level":"debug","message":"Executing query [m8p3csbji85t5vm7z5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:52:38.623Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:52:38.638Z"}
{"level":"debug","message":"Executing query [m8p3csbzbk6b97y73nl]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T22:52:38.639Z"}
{"level":"debug","message":"Executing query [m8p3csc0kgb4jar7bfa]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T22:52:38.640Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T22:52:38.641Z"}
{"level":"debug","message":"Executing query [m8p3csc11w2nnztvpq]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:52:38.641Z"}
{"level":"debug","message":"Executing query [m8p3csc25jvybsvp8sk]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:52:38.642Z"}
{"level":"debug","message":"Executing query [m8p3csc3mh9aggzic9]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:52:38.643Z"}
{"level":"debug","message":"Executing query [m8p3csc40jou4lde1z25]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T22:52:38.644Z"}
{"code":"ER_DATA_TOO_LONG","error":"Data too long for column 'CodigoCIP' at row 1","level":"error","message":"Database query error [m8p3csc40jou4lde1z25]","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T22:52:38.644Z"}
{"level":"error","message":"Error al crear usuario: Data too long for column 'CodigoCIP' at row 1","timestamp":"2025-03-25T22:52:38.644Z"}
{"level":"debug","message":"Executing query [m8p3csc6mooo7xboghi]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:52:38.647Z"}
{"level":"error","message":"Error al obtener usuario por CIP: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []","timestamp":"2025-03-25T22:52:38.649Z"}
{"level":"debug","message":"Executing query [m8p3cscappch7yyw23]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:52:38.650Z"}
{"level":"debug","message":"Executing query [m8p3cscbwb2d2pjayo9]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T22:52:38.651Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T22:52:38.652Z"}
{"level":"debug","message":"Executing query [m8p3cscc0e7lu4mnxpmg]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T22:52:38.652Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:52:38.653Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:53:37.888Z"}
{"level":"debug","message":"Executing query [m8p3e22jnurads41d4]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T22:53:37.915Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:53:37.949Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-25T22:53:37.954Z"}
{"level":"debug","message":"Executing query [m8p3e23mehizfuu4rvi]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-25T22:53:37.955Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-25T22:53:37.956Z"}
{"level":"debug","message":"Executing query [m8p3e23p04irdb8qoi49]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-25T22:53:37.957Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-25T22:53:37.959Z"}
{"level":"debug","message":"Executing query [m8p3e23sk31xafsri8c]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T22:53:37.960Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-25T22:53:37.961Z"}
{"level":"debug","message":"Executing query [m8p3e23udmqtblo4l27]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T22:53:37.962Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-25T22:53:37.963Z"}
{"level":"debug","message":"Executing query [m8p3e23vnh64nzgz6re]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-25T22:53:37.963Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8p3e23vnh64nzgz6re]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-25T22:53:37.965Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-25T22:53:37.966Z"}
{"level":"debug","message":"Executing query [m8p3e23ysz2lalclobd]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-25T22:53:37.966Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-25T22:53:37.967Z"}
{"level":"debug","message":"Executing query [m8p3e240dvg69mden57]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T22:53:37.968Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-25T22:53:37.969Z"}
{"level":"debug","message":"Executing query [m8p3e241w5c9dgpp96e]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T22:53:37.969Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p3e241w5c9dgpp96e]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T22:53:37.970Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-25T22:53:37.971Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-25T22:53:37.972Z"}
{"level":"debug","message":"Executing query [m8p3e2474od61agrkw6]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:53:37.975Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p3e2474od61agrkw6]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:53:37.976Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-25T22:53:37.977Z"}
{"level":"debug","message":"Executing query [m8p3e24977536ql3jot]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T22:53:37.977Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p3e24977536ql3jot]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T22:53:37.978Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-25T22:53:37.979Z"}
{"level":"debug","message":"Executing query [m8p3e24blvhglhqzrgd]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T22:53:37.980Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p3e24blvhglhqzrgd]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T22:53:37.981Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-25T22:53:37.982Z"}
{"level":"debug","message":"Executing query [m8p3e24ehdrn2fichd9]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-25T22:53:37.982Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p3e24ehdrn2fichd9]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-25T22:53:37.983Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-25T22:53:37.984Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-25T22:53:37.985Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-25T22:53:37.986Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-25T22:53:37.986Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-25T22:53:37.987Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-25T22:53:37.987Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-25T22:53:37.988Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-25T22:53:37.988Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-25T22:53:37.988Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-25T22:53:37.989Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-25T22:53:37.989Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-25T22:53:37.989Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-25T22:53:37.989Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-25T22:53:37.990Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-25T22:53:37.990Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-25T22:53:37.991Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-25T22:53:37.991Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-25T22:53:37.991Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-25T22:53:37.992Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:53:37.994Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:56:10.590Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:56:10.790Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:56:10.912Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Cannot read properties of undefined (reading 'query')","timestamp":"2025-03-25T22:56:10.961Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:56:10.998Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:56:42.368Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:56:42.549Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:56:42.664Z"}
{"level":"error","message":"Error al obtener permisos contextuales: Cannot read properties of undefined (reading 'query')","timestamp":"2025-03-25T22:56:42.711Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:56:42.746Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:57:48.989Z"}
{"fatal":true,"level":"error","message":"Error al conectar a la base de datos: Encoding not recognized: 'cesu8' (searched as: 'cesu8')","stack":"Error: Encoding not recognized: 'cesu8' (searched as: 'cesu8')\n    at Object.getCodec (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:104:23)\n    at Object.getDecoder (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:125:23)\n    at Object.<anonymous>.exports.decode (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\parsers\\string.js:20:23)\n    at Packet.readNullTerminatedString (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\packet.js:414:25)\n    at Function.fromPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\handshake.js:62:33)\n    at ClientHandshake.handshakeInit (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\client_handshake.js:112:40)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:45:22)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T22:57:53.464Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:58:29.753Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T22:58:29.948Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:58:30.049Z"}
{"level":"debug","message":"Executing query [m8p3kbidghbu1r8uumu]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-25T22:58:30.086Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p3kbidghbu1r8uumu]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-25T22:58:30.089Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-25T22:58:30.092Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T22:58:30.128Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T22:59:01.298Z"}
{"level":"debug","message":"Executing query [m8p3kzm8jmv2jk1ptd]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T22:59:01.328Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T22:59:01.362Z"}
{"level":"debug","message":"Executing query [m8p3kznap8eobmra8zi]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T22:59:01.366Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p3kznap8eobmra8zi]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T22:59:01.368Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T22:59:01.370Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:26.113Z"}
{"level":"debug","message":"Executing query [m8p3mt207y6lps58vkp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:00:26.136Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:00:26.177Z"}
{"level":"debug","message":"Executing query [m8p3mt38uu5qdluuv78]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742943626135\"]","timestamp":"2025-03-25T23:00:26.180Z"}
{"level":"debug","message":"Executing query [m8p3mt3bg300usn9dn5]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742943626135\"]","timestamp":"2025-03-25T23:00:26.183Z"}
{"level":"debug","message":"Executing query [m8p3mt3dvk3y52zf3z]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742943626135\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T23:00:26.185Z"}
{"level":"debug","message":"Executing query [m8p3mt3kby0wc24bujl]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T23:00:26.192Z"}
{"level":"debug","message":"Executing query [m8p3mt3oi1dtgphjlm]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742943626135\"]","timestamp":"2025-03-25T23:00:26.196Z"}
{"level":"debug","message":"Executing query [m8p3mt3qfor225dosar]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1012]","timestamp":"2025-03-25T23:00:26.198Z"}
{"level":"debug","message":"Executing query [m8p3mt3ukjbw758kqf]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T23:00:26.202Z"}
{"level":"debug","message":"Executing query [m8p3mt3wggz4vk28drn]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T23:00:26.204Z"}
{"level":"debug","message":"Executing query [m8p3mt3zhucyh4rps34]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T23:00:26.207Z"}
{"level":"debug","message":"Executing query [m8p3mt42cv1easud29p]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T23:00:26.210Z"}
{"level":"debug","message":"Executing query [m8p3mt4484wirmeqaah]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T23:00:26.212Z"}
{"level":"debug","message":"Executing query [m8p3mt47i61clphz1ij]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T23:00:26.215Z"}
{"level":"debug","message":"Executing query [m8p3mt49d6u9v8a7x08]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T23:00:26.217Z"}
{"level":"debug","message":"Executing query [m8p3mt4aerb6z0xbujh]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T23:00:26.218Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:00:26.220Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T23:00:26.325Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T23:00:26.328Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T23:00:26.330Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T23:00:26.332Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T23:00:26.334Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T23:00:26.338Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T23:00:26.341Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T23:00:26.344Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T23:00:26.346Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T23:00:26.347Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T23:00:26.348Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T23:00:26.350Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:26.528Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:27.606Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T23:00:27.775Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T23:00:27.781Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:00:27.839Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T23:00:27.852Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:00:27.897Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:28.252Z"}
{"level":"debug","message":"Executing query [m8p3muovxuoifkuhh6]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:28.255Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:00:28.269Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-25T23:00:28.271Z"}
{"level":"debug","message":"Executing query [m8p3mupc1xtz5h0qrp1]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:28.272Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-25T23:00:28.273Z"}
{"level":"debug","message":"Executing query [m8p3mupevnamd1cfns]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:28.274Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-25T23:00:28.275Z"}
{"level":"debug","message":"Executing query [m8p3mupfonwax15laik]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:28.275Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-25T23:00:28.276Z"}
{"level":"debug","message":"Executing query [m8p3mupg9kpx3fcyhki]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:28.276Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-25T23:00:28.277Z"}
{"level":"debug","message":"Executing query [m8p3mupivsf6n31j7sn]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:28.278Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8p3mupivsf6n31j7sn]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-25T23:00:28.279Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-25T23:00:28.280Z"}
{"level":"debug","message":"Executing query [m8p3mupk1a8xjemcc6n]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:28.280Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-25T23:00:28.281Z"}
{"level":"debug","message":"Executing query [m8p3mupmkz9jagovr7l]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:28.282Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-25T23:00:28.283Z"}
{"level":"debug","message":"Executing query [m8p3mupn8gc9se8gtab]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:28.283Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p3mupn8gc9se8gtab]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T23:00:28.285Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-25T23:00:28.286Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-25T23:00:28.286Z"}
{"level":"debug","message":"Executing query [m8p3mupswjepxxx01bm]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:28.288Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p3mupswjepxxx01bm]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T23:00:28.289Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-25T23:00:28.290Z"}
{"level":"debug","message":"Executing query [m8p3mupu1rg2ws2l8x7]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:28.290Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p3mupu1rg2ws2l8x7]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T23:00:28.291Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-25T23:00:28.291Z"}
{"level":"debug","message":"Executing query [m8p3mupwrwi5qxo6sg]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:28.292Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p3mupwrwi5qxo6sg]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T23:00:28.293Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-25T23:00:28.293Z"}
{"level":"debug","message":"Executing query [m8p3mupyc9hwo7qu2zr]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:28.294Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p3mupyc9hwo7qu2zr]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-25T23:00:28.294Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-25T23:00:28.295Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-25T23:00:28.295Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-25T23:00:28.296Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-25T23:00:28.296Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-25T23:00:28.297Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-25T23:00:28.297Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-25T23:00:28.298Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-25T23:00:28.298Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-25T23:00:28.298Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-25T23:00:28.299Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-25T23:00:28.299Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-25T23:00:28.299Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-25T23:00:28.300Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-25T23:00:28.300Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-25T23:00:28.301Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-25T23:00:28.301Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-25T23:00:28.301Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-25T23:00:28.302Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-25T23:00:28.302Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:00:28.304Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:28.739Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:28.986Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:00:29.004Z"}
{"level":"debug","message":"Executing query [m8p3mv9qltbfz62grv]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T23:00:29.007Z"}
{"level":"debug","message":"Executing query [m8p3mv9tpcac3wtbnhq]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T23:00:29.009Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p3mv9tpcac3wtbnhq]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T23:00:29.010Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:00:29.011Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:29.128Z"}
{"level":"debug","message":"Executing query [m8p3mvd7pq3xywgizqn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:00:29.131Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:00:29.142Z"}
{"level":"debug","message":"Executing query [m8p3mvdj3bmkzyidmhr]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:29.143Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T23:00:29.145Z"}
{"level":"debug","message":"Executing query [m8p3mvdlux2upr1d6j]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T23:00:29.145Z"}
{"level":"debug","message":"Executing query [m8p3mvdnrybhz2ddgos]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T23:00:29.147Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T23:00:29.148Z"}
{"level":"debug","message":"Executing query [m8p3mvdolnirco4rbop]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:29.148Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T23:00:29.149Z"}
{"level":"debug","message":"Executing query [m8p3mvdu1gp2w7sb3sp]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T23:00:29.154Z"}
{"level":"debug","message":"Executing query [m8p3mve08pmfd8pnyzr]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T23:00:29.160Z"}
{"level":"debug","message":"Executing query [m8p3mve28ryjus92ag]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T23:00:29.162Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:30.952Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T23:00:31.018Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T23:00:31.023Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:00:31.030Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T23:00:31.032Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T23:00:31.138Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T23:00:31.245Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:31.384Z"}
{"level":"debug","message":"Executing query [m8p3mx3vlnilb0iekt]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:00:31.387Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:00:31.397Z"}
{"level":"debug","message":"Executing query [m8p3mx4b9ijhwcva0cl]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:31.403Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p3mx4b9ijhwcva0cl]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T23:00:31.404Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T23:00:31.405Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:31.607Z"}
{"level":"debug","message":"Executing query [m8p3mxa2pf6d1t6ppj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:00:31.610Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:00:31.621Z"}
{"level":"debug","message":"Executing query [m8p3mxaenwsgq0negx]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:31.622Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p3mxaenwsgq0negx]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T23:00:31.624Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T23:00:31.625Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:32.555Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:00:32.606Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T23:00:32.608Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T23:00:32.717Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T23:00:32.718Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T23:00:32.719Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T23:00:32.720Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T23:00:32.721Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T23:00:32.721Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:33.125Z"}
{"level":"debug","message":"Executing query [m8p3myg7lqrdrqwjqs]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:00:33.127Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:00:33.140Z"}
{"level":"debug","message":"Executing query [m8p3mygnybn9lmhymsl]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742943633126\"]","timestamp":"2025-03-25T23:00:33.143Z"}
{"level":"debug","message":"Executing query [m8p3mygosvldxk3edz8]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742943633126\",true]","timestamp":"2025-03-25T23:00:33.144Z"}
{"level":"debug","message":"Executing query [m8p3mygu76j7pplmyux]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-25T23:00:33.150Z"}
{"level":"debug","message":"Executing query [m8p3mygwpdb4v90ypi9]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742943633126\"]","timestamp":"2025-03-25T23:00:33.152Z"}
{"level":"debug","message":"Executing query [m8p3mygyjkmusllbmei]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",14]","timestamp":"2025-03-25T23:00:33.154Z"}
{"level":"debug","message":"Executing query [m8p3myh1g487e9thfxe]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-25T23:00:33.157Z"}
{"level":"debug","message":"Executing query [m8p3myh3v0ey4hv874]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-25T23:00:33.159Z"}
{"level":"debug","message":"Executing query [m8p3myh6jgiqsrwcsq]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-25T23:00:33.162Z"}
{"level":"debug","message":"Executing query [m8p3myh8hrnrn2xnnvg]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-25T23:00:33.164Z"}
{"level":"debug","message":"Executing query [m8p3myh9bfspgqu0bjk]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-25T23:00:33.165Z"}
{"level":"debug","message":"Executing query [m8p3myhdu6rncrpj2y]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-25T23:00:33.169Z"}
{"level":"debug","message":"Executing query [m8p3myhebyna94gjf7a]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T23:00:33.170Z"}
{"level":"debug","message":"Executing query [m8p3myhf5t5q2f2jw3c]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T23:00:33.171Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:00:33.172Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:33.365Z"}
{"level":"debug","message":"Executing query [m8p3mymw3bhdkc2ppjm]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:00:33.368Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:00:33.378Z"}
{"level":"debug","message":"Executing query [m8p3myn752ind5x7mnu]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:33.379Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p3myn752ind5x7mnu]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T23:00:33.381Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T23:00:33.382Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:33.493Z"}
{"level":"debug","message":"Executing query [m8p3myqgyrruyr9ti6]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:00:33.496Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:00:33.510Z"}
{"level":"debug","message":"Executing query [m8p3myqweiva71agg8p]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:33.512Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p3myqweiva71agg8p]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-25T23:00:33.513Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T23:00:33.514Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:33.704Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:34.138Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T23:00:34.207Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:00:34.267Z"}
{"level":"debug","message":"Executing query [m8p3mzckxvqtsnyrg6]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:34.293Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p3mzckxvqtsnyrg6]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-25T23:00:34.302Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-25T23:00:34.305Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:00:34.329Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:34.509Z"}
{"level":"debug","message":"Executing query [m8p3mzio76cxflpe2z3]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:00:34.512Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:00:34.521Z"}
{"level":"debug","message":"Executing query [m8p3mzizgey73cnqh5m]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T23:00:34.523Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p3mzizgey73cnqh5m]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T23:00:34.524Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T23:00:34.524Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:36.573Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:00:36.575Z"}
{"level":"debug","message":"Executing query [m8p3n141aunj46d1wbi]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:00:36.577Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:00:36.587Z"}
{"level":"debug","message":"Executing query [m8p3n14dorm3vjesi8m]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T23:00:36.589Z"}
{"level":"debug","message":"Executing query [m8p3n14f84hm3dhh9ou]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T23:00:36.591Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T23:00:36.592Z"}
{"level":"debug","message":"Executing query [m8p3n14gw8tpand107]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T23:00:36.592Z"}
{"level":"debug","message":"Executing query [m8p3n14h7dzszr24fji]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T23:00:36.593Z"}
{"level":"debug","message":"Executing query [m8p3n14i2cbh7a6oxlf]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T23:00:36.594Z"}
{"level":"debug","message":"Executing query [m8p3n14jhmpp8yvpe05]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T23:00:36.595Z"}
{"code":"ER_DATA_TOO_LONG","error":"Data too long for column 'CodigoCIP' at row 1","level":"error","message":"Database query error [m8p3n14jhmpp8yvpe05]","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T23:00:36.595Z"}
{"level":"error","message":"Error al crear usuario: Data too long for column 'CodigoCIP' at row 1","timestamp":"2025-03-25T23:00:36.596Z"}
{"level":"debug","message":"Executing query [m8p3n14m7qhxyk4dj9l]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T23:00:36.598Z"}
{"level":"error","message":"Error al obtener usuario por CIP: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveLength\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected length: \u001b[32m1\u001b[39m\nReceived length: \u001b[31m0\u001b[39m\nReceived array:  \u001b[31m[]\u001b[39m","timestamp":"2025-03-25T23:00:36.601Z"}
{"level":"debug","message":"Executing query [m8p3n14q72mm3a2dxfm]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T23:00:36.603Z"}
{"level":"debug","message":"Executing query [m8p3n14rv6p9nk4bwzh]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T23:00:36.603Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T23:00:36.604Z"}
{"level":"debug","message":"Executing query [m8p3n14tfdktolvyeup]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T23:00:36.605Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:00:36.606Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:02:57.771Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:02:57.804Z"}
{"level":"debug","message":"Executing query [m8p3q2343t4fvrn2e7b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:02:57.808Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:02:57.839Z"}
{"level":"debug","message":"Executing query [m8p3q242ipuio5n1ka]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T23:02:57.842Z"}
{"level":"debug","message":"Executing query [m8p3q245rh3t9z93uv]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T23:02:57.845Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T23:02:57.847Z"}
{"level":"debug","message":"Executing query [m8p3q247hveu4znzqf]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-25T23:02:57.848Z"}
{"level":"debug","message":"Executing query [m8p3q24aplo018s5dbh]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-25T23:02:57.850Z"}
{"level":"debug","message":"Executing query [m8p3q24dctcc2l5nkh7]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-25T23:02:57.853Z"}
{"level":"debug","message":"Executing query [m8p3q24flpfu59joa9a]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Grado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-25T23:02:57.855Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'Grado' in 'field list'","level":"error","message":"Database query error [m8p3q24flpfu59joa9a]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Grado) VALUES (?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-25T23:02:57.857Z"}
{"level":"error","message":"Error al crear usuario: Unknown column 'Grado' in 'field list'","timestamp":"2025-03-25T23:02:57.858Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:02:57.864Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:02:57.865Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:02:57.866Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:02:57.867Z"}
{"level":"debug","message":"Executing query [m8p3q24sfu38gecncmt]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-25T23:02:57.868Z"}
{"level":"debug","message":"Executing query [m8p3q24ujol7n2n0ga]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-25T23:02:57.870Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-25T23:02:57.872Z"}
{"level":"debug","message":"Executing query [m8p3q24wvc5ga3hdfx]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T23:02:57.872Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:02:57.874Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:04:52.801Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:04:52.835Z"}
{"level":"debug","message":"Executing query [m8p3siue4uxn97wzoph]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T23:04:52.839Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:04:52.874Z"}
{"level":"debug","message":"Executing query [m8p3sivjjxjkr4x8d8k]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:04:52.879Z"}
{"level":"debug","message":"Executing query [m8p3sivmv5q45b3rj8p]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T23:04:52.882Z"}
{"level":"debug","message":"Executing query [m8p3sivoj1im7hmohj]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T23:04:52.884Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T23:04:52.885Z"}
{"level":"debug","message":"Executing query [m8p3sivqj7ivduw3ad]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-25T23:04:52.886Z"}
{"level":"debug","message":"Executing query [m8p3sivt8zbdu68ygav]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-25T23:04:52.889Z"}
{"level":"debug","message":"Executing query [m8p3sivwgfmz60qekai]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-25T23:04:52.892Z"}
{"level":"debug","message":"Executing query [m8p3sivydk49bw39jd7]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-25T23:04:52.894Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-25T23:04:52.917Z"}
{"level":"warn","message":"La columna Grado no está presente en la tabla Usuario, la prueba puede fallar","timestamp":"2025-03-25T23:04:52.918Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Grado) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-25T23:04:52.919Z"}
{"level":"debug","message":"Executing query [m8p3siwojahvadheflo]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Grado) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-25T23:04:52.920Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'Grado' in 'field list'","level":"error","message":"Database query error [m8p3siwojahvadheflo]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Grado) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-25T23:04:52.921Z"}
{"level":"error","message":"Error al crear usuario: Unknown column 'Grado' in 'field list'","timestamp":"2025-03-25T23:04:52.922Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:04:52.928Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:04:52.930Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:04:52.931Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:04:52.933Z"}
{"level":"debug","message":"Executing query [m8p3six2hrn6pcb9z75]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-25T23:04:52.934Z"}
{"level":"debug","message":"Executing query [m8p3six4gzswsvnhljc]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-25T23:04:52.936Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-25T23:04:52.937Z"}
{"level":"debug","message":"Executing query [m8p3six6y564pcd0bdm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T23:04:52.938Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:04:52.940Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:10.083Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:10.119Z"}
{"level":"debug","message":"Executing query [m8p3u6h6zsut92bkve]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:10.122Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:06:10.158Z"}
{"level":"debug","message":"Executing query [m8p3u6ib04w0t33lya7q]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:06:10.163Z"}
{"level":"debug","message":"Executing query [m8p3u6ic0ywa04k5yvbm]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T23:06:10.164Z"}
{"level":"debug","message":"Executing query [m8p3u6ievmui2d9g76]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T23:06:10.166Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T23:06:10.169Z"}
{"level":"debug","message":"Executing query [m8p3u6ihqmyaedsj9wh]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-25T23:06:10.169Z"}
{"level":"debug","message":"Executing query [m8p3u6ijxeumktvfgca]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-25T23:06:10.171Z"}
{"level":"debug","message":"Executing query [m8p3u6inw2mohvuwgi]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-25T23:06:10.175Z"}
{"level":"debug","message":"Executing query [m8p3u6iopqcat53re6c]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-25T23:06:10.176Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-25T23:06:10.180Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-25T23:06:10.181Z"}
{"level":"debug","message":"Executing query [m8p3u6iuwsly2saex]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-25T23:06:10.182Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8p3u6iuwsly2saex]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-25T23:06:10.184Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-25T23:06:10.184Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-25T23:06:10.185Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:06:10.189Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:06:10.191Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:06:10.193Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:06:10.195Z"}
{"level":"debug","message":"Executing query [m8p3u6j8rxuqszjhb1i]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-25T23:06:10.196Z"}
{"level":"debug","message":"Executing query [m8p3u6jae8l0be4dm8]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-25T23:06:10.198Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-25T23:06:10.199Z"}
{"level":"debug","message":"Executing query [m8p3u6jb6simbzq7pyu]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T23:06:10.199Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:06:10.200Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:25.910Z"}
{"level":"debug","message":"Executing query [m8p3uioeepuppn6dokc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:06:25.934Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:06:25.975Z"}
{"level":"debug","message":"Executing query [m8p3uipnvoxjv76gzx]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742943985933\"]","timestamp":"2025-03-25T23:06:25.979Z"}
{"level":"debug","message":"Executing query [m8p3uiprt5ej75755e]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742943985933\"]","timestamp":"2025-03-25T23:06:25.983Z"}
{"level":"debug","message":"Executing query [m8p3uiptvky52k20gk]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742943985933\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T23:06:25.985Z"}
{"level":"debug","message":"Executing query [m8p3uiq1y3cv8idt1zi]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T23:06:25.993Z"}
{"level":"debug","message":"Executing query [m8p3uiq4ltz2l6ixroi]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742943985933\"]","timestamp":"2025-03-25T23:06:25.996Z"}
{"level":"debug","message":"Executing query [m8p3uiq77cnxjh63hv3]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1013]","timestamp":"2025-03-25T23:06:25.999Z"}
{"level":"debug","message":"Executing query [m8p3uiqbiyc481kifol]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T23:06:26.003Z"}
{"level":"debug","message":"Executing query [m8p3uiqeqi60jm2ray]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T23:06:26.006Z"}
{"level":"debug","message":"Executing query [m8p3uiqizr30iqg07uf]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T23:06:26.010Z"}
{"level":"debug","message":"Executing query [m8p3uiqkft5h6ntur8m]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T23:06:26.012Z"}
{"level":"debug","message":"Executing query [m8p3uiqnpyvgkos8s0e]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T23:06:26.015Z"}
{"level":"debug","message":"Executing query [m8p3uiqqkr2n38a2tdi]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T23:06:26.018Z"}
{"level":"debug","message":"Executing query [m8p3uiqs2rq87xflikv]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T23:06:26.020Z"}
{"level":"debug","message":"Executing query [m8p3uiqvde3u2zq8oq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T23:06:26.023Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:06:26.024Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T23:06:26.136Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T23:06:26.139Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T23:06:26.142Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:26.376Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T23:06:26.143Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T23:06:26.146Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T23:06:26.150Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T23:06:26.153Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T23:06:26.156Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T23:06:26.157Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T23:06:26.159Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T23:06:26.161Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T23:06:26.162Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:27.471Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T23:06:27.631Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T23:06:27.638Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:06:27.704Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T23:06:27.719Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:06:27.772Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:28.152Z"}
{"level":"debug","message":"Executing query [m8p3uke4elwpbqh5vuf]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:28.156Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:06:28.172Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-25T23:06:28.175Z"}
{"level":"debug","message":"Executing query [m8p3ukeo4foqx38z7kr]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:28.176Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-25T23:06:28.177Z"}
{"level":"debug","message":"Executing query [m8p3ukeq24xlcjsdzvv]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:28.178Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-25T23:06:28.179Z"}
{"level":"debug","message":"Executing query [m8p3ukery1ktu8s62je]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:28.179Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-25T23:06:28.181Z"}
{"level":"debug","message":"Executing query [m8p3uket9bus2tjyw69]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:28.181Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-25T23:06:28.182Z"}
{"level":"debug","message":"Executing query [m8p3ukeuiju217jvsc]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:28.182Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8p3ukeuiju217jvsc]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-25T23:06:28.183Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-25T23:06:28.184Z"}
{"level":"debug","message":"Executing query [m8p3ukewyrwyeine88b]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:28.184Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-25T23:06:28.185Z"}
{"level":"debug","message":"Executing query [m8p3ukeys342wva42r]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:28.186Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-25T23:06:28.187Z"}
{"level":"debug","message":"Executing query [m8p3ukf0ovnlaz5cpdg]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:28.188Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p3ukf0ovnlaz5cpdg]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T23:06:28.189Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-25T23:06:28.189Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-25T23:06:28.190Z"}
{"level":"debug","message":"Executing query [m8p3ukf3uvg6z0r8jx]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:28.191Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p3ukf3uvg6z0r8jx]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T23:06:28.192Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-25T23:06:28.193Z"}
{"level":"debug","message":"Executing query [m8p3ukf5xldgoi1xp6]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:28.193Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p3ukf5xldgoi1xp6]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T23:06:28.195Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-25T23:06:28.196Z"}
{"level":"debug","message":"Executing query [m8p3ukf8vcweq9kmuye]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:28.196Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p3ukf8vcweq9kmuye]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T23:06:28.197Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-25T23:06:28.198Z"}
{"level":"debug","message":"Executing query [m8p3ukfauoux6pud0qs]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:28.198Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p3ukfauoux6pud0qs]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-25T23:06:28.199Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-25T23:06:28.199Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-25T23:06:28.200Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-25T23:06:28.201Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-25T23:06:28.202Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-25T23:06:28.202Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-25T23:06:28.203Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-25T23:06:28.203Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-25T23:06:28.203Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-25T23:06:28.203Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-25T23:06:28.204Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-25T23:06:28.204Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-25T23:06:28.204Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-25T23:06:28.204Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-25T23:06:28.205Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-25T23:06:28.205Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-25T23:06:28.205Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-25T23:06:28.205Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-25T23:06:28.206Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-25T23:06:28.206Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:06:28.207Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:28.671Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:28.952Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:06:28.974Z"}
{"level":"debug","message":"Executing query [m8p3ul0xdsz0usjh6gq]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T23:06:28.977Z"}
{"level":"debug","message":"Executing query [m8p3ul1181itqjcaa79]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T23:06:28.981Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p3ul1181itqjcaa79]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T23:06:28.982Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:06:28.984Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:29.135Z"}
{"level":"debug","message":"Executing query [m8p3ul5ejrwk9dvfk6]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:06:29.138Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:06:29.150Z"}
{"level":"debug","message":"Executing query [m8p3ul5sbw7g4lpz6u]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:29.152Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T23:06:29.154Z"}
{"level":"debug","message":"Executing query [m8p3ul5vibykr4k5aw]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T23:06:29.155Z"}
{"level":"debug","message":"Executing query [m8p3ul5w5orib3vlijn]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T23:06:29.156Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T23:06:29.157Z"}
{"level":"debug","message":"Executing query [m8p3ul5xn22hqrjq51e]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:29.157Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T23:06:29.159Z"}
{"level":"debug","message":"Executing query [m8p3ul64w04jkro4n4f]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T23:06:29.164Z"}
{"level":"debug","message":"Executing query [m8p3ul69jag0g38exc]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T23:06:29.169Z"}
{"level":"debug","message":"Executing query [m8p3ul6byn55pgp0n3s]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T23:06:29.171Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:31.195Z"}
{"duration":"8ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T23:06:31.267Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T23:06:31.272Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:06:31.281Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T23:06:31.283Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T23:06:31.400Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T23:06:31.519Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:31.674Z"}
{"level":"debug","message":"Executing query [m8p3un3xq1dky6yqwui]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:06:31.677Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:06:31.690Z"}
{"level":"debug","message":"Executing query [m8p3un4c184vtzv2eol]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:31.692Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p3un4c184vtzv2eol]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T23:06:31.693Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T23:06:31.695Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:31.919Z"}
{"level":"debug","message":"Executing query [m8p3unaqi1buamemko7]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:06:31.922Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:06:31.935Z"}
{"level":"debug","message":"Executing query [m8p3unb52yfbv99u5v8]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:31.937Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p3unb52yfbv99u5v8]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T23:06:31.940Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T23:06:31.940Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:32.936Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:06:32.995Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T23:06:32.998Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T23:06:33.100Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T23:06:33.101Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T23:06:33.101Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T23:06:33.102Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T23:06:33.102Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T23:06:33.102Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:33.580Z"}
{"level":"debug","message":"Executing query [m8p3uokvh8nuwg5tgl]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:06:33.583Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:06:33.592Z"}
{"level":"debug","message":"Executing query [m8p3uol67qlalrtsfvd]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742943993582\"]","timestamp":"2025-03-25T23:06:33.594Z"}
{"level":"debug","message":"Executing query [m8p3uol8zqnxht8qxo]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742943993582\",true]","timestamp":"2025-03-25T23:06:33.596Z"}
{"level":"debug","message":"Executing query [m8p3uold5m7ar2o7pkb]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T23:06:33.602Z"}
{"level":"debug","message":"Executing query [m8p3uolg1s67yx4oae4]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742943993582\"]","timestamp":"2025-03-25T23:06:33.604Z"}
{"level":"debug","message":"Executing query [m8p3uoliupjpljw5qoa]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",15]","timestamp":"2025-03-25T23:06:33.606Z"}
{"level":"debug","message":"Executing query [m8p3uolls28bwb1dg27]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T23:06:33.609Z"}
{"level":"debug","message":"Executing query [m8p3uolnh2yte5yp1tt]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T23:06:33.611Z"}
{"level":"debug","message":"Executing query [m8p3uolrh58ezev57jh]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T23:06:33.615Z"}
{"level":"debug","message":"Executing query [m8p3uolsdlem952g4xs]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T23:06:33.616Z"}
{"level":"debug","message":"Executing query [m8p3uolu1epeqe74uai]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T23:06:33.618Z"}
{"level":"debug","message":"Executing query [m8p3uolxvh3r15xf3ds]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T23:06:33.621Z"}
{"level":"debug","message":"Executing query [m8p3uolypb6byz2q6h]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T23:06:33.622Z"}
{"level":"debug","message":"Executing query [m8p3uolzsiysh5fbgnm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T23:06:33.623Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:06:33.624Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:33.803Z"}
{"level":"debug","message":"Executing query [m8p3uor3v5qhhe41h9f]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:06:33.807Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:06:33.819Z"}
{"level":"debug","message":"Executing query [m8p3uorhgymim8kzr1]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:33.821Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p3uorhgymim8kzr1]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T23:06:33.822Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T23:06:33.824Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:33.929Z"}
{"level":"debug","message":"Executing query [m8p3uoumis4w0ew3l7j]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:06:33.934Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:06:33.950Z"}
{"level":"debug","message":"Executing query [m8p3uov4eg36zheq4ba]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:33.952Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p3uov4eg36zheq4ba]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-25T23:06:33.955Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T23:06:33.955Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:34.228Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:34.745Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T23:06:34.830Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:06:34.886Z"}
{"level":"debug","message":"Executing query [m8p3uplrirnu9y26w6a]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:34.911Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p3uplrirnu9y26w6a]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-25T23:06:34.913Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-25T23:06:34.915Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:06:34.941Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:35.163Z"}
{"level":"debug","message":"Executing query [m8p3upsu1l1ytqd5o09]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:06:35.166Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:06:35.179Z"}
{"level":"debug","message":"Executing query [m8p3upt81bs752sxyhe]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:35.180Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p3upt81bs752sxyhe]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T23:06:35.182Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T23:06:35.182Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:38.089Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:06:38.093Z"}
{"level":"debug","message":"Executing query [m8p3us278f4i5dhw1op]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T23:06:38.095Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:06:38.106Z"}
{"level":"debug","message":"Executing query [m8p3us2l2ykw3big1ms]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:06:38.109Z"}
{"level":"debug","message":"Executing query [m8p3us2ml0ad8fgsoh]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T23:06:38.110Z"}
{"level":"debug","message":"Executing query [m8p3us2oe5boo8bvvq]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T23:06:38.112Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T23:06:38.114Z"}
{"level":"debug","message":"Executing query [m8p3us2q6uhw2954v25]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-25T23:06:38.114Z"}
{"level":"debug","message":"Executing query [m8p3us2raxq5qp84vkr]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-25T23:06:38.115Z"}
{"level":"debug","message":"Executing query [m8p3us2tumencj7qqna]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-25T23:06:38.117Z"}
{"level":"debug","message":"Executing query [m8p3us2uqbicu7c5vqk]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-25T23:06:38.118Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-25T23:06:38.121Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-25T23:06:38.122Z"}
{"level":"debug","message":"Executing query [m8p3us2z0bpvel02v45a]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-25T23:06:38.123Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8p3us2z0bpvel02v45a]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-25T23:06:38.124Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-25T23:06:38.125Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-25T23:06:38.125Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:06:38.127Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:06:38.128Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:06:38.129Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:06:38.129Z"}
{"level":"debug","message":"Executing query [m8p3us36er3pox7ke0l]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-25T23:06:38.130Z"}
{"level":"debug","message":"Executing query [m8p3us376p1ut0glzio]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-25T23:06:38.131Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-25T23:06:38.133Z"}
{"level":"debug","message":"Executing query [m8p3us3941k9n87483w]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T23:06:38.133Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:06:38.134Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T23:07:02.196Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T23:07:02.205Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T23:07:02.220Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T23:07:02.224Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T23:07:02.229Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T23:07:02.236Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T23:07:02.239Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T23:07:02.245Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T23:07:02.248Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T23:07:02.251Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T23:07:02.253Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T23:07:02.254Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:02.432Z"}
{"level":"debug","message":"Executing query [m8p3vavoyxdvchae8ij]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:07:02.484Z"}
{"level":"debug","message":"Executing query [m8p3vaxlwudk29iex7]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742944022481\"]","timestamp":"2025-03-25T23:07:02.554Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:02.483Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:07:02.557Z"}
{"level":"debug","message":"Executing query [m8p3vay80qi0jwe8fm8q]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742944022481\"]","timestamp":"2025-03-25T23:07:02.576Z"}
{"level":"debug","message":"Executing query [m8p3vayfjjfewfg1f1l]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742944022481\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T23:07:02.583Z"}
{"level":"debug","message":"Executing query [m8p3vayoy8subfl03a]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T23:07:02.592Z"}
{"level":"debug","message":"Executing query [m8p3vaysy6rlr6cms1]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742944022481\"]","timestamp":"2025-03-25T23:07:02.596Z"}
{"level":"debug","message":"Executing query [m8p3vayvryfnotkh7an]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1014]","timestamp":"2025-03-25T23:07:02.599Z"}
{"level":"debug","message":"Executing query [m8p3vaz06ij3fvws9ne]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T23:07:02.604Z"}
{"level":"debug","message":"Executing query [m8p3vaz3nrjpttyosq]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T23:07:02.607Z"}
{"level":"debug","message":"Executing query [m8p3vaz8lxhlfvnkzmn]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T23:07:02.612Z"}
{"level":"debug","message":"Executing query [m8p3vaza2r8dh5nwi2k]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T23:07:02.614Z"}
{"level":"debug","message":"Executing query [m8p3vazce8txlsvwsi4]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T23:07:02.616Z"}
{"level":"debug","message":"Executing query [m8p3vazgjsoh516u6pg]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T23:07:02.620Z"}
{"level":"debug","message":"Executing query [m8p3vazidhu2i2an2ok]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T23:07:02.624Z"}
{"level":"debug","message":"Executing query [m8p3vazm988qrhasak]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T23:07:02.626Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:07:02.629Z"}
{"level":"debug","message":"Executing query [m8p3vaxhfhtiyne9tzr]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:02.549Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:07:02.626Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-25T23:07:02.632Z"}
{"level":"debug","message":"Executing query [m8p3vazt8wjc5zj8eh]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:02.633Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-25T23:07:02.635Z"}
{"level":"debug","message":"Executing query [m8p3vazvcbanl0imve]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:02.636Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-25T23:07:02.637Z"}
{"level":"debug","message":"Executing query [m8p3vazxwfms2mwc78h]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:02.638Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-25T23:07:02.639Z"}
{"level":"debug","message":"Executing query [m8p3vb00w2469oaepn]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:02.640Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-25T23:07:02.641Z"}
{"level":"debug","message":"Executing query [m8p3vb02xnwu9pbtvt]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:02.642Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8p3vb02xnwu9pbtvt]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-25T23:07:02.644Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-25T23:07:02.644Z"}
{"level":"debug","message":"Executing query [m8p3vb046gp561r9d2]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:02.644Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-25T23:07:02.646Z"}
{"level":"debug","message":"Executing query [m8p3vb06n1ornkfvk6r]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:02.646Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-25T23:07:02.648Z"}
{"level":"debug","message":"Executing query [m8p3vb08xk3l6t5zrze]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:02.648Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p3vb08xk3l6t5zrze]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T23:07:02.650Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-25T23:07:02.650Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-25T23:07:02.650Z"}
{"level":"debug","message":"Executing query [m8p3vb0eq1jcez2knw]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:02.654Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p3vb0eq1jcez2knw]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T23:07:02.656Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-25T23:07:02.656Z"}
{"level":"debug","message":"Executing query [m8p3vb0gchdl2v8b3a]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:02.657Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p3vb0gchdl2v8b3a]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T23:07:02.658Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-25T23:07:02.658Z"}
{"level":"debug","message":"Executing query [m8p3vb0jr1vk63nvjqh]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:02.659Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p3vb0jr1vk63nvjqh]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T23:07:02.660Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-25T23:07:02.661Z"}
{"level":"debug","message":"Executing query [m8p3vb0l8qg5d9m4mvt]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:02.661Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p3vb0l8qg5d9m4mvt]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-25T23:07:02.662Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-25T23:07:02.663Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-25T23:07:02.663Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-25T23:07:02.664Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-25T23:07:02.665Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-25T23:07:02.665Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-25T23:07:02.665Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-25T23:07:02.665Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-25T23:07:02.665Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-25T23:07:02.665Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-25T23:07:02.666Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-25T23:07:02.666Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-25T23:07:02.666Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-25T23:07:02.666Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-25T23:07:02.666Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-25T23:07:02.666Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-25T23:07:02.667Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-25T23:07:02.667Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-25T23:07:02.667Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-25T23:07:02.667Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:07:02.670Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:02.723Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:07:02.816Z"}
{"level":"debug","message":"Executing query [m8p3vb52xa9rom62o0i]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T23:07:02.822Z"}
{"level":"debug","message":"Executing query [m8p3vb54cjibb05yak5]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T23:07:02.824Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p3vb54cjibb05yak5]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T23:07:02.828Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:07:02.831Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:02.792Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:02.649Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T23:07:02.840Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:02.897Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:02.959Z"}
{"level":"debug","message":"Executing query [m8p3vb96vit71bhgwk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:07:02.971Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:07:02.991Z"}
{"level":"debug","message":"Executing query [m8p3vb9t6q4zqzvqlqs]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:02.993Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8p3vb9t6q4zqzvqlqs]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-25T23:07:02.996Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T23:07:02.996Z"}
{"level":"debug","message":"Executing query [m8p3vb8xkxrrg2vf2oh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:07:02.961Z"}
{"level":"debug","message":"Executing query [m8p3vbagdecsoxoajp]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:03.017Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:07:03.021Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T23:07:03.028Z"}
{"level":"debug","message":"Executing query [m8p3vbath0s8v42io47]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T23:07:03.029Z"}
{"level":"debug","message":"Executing query [m8p3vbaxezfwdks44pj]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T23:07:03.033Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T23:07:03.037Z"}
{"level":"debug","message":"Executing query [m8p3vbb2frfeawng4if]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:03.038Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T23:07:03.048Z"}
{"level":"debug","message":"Executing query [m8p3vbdbg7oua1j1kt]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T23:07:03.120Z"}
{"level":"debug","message":"Executing query [m8p3vbdj1wej7684bv4]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T23:07:03.127Z"}
{"level":"debug","message":"Executing query [m8p3vbdn8b58xa3r25g]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T23:07:03.131Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T23:07:03.021Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:03.111Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T23:07:03.216Z"}
{"level":"debug","message":"Executing query [m8p3vbeqaibtiyuertn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:07:03.171Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:07:03.224Z"}
{"level":"debug","message":"Executing query [m8p3vbgfhx52wbejwkf]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:03.232Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8p3vbgfhx52wbejwkf]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-25T23:07:03.235Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T23:07:03.237Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T23:07:03.217Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T23:07:03.218Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T23:07:03.218Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T23:07:03.219Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T23:07:03.219Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:03.499Z"}
{"level":"debug","message":"Executing query [m8p3vbnzoih14wuzldo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:07:03.503Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:07:03.533Z"}
{"level":"debug","message":"Executing query [m8p3vbow4ftbm2udtn2]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:03.536Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8p3vbow4ftbm2udtn2]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-25T23:07:03.538Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T23:07:03.538Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:03.546Z"}
{"level":"debug","message":"Executing query [m8p3vbph23aexzhbffq]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:07:03.558Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:07:03.617Z"}
{"level":"debug","message":"Executing query [m8p3vbrexb5o1eni68l]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:03.627Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p3vbrexb5o1eni68l]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-25T23:07:03.630Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T23:07:03.630Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:03.680Z"}
{"level":"debug","message":"Executing query [m8p3vbt03lszhbqjqhk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:07:03.684Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:07:03.735Z"}
{"level":"debug","message":"Executing query [m8p3vbuhry59jyv3xzd]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:03.737Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8p3vbuhry59jyv3xzd]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-25T23:07:03.739Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-25T23:07:03.739Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:03.668Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:03.983Z"}
{"level":"debug","message":"Executing query [m8p3vc2a0jw1ar8u7xcj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:07:04.018Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:07:04.056Z"}
{"level":"debug","message":"Executing query [m8p3vc3htdq66kp54y9]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742944024017\"]","timestamp":"2025-03-25T23:07:04.061Z"}
{"level":"debug","message":"Executing query [m8p3vc3j8lmbd6n9i0u]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742944024017\",true]","timestamp":"2025-03-25T23:07:04.063Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:04.052Z"}
{"level":"debug","message":"Executing query [m8p3vc3ul86obsu9p3q]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[16]","timestamp":"2025-03-25T23:07:04.074Z"}
{"level":"debug","message":"Executing query [m8p3vc3zfhqaszl3aps]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742944024017\"]","timestamp":"2025-03-25T23:07:04.079Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:04.064Z"}
{"level":"debug","message":"Executing query [m8p3vc3mc25945eadh]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:04.066Z"}
{"level":"debug","message":"Executing query [m8p3vc4118tq3z7zi76]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",16]","timestamp":"2025-03-25T23:07:04.081Z"}
{"level":"debug","message":"Executing query [m8p3vc46u94qjxckmy8]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[16]","timestamp":"2025-03-25T23:07:04.086Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:07:04.090Z"}
{"level":"debug","message":"Executing query [m8p3vc48xyfzbf8u3ld]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[16]","timestamp":"2025-03-25T23:07:04.088Z"}
{"level":"debug","message":"Executing query [m8p3vc4e6kqeb3afcxu]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T23:07:04.094Z"}
{"level":"debug","message":"Executing query [m8p3vc4boqaloccr1d]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[16]","timestamp":"2025-03-25T23:07:04.092Z"}
{"level":"debug","message":"Executing query [m8p3vc4k8cwgoqc12kn]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T23:07:04.100Z"}
{"level":"debug","message":"Executing query [m8p3vc4emgzvvum3czf]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[16]","timestamp":"2025-03-25T23:07:04.094Z"}
{"level":"debug","message":"Executing query [m8p3vc4hng8frbx3tut]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[16]","timestamp":"2025-03-25T23:07:04.097Z"}
{"level":"debug","message":"Executing query [m8p3vc4kj4cy56q5bgf]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[16]","timestamp":"2025-03-25T23:07:04.100Z"}
{"level":"debug","message":"Executing query [m8p3vc4luz2q4w36lcr]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T23:07:04.101Z"}
{"level":"debug","message":"Executing query [m8p3vc4nz5nwl036ct]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T23:07:04.103Z"}
{"level":"debug","message":"Executing query [m8p3vc4md700z8flrn]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T23:07:04.102Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T23:07:04.103Z"}
{"level":"debug","message":"Executing query [m8p3vc4o5jums1rc4w]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-25T23:07:04.104Z"}
{"level":"debug","message":"Executing query [m8p3vc4qdox0byx7z1p]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-25T23:07:04.106Z"}
{"level":"debug","message":"Executing query [m8p3vc4tbr2j8bc5u2]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-25T23:07:04.109Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:07:04.105Z"}
{"level":"debug","message":"Executing query [m8p3vc53qjfcoo4874]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-25T23:07:04.119Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-25T23:07:04.125Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-25T23:07:04.126Z"}
{"level":"debug","message":"Executing query [m8p3vc5acx5ovjbms46]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-25T23:07:04.126Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8p3vc5acx5ovjbms46]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-25T23:07:04.129Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-25T23:07:04.129Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-25T23:07:04.129Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:07:04.131Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:07:04.132Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:07:04.133Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-25T23:07:04.134Z"}
{"level":"debug","message":"Executing query [m8p3vc5j30f99wwt45p]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-25T23:07:04.135Z"}
{"level":"debug","message":"Executing query [m8p3vc5kx6kzvvnyrfm]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-25T23:07:04.136Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-25T23:07:04.137Z"}
{"level":"debug","message":"Executing query [m8p3vc5m278u0uph9nx]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T23:07:04.138Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:07:04.140Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:04.231Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T23:07:04.468Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T23:07:04.483Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:07:04.661Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T23:07:04.677Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:07:04.741Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:04.861Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T23:07:05.003Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:07:05.092Z"}
{"level":"debug","message":"Executing query [m8p3vcx2f810w3nge18]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-25T23:07:05.127Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8p3vcx2f810w3nge18]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-25T23:07:05.128Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-25T23:07:05.130Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:07:05.158Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:05.891Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:07:06.012Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T23:07:06.014Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T23:07:05.899Z"}
{"duration":"23ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T23:07:06.091Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T23:07:06.097Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T23:07:06.102Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T23:07:06.106Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T04:59:04.599Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T04:59:04.609Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T04:59:04.611Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T04:59:04.621Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T04:59:04.625Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T04:59:04.639Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T04:59:04.643Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T04:59:04.651Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T04:59:04.652Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T04:59:04.656Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T04:59:04.669Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T04:59:04.676Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:05.026Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:05.086Z"}
{"level":"debug","message":"Executing query [m8pgg17hgvp18ivt8h]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T04:59:05.118Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T04:59:05.196Z"}
{"level":"debug","message":"Executing query [m8pgg19sa43n86guvpl]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742965145094\"]","timestamp":"2025-03-26T04:59:05.200Z"}
{"level":"debug","message":"Executing query [m8pgg1ammwnkqsfa5j]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742965145094\"]","timestamp":"2025-03-26T04:59:05.230Z"}
{"level":"debug","message":"Executing query [m8pgg18ufj7yuuet6o7]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.167Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T04:59:05.234Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T04:59:05.252Z"}
{"level":"debug","message":"Executing query [m8pgg1ar91if4zusjgq]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742965145094\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T04:59:05.235Z"}
{"level":"debug","message":"Executing query [m8pgg1b8ee4k089fgvs]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.252Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T04:59:05.257Z"}
{"level":"debug","message":"Executing query [m8pgg1bd545e0eumytq]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.257Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T04:59:05.261Z"}
{"level":"debug","message":"Executing query [m8pgg1bixtsi0qb0jqo]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.262Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T04:59:05.264Z"}
{"level":"debug","message":"Executing query [m8pgg1bl63tn4dqoev]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.265Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T04:59:05.267Z"}
{"level":"debug","message":"Executing query [m8pgg1bn40zyayhcit2]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.267Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8pgg1bn40zyayhcit2]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T04:59:05.271Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T04:59:05.272Z"}
{"level":"debug","message":"Executing query [m8pgg1bsw77ltevu23r]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.272Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T04:59:05.275Z"}
{"level":"debug","message":"Executing query [m8pgg1bva3ci2bvhix]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.275Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T04:59:05.277Z"}
{"level":"debug","message":"Executing query [m8pgg1bx09i1m5o4gx7]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.277Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8pgg1bx09i1m5o4gx7]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T04:59:05.279Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T04:59:05.280Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T04:59:05.280Z"}
{"level":"debug","message":"Executing query [m8pgg1c46ps73r19k9r]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.284Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8pgg1c46ps73r19k9r]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T04:59:05.287Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T04:59:05.288Z"}
{"level":"debug","message":"Executing query [m8pgg1c9i28j07nusoq]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.289Z"}
{"level":"debug","message":"Executing query [m8pgg1bm6d4whwifk4f]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1022]","timestamp":"2025-03-26T04:59:05.266Z"}
{"level":"debug","message":"Executing query [m8pgg1bvn37f5ko3d3]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742965145094\"]","timestamp":"2025-03-26T04:59:05.275Z"}
{"level":"debug","message":"Executing query [m8pgg1c5bz0xexjbwbm]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1022]","timestamp":"2025-03-26T04:59:05.286Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8pgg1c9i28j07nusoq]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T04:59:05.290Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T04:59:05.291Z"}
{"level":"debug","message":"Executing query [m8pgg1cbjbvy1138ro]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.291Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8pgg1cbjbvy1138ro]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T04:59:05.293Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T04:59:05.293Z"}
{"level":"debug","message":"Executing query [m8pgg1cd0y52x0whopz]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.293Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8pgg1cd0y52x0whopz]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T04:59:05.295Z"}
{"level":"debug","message":"Executing query [m8pgg1cngsaj0l6ptxb]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1022]","timestamp":"2025-03-26T04:59:05.303Z"}
{"level":"debug","message":"Executing query [m8pgg1cqudbzqxbn2v]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1022]","timestamp":"2025-03-26T04:59:05.306Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T04:59:05.296Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T04:59:05.296Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T04:59:05.297Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T04:59:05.297Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T04:59:05.298Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T04:59:05.298Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T04:59:05.298Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T04:59:05.298Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T04:59:05.298Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T04:59:05.298Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T04:59:05.299Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T04:59:05.299Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T04:59:05.299Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T04:59:05.299Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T04:59:05.300Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T04:59:05.300Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T04:59:05.300Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T04:59:05.300Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T04:59:05.300Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T04:59:05.303Z"}
{"level":"debug","message":"Executing query [m8pgg1cv2fwmmtzici7]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1022]","timestamp":"2025-03-26T04:59:05.311Z"}
{"level":"debug","message":"Executing query [m8pgg1cz17n55l10e8i]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1022]","timestamp":"2025-03-26T04:59:05.315Z"}
{"level":"debug","message":"Executing query [m8pgg1d1l9vf7jg34kd]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1022]","timestamp":"2025-03-26T04:59:05.317Z"}
{"level":"debug","message":"Executing query [m8pgg1d58me18djopke]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1022]","timestamp":"2025-03-26T04:59:05.321Z"}
{"level":"debug","message":"Executing query [m8pgg1da6mobkzgnke3]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T04:59:05.326Z"}
{"level":"debug","message":"Executing query [m8pgg1dfk19bemp0449]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T04:59:05.331Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T04:59:05.334Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:05.302Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:05.073Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:05.372Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T04:59:05.506Z"}
{"level":"debug","message":"Executing query [m8pgg1ilrm2rty53v4e]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T04:59:05.517Z"}
{"level":"debug","message":"Executing query [m8pgg1io5k92x3oem9f]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T04:59:05.520Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8pgg1io5k92x3oem9f]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T04:59:05.523Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T04:59:05.526Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:05.482Z"}
{"level":"debug","message":"Executing query [m8pgg1k5xnpp1niu9ti]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T04:59:05.574Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T04:59:05.641Z"}
{"level":"debug","message":"Executing query [m8pgg1m52qhnfcnbmzb]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.646Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T04:59:05.653Z"}
{"level":"debug","message":"Executing query [m8pgg1mejizhv8boxnd]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T04:59:05.654Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:05.716Z"}
{"level":"debug","message":"Executing query [m8pgg1ou6s72mvdymss]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T04:59:05.742Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T04:59:05.766Z"}
{"level":"debug","message":"Executing query [m8pgg1plo1u1pa7c58k]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.769Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8pgg1plo1u1pa7c58k]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T04:59:05.771Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T04:59:05.772Z"}
{"level":"debug","message":"Executing query [m8pgg1mgb8y6hrntj3p]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T04:59:05.656Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T04:59:05.658Z"}
{"level":"debug","message":"Executing query [m8pgg1mjwxayfgy9g2]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.659Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T04:59:05.661Z"}
{"level":"debug","message":"Executing query [m8pgg1qd7xbue9yftod]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T04:59:05.798Z"}
{"level":"debug","message":"Executing query [m8pgg1qzfenuprxtr8h]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T04:59:05.819Z"}
{"level":"debug","message":"Executing query [m8pgg1r5c3x17264wnb]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T04:59:05.825Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T04:59:05.597Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:05.922Z"}
{"level":"debug","message":"Executing query [m8pgg1u2uydd914kf9l]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T04:59:05.931Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T04:59:05.993Z"}
{"level":"debug","message":"Executing query [m8pgg1vytnxq4ctv8bq]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:05.998Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8pgg1vytnxq4ctv8bq]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T04:59:06.014Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T04:59:05.840Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T04:59:06.038Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T04:59:06.106Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:06.418Z"}
{"level":"debug","message":"Executing query [m8pgg27q75g0wmohy1g]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T04:59:06.422Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T04:59:06.440Z"}
{"level":"debug","message":"Executing query [m8pgg28aangpspzme6c]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:06.442Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8pgg28aangpspzme6c]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T04:59:06.444Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T04:59:06.444Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T04:59:06.108Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T04:59:06.118Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T04:59:06.119Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T04:59:06.121Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T04:59:06.121Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:06.459Z"}
{"level":"debug","message":"Executing query [m8pgg2b5c3zc2cmm9h9]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T04:59:06.546Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T04:59:06.623Z"}
{"level":"debug","message":"Executing query [m8pgg2dj122ylppc5lpc]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:06.631Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8pgg2dj122ylppc5lpc]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T04:59:06.634Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T04:59:06.635Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:06.610Z"}
{"level":"debug","message":"Executing query [m8pgg2f1du9uql7e25p]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T04:59:06.685Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T04:59:06.759Z"}
{"level":"debug","message":"Executing query [m8pgg2h89q62uv95onl]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742965146684\"]","timestamp":"2025-03-26T04:59:06.764Z"}
{"level":"debug","message":"Executing query [m8pgg2hcr222sdspnpa]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742965146684\",true]","timestamp":"2025-03-26T04:59:06.768Z"}
{"level":"debug","message":"Executing query [m8pgg2hlxnos8q1sn7r]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-26T04:59:06.777Z"}
{"level":"debug","message":"Executing query [m8pgg2hrwgctrzhribq]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742965146684\"]","timestamp":"2025-03-26T04:59:06.783Z"}
{"level":"debug","message":"Executing query [m8pgg2hufnq1w30sxo]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",24]","timestamp":"2025-03-26T04:59:06.786Z"}
{"level":"debug","message":"Executing query [m8pgg2hzsdydvcxqwom]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-26T04:59:06.791Z"}
{"level":"debug","message":"Executing query [m8pgg2i3nfktvs9xnyl]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-26T04:59:06.795Z"}
{"level":"debug","message":"Executing query [m8pgg2i82mdbfw8a92j]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-26T04:59:06.800Z"}
{"level":"debug","message":"Executing query [m8pgg2ic9fjm45ilxk]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-26T04:59:06.804Z"}
{"level":"debug","message":"Executing query [m8pgg2ie34pxf7nll8j]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-26T04:59:06.806Z"}
{"level":"debug","message":"Executing query [m8pgg2ij2r2uok56djt]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-26T04:59:06.811Z"}
{"level":"debug","message":"Executing query [m8pgg2imdklqoo9vmsj]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T04:59:06.814Z"}
{"level":"debug","message":"Executing query [m8pgg2io3yoz9lilgyb]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T04:59:06.816Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T04:59:06.818Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:06.601Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:07.180Z"}
{"level":"debug","message":"Executing query [m8pgg2tw7311xednahj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T04:59:07.220Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T04:59:07.273Z"}
{"level":"debug","message":"Executing query [m8pgg2vjnp0av7qdn3s]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:07.279Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8pgg2vjnp0av7qdn3s]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T04:59:07.283Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T04:59:07.284Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:07.396Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:07.455Z"}
{"level":"debug","message":"Executing query [m8pgg30jnkqyygnssq]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:07.459Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T04:59:07.505Z"}
{"level":"debug","message":"Executing query [m8pgg31z0kvhbpupadnd]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T04:59:07.512Z"}
{"level":"debug","message":"Executing query [m8pgg322g7575tiqrfr]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T04:59:07.514Z"}
{"level":"debug","message":"Executing query [m8pgg3263kgzh6av823]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T04:59:07.518Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T04:59:07.522Z"}
{"level":"debug","message":"Executing query [m8pgg32a5togqwac96m]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T04:59:07.522Z"}
{"level":"debug","message":"Executing query [m8pgg32dd0cs3c0oe4n]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T04:59:07.525Z"}
{"level":"debug","message":"Executing query [m8pgg32h5zumzn5ppgb]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T04:59:07.529Z"}
{"level":"debug","message":"Executing query [m8pgg32j1nn0h3a6tp1]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T04:59:07.531Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T04:59:07.540Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T04:59:07.541Z"}
{"level":"debug","message":"Executing query [m8pgg32tfd3v5hausbm]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T04:59:07.541Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8pgg32tfd3v5hausbm]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T04:59:07.543Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T04:59:07.543Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T04:59:07.543Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T04:59:07.545Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T04:59:07.546Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T04:59:07.547Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T04:59:07.547Z"}
{"level":"debug","message":"Executing query [m8pgg330tugo4263tzg]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T04:59:07.548Z"}
{"level":"debug","message":"Executing query [m8pgg333obnyegs9rfc]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T04:59:07.551Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T04:59:07.553Z"}
{"level":"debug","message":"Executing query [m8pgg335k8f0c9oaxo]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T04:59:07.553Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T04:59:07.557Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:08.558Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T04:59:08.783Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T04:59:08.895Z"}
{"level":"debug","message":"Executing query [m8pgg45gme7cn1n86wd]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T04:59:08.932Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8pgg45gme7cn1n86wd]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T04:59:08.935Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T04:59:08.938Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T04:59:08.973Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:08.797Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T04:59:09.051Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T04:59:09.064Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T04:59:09.228Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T04:59:09.238Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T04:59:09.292Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:16.757Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T04:59:16.891Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T04:59:16.894Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T04:59:16.835Z"}
{"duration":"20ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T04:59:17.005Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T04:59:17.007Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T04:59:17.010Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T04:59:17.014Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T05:04:43.776Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T05:04:43.787Z","userId":1,"userRole":"USER"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T05:05:29.738Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T05:05:29.745Z","userId":1,"userRole":"USER"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T05:06:46.896Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T05:06:46.903Z","userId":1,"userRole":"USER"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:07:06.557Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:07:06.571Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:07:06.575Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:07:06.578Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:07:06.581Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:07:06.584Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:07:06.586Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:07:06.591Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:07:06.599Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:07:06.602Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:07:06.604Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T05:07:06.606Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T05:07:06.700Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T05:07:06.716Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:06.763Z"}
{"level":"debug","message":"Executing query [m8pgqcvz9u0d2cracwa]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:07:06.816Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:07:06.880Z"}
{"level":"debug","message":"Executing query [m8pgqcxxi4dvl4xggtf]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742965626811\"]","timestamp":"2025-03-26T05:07:06.885Z"}
{"level":"debug","message":"Executing query [m8pgqcyhqshm48yhpof]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742965626811\"]","timestamp":"2025-03-26T05:07:06.905Z"}
{"level":"debug","message":"Executing query [m8pgqcyjrag6gyut1nh]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742965626811\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T05:07:06.907Z"}
{"level":"debug","message":"Executing query [m8pgqcytt5uxcktl79b]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1023]","timestamp":"2025-03-26T05:07:06.917Z"}
{"level":"debug","message":"Executing query [m8pgqcyzv162ym5gbw]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742965626811\"]","timestamp":"2025-03-26T05:07:06.923Z"}
{"level":"debug","message":"Executing query [m8pgqcz4rf1jr2x2e]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1023]","timestamp":"2025-03-26T05:07:06.928Z"}
{"level":"debug","message":"Executing query [m8pgqczcdrbq4q5efkk]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1023]","timestamp":"2025-03-26T05:07:06.936Z"}
{"level":"debug","message":"Executing query [m8pgqczfgvpi9xrab8j]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1023]","timestamp":"2025-03-26T05:07:06.939Z"}
{"level":"debug","message":"Executing query [m8pgqczk0z42r0hvkg6]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1023]","timestamp":"2025-03-26T05:07:06.944Z"}
{"level":"debug","message":"Executing query [m8pgqcznoy5276v9sl]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1023]","timestamp":"2025-03-26T05:07:06.947Z"}
{"level":"debug","message":"Executing query [m8pgqczpfwycnpm2z8r]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1023]","timestamp":"2025-03-26T05:07:06.949Z"}
{"level":"debug","message":"Executing query [m8pgqczuhehehu3jusa]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1023]","timestamp":"2025-03-26T05:07:06.954Z"}
{"level":"debug","message":"Executing query [m8pgqczx04qlxogmuk6]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T05:07:06.958Z"}
{"level":"debug","message":"Executing query [m8pgqd02fl653g6r6h8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:07:06.962Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:07:06.964Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:07.085Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:06.876Z"}
{"level":"debug","message":"Executing query [m8pgqd4yc9qphmib8m]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:07.138Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T05:07:07.228Z"}
{"level":"debug","message":"Executing query [m8pgqd7ifgne6rdm91u]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:07.230Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T05:07:07.239Z"}
{"level":"debug","message":"Executing query [m8pgqd7sfojdv9knxxf]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:07.240Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:07:07.242Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T05:07:07.243Z"}
{"level":"debug","message":"Executing query [m8pgqd7wq5nz7cj6l6]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:07.244Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T05:07:07.247Z"}
{"level":"debug","message":"Executing query [m8pgqd81irfmrixqqz]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:07.249Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T05:07:07.253Z"}
{"level":"debug","message":"Executing query [m8pgqd851wm64y6szjwh]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:07.253Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8pgqd851wm64y6szjwh]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T05:07:07.257Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T05:07:07.257Z"}
{"level":"debug","message":"Executing query [m8pgqd8aoemzk5xxjw]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:07.258Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T05:07:07.259Z"}
{"level":"debug","message":"Executing query [m8pgqd8cxxogts9q23g]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:07.260Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T05:07:07.262Z"}
{"level":"debug","message":"Executing query [m8pgqd8f7add02qc5i8]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:07.263Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8pgqd8f7add02qc5i8]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T05:07:07.265Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T05:07:07.266Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T05:07:07.266Z"}
{"level":"debug","message":"Executing query [m8pgqd8kzli9v61n2z]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:07.268Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8pgqd8kzli9v61n2z]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T05:07:07.270Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T05:07:07.270Z"}
{"level":"debug","message":"Executing query [m8pgqd8n076aulsg9b2]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:07.271Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8pgqd8n076aulsg9b2]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T05:07:07.273Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T05:07:07.273Z"}
{"level":"debug","message":"Executing query [m8pgqd8p4omt9p29d4l]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:07.274Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8pgqd8p4omt9p29d4l]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T05:07:07.275Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T05:07:07.275Z"}
{"level":"debug","message":"Executing query [m8pgqd8sy05xylako4i]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:07.276Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8pgqd8sy05xylako4i]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T05:07:07.277Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T05:07:07.277Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T05:07:07.278Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T05:07:07.279Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T05:07:07.279Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T05:07:07.279Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T05:07:07.279Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T05:07:07.280Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T05:07:07.280Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T05:07:07.280Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T05:07:07.280Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T05:07:07.280Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T05:07:07.280Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T05:07:07.280Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T05:07:07.281Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T05:07:07.281Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T05:07:07.281Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T05:07:07.281Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T05:07:07.281Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T05:07:07.281Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:07:07.283Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:07.302Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:07:07.444Z"}
{"level":"debug","message":"Executing query [m8pgqddqmo80nvcb4be]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T05:07:07.454Z"}
{"level":"debug","message":"Executing query [m8pgqddtok52gwh1a7f]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T05:07:07.457Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8pgqddtok52gwh1a7f]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T05:07:07.462Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:07:07.464Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:07.475Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:07.525Z"}
{"level":"debug","message":"Executing query [m8pgqdfrim8pizc25s]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:07:07.527Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:07:07.592Z"}
{"level":"debug","message":"Executing query [m8pgqdhnu0hsr8bi718]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:07.596Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T05:07:07.600Z"}
{"level":"debug","message":"Executing query [m8pgqdhtvqh1bnde3k]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T05:07:07.601Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T05:07:07.522Z"}
{"level":"debug","message":"Executing query [m8pgqdhwaprwlchycbk]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T05:07:07.604Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T05:07:07.607Z"}
{"level":"debug","message":"Executing query [m8pgqdhzxvacjfso5v]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:07.607Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T05:07:07.611Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T05:07:07.610Z"}
{"level":"debug","message":"Executing query [m8pgqdkfrhp0d4gttn]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T05:07:07.695Z"}
{"level":"debug","message":"Executing query [m8pgqdkl53sev9rxz0s]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T05:07:07.701Z"}
{"level":"debug","message":"Executing query [m8pgqdkoky0r2b5z2x]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:07:07.704Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:07.848Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T05:07:07.938Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T05:07:07.939Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T05:07:07.939Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T05:07:07.940Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T05:07:07.940Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T05:07:07.940Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Executing query [m8pgqdq857c9z47ignp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:07:07.905Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:07:07.972Z"}
{"level":"debug","message":"Executing query [m8pgqdsc5872e61qfv3]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:07.981Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8pgqdsc5872e61qfv3]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T05:07:07.986Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:07:07.987Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:08.069Z"}
{"level":"debug","message":"Executing query [m8pgqdwd3klae4y5w3]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:07:08.125Z"}
{"level":"debug","message":"Executing query [m8pgqdyj10m89jlqocm]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:08.203Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8pgqdyj10m89jlqocm]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T05:07:08.209Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:07:08.210Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:08.268Z"}
{"code":"AUTH_SWITCH_PLUGIN_ERROR","fatal":true,"level":"error","message":"Error al conectar a la base de datos: authSwitch.authSwitchRequestMoreData is not a function","stack":"TypeError: authSwitch.authSwitchRequestMoreData is not a function\n    at ClientHandshake.handshakeResult (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\client_handshake.js:181:22)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:45:22)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T05:07:08.286Z"}
{"level":"debug","message":"Executing query [m8pgqe0g7khf4v8qbsk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:07:08.272Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:07:08.310Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:08.303Z"}
{"level":"debug","message":"Executing query [m8pgqe1m67puhr7jm9y]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742965628271\"]","timestamp":"2025-03-26T05:07:08.314Z"}
{"level":"debug","message":"Executing query [m8pgqe1rsjaaksykjv]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742965628271\",true]","timestamp":"2025-03-26T05:07:08.319Z"}
{"level":"debug","message":"Executing query [m8pgqe22gutmiulvrf]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-26T05:07:08.330Z"}
{"level":"debug","message":"Executing query [m8pgqe25mtpp5ai884]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742965628271\"]","timestamp":"2025-03-26T05:07:08.333Z"}
{"level":"debug","message":"Executing query [m8pgqe28fcvp3smnunw]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",25]","timestamp":"2025-03-26T05:07:08.336Z"}
{"level":"debug","message":"Executing query [m8pgqe1g40g0pxyxdn8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:07:08.308Z"}
{"level":"debug","message":"Executing query [m8pgqe2c1b3ytezti6t]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-26T05:07:08.340Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:07:08.340Z"}
{"level":"debug","message":"Executing query [m8pgqe2emlmtv67s8p9]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-26T05:07:08.342Z"}
{"level":"debug","message":"Executing query [m8pgqe2fx0skh10x9qr]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:08.343Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8pgqe2fx0skh10x9qr]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T05:07:08.347Z"}
{"level":"debug","message":"Executing query [m8pgqe2jnnhh8pl1fed]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-26T05:07:08.347Z"}
{"level":"debug","message":"Executing query [m8pgqe2n7bbrrcp967i]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-26T05:07:08.351Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:07:08.348Z"}
{"level":"debug","message":"Executing query [m8pgqe2qly8dwm9r9yg]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-26T05:07:08.354Z"}
{"level":"debug","message":"Executing query [m8pgqe2usv4vm2ii4qd]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-26T05:07:08.358Z"}
{"level":"debug","message":"Executing query [m8pgqe2yxtjnujcw6]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T05:07:08.362Z"}
{"level":"debug","message":"Executing query [m8pgqe2zrhx4e57q7bh]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:07:08.363Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:07:08.367Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:08.403Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:08.617Z"}
{"level":"debug","message":"Executing query [m8pgqea7vsdx4yoojz]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:07:08.623Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:07:08.774Z"}
{"level":"debug","message":"Executing query [m8pgqeehttw9jbsiyuf]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:08.777Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8pgqeehttw9jbsiyuf]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T05:07:08.780Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:07:08.780Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:08.836Z"}
{"level":"debug","message":"Executing query [m8pgqehbwa7fi31tnor]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:07:08.879Z"}
{"level":"debug","message":"Executing query [m8pgqejubf710tzxk6c]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:08.970Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:07:08.972Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:08.938Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:08.964Z"}
{"level":"debug","message":"Executing query [m8pgqejtip2hxj2nnu]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:08.969Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8pgqejubf710tzxk6c]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T05:07:08.974Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:07:08.976Z"}
{"level":"debug","message":"Executing query [m8pgqekm6fb4oxhbn8c]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:07:08.998Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:07:08.999Z"}
{"level":"debug","message":"Executing query [m8pgqekolqbc67h844n]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T05:07:09.000Z"}
{"level":"debug","message":"Executing query [m8pgqekqx1xef8komih]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T05:07:09.002Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T05:07:09.005Z"}
{"level":"debug","message":"Executing query [m8pgqektbwiuewg9zmb]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T05:07:09.005Z"}
{"level":"debug","message":"Executing query [m8pgqekxozcr80p16qe]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T05:07:09.009Z"}
{"level":"debug","message":"Executing query [m8pgqel15ckdty5273]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T05:07:09.013Z"}
{"level":"debug","message":"Executing query [m8pgqel3oa7tbay0yza]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T05:07:09.015Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T05:07:09.026Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T05:07:09.027Z"}
{"level":"debug","message":"Executing query [m8pgqelf9b1hp2bwrxv]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T05:07:09.027Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8pgqelf9b1hp2bwrxv]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T05:07:09.029Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T05:07:09.029Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T05:07:09.029Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:07:09.031Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:07:09.032Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:07:09.033Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:07:09.033Z"}
{"level":"debug","message":"Executing query [m8pgqelmqot7wsccm8]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T05:07:09.035Z"}
{"level":"debug","message":"Executing query [m8pgqelpzat8dw1pnrn]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T05:07:09.038Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T05:07:09.043Z"}
{"level":"debug","message":"Executing query [m8pgqelvyansoi2w4dr]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:07:09.043Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:07:09.046Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:09.190Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T05:07:09.528Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T05:07:09.553Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:07:09.776Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T05:07:09.790Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:07:09.867Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:10.080Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T05:07:10.268Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:07:10.393Z"}
{"level":"debug","message":"Executing query [m8pgqfoctqrqx0n3i1b]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T05:07:10.428Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8pgqfoctqrqx0n3i1b]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T05:07:10.431Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T05:07:10.435Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:07:10.468Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:10.965Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T05:07:11.113Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T05:07:11.119Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:07:11.127Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T05:07:11.130Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:07:11.238Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:07:11.389Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T05:07:11.391Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:30:19.467Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:30:19.477Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:30:19.481Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:30:19.485Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:30:19.488Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:30:19.491Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:30:19.493Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:30:19.500Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:30:19.504Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:30:19.506Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:30:19.507Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T05:30:19.647Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T05:30:19.509Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:19.765Z"}
{"level":"debug","message":"Executing query [m8phk7qqrkroqkweweh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:30:19.827Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:30:19.899Z"}
{"level":"debug","message":"Executing query [m8phk7sx7vtx6sx7gtm]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742967019823\"]","timestamp":"2025-03-26T05:30:19.905Z"}
{"level":"debug","message":"Executing query [m8phk7tf0nvqi3h6x7f]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742967019823\"]","timestamp":"2025-03-26T05:30:19.923Z"}
{"level":"debug","message":"Executing query [m8phk7thz5ae9gfbgjn]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742967019823\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T05:30:19.925Z"}
{"level":"debug","message":"Executing query [m8phk7tsd5by7hecd0p]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1024]","timestamp":"2025-03-26T05:30:19.936Z"}
{"level":"debug","message":"Executing query [m8phk7txfv9req6x6qt]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742967019823\"]","timestamp":"2025-03-26T05:30:19.942Z"}
{"level":"debug","message":"Executing query [m8phk7u2utjx9atx2e]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1024]","timestamp":"2025-03-26T05:30:19.946Z"}
{"level":"debug","message":"Executing query [m8phk7u85b45o4e1b4r]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1024]","timestamp":"2025-03-26T05:30:19.952Z"}
{"level":"debug","message":"Executing query [m8phk7ucumla4ao8tyf]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1024]","timestamp":"2025-03-26T05:30:19.956Z"}
{"level":"debug","message":"Executing query [m8phk7uhbca1j03eup6]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1024]","timestamp":"2025-03-26T05:30:19.961Z"}
{"level":"debug","message":"Executing query [m8phk7ukvbuookaks9n]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1024]","timestamp":"2025-03-26T05:30:19.964Z"}
{"level":"debug","message":"Executing query [m8phk7umk9tgtivr0v]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1024]","timestamp":"2025-03-26T05:30:19.966Z"}
{"level":"debug","message":"Executing query [m8phk7uqz12hvugn17l]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1024]","timestamp":"2025-03-26T05:30:19.970Z"}
{"level":"debug","message":"Executing query [m8phk7ut3xu00hcvarf]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T05:30:19.973Z"}
{"level":"debug","message":"Executing query [m8phk7uxctm4wju14ki]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:30:19.977Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:30:19.979Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:20.115Z"}
{"level":"debug","message":"Executing query [m8phk80jmocxgtoyspb]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.179Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:30:20.267Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T05:30:20.283Z"}
{"level":"debug","message":"Executing query [m8phk83g9x98t0kwqpq]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.284Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T05:30:20.286Z"}
{"level":"debug","message":"Executing query [m8phk83ieyfryliqsn]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.286Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T05:30:20.288Z"}
{"level":"debug","message":"Executing query [m8phk83kgcl30rxe0st]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.288Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T05:30:20.291Z"}
{"level":"debug","message":"Executing query [m8phk83nt3b7g4ihovr]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.291Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T05:30:20.293Z"}
{"level":"debug","message":"Executing query [m8phk83p3rvty8qc9aw]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.293Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8phk83p3rvty8qc9aw]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T05:30:20.295Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T05:30:20.295Z"}
{"level":"debug","message":"Executing query [m8phk83s5wu0pcbcex]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.296Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T05:30:20.297Z"}
{"level":"debug","message":"Executing query [m8phk83uni23fbwqcfe]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.298Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T05:30:20.299Z"}
{"level":"debug","message":"Executing query [m8phk83vvq6gn2qvopp]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.299Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8phk83vvq6gn2qvopp]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T05:30:20.301Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T05:30:20.301Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T05:30:20.301Z"}
{"level":"debug","message":"Executing query [m8phk83zos46f9oxnc]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.303Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8phk83zos46f9oxnc]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T05:30:20.305Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T05:30:20.307Z"}
{"level":"debug","message":"Executing query [m8phk843zwbi5n8vn]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.307Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8phk843zwbi5n8vn]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T05:30:20.308Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T05:30:20.309Z"}
{"level":"debug","message":"Executing query [m8phk8456jq8nbz0nzx]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.309Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8phk8456jq8nbz0nzx]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T05:30:20.310Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T05:30:20.310Z"}
{"level":"debug","message":"Executing query [m8phk84788iu7xldaa9]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.311Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8phk84788iu7xldaa9]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T05:30:20.312Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T05:30:20.312Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T05:30:20.312Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T05:30:20.313Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T05:30:20.314Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T05:30:20.314Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T05:30:20.314Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T05:30:20.314Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T05:30:20.315Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T05:30:20.315Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T05:30:20.316Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T05:30:20.316Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T05:30:20.317Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T05:30:20.317Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T05:30:20.317Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T05:30:20.317Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T05:30:20.317Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T05:30:20.317Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T05:30:20.318Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T05:30:20.318Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:30:20.320Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:20.247Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T05:30:19.657Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:19.998Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:20.250Z"}
{"level":"debug","message":"Executing query [m8phk84m48xna283iok]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:30:20.326Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:30:20.396Z"}
{"level":"debug","message":"Executing query [m8phk86q1egzvc714x7]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.402Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T05:30:20.406Z"}
{"level":"debug","message":"Executing query [m8phk86vuxofnld3qpr]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T05:30:20.407Z"}
{"level":"debug","message":"Executing query [m8phk86ylcve4x4a5n]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T05:30:20.411Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T05:30:20.414Z"}
{"level":"debug","message":"Executing query [m8phk872qz9apf9q74r]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.414Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T05:30:20.417Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:30:20.430Z"}
{"level":"debug","message":"Executing query [m8phk87pt22wo0l7jq8]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T05:30:20.437Z"}
{"level":"debug","message":"Executing query [m8phk87soz7igb3two8]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T05:30:20.440Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8phk87soz7igb3two8]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T05:30:20.443Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:30:20.447Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T05:30:20.219Z"}
{"level":"debug","message":"Executing query [m8phk89wjzu6qkmtyp]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T05:30:20.516Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:20.472Z"}
{"level":"debug","message":"Executing query [m8phk8arbkw79ioecrv]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T05:30:20.547Z"}
{"level":"debug","message":"Executing query [m8phk8axlb8r5rx3jnn]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:30:20.553Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T05:30:20.176Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:20.597Z"}
{"level":"debug","message":"Executing query [m8phk8cggxciobbhb4j]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:30:20.608Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:30:20.660Z"}
{"level":"debug","message":"Executing query [m8phk8ecpwnv5bn59m]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.676Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8phk8ecpwnv5bn59m]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T05:30:20.690Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:30:20.690Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:20.734Z"}
{"level":"debug","message":"Executing query [m8phk8g3ozaj8bnpugi]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:30:20.739Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:30:20.765Z"}
{"level":"debug","message":"Executing query [m8phk8gv1vvtngj9vr6]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:20.767Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8phk8gv1vvtngj9vr6]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T05:30:20.769Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:30:20.770Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T05:30:20.844Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:21.151Z"}
{"level":"debug","message":"Executing query [m8phk8ruf40si42ehrl]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:30:21.162Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:30:21.177Z"}
{"level":"debug","message":"Executing query [m8phk8scv7ey0xqf0m]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742967021161\"]","timestamp":"2025-03-26T05:30:21.180Z"}
{"level":"debug","message":"Executing query [m8phk8sexlglrtrdebk]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742967021161\",true]","timestamp":"2025-03-26T05:30:21.182Z"}
{"level":"debug","message":"Executing query [m8phk8t38hfzad9fbwy]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[26]","timestamp":"2025-03-26T05:30:21.207Z"}
{"level":"debug","message":"Executing query [m8phk8t7quejpdlxhth]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742967021161\"]","timestamp":"2025-03-26T05:30:21.211Z"}
{"level":"debug","message":"Executing query [m8phk8t9eupx767hwst]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",26]","timestamp":"2025-03-26T05:30:21.213Z"}
{"level":"debug","message":"Executing query [m8phk8ten1hwl9wujlr]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[26]","timestamp":"2025-03-26T05:30:21.218Z"}
{"level":"debug","message":"Executing query [m8phk8tibob73lzlh8]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[26]","timestamp":"2025-03-26T05:30:21.222Z"}
{"level":"debug","message":"Executing query [m8phk8tmf46rdjq741m]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[26]","timestamp":"2025-03-26T05:30:21.226Z"}
{"level":"debug","message":"Executing query [m8phk8tpggyytn68347]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[26]","timestamp":"2025-03-26T05:30:21.229Z"}
{"level":"debug","message":"Executing query [m8phk8tro3jan5unlh]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[26]","timestamp":"2025-03-26T05:30:21.231Z"}
{"level":"debug","message":"Executing query [m8phk8tv2y7pewyptrk]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[26]","timestamp":"2025-03-26T05:30:21.235Z"}
{"level":"debug","message":"Executing query [m8phk8tx2y63ivzxov]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T05:30:21.237Z"}
{"level":"debug","message":"Executing query [m8phk8tz8i4ab5yv69m]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:30:21.239Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:30:21.241Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:21.307Z"}
{"level":"debug","message":"Executing query [m8phk8vzadku3k77xo5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:30:21.311Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:30:21.358Z"}
{"level":"debug","message":"Executing query [m8phk8xcljibso6p16f]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:21.360Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8phk8xcljibso6p16f]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T05:30:21.362Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:30:21.362Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T05:30:20.845Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T05:30:20.846Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T05:30:20.847Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T05:30:20.849Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T05:30:20.849Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:21.484Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:21.542Z"}
{"level":"debug","message":"Executing query [m8phk92icplgj3029r6]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:30:21.546Z"}
{"level":"debug","message":"Executing query [m8phk93f4nqmg8mbrdj]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:21.579Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:30:21.581Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8phk93f4nqmg8mbrdj]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T05:30:21.587Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:30:21.588Z"}
{"level":"debug","message":"Executing query [m8phk929p5pclob22co]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:30:21.537Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:30:21.615Z"}
{"level":"debug","message":"Executing query [m8phk94jbxrcikh5ulm]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:21.619Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8phk94jbxrcikh5ulm]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T05:30:21.622Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:30:21.623Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:21.937Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:22.200Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:22.239Z"}
{"level":"debug","message":"Executing query [m8phk9lu57t43eyy83q]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:22.242Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:30:22.265Z"}
{"level":"debug","message":"Executing query [m8phk9mlr5vewtsdbl]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:30:22.269Z"}
{"level":"debug","message":"Executing query [m8phk9mm30yl25grcaf]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T05:30:22.270Z"}
{"level":"debug","message":"Executing query [m8phk9mnuig51jf6xnf]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T05:30:22.271Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T05:30:22.273Z"}
{"level":"debug","message":"Executing query [m8phk9mph27rr9r5ik]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T05:30:22.273Z"}
{"level":"debug","message":"Executing query [m8phk9mtzb686hx1ow]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T05:30:22.277Z"}
{"level":"debug","message":"Executing query [m8phk9mweyqyhhm3rsn]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T05:30:22.280Z"}
{"level":"debug","message":"Executing query [m8phk9myxkov2s218in]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T05:30:22.282Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T05:30:22.288Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T05:30:22.288Z"}
{"level":"debug","message":"Executing query [m8phk9n47aprk8n7jhu]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T05:30:22.288Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8phk9n47aprk8n7jhu]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T05:30:22.293Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T05:30:22.294Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T05:30:22.294Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:30:22.295Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:30:22.296Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:30:22.297Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:30:22.297Z"}
{"level":"debug","message":"Executing query [m8phk9nei769k3ysho]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T05:30:22.298Z"}
{"level":"debug","message":"Executing query [m8phk9ngdmmobya0e3u]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T05:30:22.300Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T05:30:22.301Z"}
{"level":"debug","message":"Executing query [m8phk9nh6pdg6m3l6pn]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:30:22.301Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:30:22.303Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:22.108Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T05:30:22.569Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T05:30:22.593Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:30:22.863Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T05:30:22.881Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:30:22.948Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:22.923Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T05:30:23.205Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:30:23.363Z"}
{"level":"debug","message":"Executing query [m8phkaii8ljxe30w74i]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T05:30:23.418Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8phkaii8ljxe30w74i]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T05:30:23.423Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T05:30:23.426Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:30:23.458Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:24.235Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:30:24.352Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T05:30:24.355Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:30:24.303Z"}
{"duration":"32ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T05:30:24.505Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:30:24.506Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T05:30:24.511Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:30:24.517Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:35:00.424Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:35:00.444Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:35:00.447Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:35:00.455Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:35:00.464Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:35:00.471Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:35:00.477Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:35:00.482Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:35:00.483Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:35:00.485Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:35:00.487Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T05:35:00.489Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T05:35:00.705Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:00.668Z"}
{"level":"debug","message":"Executing query [m8phq8hyi4h6deqwmmr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:35:00.743Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:35:00.872Z"}
{"level":"debug","message":"Executing query [m8phq8lonan4iciitbd]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742967300738\"]","timestamp":"2025-03-26T05:35:00.877Z"}
{"level":"debug","message":"Executing query [m8phq8m87cfjc9o0i7t]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742967300738\"]","timestamp":"2025-03-26T05:35:00.896Z"}
{"level":"debug","message":"Executing query [m8phq8mbub4hkz56w3f]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742967300738\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T05:35:00.899Z"}
{"level":"debug","message":"Executing query [m8phq8mmk8a3tzziohc]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1025]","timestamp":"2025-03-26T05:35:00.910Z"}
{"level":"debug","message":"Executing query [m8phq8mrkaroxxdngws]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742967300738\"]","timestamp":"2025-03-26T05:35:00.915Z"}
{"level":"debug","message":"Executing query [m8phq8mvog1xje7fvgb]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1025]","timestamp":"2025-03-26T05:35:00.920Z"}
{"level":"debug","message":"Executing query [m8phq8n1asryrvwyffh]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1025]","timestamp":"2025-03-26T05:35:00.926Z"}
{"level":"debug","message":"Executing query [m8phq8n6ifsar1z814m]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1025]","timestamp":"2025-03-26T05:35:00.930Z"}
{"level":"debug","message":"Executing query [m8phq8ncgmnwfg0i94]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1025]","timestamp":"2025-03-26T05:35:00.936Z"}
{"level":"debug","message":"Executing query [m8phq8nfndbnnh3nh2e]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1025]","timestamp":"2025-03-26T05:35:00.939Z"}
{"level":"debug","message":"Executing query [m8phq8nhdswy3e9ge3g]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1025]","timestamp":"2025-03-26T05:35:00.941Z"}
{"level":"debug","message":"Executing query [m8phq8nl4uopq2r7ivv]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1025]","timestamp":"2025-03-26T05:35:00.945Z"}
{"level":"debug","message":"Executing query [m8phq8nncp7zcs4x2s7]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T05:35:00.947Z"}
{"level":"debug","message":"Executing query [m8phq8nqxqw8d575u1]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:35:00.950Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:35:00.953Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:01.062Z"}
{"level":"debug","message":"Executing query [m8phq8scorgxch2aejj]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:01.117Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:35:01.186Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T05:35:01.211Z"}
{"level":"debug","message":"Executing query [m8phq8uz3zn1t36x16e]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:01.211Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T05:35:01.214Z"}
{"level":"debug","message":"Executing query [m8phq8v368vbsrvikeu]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:01.215Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T05:35:01.218Z"}
{"level":"debug","message":"Executing query [m8phq8v6j785bv0m5q]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:01.219Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T05:35:01.240Z"}
{"level":"debug","message":"Executing query [m8phq8vsr3z031pw4fa]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:01.241Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T05:35:01.250Z"}
{"level":"debug","message":"Executing query [m8phq8w28mcnqoom1dv]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:01.250Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8phq8w28mcnqoom1dv]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T05:35:01.286Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T05:35:01.287Z"}
{"level":"debug","message":"Executing query [m8phq8x4w5t20oxa06d]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:01.288Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T05:35:01.300Z"}
{"level":"debug","message":"Executing query [m8phq8xjtupoy7i2eji]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:01.303Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T05:35:01.321Z"}
{"level":"debug","message":"Executing query [m8phq8y16tbezjpirnx]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:01.321Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8phq8y16tbezjpirnx]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T05:35:01.325Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T05:35:01.325Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T05:35:01.325Z"}
{"level":"debug","message":"Executing query [m8phq8y75zixlnz9lf9]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:01.327Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8phq8y75zixlnz9lf9]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T05:35:01.329Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T05:35:01.330Z"}
{"level":"debug","message":"Executing query [m8phq8ya6krxqqwsg25]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:01.330Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8phq8ya6krxqqwsg25]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T05:35:01.336Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T05:35:01.337Z"}
{"level":"debug","message":"Executing query [m8phq8yhjzdpnb7ow27]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:01.337Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8phq8yhjzdpnb7ow27]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T05:35:01.339Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T05:35:01.339Z"}
{"level":"debug","message":"Executing query [m8phq8ykfaeqb3pv4bc]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:01.340Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8phq8ykfaeqb3pv4bc]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T05:35:01.343Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T05:35:01.343Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T05:35:01.343Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T05:35:01.344Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T05:35:01.344Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T05:35:01.345Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T05:35:01.345Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T05:35:01.346Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T05:35:01.346Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T05:35:01.346Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T05:35:01.347Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T05:35:01.347Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T05:35:01.347Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T05:35:01.347Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T05:35:01.347Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T05:35:01.347Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T05:35:01.347Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T05:35:01.348Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T05:35:01.348Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T05:35:01.348Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:35:01.350Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T05:35:01.293Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T05:35:01.285Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:01.381Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:01.122Z"}
{"level":"debug","message":"Executing query [m8phq91af2felov42u7]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:35:01.438Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:35:01.504Z"}
{"level":"debug","message":"Executing query [m8phq93r8amfw3o3gd6]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:01.527Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T05:35:01.532Z"}
{"level":"debug","message":"Executing query [m8phq93wmyq18flcv6d]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T05:35:01.532Z"}
{"level":"debug","message":"Executing query [m8phq93yst5pb6m2g]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T05:35:01.534Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T05:35:01.536Z"}
{"level":"debug","message":"Executing query [m8phq941l2y5z138z5]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:01.537Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T05:35:01.539Z"}
{"level":"debug","message":"Executing query [m8phq97n9qko2dm8rub]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T05:35:01.667Z"}
{"level":"debug","message":"Executing query [m8phq97tfapcq66i7nr]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T05:35:01.673Z"}
{"level":"debug","message":"Executing query [m8phq98brmpkdqmtbbi]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:35:01.691Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:01.499Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T05:35:00.718Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:01.461Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:01.761Z"}
{"level":"debug","message":"Executing query [m8phq9aepnt7r4bn4cp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:35:01.766Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:35:01.816Z"}
{"level":"debug","message":"Executing query [m8phq9c18lpsr4rlkmy]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:01.825Z"}
{"level":"debug","message":"Executing query [m8phq9c5lxcg9emr0ph]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T05:35:01.829Z"}
{"level":"debug","message":"Executing query [m8phq9c8okaet78sdgl]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T05:35:01.833Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8phq9c8okaet78sdgl]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T05:35:01.835Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:35:01.838Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8phq9c18lpsr4rlkmy]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T05:35:01.830Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:35:01.830Z"}
{"code":"AUTH_SWITCH_PLUGIN_ERROR","fatal":true,"level":"error","message":"Error al conectar a la base de datos: authSwitch.authSwitchRequestMoreData is not a function","stack":"TypeError: authSwitch.authSwitchRequestMoreData is not a function\n    at ClientHandshake.handshakeResult (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\client_handshake.js:181:22)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:45:22)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T05:35:02.007Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:02.002Z"}
{"level":"debug","message":"Executing query [m8phq9h60rqme6dlez3e]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:35:02.010Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:35:02.095Z"}
{"level":"debug","message":"Executing query [m8phq9johyhieuc2fpr]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:02.100Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8phq9johyhieuc2fpr]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T05:35:02.106Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:35:02.107Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T05:35:02.163Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T05:35:02.165Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T05:35:02.166Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T05:35:02.166Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T05:35:02.167Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T05:35:02.167Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:02.493Z"}
{"level":"debug","message":"Executing query [m8phq9upf5agdnioab]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:35:02.497Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:35:02.531Z"}
{"level":"debug","message":"Executing query [m8phq9vpztnwixs4zjp]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742967302496\"]","timestamp":"2025-03-26T05:35:02.533Z"}
{"level":"debug","message":"Executing query [m8phq9vsbke2t0zqx6v]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742967302496\",true]","timestamp":"2025-03-26T05:35:02.536Z"}
{"level":"debug","message":"Executing query [m8phq9vz4psii0hr56d]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[27]","timestamp":"2025-03-26T05:35:02.543Z"}
{"level":"debug","message":"Executing query [m8phq9w6x2pger8a1k]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742967302496\"]","timestamp":"2025-03-26T05:35:02.550Z"}
{"level":"debug","message":"Executing query [m8phq9wfkbkp8fw48ed]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",27]","timestamp":"2025-03-26T05:35:02.559Z"}
{"level":"debug","message":"Executing query [m8phq9wmuf95aihu2j]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[27]","timestamp":"2025-03-26T05:35:02.566Z"}
{"level":"debug","message":"Executing query [m8phq9wqu9r89392ej]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[27]","timestamp":"2025-03-26T05:35:02.570Z"}
{"level":"debug","message":"Executing query [m8phq9wv6i715m7ipu]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[27]","timestamp":"2025-03-26T05:35:02.575Z"}
{"level":"debug","message":"Executing query [m8phq9wz1zxrch7fouo]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[27]","timestamp":"2025-03-26T05:35:02.579Z"}
{"level":"debug","message":"Executing query [m8phq9x8ec6f609zmn7]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[27]","timestamp":"2025-03-26T05:35:02.588Z"}
{"level":"debug","message":"Executing query [m8phq9xcyey3btw03wi]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[27]","timestamp":"2025-03-26T05:35:02.593Z"}
{"level":"debug","message":"Executing query [m8phq9xfqaqhpc3bu4]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T05:35:02.595Z"}
{"level":"debug","message":"Executing query [m8phq9xhc0zvqscqa4]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:35:02.597Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:35:02.600Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:02.544Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:02.717Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:02.549Z"}
{"level":"debug","message":"Executing query [m8phq9ys8dwvkx90msh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:35:02.645Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:35:02.736Z"}
{"level":"debug","message":"Executing query [m8phqa1h9j3lqjwo4bv]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:02.741Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8phqa1h9j3lqjwo4bv]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T05:35:02.744Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:35:02.745Z"}
{"level":"debug","message":"Executing query [m8phqa0x7aoct739jtb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:35:02.721Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:35:02.794Z"}
{"level":"debug","message":"Executing query [m8phqa304w7snr7u6lb]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:02.796Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8phqa304w7snr7u6lb]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T05:35:02.799Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:35:02.799Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:02.894Z"}
{"level":"debug","message":"Executing query [m8phqa89qam22t6bcse]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:35:02.985Z"}
{"level":"debug","message":"Executing query [m8phqaafrenllmu591o]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:03.063Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:35:03.065Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8phqaafrenllmu591o]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T05:35:03.066Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:35:03.067Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:03.393Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:03.460Z"}
{"level":"debug","message":"Executing query [m8phqalkbf1qlk1gv0o]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:03.464Z"}
{"level":"debug","message":"Executing query [m8phqan8kcmhw78jb8a]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:35:03.525Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:35:03.540Z"}
{"level":"debug","message":"Executing query [m8phqansmyhakeu6bz]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T05:35:03.544Z"}
{"level":"debug","message":"Executing query [m8phqanz86ztlyvrgz4]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T05:35:03.551Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T05:35:03.554Z"}
{"level":"debug","message":"Executing query [m8phqao65b1esm4jrs6]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T05:35:03.558Z"}
{"level":"debug","message":"Executing query [m8phqaoig2meh2pqjk]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T05:35:03.570Z"}
{"level":"debug","message":"Executing query [m8phqap50qhidpa2ojz]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T05:35:03.593Z"}
{"level":"debug","message":"Executing query [m8phqap7yu3snu5s3jq]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T05:35:03.595Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T05:35:03.601Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T05:35:03.601Z"}
{"level":"debug","message":"Executing query [m8phqape56c9y3s8u6w]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T05:35:03.602Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8phqape56c9y3s8u6w]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T05:35:03.603Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T05:35:03.604Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T05:35:03.604Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:35:03.606Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:35:03.607Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:35:03.607Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:35:03.608Z"}
{"level":"debug","message":"Executing query [m8phqaplinrj07uqzck]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T05:35:03.609Z"}
{"level":"debug","message":"Executing query [m8phqapnbk7ss9ca9t4]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T05:35:03.611Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T05:35:03.612Z"}
{"level":"debug","message":"Executing query [m8phqapov83tqt7csy]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:35:03.613Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:35:03.614Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:03.362Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T05:35:03.820Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T05:35:03.838Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:35:04.133Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T05:35:04.174Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:35:04.263Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:04.565Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T05:35:04.864Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:35:05.075Z"}
{"level":"debug","message":"Executing query [m8phqbvlcfdtdcxsqfh]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T05:35:05.122Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8phqbvlcfdtdcxsqfh]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T05:35:05.127Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T05:35:05.132Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:35:05.162Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:05.951Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:35:06.080Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T05:35:06.082Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:35:05.963Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:35:06.166Z"}
{"duration":"27ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T05:35:06.170Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T05:35:06.179Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:35:06.184Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:40:40.137Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:40:40.155Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:40:40.161Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:40:40.171Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:40:40.174Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:40:40.179Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:40:40.184Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:40:40.195Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:40:40.196Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:40:40.198Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:40:40.200Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T05:40:40.201Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:40.377Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T05:40:40.423Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T05:40:40.436Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:40.429Z"}
{"level":"debug","message":"Executing query [m8phxilsz39u22qsii]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:40:40.433Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:40:40.474Z"}
{"level":"debug","message":"Executing query [m8phxin3rc07cxpc4r]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742967640426\"]","timestamp":"2025-03-26T05:40:40.480Z"}
{"level":"debug","message":"Executing query [m8phxinml6yiknuz2a]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742967640426\"]","timestamp":"2025-03-26T05:40:40.498Z"}
{"level":"debug","message":"Executing query [m8phxinp8ma4fgfyg8]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742967640426\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T05:40:40.501Z"}
{"level":"debug","message":"Executing query [m8phxio053pl8wxar0j]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1026]","timestamp":"2025-03-26T05:40:40.512Z"}
{"level":"debug","message":"Executing query [m8phxio7ixy75ex4cks]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742967640426\"]","timestamp":"2025-03-26T05:40:40.519Z"}
{"level":"debug","message":"Executing query [m8phxioe05bmb3uarv0s]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1026]","timestamp":"2025-03-26T05:40:40.526Z"}
{"level":"debug","message":"Executing query [m8phximnop6c2mip1v]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:40.464Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:40:40.528Z"}
{"level":"debug","message":"Executing query [m8phxiokdxg8d3chh45]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1026]","timestamp":"2025-03-26T05:40:40.532Z"}
{"level":"debug","message":"Executing query [m8phxionbmsge94cb8]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1026]","timestamp":"2025-03-26T05:40:40.535Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T05:40:40.535Z"}
{"level":"debug","message":"Executing query [m8phxioonu3jcxam239]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:40.536Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T05:40:40.538Z"}
{"level":"debug","message":"Executing query [m8phxioqcqd2h34k97r]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:40.538Z"}
{"level":"debug","message":"Executing query [m8phxior8recu8ga4q2]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1026]","timestamp":"2025-03-26T05:40:40.539Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T05:40:40.540Z"}
{"level":"debug","message":"Executing query [m8phxiosgly8cg3x4bd]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:40.541Z"}
{"level":"debug","message":"Executing query [m8phxiouo6lixlh6y4s]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1026]","timestamp":"2025-03-26T05:40:40.542Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T05:40:40.543Z"}
{"level":"debug","message":"Executing query [m8phxiowkh6ukpg2pu9]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1026]","timestamp":"2025-03-26T05:40:40.544Z"}
{"level":"debug","message":"Executing query [m8phxioww7nj983o3vo]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:40.544Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T05:40:40.546Z"}
{"level":"debug","message":"Executing query [m8phxioyqkb6wjuolgm]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:40.546Z"}
{"level":"debug","message":"Executing query [m8phxip0ixs6q8t2z9a]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1026]","timestamp":"2025-03-26T05:40:40.548Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8phxioyqkb6wjuolgm]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T05:40:40.549Z"}
{"level":"debug","message":"Executing query [m8phxip2b2x36ji6hk5]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T05:40:40.550Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T05:40:40.549Z"}
{"level":"debug","message":"Executing query [m8phxip1gqwpq46c7ap]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:40.549Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T05:40:40.551Z"}
{"level":"debug","message":"Executing query [m8phxip3j7g8ysw9hb]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:40.551Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T05:40:40.553Z"}
{"level":"debug","message":"Executing query [m8phxip5kybzpohr8j]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:40.553Z"}
{"level":"debug","message":"Executing query [m8phxip5t2rr3ljjwuf]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:40:40.553Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8phxip5kybzpohr8j]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T05:40:40.555Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T05:40:40.556Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T05:40:40.556Z"}
{"level":"debug","message":"Executing query [m8phxipa89baf7cng4p]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:40.558Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8phxipa89baf7cng4p]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T05:40:40.560Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:40:40.556Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T05:40:40.560Z"}
{"level":"debug","message":"Executing query [m8phxipcw0m2o086yd]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:40.560Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8phxipcw0m2o086yd]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T05:40:40.562Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T05:40:40.562Z"}
{"level":"debug","message":"Executing query [m8phxipfhln452nr3na]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:40.563Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8phxipfhln452nr3na]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T05:40:40.564Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T05:40:40.565Z"}
{"level":"debug","message":"Executing query [m8phxiph81au7kwqumc]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:40.565Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8phxiph81au7kwqumc]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T05:40:40.566Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T05:40:40.566Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T05:40:40.567Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T05:40:40.568Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T05:40:40.569Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T05:40:40.569Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T05:40:40.569Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T05:40:40.569Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T05:40:40.570Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T05:40:40.570Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T05:40:40.570Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T05:40:40.570Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T05:40:40.570Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T05:40:40.570Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T05:40:40.571Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T05:40:40.571Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T05:40:40.571Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T05:40:40.571Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T05:40:40.571Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T05:40:40.571Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:40:40.574Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:40.859Z"}
{"level":"debug","message":"Executing query [m8phxixuqdsddl37o3q]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:40:40.866Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:40:40.899Z"}
{"level":"debug","message":"Executing query [m8phxiyvh9mfq3mbop4]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:40.903Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T05:40:40.906Z"}
{"level":"debug","message":"Executing query [m8phxiyzbp9zph7f0hf]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T05:40:40.907Z"}
{"level":"debug","message":"Executing query [m8phxiz170w1obhuru3]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T05:40:40.909Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T05:40:40.912Z"}
{"level":"debug","message":"Executing query [m8phxiz4gm1qeer2v1]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:40.912Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T05:40:40.915Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:40.880Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:40.644Z"}
{"level":"debug","message":"Executing query [m8phxj1iaa1ninla2qv]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T05:40:40.998Z"}
{"level":"debug","message":"Executing query [m8phxj1sgqjgt2c9htw]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T05:40:41.008Z"}
{"level":"debug","message":"Executing query [m8phxj1wrsr30w22hl8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:40:41.012Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T05:40:40.974Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:41.240Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:40:41.351Z"}
{"level":"debug","message":"Executing query [m8phxjbio5qr5zhf55o]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T05:40:41.358Z"}
{"level":"debug","message":"Executing query [m8phxjblk9zihvhvc4p]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T05:40:41.361Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8phxjblk9zihvhvc4p]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T05:40:41.363Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:41.344Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:40:41.367Z"}
{"level":"debug","message":"Executing query [m8phxjb97y8h22dc6fm]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:40:41.350Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:40:41.400Z"}
{"level":"debug","message":"Executing query [m8phxjcrtitmiiqoisj]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:41.403Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8phxjcrtitmiiqoisj]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T05:40:41.407Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:40:41.407Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T05:40:41.430Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:41.461Z"}
{"level":"debug","message":"Executing query [m8phxjfs2vrw6lashsa]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:40:41.512Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:40:41.580Z"}
{"level":"debug","message":"Executing query [m8phxjhtmevkga9adt]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:41.585Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8phxjhtmevkga9adt]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T05:40:41.587Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:40:41.588Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T05:40:41.589Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T05:40:41.591Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T05:40:41.591Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T05:40:41.591Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T05:40:41.592Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T05:40:41.592Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:42.004Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:42.008Z"}
{"level":"debug","message":"Executing query [m8phxjtnxkd5oar11ij]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:40:42.011Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:40:42.030Z"}
{"level":"debug","message":"Executing query [m8phxju8hf3xneoteao]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:42.032Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8phxju8hf3xneoteao]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T05:40:42.033Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:40:42.034Z"}
{"level":"debug","message":"Executing query [m8phxjtow9soh7hh2yb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:40:42.012Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:40:42.071Z"}
{"level":"debug","message":"Executing query [m8phxjvfa5q6uxaxry4]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:42.075Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8phxjvfa5q6uxaxry4]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T05:40:42.078Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:40:42.080Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:42.178Z"}
{"level":"debug","message":"Executing query [m8phxjzdhtsfld79k8j]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:40:42.218Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:40:42.275Z"}
{"level":"debug","message":"Executing query [m8phxk15rte9o76cwv]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742967642216\"]","timestamp":"2025-03-26T05:40:42.282Z"}
{"level":"debug","message":"Executing query [m8phxk18fw0loxf5n4f]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742967642216\",true]","timestamp":"2025-03-26T05:40:42.284Z"}
{"level":"debug","message":"Executing query [m8phxk1fa95x0l6w6q8]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-26T05:40:42.291Z"}
{"level":"debug","message":"Executing query [m8phxk1lab6q9gszlzk]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742967642216\"]","timestamp":"2025-03-26T05:40:42.297Z"}
{"level":"debug","message":"Executing query [m8phxk1nwx2t8vfafzs]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",28]","timestamp":"2025-03-26T05:40:42.299Z"}
{"level":"debug","message":"Executing query [m8phxk1si35on6mz9ck]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-26T05:40:42.304Z"}
{"level":"debug","message":"Executing query [m8phxk1vxkp5hqbifdj]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-26T05:40:42.307Z"}
{"level":"debug","message":"Executing query [m8phxk1z0zi1rxa25q1q]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-26T05:40:42.311Z"}
{"level":"debug","message":"Executing query [m8phxk218x77obcivek]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-26T05:40:42.313Z"}
{"level":"debug","message":"Executing query [m8phxk24d72ipap9iav]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-26T05:40:42.316Z"}
{"level":"debug","message":"Executing query [m8phxk286oni1203uzl]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-26T05:40:42.320Z"}
{"level":"debug","message":"Executing query [m8phxk2a0653gttx47km]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T05:40:42.322Z"}
{"level":"debug","message":"Executing query [m8phxk2c900gpe5fi8d]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:40:42.324Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:40:42.327Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:42.433Z"}
{"level":"debug","message":"Executing query [m8phxk6rvg9kqxcfyge]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:40:42.483Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:40:42.540Z"}
{"level":"debug","message":"Executing query [m8phxk8h3zsa3kae7ro]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:42.545Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8phxk8h3zsa3kae7ro]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T05:40:42.549Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:40:42.550Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:42.562Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:42.130Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T05:40:42.577Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T05:40:42.609Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:40:43.052Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T05:40:43.070Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:40:43.165Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:43.212Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:43.276Z"}
{"level":"debug","message":"Executing query [m8phxksuahizdqnb0t9]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:43.279Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:40:43.362Z"}
{"level":"debug","message":"Executing query [m8phxkvdi3lttqm7ccg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:40:43.369Z"}
{"level":"debug","message":"Executing query [m8phxkvfdwhdwh6kbcb]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T05:40:43.371Z"}
{"level":"debug","message":"Executing query [m8phxkvj31zeyk652dk]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T05:40:43.375Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T05:40:43.377Z"}
{"level":"debug","message":"Executing query [m8phxkvluxsz0i5byxb]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T05:40:43.377Z"}
{"level":"debug","message":"Executing query [m8phxkvox5k6hktxrn]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T05:40:43.380Z"}
{"level":"debug","message":"Executing query [m8phxkvsuntooe2y8db]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T05:40:43.384Z"}
{"level":"debug","message":"Executing query [m8phxkvusbgz6nk0ogm]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T05:40:43.386Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T05:40:43.391Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T05:40:43.392Z"}
{"level":"debug","message":"Executing query [m8phxkw07u4fte31pug]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T05:40:43.392Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8phxkw07u4fte31pug]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T05:40:43.394Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T05:40:43.395Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T05:40:43.395Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:40:43.397Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:40:43.398Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:40:43.399Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:40:43.399Z"}
{"level":"debug","message":"Executing query [m8phxkw82bqfzeforl1]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T05:40:43.400Z"}
{"level":"debug","message":"Executing query [m8phxkwa1a5bowk1tzo]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T05:40:43.402Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T05:40:43.403Z"}
{"level":"debug","message":"Executing query [m8phxkwclqkm7lk5klr]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:40:43.404Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:40:43.406Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:43.830Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T05:40:44.052Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:40:44.193Z"}
{"level":"debug","message":"Executing query [m8phxljh2p25qxdr2kg]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T05:40:44.237Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8phxljh2p25qxdr2kg]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T05:40:44.239Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T05:40:44.242Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:40:44.270Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:44.740Z"}
{"duration":"15ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T05:40:44.922Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:40:44.924Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T05:40:44.930Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:40:44.938Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:40:45.133Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:40:45.310Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T05:40:45.312Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:41:05.701Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:41:05.720Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:41:05.726Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:41:05.729Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:41:05.733Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:41:05.751Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T05:41:05.753Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:41:05.757Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:41:05.760Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:41:05.761Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T05:41:05.768Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T05:41:05.769Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:06.110Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:06.109Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T05:41:06.143Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T05:41:06.166Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Executing query [m8phy2gm50pfujaxcrt]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:41:06.166Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:41:06.225Z"}
{"level":"debug","message":"Executing query [m8phy2ibch7mu2thnq]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742967666162\"]","timestamp":"2025-03-26T05:41:06.228Z"}
{"level":"debug","message":"Executing query [m8phy2gyxg03k8i39j]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:06.178Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:41:06.237Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T05:41:06.250Z"}
{"level":"debug","message":"Executing query [m8phy2izrwlaxkwt8n]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:06.252Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T05:41:06.257Z"}
{"level":"debug","message":"Executing query [m8phy2j51jeo7t1p3zw]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:06.257Z"}
{"level":"debug","message":"Executing query [m8phy2j9lgv8wfkjkyo]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742967666162\"]","timestamp":"2025-03-26T05:41:06.261Z"}
{"level":"debug","message":"Executing query [m8phy2jcqdsznjfhwj]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742967666162\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T05:41:06.265Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T05:41:06.260Z"}
{"level":"debug","message":"Executing query [m8phy2j9hm2o6lcxltn]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:06.261Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T05:41:06.264Z"}
{"level":"debug","message":"Executing query [m8phy2jcp15jzwmh7l]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:06.265Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T05:41:06.266Z"}
{"level":"debug","message":"Executing query [m8phy2jfu2uinepz35]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:06.267Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8phy2jfu2uinepz35]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T05:41:06.270Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T05:41:06.270Z"}
{"level":"debug","message":"Executing query [m8phy2ji1xgr80n0f5h]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:06.270Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T05:41:06.272Z"}
{"level":"debug","message":"Executing query [m8phy2jk9ydi65mib8h]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:06.272Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T05:41:06.274Z"}
{"level":"debug","message":"Executing query [m8phy2joedrlvzwnr3g]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1027]","timestamp":"2025-03-26T05:41:06.276Z"}
{"level":"debug","message":"Executing query [m8phy2jmmdjdn6ugv5f]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:06.274Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8phy2jmmdjdn6ugv5f]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T05:41:06.276Z"}
{"level":"debug","message":"Executing query [m8phy2js0akh0ubuzj2g]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742967666162\"]","timestamp":"2025-03-26T05:41:06.280Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T05:41:06.277Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T05:41:06.278Z"}
{"level":"debug","message":"Executing query [m8phy2jrvradf4y323g]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:06.279Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8phy2jrvradf4y323g]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T05:41:06.281Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T05:41:06.282Z"}
{"level":"debug","message":"Executing query [m8phy2jukfo2xo81zf]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:06.283Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8phy2jukfo2xo81zf]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T05:41:06.285Z"}
{"level":"debug","message":"Executing query [m8phy2jx70639plu0xu]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1027]","timestamp":"2025-03-26T05:41:06.285Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T05:41:06.285Z"}
{"level":"debug","message":"Executing query [m8phy2jxpmu2hmskq8s]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:06.285Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8phy2jxpmu2hmskq8s]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T05:41:06.287Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T05:41:06.287Z"}
{"level":"debug","message":"Executing query [m8phy2jz96vlbzm28f]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:06.287Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8phy2jz96vlbzm28f]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T05:41:06.289Z"}
{"level":"debug","message":"Executing query [m8phy2k3534j3k9jq4e]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1027]","timestamp":"2025-03-26T05:41:06.292Z"}
{"level":"debug","message":"Executing query [m8phy2k8q9n0lrqtlor]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1027]","timestamp":"2025-03-26T05:41:06.296Z"}
{"level":"debug","message":"Executing query [m8phy2ke251x57yphzy]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1027]","timestamp":"2025-03-26T05:41:06.302Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T05:41:06.289Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T05:41:06.290Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T05:41:06.292Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T05:41:06.292Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T05:41:06.292Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T05:41:06.292Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T05:41:06.293Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T05:41:06.293Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T05:41:06.293Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T05:41:06.293Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T05:41:06.294Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T05:41:06.294Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T05:41:06.294Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T05:41:06.294Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T05:41:06.294Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T05:41:06.294Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T05:41:06.295Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T05:41:06.295Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T05:41:06.295Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:41:06.297Z"}
{"level":"debug","message":"Executing query [m8phy2kiuo4xu3nywtk]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1027]","timestamp":"2025-03-26T05:41:06.306Z"}
{"level":"debug","message":"Executing query [m8phy2klzotqaqpr0g]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1027]","timestamp":"2025-03-26T05:41:06.309Z"}
{"level":"debug","message":"Executing query [m8phy2kq3jo2v6sxmbu]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1027]","timestamp":"2025-03-26T05:41:06.314Z"}
{"level":"debug","message":"Executing query [m8phy2ksdyqt6k8dxnl]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T05:41:06.316Z"}
{"level":"debug","message":"Executing query [m8phy2kw9uk4461yl9m]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:41:06.320Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:41:06.322Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:06.420Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:06.752Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T05:41:07.029Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T05:41:07.067Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:07.189Z"}
{"level":"debug","message":"Executing query [m8phy39cs6rsq4rt41o]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:41:07.201Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:41:07.275Z"}
{"level":"debug","message":"Executing query [m8phy3bjs3418bhumx]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:07.279Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8phy3bjs3418bhumx]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T05:41:07.283Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:41:07.284Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:07.385Z"}
{"level":"debug","message":"Executing query [m8phy3fsttp92unzem]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:41:07.433Z"}
{"level":"debug","message":"Executing query [m8phy3hv7fx0lhypdyg]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:07.508Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:41:07.510Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T05:41:07.513Z"}
{"level":"debug","message":"Executing query [m8phy3i1q6s6d2lwlhe]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T05:41:07.513Z"}
{"level":"debug","message":"Executing query [m8phy3i3fcg43tyzf85]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T05:41:07.515Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T05:41:07.517Z"}
{"level":"debug","message":"Executing query [m8phy3i6krr89qfgdas]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:07.518Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T05:41:07.520Z"}
{"level":"debug","message":"Executing query [m8phy3k6mov23trveba]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T05:41:07.590Z"}
{"level":"debug","message":"Executing query [m8phy3kabczaalsuzfg]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T05:41:07.594Z"}
{"level":"debug","message":"Executing query [m8phy3kdnq38ptofncp]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:41:07.597Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T05:41:07.612Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T05:41:07.619Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T05:41:07.621Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T05:41:07.623Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T05:41:07.624Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T05:41:07.624Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:07.577Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:41:07.698Z"}
{"level":"debug","message":"Executing query [m8phy3ni2mokp40ysxt]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T05:41:07.711Z"}
{"level":"debug","message":"Executing query [m8phy3p2op695eosw5c]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T05:41:07.766Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8phy3p2op695eosw5c]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T05:41:07.769Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:41:07.773Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:07.711Z"}
{"level":"debug","message":"Executing query [m8phy3r532mqqy0au0n]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:41:07.841Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:41:07.921Z"}
{"level":"debug","message":"Executing query [m8phy3tinsbje8cn9e]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:07.926Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8phy3tinsbje8cn9e]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T05:41:07.929Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:41:07.929Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:08.004Z"}
{"level":"debug","message":"Executing query [m8phy3vrexzvh72rvnt]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:41:08.008Z"}
{"level":"debug","message":"Executing query [m8phy3whgfubedufp17]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742967668006\"]","timestamp":"2025-03-26T05:41:08.033Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:41:08.035Z"}
{"level":"debug","message":"Executing query [m8phy3wjgp30avp61se]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742967668006\",true]","timestamp":"2025-03-26T05:41:08.035Z"}
{"level":"debug","message":"Executing query [m8phy3wqv1dxag10i1j]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-26T05:41:08.042Z"}
{"level":"debug","message":"Executing query [m8phy3wuujz2jxg1x5s]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742967668006\"]","timestamp":"2025-03-26T05:41:08.046Z"}
{"level":"debug","message":"Executing query [m8phy3wxc7k3zafsf7j]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",29]","timestamp":"2025-03-26T05:41:08.049Z"}
{"level":"debug","message":"Executing query [m8phy3x1j9iexixj0b]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-26T05:41:08.053Z"}
{"level":"debug","message":"Executing query [m8phy3x38jk2jjizzme]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-26T05:41:08.055Z"}
{"level":"debug","message":"Executing query [m8phy3x7hpkd3sq7exu]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-26T05:41:08.059Z"}
{"level":"debug","message":"Executing query [m8phy3x9oss7716avi]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-26T05:41:08.061Z"}
{"level":"debug","message":"Executing query [m8phy3xbvm2v75lvzm]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-26T05:41:08.063Z"}
{"level":"debug","message":"Executing query [m8phy3xfr9w9s2761u]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-26T05:41:08.067Z"}
{"level":"debug","message":"Executing query [m8phy3xger4707h7dlh]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T05:41:08.068Z"}
{"level":"debug","message":"Executing query [m8phy3xihbuzvnvyzvi]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:41:08.071Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:41:08.072Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:08.063Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:08.162Z"}
{"level":"debug","message":"Executing query [m8phy40b3ah91fpp3hz]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:41:08.171Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:41:08.195Z"}
{"level":"debug","message":"Executing query [m8phy412kn4wqxe81ho]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:08.198Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8phy412kn4wqxe81ho]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T05:41:08.201Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:41:08.201Z"}
{"level":"debug","message":"Executing query [m8phy3yy67962xy3e18]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:41:08.122Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:41:08.242Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:08.106Z"}
{"level":"debug","message":"Executing query [m8phy4314v6os6bthu5]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:08.270Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8phy4314v6os6bthu5]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T05:41:08.283Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:41:08.284Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:07.634Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T05:41:08.185Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T05:41:08.217Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:41:08.559Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:08.508Z"}
{"level":"debug","message":"Executing query [m8phy4b2m4v7a48649]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:41:08.559Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T05:41:08.577Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:08.637Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:41:08.667Z"}
{"level":"debug","message":"Executing query [m8phy4e6okgp5tmvwub]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:08.670Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:08.642Z"}
{"level":"debug","message":"Executing query [m8phy4dgj8ot330got]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:08.645Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:41:08.693Z"}
{"level":"debug","message":"Executing query [m8phy4exscg6q11j2p7]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T05:41:08.697Z"}
{"level":"debug","message":"Executing query [m8phy4ez94stth4cqed]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T05:41:08.699Z"}
{"level":"debug","message":"Executing query [m8phy4f18z09w4849u]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T05:41:08.701Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T05:41:08.703Z"}
{"level":"debug","message":"Executing query [m8phy4f3qnfz75580sc]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T05:41:08.703Z"}
{"level":"debug","message":"Executing query [m8phy4f674v9lywpq3i]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T05:41:08.706Z"}
{"level":"debug","message":"Executing query [m8phy4f9lloqzhb6fed]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T05:41:08.709Z"}
{"level":"debug","message":"Executing query [m8phy4fa6t9nfpx2iz8]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T05:41:08.710Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T05:41:08.717Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T05:41:08.717Z"}
{"level":"debug","message":"Executing query [m8phy4fh6sjssa95luq]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T05:41:08.717Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8phy4fh6sjssa95luq]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T05:41:08.719Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T05:41:08.720Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T05:41:08.720Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:41:08.722Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:41:08.723Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:41:08.723Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T05:41:08.724Z"}
{"level":"debug","message":"Executing query [m8phy4fpe6w9o4xz0j]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T05:41:08.725Z"}
{"level":"debug","message":"Executing query [m8phy4fryqk53tl72r]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T05:41:08.727Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T05:41:08.729Z"}
{"level":"debug","message":"Executing query [m8phy4fuqlow4d824w]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T05:41:08.730Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:41:08.734Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8phy4e6okgp5tmvwub]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T05:41:08.689Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T05:41:08.690Z"}
{"code":"AUTH_SWITCH_PLUGIN_ERROR","fatal":true,"level":"error","message":"Error al conectar a la base de datos: authSwitch.authSwitchRequestMoreData is not a function","stack":"TypeError: authSwitch.authSwitchRequestMoreData is not a function\n    at ClientHandshake.handshakeResult (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\client_handshake.js:181:22)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:45:22)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T05:41:08.815Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:09.310Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T05:41:09.527Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:41:09.600Z"}
{"level":"debug","message":"Executing query [m8phy55108thzc6ve7kp]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T05:41:09.637Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8phy55108thzc6ve7kp]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T05:41:09.640Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T05:41:09.642Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:41:09.675Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:10.516Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T05:41:10.711Z"}
{"duration":"29ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T05:41:10.715Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T05:41:10.594Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:41:10.751Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T05:41:10.720Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T05:41:10.726Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T05:41:10.754Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T06:36:34.829Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T06:36:34.841Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T06:36:34.844Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T06:36:34.851Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T06:36:34.855Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T06:36:34.858Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T06:36:34.860Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T06:36:34.864Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T06:36:34.869Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T06:36:34.874Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T06:36:34.877Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T06:36:34.931Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T06:36:34.949Z","userId":1,"userRole":"USER"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T06:36:34.881Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:35.178Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:35.200Z"}
{"level":"debug","message":"Executing query [m8pjxf6w5cle3gdzyw9]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T06:36:35.240Z"}
{"level":"debug","message":"Executing query [m8pjxf9g1lklifo8i2b]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742970995235\"]","timestamp":"2025-03-26T06:36:35.334Z"}
{"level":"debug","message":"Executing query [m8pjxf7xbhblx0r56ki]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:35.277Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T06:36:35.339Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T06:36:35.364Z"}
{"level":"debug","message":"Executing query [m8pjxfaghdwarchisth]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742970995235\"]","timestamp":"2025-03-26T06:36:35.368Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T06:36:35.372Z"}
{"level":"debug","message":"Executing query [m8pjxfan4hd8d1m5rp9]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742970995235\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T06:36:35.375Z"}
{"level":"debug","message":"Executing query [m8pjxfb5ahbwlansnuf]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1028]","timestamp":"2025-03-26T06:36:35.393Z"}
{"level":"debug","message":"Executing query [m8pjxfba18a501cje1o]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742970995235\"]","timestamp":"2025-03-26T06:36:35.398Z"}
{"level":"debug","message":"Executing query [m8pjxfbkmz6tpahoalp]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1028]","timestamp":"2025-03-26T06:36:35.408Z"}
{"level":"debug","message":"Executing query [m8pjxfbpwhldosi3iqr]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1028]","timestamp":"2025-03-26T06:36:35.413Z"}
{"level":"debug","message":"Executing query [m8pjxfae1asv4g8hfwq]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:35.367Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T06:36:35.405Z"}
{"level":"debug","message":"Executing query [m8pjxfbi807w691pcsv]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:35.406Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T06:36:35.409Z"}
{"level":"debug","message":"Executing query [m8pjxfbmso2p0az9l1l]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:35.410Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T06:36:35.412Z"}
{"level":"debug","message":"Executing query [m8pjxfbpmfev3pfmwgj]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:35.413Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T06:36:35.415Z"}
{"level":"debug","message":"Executing query [m8pjxfbr390f3bg5uts]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:35.416Z"}
{"level":"debug","message":"Executing query [m8pjxfbt41e7sp9uchb]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1028]","timestamp":"2025-03-26T06:36:35.417Z"}
{"level":"debug","message":"Executing query [m8pjxfbxy7a7lx6npzp]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1028]","timestamp":"2025-03-26T06:36:35.421Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8pjxfbr390f3bg5uts]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T06:36:35.422Z"}
{"level":"debug","message":"Executing query [m8pjxfc0utpxy8z36jl]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1028]","timestamp":"2025-03-26T06:36:35.424Z"}
{"level":"debug","message":"Executing query [m8pjxfc2dqo14kt51t]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1028]","timestamp":"2025-03-26T06:36:35.426Z"}
{"level":"debug","message":"Executing query [m8pjxfc684ard3wnutq]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1028]","timestamp":"2025-03-26T06:36:35.430Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T06:36:35.424Z"}
{"level":"debug","message":"Executing query [m8pjxfc0q8w8tjeph2c]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:35.424Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T06:36:35.429Z"}
{"level":"debug","message":"Executing query [m8pjxfc60d4d471d74m4]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:35.430Z"}
{"level":"debug","message":"Executing query [m8pjxfc8honpnggpc1v]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T06:36:35.432Z"}
{"level":"debug","message":"Executing query [m8pjxfcb39ikn3amc8z]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T06:36:35.435Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T06:36:35.435Z"}
{"level":"debug","message":"Executing query [m8pjxfcbz3qop49ovel]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:35.435Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T06:36:35.438Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8pjxfcbz3qop49ovel]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T06:36:35.466Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:35.165Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T06:36:35.467Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T06:36:35.467Z"}
{"level":"debug","message":"Executing query [m8pjxfdvb2in2echqvh]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:35.491Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8pjxfdvb2in2echqvh]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T06:36:35.493Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T06:36:35.494Z"}
{"level":"debug","message":"Executing query [m8pjxfdyhiww6ltrhw9]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:35.494Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8pjxfdyhiww6ltrhw9]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T06:36:35.496Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T06:36:35.496Z"}
{"level":"debug","message":"Executing query [m8pjxfe02e3cgzoprwm]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:35.496Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8pjxfe02e3cgzoprwm]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T06:36:35.498Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T06:36:35.498Z"}
{"level":"debug","message":"Executing query [m8pjxfe266ngieiruco]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:35.498Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8pjxfe266ngieiruco]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T06:36:35.500Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T06:36:35.500Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T06:36:35.500Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T06:36:35.501Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T06:36:35.502Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T06:36:35.502Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T06:36:35.502Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T06:36:35.502Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T06:36:35.502Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T06:36:35.502Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T06:36:35.503Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T06:36:35.503Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T06:36:35.503Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T06:36:35.503Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T06:36:35.503Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T06:36:35.503Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T06:36:35.503Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T06:36:35.503Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T06:36:35.504Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T06:36:35.504Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T06:36:35.506Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:35.529Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:35.588Z"}
{"level":"debug","message":"Executing query [m8pjxfgwq49wy9wggk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T06:36:35.601Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T06:36:35.693Z"}
{"level":"debug","message":"Executing query [m8pjxfjiqsu34eiapga]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:35.694Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T06:36:35.700Z"}
{"level":"debug","message":"Executing query [m8pjxfjpytiow4wkgm]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T06:36:35.701Z"}
{"level":"debug","message":"Executing query [m8pjxfjvst5tr4hr65b]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T06:36:35.707Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T06:36:35.709Z"}
{"level":"debug","message":"Executing query [m8pjxfjxzy7mjfudmf]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:35.709Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T06:36:35.711Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T06:36:35.737Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:35.704Z"}
{"level":"debug","message":"Executing query [m8pjxfkwq3vbyd5to1]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T06:36:35.744Z"}
{"level":"debug","message":"Executing query [m8pjxfl15ilvuh4xrqn]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T06:36:35.749Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8pjxfl15ilvuh4xrqn]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T06:36:35.754Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T06:36:35.757Z"}
{"level":"debug","message":"Executing query [m8pjxflw870i1cinrtg]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T06:36:35.780Z"}
{"level":"debug","message":"Executing query [m8pjxfm1ved6ibt3ua]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T06:36:35.785Z"}
{"level":"debug","message":"Executing query [m8pjxfm5kwvoe7p1ivc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T06:36:35.789Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T06:36:35.686Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:35.941Z"}
{"level":"debug","message":"Executing query [m8pjxfqhooa7y9hqal]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T06:36:35.946Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T06:36:36.005Z"}
{"level":"debug","message":"Executing query [m8pjxfsb0hh99lh6joq]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:36.011Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8pjxfsb0hh99lh6joq]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T06:36:36.015Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T06:36:36.017Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:36.050Z"}
{"level":"debug","message":"Executing query [m8pjxfu7rvgwb7g32wo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T06:36:36.079Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T06:36:36.109Z"}
{"level":"debug","message":"Executing query [m8pjxfv8wsz6jxtcw2r]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:36.116Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8pjxfv8wsz6jxtcw2r]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T06:36:36.120Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T06:36:36.120Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T06:36:36.315Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T06:36:36.021Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:36.689Z"}
{"level":"debug","message":"Executing query [m8pjxgb9jcq3ldaya3m]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T06:36:36.693Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T06:36:36.715Z"}
{"level":"debug","message":"Executing query [m8pjxgbwo3t4vzi8vko]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742970996692\"]","timestamp":"2025-03-26T06:36:36.716Z"}
{"level":"debug","message":"Executing query [m8pjxgc3mde2lzzhcal]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742970996692\",true]","timestamp":"2025-03-26T06:36:36.724Z"}
{"level":"debug","message":"Executing query [m8pjxgcc7ndixc9xldk]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[30]","timestamp":"2025-03-26T06:36:36.732Z"}
{"level":"debug","message":"Executing query [m8pjxgcfilrbn2tx64]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742970996692\"]","timestamp":"2025-03-26T06:36:36.735Z"}
{"level":"debug","message":"Executing query [m8pjxgci221i6cheale]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",30]","timestamp":"2025-03-26T06:36:36.738Z"}
{"level":"debug","message":"Executing query [m8pjxgcmjx2irmg9ekm]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[30]","timestamp":"2025-03-26T06:36:36.743Z"}
{"level":"debug","message":"Executing query [m8pjxgcpqlpryw6efyf]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[30]","timestamp":"2025-03-26T06:36:36.745Z"}
{"level":"debug","message":"Executing query [m8pjxgctdvow2saerik]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[30]","timestamp":"2025-03-26T06:36:36.749Z"}
{"level":"debug","message":"Executing query [m8pjxgcwbdqzgd7hvhe]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[30]","timestamp":"2025-03-26T06:36:36.752Z"}
{"level":"debug","message":"Executing query [m8pjxgczeevhx4d1xf]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[30]","timestamp":"2025-03-26T06:36:36.755Z"}
{"level":"debug","message":"Executing query [m8pjxgd5y0x1niiz98o]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[30]","timestamp":"2025-03-26T06:36:36.761Z"}
{"level":"debug","message":"Executing query [m8pjxgd7rm5c1fzk9p]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T06:36:36.763Z"}
{"level":"debug","message":"Executing query [m8pjxgd982expubsh3n]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T06:36:36.765Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T06:36:36.766Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:36.816Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T06:36:36.318Z"}
{"level":"debug","message":"Executing query [m8pjxgev5qxrwkrd47]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T06:36:36.823Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T06:36:36.328Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T06:36:36.840Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T06:36:36.334Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T06:36:36.339Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T06:36:36.339Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Executing query [m8pjxgfia8p1twgmo1g]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:36.846Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8pjxgfia8p1twgmo1g]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T06:36:36.848Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T06:36:36.849Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:36.780Z"}
{"level":"debug","message":"Executing query [m8pjxgfanmixtf02s1]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T06:36:36.839Z"}
{"level":"debug","message":"Executing query [m8pjxgih4q48czilh1]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:36.953Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8pjxgih4q48czilh1]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T06:36:36.956Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T06:36:36.956Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T06:36:36.976Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:37.187Z"}
{"level":"debug","message":"Executing query [m8pjxgp6h9y6zmm4v5n]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T06:36:37.194Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T06:36:37.245Z"}
{"level":"debug","message":"Executing query [m8pjxgqnulaycqxdly]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:37.247Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8pjxgqnulaycqxdly]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T06:36:37.250Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T06:36:37.251Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:37.251Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:37.626Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:37.639Z"}
{"level":"debug","message":"Executing query [m8pjxh1lamqw954nz47]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:37.641Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T06:36:37.654Z"}
{"level":"debug","message":"Executing query [m8pjxh213qsa23niqlu]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T06:36:37.657Z"}
{"level":"debug","message":"Executing query [m8pjxh221o4nri24u42]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T06:36:37.658Z"}
{"level":"debug","message":"Executing query [m8pjxh244bcrwd26c5c]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T06:36:37.660Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T06:36:37.661Z"}
{"level":"debug","message":"Executing query [m8pjxh2654bkgs4ozqt]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T06:36:37.662Z"}
{"level":"debug","message":"Executing query [m8pjxh27p4ivobmq30f]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T06:36:37.663Z"}
{"level":"debug","message":"Executing query [m8pjxh2982rbcige2dc]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T06:36:37.665Z"}
{"level":"debug","message":"Executing query [m8pjxh2bffu529eh3]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T06:36:37.667Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T06:36:37.673Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T06:36:37.673Z"}
{"level":"debug","message":"Executing query [m8pjxh2hoj6bcworh8]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T06:36:37.673Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8pjxh2hoj6bcworh8]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T06:36:37.675Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T06:36:37.675Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T06:36:37.675Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T06:36:37.676Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T06:36:37.677Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T06:36:37.678Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T06:36:37.678Z"}
{"level":"debug","message":"Executing query [m8pjxh2n0pttibwq0d9g]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T06:36:37.679Z"}
{"level":"debug","message":"Executing query [m8pjxh2ogv3q6xtzes9]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T06:36:37.680Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T06:36:37.682Z"}
{"level":"debug","message":"Executing query [m8pjxh2qte21pv1dki]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T06:36:37.682Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T06:36:37.683Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:40.048Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T06:36:40.200Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T06:36:40.270Z"}
{"level":"debug","message":"Executing query [m8pjxj3h8elijz0nzai]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T06:36:40.301Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8pjxj3h8elijz0nzai]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T06:36:40.302Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T06:36:40.304Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T06:36:40.327Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:40.197Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T06:36:40.384Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T06:36:40.395Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T06:36:40.537Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T06:36:40.546Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T06:36:40.583Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:46.981Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T06:36:47.083Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T06:36:47.084Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T06:36:47.038Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T06:36:47.185Z"}
{"duration":"19ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T06:36:47.187Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T06:36:47.191Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T06:36:47.194Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:18:09.071Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:18:09.081Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:18:09.088Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:18:09.091Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:18:09.094Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:18:09.100Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:18:09.105Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T16:18:09.120Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T16:18:09.125Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T16:18:09.127Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T16:18:09.129Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T16:18:09.130Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T16:18:09.178Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T16:18:09.197Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:09.372Z"}
{"level":"debug","message":"Executing query [m8q4pbq71xq1bmuu2ls]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:18:09.439Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:09.393Z"}
{"level":"debug","message":"Executing query [m8q4pbr04t6ftmuoinb]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:09.468Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:18:09.553Z"}
{"level":"debug","message":"Executing query [m8q4pbtfnoksq1ecend]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743005889433\"]","timestamp":"2025-03-26T16:18:09.556Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:18:09.557Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T16:18:09.571Z"}
{"level":"debug","message":"Executing query [m8q4pbtwwg6x6z2e96n]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:09.572Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T16:18:09.575Z"}
{"level":"debug","message":"Executing query [m8q4pbtzitg1hq3gtlc]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:09.575Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T16:18:09.584Z"}
{"level":"debug","message":"Executing query [m8q4pbu9q3wguoef99a]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:09.585Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T16:18:09.587Z"}
{"level":"debug","message":"Executing query [m8q4pbuciu3lcc4nrrg]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:09.588Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T16:18:09.593Z"}
{"level":"debug","message":"Executing query [m8q4pbuh7ki1xi2r1mh]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:09.593Z"}
{"level":"debug","message":"Executing query [m8q4pbuk6j7yc6jrq1g]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743005889433\"]","timestamp":"2025-03-26T16:18:09.596Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8q4pbuh7ki1xi2r1mh]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T16:18:09.601Z"}
{"level":"debug","message":"Executing query [m8q4pbuor2jayncpgjj]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743005889433\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T16:18:09.600Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T16:18:09.602Z"}
{"level":"debug","message":"Executing query [m8q4pbuqqxsdkurf83]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:09.602Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T16:18:09.604Z"}
{"level":"debug","message":"Executing query [m8q4pbus4a4vmbk12mt]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:09.604Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T16:18:09.606Z"}
{"level":"debug","message":"Executing query [m8q4pbuv5i3zaeonw7s]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:09.607Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q4pbuv5i3zaeonw7s]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T16:18:09.610Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T16:18:09.610Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T16:18:09.611Z"}
{"level":"debug","message":"Executing query [m8q4pbv03f8fk6rm9yy]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:09.612Z"}
{"level":"debug","message":"Executing query [m8q4pbv204zx3ad37qjf]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1029]","timestamp":"2025-03-26T16:18:09.614Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q4pbv03f8fk6rm9yy]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T16:18:09.615Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T16:18:09.616Z"}
{"level":"debug","message":"Executing query [m8q4pbv523nem9tfnq1]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:09.617Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q4pbv523nem9tfnq1]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T16:18:09.618Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T16:18:09.619Z"}
{"level":"debug","message":"Executing query [m8q4pbv77vsinvxxvl2]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:09.619Z"}
{"level":"debug","message":"Executing query [m8q4pbv8nh102xezvp9]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743005889433\"]","timestamp":"2025-03-26T16:18:09.620Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q4pbv77vsinvxxvl2]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T16:18:09.621Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T16:18:09.622Z"}
{"level":"debug","message":"Executing query [m8q4pbvauvu9sm4ntj]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:09.622Z"}
{"level":"debug","message":"Executing query [m8q4pbvi228onhgnpxv]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1029]","timestamp":"2025-03-26T16:18:09.630Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q4pbvauvu9sm4ntj]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T16:18:09.624Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T16:18:09.625Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T16:18:09.625Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T16:18:09.626Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T16:18:09.627Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T16:18:09.627Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T16:18:09.627Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T16:18:09.627Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T16:18:09.627Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T16:18:09.627Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T16:18:09.627Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T16:18:09.628Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T16:18:09.628Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T16:18:09.628Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T16:18:09.628Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T16:18:09.628Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T16:18:09.628Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T16:18:09.628Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T16:18:09.629Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T16:18:09.629Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:18:09.631Z"}
{"level":"debug","message":"Executing query [m8q4pbvofnn68zfcf4o]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1029]","timestamp":"2025-03-26T16:18:09.636Z"}
{"level":"debug","message":"Executing query [m8q4pbvsz10861ys3oa]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1029]","timestamp":"2025-03-26T16:18:09.640Z"}
{"level":"debug","message":"Executing query [m8q4pbvxyz7i3v712l]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1029]","timestamp":"2025-03-26T16:18:09.645Z"}
{"level":"debug","message":"Executing query [m8q4pbw0aldzcevhwbd]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1029]","timestamp":"2025-03-26T16:18:09.648Z"}
{"level":"debug","message":"Executing query [m8q4pbw3qnaxganz7p]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1029]","timestamp":"2025-03-26T16:18:09.651Z"}
{"level":"debug","message":"Executing query [m8q4pbw7yuk0f69odwb]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1029]","timestamp":"2025-03-26T16:18:09.655Z"}
{"level":"debug","message":"Executing query [m8q4pbwaffhythutwpi]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T16:18:09.658Z"}
{"level":"debug","message":"Executing query [m8q4pbwcuqpr61uaix]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T16:18:09.660Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:18:09.663Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:09.364Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:09.801Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T16:18:09.930Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T16:18:10.006Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:10.003Z"}
{"level":"debug","message":"Executing query [m8q4pc79ft78ki7erpm]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:18:10.053Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:18:10.110Z"}
{"level":"debug","message":"Executing query [m8q4pc8x5cnqijqec4r]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:10.114Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T16:18:10.120Z"}
{"level":"debug","message":"Executing query [m8q4pc945fv1l31933]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T16:18:10.120Z"}
{"level":"debug","message":"Executing query [m8q4pc974p6liy95drn]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T16:18:10.123Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T16:18:10.125Z"}
{"level":"debug","message":"Executing query [m8q4pc9awr0cku83ypb]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:10.126Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:10.136Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T16:18:10.128Z"}
{"level":"debug","message":"Executing query [m8q4pcbcipky94s5dwq]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T16:18:10.200Z"}
{"level":"debug","message":"Executing query [m8q4pcbn9iy2bwa797g]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T16:18:10.211Z"}
{"level":"debug","message":"Executing query [m8q4pcbro23dvodo8m]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T16:18:10.215Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:18:10.239Z"}
{"level":"debug","message":"Executing query [m8q4pcckbter2ycb1k9]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T16:18:10.244Z"}
{"level":"debug","message":"Executing query [m8q4pccowjg4t312ax]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T16:18:10.249Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8q4pccowjg4t312ax]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T16:18:10.252Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:18:10.255Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:10.281Z"}
{"level":"debug","message":"Executing query [m8q4pcep3shpdqchtix]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:18:10.322Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:18:10.380Z"}
{"level":"debug","message":"Executing query [m8q4pcghd0tuh0oo9ia]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:10.385Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q4pcghd0tuh0oo9ia]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T16:18:10.389Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T16:18:10.389Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T16:18:10.471Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T16:18:10.472Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T16:18:10.472Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T16:18:10.472Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T16:18:10.473Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T16:18:10.473Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:10.483Z"}
{"level":"debug","message":"Executing query [m8q4pckhcdptpl7fwba]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:18:10.529Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:18:10.582Z"}
{"level":"debug","message":"Executing query [m8q4pcm2k2wd277f8vp]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:10.586Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q4pcm2k2wd277f8vp]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T16:18:10.589Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T16:18:10.590Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:10.687Z"}
{"level":"debug","message":"Executing query [m8q4pcozk54nxibsssi]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:18:10.691Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:18:10.715Z"}
{"level":"debug","message":"Executing query [m8q4pcppet9iv2c6hx]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743005890690\"]","timestamp":"2025-03-26T16:18:10.717Z"}
{"level":"debug","message":"Executing query [m8q4pcpt6e8a3bqbrjr]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743005890690\",true]","timestamp":"2025-03-26T16:18:10.721Z"}
{"level":"debug","message":"Executing query [m8q4pcq19k3akohbdv]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-26T16:18:10.729Z"}
{"level":"debug","message":"Executing query [m8q4pcq6bvbg2h5xsn5]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743005890690\"]","timestamp":"2025-03-26T16:18:10.734Z"}
{"level":"debug","message":"Executing query [m8q4pcq9q93gt4zrixh]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",31]","timestamp":"2025-03-26T16:18:10.737Z"}
{"level":"debug","message":"Executing query [m8q4pcqe8iph35hhk58]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-26T16:18:10.742Z"}
{"level":"debug","message":"Executing query [m8q4pcqgjprb2yczej]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-26T16:18:10.744Z"}
{"level":"debug","message":"Executing query [m8q4pcqlbxqvju80itw]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-26T16:18:10.749Z"}
{"level":"debug","message":"Executing query [m8q4pcqnueitp1worui]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-26T16:18:10.751Z"}
{"level":"debug","message":"Executing query [m8q4pcqptm10imeyqd]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-26T16:18:10.753Z"}
{"level":"debug","message":"Executing query [m8q4pcque10b9n5wfpu]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-26T16:18:10.758Z"}
{"level":"debug","message":"Executing query [m8q4pcqwk6lfc0p8p77]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T16:18:10.760Z"}
{"level":"debug","message":"Executing query [m8q4pcqzsllhf66ckge]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T16:18:10.763Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:18:10.764Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:10.774Z"}
{"level":"debug","message":"Executing query [m8q4pcre91b8z29wdu]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:18:10.778Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:18:10.796Z"}
{"level":"debug","message":"Executing query [m8q4pcryimxauieasa]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:10.798Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q4pcryimxauieasa]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T16:18:10.801Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T16:18:10.801Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:10.820Z"}
{"level":"debug","message":"Executing query [m8q4pcsoyy4lmn75ez8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:18:10.824Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:18:10.855Z"}
{"level":"debug","message":"Executing query [m8q4pcto6i42sz9o9th]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:10.860Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q4pcto6i42sz9o9th]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T16:18:10.864Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T16:18:10.864Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:11.030Z"}
{"level":"debug","message":"Executing query [m8q4pcyjxm09hpo858]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:18:11.035Z"}
{"level":"debug","message":"Executing query [m8q4pczeyibtx0sfljl]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:11.066Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:18:11.068Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q4pczeyibtx0sfljl]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T16:18:11.069Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T16:18:11.070Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:11.443Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:11.577Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:11.657Z"}
{"level":"debug","message":"Executing query [m8q4pdfwvz7aocen1a]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:11.661Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:18:11.738Z"}
{"level":"debug","message":"Executing query [m8q4pdilwq1cdfihqi]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:18:11.757Z"}
{"level":"debug","message":"Executing query [m8q4pdio84t1ucyxkor]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T16:18:11.760Z"}
{"level":"debug","message":"Executing query [m8q4pdiq0hsz6v69qy0i]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T16:18:11.762Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T16:18:11.765Z"}
{"level":"debug","message":"Executing query [m8q4pdiu8lfopsutcyl]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T16:18:11.766Z"}
{"level":"debug","message":"Executing query [m8q4pdixzdxxpn4hif]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T16:18:11.769Z"}
{"level":"debug","message":"Executing query [m8q4pdj180ogyyojnkf]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T16:18:11.773Z"}
{"level":"debug","message":"Executing query [m8q4pdj3spxh4wd9rf]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T16:18:11.775Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T16:18:11.783Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T16:18:11.783Z"}
{"level":"debug","message":"Executing query [m8q4pdjc6q9mwf3r4qh]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T16:18:11.784Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8q4pdjc6q9mwf3r4qh]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T16:18:11.786Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T16:18:11.787Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T16:18:11.787Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T16:18:11.789Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T16:18:11.790Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T16:18:11.791Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T16:18:11.791Z"}
{"level":"debug","message":"Executing query [m8q4pdjk53pqaoyjgb5]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T16:18:11.792Z"}
{"level":"debug","message":"Executing query [m8q4pdjm0ddwdgq94dip]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T16:18:11.794Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T16:18:11.795Z"}
{"level":"debug","message":"Executing query [m8q4pdjokuvpx9cpys]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T16:18:11.796Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:18:11.798Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:11.471Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T16:18:11.874Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T16:18:11.896Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:18:12.109Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T16:18:12.125Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:18:12.186Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:12.381Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T16:18:12.562Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:18:12.641Z"}
{"level":"debug","message":"Executing query [m8q4pe86thyy6x1uyne]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T16:18:12.678Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q4pe86thyy6x1uyne]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T16:18:12.684Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T16:18:12.688Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:18:12.713Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:13.919Z"}
{"duration":"10ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T16:18:14.043Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T16:18:14.051Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:18:14.056Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T16:18:14.057Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:18:13.974Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:18:14.111Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T16:18:14.113Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:21:24.915Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T16:21:25.198Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:25.190Z"}
{"level":"debug","message":"Executing query [m8q4tiuqcfpyakzkbiw]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:21:25.299Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:21:25.393Z"}
{"level":"debug","message":"Executing query [m8q4tixk12gnwxfyhyoj]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743006085293\"]","timestamp":"2025-03-26T16:21:25.400Z"}
{"level":"debug","message":"Executing query [m8q4tiygmndag3uklyr]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743006085293\"]","timestamp":"2025-03-26T16:21:25.432Z"}
{"level":"debug","message":"Executing query [m8q4tiypn4epk2oljh]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743006085293\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T16:21:25.441Z"}
{"level":"debug","message":"Executing query [m8q4tiz0b29g7l8cilt]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1030]","timestamp":"2025-03-26T16:21:25.452Z"}
{"level":"debug","message":"Executing query [m8q4tiz6afdaevt73kd]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743006085293\"]","timestamp":"2025-03-26T16:21:25.459Z"}
{"level":"debug","message":"Executing query [m8q4tizb2179t5tav79i]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1030]","timestamp":"2025-03-26T16:21:25.463Z"}
{"level":"debug","message":"Executing query [m8q4tizjc8zh7s2v3r]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1030]","timestamp":"2025-03-26T16:21:25.471Z"}
{"level":"debug","message":"Executing query [m8q4tizo51oj2bolmi8]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1030]","timestamp":"2025-03-26T16:21:25.476Z"}
{"level":"debug","message":"Executing query [m8q4tiztp8ctxchkjwa]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1030]","timestamp":"2025-03-26T16:21:25.481Z"}
{"level":"debug","message":"Executing query [m8q4tizyc4gncevrxr7]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1030]","timestamp":"2025-03-26T16:21:25.486Z"}
{"level":"debug","message":"Executing query [m8q4tj00y18crw40ex]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1030]","timestamp":"2025-03-26T16:21:25.488Z"}
{"level":"debug","message":"Executing query [m8q4tj052v6ccpx0xc7]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1030]","timestamp":"2025-03-26T16:21:25.493Z"}
{"level":"debug","message":"Executing query [m8q4tj08p30f0ufzf2j]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T16:21:25.496Z"}
{"level":"debug","message":"Executing query [m8q4tj0brzui9wk8j28]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T16:21:25.499Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:21:25.502Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:25.506Z"}
{"level":"debug","message":"Executing query [m8q4tj2cmcyy7o8n4r]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:25.572Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T16:21:25.216Z","userId":1,"userRole":"USER"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:21:25.650Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T16:21:25.655Z"}
{"level":"debug","message":"Executing query [m8q4tj4n87q69q75rhd]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:25.655Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T16:21:25.658Z"}
{"level":"debug","message":"Executing query [m8q4tj4r1rza95h1vjg]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:25.659Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T16:21:25.661Z"}
{"level":"debug","message":"Executing query [m8q4tj4tcp2n02bnvo]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:25.661Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T16:21:25.665Z"}
{"level":"debug","message":"Executing query [m8q4tj4yltahfynev7c]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:25.666Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T16:21:25.668Z"}
{"level":"debug","message":"Executing query [m8q4tj50kv6s3lheepb]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:25.668Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8q4tj50kv6s3lheepb]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T16:21:25.672Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T16:21:25.672Z"}
{"level":"debug","message":"Executing query [m8q4tj5590jwo4rv5j]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:25.673Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T16:21:25.675Z"}
{"level":"debug","message":"Executing query [m8q4tj572vye3sbt3np]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:25.675Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T16:21:25.677Z"}
{"level":"debug","message":"Executing query [m8q4tj5aigygcscm99]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:25.678Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q4tj5aigygcscm99]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T16:21:25.680Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T16:21:25.681Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T16:21:25.681Z"}
{"level":"debug","message":"Executing query [m8q4tj5fnhsmczhd4us]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:25.683Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q4tj5fnhsmczhd4us]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T16:21:25.686Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T16:21:25.686Z"}
{"level":"debug","message":"Executing query [m8q4tj5ig9mu3uovpzj]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:25.686Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q4tj5ig9mu3uovpzj]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T16:21:25.688Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T16:21:25.689Z"}
{"level":"debug","message":"Executing query [m8q4tj5lq9piged021p]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:25.689Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q4tj5lq9piged021p]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T16:21:25.690Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T16:21:25.691Z"}
{"level":"debug","message":"Executing query [m8q4tj5nl1pp8stcxe]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:25.691Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q4tj5nl1pp8stcxe]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T16:21:25.694Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T16:21:25.694Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T16:21:25.695Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T16:21:25.696Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T16:21:25.696Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T16:21:25.697Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T16:21:25.697Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T16:21:25.697Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T16:21:25.697Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T16:21:25.697Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T16:21:25.697Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T16:21:25.698Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T16:21:25.698Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T16:21:25.698Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T16:21:25.698Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T16:21:25.698Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T16:21:25.698Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T16:21:25.698Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T16:21:25.699Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T16:21:25.699Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:21:25.701Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:21:24.925Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:21:24.928Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:21:24.931Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:21:24.934Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:21:24.952Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:21:24.964Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T16:21:24.968Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T16:21:24.971Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T16:21:24.973Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T16:21:24.976Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T16:21:24.980Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:25.749Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:25.489Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:25.828Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T16:21:25.790Z"}
{"level":"debug","message":"Executing query [m8q4tje5zumn06ftno]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T16:21:25.997Z"}
{"level":"debug","message":"Executing query [m8q4tjesqjdwle2z1bm]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T16:21:26.020Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:21:26.026Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8q4tjesqjdwle2z1bm]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T16:21:26.029Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:21:26.035Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:26.083Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T16:21:25.901Z"}
{"level":"debug","message":"Executing query [m8q4tjgz554l7fon3mq]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:21:26.099Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:21:26.127Z"}
{"level":"debug","message":"Executing query [m8q4tjhv16f4nmzck3q]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:26.131Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q4tjhv16f4nmzck3q]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T16:21:26.134Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T16:21:26.135Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:26.200Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:26.323Z"}
{"level":"debug","message":"Executing query [m8q4tjndowz12ixhfp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:21:26.329Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:21:26.362Z"}
{"level":"debug","message":"Executing query [m8q4tjoeu57q57pjdxh]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:26.366Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q4tjoeu57q57pjdxh]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T16:21:26.369Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T16:21:26.369Z"}
{"level":"debug","message":"Executing query [m8q4tjms5lnnzj324wf]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:21:26.308Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:21:26.404Z"}
{"level":"debug","message":"Executing query [m8q4tjprntff9ssltvh]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:26.416Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T16:21:26.406Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T16:21:26.425Z"}
{"level":"debug","message":"Executing query [m8q4tjq2921cxunbby5]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T16:21:26.426Z"}
{"level":"debug","message":"Executing query [m8q4tjqyljigod0gxrj]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T16:21:26.458Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T16:21:26.460Z"}
{"level":"debug","message":"Executing query [m8q4tjr0df4t44y0s6d]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:26.461Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T16:21:26.464Z"}
{"level":"debug","message":"Executing query [m8q4tjubra6z3qnrcg]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T16:21:26.579Z"}
{"level":"debug","message":"Executing query [m8q4tjuind66esb8qb]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T16:21:26.586Z"}
{"level":"debug","message":"Executing query [m8q4tjun2f3y0sl4562]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T16:21:26.591Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:26.728Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T16:21:26.408Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T16:21:26.409Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T16:21:26.409Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T16:21:26.410Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T16:21:26.410Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:26.860Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:26.879Z"}
{"level":"debug","message":"Executing query [m8q4tk2sd17uiv0g6ib]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:21:26.884Z"}
{"level":"debug","message":"Executing query [m8q4tk2bifovcg4xmb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:21:26.867Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:21:26.899Z"}
{"level":"debug","message":"Executing query [m8q4tk3hn1ut882knki]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:26.909Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q4tk3hn1ut882knki]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T16:21:26.913Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T16:21:26.913Z"}
{"level":"debug","message":"Executing query [m8q4tjylyit0paqkrs]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:21:26.733Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:21:26.919Z"}
{"level":"debug","message":"Executing query [m8q4tk3xbseoe32kso4]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743006086730\"]","timestamp":"2025-03-26T16:21:26.925Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:21:26.932Z"}
{"level":"debug","message":"Executing query [m8q4tk45eevl6dr61vn]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:26.933Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q4tk45eevl6dr61vn]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T16:21:26.936Z"}
{"level":"debug","message":"Executing query [m8q4tk49ps4waopuwh]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743006086730\",true]","timestamp":"2025-03-26T16:21:26.937Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T16:21:26.937Z"}
{"level":"debug","message":"Executing query [m8q4tk4nngk1d3zs5d]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[32]","timestamp":"2025-03-26T16:21:26.951Z"}
{"level":"debug","message":"Executing query [m8q4tk51c6az4z59gs4]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743006086730\"]","timestamp":"2025-03-26T16:21:26.965Z"}
{"level":"debug","message":"Executing query [m8q4tk54wo8655it1eh]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",32]","timestamp":"2025-03-26T16:21:26.968Z"}
{"level":"debug","message":"Executing query [m8q4tk5auh85iz8hce]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[32]","timestamp":"2025-03-26T16:21:26.974Z"}
{"level":"debug","message":"Executing query [m8q4tk5e40exbv7o77e]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[32]","timestamp":"2025-03-26T16:21:26.978Z"}
{"level":"debug","message":"Executing query [m8q4tk5jan812vvt6tj]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[32]","timestamp":"2025-03-26T16:21:26.983Z"}
{"level":"debug","message":"Executing query [m8q4tk5mzb74oibstg]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[32]","timestamp":"2025-03-26T16:21:26.986Z"}
{"level":"debug","message":"Executing query [m8q4tk5p7iyps3a4go9]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[32]","timestamp":"2025-03-26T16:21:26.990Z"}
{"level":"debug","message":"Executing query [m8q4tk5uldniahivr2i]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[32]","timestamp":"2025-03-26T16:21:26.994Z"}
{"level":"debug","message":"Executing query [m8q4tk5xpwmb1xfwyrd]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T16:21:26.997Z"}
{"level":"debug","message":"Executing query [m8q4tk6016f71hapchy]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T16:21:27.000Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:21:27.002Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:27.026Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:27.347Z"}
{"level":"debug","message":"Executing query [m8q4tkh9v0of91n2cfe]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:21:27.405Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:21:27.513Z"}
{"level":"debug","message":"Executing query [m8q4tkkd8jj7zavn6hg]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:27.517Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q4tkkd8jj7zavn6hg]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T16:21:27.533Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T16:21:27.535Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:27.500Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:27.531Z"}
{"level":"debug","message":"Executing query [m8q4tkkx8e22164ga9o]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:27.537Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:21:27.573Z"}
{"level":"debug","message":"Executing query [m8q4tkm9g9fukyrh5h4]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:21:27.585Z"}
{"level":"debug","message":"Executing query [m8q4tkma7rl0rwlvqn]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T16:21:27.586Z"}
{"level":"debug","message":"Executing query [m8q4tkmdeqp5z0bt99k]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T16:21:27.589Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T16:21:27.591Z"}
{"level":"debug","message":"Executing query [m8q4tkmgc6eq1ir3kra]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T16:21:27.592Z"}
{"level":"debug","message":"Executing query [m8q4tkmjlcy9xjgefnd]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T16:21:27.596Z"}
{"level":"debug","message":"Executing query [m8q4tkmnhi5nv6z9nhs]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T16:21:27.599Z"}
{"level":"debug","message":"Executing query [m8q4tkmqyl3m80d6skf]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T16:21:27.602Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T16:21:27.609Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T16:21:27.610Z"}
{"level":"debug","message":"Executing query [m8q4tkmysqophgkngld]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T16:21:27.610Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8q4tkmysqophgkngld]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T16:21:27.611Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T16:21:27.612Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T16:21:27.612Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T16:21:27.613Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T16:21:27.614Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T16:21:27.615Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T16:21:27.617Z"}
{"level":"debug","message":"Executing query [m8q4tkn6gahnjptft3o]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T16:21:27.618Z"}
{"level":"debug","message":"Executing query [m8q4tkn88e6a001844s]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T16:21:27.620Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T16:21:27.623Z"}
{"level":"debug","message":"Executing query [m8q4tknchzbngdj1w]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T16:21:27.624Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:21:27.626Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:27.932Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T16:21:28.260Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T16:21:28.277Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:21:28.570Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T16:21:28.600Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:21:28.684Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:28.720Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T16:21:28.944Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:21:29.123Z"}
{"level":"debug","message":"Executing query [m8q4tlu5h6nspiywr3s]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T16:21:29.165Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q4tlu5h6nspiywr3s]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T16:21:29.172Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T16:21:29.175Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:21:29.212Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:30.198Z"}
{"duration":"32ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T16:21:30.417Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:21:30.419Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T16:21:30.423Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:21:30.428Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:21:30.302Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:21:30.482Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T16:21:30.485Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:51:31.667Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:51:31.676Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:51:31.678Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:51:31.681Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:51:31.691Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:51:31.698Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T16:51:31.704Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T16:51:31.712Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T16:51:31.714Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T16:51:31.716Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T16:51:31.717Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T16:51:31.719Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T16:51:31.988Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T16:51:31.999Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:32.014Z"}
{"level":"debug","message":"Executing query [m8q5w8yvsuwjvqt45k]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:51:32.072Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:51:32.135Z"}
{"level":"debug","message":"Executing query [m8q5w90sdik78hxuf0e]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743007892067\"]","timestamp":"2025-03-26T16:51:32.140Z"}
{"level":"debug","message":"Executing query [m8q5w91cljqo5vevlt]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743007892067\"]","timestamp":"2025-03-26T16:51:32.160Z"}
{"level":"debug","message":"Executing query [m8q5w91gv1k6ssrekos]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743007892067\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T16:51:32.164Z"}
{"level":"debug","message":"Executing query [m8q5w91r1e4wcetvoci]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1031]","timestamp":"2025-03-26T16:51:32.175Z"}
{"level":"debug","message":"Executing query [m8q5w91vp1wv8d1wckr]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743007892067\"]","timestamp":"2025-03-26T16:51:32.179Z"}
{"level":"debug","message":"Executing query [m8q5w91zvc86ua5k0t]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1031]","timestamp":"2025-03-26T16:51:32.183Z"}
{"level":"debug","message":"Executing query [m8q5w925wkdztmfej9i]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1031]","timestamp":"2025-03-26T16:51:32.189Z"}
{"level":"debug","message":"Executing query [m8q5w929hx7vsfj2amv]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1031]","timestamp":"2025-03-26T16:51:32.193Z"}
{"level":"debug","message":"Executing query [m8q5w92d1yu4uzxhzfp]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1031]","timestamp":"2025-03-26T16:51:32.197Z"}
{"level":"debug","message":"Executing query [m8q5w92intzvj2kssu]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1031]","timestamp":"2025-03-26T16:51:32.202Z"}
{"level":"debug","message":"Executing query [m8q5w92kw2kyxppbnot]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1031]","timestamp":"2025-03-26T16:51:32.204Z"}
{"level":"debug","message":"Executing query [m8q5w92oaz9cd4sdp6q]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1031]","timestamp":"2025-03-26T16:51:32.208Z"}
{"level":"debug","message":"Executing query [m8q5w92r2bet2j7mrqo]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T16:51:32.212Z"}
{"level":"debug","message":"Executing query [m8q5w92uayyxyamdq6l]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T16:51:32.214Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:51:32.217Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:32.219Z"}
{"level":"debug","message":"Executing query [m8q5w94l1u2dbmwefu8]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:32.278Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:51:32.350Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T16:51:32.362Z"}
{"level":"debug","message":"Executing query [m8q5w96zawlg004ijz]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:32.363Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T16:51:32.365Z"}
{"level":"debug","message":"Executing query [m8q5w972lv1lm7qiz0p]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:32.366Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T16:51:32.368Z"}
{"level":"debug","message":"Executing query [m8q5w974vfq1h9iv6ij]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:32.368Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T16:51:32.371Z"}
{"level":"debug","message":"Executing query [m8q5w97747zwg6xt8do]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:32.371Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T16:51:32.373Z"}
{"level":"debug","message":"Executing query [m8q5w979usdndch1u6]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:32.374Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8q5w979usdndch1u6]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T16:51:32.376Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T16:51:32.376Z"}
{"level":"debug","message":"Executing query [m8q5w97cfrv202xxnlu]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:32.376Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T16:51:32.378Z"}
{"level":"debug","message":"Executing query [m8q5w97ee0xetpbkrja]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:32.379Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T16:51:32.380Z"}
{"level":"debug","message":"Executing query [m8q5w97hx3932y2cmsk]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:32.381Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q5w97hx3932y2cmsk]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T16:51:32.383Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T16:51:32.383Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T16:51:32.384Z"}
{"level":"debug","message":"Executing query [m8q5w97l55hx2y85q2]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:32.385Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q5w97l55hx2y85q2]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T16:51:32.388Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T16:51:32.389Z"}
{"level":"debug","message":"Executing query [m8q5w97pow3oyh8vjqi]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:32.389Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q5w97pow3oyh8vjqi]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T16:51:32.391Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T16:51:32.391Z"}
{"level":"debug","message":"Executing query [m8q5w97rhzedwlg28u]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:32.391Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q5w97rhzedwlg28u]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T16:51:32.393Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T16:51:32.394Z"}
{"level":"debug","message":"Executing query [m8q5w97uo66qgf2gvgn]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:32.394Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q5w97uo66qgf2gvgn]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T16:51:32.396Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T16:51:32.396Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T16:51:32.396Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T16:51:32.397Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T16:51:32.398Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T16:51:32.398Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T16:51:32.398Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T16:51:32.398Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T16:51:32.398Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T16:51:32.399Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T16:51:32.399Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T16:51:32.399Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T16:51:32.399Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T16:51:32.399Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T16:51:32.399Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T16:51:32.399Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T16:51:32.400Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T16:51:32.400Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T16:51:32.400Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T16:51:32.400Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:51:32.402Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:32.180Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T16:51:32.435Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T16:51:32.461Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:32.574Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:32.649Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:32.626Z"}
{"level":"debug","message":"Executing query [m8q5w9g0h1ooul02z5b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:51:32.688Z"}
{"level":"debug","message":"Executing query [m8q5w9f2wi611758jb8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:51:32.654Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:51:32.760Z"}
{"level":"debug","message":"Executing query [m8q5w9i1tp4dfpqgzz]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:32.761Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q5w9i1tp4dfpqgzz]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T16:51:32.776Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T16:51:32.780Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:51:32.828Z"}
{"level":"debug","message":"Executing query [m8q5w9k05jaxuvh9d7s]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:32.833Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T16:51:32.838Z"}
{"level":"debug","message":"Executing query [m8q5w9k6dexuq82sdh]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T16:51:32.838Z"}
{"level":"debug","message":"Executing query [m8q5w9k9dkerjic1u6p]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T16:51:32.841Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T16:51:32.853Z"}
{"level":"debug","message":"Executing query [m8q5w9kmzv7mju6rkl]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:32.854Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T16:51:32.857Z"}
{"level":"debug","message":"Executing query [m8q5w9mnhpru87z3je6]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T16:51:32.927Z"}
{"level":"debug","message":"Executing query [m8q5w9njgxqoo6p2po]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T16:51:32.959Z"}
{"level":"debug","message":"Executing query [m8q5w9nprkbf8zhm2mo]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T16:51:32.965Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:32.892Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:51:33.060Z"}
{"level":"debug","message":"Executing query [m8q5w9qjqy48q8pco8m]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T16:51:33.068Z"}
{"level":"debug","message":"Executing query [m8q5w9qoqdcwh4l0r7e]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T16:51:33.073Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8q5w9qoqdcwh4l0r7e]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T16:51:33.076Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:51:33.079Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:33.036Z"}
{"level":"debug","message":"Executing query [m8q5w9rhn50n1dbykwg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:51:33.102Z"}
{"level":"debug","message":"Executing query [m8q5w9tal54ebshxdd]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:33.168Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:51:33.174Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q5w9tal54ebshxdd]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T16:51:33.177Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T16:51:33.178Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T16:51:33.282Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:33.527Z"}
{"level":"debug","message":"Executing query [m8q5wa3ety3aa3hzmro]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:51:33.531Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:51:33.613Z"}
{"level":"debug","message":"Executing query [m8q5wa5vyrj23k94hem]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743007893529\"]","timestamp":"2025-03-26T16:51:33.619Z"}
{"level":"debug","message":"Executing query [m8q5wa5ztw9dldir6p]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743007893529\",true]","timestamp":"2025-03-26T16:51:33.623Z"}
{"level":"debug","message":"Executing query [m8q5wa664pnlsirk1r3]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-26T16:51:33.630Z"}
{"level":"debug","message":"Executing query [m8q5wa6dm0aflf5668r]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743007893529\"]","timestamp":"2025-03-26T16:51:33.637Z"}
{"level":"debug","message":"Executing query [m8q5wa6g1cyhay5zreg]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",33]","timestamp":"2025-03-26T16:51:33.641Z"}
{"level":"debug","message":"Executing query [m8q5wa6mzzt97jpera]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-26T16:51:33.646Z"}
{"level":"debug","message":"Executing query [m8q5wa6p1nd0d9oziyd]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-26T16:51:33.649Z"}
{"level":"debug","message":"Executing query [m8q5wa6u82n2ljf7j1a]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-26T16:51:33.654Z"}
{"level":"debug","message":"Executing query [m8q5wa6x8iyd3fq5nrp]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-26T16:51:33.657Z"}
{"level":"debug","message":"Executing query [m8q5wa707n2tqak7l2b]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-26T16:51:33.660Z"}
{"level":"debug","message":"Executing query [m8q5wa73a9m9c1qxhak]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-26T16:51:33.663Z"}
{"level":"debug","message":"Executing query [m8q5wa75n99r8ecpql9]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T16:51:33.665Z"}
{"level":"debug","message":"Executing query [m8q5wa772a0agxzgdbs]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T16:51:33.667Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:51:33.669Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:33.719Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T16:51:33.285Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T16:51:33.286Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T16:51:33.287Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T16:51:33.287Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T16:51:33.287Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Executing query [m8q5wa8zb1daiw3qwg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:51:33.731Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:51:33.752Z"}
{"level":"debug","message":"Executing query [m8q5wa9qs3lomasd97]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:33.758Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:33.603Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q5wa9qs3lomasd97]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T16:51:33.773Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T16:51:33.773Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:33.859Z"}
{"level":"debug","message":"Executing query [m8q5waeqzzbvcn8ml3]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:51:33.938Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:51:34.012Z"}
{"level":"debug","message":"Executing query [m8q5wagvygkq1ws3phf]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:34.015Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q5wagvygkq1ws3phf]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T16:51:34.017Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T16:51:34.017Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:34.098Z"}
{"level":"debug","message":"Executing query [m8q5wakq3mtwtwwbz4w]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:51:34.155Z"}
{"level":"debug","message":"Executing query [m8q5wam9zhd955wrduj]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:34.209Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:51:34.212Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q5wam9zhd955wrduj]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T16:51:34.213Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T16:51:34.214Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:34.209Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:34.229Z"}
{"level":"debug","message":"Executing query [m8q5wamv5ue7y4af9]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:34.232Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:51:34.263Z"}
{"level":"debug","message":"Executing query [m8q5wanwv48nzjadjfr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T16:51:34.268Z"}
{"level":"debug","message":"Executing query [m8q5wanxqkdi7tegn8h]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T16:51:34.269Z"}
{"level":"debug","message":"Executing query [m8q5wanzioei1s77rb]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T16:51:34.271Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T16:51:34.274Z"}
{"level":"debug","message":"Executing query [m8q5wao38zvbm6irbs6]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T16:51:34.275Z"}
{"level":"debug","message":"Executing query [m8q5wao4p152fhj877j]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T16:51:34.276Z"}
{"level":"debug","message":"Executing query [m8q5wao71q9wqb65ph]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T16:51:34.279Z"}
{"level":"debug","message":"Executing query [m8q5wao8x343cn2lod]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T16:51:34.280Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T16:51:34.286Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T16:51:34.287Z"}
{"level":"debug","message":"Executing query [m8q5waofk8n3ratpaxd]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T16:51:34.287Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8q5waofk8n3ratpaxd]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T16:51:34.288Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T16:51:34.289Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T16:51:34.289Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T16:51:34.291Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T16:51:34.292Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T16:51:34.293Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T16:51:34.294Z"}
{"level":"debug","message":"Executing query [m8q5waon8awwelradnn]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T16:51:34.295Z"}
{"level":"debug","message":"Executing query [m8q5waoosb9z05mkzf]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T16:51:34.296Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T16:51:34.298Z"}
{"level":"debug","message":"Executing query [m8q5waoqadjc5mpwfd5]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T16:51:34.298Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:51:34.300Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:34.179Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T16:51:34.559Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T16:51:34.578Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:51:34.872Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T16:51:34.891Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:51:34.971Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:35.185Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T16:51:35.420Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:51:35.500Z"}
{"level":"debug","message":"Executing query [m8q5wbnbwsxz40tc46]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T16:51:35.543Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q5wbnbwsxz40tc46]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T16:51:35.545Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T16:51:35.548Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:51:35.579Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:36.205Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T16:51:36.239Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T16:51:36.384Z"}
{"duration":"27ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T16:51:36.388Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:51:36.397Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T16:51:36.399Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T16:51:36.392Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T16:51:36.398Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:08:39.641Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:08:39.656Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:08:39.663Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:08:39.665Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:08:39.668Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:08:39.670Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:08:39.673Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T17:08:39.679Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T17:08:39.682Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T17:08:39.687Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T17:08:39.689Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T17:08:39.740Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T17:08:39.754Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:39.798Z"}
{"level":"debug","message":"Executing query [m8q6ia0fl7cjtdsarm]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:08:39.856Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:08:39.925Z"}
{"level":"debug","message":"Executing query [m8q6ia2hsqscjbxrt9]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743008919852\"]","timestamp":"2025-03-26T17:08:39.929Z"}
{"level":"debug","message":"Executing query [m8q6ia3fzcnn065p4v]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743008919852\"]","timestamp":"2025-03-26T17:08:39.963Z"}
{"level":"debug","message":"Executing query [m8q6ia3k28ixr265yo7]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743008919852\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T17:08:39.968Z"}
{"level":"debug","message":"Executing query [m8q6ia3w4821ukl8j5x]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1032]","timestamp":"2025-03-26T17:08:39.980Z"}
{"level":"debug","message":"Executing query [m8q6ia404oky24bexze]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743008919852\"]","timestamp":"2025-03-26T17:08:39.985Z"}
{"level":"debug","message":"Executing query [m8q6ia45drq4ouwblhn]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1032]","timestamp":"2025-03-26T17:08:39.989Z"}
{"level":"debug","message":"Executing query [m8q6ia4a7l90pjvgpzs]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1032]","timestamp":"2025-03-26T17:08:39.994Z"}
{"level":"debug","message":"Executing query [m8q6ia4e6293iwzzdig]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1032]","timestamp":"2025-03-26T17:08:39.998Z"}
{"level":"debug","message":"Executing query [m8q6ia4j2e7w1hobsro]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1032]","timestamp":"2025-03-26T17:08:40.003Z"}
{"level":"debug","message":"Executing query [m8q6ia4mwboqywxeohn]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1032]","timestamp":"2025-03-26T17:08:40.006Z"}
{"level":"debug","message":"Executing query [m8q6ia4ony6ojzdye48]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1032]","timestamp":"2025-03-26T17:08:40.008Z"}
{"level":"debug","message":"Executing query [m8q6ia4s4tmgh5sh7tj]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1032]","timestamp":"2025-03-26T17:08:40.012Z"}
{"level":"debug","message":"Executing query [m8q6ia4u8n8ga6562s4]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T17:08:40.014Z"}
{"level":"debug","message":"Executing query [m8q6ia4wm5ao4rtnf7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T17:08:40.016Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:08:40.019Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T17:08:39.691Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:40.220Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:40.050Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:40.206Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:40.242Z"}
{"level":"debug","message":"Executing query [m8q6iabj9u1pah4f2qg]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.255Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:08:40.322Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T17:08:40.326Z"}
{"level":"debug","message":"Executing query [m8q6iadj1loxja76xx3]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.327Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T17:08:40.330Z"}
{"level":"debug","message":"Executing query [m8q6iadnlv56rafb8x8]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.331Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T17:08:40.333Z"}
{"level":"debug","message":"Executing query [m8q6iadquedo54hmn7c]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.334Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T17:08:40.340Z"}
{"level":"debug","message":"Executing query [m8q6iadxa51dzuwzdm5]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.341Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T17:08:40.343Z"}
{"level":"debug","message":"Executing query [m8q6iadz6iz4tid72hf]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.343Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8q6iadz6iz4tid72hf]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T17:08:40.346Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T17:08:40.346Z"}
{"level":"debug","message":"Executing query [m8q6iae23h2pxbhy6f1]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.346Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T17:08:40.348Z"}
{"level":"debug","message":"Executing query [m8q6iae41mpbnmmuxom]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.348Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T17:08:40.349Z"}
{"level":"debug","message":"Executing query [m8q6iae6v8xlwo7xyd]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.350Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q6iae6v8xlwo7xyd]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T17:08:40.352Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T17:08:40.352Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T17:08:40.352Z"}
{"level":"debug","message":"Executing query [m8q6iaea2itmb7vne7o]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.354Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q6iaea2itmb7vne7o]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T17:08:40.355Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T17:08:40.356Z"}
{"level":"debug","message":"Executing query [m8q6iaecrzbrg14hblf]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.356Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q6iaecrzbrg14hblf]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T17:08:40.358Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T17:08:40.358Z"}
{"level":"debug","message":"Executing query [m8q6iaeetljeqe2dpni]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.358Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q6iaeetljeqe2dpni]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T17:08:40.359Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T17:08:40.360Z"}
{"level":"debug","message":"Executing query [m8q6iaeg0p1mtlu00uq]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.360Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q6iaeg0p1mtlu00uq]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T17:08:40.361Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T17:08:40.361Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T17:08:40.362Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T17:08:40.363Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T17:08:40.363Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T17:08:40.363Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T17:08:40.363Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T17:08:40.364Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T17:08:40.364Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T17:08:40.364Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T17:08:40.364Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T17:08:40.364Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T17:08:40.364Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T17:08:40.364Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T17:08:40.364Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T17:08:40.365Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T17:08:40.365Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T17:08:40.365Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T17:08:40.365Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T17:08:40.365Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:08:40.367Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:40.324Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:08:40.388Z"}
{"level":"debug","message":"Executing query [m8q6iafml4dznn2ipm]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T17:08:40.402Z"}
{"level":"debug","message":"Executing query [m8q6iafplas4phy8mam]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T17:08:40.406Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8q6iafplas4phy8mam]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T17:08:40.410Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:08:40.413Z"}
{"level":"debug","message":"Executing query [m8q6iaey3ylj24i5vpk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:08:40.379Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:08:40.431Z"}
{"level":"debug","message":"Executing query [m8q6iagnuydsmj0bifh]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.439Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T17:08:40.445Z"}
{"level":"debug","message":"Executing query [m8q6iagum5m9z3rnawo]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T17:08:40.446Z"}
{"level":"debug","message":"Executing query [m8q6iagw4peahkie6ho]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T17:08:40.449Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T17:08:40.451Z"}
{"level":"debug","message":"Executing query [m8q6iah0jcub8h4j05p]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.452Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T17:08:40.454Z"}
{"level":"debug","message":"Executing query [m8q6iaj0d5w83ihvkzj]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T17:08:40.524Z"}
{"level":"debug","message":"Executing query [m8q6iaj5pl9epkhnqvh]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T17:08:40.530Z"}
{"level":"debug","message":"Executing query [m8q6iaj9t645m3ug5h]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T17:08:40.533Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T17:08:40.489Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:40.646Z"}
{"level":"debug","message":"Executing query [m8q6ianx8n8jmdkbn09]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:08:40.702Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:08:40.764Z"}
{"level":"debug","message":"Executing query [m8q6iaprl4jdu5m8hyr]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.767Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q6iaprl4jdu5m8hyr]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T17:08:40.770Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:08:40.771Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T17:08:40.713Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:40.849Z"}
{"level":"debug","message":"Executing query [m8q6iascrbwwtepu9a]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:08:40.860Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:08:40.912Z"}
{"level":"debug","message":"Executing query [m8q6iatv1zqftfcr4p3]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:40.915Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q6iatv1zqftfcr4p3]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T17:08:40.917Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:08:40.918Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T17:08:40.984Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T17:08:40.985Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T17:08:40.986Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T17:08:40.986Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T17:08:40.987Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T17:08:40.987Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:41.517Z"}
{"level":"debug","message":"Executing query [m8q6ibaoi7fdj86dra]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:08:41.521Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:08:41.576Z"}
{"level":"debug","message":"Executing query [m8q6ibcc2p18x0n5dat]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:41.580Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q6ibcc2p18x0n5dat]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T17:08:41.583Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:08:41.584Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:41.589Z"}
{"level":"debug","message":"Executing query [m8q6ibdkhomxw0bvy9]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:08:41.624Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:08:41.727Z"}
{"level":"debug","message":"Executing query [m8q6ibgm0woix78wo7la]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743008921623\"]","timestamp":"2025-03-26T17:08:41.734Z"}
{"level":"debug","message":"Executing query [m8q6ibgpdzy4njpdrkw]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743008921623\",true]","timestamp":"2025-03-26T17:08:41.737Z"}
{"level":"debug","message":"Executing query [m8q6ibgyrlcxy4w1gf]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[34]","timestamp":"2025-03-26T17:08:41.746Z"}
{"level":"debug","message":"Executing query [m8q6ibh4htmsgnv00m8]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743008921623\"]","timestamp":"2025-03-26T17:08:41.752Z"}
{"level":"debug","message":"Executing query [m8q6ibh6skpaden99]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",34]","timestamp":"2025-03-26T17:08:41.754Z"}
{"level":"debug","message":"Executing query [m8q6ibhbv3ma26clvgr]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[34]","timestamp":"2025-03-26T17:08:41.759Z"}
{"level":"debug","message":"Executing query [m8q6ibheyprge0c9es8]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[34]","timestamp":"2025-03-26T17:08:41.762Z"}
{"level":"debug","message":"Executing query [m8q6ibhim0744d158k]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[34]","timestamp":"2025-03-26T17:08:41.766Z"}
{"level":"debug","message":"Executing query [m8q6ibhl8alnqjj853a]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[34]","timestamp":"2025-03-26T17:08:41.769Z"}
{"level":"debug","message":"Executing query [m8q6ibho6ejybdyntrn]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[34]","timestamp":"2025-03-26T17:08:41.772Z"}
{"level":"debug","message":"Executing query [m8q6ibhslx2awnmac0k]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[34]","timestamp":"2025-03-26T17:08:41.776Z"}
{"level":"debug","message":"Executing query [m8q6ibhut56t4h8e06]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T17:08:41.779Z"}
{"level":"debug","message":"Executing query [m8q6ibhxg6ozkl0gai]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T17:08:41.781Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:08:41.784Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:41.674Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:41.911Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:41.860Z"}
{"level":"debug","message":"Executing query [m8q6iblty3j47z9bjz]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:08:41.921Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:08:41.976Z"}
{"level":"debug","message":"Executing query [m8q6ibnfvpviw2ds1xe]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:41.979Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q6ibnfvpviw2ds1xe]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T17:08:41.982Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:08:41.982Z"}
{"level":"debug","message":"Executing query [m8q6iblwdtzit2svlue]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:08:41.924Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:08:42.018Z"}
{"level":"debug","message":"Executing query [m8q6ibonq3up07733mg]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:42.023Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q6ibonq3up07733mg]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T17:08:42.025Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:08:42.026Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:41.663Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T17:08:42.086Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T17:08:42.106Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:42.359Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:42.381Z"}
{"level":"debug","message":"Executing query [m8q6ibyo8g1ddqlc8z]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:42.384Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:08:42.392Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:08:42.413Z"}
{"level":"debug","message":"Executing query [m8q6ibzj24ltz2de9uf]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:08:42.415Z"}
{"level":"debug","message":"Executing query [m8q6ibzk4ll3nnuxmtw]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T17:08:42.416Z"}
{"level":"debug","message":"Executing query [m8q6ibzm8ybbcjvo7jy]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T17:08:42.418Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T17:08:42.420Z"}
{"level":"debug","message":"Executing query [m8q6ibzowc8nlkpl5ul]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T17:08:42.420Z"}
{"level":"debug","message":"Executing query [m8q6ibzp5jrjllrhkb5]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T17:08:42.421Z"}
{"level":"debug","message":"Executing query [m8q6ibzszs4c4oddyp]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T17:08:42.424Z"}
{"level":"debug","message":"Executing query [m8q6ibzt9drz9d84miu]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T17:08:42.425Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T17:08:42.430Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T17:08:42.431Z"}
{"level":"debug","message":"Executing query [m8q6ibzz3how96mwwi6]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T17:08:42.431Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8q6ibzz3how96mwwi6]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T17:08:42.433Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T17:08:42.433Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T17:08:42.434Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T17:08:42.435Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T17:08:42.436Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T17:08:42.437Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T17:08:42.437Z"}
{"level":"debug","message":"Executing query [m8q6ic061u5u6gljwje]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T17:08:42.438Z"}
{"level":"debug","message":"Executing query [m8q6ic094lok82mu5hw]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T17:08:42.441Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T17:08:42.442Z"}
{"level":"debug","message":"Executing query [m8q6ic0a404kb9tx4mc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T17:08:42.442Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T17:08:42.443Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:08:42.443Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:08:42.539Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:42.934Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T17:08:43.132Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:08:43.257Z"}
{"level":"debug","message":"Executing query [m8q6ico20sn121cpy5nm]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T17:08:43.299Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q6ico20sn121cpy5nm]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T17:08:43.302Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T17:08:43.305Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:08:43.331Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:43.979Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:08:44.041Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:08:44.160Z"}
{"duration":"27ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T17:08:44.164Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T17:08:44.162Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:08:44.165Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T17:08:44.169Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:08:44.173Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:36:27.050Z"}
{"fatal":true,"level":"error","message":"Error al conectar a la base de datos: Encoding not recognized: 'cesu8' (searched as: 'cesu8')","stack":"Error: Encoding not recognized: 'cesu8' (searched as: 'cesu8')\n    at Object.getCodec (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:104:23)\n    at Object.getDecoder (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:125:23)\n    at Object.<anonymous>.exports.decode (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\parsers\\string.js:20:23)\n    at Packet.readNullTerminatedString (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\packet.js:414:25)\n    at Function.fromPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\handshake.js:62:33)\n    at ClientHandshake.handshakeInit (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\client_handshake.js:112:40)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:45:22)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T17:36:27.280Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:39:53.021Z"}
{"fatal":true,"level":"error","message":"Error al conectar a la base de datos: Encoding not recognized: 'cesu8' (searched as: 'cesu8')","stack":"Error: Encoding not recognized: 'cesu8' (searched as: 'cesu8')\n    at Object.getCodec (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:104:23)\n    at Object.getDecoder (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:125:23)\n    at Object.<anonymous>.exports.decode (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\parsers\\string.js:20:23)\n    at Packet.readNullTerminatedString (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\packet.js:414:25)\n    at Function.fromPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\handshake.js:62:33)\n    at ClientHandshake.handshakeInit (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\client_handshake.js:112:40)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:45:22)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T17:39:53.326Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:40:17.636Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:40:17.647Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:40:17.651Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:40:17.659Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:40:17.663Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:40:17.668Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:40:17.672Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T17:40:17.677Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T17:40:17.679Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T17:40:17.683Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T17:40:17.684Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T17:40:17.686Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:17.735Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T17:40:17.810Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T17:40:17.831Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Executing query [m8q7myh4lmd1bn0sh5o]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:40:17.800Z"}
{"level":"debug","message":"Executing query [m8q7myj8n3i95c0uxb]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743010817794\"]","timestamp":"2025-03-26T17:40:17.876Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:40:17.879Z"}
{"level":"debug","message":"Executing query [m8q7myjvqv12fqeheni]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743010817794\"]","timestamp":"2025-03-26T17:40:17.899Z"}
{"level":"debug","message":"Executing query [m8q7myk2pmwvzfwa8op]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743010817794\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T17:40:17.906Z"}
{"level":"debug","message":"Executing query [m8q7mykgpscochzuaa]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1033]","timestamp":"2025-03-26T17:40:17.920Z"}
{"level":"debug","message":"Executing query [m8q7mykmakuordvo9ms]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743010817794\"]","timestamp":"2025-03-26T17:40:17.926Z"}
{"level":"debug","message":"Executing query [m8q7mykuqm0z0y7wokh]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1033]","timestamp":"2025-03-26T17:40:17.934Z"}
{"level":"debug","message":"Executing query [m8q7myl15hgal2o3tm3]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1033]","timestamp":"2025-03-26T17:40:17.941Z"}
{"level":"debug","message":"Executing query [m8q7myl7mxxdixbait]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1033]","timestamp":"2025-03-26T17:40:17.947Z"}
{"level":"debug","message":"Executing query [m8q7myle7xprdvvj5fh]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1033]","timestamp":"2025-03-26T17:40:17.954Z"}
{"level":"debug","message":"Executing query [m8q7myliy41fjk1efgi]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1033]","timestamp":"2025-03-26T17:40:17.958Z"}
{"level":"debug","message":"Executing query [m8q7mylm9ixzec5wssj]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1033]","timestamp":"2025-03-26T17:40:17.962Z"}
{"level":"debug","message":"Executing query [m8q7mylrbc4dxtsa73j]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1033]","timestamp":"2025-03-26T17:40:17.967Z"}
{"level":"debug","message":"Executing query [m8q7myltdm656qb9msi]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T17:40:17.969Z"}
{"level":"debug","message":"Executing query [m8q7mylw69taathvk1f]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T17:40:17.972Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:40:17.976Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:18.102Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:18.308Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:18.353Z"}
{"level":"debug","message":"Executing query [m8q7mywtqtqwoxop9z]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:18.365Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:40:18.456Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T17:40:18.472Z"}
{"level":"debug","message":"Executing query [m8q7myzusppurrtmcrf]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:18.475Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T17:40:18.477Z"}
{"level":"debug","message":"Executing query [m8q7myzywmke7uwi9o]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:18.478Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T17:40:18.481Z"}
{"level":"debug","message":"Executing query [m8q7mz02s2j1ao90sl]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:18.482Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T17:40:18.484Z"}
{"level":"debug","message":"Executing query [m8q7mz05beb4uy3t65k]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:18.485Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T17:40:18.486Z"}
{"level":"debug","message":"Executing query [m8q7mz07m1bb7ub6n2a]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:18.487Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8q7mz07m1bb7ub6n2a]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T17:40:18.490Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T17:40:18.491Z"}
{"level":"debug","message":"Executing query [m8q7mz0bk0tj3h25raf]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:18.491Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T17:40:18.493Z"}
{"level":"debug","message":"Executing query [m8q7mz0d23n1dxn38sk]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:18.493Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T17:40:18.496Z"}
{"level":"debug","message":"Executing query [m8q7mz0gn6qpslzdgt]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:18.496Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q7mz0gn6qpslzdgt]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T17:40:18.498Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T17:40:18.499Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T17:40:18.499Z"}
{"level":"debug","message":"Executing query [m8q7mz0l4zvunembwpd]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:18.501Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q7mz0l4zvunembwpd]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T17:40:18.503Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:18.450Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T17:40:18.504Z"}
{"level":"debug","message":"Executing query [m8q7mz0o1r81q2q1a9a]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:18.504Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q7mz0o1r81q2q1a9a]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T17:40:18.505Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T17:40:18.506Z"}
{"level":"debug","message":"Executing query [m8q7mz0qt89cajcw4bi]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:18.506Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q7mz0qt89cajcw4bi]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T17:40:18.508Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T17:40:18.509Z"}
{"level":"debug","message":"Executing query [m8q7mz0toeyohpcs5ys]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:18.509Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q7mz0toeyohpcs5ys]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T17:40:18.511Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:40:18.512Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T17:40:18.512Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T17:40:18.512Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T17:40:18.513Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T17:40:18.513Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T17:40:18.513Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T17:40:18.513Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T17:40:18.514Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T17:40:18.514Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T17:40:18.514Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T17:40:18.514Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T17:40:18.515Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T17:40:18.515Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T17:40:18.515Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T17:40:18.515Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T17:40:18.515Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T17:40:18.515Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T17:40:18.516Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T17:40:18.516Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T17:40:18.516Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:40:18.518Z"}
{"level":"debug","message":"Executing query [m8q7mz156zuknii2yw9]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T17:40:18.523Z"}
{"level":"debug","message":"Executing query [m8q7mz1argqu9abgmnd]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T17:40:18.526Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8q7mz1argqu9abgmnd]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T17:40:18.531Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:40:18.533Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T17:40:18.707Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T17:40:18.856Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:19.037Z"}
{"level":"debug","message":"Executing query [m8q7mzfmjx39swgw4v9]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:40:19.042Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:40:19.085Z"}
{"level":"debug","message":"Executing query [m8q7mzgv7pgczq9i1jx]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:19.087Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q7mzgv7pgczq9i1jx]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T17:40:19.090Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:40:19.091Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:19.078Z"}
{"level":"debug","message":"Executing query [m8q7mzirs0bqsc30sjs]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:40:19.155Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:40:19.228Z"}
{"level":"debug","message":"Executing query [m8q7mzkyn977hc88y8h]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:19.234Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T17:40:19.240Z"}
{"level":"debug","message":"Executing query [m8q7mzl50jl23r1jfwqr]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T17:40:19.241Z"}
{"level":"debug","message":"Executing query [m8q7mzlbopja2e9979]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T17:40:19.247Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T17:40:19.250Z"}
{"level":"debug","message":"Executing query [m8q7mzledfe3dkkv0ff]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:19.250Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T17:40:19.253Z"}
{"level":"debug","message":"Executing query [m8q7mzngej08m17iuje]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T17:40:19.324Z"}
{"level":"debug","message":"Executing query [m8q7mznn5bl49r7bl0o]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T17:40:19.331Z"}
{"level":"debug","message":"Executing query [m8q7mznpnivwaou938b]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T17:40:19.333Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:19.321Z"}
{"level":"debug","message":"Executing query [m8q7mznpwh0xi8wcyc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:40:19.333Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:40:19.373Z"}
{"level":"debug","message":"Executing query [m8q7mzozk3qntjygwaj]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:19.379Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q7mzozk3qntjygwaj]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T17:40:19.382Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:40:19.383Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T17:40:19.782Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T17:40:19.783Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T17:40:19.783Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T17:40:19.783Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T17:40:19.784Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T17:40:19.784Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:20.084Z"}
{"level":"debug","message":"Executing query [m8q7n08ozuuz0z8cci]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:40:20.088Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:40:20.103Z"}
{"level":"debug","message":"Executing query [m8q7n097zrb6bl1johh]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743010820087\"]","timestamp":"2025-03-26T17:40:20.107Z"}
{"level":"debug","message":"Executing query [m8q7n09apqplqrrc6x]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743010820087\",true]","timestamp":"2025-03-26T17:40:20.110Z"}
{"level":"debug","message":"Executing query [m8q7n09gb3mjy9212rs]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-26T17:40:20.116Z"}
{"level":"debug","message":"Executing query [m8q7n09j7bwubua125n]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743010820087\"]","timestamp":"2025-03-26T17:40:20.119Z"}
{"level":"debug","message":"Executing query [m8q7n09m2jsggdbqtts]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",35]","timestamp":"2025-03-26T17:40:20.122Z"}
{"level":"debug","message":"Executing query [m8q7n09qmrni0knjhc]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-26T17:40:20.126Z"}
{"level":"debug","message":"Executing query [m8q7n09tog5qksenlgk]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-26T17:40:20.129Z"}
{"level":"debug","message":"Executing query [m8q7n09x2uoo47ruzm]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-26T17:40:20.133Z"}
{"level":"debug","message":"Executing query [m8q7n0a0416xrescecq]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-26T17:40:20.136Z"}
{"level":"debug","message":"Executing query [m8q7n0a2h7xbga2uhu]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-26T17:40:20.138Z"}
{"level":"debug","message":"Executing query [m8q7n0a6wta20s4cybo]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-26T17:40:20.142Z"}
{"level":"debug","message":"Executing query [m8q7n0a8mgb9jkon92r]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T17:40:20.144Z"}
{"level":"debug","message":"Executing query [m8q7n0a9e5smlgzn0an]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T17:40:20.145Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:40:20.146Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:20.446Z"}
{"level":"debug","message":"Executing query [m8q7n0iq7qpssq87gy4]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:40:20.450Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:40:20.481Z"}
{"level":"debug","message":"Executing query [m8q7n0jnjulvp37rur]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:20.483Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q7n0jnjulvp37rur]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T17:40:20.486Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:40:20.487Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:20.469Z"}
{"level":"debug","message":"Executing query [m8q7n0kpj8nwhefnm2]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:40:20.521Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:40:20.574Z"}
{"level":"debug","message":"Executing query [m8q7n0mcz818cm40th]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:20.580Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q7n0mcz818cm40th]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T17:40:20.584Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:40:20.585Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:20.088Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T17:40:20.451Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T17:40:20.484Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:40:20.827Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T17:40:20.893Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:20.900Z"}
{"level":"debug","message":"Executing query [m8q7n0vd3x0hziicl3x]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:40:20.905Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:40:20.931Z"}
{"level":"debug","message":"Executing query [m8q7n0w5im37j768qj]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:20.933Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q7n0w5im37j768qj]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T17:40:20.935Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:40:20.935Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:40:21.004Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:20.987Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:21.576Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:21.588Z"}
{"level":"debug","message":"Executing query [m8q7n1ef68r78j6n9v]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:21.591Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:40:21.610Z"}
{"level":"debug","message":"Executing query [m8q7n1f5glg6p6n19y4]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:40:21.617Z"}
{"level":"debug","message":"Executing query [m8q7n1f7255wnqv2pu6]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T17:40:21.619Z"}
{"level":"debug","message":"Executing query [m8q7n1f9eczv4rlxiv6]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T17:40:21.621Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T17:40:21.623Z"}
{"level":"debug","message":"Executing query [m8q7n1fb8zgvhon0i4d]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T17:40:21.623Z"}
{"level":"debug","message":"Executing query [m8q7n1ffsqvbtdlj0yp]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T17:40:21.627Z"}
{"level":"debug","message":"Executing query [m8q7n1fh317jm4euut2]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T17:40:21.629Z"}
{"level":"debug","message":"Executing query [m8q7n1fjjwf62uye98l]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T17:40:21.631Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T17:40:21.644Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T17:40:21.645Z"}
{"level":"debug","message":"Executing query [m8q7n1fxljj90sjwh0h]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T17:40:21.645Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8q7n1fxljj90sjwh0h]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T17:40:21.649Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T17:40:21.650Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T17:40:21.650Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T17:40:21.652Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T17:40:21.653Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T17:40:21.655Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T17:40:21.656Z"}
{"level":"debug","message":"Executing query [m8q7n1g9k9mp0wlqjaq]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T17:40:21.657Z"}
{"level":"debug","message":"Executing query [m8q7n1gcial8se2s9i]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T17:40:21.660Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T17:40:21.662Z"}
{"level":"debug","message":"Executing query [m8q7n1ge2ws1kaioipr]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T17:40:21.662Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:40:21.664Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:22.156Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T17:40:22.434Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:40:22.528Z"}
{"level":"debug","message":"Executing query [m8q7n26buymxxvzhqfa]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T17:40:22.595Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q7n26buymxxvzhqfa]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T17:40:22.602Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T17:40:22.606Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:40:22.643Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:22.534Z"}
{"fatal":true,"level":"error","message":"Error al conectar a la base de datos: Encoding not recognized: 'cesu8' (searched as: 'cesu8')","stack":"Error: Encoding not recognized: 'cesu8' (searched as: 'cesu8')\n    at Object.getCodec (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:104:23)\n    at Object.getDecoder (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:125:23)\n    at Object.<anonymous>.exports.decode (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\parsers\\string.js:20:23)\n    at Packet.readNullTerminatedString (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\packet.js:414:25)\n    at Function.fromPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\handshake.js:62:33)\n    at ClientHandshake.handshakeInit (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\client_handshake.js:112:40)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:45:22)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T17:40:22.741Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:22.972Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:40:23.228Z"}
{"duration":"33ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T17:40:23.232Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T17:40:23.238Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:40:23.243Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:23.411Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:40:23.583Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T17:40:23.587Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:40:57.461Z"}
{"fatal":true,"level":"error","message":"Error al conectar a la base de datos: Encoding not recognized: 'cesu8' (searched as: 'cesu8')","stack":"Error: Encoding not recognized: 'cesu8' (searched as: 'cesu8')\n    at Object.getCodec (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:104:23)\n    at Object.getDecoder (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:125:23)\n    at Object.<anonymous>.exports.decode (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\parsers\\string.js:20:23)\n    at Packet.readNullTerminatedString (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\packet.js:414:25)\n    at Function.fromPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\handshake.js:62:33)\n    at ClientHandshake.handshakeInit (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\client_handshake.js:112:40)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:45:22)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T17:40:57.718Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:41:56.872Z"}
{"fatal":true,"level":"error","message":"Error al conectar a la base de datos: Encoding not recognized: 'cesu8' (searched as: 'cesu8')","stack":"Error: Encoding not recognized: 'cesu8' (searched as: 'cesu8')\n    at Object.getCodec (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:104:23)\n    at Object.getDecoder (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:125:23)\n    at Object.<anonymous>.exports.decode (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\parsers\\string.js:20:23)\n    at Packet.readNullTerminatedString (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\packet.js:414:25)\n    at Function.fromPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\handshake.js:62:33)\n    at ClientHandshake.handshakeInit (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\client_handshake.js:112:40)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:45:22)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T17:41:57.229Z"}
{"level":"info","message":"Created upload directory: D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\uploads","timestamp":"2025-03-26T17:47:36.664Z"}
{"level":"info","message":"Created upload directory: D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\uploads\\documents","timestamp":"2025-03-26T17:47:36.668Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:53:35.091Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:53:35.104Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:53:35.108Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:53:35.111Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:53:35.115Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:53:35.122Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:53:35.125Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T17:53:35.134Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T17:53:35.136Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T17:53:35.139Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T17:53:35.141Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T17:53:35.143Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T17:53:35.161Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T17:53:35.185Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:35.328Z"}
{"level":"debug","message":"Executing query [m8q841wqcdzwkh2n8u]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:53:35.403Z"}
{"level":"debug","message":"Executing query [m8q841ywyh2f8ebcfs]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743011615394\"]","timestamp":"2025-03-26T17:53:35.480Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:53:35.484Z"}
{"level":"debug","message":"Executing query [m8q841znolizsxt8aw]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743011615394\"]","timestamp":"2025-03-26T17:53:35.507Z"}
{"level":"debug","message":"Executing query [m8q841zr3kgkfc0nb3v]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743011615394\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T17:53:35.511Z"}
{"level":"debug","message":"Executing query [m8q84204e91np5l50kj]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1034]","timestamp":"2025-03-26T17:53:35.524Z"}
{"level":"debug","message":"Executing query [m8q8420apdbpe18m959]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743011615394\"]","timestamp":"2025-03-26T17:53:35.530Z"}
{"level":"debug","message":"Executing query [m8q8420fozt2ckslntj]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1034]","timestamp":"2025-03-26T17:53:35.535Z"}
{"level":"debug","message":"Executing query [m8q8420mq5ebm4yxhfb]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1034]","timestamp":"2025-03-26T17:53:35.543Z"}
{"level":"debug","message":"Executing query [m8q8420rs4yat8jbh6e]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1034]","timestamp":"2025-03-26T17:53:35.547Z"}
{"level":"debug","message":"Executing query [m8q8420v4mxg2gjgmpr]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1034]","timestamp":"2025-03-26T17:53:35.552Z"}
{"level":"debug","message":"Executing query [m8q84210p5vkm72ow3]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1034]","timestamp":"2025-03-26T17:53:35.556Z"}
{"level":"debug","message":"Executing query [m8q84213qki7se5bko]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1034]","timestamp":"2025-03-26T17:53:35.559Z"}
{"level":"debug","message":"Executing query [m8q84217hxckew74jeo]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1034]","timestamp":"2025-03-26T17:53:35.563Z"}
{"level":"debug","message":"Executing query [m8q8421byo3y1e3imng]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T17:53:35.567Z"}
{"level":"debug","message":"Executing query [m8q8421enskeak3nlp9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T17:53:35.571Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:53:35.578Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:35.411Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:35.798Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:35.826Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:35.864Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:53:35.924Z"}
{"level":"debug","message":"Executing query [m8q842bf58nn31n1v2]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T17:53:35.931Z"}
{"level":"debug","message":"Executing query [m8q842bipk96iv9icl]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T17:53:35.934Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8q842bipk96iv9icl]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T17:53:35.938Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:53:35.940Z"}
{"level":"debug","message":"Executing query [m8q842axri9kdqsj5s]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:53:35.914Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:53:35.957Z"}
{"level":"debug","message":"Executing query [m8q842c7y58bngqdrpq]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:35.959Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T17:53:35.962Z"}
{"level":"debug","message":"Executing query [m8q842cac6ahqsfoleq]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T17:53:35.962Z"}
{"level":"debug","message":"Executing query [m8q842cd7km5lq0nzbs]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T17:53:35.965Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T17:53:35.967Z"}
{"level":"debug","message":"Executing query [m8q842cf22paa33gd56]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:35.967Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T17:53:35.969Z"}
{"level":"debug","message":"Executing query [m8q842egrfmi8ep3oy]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T17:53:36.041Z"}
{"level":"debug","message":"Executing query [m8q842emn1uy45qtdgd]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T17:53:36.046Z"}
{"level":"debug","message":"Executing query [m8q842eqkozvruaje1d]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T17:53:36.050Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:36.405Z"}
{"level":"debug","message":"Executing query [m8q842ppxr06azcubf]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:36.445Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:53:36.515Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T17:53:36.523Z"}
{"level":"debug","message":"Executing query [m8q842rwsytq5r3apdo]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:36.524Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T17:53:36.527Z"}
{"level":"debug","message":"Executing query [m8q842s0kkpl1zemkbh]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:36.528Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T17:53:36.530Z"}
{"level":"debug","message":"Executing query [m8q842s37eza4w75uur]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:36.531Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T17:53:36.533Z"}
{"level":"debug","message":"Executing query [m8q842s6zyrrh1nep2p]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:36.534Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T17:53:36.536Z"}
{"level":"debug","message":"Executing query [m8q842s8e5v4f5ces1l]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:36.536Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8q842s8e5v4f5ces1l]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T17:53:36.541Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T17:53:36.542Z"}
{"level":"debug","message":"Executing query [m8q842sed3vvq1lbpst]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:36.542Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T17:53:36.544Z"}
{"level":"debug","message":"Executing query [m8q842sg8n0dezt52xg]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:36.544Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T17:53:36.546Z"}
{"level":"debug","message":"Executing query [m8q842sir67olwj5hpc]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:36.547Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q842sir67olwj5hpc]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T17:53:36.549Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T17:53:36.549Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T17:53:36.549Z"}
{"level":"debug","message":"Executing query [m8q842sn5nbzzfeacxf]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:36.552Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q842sn5nbzzfeacxf]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T17:53:36.555Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T17:53:36.556Z"}
{"level":"debug","message":"Executing query [m8q842sswsoj1a4bnrh]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:36.556Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q842sswsoj1a4bnrh]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T17:53:36.558Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T17:53:36.558Z"}
{"level":"debug","message":"Executing query [m8q842su7h8vctb1d0v]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:36.558Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q842su7h8vctb1d0v]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T17:53:36.560Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T17:53:36.561Z"}
{"level":"debug","message":"Executing query [m8q842sx5mijeupt56k]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:36.561Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q842sx5mijeupt56k]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T17:53:36.563Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T17:53:36.563Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T17:53:36.564Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T17:53:36.565Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T17:53:36.565Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T17:53:36.565Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T17:53:36.565Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T17:53:36.565Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T17:53:36.566Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T17:53:36.566Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T17:53:36.566Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T17:53:36.566Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T17:53:36.566Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T17:53:36.566Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T17:53:36.566Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T17:53:36.567Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T17:53:36.567Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T17:53:36.567Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T17:53:36.567Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T17:53:36.567Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:53:36.569Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T17:53:36.690Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:36.769Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T17:53:36.716Z"}
{"level":"debug","message":"Executing query [m8q842zue6rqkbdu6h]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:53:36.810Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:53:36.853Z"}
{"level":"debug","message":"Executing query [m8q84314tcbgb8vilio]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:36.856Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q84314tcbgb8vilio]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T17:53:36.858Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:53:36.858Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:37.020Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T17:53:37.359Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T17:53:37.386Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:53:37.662Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T17:53:37.692Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:53:37.756Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:37.905Z"}
{"level":"debug","message":"Executing query [m8q843v93uiuc71qjx9]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:53:37.941Z"}
{"level":"debug","message":"Executing query [m8q843x121hvyfnz1b]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:38.005Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:53:38.008Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q843x121hvyfnz1b]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T17:53:38.010Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:53:38.011Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T17:53:38.186Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T17:53:38.187Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T17:53:38.187Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T17:53:38.188Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T17:53:38.188Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T17:53:38.188Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:38.688Z"}
{"level":"debug","message":"Executing query [m8q844g3on9mq03h07o]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:53:38.691Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:53:38.709Z"}
{"level":"debug","message":"Executing query [m8q844gnnc1d8tvpok]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743011618690\"]","timestamp":"2025-03-26T17:53:38.711Z"}
{"level":"debug","message":"Executing query [m8q844gqujqxhxrwcfc]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743011618690\",true]","timestamp":"2025-03-26T17:53:38.714Z"}
{"level":"debug","message":"Executing query [m8q844gv5v7dzowfqaq]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[36]","timestamp":"2025-03-26T17:53:38.719Z"}
{"level":"debug","message":"Executing query [m8q844h1xx4srlgv7s]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743011618690\"]","timestamp":"2025-03-26T17:53:38.725Z"}
{"level":"debug","message":"Executing query [m8q844h37aho2o1wbx5]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",36]","timestamp":"2025-03-26T17:53:38.727Z"}
{"level":"debug","message":"Executing query [m8q844h7tscl3i5tdpl]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[36]","timestamp":"2025-03-26T17:53:38.731Z"}
{"level":"debug","message":"Executing query [m8q844h9z35gek59jx]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[36]","timestamp":"2025-03-26T17:53:38.733Z"}
{"level":"debug","message":"Executing query [m8q844hd8u78xu7xhml]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[36]","timestamp":"2025-03-26T17:53:38.737Z"}
{"level":"debug","message":"Executing query [m8q844hf5lmcaft157d]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[36]","timestamp":"2025-03-26T17:53:38.739Z"}
{"level":"debug","message":"Executing query [m8q844hhu8a04nelo8a]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[36]","timestamp":"2025-03-26T17:53:38.741Z"}
{"level":"debug","message":"Executing query [m8q844hk8t7gfkx2pkg]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[36]","timestamp":"2025-03-26T17:53:38.744Z"}
{"level":"debug","message":"Executing query [m8q844hmudz14nihbje]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T17:53:38.746Z"}
{"level":"debug","message":"Executing query [m8q844ho7qt0avl1wb]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T17:53:38.748Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:53:38.750Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:39.475Z"}
{"level":"debug","message":"Executing query [m8q8451yisuex3ehg2i]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:53:39.478Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:53:39.494Z"}
{"level":"debug","message":"Executing query [m8q8452gfsuqapckk66]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:39.496Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q8452gfsuqapckk66]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T17:53:39.498Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:53:39.499Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:39.506Z"}
{"level":"debug","message":"Executing query [m8q8452ujz72150y9mq]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:53:39.510Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:53:39.529Z"}
{"level":"debug","message":"Executing query [m8q8453hh5q3q0rgags]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:39.533Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q8453hh5q3q0rgags]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T17:53:39.536Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:53:39.536Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:39.554Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:40.113Z"}
{"duration":"11ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T17:53:40.295Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:53:40.296Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T17:53:40.300Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:53:40.304Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:40.771Z"}
{"level":"debug","message":"Executing query [m8q8461zlad7gos1lzi]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:53:40.775Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:53:40.805Z"}
{"level":"debug","message":"Executing query [m8q8462vgks1fj0dotl]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:40.807Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q8462vgks1fj0dotl]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T17:53:40.814Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:53:40.815Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:41.382Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:53:41.523Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T17:53:41.525Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:42.112Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:42.162Z"}
{"level":"debug","message":"Executing query [m8q8474ljjjqtwq0pa]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:42.166Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:53:42.214Z"}
{"level":"debug","message":"Executing query [m8q84767kdpcmmgksc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:53:42.223Z"}
{"level":"debug","message":"Executing query [m8q84769i5w7xrwgbg]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T17:53:42.225Z"}
{"level":"debug","message":"Executing query [m8q8476bw655a5b1mnm]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T17:53:42.227Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T17:53:42.229Z"}
{"level":"debug","message":"Executing query [m8q8476eqi1fim1dik]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T17:53:42.230Z"}
{"level":"debug","message":"Executing query [m8q8476hhv6wswpo1x8]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T17:53:42.233Z"}
{"level":"debug","message":"Executing query [m8q8476kfksk29ueltf]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T17:53:42.236Z"}
{"level":"debug","message":"Executing query [m8q8476l8693jv683gk]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T17:53:42.237Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T17:53:42.243Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T17:53:42.243Z"}
{"level":"debug","message":"Executing query [m8q8476sjm57yt77ur]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T17:53:42.244Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8q8476sjm57yt77ur]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T17:53:42.245Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T17:53:42.246Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T17:53:42.246Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T17:53:42.249Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T17:53:42.250Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T17:53:42.251Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T17:53:42.251Z"}
{"level":"debug","message":"Executing query [m8q84770m1u1ltntxf]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T17:53:42.252Z"}
{"level":"debug","message":"Executing query [m8q84772fqv7we8gqf]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T17:53:42.254Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T17:53:42.255Z"}
{"level":"debug","message":"Executing query [m8q84773fxik84w356]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T17:53:42.255Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:53:42.256Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:53:42.206Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T17:53:42.484Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:53:42.610Z"}
{"level":"debug","message":"Executing query [m8q847hwkv0n549w58]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T17:53:42.644Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q847hwkv0n549w58]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T17:53:42.648Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T17:53:42.651Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:53:42.681Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:56:50.663Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:56:50.676Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:56:50.685Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:56:50.690Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:56:50.694Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:56:50.697Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T17:56:50.701Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T17:56:50.706Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T17:56:50.708Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T17:56:50.711Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T17:56:50.713Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T17:56:50.715Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T17:56:51.036Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T17:56:51.054Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:50.993Z"}
{"level":"debug","message":"Executing query [m8q888vptdxrvtlxgeb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:56:51.061Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:51.146Z"}
{"level":"debug","message":"Executing query [m8q888zmeus9fe5hnqg]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:51.202Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:51.320Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:51.527Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:51.597Z"}
{"level":"debug","message":"Executing query [m8q889c1iiedv192rf]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:56:51.650Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T17:56:51.624Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:51.779Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T17:56:51.723Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:51.860Z"}
{"level":"debug","message":"Executing query [m8q889i1ubmg8gvrln]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:56:51.866Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:52.243Z"}
{"level":"debug","message":"Executing query [m8q889tji2uyv9tcq4r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:56:52.279Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T17:56:52.378Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T17:56:52.379Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T17:56:52.380Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T17:56:52.382Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T17:56:52.383Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T17:56:52.383Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:52.518Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T17:56:52.833Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T17:56:52.851Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:52.986Z"}
{"level":"debug","message":"Executing query [m8q88aee7onjfj0bw47]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:56:53.030Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T17:56:53.068Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:53.389Z"}
{"level":"debug","message":"Executing query [m8q88ap39m39vzywoam]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:56:53.415Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:54.475Z"}
{"duration":"6ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T17:56:54.697Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T17:56:54.706Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:54.744Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:56:57.427Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:56:57.428Z"}
{"executionTime":4404,"level":"warn","message":"Slow query detected [m8q88aee7onjfj0bw47] - 4404ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-26T17:56:57.434Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:56:57.434Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:56:57.434Z"}
{"level":"debug","message":"Executing query [m8q88dss9vlti12uneq]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743011813029\"]","timestamp":"2025-03-26T17:56:57.436Z"}
{"executionTime":4020,"level":"warn","message":"Slow query detected [m8q88ap39m39vzywoam] - 4020ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-26T17:56:57.435Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:56:57.436Z"}
{"level":"debug","message":"Executing query [m8q88dsu96feu2b7vor]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743011813029\",true]","timestamp":"2025-03-26T17:56:57.438Z"}
{"executionTime":6246,"level":"warn","message":"Slow query detected [m8q888zmeus9fe5hnqg] - 6246ms","query":"SELECT 1 FROM Usuario LIMIT 1","timestamp":"2025-03-26T17:56:57.448Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T17:56:57.449Z"}
{"level":"debug","message":"Executing query [m8q88dt5hyzbbm7qdl]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.449Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:56:57.445Z"}
{"level":"debug","message":"Executing query [m8q88dt6ugtt2q656wk]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T17:56:57.451Z"}
{"level":"debug","message":"Executing query [m8q88dss8uij74vvrj]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.437Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:56:57.440Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q88dss8uij74vvrj]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T17:56:57.442Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:56:57.445Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T17:56:57.452Z"}
{"level":"debug","message":"Executing query [m8q88dt9f15bb3c4xsw]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.453Z"}
{"level":"debug","message":"Executing query [m8q88dta2j45qeog8v2]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T17:56:57.454Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T17:56:57.455Z"}
{"executionTime":6392,"level":"warn","message":"Slow query detected [m8q888vptdxrvtlxgeb] - 6392ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-26T17:56:57.453Z"}
{"level":"debug","message":"Executing query [m8q88dtaauj5qxpz2u]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743011811056\"]","timestamp":"2025-03-26T17:56:57.454Z"}
{"level":"debug","message":"Executing query [m8q88dtckyp0nqcrvy]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.456Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T17:56:57.457Z"}
{"level":"debug","message":"Executing query [m8q88dtenl4rvbtzrhg]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.458Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8q88dta2j45qeog8v2]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T17:56:57.458Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T17:56:57.460Z"}
{"level":"debug","message":"Executing query [m8q88dtgq4c60zi9r6p]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.460Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:56:57.462Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:56:57.465Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:56:57.468Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:56:57.470Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8q88dtgq4c60zi9r6p]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T17:56:57.462Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:56:57.462Z"}
{"level":"debug","message":"Executing query [m8q88dtkil51sxxd3wg]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[37]","timestamp":"2025-03-26T17:56:57.468Z"}
{"executionTime":5193,"level":"warn","message":"Slow query detected [m8q889tji2uyv9tcq4r] - 5193ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-26T17:56:57.473Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T17:56:57.463Z"}
{"level":"debug","message":"Executing query [m8q88dtj2xo3v9zax0u]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.463Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T17:56:57.465Z"}
{"level":"debug","message":"Executing query [m8q88dtlzirdv4v8sh]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.465Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T17:56:57.467Z"}
{"level":"debug","message":"Executing query [m8q88dtnsv82oxks8er]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.467Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q88dtnsv82oxks8er]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T17:56:57.469Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T17:56:57.469Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T17:56:57.470Z"}
{"level":"debug","message":"Executing query [m8q88dts7h93s0xbg97]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.472Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q88dts7h93s0xbg97]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T17:56:57.474Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T17:56:57.474Z"}
{"level":"debug","message":"Executing query [m8q88dtu3c2bae7vj7c]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.475Z"}
{"executionTime":5824,"level":"warn","message":"Slow query detected [m8q889c1iiedv192rf] - 5824ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-26T17:56:57.473Z"}
{"level":"debug","message":"Executing query [m8q88dtujcdggrsc3d]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.474Z"}
{"level":"debug","message":"Executing query [m8q88du0le71qbkldva]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T17:56:57.480Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q88dtu3c2bae7vj7c]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T17:56:57.476Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T17:56:57.477Z"}
{"level":"debug","message":"Executing query [m8q88dtx0rzkqpb53cff]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.477Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q88dtx0rzkqpb53cff]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T17:56:57.479Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T17:56:57.479Z"}
{"level":"debug","message":"Executing query [m8q88dtz38f5za55w3o]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.479Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T17:56:57.440Z"}
{"level":"debug","message":"Executing query [m8q88du14ydu3jr05jv]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743011811056\"]","timestamp":"2025-03-26T17:56:57.481Z"}
{"level":"debug","message":"Executing query [m8q88du2nyb7m139cbk]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T17:56:57.483Z"}
{"level":"debug","message":"Executing query [m8q88du34bbvc5z1i0x]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743011811056\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T17:56:57.483Z"}
{"level":"debug","message":"Executing query [m8q88dttuwlv4jdwzea]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.473Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q88dttuwlv4jdwzea]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T17:56:57.478Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:56:57.479Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T17:56:57.485Z"}
{"level":"debug","message":"Executing query [m8q88du54jsqfxobolu]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.486Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q88dtz38f5za55w3o]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T17:56:57.481Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T17:56:57.481Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T17:56:57.481Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T17:56:57.482Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T17:56:57.483Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T17:56:57.483Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T17:56:57.483Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T17:56:57.483Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T17:56:57.484Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T17:56:57.484Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T17:56:57.484Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T17:56:57.484Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T17:56:57.484Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T17:56:57.485Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T17:56:57.485Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T17:56:57.485Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T17:56:57.485Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T17:56:57.485Z"}
{"level":"debug","message":"Executing query [m8q88duc4kmkgngb49p]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1035]","timestamp":"2025-03-26T17:56:57.493Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T17:56:57.485Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T17:56:57.485Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:56:57.488Z"}
{"level":"debug","message":"Executing query [m8q88duiym6wclj6hi8]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743011811056\"]","timestamp":"2025-03-26T17:56:57.498Z"}
{"level":"debug","message":"Executing query [m8q88dunqcpt932xd0i]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1035]","timestamp":"2025-03-26T17:56:57.503Z"}
{"executionTime":5637,"level":"warn","message":"Slow query detected [m8q889i1ubmg8gvrln] - 5637ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-26T17:56:57.502Z"}
{"level":"debug","message":"Executing query [m8q88dum9zde9y6tv1]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.502Z"}
{"level":"debug","message":"Executing query [m8q88dup4spvg5hb6c7]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743011813029\"]","timestamp":"2025-03-26T17:56:57.506Z"}
{"level":"debug","message":"Executing query [m8q88duttjn1vlkz15i]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1035]","timestamp":"2025-03-26T17:56:57.509Z"}
{"level":"debug","message":"Executing query [m8q88dutr5imjmzim3]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",37]","timestamp":"2025-03-26T17:56:57.509Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T17:56:57.432Z"}
{"level":"debug","message":"Executing query [m8q88duxmm080hjnu89]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1035]","timestamp":"2025-03-26T17:56:57.513Z"}
{"level":"debug","message":"Executing query [m8q88duyny6eiz5xzag]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[37]","timestamp":"2025-03-26T17:56:57.514Z"}
{"level":"debug","message":"Executing query [m8q88dv15ekuhcs31gj]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[37]","timestamp":"2025-03-26T17:56:57.517Z"}
{"level":"debug","message":"Executing query [m8q88dv1ew1c5txsd47]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1035]","timestamp":"2025-03-26T17:56:57.518Z"}
{"level":"debug","message":"Executing query [m8q88dv5safu2yxb2f]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1035]","timestamp":"2025-03-26T17:56:57.521Z"}
{"level":"debug","message":"Executing query [m8q88dv5afsmgqu996d]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[37]","timestamp":"2025-03-26T17:56:57.521Z"}
{"level":"debug","message":"Executing query [m8q88dv7etc15auugh]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1035]","timestamp":"2025-03-26T17:56:57.523Z"}
{"level":"debug","message":"Executing query [m8q88dv8xw2vcj5x39j]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[37]","timestamp":"2025-03-26T17:56:57.524Z"}
{"level":"debug","message":"Executing query [m8q88dvbwgxbq3wtrr7]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[37]","timestamp":"2025-03-26T17:56:57.527Z"}
{"level":"debug","message":"Executing query [m8q88dvb3q956sv4jax]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1035]","timestamp":"2025-03-26T17:56:57.527Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T17:56:57.466Z"}
{"level":"debug","message":"Executing query [m8q88dvdml6y160age]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T17:56:57.529Z"}
{"level":"debug","message":"Executing query [m8q88dvfhg3w09yitoo]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[37]","timestamp":"2025-03-26T17:56:57.531Z"}
{"level":"debug","message":"Executing query [m8q88dvg3f4f3k9ay0o]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T17:56:57.532Z"}
{"level":"debug","message":"Executing query [m8q88dvh0pyc9g3tz1o]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T17:56:57.533Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:56:57.535Z"}
{"level":"debug","message":"Executing query [m8q88dvjdsb7oz9fvtv]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T17:56:57.535Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q88dum9zde9y6tv1]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T17:56:57.509Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:56:57.510Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:56:57.538Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T17:56:57.488Z"}
{"level":"debug","message":"Executing query [m8q88dwswam9x4g0dk]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T17:56:57.580Z"}
{"level":"debug","message":"Executing query [m8q88dwyp7dvue2prv]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T17:56:57.586Z"}
{"level":"debug","message":"Executing query [m8q88dx2rjxygv07y99]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T17:56:57.590Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:57.693Z"}
{"level":"debug","message":"Executing query [m8q88e01omq04zg7p9c]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:56:57.697Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:56:57.713Z"}
{"level":"debug","message":"Executing query [m8q88e0i237by8qkx58]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.714Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q88e0i237by8qkx58]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T17:56:57.716Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:56:57.716Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:57.781Z"}
{"level":"debug","message":"Executing query [m8q88e2jmp5fup2ttls]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:56:57.787Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:56:57.809Z"}
{"level":"debug","message":"Executing query [m8q88e3h6cvz1xkp7a9]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:57.821Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q88e3h6cvz1xkp7a9]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T17:56:57.823Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T17:56:57.824Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:57.741Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:58.108Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:58.119Z"}
{"level":"debug","message":"Executing query [m8q88ebuz7691ec2xt]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:58.122Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:56:58.140Z"}
{"level":"debug","message":"Executing query [m8q88ecef1c2f61fx1e]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T17:56:58.143Z"}
{"level":"debug","message":"Executing query [m8q88ecgsnjsbejld6r]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T17:56:58.144Z"}
{"level":"debug","message":"Executing query [m8q88ech5sym5ggku9d]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T17:56:58.145Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T17:56:58.147Z"}
{"level":"debug","message":"Executing query [m8q88ecko5twwweexd8]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T17:56:58.148Z"}
{"level":"debug","message":"Executing query [m8q88ecmxevecxipy4b]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T17:56:58.150Z"}
{"level":"debug","message":"Executing query [m8q88eco1bv30wqyfiz]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T17:56:58.152Z"}
{"level":"debug","message":"Executing query [m8q88ecp064kc2jk1ub6]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T17:56:58.153Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T17:56:58.159Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T17:56:58.159Z"}
{"level":"debug","message":"Executing query [m8q88ecv4f71bgz3avt]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T17:56:58.160Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8q88ecv4f71bgz3avt]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T17:56:58.161Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T17:56:58.162Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T17:56:58.162Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T17:56:58.164Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T17:56:58.164Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T17:56:58.165Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T17:56:58.166Z"}
{"level":"debug","message":"Executing query [m8q88ed3xrbbg1mv0v]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T17:56:58.167Z"}
{"level":"debug","message":"Executing query [m8q88ed4oaye777uze9]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T17:56:58.169Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T17:56:58.170Z"}
{"level":"debug","message":"Executing query [m8q88ed613oy3ajvh4]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T17:56:58.170Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:56:58.171Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T17:56:58.936Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T17:56:59.163Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T17:56:59.292Z"}
{"level":"debug","message":"Executing query [m8q88f9iwrbmzxp0mko]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T17:56:59.334Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q88f9iwrbmzxp0mko]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T17:56:59.336Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T17:56:59.339Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T17:56:59.371Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T18:07:18.685Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T18:07:18.694Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T18:07:18.708Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T18:07:18.713Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T18:07:18.718Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T18:07:18.723Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T18:07:18.727Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T18:07:18.731Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T18:07:18.732Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T18:07:18.734Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T18:07:18.736Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T18:07:18.737Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T18:07:18.742Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T18:07:18.757Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:18.912Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:18.947Z"}
{"level":"debug","message":"Executing query [m8q8lpden010kx94inr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:07:18.962Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:07:19.012Z"}
{"level":"debug","message":"Executing query [m8q8lpeystzm4cakymr]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743012438959\"]","timestamp":"2025-03-26T18:07:19.018Z"}
{"level":"debug","message":"Executing query [m8q8lpfq6scl8w2jn9r]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743012438959\"]","timestamp":"2025-03-26T18:07:19.046Z"}
{"level":"debug","message":"Executing query [m8q8lpfxznqfvduyuk]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743012438959\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T18:07:19.053Z"}
{"level":"debug","message":"Executing query [m8q8lpe928655oejlr2]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:18.994Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:07:19.056Z"}
{"level":"debug","message":"Executing query [m8q8lpga0qjoren1sfj]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1036]","timestamp":"2025-03-26T18:07:19.066Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T18:07:19.070Z"}
{"level":"debug","message":"Executing query [m8q8lpgedesrwkos8rr]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:19.070Z"}
{"level":"debug","message":"Executing query [m8q8lpgevyv0vahew7c]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743012438959\"]","timestamp":"2025-03-26T18:07:19.070Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T18:07:19.073Z"}
{"level":"debug","message":"Executing query [m8q8lpghmbzzzo4136]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:19.073Z"}
{"level":"debug","message":"Executing query [m8q8lpgidr8mt8jlh9]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1036]","timestamp":"2025-03-26T18:07:19.074Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T18:07:19.075Z"}
{"level":"debug","message":"Executing query [m8q8lpgksa86z8rtvc]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:19.076Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T18:07:19.078Z"}
{"level":"debug","message":"Executing query [m8q8lpgn7zqshnythp3]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:19.079Z"}
{"level":"debug","message":"Executing query [m8q8lpgo5y63l7vm7o]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1036]","timestamp":"2025-03-26T18:07:19.081Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T18:07:19.080Z"}
{"level":"debug","message":"Executing query [m8q8lpgo95d7zexux2d]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:19.081Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8q8lpgo95d7zexux2d]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T18:07:19.083Z"}
{"level":"debug","message":"Executing query [m8q8lpgs0xsrgqx6opfh]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1036]","timestamp":"2025-03-26T18:07:19.084Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T18:07:19.083Z"}
{"level":"debug","message":"Executing query [m8q8lpgrsqs1phjd7xn]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:19.083Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T18:07:19.085Z"}
{"level":"debug","message":"Executing query [m8q8lpgtfdgodz1bwq]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:19.085Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T18:07:19.086Z"}
{"level":"debug","message":"Executing query [m8q8lpgusemj324w5q]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:19.087Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q8lpgusemj324w5q]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T18:07:19.088Z"}
{"level":"debug","message":"Executing query [m8q8lpgwudl8ithnz0j]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1036]","timestamp":"2025-03-26T18:07:19.088Z"}
{"level":"debug","message":"Executing query [m8q8lpgzwn3xqekp13]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1036]","timestamp":"2025-03-26T18:07:19.091Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T18:07:19.089Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T18:07:19.089Z"}
{"level":"debug","message":"Executing query [m8q8lpgy7j450eioze9]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:19.091Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q8lpgy7j450eioze9]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T18:07:19.092Z"}
{"level":"debug","message":"Executing query [m8q8lph1j9jwqavh21]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1036]","timestamp":"2025-03-26T18:07:19.093Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T18:07:19.092Z"}
{"level":"debug","message":"Executing query [m8q8lph16xs2gz9yjfa]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:19.093Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q8lph16xs2gz9yjfa]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T18:07:19.094Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T18:07:19.094Z"}
{"level":"debug","message":"Executing query [m8q8lph21h8v1jb3c27]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:19.094Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q8lph21h8v1jb3c27]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T18:07:19.095Z"}
{"level":"debug","message":"Executing query [m8q8lph41ih0i96pcie]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1036]","timestamp":"2025-03-26T18:07:19.096Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T18:07:19.096Z"}
{"level":"debug","message":"Executing query [m8q8lph46in6loz40ug]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:19.096Z"}
{"level":"debug","message":"Executing query [m8q8lph6aw18lyase3d]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T18:07:19.098Z"}
{"level":"debug","message":"Executing query [m8q8lph9zqlae45z9s]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T18:07:19.101Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:07:19.103Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q8lph46in6loz40ug]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T18:07:19.097Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T18:07:19.098Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T18:07:19.098Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T18:07:19.099Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T18:07:19.099Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T18:07:19.099Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T18:07:19.099Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T18:07:19.099Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T18:07:19.100Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T18:07:19.100Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T18:07:19.100Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T18:07:19.100Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T18:07:19.100Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T18:07:19.100Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T18:07:19.100Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T18:07:19.100Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T18:07:19.101Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T18:07:19.101Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T18:07:19.101Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T18:07:19.101Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:07:19.103Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:19.238Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:19.207Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:19.414Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:07:19.523Z"}
{"level":"debug","message":"Executing query [m8q8lpt7r85yogg6neb]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T18:07:19.531Z"}
{"level":"debug","message":"Executing query [m8q8lpta1qr61dj0u3l]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T18:07:19.534Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8q8lpta1qr61dj0u3l]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T18:07:19.537Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:07:19.539Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T18:07:19.470Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:19.561Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T18:07:19.522Z"}
{"level":"debug","message":"Executing query [m8q8lpuukkwhaqz6a9c]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:07:19.590Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:07:19.627Z"}
{"level":"debug","message":"Executing query [m8q8lpvxl0f19kf8hr]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:19.629Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q8lpvxl0f19kf8hr]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T18:07:19.632Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T18:07:19.632Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:19.740Z"}
{"level":"debug","message":"Executing query [m8q8lq0gl839cfv19fm]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:07:19.792Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:07:19.850Z"}
{"level":"debug","message":"Executing query [m8q8lq2a5237m4ksr7o]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:19.858Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T18:07:19.864Z"}
{"level":"debug","message":"Executing query [m8q8lq2ghtixhuc5dh]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T18:07:19.864Z"}
{"level":"debug","message":"Executing query [m8q8lq2jfpdlguzoe19]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T18:07:19.867Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T18:07:19.869Z"}
{"level":"debug","message":"Executing query [m8q8lq2mtm0kz8mz05e]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:19.870Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T18:07:19.872Z"}
{"level":"debug","message":"Executing query [m8q8lq2szn8al1ixgfn]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T18:07:19.876Z"}
{"level":"debug","message":"Executing query [m8q8lq2x1f1on9ifw0j]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T18:07:19.881Z"}
{"level":"debug","message":"Executing query [m8q8lq30e17rsyp7mgt]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T18:07:19.884Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:19.990Z"}
{"level":"debug","message":"Executing query [m8q8lq63o013e458zsg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:07:19.995Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:07:20.045Z"}
{"level":"debug","message":"Executing query [m8q8lq7k7uuwrsw18ox]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:20.048Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q8lq7k7uuwrsw18ox]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T18:07:20.052Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T18:07:20.053Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T18:07:20.066Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T18:07:20.067Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T18:07:20.067Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T18:07:20.067Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T18:07:20.068Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T18:07:20.068Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:20.470Z"}
{"level":"debug","message":"Executing query [m8q8lqjekqvp65ej21l]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:07:20.474Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:07:20.503Z"}
{"level":"debug","message":"Executing query [m8q8lqkdaf25yalqt2]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743012440473\"]","timestamp":"2025-03-26T18:07:20.509Z"}
{"level":"debug","message":"Executing query [m8q8lqkf2zcfvbhl6wz]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743012440473\",true]","timestamp":"2025-03-26T18:07:20.511Z"}
{"level":"debug","message":"Executing query [m8q8lqkl9r1h5avjzn6]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-26T18:07:20.517Z"}
{"level":"debug","message":"Executing query [m8q8lqko5ydh93gs48]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743012440473\"]","timestamp":"2025-03-26T18:07:20.521Z"}
{"level":"debug","message":"Executing query [m8q8lqkr4icak70f9kn]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",38]","timestamp":"2025-03-26T18:07:20.523Z"}
{"level":"debug","message":"Executing query [m8q8lqkvfmpt0nvdn4p]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-26T18:07:20.527Z"}
{"level":"debug","message":"Executing query [m8q8lqkyijcvnlzsmo8]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-26T18:07:20.530Z"}
{"level":"debug","message":"Executing query [m8q8lql2p5g3zpjwzx]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-26T18:07:20.534Z"}
{"level":"debug","message":"Executing query [m8q8lql5vx1hr2retz]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-26T18:07:20.537Z"}
{"level":"debug","message":"Executing query [m8q8lql7mbneh9gys5]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-26T18:07:20.539Z"}
{"level":"debug","message":"Executing query [m8q8lqlap53orwtnfva]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-26T18:07:20.542Z"}
{"level":"debug","message":"Executing query [m8q8lqlccbsgsqlcyg5]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T18:07:20.544Z"}
{"level":"debug","message":"Executing query [m8q8lqleabul2si3wta]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T18:07:20.546Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:07:20.548Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:20.554Z"}
{"level":"debug","message":"Executing query [m8q8lqlqp7lbt1mlzi]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:07:20.558Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:07:20.577Z"}
{"level":"debug","message":"Executing query [m8q8lqmbcngxsvf0f47]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:20.579Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q8lqmbcngxsvf0f47]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T18:07:20.581Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T18:07:20.581Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:20.653Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:20.735Z"}
{"level":"debug","message":"Executing query [m8q8lqrxfg4gbynh4g5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:07:20.781Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:20.198Z"}
{"level":"debug","message":"Executing query [m8q8lqtjndzpwnle3j]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:20.839Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:07:20.841Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T18:07:20.574Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T18:07:20.601Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q8lqtjndzpwnle3j]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T18:07:20.843Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T18:07:20.844Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:07:20.906Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T18:07:20.931Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:20.922Z"}
{"level":"debug","message":"Executing query [m8q8lqw3uqkcp50wae]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:07:20.931Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:07:20.949Z"}
{"level":"debug","message":"Executing query [m8q8lqwnx1ox1yw4b9n]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:20.951Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q8lqwnx1ox1yw4b9n]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T18:07:20.954Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T18:07:20.954Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:07:21.033Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:21.276Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:21.296Z"}
{"level":"debug","message":"Executing query [m8q8lr6bgkof3ofmg6q]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:21.299Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:07:21.318Z"}
{"level":"debug","message":"Executing query [m8q8lr6xuu046hqy35r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:07:21.321Z"}
{"level":"debug","message":"Executing query [m8q8lr6ymybanng0fvo]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T18:07:21.322Z"}
{"level":"debug","message":"Executing query [m8q8lr707csnpwg8j74]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T18:07:21.324Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T18:07:21.326Z"}
{"level":"debug","message":"Executing query [m8q8lr7266car0jz62y]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T18:07:21.326Z"}
{"level":"debug","message":"Executing query [m8q8lr73kksgquezw9]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T18:07:21.327Z"}
{"level":"debug","message":"Executing query [m8q8lr75sdwe87azysj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T18:07:21.329Z"}
{"level":"debug","message":"Executing query [m8q8lr77dlpb9byftse]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T18:07:21.331Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T18:07:21.335Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T18:07:21.335Z"}
{"level":"debug","message":"Executing query [m8q8lr7c9mkc632ufne]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T18:07:21.336Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8q8lr7c9mkc632ufne]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T18:07:21.337Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T18:07:21.337Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T18:07:21.337Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T18:07:21.339Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T18:07:21.340Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T18:07:21.341Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T18:07:21.341Z"}
{"level":"debug","message":"Executing query [m8q8lr7ipd19isxdft]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T18:07:21.342Z"}
{"level":"debug","message":"Executing query [m8q8lr7jhjicel99kvm]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T18:07:21.343Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T18:07:21.344Z"}
{"level":"debug","message":"Executing query [m8q8lr7k0rdqdurwk8y8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T18:07:21.344Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:07:21.345Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:21.890Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T18:07:22.101Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:07:22.233Z"}
{"level":"debug","message":"Executing query [m8q8lrxbb0sgyutuue9]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T18:07:22.271Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q8lrxbb0sgyutuue9]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T18:07:22.273Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T18:07:22.276Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:07:22.309Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:22.316Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:07:22.488Z"}
{"duration":"25ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T18:07:22.491Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T18:07:22.493Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:07:22.497Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:07:22.792Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:07:22.970Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T18:07:22.972Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T18:08:37.956Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T18:08:37.971Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T18:08:37.999Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T18:08:38.004Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T18:08:38.017Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T18:08:38.043Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T18:08:38.046Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T18:08:38.050Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T18:08:38.052Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T18:08:38.054Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T18:08:38.055Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T18:08:38.056Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:38.265Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T18:08:38.293Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T18:08:38.310Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Executing query [m8q8neliwxg1bkmw8z]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:08:38.311Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:08:38.359Z"}
{"level":"debug","message":"Executing query [m8q8nemys8ek9kcx03]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743012518306\"]","timestamp":"2025-03-26T18:08:38.362Z"}
{"level":"debug","message":"Executing query [m8q8nene17g1qlwflrd]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743012518306\"]","timestamp":"2025-03-26T18:08:38.378Z"}
{"level":"debug","message":"Executing query [m8q8nengdt5j13ctt6a]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743012518306\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T18:08:38.380Z"}
{"level":"debug","message":"Executing query [m8q8nenrvngk38rvvtg]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1037]","timestamp":"2025-03-26T18:08:38.391Z"}
{"level":"debug","message":"Executing query [m8q8nenwehbqezs6n1j]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743012518306\"]","timestamp":"2025-03-26T18:08:38.396Z"}
{"level":"debug","message":"Executing query [m8q8neo0bivbztm1x9]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1037]","timestamp":"2025-03-26T18:08:38.400Z"}
{"level":"debug","message":"Executing query [m8q8neo6jiw6l6l0zk]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1037]","timestamp":"2025-03-26T18:08:38.406Z"}
{"level":"debug","message":"Executing query [m8q8neoahanqa9ep75o]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1037]","timestamp":"2025-03-26T18:08:38.411Z"}
{"level":"debug","message":"Executing query [m8q8neogx9zt5y48ec]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1037]","timestamp":"2025-03-26T18:08:38.416Z"}
{"level":"debug","message":"Executing query [m8q8neojeny6beuan58]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1037]","timestamp":"2025-03-26T18:08:38.419Z"}
{"level":"debug","message":"Executing query [m8q8neol7lzju2czwj]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1037]","timestamp":"2025-03-26T18:08:38.421Z"}
{"level":"debug","message":"Executing query [m8q8neosa7jhv3fb1fc]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1037]","timestamp":"2025-03-26T18:08:38.428Z"}
{"level":"debug","message":"Executing query [m8q8neou0nx8nxrt3jh9]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T18:08:38.430Z"}
{"level":"debug","message":"Executing query [m8q8neoxiit0ngdpjxc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T18:08:38.433Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:08:38.435Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:38.435Z"}
{"level":"debug","message":"Executing query [m8q8neq8pyamabt048k]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:38.480Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:08:38.547Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T18:08:38.556Z"}
{"level":"debug","message":"Executing query [m8q8nesdo3ju7mh5f9i]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:38.557Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T18:08:38.559Z"}
{"level":"debug","message":"Executing query [m8q8nesg2i04k8rulw6]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:38.560Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T18:08:38.562Z"}
{"level":"debug","message":"Executing query [m8q8nesihfrddbtr3ul]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:38.562Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T18:08:38.565Z"}
{"level":"debug","message":"Executing query [m8q8nesloypfmxfacfq]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:38.565Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T18:08:38.567Z"}
{"level":"debug","message":"Executing query [m8q8nesnicbuhfimthc]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:38.567Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8q8nesnicbuhfimthc]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T18:08:38.570Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T18:08:38.570Z"}
{"level":"debug","message":"Executing query [m8q8nesr2p3rrl8c9kv]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:38.571Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T18:08:38.572Z"}
{"level":"debug","message":"Executing query [m8q8nestpetdn4f0zle]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:38.573Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T18:08:38.575Z"}
{"level":"debug","message":"Executing query [m8q8nesv3ibzewfkop9]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:38.575Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q8nesv3ibzewfkop9]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T18:08:38.578Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T18:08:38.578Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T18:08:38.578Z"}
{"level":"debug","message":"Executing query [m8q8net05mcxwjaihwv]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:38.580Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q8net05mcxwjaihwv]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T18:08:38.582Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T18:08:38.582Z"}
{"level":"debug","message":"Executing query [m8q8net338al0ttw37h]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:38.583Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q8net338al0ttw37h]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T18:08:38.585Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T18:08:38.585Z"}
{"level":"debug","message":"Executing query [m8q8net5ss9qqsrdru]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:38.585Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q8net5ss9qqsrdru]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T18:08:38.587Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T18:08:38.587Z"}
{"level":"debug","message":"Executing query [m8q8net7w2kmx5vr9q]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:38.587Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q8net7w2kmx5vr9q]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T18:08:38.588Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T18:08:38.589Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T18:08:38.589Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T18:08:38.590Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T18:08:38.590Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T18:08:38.591Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T18:08:38.591Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T18:08:38.591Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T18:08:38.591Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T18:08:38.591Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T18:08:38.591Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T18:08:38.592Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T18:08:38.592Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T18:08:38.592Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T18:08:38.592Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T18:08:38.592Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T18:08:38.592Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T18:08:38.592Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T18:08:38.593Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T18:08:38.593Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:08:38.595Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:38.542Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:38.764Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:38.961Z"}
{"level":"debug","message":"Executing query [m8q8nf5543yosu9lcmz]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:08:39.017Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:08:39.080Z"}
{"level":"debug","message":"Executing query [m8q8nf73lj3l7b72vu]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:39.087Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T18:08:39.097Z"}
{"level":"debug","message":"Executing query [m8q8nf7dosx7g8buqa]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T18:08:39.097Z"}
{"level":"debug","message":"Executing query [m8q8nf7hm8ptrvvtsb]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T18:08:39.101Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T18:08:39.105Z"}
{"level":"debug","message":"Executing query [m8q8nf7m9zx26nyzh3k]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:39.106Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T18:08:39.108Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T18:08:38.965Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:39.106Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T18:08:39.023Z"}
{"level":"debug","message":"Executing query [m8q8nf7t6qebmrvrukx]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:08:39.114Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:08:39.183Z"}
{"level":"debug","message":"Executing query [m8q8nf9vo3ly2phnlak]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:39.187Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8q8nf9vo3ly2phnlak]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T18:08:39.190Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T18:08:39.190Z"}
{"level":"debug","message":"Executing query [m8q8nfa6exlgk4x9tw]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T18:08:39.198Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:39.131Z"}
{"level":"debug","message":"Executing query [m8q8nfaa2v8aqmp13t]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T18:08:39.203Z"}
{"level":"debug","message":"Executing query [m8q8nfaewrsan7uc6j]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T18:08:39.206Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:08:39.250Z"}
{"level":"debug","message":"Executing query [m8q8nfbtn8xjg071n3]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T18:08:39.257Z"}
{"level":"debug","message":"Executing query [m8q8nfbz401yr02wri4]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T18:08:39.263Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8q8nfbz401yr02wri4]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T18:08:39.266Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:08:39.270Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T18:08:39.589Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T18:08:39.590Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T18:08:39.591Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T18:08:39.591Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T18:08:39.592Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T18:08:39.592Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:39.647Z"}
{"level":"debug","message":"Executing query [m8q8nfndigp2jzk2dag]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:08:39.673Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:08:39.696Z"}
{"level":"debug","message":"Executing query [m8q8nfo3zxf5c7zypvo]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:39.699Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8q8nfo3zxf5c7zypvo]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T18:08:39.700Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T18:08:39.701Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:39.983Z"}
{"level":"debug","message":"Executing query [m8q8nfw7wfp8xzjxgx]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:08:39.991Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:08:40.023Z"}
{"level":"debug","message":"Executing query [m8q8nfx417x5rwvhz4x]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:40.024Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8q8nfx417x5rwvhz4x]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T18:08:40.026Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T18:08:40.027Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:40.110Z"}
{"level":"debug","message":"Executing query [m8q8nfztkmhnoxg2qlo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:08:40.121Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:08:40.154Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:40.102Z"}
{"level":"debug","message":"Executing query [m8q8ng0dascyvx1zvti]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:08:40.141Z"}
{"level":"debug","message":"Executing query [m8q8ng0t3th911eovbr]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:40.157Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q8ng0t3th911eovbr]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T18:08:40.161Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T18:08:40.162Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:08:40.208Z"}
{"level":"debug","message":"Executing query [m8q8ng2g6wzwhnrevcc]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743012520139\"]","timestamp":"2025-03-26T18:08:40.216Z"}
{"level":"debug","message":"Executing query [m8q8ng2in3e38kzp198]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743012520139\",true]","timestamp":"2025-03-26T18:08:40.218Z"}
{"level":"debug","message":"Executing query [m8q8ng2psxico93unis]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[39]","timestamp":"2025-03-26T18:08:40.225Z"}
{"level":"debug","message":"Executing query [m8q8ng2vixt17arxau9]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743012520139\"]","timestamp":"2025-03-26T18:08:40.231Z"}
{"level":"debug","message":"Executing query [m8q8ng2yjvi8finwfef]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",39]","timestamp":"2025-03-26T18:08:40.234Z"}
{"level":"debug","message":"Executing query [m8q8ng34bzmjslqgrvd]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[39]","timestamp":"2025-03-26T18:08:40.240Z"}
{"level":"debug","message":"Executing query [m8q8ng37lbo16m5zxn]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[39]","timestamp":"2025-03-26T18:08:40.243Z"}
{"level":"debug","message":"Executing query [m8q8ng3cq5mpi3r9god]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[39]","timestamp":"2025-03-26T18:08:40.248Z"}
{"level":"debug","message":"Executing query [m8q8ng3gw7891a1ra8]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[39]","timestamp":"2025-03-26T18:08:40.252Z"}
{"level":"debug","message":"Executing query [m8q8ng3jeaxkxrzalpi]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[39]","timestamp":"2025-03-26T18:08:40.255Z"}
{"level":"debug","message":"Executing query [m8q8ng3nrixpj5mrys]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[39]","timestamp":"2025-03-26T18:08:40.259Z"}
{"level":"debug","message":"Executing query [m8q8ng3pgia0mzm05t9]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T18:08:40.261Z"}
{"level":"debug","message":"Executing query [m8q8ng3r40wo5ce3p7o]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T18:08:40.263Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:08:40.266Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:39.705Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:40.182Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:40.339Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T18:08:40.063Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T18:08:40.083Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:08:40.397Z"}
{"level":"debug","message":"Executing query [m8q8ng69kg9jwzgybo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:08:40.353Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:08:40.423Z"}
{"level":"debug","message":"Executing query [m8q8ng8au1de2le5v1]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:40.426Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8q8ng8au1de2le5v1]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T18:08:40.428Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T18:08:40.429Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T18:08:40.445Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:08:40.567Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:41.139Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:41.186Z"}
{"level":"debug","message":"Executing query [m8q8ngthn3kweuclphf]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:41.189Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:08:41.225Z"}
{"level":"debug","message":"Executing query [m8q8ngunt9cos6x2lbi]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T18:08:41.232Z"}
{"level":"debug","message":"Executing query [m8q8ngupzkcru5smzw]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T18:08:41.233Z"}
{"level":"debug","message":"Executing query [m8q8ngurom2hhu2epe]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T18:08:41.235Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T18:08:41.237Z"}
{"level":"debug","message":"Executing query [m8q8ngutfr5tv4ppcb9]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T18:08:41.237Z"}
{"level":"debug","message":"Executing query [m8q8nguvebk6yezpyb]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T18:08:41.239Z"}
{"level":"debug","message":"Executing query [m8q8ngux8tvp36s2hho]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T18:08:41.241Z"}
{"level":"debug","message":"Executing query [m8q8nguzkp41ialduc]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T18:08:41.243Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T18:08:41.251Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T18:08:41.251Z"}
{"level":"debug","message":"Executing query [m8q8ngv7d7byzszywpg]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T18:08:41.251Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8q8ngv7d7byzszywpg]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T18:08:41.253Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T18:08:41.253Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T18:08:41.253Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T18:08:41.255Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T18:08:41.256Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T18:08:41.257Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T18:08:41.258Z"}
{"level":"debug","message":"Executing query [m8q8ngvfxsjf3kelmnn]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T18:08:41.259Z"}
{"level":"debug","message":"Executing query [m8q8ngvhw8aqwbudv5]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T18:08:41.261Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T18:08:41.262Z"}
{"level":"debug","message":"Executing query [m8q8ngvjshuwi1n9qgs]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T18:08:41.263Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:08:41.265Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:41.646Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T18:08:41.883Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:08:42.042Z"}
{"level":"debug","message":"Executing query [m8q8nhidhyy3wys0sji]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T18:08:42.086Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8q8nhidhyy3wys0sji]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T18:08:42.090Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T18:08:42.094Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:08:42.136Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:42.454Z"}
{"duration":"11ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T18:08:42.594Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T18:08:42.595Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T18:08:42.598Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:08:42.602Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T18:08:42.673Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T18:08:42.821Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T18:08:42.823Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T21:23:07.120Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T21:23:07.155Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T21:23:07.162Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T21:23:07.165Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T21:23:07.168Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T21:23:07.171Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T21:23:07.175Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T21:23:07.179Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T21:23:07.181Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T21:23:07.183Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T21:23:07.186Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T21:23:07.234Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T21:23:07.251Z","userId":1,"userRole":"USER"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T21:23:07.188Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:07.431Z"}
{"level":"debug","message":"Executing query [m8qflikpox8t1ew29h]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:07.465Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:07.434Z"}
{"level":"debug","message":"Executing query [m8qfliku5aenocbta6m]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T21:23:07.470Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:07.486Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:07.653Z"}
{"level":"debug","message":"Executing query [m8qfliqyw1u5tlj1oup]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T21:23:07.691Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:07.667Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:07.814Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T21:23:07.829Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T21:23:07.839Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:08.046Z"}
{"level":"debug","message":"Executing query [m8qflj1g85giuyes1zh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T21:23:08.069Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:08.233Z"}
{"level":"debug","message":"Executing query [m8qflj6ku3sb2ucxtr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T21:23:08.253Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T21:23:08.864Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T21:23:08.867Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T21:23:08.867Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T21:23:08.868Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T21:23:08.869Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T21:23:08.869Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:09.313Z"}
{"level":"debug","message":"Executing query [m8qflk0xc667496fp28]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T21:23:09.345Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:09.420Z"}
{"level":"debug","message":"Executing query [m8qflk35phtdxwblx88]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T21:23:09.425Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:09.699Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T21:23:09.952Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T21:23:09.965Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T21:23:10.297Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T21:23:14.065Z"}
{"executionTime":4726,"level":"warn","message":"Slow query detected [m8qflk0xc667496fp28] - 4726ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-26T21:23:14.072Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T21:23:14.072Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T21:23:14.072Z"}
{"level":"debug","message":"Executing query [m8qflno90d7vhcuvphxf]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743024189343\"]","timestamp":"2025-03-26T21:23:14.073Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T21:23:14.075Z"}
{"level":"debug","message":"Executing query [m8qflnoc85ioqbfzorh]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743024189343\",true]","timestamp":"2025-03-26T21:23:14.076Z"}
{"executionTime":5826,"level":"warn","message":"Slow query detected [m8qflj6ku3sb2ucxtr] - 5826ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-26T21:23:14.078Z"}
{"level":"debug","message":"Executing query [m8qflnoix5ogzy9uikd]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-26T21:23:14.082Z"}
{"level":"debug","message":"Executing query [m8qflnof23p4sogs4u]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.079Z"}
{"executionTime":6604,"level":"warn","message":"Slow query detected [m8qfliku5aenocbta6m] - 6604ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-26T21:23:14.074Z"}
{"level":"debug","message":"Executing query [m8qflnoaxncfzqjp08g]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743024187467\"]","timestamp":"2025-03-26T21:23:14.074Z"}
{"level":"debug","message":"Executing query [m8qflnooyo5sp8o86la]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743024189343\"]","timestamp":"2025-03-26T21:23:14.088Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8qflnof23p4sogs4u]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T21:23:14.082Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T21:23:14.082Z"}
{"level":"debug","message":"Executing query [m8qflnoqrtr0nmpox9]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",40]","timestamp":"2025-03-26T21:23:14.090Z"}
{"level":"debug","message":"Executing query [m8qflnp38gweoyioxu8]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-26T21:23:14.103Z"}
{"level":"debug","message":"Executing query [m8qflnoxa4abec87v3q]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743024187467\"]","timestamp":"2025-03-26T21:23:14.097Z"}
{"level":"debug","message":"Executing query [m8qflnp62s78ulhe4z]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-26T21:23:14.106Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T21:23:14.103Z"}
{"executionTime":6418,"level":"warn","message":"Slow query detected [m8qfliqyw1u5tlj1oup] - 6418ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-26T21:23:14.108Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T21:23:14.071Z"}
{"level":"debug","message":"Executing query [m8qflnp9fly3qnfstpo]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.109Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T21:23:14.113Z"}
{"level":"debug","message":"Executing query [m8qflnpeeki5o09i3o]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T21:23:14.114Z"}
{"executionTime":6050,"level":"warn","message":"Slow query detected [m8qflj1g85giuyes1zh] - 6050ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-26T21:23:14.118Z"}
{"level":"debug","message":"Executing query [m8qflnphgfag7b01fa]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T21:23:14.117Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T21:23:14.120Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T21:23:14.119Z"}
{"level":"debug","message":"Executing query [m8qflnpktxopua48ame]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.120Z"}
{"level":"debug","message":"Executing query [m8qflnpjthc2s8x3olp]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.119Z"}
{"executionTime":4697,"level":"warn","message":"Slow query detected [m8qflk35phtdxwblx88] - 4697ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-26T21:23:14.123Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8qflnpjthc2s8x3olp]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T21:23:14.126Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T21:23:14.131Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T21:23:14.127Z"}
{"level":"debug","message":"Executing query [m8qflnpiakw8ccwsk8q]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743024187467\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T21:23:14.118Z"}
{"executionTime":6673,"level":"warn","message":"Slow query detected [m8qflikpox8t1ew29h] - 6673ms","query":"SELECT 1 FROM Usuario LIMIT 1","timestamp":"2025-03-26T21:23:14.138Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T21:23:14.139Z"}
{"level":"debug","message":"Executing query [m8qflnq3jxtarjscfui]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.139Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T21:23:14.142Z"}
{"level":"debug","message":"Executing query [m8qflnq7ny76manopmg]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.143Z"}
{"level":"debug","message":"Executing query [m8qflnpo38xiend6zaz]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.124Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8qflnpo38xiend6zaz]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T21:23:14.129Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T21:23:14.130Z"}
{"level":"debug","message":"Executing query [m8qflnq1w6gjl32g85]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T21:23:14.137Z"}
{"level":"debug","message":"Executing query [m8qflnq6ypz4w7xwqbf]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-26T21:23:14.143Z"}
{"level":"debug","message":"Executing query [m8qflnq9ra6jwwgjbfj]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-26T21:23:14.146Z"}
{"level":"debug","message":"Executing query [m8qflnqdgtw0p51i5bn]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-26T21:23:14.149Z"}
{"level":"debug","message":"Executing query [m8qflnqcq2b8arlx1qm]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1038]","timestamp":"2025-03-26T21:23:14.148Z"}
{"level":"debug","message":"Executing query [m8qflnqh95jtnjaw895]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743024187467\"]","timestamp":"2025-03-26T21:23:14.153Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T21:23:14.149Z"}
{"level":"debug","message":"Executing query [m8qflnqexfddrdqpxh]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.150Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T21:23:14.153Z"}
{"level":"debug","message":"Executing query [m8qflnqhc7o83g4jn1m]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.153Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T21:23:14.156Z"}
{"level":"debug","message":"Executing query [m8qflnqklzzxilkd7i]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.156Z"}
{"level":"debug","message":"Executing query [m8qflnql4u62yhqnpj6]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1038]","timestamp":"2025-03-26T21:23:14.157Z"}
{"code":"AUTH_SWITCH_PLUGIN_ERROR","fatal":true,"level":"error","message":"Error al conectar a la base de datos: authSwitch.authSwitchRequest is not a function","stack":"TypeError: authSwitch.authSwitchRequest is not a function\n    at ClientHandshake.handshakeResult (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\client_handshake.js:196:22)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:45:22)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T21:23:14.153Z"}
{"level":"debug","message":"Executing query [m8qflnq621y090d3jli]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T21:23:14.142Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8qflnq621y090d3jli]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T21:23:14.146Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T21:23:14.149Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8qflnqklzzxilkd7i]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T21:23:14.160Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T21:23:14.161Z"}
{"level":"debug","message":"Executing query [m8qflnqps1s0tz30ild]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.161Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T21:23:14.164Z"}
{"level":"debug","message":"Executing query [m8qflnqsy9lpbo27gk]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.164Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T21:23:14.166Z"}
{"level":"debug","message":"Executing query [m8qflnqvcm46ohflatm]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.167Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8qflnqvcm46ohflatm]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T21:23:14.169Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T21:23:14.169Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T21:23:14.169Z"}
{"level":"debug","message":"Executing query [m8qflnqzd501e4kniwk]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.171Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8qflnqzd501e4kniwk]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T21:23:14.173Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T21:23:14.173Z"}
{"level":"debug","message":"Executing query [m8qflnr2ztwgoj3x1sm]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.174Z"}
{"level":"debug","message":"Executing query [m8qflnr5wfio25t2h9]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-26T21:23:14.177Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8qflnr2ztwgoj3x1sm]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T21:23:14.176Z"}
{"level":"debug","message":"Executing query [m8qflnr4hkgf3qed35]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1038]","timestamp":"2025-03-26T21:23:14.176Z"}
{"level":"debug","message":"Executing query [m8qflnr8d0avw3i2r8]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T21:23:14.180Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T21:23:14.176Z"}
{"level":"debug","message":"Executing query [m8qflnr4qht3mt5m0d]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.176Z"}
{"level":"debug","message":"Executing query [m8qflnrathjokrz8xp]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T21:23:14.182Z"}
{"level":"debug","message":"Executing query [m8qflnr9vbfnpc8989]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1038]","timestamp":"2025-03-26T21:23:14.181Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T21:23:14.185Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8qflnr4qht3mt5m0d]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T21:23:14.178Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T21:23:14.179Z"}
{"level":"debug","message":"Executing query [m8qflnr7f7dr5rwrgdv]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.179Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8qflnr7f7dr5rwrgdv]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T21:23:14.181Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T21:23:14.182Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T21:23:14.182Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T21:23:14.183Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T21:23:14.183Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T21:23:14.183Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T21:23:14.184Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T21:23:14.184Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T21:23:14.184Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T21:23:14.184Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T21:23:14.184Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T21:23:14.184Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T21:23:14.184Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T21:23:14.185Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T21:23:14.185Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T21:23:14.185Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T21:23:14.185Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T21:23:14.185Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T21:23:14.185Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T21:23:14.185Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T21:23:14.188Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T21:23:14.122Z"}
{"level":"debug","message":"Executing query [m8qflnsim8qlwteval]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T21:23:14.226Z"}
{"level":"debug","message":"Executing query [m8qflnsm1n8atvwdc27]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T21:23:14.231Z"}
{"level":"debug","message":"Executing query [m8qflnsqnjcquab397]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T21:23:14.234Z"}
{"level":"debug","message":"Executing query [m8qflnt54rhrs2yg00q]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1038]","timestamp":"2025-03-26T21:23:14.250Z"}
{"level":"debug","message":"Executing query [m8qflnt8sspj0zmhdel]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1038]","timestamp":"2025-03-26T21:23:14.252Z"}
{"level":"debug","message":"Executing query [m8qflntatkgklnhedck]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1038]","timestamp":"2025-03-26T21:23:14.254Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:13.558Z"}
{"level":"debug","message":"Executing query [m8qflnu5w6ojvgqfto]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1038]","timestamp":"2025-03-26T21:23:14.285Z"}
{"level":"debug","message":"Executing query [m8qflnu8c0pylk13hng]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T21:23:14.288Z"}
{"level":"debug","message":"Executing query [m8qflnuajkhotjvuxdm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T21:23:14.290Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T21:23:14.293Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:13.559Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T21:23:14.357Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T21:23:14.360Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T21:23:14.425Z"}
{"duration":"51ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T21:23:14.430Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:14.417Z"}
{"level":"debug","message":"Executing query [m8qflny6xwgw82b0ljk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T21:23:14.430Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T21:23:14.464Z"}
{"level":"debug","message":"Executing query [m8qflnzbss6iwc820ee]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.471Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8qflnzbss6iwc820ee]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T21:23:14.474Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T21:23:14.475Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T21:23:14.453Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T21:23:14.468Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:14.582Z"}
{"level":"debug","message":"Executing query [m8qflo2j8n4d4nvemiw]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T21:23:14.588Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T21:23:14.621Z"}
{"level":"debug","message":"Executing query [m8qflo3jtvr1q2c8trs]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.623Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8qflo3jtvr1q2c8trs]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T21:23:14.625Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T21:23:14.625Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:14.570Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:14.856Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:14.863Z"}
{"level":"debug","message":"Executing query [m8qfloa9zkx65upptps]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:14.865Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T21:23:14.890Z"}
{"level":"debug","message":"Executing query [m8qflob4qgawx92oq1r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T21:23:14.896Z"}
{"level":"debug","message":"Executing query [m8qflob7xia8eafp999]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T21:23:14.899Z"}
{"level":"debug","message":"Executing query [m8qflob9ku53npds35k]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T21:23:14.901Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T21:23:14.902Z"}
{"level":"debug","message":"Executing query [m8qflobbpoej6qo491g]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T21:23:14.903Z"}
{"level":"debug","message":"Executing query [m8qflobdvossaipt2rc]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T21:23:14.905Z"}
{"level":"debug","message":"Executing query [m8qflobgp8cabrnin7]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T21:23:14.908Z"}
{"level":"debug","message":"Executing query [m8qflobizod34ll6fq]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T21:23:14.910Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T21:23:14.915Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T21:23:14.916Z"}
{"level":"debug","message":"Executing query [m8qflobohug2bi63n4c]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T21:23:14.916Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8qflobohug2bi63n4c]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T21:23:14.919Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T21:23:14.919Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T21:23:14.919Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T21:23:14.921Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T21:23:14.922Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T21:23:14.923Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T21:23:14.924Z"}
{"level":"debug","message":"Executing query [m8qflobxubk9u29ubq]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T21:23:14.925Z"}
{"level":"debug","message":"Executing query [m8qflobzpm1z7v1sbfl]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T21:23:14.927Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T21:23:14.928Z"}
{"level":"debug","message":"Executing query [m8qfloc1sznkodjbn4]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T21:23:14.929Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T21:23:14.930Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T21:23:15.624Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T21:23:15.736Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T21:23:15.806Z"}
{"level":"debug","message":"Executing query [m8qflp1llquts5kd6km]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T21:23:15.849Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8qflp1llquts5kd6km]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T21:23:15.851Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T21:23:15.854Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T21:23:15.883Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:05:53.290Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:05:53.303Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:05:53.306Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:05:53.314Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:05:53.321Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:05:53.325Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:05:53.327Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T22:05:53.330Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T22:05:53.332Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T22:05:53.334Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T22:05:53.335Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T22:05:53.336Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T22:05:53.406Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T22:05:53.417Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:53.448Z"}
{"level":"debug","message":"Executing query [m8qh4ijggqlpk0s3ewj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:05:53.501Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:05:53.563Z"}
{"level":"debug","message":"Executing query [m8qh4ilbqlfcv48kpqn]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743026753497\"]","timestamp":"2025-03-26T22:05:53.568Z"}
{"level":"debug","message":"Executing query [m8qh4ilvo297pfx8kdb]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743026753497\"]","timestamp":"2025-03-26T22:05:53.587Z"}
{"level":"debug","message":"Executing query [m8qh4ilytsttxsl9tth]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743026753497\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T22:05:53.590Z"}
{"level":"debug","message":"Executing query [m8qh4im7gu1yar01uiq]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1039]","timestamp":"2025-03-26T22:05:53.599Z"}
{"level":"debug","message":"Executing query [m8qh4imcj9lsp4y83gf]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743026753497\"]","timestamp":"2025-03-26T22:05:53.604Z"}
{"level":"debug","message":"Executing query [m8qh4imgbqrnph8bmgg]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1039]","timestamp":"2025-03-26T22:05:53.608Z"}
{"level":"debug","message":"Executing query [m8qh4imkmtcj2yeo05r]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1039]","timestamp":"2025-03-26T22:05:53.612Z"}
{"level":"debug","message":"Executing query [m8qh4ims6rvyg5n26wf]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1039]","timestamp":"2025-03-26T22:05:53.620Z"}
{"level":"debug","message":"Executing query [m8qh4imwfz8g7qf0zkv]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1039]","timestamp":"2025-03-26T22:05:53.624Z"}
{"level":"debug","message":"Executing query [m8qh4imzwze26c9bng]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1039]","timestamp":"2025-03-26T22:05:53.627Z"}
{"level":"debug","message":"Executing query [m8qh4in1f5cwjxtwao]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1039]","timestamp":"2025-03-26T22:05:53.629Z"}
{"level":"debug","message":"Executing query [m8qh4in5l38gt87cxjg]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1039]","timestamp":"2025-03-26T22:05:53.633Z"}
{"level":"debug","message":"Executing query [m8qh4in8oznvixcw5lh]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T22:05:53.636Z"}
{"level":"debug","message":"Executing query [m8qh4inapz8ckso6b]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T22:05:53.638Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:05:53.641Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:53.885Z"}
{"level":"debug","message":"Executing query [m8qh4iv3umbjxt4r84]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:53.920Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:05:53.980Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T22:05:53.987Z"}
{"level":"debug","message":"Executing query [m8qh4iwznnlzlhl72e]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:53.987Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T22:05:53.990Z"}
{"level":"debug","message":"Executing query [m8qh4ix28qim00syt9b]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:53.990Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:53.736Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T22:05:54.010Z"}
{"level":"debug","message":"Executing query [m8qh4ixogiu22bxjyn9]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:54.012Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T22:05:54.022Z"}
{"level":"debug","message":"Executing query [m8qh4ixznr20u5ua7ze]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:54.024Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T22:05:53.903Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T22:05:54.033Z"}
{"level":"debug","message":"Executing query [m8qh4iychg1wroxil4l]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:54.036Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8qh4iychg1wroxil4l]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T22:05:54.039Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T22:05:54.039Z"}
{"level":"debug","message":"Executing query [m8qh4iyf6dk6clqn663]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:54.039Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T22:05:54.042Z"}
{"level":"debug","message":"Executing query [m8qh4iyi5r7rzlb9s47]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:54.042Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T22:05:54.044Z"}
{"level":"debug","message":"Executing query [m8qh4iyklksosdzr05h]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:54.044Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8qh4iyklksosdzr05h]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T22:05:54.047Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T22:05:54.048Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T22:05:54.049Z"}
{"level":"debug","message":"Executing query [m8qh4iysk83n4urdhao]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:54.052Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8qh4iysk83n4urdhao]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T22:05:54.057Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T22:05:54.057Z"}
{"level":"debug","message":"Executing query [m8qh4iyyx127a4we4ep]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:54.058Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8qh4iyyx127a4we4ep]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T22:05:54.060Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T22:05:54.061Z"}
{"level":"debug","message":"Executing query [m8qh4iz1hb8dtjpvulm]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:54.061Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8qh4iz1hb8dtjpvulm]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T22:05:54.065Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T22:05:54.066Z"}
{"level":"debug","message":"Executing query [m8qh4iz6tfeelt6tcml]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:54.066Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8qh4iz6tfeelt6tcml]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T22:05:54.068Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T22:05:54.069Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T22:05:54.069Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T22:05:54.070Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T22:05:54.070Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T22:05:54.070Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T22:05:54.070Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T22:05:54.070Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T22:05:54.070Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T22:05:54.071Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T22:05:54.071Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T22:05:54.071Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T22:05:54.071Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T22:05:54.071Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T22:05:54.071Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T22:05:54.071Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T22:05:54.072Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T22:05:54.072Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T22:05:54.072Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T22:05:54.072Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:05:54.074Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:54.073Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:54.259Z"}
{"level":"debug","message":"Executing query [m8qh4j4n6aufrx1i5t6]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:05:54.264Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:05:54.331Z"}
{"level":"debug","message":"Executing query [m8qh4j6p9gzl9y6q7h]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:54.338Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8qh4j6p9gzl9y6q7h]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T22:05:54.340Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T22:05:54.341Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T22:05:54.379Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:54.395Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:54.439Z"}
{"level":"debug","message":"Executing query [m8qh4jaj3j8lcbxd50i]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:05:54.476Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:05:54.500Z"}
{"level":"debug","message":"Executing query [m8qh4jbggt62b7pbg1j]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T22:05:54.509Z"}
{"level":"debug","message":"Executing query [m8qh4jbkb1vjsntkwjp]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T22:05:54.512Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8qh4jbkb1vjsntkwjp]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T22:05:54.515Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:05:54.518Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:05:54.544Z"}
{"level":"debug","message":"Executing query [m8qh4jclsyu12zvrxem]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:54.549Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T22:05:54.553Z"}
{"level":"debug","message":"Executing query [m8qh4jcqplwxv70of]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T22:05:54.554Z"}
{"level":"debug","message":"Executing query [m8qh4jcskcn1ayj22o]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T22:05:54.556Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T22:05:54.558Z"}
{"level":"debug","message":"Executing query [m8qh4jcuti3raup8up]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:54.558Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T22:05:54.561Z"}
{"level":"debug","message":"Executing query [m8qh4jd1ynrbtt0zaz]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T22:05:54.565Z"}
{"level":"debug","message":"Executing query [m8qh4jd5ohp8ijc3zd9]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T22:05:54.569Z"}
{"level":"debug","message":"Executing query [m8qh4jd74xuxofa0q79]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T22:05:54.571Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:54.825Z"}
{"level":"debug","message":"Executing query [m8qh4jkf9bmtll5zbpp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:05:54.832Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:54.814Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:05:54.876Z"}
{"level":"debug","message":"Executing query [m8qh4jl7grajhr859oo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:05:54.859Z"}
{"level":"debug","message":"Executing query [m8qh4jlqo5y93ylb65i]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743026754830\"]","timestamp":"2025-03-26T22:05:54.878Z"}
{"level":"debug","message":"Executing query [m8qh4jlss9oae0qti6c]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743026754830\",true]","timestamp":"2025-03-26T22:05:54.880Z"}
{"level":"debug","message":"Executing query [m8qh4jlzpwwq8arnser]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-26T22:05:54.887Z"}
{"level":"debug","message":"Executing query [m8qh4jm29z5q1b5ypyc]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743026754830\"]","timestamp":"2025-03-26T22:05:54.890Z"}
{"level":"debug","message":"Executing query [m8qh4jm4qg8ecwojlxp]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",41]","timestamp":"2025-03-26T22:05:54.892Z"}
{"level":"debug","message":"Executing query [m8qh4jm8kq5bcik6cj]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-26T22:05:54.896Z"}
{"level":"debug","message":"Executing query [m8qh4jmaheih23iqgbo]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-26T22:05:54.898Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T22:05:54.549Z"}
{"level":"debug","message":"Executing query [m8qh4jme1bql5nq1q6f]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-26T22:05:54.902Z"}
{"level":"debug","message":"Executing query [m8qh4jmgcvc6wo1f3i]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-26T22:05:54.905Z"}
{"level":"debug","message":"Executing query [m8qh4jmjisdmum16ysd]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-26T22:05:54.907Z"}
{"level":"debug","message":"Executing query [m8qh4jmnlfeqn9fm9y]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-26T22:05:54.911Z"}
{"level":"debug","message":"Executing query [m8qh4jmpou3ovc6x2x]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T22:05:54.913Z"}
{"level":"debug","message":"Executing query [m8qh4jmr56ex3hfb4cn]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T22:05:54.915Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T22:05:54.550Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T22:05:54.551Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T22:05:54.552Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T22:05:54.554Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T22:05:54.554Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:05:54.917Z"}
{"level":"debug","message":"Executing query [m8qh4jnaf9mwcy89fn]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:54.934Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:05:54.936Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8qh4jnaf9mwcy89fn]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T22:05:54.938Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T22:05:54.939Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:54.958Z"}
{"level":"debug","message":"Executing query [m8qh4jo2fegit6myazi]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:05:54.962Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:05:54.988Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:54.980Z"}
{"level":"debug","message":"Executing query [m8qh4joyx3klycdgv6]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:54.994Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8qh4joyx3klycdgv6]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T22:05:54.996Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T22:05:54.997Z"}
{"level":"debug","message":"Executing query [m8qh4jop9m1d4vru71f]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:05:54.985Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:05:55.010Z"}
{"level":"debug","message":"Executing query [m8qh4jpk9ofxis03jg]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:55.016Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8qh4jpk9ofxis03jg]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T22:05:55.022Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T22:05:55.024Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:55.111Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:55.493Z"}
{"level":"debug","message":"Executing query [m8qh4k4nglfehorbb99]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:05:55.559Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:05:55.605Z"}
{"level":"debug","message":"Executing query [m8qh4k643hczhvzamj6]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:55.612Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8qh4k643hczhvzamj6]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T22:05:55.615Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T22:05:55.615Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:55.687Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:55.732Z"}
{"level":"debug","message":"Executing query [m8qh4k9jng5e0a0tsif]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:55.735Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:05:55.772Z"}
{"level":"debug","message":"Executing query [m8qh4kb8o48cs5ecdv]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:05:55.796Z"}
{"level":"debug","message":"Executing query [m8qh4kbetmvknq72bbp]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T22:05:55.802Z"}
{"level":"debug","message":"Executing query [m8qh4kbpzlwxwxktqw]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T22:05:55.813Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T22:05:55.815Z"}
{"level":"debug","message":"Executing query [m8qh4kbrsoson9f9yqh]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T22:05:55.815Z"}
{"level":"debug","message":"Executing query [m8qh4kbt0d8u79fe3x7c]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T22:05:55.817Z"}
{"level":"debug","message":"Executing query [m8qh4kbwuitpswffxeh]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T22:05:55.820Z"}
{"level":"debug","message":"Executing query [m8qh4kbxezmsc2cs99h]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T22:05:55.821Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T22:05:55.829Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T22:05:55.830Z"}
{"level":"debug","message":"Executing query [m8qh4kc6w0oorxwdge]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T22:05:55.830Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8qh4kc6w0oorxwdge]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T22:05:55.832Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T22:05:55.832Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T22:05:55.832Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T22:05:55.834Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T22:05:55.835Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T22:05:55.836Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T22:05:55.836Z"}
{"level":"debug","message":"Executing query [m8qh4kcdznip1pwasl]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T22:05:55.837Z"}
{"level":"debug","message":"Executing query [m8qh4kcf7i5mq92mg6f]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T22:05:55.839Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T22:05:55.841Z"}
{"level":"debug","message":"Executing query [m8qh4kch3ydz3km84ug]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T22:05:55.841Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:05:55.843Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:55.706Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T22:05:56.083Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T22:05:56.105Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:05:56.305Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T22:05:56.320Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:05:56.378Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:56.656Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T22:05:56.852Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:05:56.943Z"}
{"level":"debug","message":"Executing query [m8qh4l81p6mbyx77si]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T22:05:56.977Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8qh4l81p6mbyx77si]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T22:05:56.980Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T22:05:56.983Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:05:57.011Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:57.400Z"}
{"duration":"11ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T22:05:57.569Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:05:57.570Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T22:05:57.574Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:05:57.578Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:05:57.691Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:05:57.797Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T22:05:57.799Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:13:47.772Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:13:47.782Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:13:47.788Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:13:47.792Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:13:47.794Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:13:47.797Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:13:47.800Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T22:13:47.803Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T22:13:47.806Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T22:13:47.808Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T22:13:47.811Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T22:13:47.813Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T22:13:47.949Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T22:13:47.963Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:47.973Z"}
{"level":"debug","message":"Executing query [m8qheoorb9mv7b5mn5p]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:13:48.028Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:13:48.095Z"}
{"level":"debug","message":"Executing query [m8qheoqpseqfm7c4ki]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743027228023\"]","timestamp":"2025-03-26T22:13:48.098Z"}
{"level":"debug","message":"Executing query [m8qheorfjj2vq3sn4j]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743027228023\"]","timestamp":"2025-03-26T22:13:48.123Z"}
{"level":"debug","message":"Executing query [m8qheorih7sfer7skwr]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743027228023\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T22:13:48.126Z"}
{"level":"debug","message":"Executing query [m8qheorrs5cqoxg1x3n]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1040]","timestamp":"2025-03-26T22:13:48.135Z"}
{"level":"debug","message":"Executing query [m8qheory02y4g5inhnpr]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743027228023\"]","timestamp":"2025-03-26T22:13:48.142Z"}
{"level":"debug","message":"Executing query [m8qheos309cfm8m4j5qj]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1040]","timestamp":"2025-03-26T22:13:48.147Z"}
{"level":"debug","message":"Executing query [m8qheos8hztbfe9hpu9]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1040]","timestamp":"2025-03-26T22:13:48.152Z"}
{"level":"debug","message":"Executing query [m8qheosibpts8ddabqj]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1040]","timestamp":"2025-03-26T22:13:48.162Z"}
{"level":"debug","message":"Executing query [m8qheosmzgpj5xyie89]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1040]","timestamp":"2025-03-26T22:13:48.166Z"}
{"level":"debug","message":"Executing query [m8qheosqjb463m22w4]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1040]","timestamp":"2025-03-26T22:13:48.170Z"}
{"level":"debug","message":"Executing query [m8qheostp2y47wy2dcg]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1040]","timestamp":"2025-03-26T22:13:48.173Z"}
{"level":"debug","message":"Executing query [m8qheosx5rm2acx70cc]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1040]","timestamp":"2025-03-26T22:13:48.178Z"}
{"level":"debug","message":"Executing query [m8qheot0wy7bsna0q6]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T22:13:48.180Z"}
{"level":"debug","message":"Executing query [m8qheot5c7v09w1qzpk]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T22:13:48.185Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:13:48.188Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:48.180Z"}
{"level":"debug","message":"Executing query [m8qheouhzccdfc62tr]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:48.233Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:13:48.304Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T22:13:48.311Z"}
{"level":"debug","message":"Executing query [m8qheowo0mhx4y2rybs]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:48.313Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T22:13:48.315Z"}
{"level":"debug","message":"Executing query [m8qheowsweluokct9q]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:48.316Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T22:13:48.317Z"}
{"level":"debug","message":"Executing query [m8qheowu3o5d5r5m1xv]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:48.318Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T22:13:48.321Z"}
{"level":"debug","message":"Executing query [m8qheowyhsserfm1d1b]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:48.322Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T22:13:48.324Z"}
{"level":"debug","message":"Executing query [m8qheox0hbqld0c15n]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:48.324Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8qheox0hbqld0c15n]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T22:13:48.326Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T22:13:48.327Z"}
{"level":"debug","message":"Executing query [m8qheox3mmcbocw81m]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:48.327Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T22:13:48.329Z"}
{"level":"debug","message":"Executing query [m8qheox6lb2b3kfr48g]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:48.330Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T22:13:48.331Z"}
{"level":"debug","message":"Executing query [m8qheox7h1t22wg3bze]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:48.331Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8qheox7h1t22wg3bze]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T22:13:48.334Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T22:13:48.334Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T22:13:48.334Z"}
{"level":"debug","message":"Executing query [m8qheoxcti82qdyzqx]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:48.336Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8qheoxcti82qdyzqx]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T22:13:48.338Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T22:13:48.338Z"}
{"level":"debug","message":"Executing query [m8qheoxe92gfz0ryjfb]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:48.338Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8qheoxe92gfz0ryjfb]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T22:13:48.340Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T22:13:48.341Z"}
{"level":"debug","message":"Executing query [m8qheoxhmnvntygkjel]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:48.341Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8qheoxhmnvntygkjel]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T22:13:48.342Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T22:13:48.343Z"}
{"level":"debug","message":"Executing query [m8qheoxj4e8karwnwt5]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:48.343Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8qheoxj4e8karwnwt5]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T22:13:48.345Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T22:13:48.345Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T22:13:48.346Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T22:13:48.347Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T22:13:48.348Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T22:13:48.348Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T22:13:48.348Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T22:13:48.348Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T22:13:48.349Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T22:13:48.349Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T22:13:48.349Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T22:13:48.349Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T22:13:48.349Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T22:13:48.349Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T22:13:48.350Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T22:13:48.350Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T22:13:48.350Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T22:13:48.350Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T22:13:48.350Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T22:13:48.350Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:13:48.352Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:48.132Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:48.523Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:48.711Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T22:13:48.678Z"}
{"level":"debug","message":"Executing query [m8qhep98g8os7vorkep]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:13:48.765Z"}
{"level":"debug","message":"Executing query [m8qhepb0lk3soh97wpm]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:48.828Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:13:48.832Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T22:13:48.839Z"}
{"level":"debug","message":"Executing query [m8qhepbcii2dafme1g]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T22:13:48.840Z"}
{"level":"debug","message":"Executing query [m8qhepbf5nesyzfutxm]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T22:13:48.843Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T22:13:48.845Z"}
{"level":"debug","message":"Executing query [m8qhepbhxndecmw6pwb]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:48.845Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T22:13:48.848Z"}
{"level":"debug","message":"Executing query [m8qhepdr8v184v79csy]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T22:13:48.927Z"}
{"level":"debug","message":"Executing query [m8qhepdxrrl04wdk1pb]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T22:13:48.933Z"}
{"level":"debug","message":"Executing query [m8qhepe04gr9yor2f21]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T22:13:48.936Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:49.070Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T22:13:48.968Z"}
{"level":"debug","message":"Executing query [m8qhepht1hwp3y6njmm]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:13:49.073Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:13:49.121Z"}
{"level":"debug","message":"Executing query [m8qhepja3m5at31lwos]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:49.126Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8qhepja3m5at31lwos]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T22:13:49.129Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T22:13:49.129Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:49.113Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:13:49.220Z"}
{"level":"debug","message":"Executing query [m8qhepm4cgbfofkvohk]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T22:13:49.228Z"}
{"level":"debug","message":"Executing query [m8qhepm84pxdoza3sr7]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T22:13:49.232Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8qhepm84pxdoza3sr7]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T22:13:49.235Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:13:49.239Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T22:13:49.874Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T22:13:49.876Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T22:13:49.877Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T22:13:49.877Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T22:13:49.878Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T22:13:49.878Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:50.183Z"}
{"level":"debug","message":"Executing query [m8qheqdqfai043xd9je]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:13:50.222Z"}
{"level":"debug","message":"Executing query [m8qheqexk1xtojsbkom]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:50.266Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:13:50.268Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8qheqexk1xtojsbkom]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T22:13:50.269Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T22:13:50.270Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:49.890Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:50.376Z"}
{"level":"debug","message":"Executing query [m8qheqi7p552twnwhs]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:13:50.383Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:13:50.415Z"}
{"level":"debug","message":"Executing query [m8qheqj7pofuz2o7u5]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743027230380\"]","timestamp":"2025-03-26T22:13:50.420Z"}
{"level":"debug","message":"Executing query [m8qheqjblaszz5ek16p]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743027230380\",true]","timestamp":"2025-03-26T22:13:50.423Z"}
{"level":"debug","message":"Executing query [m8qheqjh27btzr58hwm]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[42]","timestamp":"2025-03-26T22:13:50.429Z"}
{"level":"debug","message":"Executing query [m8qheqjnp8o02371k0q]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743027230380\"]","timestamp":"2025-03-26T22:13:50.435Z"}
{"level":"debug","message":"Executing query [m8qheqjyz5g3le05fbm]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",42]","timestamp":"2025-03-26T22:13:50.446Z"}
{"level":"debug","message":"Executing query [m8qheqk2q6ecpvse12]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[42]","timestamp":"2025-03-26T22:13:50.450Z"}
{"level":"debug","message":"Executing query [m8qheqk63p59hrpyabi]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[42]","timestamp":"2025-03-26T22:13:50.454Z"}
{"level":"debug","message":"Executing query [m8qheqkatov6hcoz6uj]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[42]","timestamp":"2025-03-26T22:13:50.458Z"}
{"level":"debug","message":"Executing query [m8qheqkdmor4r4he0l]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[42]","timestamp":"2025-03-26T22:13:50.461Z"}
{"level":"debug","message":"Executing query [m8qheqkfrtt74abq7g]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[42]","timestamp":"2025-03-26T22:13:50.463Z"}
{"level":"debug","message":"Executing query [m8qheqkkpppo3sndqvt]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[42]","timestamp":"2025-03-26T22:13:50.468Z"}
{"level":"debug","message":"Executing query [m8qheqkm93x9djokwv]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T22:13:50.470Z"}
{"level":"debug","message":"Executing query [m8qheqkodbwltnk62oc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T22:13:50.472Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:13:50.474Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T22:13:50.177Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T22:13:50.197Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:13:50.475Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T22:13:50.579Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:13:50.695Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:50.750Z"}
{"level":"debug","message":"Executing query [m8qheqsi4u9t1qm3zn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:13:50.754Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:13:50.789Z"}
{"level":"debug","message":"Executing query [m8qheqtjdodi0h1u5xf]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:50.791Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8qheqtjdodi0h1u5xf]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T22:13:50.794Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T22:13:50.795Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:50.986Z"}
{"level":"debug","message":"Executing query [m8qheqzzbo6ru1ueis]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:13:51.023Z"}
{"level":"debug","message":"Executing query [m8qher2j9x10jfnpc3d]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:51.115Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:13:51.118Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8qher2j9x10jfnpc3d]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T22:13:51.119Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T22:13:51.120Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:50.997Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:51.311Z"}
{"level":"debug","message":"Executing query [m8qher85yhr9ap8ltod]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:13:51.317Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:13:51.337Z"}
{"level":"debug","message":"Executing query [m8qher8u57ybz699cjy]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:51.342Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8qher8u57ybz699cjy]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T22:13:51.344Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T22:13:51.344Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:51.976Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:52.003Z"}
{"level":"debug","message":"Executing query [m8qherrasuigp7bh5ss]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:52.006Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:13:52.059Z"}
{"level":"debug","message":"Executing query [m8qherszqk9da48p5th]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:13:52.067Z"}
{"level":"debug","message":"Executing query [m8qhert17586ukgj87o]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T22:13:52.069Z"}
{"level":"debug","message":"Executing query [m8qhert50cs6e7lryfs]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T22:13:52.073Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T22:13:52.075Z"}
{"level":"debug","message":"Executing query [m8qhert7u4nbfucfh0k]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T22:13:52.075Z"}
{"level":"debug","message":"Executing query [m8qhertbd94n53fcgz6]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T22:13:52.079Z"}
{"level":"debug","message":"Executing query [m8qhertdo6nn3afarhl]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T22:13:52.081Z"}
{"level":"debug","message":"Executing query [m8qhertfew97s6adto]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T22:13:52.084Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T22:13:52.089Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T22:13:52.090Z"}
{"level":"debug","message":"Executing query [m8qhertmb48ljtqozod]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T22:13:52.090Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8qhertmb48ljtqozod]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T22:13:52.092Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T22:13:52.093Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T22:13:52.093Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T22:13:52.094Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T22:13:52.095Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T22:13:52.096Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T22:13:52.096Z"}
{"level":"debug","message":"Executing query [m8qherttoq9u8tjr9m]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T22:13:52.097Z"}
{"level":"debug","message":"Executing query [m8qhertwfshypcjcr5]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T22:13:52.100Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T22:13:52.101Z"}
{"level":"debug","message":"Executing query [m8qhertyizc9j0qfcg]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T22:13:52.102Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:13:52.104Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:52.363Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T22:13:52.554Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:13:52.654Z"}
{"level":"debug","message":"Executing query [m8qhesab6acy04nvsz6]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T22:13:52.691Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8qhesab6acy04nvsz6]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T22:13:52.693Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T22:13:52.696Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:13:52.727Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:52.724Z"}
{"duration":"27ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T22:13:52.941Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:13:52.945Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T22:13:52.949Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:13:52.953Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:13:53.140Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:13:53.304Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T22:13:53.307Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-26T22:21:24.959Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-26T22:21:24.964Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:24.968Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:25.020Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:25.031Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:25.046Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:25.054Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:25.059Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:25.157Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:25.164Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:25.169Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-26T22:21:38.503Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-26T22:21:38.507Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:38.512Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:38.569Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:38.576Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:38.590Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:38.597Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:38.602Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:38.703Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:38.710Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:21:38.714Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:24:46.997Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:24:47.006Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:24:47.012Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:24:47.014Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:24:47.016Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:24:47.019Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-26T22:24:47.020Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T22:24:47.023Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T22:24:47.025Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T22:24:47.026Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-26T22:24:47.027Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-26T22:24:47.029Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-26T22:24:47.150Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-26T22:24:47.165Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:47.169Z"}
{"level":"debug","message":"Executing query [m8qhstblgp37seupxb4]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:24:47.217Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:24:47.267Z"}
{"level":"debug","message":"Executing query [m8qhstd3jaxlto4m2f]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743027887214\"]","timestamp":"2025-03-26T22:24:47.271Z"}
{"level":"debug","message":"Executing query [m8qhstdk7thytxzl55d]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743027887214\"]","timestamp":"2025-03-26T22:24:47.288Z"}
{"level":"debug","message":"Executing query [m8qhstdmbeqos2l7rw6]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743027887214\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-26T22:24:47.290Z"}
{"level":"debug","message":"Executing query [m8qhstdu92c2ue471hw]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1041]","timestamp":"2025-03-26T22:24:47.298Z"}
{"level":"debug","message":"Executing query [m8qhstdy041cijxje9ro]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743027887214\"]","timestamp":"2025-03-26T22:24:47.302Z"}
{"level":"debug","message":"Executing query [m8qhste2ntzpj7rxzbe]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1041]","timestamp":"2025-03-26T22:24:47.306Z"}
{"level":"debug","message":"Executing query [m8qhste8ynaa9n2d6sn]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1041]","timestamp":"2025-03-26T22:24:47.312Z"}
{"level":"debug","message":"Executing query [m8qhstedeaaqlyssx5a]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1041]","timestamp":"2025-03-26T22:24:47.317Z"}
{"level":"debug","message":"Executing query [m8qhstekbrnkf23ztut]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1041]","timestamp":"2025-03-26T22:24:47.324Z"}
{"level":"debug","message":"Executing query [m8qhstenrgkstny20aa]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1041]","timestamp":"2025-03-26T22:24:47.327Z"}
{"level":"debug","message":"Executing query [m8qhstep90q1mccz98s]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1041]","timestamp":"2025-03-26T22:24:47.329Z"}
{"level":"debug","message":"Executing query [m8qhstet53fe1vb9ylm]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1041]","timestamp":"2025-03-26T22:24:47.333Z"}
{"level":"debug","message":"Executing query [m8qhstev12eieut8h4r]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T22:24:47.335Z"}
{"level":"debug","message":"Executing query [m8qhstexso8vugbdos]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T22:24:47.337Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:24:47.340Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:47.459Z"}
{"level":"debug","message":"Executing query [m8qhstjgxufhgka6nf]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:47.501Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:24:47.555Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-26T22:24:47.565Z"}
{"level":"debug","message":"Executing query [m8qhstl9b7j0b4039vd]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:47.566Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-26T22:24:47.568Z"}
{"level":"debug","message":"Executing query [m8qhstlcxvg65z4ywnm]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:47.568Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-26T22:24:47.569Z"}
{"level":"debug","message":"Executing query [m8qhstleaucrzcwjji]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:47.570Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-26T22:24:47.571Z"}
{"level":"debug","message":"Executing query [m8qhstlgv3gnfbv3yup]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:47.572Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-26T22:24:47.573Z"}
{"level":"debug","message":"Executing query [m8qhstlilnjf2yxwtb]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:47.574Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.documentoarchivo' doesn't exist","level":"error","message":"Database query error [m8qhstlilnjf2yxwtb]","params":"[]","query":"SELECT 1 FROM DocumentoArchivo LIMIT 1","timestamp":"2025-03-26T22:24:47.576Z"}
{"level":"warn","message":"❌ La tabla 'DocumentoArchivo' NO existe en la base de datos.","timestamp":"2025-03-26T22:24:47.576Z"}
{"level":"debug","message":"Executing query [m8qhstlktes2kd1kti]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:47.576Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-26T22:24:47.578Z"}
{"level":"debug","message":"Executing query [m8qhstlnixskk3pbavn]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:47.579Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-26T22:24:47.580Z"}
{"level":"debug","message":"Executing query [m8qhstlozjz5ifc8oib]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:47.580Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8qhstlozjz5ifc8oib]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T22:24:47.582Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-26T22:24:47.582Z"}
{"level":"warn","message":"❌ Faltan 2 tablas estándar:\n   - DocumentoArchivo\n   - Papelera","timestamp":"2025-03-26T22:24:47.583Z"}
{"level":"debug","message":"Executing query [m8qhstlsb32frpmq52h]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:47.584Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8qhstlsb32frpmq52h]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T22:24:47.586Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'ForenseDigital' NO existe en la base de datos.","timestamp":"2025-03-26T22:24:47.587Z"}
{"level":"debug","message":"Executing query [m8qhstlvn3z9qun2wo]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:47.587Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8qhstlvn3z9qun2wo]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T22:24:47.589Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'QuimicaToxicologiaForense' NO existe en la base de datos.","timestamp":"2025-03-26T22:24:47.589Z"}
{"level":"debug","message":"Executing query [m8qhstlyic7dq08n5u]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:47.590Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8qhstlyic7dq08n5u]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T22:24:47.591Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'Dosaje' NO existe en la base de datos.","timestamp":"2025-03-26T22:24:47.592Z"}
{"level":"debug","message":"Executing query [m8qhstm0jpgxdvs95h7]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:47.592Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8qhstm0jpgxdvs95h7]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T22:24:47.593Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:47.382Z"}
{"level":"info","message":"ℹ️ La tabla especializada 'PermisoContextual' NO existe en la base de datos.","timestamp":"2025-03-26T22:24:47.594Z"}
{"level":"info","message":"ℹ️ Faltan 4 tablas especializadas:\n   - ForenseDigital\n   - QuimicaToxicologiaForense\n   - Dosaje\n   - PermisoContextual","timestamp":"2025-03-26T22:24:47.594Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-26T22:24:47.595Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-26T22:24:47.596Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-26T22:24:47.596Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-26T22:24:47.596Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-26T22:24:47.596Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-26T22:24:47.597Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-26T22:24:47.597Z"}
{"level":"info","message":"❌ DocumentoArchivo: missing","timestamp":"2025-03-26T22:24:47.597Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-26T22:24:47.597Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-26T22:24:47.597Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-26T22:24:47.597Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-26T22:24:47.597Z"}
{"level":"info","message":"ℹ️ ForenseDigital: missing","timestamp":"2025-03-26T22:24:47.597Z"}
{"level":"info","message":"ℹ️ QuimicaToxicologiaForense: missing","timestamp":"2025-03-26T22:24:47.598Z"}
{"level":"info","message":"ℹ️ Dosaje: missing","timestamp":"2025-03-26T22:24:47.598Z"}
{"level":"info","message":"ℹ️ PermisoContextual: missing","timestamp":"2025-03-26T22:24:47.598Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-26T22:24:47.598Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:24:47.600Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:47.799Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:47.800Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-26T22:24:47.773Z"}
{"level":"debug","message":"Executing query [m8qhstt6iojn7yv7or]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:24:47.850Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:24:47.899Z"}
{"level":"debug","message":"Executing query [m8qhstunxep2txd3g4h]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:47.903Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-26T22:24:47.906Z"}
{"level":"debug","message":"Executing query [m8qhsturt2n5ft4g52]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-26T22:24:47.907Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-26T22:24:47.786Z"}
{"level":"debug","message":"Executing query [m8qhstut9jqx53f4bfq]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-26T22:24:47.910Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-26T22:24:47.911Z"}
{"level":"debug","message":"Executing query [m8qhstuwnhewedv7j4r]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:47.912Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-26T22:24:47.914Z"}
{"level":"debug","message":"Executing query [m8qhstwprhxb8cszr1i]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-26T22:24:47.977Z"}
{"level":"debug","message":"Executing query [m8qhstwtm5phfd1icy]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-26T22:24:47.981Z"}
{"level":"debug","message":"Executing query [m8qhstwwytbzyr2q4lm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T22:24:47.984Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:48.021Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:24:48.122Z"}
{"level":"debug","message":"Executing query [m8qhsu0w3yh6bg4o4do]: SELECT 1 as test","params":"[]","timestamp":"2025-03-26T22:24:48.128Z"}
{"level":"debug","message":"Executing query [m8qhsu0zqhiivps3tz]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-26T22:24:48.131Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8qhsu0zqhiivps3tz]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-26T22:24:48.134Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:24:48.136Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:48.097Z"}
{"level":"debug","message":"Executing query [m8qhsu14iv1nprr4xn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:24:48.136Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:24:48.196Z"}
{"level":"debug","message":"Executing query [m8qhsu31vz91ph4aq28]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:48.205Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.dosaje' doesn't exist","level":"error","message":"Database query error [m8qhsu31vz91ph4aq28]","params":"[]","query":"SELECT 1 FROM Dosaje LIMIT 1","timestamp":"2025-03-26T22:24:48.208Z"}
{"level":"warn","message":"La tabla Dosaje no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T22:24:48.208Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:48.260Z"}
{"level":"debug","message":"Executing query [m8qhsu4oi5keu4bx2zn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:24:48.264Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:24:48.285Z"}
{"level":"debug","message":"Executing query [m8qhsu5b80ahnhgltla]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:48.287Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.forensedigital' doesn't exist","level":"error","message":"Database query error [m8qhsu5b80ahnhgltla]","params":"[]","query":"SELECT 1 FROM ForenseDigital LIMIT 1","timestamp":"2025-03-26T22:24:48.289Z"}
{"level":"warn","message":"La tabla ForenseDigital no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T22:24:48.289Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-26T22:24:48.382Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-26T22:24:48.383Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-26T22:24:48.384Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-26T22:24:48.387Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-26T22:24:48.388Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-26T22:24:48.388Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:48.599Z"}
{"level":"debug","message":"Executing query [m8qhsue3sz8ypi0takc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:24:48.603Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:24:48.631Z"}
{"level":"debug","message":"Executing query [m8qhsueza2vg6k352m7]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743027888601\"]","timestamp":"2025-03-26T22:24:48.635Z"}
{"level":"debug","message":"Executing query [m8qhsuf1goggwkzyis9]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743027888601\",true]","timestamp":"2025-03-26T22:24:48.637Z"}
{"level":"debug","message":"Executing query [m8qhsuf6doyi184v1tb]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-26T22:24:48.642Z"}
{"level":"debug","message":"Executing query [m8qhsufajqje4wg6tu]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743027888601\"]","timestamp":"2025-03-26T22:24:48.646Z"}
{"level":"debug","message":"Executing query [m8qhsufcfhim8ohvvxb]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",43]","timestamp":"2025-03-26T22:24:48.648Z"}
{"level":"debug","message":"Executing query [m8qhsufftb6ltwqxz8d]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-26T22:24:48.652Z"}
{"level":"debug","message":"Executing query [m8qhsufinztlou5bsmp]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-26T22:24:48.654Z"}
{"level":"debug","message":"Executing query [m8qhsufllmtuewfnk2e]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-26T22:24:48.657Z"}
{"level":"debug","message":"Executing query [m8qhsufnwz66hqpnq5h]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-26T22:24:48.659Z"}
{"level":"debug","message":"Executing query [m8qhsufqvtnfjkqyior]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-26T22:24:48.662Z"}
{"level":"debug","message":"Executing query [m8qhsuftj9vw69t3fe]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-26T22:24:48.665Z"}
{"level":"debug","message":"Executing query [m8qhsufv5aog6kxwu7r]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-26T22:24:48.667Z"}
{"level":"debug","message":"Executing query [m8qhsufxls8rsklzl3r]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T22:24:48.669Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:24:48.670Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:48.657Z"}
{"level":"debug","message":"Executing query [m8qhsufpvs5y8l9ytno]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:24:48.661Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:24:48.738Z"}
{"level":"debug","message":"Executing query [m8qhsuhyh400y5hhgb]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:48.742Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8qhsuhyh400y5hhgb]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-26T22:24:48.745Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T22:24:48.746Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:48.740Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:48.872Z"}
{"level":"debug","message":"Executing query [m8qhsumiiewsqoumyw]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:24:48.906Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:24:48.944Z"}
{"level":"debug","message":"Executing query [m8qhsunpvhoumcwh7ab]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:48.949Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8qhsunpvhoumcwh7ab]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T22:24:48.951Z"}
{"level":"warn","message":"La tabla PermisoContextual no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T22:24:48.951Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:48.970Z"}
{"level":"debug","message":"Executing query [m8qhsuomhtya7o8pd1q]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:24:48.982Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:24:49.003Z"}
{"level":"debug","message":"Executing query [m8qhsup9td26fk0x3q]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:49.005Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.quimicatoxicologiaforense' doesn't exist","level":"error","message":"Database query error [m8qhsup9td26fk0x3q]","params":"[]","query":"SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","timestamp":"2025-03-26T22:24:49.007Z"}
{"level":"warn","message":"La tabla QuimicaToxicologiaForense no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-26T22:24:49.007Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:48.836Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T22:24:49.258Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-26T22:24:49.283Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:24:49.548Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-26T22:24:49.581Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:49.579Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:49.613Z"}
{"level":"debug","message":"Executing query [m8qhsv679hmo6zb0s5h]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:49.615Z"}
{"level":"debug","message":"Executing query [m8qhsv6sag9gpstl17g]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-26T22:24:49.637Z"}
{"level":"debug","message":"Executing query [m8qhsv6urdo24zeo9c]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-26T22:24:49.638Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:24:49.640Z"}
{"level":"debug","message":"Executing query [m8qhsv6xtwblrh3bqof]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-26T22:24:49.641Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-26T22:24:49.642Z"}
{"level":"debug","message":"Executing query [m8qhsv6z4jxg9g2ld8y]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T22:24:49.643Z"}
{"level":"debug","message":"Executing query [m8qhsv70hotv6g4m9of]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T22:24:49.644Z"}
{"level":"debug","message":"Executing query [m8qhsv72rupkm0yjgjb]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T22:24:49.647Z"}
{"level":"debug","message":"Executing query [m8qhsv74ng5w5sohlvi]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-26T22:24:49.648Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Rango\",\"PasswordHash\",\"Salt\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-26T22:24:49.653Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T22:24:49.653Z"}
{"level":"debug","message":"Executing query [m8qhsv79fevu3m97nb8]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-26T22:24:49.653Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'Salt' doesn't have a default value","level":"error","message":"Database query error [m8qhsv79fevu3m97nb8]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-26T22:24:49.655Z"}
{"level":"error","message":"Error al crear usuario: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T22:24:49.655Z"}
{"level":"warn","message":"La prueba no pudo crear un usuario debido a restricciones de la base de datos: Field 'Salt' doesn't have a default value","timestamp":"2025-03-26T22:24:49.655Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T22:24:49.657Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T22:24:49.658Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T22:24:49.659Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-26T22:24:49.659Z"}
{"level":"debug","message":"Executing query [m8qhsv7g3n5rhgpzt0b]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-26T22:24:49.660Z"}
{"level":"debug","message":"Executing query [m8qhsv7hv12p6x19zhc]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-26T22:24:49.661Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-26T22:24:49.663Z"}
{"level":"debug","message":"Executing query [m8qhsv7jsr3x970bj9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-26T22:24:49.663Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:24:49.665Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:24:49.677Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:50.051Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-26T22:24:50.196Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:24:50.319Z"}
{"level":"debug","message":"Executing query [m8qhsvqr56ylprwib7h]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-26T22:24:50.356Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.permisocontextual' doesn't exist","level":"error","message":"Database query error [m8qhsvqr56ylprwib7h]","params":"[]","query":"SELECT 1 FROM PermisoContextual LIMIT 1","timestamp":"2025-03-26T22:24:50.359Z"}
{"level":"warn","message":"Omitiendo prueba de permisos contextuales porque la tabla no existe","timestamp":"2025-03-26T22:24:50.362Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:24:50.388Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:51.043Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-26T22:24:51.208Z"}
{"duration":"25ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-26T22:24:51.211Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-26T22:24:51.215Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:24:51.219Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-26T22:24:51.242Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-26T22:24:51.350Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-26T22:24:51.352Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-26T22:26:05.530Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-26T22:26:05.533Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:26:05.537Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:26:05.578Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:26:05.584Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:26:05.615Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:26:05.622Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:26:05.628Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:26:05.633Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:26:05.641Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:26:05.723Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:26:05.731Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:26:05.735Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-26T22:44:31.568Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-26T22:44:31.571Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:44:31.574Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:44:31.613Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:44:31.618Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:44:31.627Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:44:31.633Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:44:31.636Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:44:31.710Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:44:31.719Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-26T22:44:31.723Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-27T07:20:05.424Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-27T07:20:05.427Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-27T07:20:05.430Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-27T07:20:05.572Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-27T07:20:05.576Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-27T07:20:05.588Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-27T07:20:05.593Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-27T07:20:05.597Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-27T07:20:05.676Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-27T07:20:05.683Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-27T07:20:05.687Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:21.948Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-27T07:20:22.027Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-27T07:20:22.063Z","userId":1,"userRole":"USER"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T07:20:22.023Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T07:20:22.032Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T07:20:22.035Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T07:20:22.037Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T07:20:22.041Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T07:20:22.044Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T07:20:22.046Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T07:20:22.049Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T07:20:22.051Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T07:20:22.058Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T07:20:22.061Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-27T07:20:22.064Z"}
{"level":"debug","message":"Executing query [m8r0xkoqnl13vusfac]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T07:20:22.011Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T07:20:22.105Z"}
{"level":"debug","message":"Executing query [m8r0xkrhn7f0sa1n3gn]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743060022007\"]","timestamp":"2025-03-27T07:20:22.110Z"}
{"level":"debug","message":"Executing query [m8r0xks0w26e9qb3po]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743060022007\"]","timestamp":"2025-03-27T07:20:22.128Z"}
{"level":"debug","message":"Executing query [m8r0xks3s73migmumca]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743060022007\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-27T07:20:22.131Z"}
{"level":"debug","message":"Executing query [m8r0xksohe54425g04]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-27T07:20:22.152Z"}
{"level":"debug","message":"Executing query [m8r0xkss4hh4d9i5vx7]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743060022007\"]","timestamp":"2025-03-27T07:20:22.156Z"}
{"level":"debug","message":"Executing query [m8r0xksw7igo7gb28y3]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1005]","timestamp":"2025-03-27T07:20:22.160Z"}
{"level":"debug","message":"Executing query [m8r0xkt1844002rfy6a]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-27T07:20:22.165Z"}
{"level":"debug","message":"Executing query [m8r0xkt63xp8jo9r6yb]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-27T07:20:22.170Z"}
{"level":"debug","message":"Executing query [m8r0xktbsovxzj112g]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-27T07:20:22.175Z"}
{"level":"debug","message":"Executing query [m8r0xkte90bv77vconb]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-27T07:20:22.178Z"}
{"level":"debug","message":"Executing query [m8r0xktgos8jgebrjjq]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-27T07:20:22.180Z"}
{"level":"debug","message":"Executing query [m8r0xktk2zhqwk95ezx]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-27T07:20:22.184Z"}
{"level":"debug","message":"Executing query [m8r0xktmjcpy91zff8b]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-27T07:20:22.186Z"}
{"level":"debug","message":"Executing query [m8r0xktpiv7j8nd91a]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T07:20:22.189Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T07:20:22.191Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:22.470Z"}
{"level":"debug","message":"Executing query [m8r0xl23qswt6flvtr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T07:20:22.491Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T07:20:22.523Z"}
{"level":"debug","message":"Executing query [m8r0xl3452m70ef241]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:22.528Z"}
{"level":"debug","message":"Executing query [m8r0xl39llx8bbv1a6]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-27T07:20:22.533Z"}
{"level":"debug","message":"Executing query [m8r0xl3b5v6k08h4fv9]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-27T07:20:22.536Z"}
{"level":"debug","message":"Executing query [m8r0xl3d5hxsumtops6]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:22.538Z"}
{"level":"info","message":"Usando Mesa ID: 1, Áreas ID: 1/2, Usuarios ID: 1/2, Documento ID: 7","timestamp":"2025-03-27T07:20:22.539Z"}
{"level":"debug","message":"Executing query [m8r0xl3gj0t7wznpll]: DELETE FROM Derivacion WHERE IDDocumento = ? AND IDAreaOrigen = ? AND IDAreaDestino = ?","params":"[7,1,2]","timestamp":"2025-03-27T07:20:22.540Z"}
{"level":"debug","message":"Executing query [m8r0xl3j1ab582vhy8sj]: INSERT INTO Derivacion (\n          IDDocumento, IDMesaPartes, IDAreaOrigen, IDAreaDestino, \n          IDUsuarioDeriva, EstadoDerivacion, Observacion\n        ) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[7,1,1,2,1,\"PENDIENTE\",\"Derivación creada para pruebas automatizadas\"]","timestamp":"2025-03-27T07:20:22.543Z"}
{"level":"debug","message":"Executing query [m8r0xl3qpii9urt09hl]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[11]","timestamp":"2025-03-27T07:20:22.550Z"}
{"level":"debug","message":"Executing query [m8r0xl3ui3zmh8pd5z]: UPDATE Derivacion SET EstadoDerivacion = ?, Observacion = ?, FechaRecepcion = ?, IDUsuarioRecibe = ? WHERE IDDerivacion = ?","params":"[\"RECIBIDO\",\"Derivación actualizada en pruebas\",\"2025-03-27 07:20:22\",2,11]","timestamp":"2025-03-27T07:20:22.554Z"}
{"level":"debug","message":"Executing query [m8r0xl3x1l39p7phul9]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[11]","timestamp":"2025-03-27T07:20:22.557Z"}
{"level":"debug","message":"Executing query [m8r0xl40tw31m8f4ff]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-27T07:20:22.560Z"}
{"level":"debug","message":"Executing query [m8r0xl43idq6je04wk]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-27T07:20:22.563Z"}
{"level":"debug","message":"Executing query [m8r0xl467hxq1v9ylmt]: DELETE FROM Derivacion WHERE IDDerivacion = ?","params":"[11]","timestamp":"2025-03-27T07:20:22.566Z"}
{"level":"debug","message":"Executing query [m8r0xl493x764ngsqad]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[11]","timestamp":"2025-03-27T07:20:22.569Z"}
{"level":"debug","message":"Executing query [m8r0xl4bxbm29cvwewh]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[7]","timestamp":"2025-03-27T07:20:22.571Z"}
{"level":"debug","message":"Executing query [m8r0xl4g3p2jwd1ljly]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T07:20:22.576Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:22.677Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:22.694Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T07:20:22.811Z"}
{"level":"debug","message":"Executing query [m8r0xl9aadtd45xmy94]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:22.750Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T07:20:22.810Z"}
{"level":"debug","message":"Executing query [m8r0xlb7lacu6tl861]: SELECT 1 as test","params":"[]","timestamp":"2025-03-27T07:20:22.819Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-27T07:20:22.816Z"}
{"level":"debug","message":"Executing query [m8r0xlb5t8oecxw5ifj]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:22.817Z"}
{"level":"debug","message":"Executing query [m8r0xlba7kuxjlhkqw]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-27T07:20:22.822Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-27T07:20:22.821Z"}
{"level":"debug","message":"Executing query [m8r0xlb91i7w5w2tgt1]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:22.821Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8r0xlba7kuxjlhkqw]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-27T07:20:22.826Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-27T07:20:22.824Z"}
{"level":"debug","message":"Executing query [m8r0xlbcybhes2x1vec]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:22.824Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T07:20:22.829Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-27T07:20:22.827Z"}
{"level":"debug","message":"Executing query [m8r0xlbgaij28xufy9]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:22.828Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-27T07:20:22.831Z"}
{"level":"debug","message":"Executing query [m8r0xlbj2fng2578b15]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:22.832Z"}
{"level":"info","message":"✅ La tabla 'DocumentoArchivo' existe en la base de datos.","timestamp":"2025-03-27T07:20:22.839Z"}
{"level":"debug","message":"Executing query [m8r0xlbruk8yrml0i3]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:22.839Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-27T07:20:22.842Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:22.784Z"}
{"level":"debug","message":"Executing query [m8r0xlbxao3ykfhxgza]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:22.846Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-27T07:20:22.863Z"}
{"level":"debug","message":"Executing query [m8r0xlcgfvnwled64c]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:22.864Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8r0xlcgfvnwled64c]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-27T07:20:22.869Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-27T07:20:22.869Z"}
{"level":"warn","message":"❌ Faltan 1 tablas estándar:\n   - Papelera","timestamp":"2025-03-27T07:20:22.870Z"}
{"level":"debug","message":"Executing query [m8r0xlcoc58defcgaz]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:22.872Z"}
{"level":"info","message":"✅ La tabla especializada 'ForenseDigital' existe en la base de datos.","timestamp":"2025-03-27T07:20:22.879Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-27T07:20:22.766Z"}
{"level":"debug","message":"Executing query [m8r0xld3gp1qfjipush]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:22.892Z"}
{"level":"info","message":"✅ La tabla especializada 'QuimicaToxicologiaForense' existe en la base de datos.","timestamp":"2025-03-27T07:20:22.898Z"}
{"level":"debug","message":"Executing query [m8r0xldevg3e7pbk5uh]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:22.898Z"}
{"level":"info","message":"✅ La tabla especializada 'Dosaje' existe en la base de datos.","timestamp":"2025-03-27T07:20:22.900Z"}
{"level":"debug","message":"Executing query [m8r0xldhifszc30x4u]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:22.901Z"}
{"level":"info","message":"✅ La tabla especializada 'PermisoContextual' existe en la base de datos.","timestamp":"2025-03-27T07:20:22.906Z"}
{"level":"info","message":"✅ Todas las tablas especializadas existen.","timestamp":"2025-03-27T07:20:22.910Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-27T07:20:22.913Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-27T07:20:22.914Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-27T07:20:22.915Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-27T07:20:22.915Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-27T07:20:22.915Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-27T07:20:22.915Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-27T07:20:22.916Z"}
{"level":"info","message":"✅ DocumentoArchivo: exists","timestamp":"2025-03-27T07:20:22.917Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-27T07:20:22.922Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-27T07:20:22.923Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-27T07:20:22.923Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-27T07:20:22.923Z"}
{"level":"info","message":"✅ ForenseDigital: exists","timestamp":"2025-03-27T07:20:22.923Z"}
{"level":"info","message":"✅ QuimicaToxicologiaForense: exists","timestamp":"2025-03-27T07:20:22.923Z"}
{"level":"info","message":"✅ Dosaje: exists","timestamp":"2025-03-27T07:20:22.923Z"}
{"level":"info","message":"✅ PermisoContextual: exists","timestamp":"2025-03-27T07:20:22.924Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-27T07:20:22.924Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T07:20:22.939Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:22.854Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:23.188Z"}
{"level":"debug","message":"Executing query [m8r0xllo24oxoo38vp6]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T07:20:23.196Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T07:20:23.257Z"}
{"level":"debug","message":"Executing query [m8r0xlnfhl216qlst8]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:23.259Z"}
{"level":"debug","message":"Executing query [m8r0xlnh3yunhuwkun6]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:23.261Z"}
{"level":"debug","message":"Executing query [m8r0xlnltyqhk52v8w]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1743060023191\"]","timestamp":"2025-03-27T07:20:23.265Z"}
{"level":"debug","message":"Executing query [m8r0xlnnoa4zfkaewl]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, MotivoExamen,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1743060023191\",\"TEST-OFI-DOSAJE-1743060023191\",3321,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"Prueba automatizada\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T07:20:23.267Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'MotivoExamen' in 'field list'","level":"error","message":"Database query error [m8r0xlnnoa4zfkaewl]","params":"[1,\"TEST-DOSAJE-1743060023191\",\"TEST-OFI-DOSAJE-1743060023191\",3321,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"Prueba automatizada\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","query":"INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, MotivoExamen,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-27T07:20:23.270Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:23.200Z"}
{"level":"debug","message":"Executing query [m8r0xlnxt6vpm1tdfa]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1743060023277\",\"TEST-SP-OFICIO-1743060023277\",9368,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-27T07:20:23.277Z"}
{"level":"debug","message":"Executing query [m8r0xlo4hj0714bodwd]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1743060023277\"]","timestamp":"2025-03-27T07:20:23.284Z"}
{"level":"debug","message":"Executing query [m8r0xlo8d9v1hnd3aog]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T07:20:23.288Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T07:20:23.290Z"}
{"level":"debug","message":"Executing query [m8r0xlmomj0ptnqeyu]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T07:20:23.232Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T07:20:23.353Z"}
{"level":"debug","message":"Executing query [m8r0xlq4qvzez0r72of]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:23.356Z"}
{"level":"debug","message":"Executing query [m8r0xlq7oaunxpa7vy]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:23.359Z"}
{"level":"debug","message":"Executing query [m8r0xlq99sdec8ic46]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1743060023231\"]","timestamp":"2025-03-27T07:20:23.362Z"}
{"level":"debug","message":"Executing query [m8r0xlqc0wa0yw8mrkva]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1743060023231\",\"TEST-OFI-FORENSE-1743060023231\",1586,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1743060023231\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T07:20:23.364Z"}
{"level":"debug","message":"Executing query [m8r0xlquqibhcroqogf]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-27T07:20:23.382Z"}
{"level":"debug","message":"Executing query [m8r0xlqzhod1jlrdelr]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1743060023231\"]","timestamp":"2025-03-27T07:20:23.388Z"}
{"level":"debug","message":"Executing query [m8r0xlr3nb6aivpz4lf]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",15]","timestamp":"2025-03-27T07:20:23.391Z"}
{"level":"debug","message":"Executing query [m8r0xlr67by1lnkrtnc]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-27T07:20:23.394Z"}
{"level":"debug","message":"Executing query [m8r0xlrcevzoo16r4c]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-27T07:20:23.400Z"}
{"level":"debug","message":"Executing query [m8r0xlrgu8jyogtosxf]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-27T07:20:23.404Z"}
{"level":"debug","message":"Executing query [m8r0xlrim9lur9dwnr]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-27T07:20:23.406Z"}
{"level":"debug","message":"Executing query [m8r0xlrmlhmoef31rjj]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-27T07:20:23.410Z"}
{"level":"debug","message":"Executing query [m8r0xlrpgcj61sb4o88]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1743060023413\",\"TEST-SP-OFI-FORENSE-1743060023413\",492,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-27T07:20:23.413Z"}
{"level":"debug","message":"Executing query [m8r0xlrus6wtv37f38]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1743060023413\"]","timestamp":"2025-03-27T07:20:23.418Z"}
{"level":"debug","message":"Executing query [m8r0xlry82graagem1]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T07:20:23.422Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T07:20:23.424Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-27T07:20:23.501Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-27T07:20:23.502Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-27T07:20:23.504Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-27T07:20:23.507Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-27T07:20:23.508Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-27T07:20:23.508Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:23.827Z"}
{"level":"debug","message":"Executing query [m8r0xm3envsmecjvvh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T07:20:23.834Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T07:20:23.878Z"}
{"level":"debug","message":"Executing query [m8r0xm4ua7f25axyfa8]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:23.886Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8r0xm4ua7f25axyfa8]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-27T07:20:23.889Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-27T07:20:23.890Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:23.808Z"}
{"level":"debug","message":"Executing query [m8r0xm4liqfe3dykyoj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T07:20:23.877Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T07:20:23.940Z"}
{"level":"debug","message":"Executing query [m8r0xm6h7dqrr5fy1ew]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743060023873\"]","timestamp":"2025-03-27T07:20:23.945Z"}
{"level":"debug","message":"Executing query [m8r0xm6kqo4xo3zwc]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743060023873\",true]","timestamp":"2025-03-27T07:20:23.948Z"}
{"level":"debug","message":"Executing query [m8r0xm721x5r72m839o]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-27T07:20:23.966Z"}
{"level":"debug","message":"Executing query [m8r0xm78trogkyife7]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743060023873\"]","timestamp":"2025-03-27T07:20:23.972Z"}
{"level":"debug","message":"Executing query [m8r0xm7albs8r00w9m8]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",9]","timestamp":"2025-03-27T07:20:23.974Z"}
{"level":"debug","message":"Executing query [m8r0xm7f1biubrkt5wg]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-27T07:20:23.979Z"}
{"level":"debug","message":"Executing query [m8r0xm7i8815nau58ee]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-27T07:20:23.982Z"}
{"level":"debug","message":"Executing query [m8r0xm7mwfizrwhh6f9]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-27T07:20:23.986Z"}
{"level":"debug","message":"Executing query [m8r0xm7ut2z8m2csv]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-27T07:20:23.994Z"}
{"level":"debug","message":"Executing query [m8r0xm7wnt4zsz5u92h]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-27T07:20:23.996Z"}
{"level":"debug","message":"Executing query [m8r0xm80uuq7xi8ga0i]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-27T07:20:24.000Z"}
{"level":"debug","message":"Executing query [m8r0xm82c5ljoffkpff]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-27T07:20:24.002Z"}
{"level":"debug","message":"Executing query [m8r0xm85vicpsurrb5b]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T07:20:24.005Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T07:20:24.007Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:24.046Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:24.152Z"}
{"level":"debug","message":"Executing query [m8r0xmcclul8n2suvgm]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T07:20:24.156Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T07:20:24.177Z"}
{"level":"debug","message":"Executing query [m8r0xmayspkkywhn4wo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T07:20:24.108Z"}
{"level":"debug","message":"Executing query [m8r0xmcz5ccmxqzjgj8]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:24.179Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T07:20:24.180Z"}
{"level":"debug","message":"Executing query [m8r0xmd1525k6lksq7h]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:24.181Z"}
{"level":"debug","message":"Executing query [m8r0xmd4v4bfyzf5lqb]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1743060024155\"]","timestamp":"2025-03-27T07:20:24.184Z"}
{"level":"debug","message":"Executing query [m8r0xmd6aa7vitraab]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:24.186Z"}
{"level":"debug","message":"Executing query [m8r0xmd7bijp3bmjkit]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoMuestra, PesajeMuestra, ResponsableMuestreo, ResultadoPreliminar,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1743060024155\",\"TEST-OFI-QUIMICA-1743060024155\",3839,\"SANGRE\",\"25ml\",\"Investigador de Prueba\",\"NEGATIVO\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T07:20:24.187Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'TipoMuestra' in 'field list'","level":"error","message":"Database query error [m8r0xmd7bijp3bmjkit]","params":"[1,\"TEST-QUIMICA-1743060024155\",\"TEST-OFI-QUIMICA-1743060024155\",3839,\"SANGRE\",\"25ml\",\"Investigador de Prueba\",\"NEGATIVO\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","query":"INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoMuestra, PesajeMuestra, ResponsableMuestreo, ResultadoPreliminar,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-27T07:20:24.189Z"}
{"level":"debug","message":"Executing query [m8r0xmdct6sa7z3ckr]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-27T07:20:24.192Z"}
{"level":"debug","message":"Executing query [m8r0xmdeerisxdymus4]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-27T07:20:24.194Z"}
{"level":"debug","message":"Executing query [m8r0xmdejy7qfp94jps]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T07:20:24.194Z"}
{"level":"debug","message":"Executing query [m8r0xmdgs2lx40a4bzs]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, Permisos) VALUES (?, ?, ?, ?)","params":"[999,\"Rol de Prueba\",\"Rol creado para pruebas\",255]","timestamp":"2025-03-27T07:20:24.197Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'NivelAcceso' doesn't have a default value","level":"error","message":"Database query error [m8r0xmdgs2lx40a4bzs]","params":"[999,\"Rol de Prueba\",\"Rol creado para pruebas\",255]","query":"INSERT INTO Rol (IDRol, NombreRol, Descripcion, Permisos) VALUES (?, ?, ?, ?)","timestamp":"2025-03-27T07:20:24.200Z"}
{"level":"error","message":"Error en la configuración de las pruebas: Field 'NivelAcceso' doesn't have a default value","timestamp":"2025-03-27T07:20:24.201Z"}
{"level":"debug","message":"Executing query [m8r0xmdpklbo28s3fk]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T07:20:24.205Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T07:20:24.196Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T07:20:24.207Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:24.062Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:24.506Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:24.514Z"}
{"level":"debug","message":"Executing query [m8r0xmmc010sbeympjf1c]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:24.516Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T07:20:24.547Z"}
{"level":"debug","message":"Executing query [m8r0xmnd1moisa08h89]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T07:20:24.553Z"}
{"level":"debug","message":"Executing query [m8r0xmnfq1fuf7d90w]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-27T07:20:24.555Z"}
{"level":"debug","message":"Executing query [m8r0xmnh8k1usreooeq]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-27T07:20:24.557Z"}
{"level":"debug","message":"Executing query [m8r0xmnju4h0gwvbd8s]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, Permisos) VALUES (?, ?, ?, ?)","params":"[999,\"Rol de Prueba\",\"Rol creado para pruebas\",255]","timestamp":"2025-03-27T07:20:24.559Z"}
{"code":"ER_NO_DEFAULT_FOR_FIELD","error":"Field 'NivelAcceso' doesn't have a default value","level":"error","message":"Database query error [m8r0xmnju4h0gwvbd8s]","params":"[999,\"Rol de Prueba\",\"Rol creado para pruebas\",255]","query":"INSERT INTO Rol (IDRol, NombreRol, Descripcion, Permisos) VALUES (?, ?, ?, ?)","timestamp":"2025-03-27T07:20:24.561Z"}
{"level":"error","message":"Error en la configuración de las pruebas: Field 'NivelAcceso' doesn't have a default value","timestamp":"2025-03-27T07:20:24.561Z"}
{"level":"debug","message":"Executing query [m8r0xmnp8rsed38d58]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T07:20:24.565Z"}
{"level":"debug","message":"Executing query [m8r0xmnrwsleich9yhk]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T07:20:24.567Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-27T07:20:24.568Z"}
{"level":"debug","message":"Executing query [m8r0xmntjxm10vp6q5t]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T07:20:24.569Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T07:20:24.571Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:26.593Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-27T07:20:26.766Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T07:20:26.862Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:26.645Z"}
{"level":"debug","message":"Executing query [m8r0xoj2g20qhjghuhp]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:26.991Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-27T07:20:26.831Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-27T07:20:26.845Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T07:20:27.004Z"}
{"level":"debug","message":"Executing query [m8r0xojku5iszdoqgg]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T07:20:27.008Z"}
{"level":"debug","message":"Executing query [m8r0xojm3spuldwzu2l]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-27T07:20:27.010Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-27T07:20:27.024Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T07:20:27.034Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T07:20:27.061Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-27T07:20:23.039Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:34.288Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T07:20:34.290Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T07:20:34.440Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T07:20:34.451Z"}
{"duration":"19ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-27T07:20:34.453Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-27T07:20:34.442Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-27T07:20:34.455Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T07:20:34.460Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:39.801Z"}
{"level":"debug","message":"Executing query [m8rghddbwnwdfqo18k]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:35:39.887Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:35:39.819Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:35:39.836Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:35:39.852Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:35:39.865Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:35:39.870Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:35:39.885Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:35:39.889Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T14:35:39.894Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T14:35:39.898Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T14:35:39.901Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T14:35:39.903Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-27T14:35:39.906Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:35:40.039Z"}
{"level":"debug","message":"Executing query [m8rghdhmy1ts7cvhvx]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743086139883\"]","timestamp":"2025-03-27T14:35:40.043Z"}
{"level":"debug","message":"Executing query [m8rghdoqn3ud2srqz7c]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743086139883\"]","timestamp":"2025-03-27T14:35:40.298Z"}
{"level":"debug","message":"Executing query [m8rghdowyw3kt8wa3mh]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743086139883\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:35:40.304Z"}
{"level":"debug","message":"Executing query [m8rghdptudlzv5u9ops]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-27T14:35:40.337Z"}
{"level":"debug","message":"Executing query [m8rghdq1tiyl5d0mc4]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743086139883\"]","timestamp":"2025-03-27T14:35:40.345Z"}
{"level":"debug","message":"Executing query [m8rghdqbmbefgzo34ke]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1003]","timestamp":"2025-03-27T14:35:40.355Z"}
{"level":"debug","message":"Executing query [m8rghdqk3g9jwsemzdf]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-27T14:35:40.364Z"}
{"level":"debug","message":"Executing query [m8rghdqoo9p6y0wztwn]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-27T14:35:40.368Z"}
{"level":"debug","message":"Executing query [m8rghdqw8kh00cfxrud]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-27T14:35:40.377Z"}
{"level":"debug","message":"Executing query [m8rghdr0tazc5a232p]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-27T14:35:40.381Z"}
{"level":"debug","message":"Executing query [m8rghdrgcdy7ss832mr]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-27T14:35:40.396Z"}
{"level":"debug","message":"Executing query [m8rghdrqes35jklero8]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-27T14:35:40.406Z"}
{"level":"debug","message":"Executing query [m8rghdrt92vkhsa2h9v]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-27T14:35:40.409Z"}
{"level":"debug","message":"Executing query [m8rghdrwkkny74tiwz]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:35:40.412Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:35:40.416Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:40.348Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:40.569Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-27T14:35:39.831Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-27T14:35:39.853Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:40.724Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:40.713Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:40.706Z"}
{"level":"debug","message":"Executing query [m8rghe1vg1nspp69gq9]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:35:40.771Z"}
{"level":"debug","message":"Executing query [m8rghdz1jskyi7l5j5]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:40.669Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:35:40.789Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-27T14:35:40.800Z"}
{"level":"debug","message":"Executing query [m8rghe2ofy6oljpzy8u]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:40.800Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-27T14:35:40.815Z"}
{"level":"debug","message":"Executing query [m8rghe34hb44q9u1tot]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:40.816Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-27T14:35:40.825Z"}
{"level":"debug","message":"Executing query [m8rghe3d5b80ybi0do6]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:40.825Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-27T14:35:40.828Z"}
{"level":"debug","message":"Executing query [m8rghe3gkqtymjrdcb]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:40.829Z"}
{"level":"debug","message":"Executing query [m8rghe3inimkzv1hctd]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:40.830Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:35:40.833Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-27T14:35:40.836Z"}
{"level":"debug","message":"Executing query [m8rghe3oq5ia8ohsbd]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:40.837Z"}
{"level":"info","message":"✅ La tabla 'DocumentoArchivo' existe en la base de datos.","timestamp":"2025-03-27T14:35:40.843Z"}
{"level":"debug","message":"Executing query [m8rghe3w311emvks1qz]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:40.844Z"}
{"level":"debug","message":"Executing query [m8rghe3z1xv9aq3u5jb]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-27T14:35:40.848Z"}
{"level":"debug","message":"Executing query [m8rghe4166llty39fxk]: SELECT 1 as test","params":"[]","timestamp":"2025-03-27T14:35:40.849Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-27T14:35:40.849Z"}
{"level":"debug","message":"Executing query [m8rghe413nwcxy06ydk]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:40.849Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-27T14:35:40.854Z"}
{"level":"debug","message":"Executing query [m8rghe46mtio3nyy49]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-27T14:35:40.854Z"}
{"level":"debug","message":"Executing query [m8rghe422b4xgwcy2i9]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-27T14:35:40.850Z"}
{"level":"debug","message":"Executing query [m8rghe452gr1qmuhx43]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:40.853Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:35:40.856Z"}
{"level":"info","message":"Usando Mesa ID: 1, Áreas ID: 1/2, Usuarios ID: 1/2, Documento ID: 5","timestamp":"2025-03-27T14:35:40.858Z"}
{"level":"debug","message":"Executing query [m8rghe4b93vab14jcfo]: DELETE FROM Derivacion WHERE IDDocumento = ? AND IDAreaOrigen = ? AND IDAreaDestino = ?","params":"[5,1,2]","timestamp":"2025-03-27T14:35:40.859Z"}
{"level":"debug","message":"Executing query [m8rghe46xk5dyngs6xg]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:40.855Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8rghe46mtio3nyy49]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-27T14:35:40.862Z"}
{"level":"debug","message":"Executing query [m8rghe4gn79g49yecg]: INSERT INTO Derivacion (\n          IDDocumento, IDMesaPartes, IDAreaOrigen, IDAreaDestino, \n          IDUsuarioDeriva, EstadoDerivacion, Observacion\n        ) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[5,1,1,2,1,\"PENDIENTE\",\"Derivación creada para pruebas automatizadas\"]","timestamp":"2025-03-27T14:35:40.864Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8rghe46xk5dyngs6xg]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-27T14:35:40.861Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-27T14:35:40.862Z"}
{"level":"warn","message":"❌ Faltan 1 tablas estándar:\n   - Papelera","timestamp":"2025-03-27T14:35:40.862Z"}
{"level":"debug","message":"Executing query [m8rghe4gut1nymdczf]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:40.864Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:35:40.865Z"}
{"level":"debug","message":"Executing query [m8rghe4op2kodwftrbm]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[9]","timestamp":"2025-03-27T14:35:40.873Z"}
{"level":"info","message":"✅ La tabla especializada 'ForenseDigital' existe en la base de datos.","timestamp":"2025-03-27T14:35:40.876Z"}
{"level":"debug","message":"Executing query [m8rghe4t1bh5g0xswwdi]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:40.877Z"}
{"level":"debug","message":"Executing query [m8rghe4vm7vubjmewua]: UPDATE Derivacion SET EstadoDerivacion = ?, Observacion = ?, FechaRecepcion = ?, IDUsuarioRecibe = ? WHERE IDDerivacion = ?","params":"[\"RECIBIDO\",\"Derivación actualizada en pruebas\",\"2025-03-27 14:35:40\",2,9]","timestamp":"2025-03-27T14:35:40.879Z"}
{"level":"debug","message":"Executing query [m8rghe52z2oiv33qdt]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[9]","timestamp":"2025-03-27T14:35:40.886Z"}
{"level":"info","message":"✅ La tabla especializada 'QuimicaToxicologiaForense' existe en la base de datos.","timestamp":"2025-03-27T14:35:40.884Z"}
{"level":"debug","message":"Executing query [m8rghe50nrgt5m8rdn]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:40.884Z"}
{"level":"debug","message":"Executing query [m8rghe56a1zfqy4o99h]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-27T14:35:40.890Z"}
{"level":"info","message":"✅ La tabla especializada 'Dosaje' existe en la base de datos.","timestamp":"2025-03-27T14:35:40.891Z"}
{"level":"debug","message":"Executing query [m8rghe584knre09vqz]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:40.892Z"}
{"level":"debug","message":"Executing query [m8rghe593rkaa9pdxwa]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-27T14:35:40.893Z"}
{"level":"debug","message":"Executing query [m8rghe5cvhos1oa5r3h]: DELETE FROM Derivacion WHERE IDDerivacion = ?","params":"[9]","timestamp":"2025-03-27T14:35:40.896Z"}
{"level":"info","message":"✅ La tabla especializada 'PermisoContextual' existe en la base de datos.","timestamp":"2025-03-27T14:35:40.898Z"}
{"level":"debug","message":"Executing query [m8rghe5gzju47vj7y0m]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[9]","timestamp":"2025-03-27T14:35:40.900Z"}
{"level":"debug","message":"Executing query [m8rghe5jxppkvhxchz]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[5]","timestamp":"2025-03-27T14:35:40.903Z"}
{"level":"info","message":"✅ Todas las tablas especializadas existen.","timestamp":"2025-03-27T14:35:40.898Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-27T14:35:40.899Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-27T14:35:40.900Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-27T14:35:40.900Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-27T14:35:40.900Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-27T14:35:40.901Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-27T14:35:40.901Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-27T14:35:40.901Z"}
{"level":"info","message":"✅ DocumentoArchivo: exists","timestamp":"2025-03-27T14:35:40.902Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-27T14:35:40.902Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-27T14:35:40.902Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-27T14:35:40.902Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-27T14:35:40.902Z"}
{"level":"info","message":"✅ ForenseDigital: exists","timestamp":"2025-03-27T14:35:40.902Z"}
{"level":"info","message":"✅ QuimicaToxicologiaForense: exists","timestamp":"2025-03-27T14:35:40.903Z"}
{"level":"info","message":"✅ Dosaje: exists","timestamp":"2025-03-27T14:35:40.903Z"}
{"level":"info","message":"✅ PermisoContextual: exists","timestamp":"2025-03-27T14:35:40.903Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-27T14:35:40.903Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:35:40.905Z"}
{"level":"debug","message":"Executing query [m8rghe5wbys4qnmxpfp]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:35:40.916Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-27T14:35:40.729Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-27T14:35:40.980Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:41.186Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:41.298Z"}
{"level":"debug","message":"Executing query [m8rghegps3pbdmlv6zc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:35:41.305Z"}
{"level":"debug","message":"Executing query [m8rghegd74rthf7n6ns]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:35:41.294Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:35:41.400Z"}
{"level":"debug","message":"Executing query [m8rghejhptnu2k083bg]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:41.405Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:35:41.397Z"}
{"level":"debug","message":"Executing query [m8rghejhr5bv0sd8jof]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:41.405Z"}
{"level":"debug","message":"Executing query [m8rghejniifz5xyubp]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:41.411Z"}
{"level":"debug","message":"Executing query [m8rghejrjk3yrm5cxu]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1743086141284\"]","timestamp":"2025-03-27T14:35:41.415Z"}
{"level":"debug","message":"Executing query [m8rghejvf5s224de5yl]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, MotivoExamen,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1743086141284\",\"TEST-OFI-DOSAJE-1743086141284\",2989,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"Prueba automatizada\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:35:41.419Z"}
{"level":"debug","message":"Executing query [m8rghejulp7e15t5bss]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:41.419Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'MotivoExamen' in 'field list'","level":"error","message":"Database query error [m8rghejvf5s224de5yl]","params":"[1,\"TEST-DOSAJE-1743086141284\",\"TEST-OFI-DOSAJE-1743086141284\",2989,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"Prueba automatizada\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","query":"INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, MotivoExamen,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-27T14:35:41.424Z"}
{"level":"debug","message":"Executing query [m8rghek9kp3ayfr12ta]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1743086141433\",\"TEST-SP-OFICIO-1743086141433\",8295,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-27T14:35:41.434Z"}
{"level":"debug","message":"Executing query [m8rghekuaxd40cdq9s]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1743086141301\"]","timestamp":"2025-03-27T14:35:41.454Z"}
{"level":"debug","message":"Executing query [m8rghekwxs0px6zz7v]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1743086141301\",\"TEST-OFI-FORENSE-1743086141301\",1821,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1743086141301\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:35:41.456Z"}
{"level":"debug","message":"Executing query [m8rghel16cc6nguxn8t]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1743086141433\"]","timestamp":"2025-03-27T14:35:41.461Z"}
{"level":"debug","message":"Executing query [m8rghel3a274mp3fy4o]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-27T14:35:41.463Z"}
{"level":"debug","message":"Executing query [m8rghel7tz8vn4njx9]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1743086141301\"]","timestamp":"2025-03-27T14:35:41.467Z"}
{"level":"debug","message":"Executing query [m8rghel6fl0o0pto35m]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:35:41.467Z"}
{"level":"debug","message":"Executing query [m8rghelacivs86svym]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",11]","timestamp":"2025-03-27T14:35:41.470Z"}
{"level":"debug","message":"Executing query [m8rghelfu0953vjq4ah]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-27T14:35:41.475Z"}
{"level":"debug","message":"Executing query [m8rgheljy82h8z84lv]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-27T14:35:41.479Z"}
{"level":"debug","message":"Executing query [m8rghelsgpqafgih1qg]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-27T14:35:41.488Z"}
{"level":"debug","message":"Executing query [m8rghelwg1tv81lx4mb]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-27T14:35:41.492Z"}
{"level":"debug","message":"Executing query [m8rghem1eaq82hpphvb]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-27T14:35:41.497Z"}
{"level":"debug","message":"Executing query [m8rghem5jchmyrxna9]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1743086141501\",\"TEST-SP-OFI-FORENSE-1743086141501\",5118,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-27T14:35:41.501Z"}
{"level":"debug","message":"Executing query [m8rghemdb8qzos8pnhl]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1743086141501\"]","timestamp":"2025-03-27T14:35:41.509Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:35:41.475Z"}
{"level":"debug","message":"Executing query [m8rghemh9nshvn7xtqs]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:35:41.513Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:35:41.516Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-27T14:35:41.862Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:41.846Z"}
{"level":"debug","message":"Executing query [m8rghevu6lwe73e7xwg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:35:41.851Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:35:41.932Z"}
{"level":"debug","message":"Executing query [m8rgheyb13kb2xlh8w2]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743086141849\"]","timestamp":"2025-03-27T14:35:41.940Z"}
{"level":"debug","message":"Executing query [m8rgheyg9fe5zfbtyyt]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743086141849\",true]","timestamp":"2025-03-27T14:35:41.944Z"}
{"level":"debug","message":"Executing query [m8rgheyqrquejgqefn]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-27T14:35:41.954Z"}
{"level":"debug","message":"Executing query [m8rgheyxfzcoehbai4]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743086141849\"]","timestamp":"2025-03-27T14:35:41.961Z"}
{"level":"debug","message":"Executing query [m8rghez0ouemzdu5l5]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",11]","timestamp":"2025-03-27T14:35:41.964Z"}
{"level":"debug","message":"Executing query [m8rghez68rss7no841j]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-27T14:35:41.970Z"}
{"level":"debug","message":"Executing query [m8rgheza6cqxams0s5q]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-27T14:35:41.974Z"}
{"level":"debug","message":"Executing query [m8rghezebsvoick7rzf]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-27T14:35:41.978Z"}
{"level":"debug","message":"Executing query [m8rghezirs1b4lq2r79]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-27T14:35:41.982Z"}
{"level":"debug","message":"Executing query [m8rghezmk02oz0sny1s]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-27T14:35:41.987Z"}
{"level":"debug","message":"Executing query [m8rghezsozrmt7bqcb]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-27T14:35:41.992Z"}
{"level":"debug","message":"Executing query [m8rghezv7by2fdaj8of]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-27T14:35:41.995Z"}
{"level":"debug","message":"Executing query [m8rghezzj07gxea1rs]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:35:41.999Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:35:42.002Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:42.059Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:42.080Z"}
{"level":"debug","message":"Executing query [m8rghf20lkr81tajgon]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:35:42.072Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:35:42.112Z"}
{"level":"debug","message":"Executing query [m8rghf36dka3n0t6c7h]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:42.114Z"}
{"level":"debug","message":"Executing query [m8rghf3ag18ovmz5zs]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-27T14:35:42.118Z"}
{"level":"debug","message":"Executing query [m8rghf3crn04lce320o]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-27T14:35:42.121Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-27T14:35:42.124Z"}
{"level":"debug","message":"Executing query [m8rghf3g1c5nxx5e7a9]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-27T14:35:42.124Z"}
{"level":"debug","message":"Executing query [m8rghf3n7ol4houazgt]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-27T14:35:42.131Z"}
{"level":"debug","message":"Executing query [m8rghf3p5xlk1foqpnf]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-27T14:35:42.133Z"}
{"level":"debug","message":"Executing query [m8rghf2oa4v3vk2yac4]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:35:42.096Z"}
{"level":"debug","message":"Executing query [m8rghf3xpkkl5p5k7kc]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[19]","timestamp":"2025-03-27T14:35:42.141Z"}
{"level":"debug","message":"Executing query [m8rghf43uq0vd0c127]: SELECT 1 FROM v_permisos_contextuales LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:42.147Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:35:42.150Z"}
{"level":"debug","message":"Executing query [m8rghf46iy0ns52mh1o]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:42.150Z"}
{"level":"debug","message":"Executing query [m8rghf496lef2dn4cpe]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[19]","timestamp":"2025-03-27T14:35:42.153Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8rghf46iy0ns52mh1o]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-27T14:35:42.155Z"}
{"level":"debug","message":"Executing query [m8rghf4ejpo18hcl9rc]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",19]","timestamp":"2025-03-27T14:35:42.158Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-27T14:35:42.156Z"}
{"level":"debug","message":"Executing query [m8rghf4iw8wb67xxcok]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[19]","timestamp":"2025-03-27T14:35:42.162Z"}
{"level":"debug","message":"Executing query [m8rghf4mz3fiwmwzpje]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[19]","timestamp":"2025-03-27T14:35:42.166Z"}
{"level":"debug","message":"Executing query [m8rghf4trpeubdih98f]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[19]","timestamp":"2025-03-27T14:35:42.173Z"}
{"level":"debug","message":"Executing query [m8rghf4v413oxbqt6u5]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:35:42.175Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:35:42.177Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:42.455Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:42.536Z"}
{"level":"debug","message":"Executing query [m8rghfh205fg71hioe0m]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:35:42.614Z"}
{"level":"debug","message":"Executing query [m8rghfk8eu9vw67o2g]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:42.729Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:35:42.730Z"}
{"level":"debug","message":"Executing query [m8rghfkeohgm7nfh9d8]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:42.734Z"}
{"level":"debug","message":"Executing query [m8rghfkhami812e3fnv]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1743086142611\"]","timestamp":"2025-03-27T14:35:42.737Z"}
{"level":"debug","message":"Executing query [m8rghfkkiukmrmkgd6]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoMuestra, PesajeMuestra, ResponsableMuestreo, ResultadoPreliminar,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1743086142611\",\"TEST-OFI-QUIMICA-1743086142611\",8012,\"SANGRE\",\"25ml\",\"Investigador de Prueba\",\"NEGATIVO\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:35:42.740Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'TipoMuestra' in 'field list'","level":"error","message":"Database query error [m8rghfkkiukmrmkgd6]","params":"[1,\"TEST-QUIMICA-1743086142611\",\"TEST-OFI-QUIMICA-1743086142611\",8012,\"SANGRE\",\"25ml\",\"Investigador de Prueba\",\"NEGATIVO\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","query":"INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoMuestra, PesajeMuestra, ResponsableMuestreo, ResultadoPreliminar,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-27T14:35:42.742Z"}
{"level":"debug","message":"Executing query [m8rghfktus3zdi2f6v]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:35:42.749Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:35:42.753Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:42.739Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:42.761Z"}
{"level":"debug","message":"Executing query [m8rghfl8x2x3roquhim]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:42.764Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:35:42.797Z"}
{"level":"debug","message":"Executing query [m8rghfm9rfdbrzxwvu8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:35:42.801Z"}
{"level":"debug","message":"Executing query [m8rghfmbgz8dx3ocsrn]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-27T14:35:42.803Z"}
{"level":"debug","message":"Executing query [m8rghfmd0k6rniqubfh8]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-27T14:35:42.805Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-27T14:35:42.807Z"}
{"level":"debug","message":"Executing query [m8rghfmg4opohejmq5]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T14:35:42.808Z"}
{"level":"debug","message":"Executing query [m8rghfmk9y25v4r51tw]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:35:42.812Z"}
{"level":"debug","message":"Executing query [m8rghfmnad613t3o15j]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:35:42.815Z"}
{"level":"debug","message":"Executing query [m8rghfmomh42tew0tl]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-27T14:35:42.816Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Grado\",\"PasswordHash\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-27T14:35:42.846Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-27T14:35:42.847Z"}
{"level":"debug","message":"Executing query [m8rghfnjjq962ik5tu]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-27T14:35:42.847Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'Rango' in 'field list'","level":"error","message":"Database query error [m8rghfnjjq962ik5tu]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-27T14:35:42.849Z"}
{"level":"error","message":"Error al crear usuario: Unknown column 'Rango' in 'field list'","timestamp":"2025-03-27T14:35:42.849Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-27T14:35:42.855Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-27T14:35:42.856Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-27T14:35:42.857Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-27T14:35:42.857Z"}
{"level":"debug","message":"Executing query [m8rghfnu34ytxke4zpb]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T14:35:42.858Z"}
{"level":"debug","message":"Executing query [m8rghfnw2hzrnlehqz3]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:35:42.860Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-27T14:35:42.862Z"}
{"level":"debug","message":"Executing query [m8rghfnyyylzcgkb8v]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:35:42.862Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:35:42.863Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:43.022Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-27T14:35:43.300Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-27T14:35:43.317Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:35:43.502Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-27T14:35:43.519Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:35:43.589Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-27T14:35:41.873Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-27T14:35:41.874Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-27T14:35:41.883Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-27T14:35:41.885Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-27T14:35:41.885Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:43.705Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-27T14:35:43.918Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:35:44.038Z"}
{"level":"debug","message":"Executing query [m8rghglukjc9puyvwte]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:44.082Z"}
{"level":"debug","message":"Executing query [m8rghgmorxtlwc5trzn]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T14:35:44.113Z"}
{"level":"debug","message":"Executing query [m8rghgmrfbgnxl4upiu]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-27T14:35:44.115Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:35:44.165Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:45.523Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:35:45.520Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:35:45.692Z"}
{"duration":"23ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-27T14:35:45.709Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-27T14:35:45.694Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:35:45.714Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-27T14:35:45.718Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:35:45.721Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:37:27.703Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:37:27.724Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:37:27.727Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:37:27.731Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:37:27.737Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:37:27.741Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:37:27.743Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T14:37:27.748Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T14:37:27.750Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T14:37:27.753Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T14:37:27.756Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-27T14:37:27.761Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-27T14:37:28.003Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-27T14:37:28.021Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:28.035Z"}
{"level":"debug","message":"Executing query [m8rgjovwwvrtzgyc859]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:37:28.124Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:37:28.203Z"}
{"level":"debug","message":"Executing query [m8rgjoy8jv9miy51beo]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743086248120\"]","timestamp":"2025-03-27T14:37:28.208Z"}
{"level":"debug","message":"Executing query [m8rgjoyvtxqbacze43]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743086248120\"]","timestamp":"2025-03-27T14:37:28.231Z"}
{"level":"debug","message":"Executing query [m8rgjoyy4y65bzny2xm]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743086248120\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:37:28.234Z"}
{"level":"debug","message":"Executing query [m8rgjoz7sr04jgm8oyb]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-27T14:37:28.243Z"}
{"level":"debug","message":"Executing query [m8rgjozhagoi4tgk2gg]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743086248120\"]","timestamp":"2025-03-27T14:37:28.253Z"}
{"level":"debug","message":"Executing query [m8rgjozl3qwr4glu05y]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1004]","timestamp":"2025-03-27T14:37:28.257Z"}
{"level":"debug","message":"Executing query [m8rgjozrwds3eae8yeq]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-27T14:37:28.263Z"}
{"level":"debug","message":"Executing query [m8rgjozvhstu7wp9lz]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-27T14:37:28.267Z"}
{"level":"debug","message":"Executing query [m8rgjp02qzl3tqdelyd]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-27T14:37:28.274Z"}
{"level":"debug","message":"Executing query [m8rgjp05ibj8b8u51h]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-27T14:37:28.277Z"}
{"level":"debug","message":"Executing query [m8rgjp08cr28pdgn7zj]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-27T14:37:28.280Z"}
{"level":"debug","message":"Executing query [m8rgjp0edy5gct7wpft]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-27T14:37:28.286Z"}
{"level":"debug","message":"Executing query [m8rgjp0hc8shsxrzsw]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-27T14:37:28.289Z"}
{"level":"debug","message":"Executing query [m8rgjp0k028g3v38bwb1]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:37:28.292Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:37:28.295Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:28.376Z"}
{"level":"debug","message":"Executing query [m8rgjp4gf18qgqaclxn]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:28.433Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:37:28.516Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-27T14:37:28.526Z"}
{"level":"debug","message":"Executing query [m8rgjp75u7q2atd1rj]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:28.529Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-27T14:37:28.533Z"}
{"level":"debug","message":"Executing query [m8rgjp79ccnwynqw2v]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:28.533Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-27T14:37:28.536Z"}
{"level":"debug","message":"Executing query [m8rgjp7cv71z9uzmubh]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:28.536Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-27T14:37:28.539Z"}
{"level":"debug","message":"Executing query [m8rgjp7go3tjqsqbxwk]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:28.540Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-27T14:37:28.543Z"}
{"level":"debug","message":"Executing query [m8rgjp7j2qy8x32k4fa]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:28.543Z"}
{"level":"info","message":"✅ La tabla 'DocumentoArchivo' existe en la base de datos.","timestamp":"2025-03-27T14:37:28.546Z"}
{"level":"debug","message":"Executing query [m8rgjp7nsdjux3lg428]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:28.547Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-27T14:37:28.548Z"}
{"level":"debug","message":"Executing query [m8rgjp7p1rgoxn2xqkr]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:28.549Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-27T14:37:28.551Z"}
{"level":"debug","message":"Executing query [m8rgjp7shx44j00nby7]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:28.552Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8rgjp7shx44j00nby7]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-27T14:37:28.556Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-27T14:37:28.557Z"}
{"level":"warn","message":"❌ Faltan 1 tablas estándar:\n   - Papelera","timestamp":"2025-03-27T14:37:28.557Z"}
{"level":"debug","message":"Executing query [m8rgjp805x2vqh3f6ml]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:28.560Z"}
{"level":"info","message":"✅ La tabla especializada 'ForenseDigital' existe en la base de datos.","timestamp":"2025-03-27T14:37:28.563Z"}
{"level":"debug","message":"Executing query [m8rgjp83hlzpcsej8dq]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:28.563Z"}
{"level":"info","message":"✅ La tabla especializada 'QuimicaToxicologiaForense' existe en la base de datos.","timestamp":"2025-03-27T14:37:28.566Z"}
{"level":"debug","message":"Executing query [m8rgjp86ukwwy5t0m3n]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:28.566Z"}
{"level":"info","message":"✅ La tabla especializada 'Dosaje' existe en la base de datos.","timestamp":"2025-03-27T14:37:28.568Z"}
{"level":"debug","message":"Executing query [m8rgjp89x8h8l04n7c]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:28.569Z"}
{"level":"info","message":"✅ La tabla especializada 'PermisoContextual' existe en la base de datos.","timestamp":"2025-03-27T14:37:28.570Z"}
{"level":"info","message":"✅ Todas las tablas especializadas existen.","timestamp":"2025-03-27T14:37:28.571Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-27T14:37:28.572Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-27T14:37:28.572Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-27T14:37:28.572Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-27T14:37:28.572Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-27T14:37:28.572Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-27T14:37:28.573Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-27T14:37:28.573Z"}
{"level":"info","message":"✅ DocumentoArchivo: exists","timestamp":"2025-03-27T14:37:28.573Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-27T14:37:28.573Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-27T14:37:28.573Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-27T14:37:28.573Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-27T14:37:28.573Z"}
{"level":"info","message":"✅ ForenseDigital: exists","timestamp":"2025-03-27T14:37:28.574Z"}
{"level":"info","message":"✅ QuimicaToxicologiaForense: exists","timestamp":"2025-03-27T14:37:28.574Z"}
{"level":"info","message":"✅ Dosaje: exists","timestamp":"2025-03-27T14:37:28.574Z"}
{"level":"info","message":"✅ PermisoContextual: exists","timestamp":"2025-03-27T14:37:28.574Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-27T14:37:28.574Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:37:28.576Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:28.324Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:28.698Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-27T14:37:28.837Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:28.945Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:29.044Z"}
{"level":"debug","message":"Executing query [m8rgjpmdw8y0m60cgvf]: SELECT 1 as test","params":"[]","timestamp":"2025-03-27T14:37:29.077Z"}
{"level":"debug","message":"Executing query [m8rgjpmjv9g9hjvx3]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-27T14:37:29.083Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8rgjpmjv9g9hjvx3]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-27T14:37:29.088Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:37:29.120Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-27T14:37:29.131Z"}
{"level":"debug","message":"Executing query [m8rgjplrau1dr5upont]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:37:29.056Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:37:29.141Z"}
{"level":"debug","message":"Executing query [m8rgjpoc9pb099ftzn4]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:29.148Z"}
{"level":"debug","message":"Executing query [m8rgjpp3j2uoavwxowk]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:29.175Z"}
{"level":"debug","message":"Executing query [m8rgjpp7wwbg6n9sjid]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1743086249051\"]","timestamp":"2025-03-27T14:37:29.179Z"}
{"level":"debug","message":"Executing query [m8rgjppavbxu2v9yqx]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, MotivoExamen,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1743086249051\",\"TEST-OFI-DOSAJE-1743086249051\",3594,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"Prueba automatizada\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:37:29.182Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'MotivoExamen' in 'field list'","level":"error","message":"Database query error [m8rgjppavbxu2v9yqx]","params":"[1,\"TEST-DOSAJE-1743086249051\",\"TEST-OFI-DOSAJE-1743086249051\",3594,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"Prueba automatizada\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","query":"INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, MotivoExamen,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-27T14:37:29.184Z"}
{"level":"debug","message":"Executing query [m8rgjppluixvomepsu]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1743086249193\",\"TEST-SP-OFICIO-1743086249193\",6281,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-27T14:37:29.193Z"}
{"level":"debug","message":"Executing query [m8rgjpptq0vwto36h6m]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1743086249193\"]","timestamp":"2025-03-27T14:37:29.201Z"}
{"level":"debug","message":"Executing query [m8rgjppzj5sxvy4bde]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:37:29.207Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:37:29.210Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:29.168Z"}
{"level":"debug","message":"Executing query [m8rgjpr2oey855xgdg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:37:29.246Z"}
{"level":"debug","message":"Executing query [m8rgjpt1fs1l04m2hm]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:29.317Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:37:29.320Z"}
{"level":"debug","message":"Executing query [m8rgjptb6o0n13gljc]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-27T14:37:29.327Z"}
{"level":"debug","message":"Executing query [m8rgjpthm5myhcjv1me]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-27T14:37:29.334Z"}
{"level":"debug","message":"Executing query [m8rgjptltdq6sbra6f]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:29.337Z"}
{"level":"info","message":"Usando Mesa ID: 1, Áreas ID: 1/2, Usuarios ID: 1/2, Documento ID: 6","timestamp":"2025-03-27T14:37:29.339Z"}
{"level":"debug","message":"Executing query [m8rgjptokwfi7wfwcb]: DELETE FROM Derivacion WHERE IDDocumento = ? AND IDAreaOrigen = ? AND IDAreaDestino = ?","params":"[6,1,2]","timestamp":"2025-03-27T14:37:29.340Z"}
{"level":"debug","message":"Executing query [m8rgjptrxi313mgdh4p]: INSERT INTO Derivacion (\n          IDDocumento, IDMesaPartes, IDAreaOrigen, IDAreaDestino, \n          IDUsuarioDeriva, EstadoDerivacion, Observacion\n        ) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[6,1,1,2,1,\"PENDIENTE\",\"Derivación creada para pruebas automatizadas\"]","timestamp":"2025-03-27T14:37:29.343Z"}
{"level":"debug","message":"Executing query [m8rgjpu0jrm0kp9a3b]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[10]","timestamp":"2025-03-27T14:37:29.352Z"}
{"level":"debug","message":"Executing query [m8rgjpu67bxtvj1mqs]: UPDATE Derivacion SET EstadoDerivacion = ?, Observacion = ?, FechaRecepcion = ?, IDUsuarioRecibe = ? WHERE IDDerivacion = ?","params":"[\"RECIBIDO\",\"Derivación actualizada en pruebas\",\"2025-03-27 14:37:29\",2,10]","timestamp":"2025-03-27T14:37:29.358Z"}
{"level":"debug","message":"Executing query [m8rgjpuh367fh3e4hu8]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[10]","timestamp":"2025-03-27T14:37:29.369Z"}
{"level":"debug","message":"Executing query [m8rgjpungv0iygguhz9]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-27T14:37:29.375Z"}
{"level":"debug","message":"Executing query [m8rgjput94y89gtokvq]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-27T14:37:29.382Z"}
{"level":"debug","message":"Executing query [m8rgjpux91taqswzvw]: DELETE FROM Derivacion WHERE IDDerivacion = ?","params":"[10]","timestamp":"2025-03-27T14:37:29.385Z"}
{"level":"debug","message":"Executing query [m8rgjpv42t7fy9oavwy]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[10]","timestamp":"2025-03-27T14:37:29.392Z"}
{"level":"debug","message":"Executing query [m8rgjpv7jgibiv54hsn]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[6]","timestamp":"2025-03-27T14:37:29.395Z"}
{"level":"debug","message":"Executing query [m8rgjpvcydjb87fa8g]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:37:29.400Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-27T14:37:29.459Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-27T14:37:29.462Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-27T14:37:29.464Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-27T14:37:29.465Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-27T14:37:29.466Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-27T14:37:29.466Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-27T14:37:28.686Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:29.460Z"}
{"level":"debug","message":"Executing query [m8rgjpzc92d5bocuom]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:37:29.545Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:37:29.663Z"}
{"level":"debug","message":"Executing query [m8rgjq2rn46zeg3laxl]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:29.668Z"}
{"level":"debug","message":"Executing query [m8rgjq3a5an2m73kxok]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:29.686Z"}
{"level":"debug","message":"Executing query [m8rgjq3iwfszp0ozrs]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1743086249542\"]","timestamp":"2025-03-27T14:37:29.694Z"}
{"level":"debug","message":"Executing query [m8rgjq3ncbd672rrlq]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1743086249542\",\"TEST-OFI-FORENSE-1743086249542\",1577,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1743086249542\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:37:29.699Z"}
{"level":"debug","message":"Executing query [m8rgjq40gh4c4ty2pbo]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-27T14:37:29.712Z"}
{"level":"debug","message":"Executing query [m8rgjq4gp72nlxjbw9r]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1743086249542\"]","timestamp":"2025-03-27T14:37:29.728Z"}
{"level":"debug","message":"Executing query [m8rgjq4kq8kdzvtrhio]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",13]","timestamp":"2025-03-27T14:37:29.732Z"}
{"level":"debug","message":"Executing query [m8rgjq4omapm2bb97vb]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-27T14:37:29.736Z"}
{"level":"debug","message":"Executing query [m8rgjq4s7g7igm14aok]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-27T14:37:29.740Z"}
{"level":"debug","message":"Executing query [m8rgjq4ybwruckq771]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-27T14:37:29.746Z"}
{"level":"debug","message":"Executing query [m8rgjq52iks0jtei4c]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-27T14:37:29.750Z"}
{"level":"debug","message":"Executing query [m8rgjq56c86w58cvsw]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-27T14:37:29.754Z"}
{"level":"debug","message":"Executing query [m8rgjq59ggheel8jftv]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1743086249757\",\"TEST-SP-OFI-FORENSE-1743086249757\",8941,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-27T14:37:29.757Z"}
{"level":"debug","message":"Executing query [m8rgjq5e4kxk83e8asc]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1743086249757\"]","timestamp":"2025-03-27T14:37:29.762Z"}
{"level":"debug","message":"Executing query [m8rgjq5mqilxk7ootvl]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:37:29.770Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:37:29.773Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:29.793Z"}
{"level":"debug","message":"Executing query [m8rgjq6gimgfloi0elq]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:37:29.800Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:37:29.855Z"}
{"level":"debug","message":"Executing query [m8rgjq82n16dllaunii]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743086249799\"]","timestamp":"2025-03-27T14:37:29.858Z"}
{"level":"debug","message":"Executing query [m8rgjq85dfjni8mrfa]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743086249799\",true]","timestamp":"2025-03-27T14:37:29.861Z"}
{"level":"debug","message":"Executing query [m8rgjq8b751twe9bmiv]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-27T14:37:29.867Z"}
{"level":"debug","message":"Executing query [m8rgjq8fgdvjnq3pv5c]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743086249799\"]","timestamp":"2025-03-27T14:37:29.871Z"}
{"level":"debug","message":"Executing query [m8rgjq8i8mw4jb911my]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",12]","timestamp":"2025-03-27T14:37:29.874Z"}
{"level":"debug","message":"Executing query [m8rgjq8nvdrsjcs31gd]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-27T14:37:29.879Z"}
{"level":"debug","message":"Executing query [m8rgjq8rpwvlhfg08q]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-27T14:37:29.883Z"}
{"level":"debug","message":"Executing query [m8rgjq8vfvlgxqg5av8]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-27T14:37:29.887Z"}
{"level":"debug","message":"Executing query [m8rgjq8ybxib5aqaqtt]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-27T14:37:29.890Z"}
{"level":"debug","message":"Executing query [m8rgjq92fyx9ne71l8r]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-27T14:37:29.894Z"}
{"level":"debug","message":"Executing query [m8rgjq9abafadgmf6zq]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-27T14:37:29.902Z"}
{"level":"debug","message":"Executing query [m8rgjq9dslkhj7j97hd]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-27T14:37:29.905Z"}
{"level":"debug","message":"Executing query [m8rgjq9g4b1njf7u9ya]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:37:29.908Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:37:29.910Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:30.126Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:30.210Z"}
{"level":"debug","message":"Executing query [m8rgjqi00dsnc98fhesg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:37:30.216Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:37:30.277Z"}
{"level":"debug","message":"Executing query [m8rgjqjtjvu70ooynom]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:30.281Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:29.991Z"}
{"level":"debug","message":"Executing query [m8rgjqjxc8aaqxsxvy]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-27T14:37:30.285Z"}
{"level":"debug","message":"Executing query [m8rgjqjzyrhid91yg2f]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-27T14:37:30.287Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-27T14:37:30.289Z"}
{"level":"debug","message":"Executing query [m8rgjqk2fhyx5vepisq]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-27T14:37:30.290Z"}
{"level":"debug","message":"Executing query [m8rgjqk4asyrxgw7hou]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-27T14:37:30.292Z"}
{"level":"debug","message":"Executing query [m8rgjqk7gicwnq7vyqj]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-27T14:37:30.295Z"}
{"level":"debug","message":"Executing query [m8rgjqkf6ifhhpl8lr]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-27T14:37:30.303Z"}
{"level":"debug","message":"Executing query [m8rgjqkkfl6248n6wm]: SELECT 1 FROM v_permisos_contextuales LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:30.308Z"}
{"level":"debug","message":"Executing query [m8rgjqkn6exng60hi2i]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-27T14:37:30.311Z"}
{"level":"debug","message":"Executing query [m8rgjqks4jf8radv2ph]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",20]","timestamp":"2025-03-27T14:37:30.316Z"}
{"level":"debug","message":"Executing query [m8rgjqkwgg9am5duqxo]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-27T14:37:30.320Z"}
{"level":"debug","message":"Executing query [m8rgjqkz1s7aprljdyb]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-27T14:37:30.323Z"}
{"level":"debug","message":"Executing query [m8rgjql4prryx3w8czm]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-27T14:37:30.328Z"}
{"level":"debug","message":"Executing query [m8rgjql7aufrwo5u3fu]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:37:30.331Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:37:30.333Z"}
{"level":"debug","message":"Executing query [m8rgjqj7b6gh0pgryhw]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:37:30.259Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:37:30.345Z"}
{"level":"debug","message":"Executing query [m8rgjqlyc6ashgqab9d]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:30.358Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8rgjqlyc6ashgqab9d]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-27T14:37:30.367Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-27T14:37:30.368Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:30.447Z"}
{"level":"debug","message":"Executing query [m8rgjqpzakux6mc3xfg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:37:30.503Z"}
{"level":"debug","message":"Executing query [m8rgjqrsaje9hpqzhkn]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:30.568Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:37:30.575Z"}
{"level":"debug","message":"Executing query [m8rgjqs3uqhpk8frofm]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:30.579Z"}
{"level":"debug","message":"Executing query [m8rgjqsbv87vkaposn]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1743086250501\"]","timestamp":"2025-03-27T14:37:30.587Z"}
{"level":"debug","message":"Executing query [m8rgjqsdavm6hscx4p8]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoMuestra, PesajeMuestra, ResponsableMuestreo, ResultadoPreliminar,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1743086250501\",\"TEST-OFI-QUIMICA-1743086250501\",5904,\"SANGRE\",\"25ml\",\"Investigador de Prueba\",\"NEGATIVO\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:37:30.589Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'TipoMuestra' in 'field list'","level":"error","message":"Database query error [m8rgjqsdavm6hscx4p8]","params":"[1,\"TEST-QUIMICA-1743086250501\",\"TEST-OFI-QUIMICA-1743086250501\",5904,\"SANGRE\",\"25ml\",\"Investigador de Prueba\",\"NEGATIVO\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","query":"INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoMuestra, PesajeMuestra, ResponsableMuestreo, ResultadoPreliminar,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-27T14:37:30.596Z"}
{"level":"debug","message":"Executing query [m8rgjqsyr4mw1hzwcx]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:37:30.610Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:30.588Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:37:30.614Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:30.610Z"}
{"level":"debug","message":"Executing query [m8rgjqt8hkzwbdptkav]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:30.620Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:37:30.652Z"}
{"level":"debug","message":"Executing query [m8rgjqu7hyuk5y3gy1]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:37:30.655Z"}
{"level":"debug","message":"Executing query [m8rgjqutz5y1go2ekw]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-27T14:37:30.677Z"}
{"level":"debug","message":"Executing query [m8rgjquw573alpb5m8x]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-27T14:37:30.680Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-27T14:37:30.682Z"}
{"level":"debug","message":"Executing query [m8rgjquzbk2yibvo0fn]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T14:37:30.683Z"}
{"level":"debug","message":"Executing query [m8rgjqv1brk5k42fdg]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:37:30.685Z"}
{"level":"debug","message":"Executing query [m8rgjqv3rvlyreterq]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:37:30.687Z"}
{"level":"debug","message":"Executing query [m8rgjqv6634u9idme2]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-27T14:37:30.690Z"}
{"level":"info","message":"Estructura de tabla Usuario encontrada: [\"IDUsuario\",\"CodigoCIP\",\"Nombres\",\"Apellidos\",\"Grado\",\"PasswordHash\",\"IDArea\",\"IDRol\",\"UltimoAcceso\",\"IntentosFallidos\",\"Bloqueado\",\"UltimoBloqueo\"]","timestamp":"2025-03-27T14:37:30.696Z"}
{"level":"info","message":"Ejecutando SQL: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?) con parámetros: [\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-27T14:37:30.696Z"}
{"level":"debug","message":"Executing query [m8rgjqvd6l4zs9o4ojd]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","timestamp":"2025-03-27T14:37:30.697Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'Rango' in 'field list'","level":"error","message":"Database query error [m8rgjqvd6l4zs9o4ojd]","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999,\"PRUEBA\"]","query":"INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Rango) VALUES (?,?,?,?,?,?,?)","timestamp":"2025-03-27T14:37:30.699Z"}
{"level":"error","message":"Error al crear usuario: Unknown column 'Rango' in 'field list'","timestamp":"2025-03-27T14:37:30.699Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-27T14:37:30.704Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-27T14:37:30.706Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-27T14:37:30.707Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-27T14:37:30.708Z"}
{"level":"debug","message":"Executing query [m8rgjqvon0px3cz7ylq]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T14:37:30.708Z"}
{"level":"debug","message":"Executing query [m8rgjqvqrfu57lj8bwq]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:37:30.710Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-27T14:37:30.712Z"}
{"level":"debug","message":"Executing query [m8rgjqvtisv2ywfbe8i]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:37:30.713Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:37:30.715Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:30.645Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-27T14:37:31.027Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-27T14:37:31.057Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:37:31.338Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-27T14:37:31.355Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:37:31.438Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:31.650Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-27T14:37:31.879Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:37:31.971Z"}
{"level":"debug","message":"Executing query [m8rgjrvuo5ht92wdc7j]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:32.010Z"}
{"level":"debug","message":"Executing query [m8rgjrw8nmczj8cwq7o]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T14:37:32.024Z"}
{"level":"debug","message":"Executing query [m8rgjrwabzszngwigv]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-27T14:37:32.026Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:37:32.068Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:32.650Z"}
{"duration":"8ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-27T14:37:32.798Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-27T14:37:32.804Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:37:32.811Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-27T14:37:32.814Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:37:32.936Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:37:33.055Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-27T14:37:33.058Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:43:07.259Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:43:07.291Z"}
{"level":"debug","message":"Executing query [m8rgqylaefyus4803s]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-27T14:43:07.294Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:43:07.343Z"}
{"level":"debug","message":"Executing query [m8rgqymsxpnb8wim4ha]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:43:07.348Z"}
{"level":"debug","message":"Executing query [m8rgqymu8su7h53i9dm]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-27T14:43:07.350Z"}
{"level":"debug","message":"Executing query [m8rgqymw6aj5bqqsmc]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-27T14:43:07.352Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-27T14:43:07.353Z"}
{"level":"debug","message":"Executing query [m8rgqymy1e1gd7vlinu]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T14:43:07.354Z"}
{"level":"debug","message":"Executing query [m8rgqyn1d202pkmdhmq]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:43:07.357Z"}
{"level":"debug","message":"Executing query [m8rgqyn51fkw9r0u10z]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T14:43:07.361Z"}
{"level":"debug","message":"Executing query [m8rgqyn7ydxlg5w6f4]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:43:07.363Z"}
{"level":"debug","message":"Executing query [m8rgqyn8ivzdn7c2geg]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:43:07.364Z"}
{"level":"debug","message":"Executing query [m8rgqyn97lu9xnlpsu7]: DESCRIBE Usuario","params":"[]","timestamp":"2025-03-27T14:43:07.365Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por ID\" porque el usuario no se creó correctamente","timestamp":"2025-03-27T14:43:07.376Z"}
{"level":"warn","message":"Saltando prueba \"obtener usuario por CodigoCIP\" porque el usuario no se creó correctamente","timestamp":"2025-03-27T14:43:07.378Z"}
{"level":"warn","message":"Saltando prueba \"actualizar datos de usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-27T14:43:07.379Z"}
{"level":"warn","message":"Saltando prueba \"eliminar usuario\" porque el usuario no se creó correctamente","timestamp":"2025-03-27T14:43:07.381Z"}
{"level":"debug","message":"Executing query [m8rgqynqb5ew5njupxc]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T14:43:07.382Z"}
{"level":"debug","message":"Executing query [m8rgqyntghgjvx6k0v5]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:43:07.385Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-27T14:43:07.388Z"}
{"level":"debug","message":"Executing query [m8rgqynxdfhoeua2t55]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:43:07.389Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:43:07.391Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:48:10.699Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:48:10.735Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:48:10.742Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:48:10.749Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:48:10.755Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:48:10.779Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:48:10.782Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T14:48:10.791Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-27T14:48:11.077Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-27T14:48:11.103Z","userId":1,"userRole":"USER"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T14:48:10.796Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T14:48:10.803Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T14:48:10.811Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-27T14:48:10.817Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:11.258Z"}
{"level":"debug","message":"Executing query [m8rgxhc2bpaejl4ep4]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:48:11.522Z"}
{"level":"debug","message":"Executing query [m8rgxhgcg3ejgclyti]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743086891505\"]","timestamp":"2025-03-27T14:48:11.679Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:48:11.695Z"}
{"level":"debug","message":"Executing query [m8rgxhhsuir2gy7sio]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743086891505\"]","timestamp":"2025-03-27T14:48:11.728Z"}
{"level":"debug","message":"Executing query [m8rgxhi01nu1scr9asvj]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743086891505\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:48:11.736Z"}
{"level":"debug","message":"Executing query [m8rgxhii8duvezdiwy]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-27T14:48:11.755Z"}
{"level":"debug","message":"Executing query [m8rgxhiq21mbgm7lhod]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743086891505\"]","timestamp":"2025-03-27T14:48:11.762Z"}
{"level":"debug","message":"Executing query [m8rgxhiw3mxi0pzy7r6]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1005]","timestamp":"2025-03-27T14:48:11.768Z"}
{"level":"debug","message":"Executing query [m8rgxhj80sdmwa6zmqc]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-27T14:48:11.780Z"}
{"level":"debug","message":"Executing query [m8rgxhjff2sa3jijw9n]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-27T14:48:11.788Z"}
{"level":"debug","message":"Executing query [m8rgxhjpov6b9z3hsyq]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-27T14:48:11.797Z"}
{"level":"debug","message":"Executing query [m8rgxhjueyovcwjfvsj]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-27T14:48:11.802Z"}
{"level":"debug","message":"Executing query [m8rgxhjzl7ck2glxg9p]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-27T14:48:11.807Z"}
{"level":"debug","message":"Executing query [m8rgxhk6n0x9jarr2lq]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-27T14:48:11.814Z"}
{"level":"debug","message":"Executing query [m8rgxhkbutogu3zv3o]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-27T14:48:11.819Z"}
{"level":"debug","message":"Executing query [m8rgxhkg0974c7zo3kv5]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:48:11.824Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:48:11.829Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:11.906Z"}
{"level":"debug","message":"Executing query [m8rgxhpch8a7vj0f6z]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:12.000Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:48:12.096Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-27T14:48:12.117Z"}
{"level":"debug","message":"Executing query [m8rgxhsrnwj9waoffei]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:12.123Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-27T14:48:12.131Z"}
{"level":"debug","message":"Executing query [m8rgxht5w75hlxvxbsl]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:12.137Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-27T14:48:12.151Z"}
{"level":"debug","message":"Executing query [m8rgxhtlpui9ceqzm28]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:12.153Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-27T14:48:12.173Z"}
{"level":"debug","message":"Executing query [m8rgxhub5nyjmog085h]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:12.179Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-27T14:48:12.192Z"}
{"level":"debug","message":"Executing query [m8rgxhupmjcx8i76sg]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:12.193Z"}
{"level":"info","message":"✅ La tabla 'DocumentoArchivo' existe en la base de datos.","timestamp":"2025-03-27T14:48:12.198Z"}
{"level":"debug","message":"Executing query [m8rgxhuwl2yj7ritnpe]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:12.201Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-27T14:48:12.207Z"}
{"level":"debug","message":"Executing query [m8rgxhv43pydfy27eq1]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:12.209Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-27T14:48:12.213Z"}
{"level":"debug","message":"Executing query [m8rgxhv9sqy0gltm9v8]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:12.213Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8rgxhv9sqy0gltm9v8]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-27T14:48:12.220Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-27T14:48:12.221Z"}
{"level":"warn","message":"❌ Faltan 1 tablas estándar:\n   - Papelera","timestamp":"2025-03-27T14:48:12.221Z"}
{"level":"debug","message":"Executing query [m8rgxhvkteg3yuvjko]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:12.224Z"}
{"level":"info","message":"✅ La tabla especializada 'ForenseDigital' existe en la base de datos.","timestamp":"2025-03-27T14:48:12.229Z"}
{"level":"debug","message":"Executing query [m8rgxhvpkpu84jauws]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:12.229Z"}
{"level":"info","message":"✅ La tabla especializada 'QuimicaToxicologiaForense' existe en la base de datos.","timestamp":"2025-03-27T14:48:12.234Z"}
{"level":"debug","message":"Executing query [m8rgxhvud3kdbq47p4c]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:12.234Z"}
{"level":"info","message":"✅ La tabla especializada 'Dosaje' existe en la base de datos.","timestamp":"2025-03-27T14:48:12.236Z"}
{"level":"debug","message":"Executing query [m8rgxhvx7k6lus4yt5s]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:12.237Z"}
{"level":"info","message":"✅ La tabla especializada 'PermisoContextual' existe en la base de datos.","timestamp":"2025-03-27T14:48:12.241Z"}
{"level":"info","message":"✅ Todas las tablas especializadas existen.","timestamp":"2025-03-27T14:48:12.241Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-27T14:48:12.243Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-27T14:48:12.243Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-27T14:48:12.243Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-27T14:48:12.243Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-27T14:48:12.244Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-27T14:48:12.244Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-27T14:48:12.244Z"}
{"level":"info","message":"✅ DocumentoArchivo: exists","timestamp":"2025-03-27T14:48:12.245Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-27T14:48:12.245Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-27T14:48:12.245Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-27T14:48:12.245Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-27T14:48:12.245Z"}
{"level":"info","message":"✅ ForenseDigital: exists","timestamp":"2025-03-27T14:48:12.246Z"}
{"level":"info","message":"✅ QuimicaToxicologiaForense: exists","timestamp":"2025-03-27T14:48:12.246Z"}
{"level":"info","message":"✅ Dosaje: exists","timestamp":"2025-03-27T14:48:12.246Z"}
{"level":"info","message":"✅ PermisoContextual: exists","timestamp":"2025-03-27T14:48:12.246Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-27T14:48:12.246Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:48:12.249Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:12.313Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:12.436Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:48:12.719Z"}
{"level":"debug","message":"Executing query [m8rgxi9s2nokxlicz8h]: SELECT 1 as test","params":"[]","timestamp":"2025-03-27T14:48:12.737Z"}
{"level":"debug","message":"Executing query [m8rgxiaect2qcjwkswa]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-27T14:48:12.758Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8rgxiaect2qcjwkswa]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-27T14:48:12.775Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:48:12.779Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-27T14:48:12.633Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:11.863Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:12.968Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:12.945Z"}
{"level":"debug","message":"Executing query [m8rgxigkzd7i36d1tkb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:48:12.981Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:48:13.185Z"}
{"level":"debug","message":"Executing query [m8rgximwux56r78rg1l]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:13.208Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-27T14:48:12.616Z"}
{"level":"debug","message":"Executing query [m8rgxin5sdvwavhmfyr]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:13.217Z"}
{"level":"debug","message":"Executing query [m8rgxij3834tjc4ki4y]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:48:13.075Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:48:13.215Z"}
{"level":"debug","message":"Executing query [m8rgxindre2uqrdnx4e]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1743086892977\"]","timestamp":"2025-03-27T14:48:13.225Z"}
{"level":"debug","message":"Executing query [m8rgxing7tkqvusvh7g]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:13.228Z"}
{"level":"debug","message":"Executing query [m8rgxinhe86fco5xhhp]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, Detalles,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1743086892977\",\"TEST-OFI-DOSAJE-1743086892977\",793,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"Detalles de la prueba automatizada\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:48:13.229Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'Detalles' in 'field list'","level":"error","message":"Database query error [m8rgxinhe86fco5xhhp]","params":"[1,\"TEST-DOSAJE-1743086892977\",\"TEST-OFI-DOSAJE-1743086892977\",793,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"Detalles de la prueba automatizada\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","query":"INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, Detalles,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-27T14:48:13.234Z"}
{"level":"debug","message":"Executing query [m8rgxinxpt2klf9o6fb]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-27T14:48:13.245Z"}
{"level":"debug","message":"Executing query [m8rgxio21qnab1mh92d]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-SP-1743086893250\",\"TEST-SP\",999999,\"TOXICOLÓGICO\",\"ProcAlmacenado\",\"TestUsuario\",\"Prueba SP\",\"Sistema\",\"Creado por procedimiento almacenado de prueba\"]","timestamp":"2025-03-27T14:48:13.250Z"}
{"level":"debug","message":"Executing query [m8rgxioa1t1hs6qij2i]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-27T14:48:13.258Z"}
{"level":"debug","message":"Executing query [m8rgxiodff4h1lw159]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-SP-1743086893250\"]","timestamp":"2025-03-27T14:48:13.261Z"}
{"level":"debug","message":"Executing query [m8rgxiolhoiku32owjc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:48:13.269Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:48:13.273Z"}
{"level":"debug","message":"Executing query [m8rgxiolef74as1b8cv]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:13.269Z"}
{"level":"info","message":"Usando Mesa ID: 1, Áreas ID: 1/2, Usuarios ID: 1/2, Documento ID: 7","timestamp":"2025-03-27T14:48:13.273Z"}
{"level":"debug","message":"Executing query [m8rgxiov2htfdvljnrg]: DELETE FROM Derivacion WHERE IDDocumento = ? AND IDAreaOrigen = ? AND IDAreaDestino = ?","params":"[7,1,2]","timestamp":"2025-03-27T14:48:13.279Z"}
{"level":"debug","message":"Executing query [m8rgxip2nrcb1vss34n]: INSERT INTO Derivacion (\n          IDDocumento, IDMesaPartes, IDAreaOrigen, IDAreaDestino, \n          IDUsuarioDeriva, EstadoDerivacion, Observacion\n        ) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[7,1,1,2,1,\"PENDIENTE\",\"Derivación creada para pruebas automatizadas\"]","timestamp":"2025-03-27T14:48:13.287Z"}
{"level":"debug","message":"Executing query [m8rgxipfzx2pkv9aggm]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[11]","timestamp":"2025-03-27T14:48:13.299Z"}
{"level":"debug","message":"Executing query [m8rgxipni2rdei5ly8]: UPDATE Derivacion SET EstadoDerivacion = ?, Observacion = ?, FechaRecepcion = ?, IDUsuarioRecibe = ? WHERE IDDerivacion = ?","params":"[\"RECIBIDO\",\"Derivación actualizada en pruebas\",\"2025-03-27 14:48:13\",2,11]","timestamp":"2025-03-27T14:48:13.307Z"}
{"level":"debug","message":"Executing query [m8rgxipxhn4j6lxr8b]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[11]","timestamp":"2025-03-27T14:48:13.317Z"}
{"level":"debug","message":"Executing query [m8rgxiq26qib1n9lgwo]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-27T14:48:13.322Z"}
{"level":"debug","message":"Executing query [m8rgxiq633uzrhy0ona]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-27T14:48:13.326Z"}
{"level":"debug","message":"Executing query [m8rgxiqbc63togi3u54]: DELETE FROM Derivacion WHERE IDDerivacion = ?","params":"[11]","timestamp":"2025-03-27T14:48:13.331Z"}
{"level":"debug","message":"Executing query [m8rgxiqlceiahqo6kqg]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[11]","timestamp":"2025-03-27T14:48:13.341Z"}
{"level":"debug","message":"Executing query [m8rgxiqqczii8rduz0s]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[7]","timestamp":"2025-03-27T14:48:13.346Z"}
{"level":"debug","message":"Executing query [m8rgxiqx9vouz374w85]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:48:13.353Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:13.342Z"}
{"level":"debug","message":"Executing query [m8rgxisp67uw0f2phov]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:48:13.418Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:48:13.534Z"}
{"level":"debug","message":"Executing query [m8rgxiwgk69sczqrnj]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:13.552Z"}
{"level":"debug","message":"Executing query [m8rgxiwo7cjgejy4pz4]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:13.560Z"}
{"level":"debug","message":"Executing query [m8rgxiwwrp8ne6yr7nf]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1743086893415\"]","timestamp":"2025-03-27T14:48:13.568Z"}
{"level":"debug","message":"Executing query [m8rgxix0w1un8d08a68]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1743086893415\",\"TEST-OFI-FORENSE-1743086893415\",1132,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1743086893415\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:48:13.572Z"}
{"level":"debug","message":"Executing query [m8rgxixfvim31vo6s9k]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-27T14:48:13.587Z"}
{"level":"debug","message":"Executing query [m8rgxixojgwquhlnvy8]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1743086893415\"]","timestamp":"2025-03-27T14:48:13.596Z"}
{"level":"debug","message":"Executing query [m8rgxixt5y0sw4ssfiq]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",15]","timestamp":"2025-03-27T14:48:13.601Z"}
{"level":"debug","message":"Executing query [m8rgxixzqw5plxkerzl]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-27T14:48:13.607Z"}
{"level":"debug","message":"Executing query [m8rgxiy5cl9138cceao]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-27T14:48:13.613Z"}
{"level":"debug","message":"Executing query [m8rgxiyg3elzmett0o]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-27T14:48:13.624Z"}
{"level":"debug","message":"Executing query [m8rgxiylbof1y9ivqcv]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-27T14:48:13.629Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-27T14:48:13.592Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-27T14:48:13.595Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-27T14:48:13.605Z"}
{"level":"debug","message":"Executing query [m8rgxiysnptru9zrg0p]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-27T14:48:13.636Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-27T14:48:13.612Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-27T14:48:13.618Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-27T14:48:13.618Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Executing query [m8rgxiyw8wcb26jggqi]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1743086893640\",\"TEST-SP-OFI-FORENSE-1743086893640\",6174,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-27T14:48:13.640Z"}
{"level":"debug","message":"Executing query [m8rgxiz2ddgz6gfsqa]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1743086893640\"]","timestamp":"2025-03-27T14:48:13.646Z"}
{"level":"debug","message":"Executing query [m8rgxiz8oznj0h1fgt9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:48:13.652Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:48:13.657Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:14.271Z"}
{"level":"debug","message":"Executing query [m8rgxjgzknxg182ygol]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:48:14.291Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:48:14.361Z"}
{"level":"debug","message":"Executing query [m8rgxjj0kch7ajj60x]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:14.365Z"}
{"level":"debug","message":"Executing query [m8rgxjj4knqj961983]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-27T14:48:14.368Z"}
{"level":"debug","message":"Executing query [m8rgxjj90tecktx9p45]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-27T14:48:14.373Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-27T14:48:14.375Z"}
{"level":"debug","message":"Executing query [m8rgxjjccwhwj1lay6o]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-27T14:48:14.376Z"}
{"level":"debug","message":"Executing query [m8rgxjjf22nylqleott]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-27T14:48:14.379Z"}
{"level":"debug","message":"Executing query [m8rgxjjifldnfhw95p]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-27T14:48:14.382Z"}
{"level":"debug","message":"Executing query [m8rgxjkxrtm9815uq2m]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-27T14:48:14.433Z"}
{"level":"debug","message":"Executing query [m8rgxjl4fryckdatrmg]: SELECT 1 FROM v_permisos_contextuales LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:14.441Z"}
{"level":"debug","message":"Executing query [m8rgxjl8qj57daghu9]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-27T14:48:14.444Z"}
{"level":"debug","message":"Executing query [m8rgxjlhyn2fipvdsz]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",21]","timestamp":"2025-03-27T14:48:14.453Z"}
{"level":"debug","message":"Executing query [m8rgxjlqtz84uyoxs7b]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-27T14:48:14.463Z"}
{"level":"debug","message":"Executing query [m8rgxjlutca7sgiviqt]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-27T14:48:14.466Z"}
{"level":"debug","message":"Executing query [m8rgxjm4c29qg4pomk]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-27T14:48:14.476Z"}
{"level":"debug","message":"Executing query [m8rgxjm79n59s9to8x]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:48:14.479Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:48:14.482Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:14.641Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:14.400Z"}
{"level":"debug","message":"Executing query [m8rgxjr1onxo1dhxe6l]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:48:14.653Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:48:14.753Z"}
{"level":"debug","message":"Executing query [m8rgxjtzfbrep80xrx]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:14.759Z"}
{"level":"debug","message":"Executing query [m8rgxjubom9ury2tx9]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:14.772Z"}
{"level":"debug","message":"Executing query [m8rgxjunew2u4u91fe9]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1743086894647\"]","timestamp":"2025-03-27T14:48:14.784Z"}
{"level":"debug","message":"Executing query [m8rgxjuz4tleq677j27]: \n        INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)\n      ","params":"[1,\"TEST-QUIMICA-1743086894647\",\"TEST-OFI-QUIMICA-1743086894647\",1372,\"SANGRE\",\"Nombre de Prueba\",\"Apellido de Prueba\",\"NEGATIVO\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:48:14.797Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:14.709Z"}
{"level":"debug","message":"Executing query [m8rgxjvfomln2og3rlp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:48:14.811Z"}
{"level":"debug","message":"Executing query [m8rgxjw2y21korhdbxg]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-27T14:48:14.834Z"}
{"level":"debug","message":"Executing query [m8rgxjwksykpzh6ezwb]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1743086894647\"]","timestamp":"2025-03-27T14:48:14.852Z"}
{"level":"debug","message":"Executing query [m8rgxjwqeq9ydzj9h0o]: UPDATE QuimicaToxicologiaForense SET TipoMuestra = ?, ResultadoPreliminar = ? WHERE IDQuimicaToxForense = ?","params":"[\"ORINA\",\"POSITIVO\",7]","timestamp":"2025-03-27T14:48:14.858Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'TipoMuestra' in 'field list'","level":"error","message":"Database query error [m8rgxjwqeq9ydzj9h0o]","params":"[\"ORINA\",\"POSITIVO\",7]","query":"UPDATE QuimicaToxicologiaForense SET TipoMuestra = ?, ResultadoPreliminar = ? WHERE IDQuimicaToxForense = ?","timestamp":"2025-03-27T14:48:14.861Z"}
{"level":"debug","message":"Executing query [m8rgxjwuhue5z5ggdb]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-27T14:48:14.863Z"}
{"level":"debug","message":"Executing query [m8rgxjx5ejtxl5oyrpp]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-27T14:48:14.874Z"}
{"level":"debug","message":"Executing query [m8rgxjxdtr1rqo5g5t]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-27T14:48:14.881Z"}
{"level":"debug","message":"Executing query [m8rgxjxjt9u7pecq6q]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-27T14:48:14.887Z"}
{"level":"debug","message":"Executing query [m8rgxjxm8v1u0h786o7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:48:14.890Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:48:14.904Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:48:14.922Z"}
{"level":"debug","message":"Executing query [m8rgxjymp8ajrd4jcv]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:14.926Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8rgxjymp8ajrd4jcv]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-27T14:48:14.937Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-27T14:48:14.938Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:15.285Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:15.327Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:15.338Z"}
{"level":"debug","message":"Executing query [m8rgxka51mx14f3vppi]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:15.341Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:48:15.391Z"}
{"level":"debug","message":"Executing query [m8rgxka6egdvwikf2z5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:48:15.343Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:48:15.394Z"}
{"level":"debug","message":"Executing query [m8rgxkbol1ny56uxfli]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:48:15.397Z"}
{"level":"debug","message":"Executing query [m8rgxkbqe6uyqg9ipzn]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-27T14:48:15.398Z"}
{"level":"debug","message":"Executing query [m8rgxkbtyvfxpz1uige]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-27T14:48:15.401Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-27T14:48:15.405Z"}
{"level":"debug","message":"Executing query [m8rgxkbx78pjetk18l4]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T14:48:15.405Z"}
{"level":"debug","message":"Executing query [m8rgxkc14q8u14vf9zq]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:48:15.409Z"}
{"level":"debug","message":"Executing query [m8rgxkc2e8wmkhtmdxt]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743086895340\"]","timestamp":"2025-03-27T14:48:15.411Z"}
{"level":"debug","message":"Executing query [m8rgxkc4klw95f7srv]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T14:48:15.412Z"}
{"level":"debug","message":"Executing query [m8rgxkc6mbsen6yvqyg]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743086895340\",true]","timestamp":"2025-03-27T14:48:15.414Z"}
{"level":"debug","message":"Executing query [m8rgxkc5xotvwfdodd8]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:48:15.414Z"}
{"level":"debug","message":"Executing query [m8rgxkc7nlgsnrtiqwe]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:48:15.415Z"}
{"level":"debug","message":"Executing query [m8rgxkcbkl1qs5iovdh]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Grado) \n                  VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"hashed_password_mock\",999,999,\"PRUEBA\"]","timestamp":"2025-03-27T14:48:15.419Z"}
{"level":"debug","message":"Executing query [m8rgxkcejkkjdmwlbvi]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-27T14:48:15.422Z"}
{"level":"debug","message":"Executing query [m8rgxkcjg3c7hqaa5d]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[17]","timestamp":"2025-03-27T14:48:15.427Z"}
{"level":"debug","message":"Executing query [m8rgxkcl34mffdq36as]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743086895340\"]","timestamp":"2025-03-27T14:48:15.429Z"}
{"level":"debug","message":"Executing query [m8rgxkcph484h35pkv]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:48:15.433Z"}
{"level":"debug","message":"Executing query [m8rgxkcpkhp24d20hpe]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",13]","timestamp":"2025-03-27T14:48:15.433Z"}
{"level":"debug","message":"Executing query [m8rgxkcuyv2dyo8u7zf]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",17]","timestamp":"2025-03-27T14:48:15.438Z"}
{"level":"debug","message":"Executing query [m8rgxkcvz96n3mp3328]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-27T14:48:15.439Z"}
{"level":"debug","message":"Executing query [m8rgxkcyebpung76st4]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-27T14:48:15.442Z"}
{"level":"debug","message":"Executing query [m8rgxkcz9kwapcjgrfb]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[17]","timestamp":"2025-03-27T14:48:15.443Z"}
{"level":"debug","message":"Executing query [m8rgxkd20vi46vycgy6]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[17]","timestamp":"2025-03-27T14:48:15.446Z"}
{"level":"debug","message":"Executing query [m8rgxkd3li9m69pvgvh]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-27T14:48:15.447Z"}
{"level":"debug","message":"Executing query [m8rgxkd6rdja8gox47]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-27T14:48:15.450Z"}
{"level":"debug","message":"Executing query [m8rgxkd9dqy2iuscy8]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-27T14:48:15.453Z"}
{"level":"debug","message":"Executing query [m8rgxkdah1vp686ldeb]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[17]","timestamp":"2025-03-27T14:48:15.455Z"}
{"level":"debug","message":"Executing query [m8rgxkdgh0hguwqt3xk]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-27T14:48:15.460Z"}
{"level":"debug","message":"Executing query [m8rgxkde5buq3wkwt0y]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T14:48:15.459Z"}
{"level":"debug","message":"Executing query [m8rgxkdhxrnhhkyma0o]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:48:15.461Z"}
{"level":"debug","message":"Executing query [m8rgxkdi0pis4lnzx8l]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-27T14:48:15.462Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-27T14:48:15.463Z"}
{"level":"debug","message":"Executing query [m8rgxkdj5qfbxpcvyg2]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:48:15.463Z"}
{"level":"debug","message":"Executing query [m8rgxkdllpsac7u8q1]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:48:15.465Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:48:15.468Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:48:15.466Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:15.376Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-27T14:48:15.950Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-27T14:48:16.041Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:48:16.463Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-27T14:48:16.530Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:48:16.623Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:16.611Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-27T14:48:16.912Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:48:17.079Z"}
{"level":"debug","message":"Executing query [m8rgxlnuyv8uz9zekz]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:17.130Z"}
{"level":"debug","message":"Executing query [m8rgxlofonlvmgz061e]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T14:48:17.151Z"}
{"level":"debug","message":"Executing query [m8rgxlohcfs4xooblah]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-27T14:48:17.153Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:48:17.194Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:17.992Z"}
{"duration":"13ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-27T14:48:18.194Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:48:18.195Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-27T14:48:18.201Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:48:18.209Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:48:18.275Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:48:18.428Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-27T14:48:18.430Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:50:03.830Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:50:04.224Z"}
{"level":"debug","message":"Executing query [m8rgzwatq5e32rzn5ue]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-27T14:50:04.229Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:50:04.291Z"}
{"level":"debug","message":"Executing query [m8rgzwcqmp3yvpbe2e]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:50:04.298Z"}
{"level":"debug","message":"Executing query [m8rgzwct8ooghc05itx]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-27T14:50:04.301Z"}
{"level":"debug","message":"Executing query [m8rgzwcwhiwnl8mouk]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-27T14:50:04.304Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-27T14:50:04.306Z"}
{"level":"debug","message":"Executing query [m8rgzwcz3e425yfj7ux]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T14:50:04.307Z"}
{"level":"debug","message":"Executing query [m8rgzwd2zlqthe2qczb]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:50:04.310Z"}
{"level":"debug","message":"Executing query [m8rgzwd61ity4x8inlj]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T14:50:04.314Z"}
{"level":"debug","message":"Executing query [m8rgzwd9rxmjshepnes]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:50:04.317Z"}
{"level":"debug","message":"Executing query [m8rgzwdaw58ce23mvf]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:50:04.318Z"}
{"level":"debug","message":"Executing query [m8rgzwe20ql2honeqoh8]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Grado) \n                  VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$04$jEwRsPG5pTtt5WDKV1l1z.5YO.R1KKrjDHzlz0siXtS9R8CH1I6Aq\",999,999,\"PRUEBA\"]","timestamp":"2025-03-27T14:50:04.346Z"}
{"level":"debug","message":"Executing query [m8rgzweamuqh9nzgl5q]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[18]","timestamp":"2025-03-27T14:50:04.354Z"}
{"level":"debug","message":"Executing query [m8rgzwegrpkvgugpixp]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:50:04.361Z"}
{"level":"debug","message":"Executing query [m8rgzwelzv2eb30wgph]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",18]","timestamp":"2025-03-27T14:50:04.365Z"}
{"level":"debug","message":"Executing query [m8rgzwepc5l2prl2dqv]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[18]","timestamp":"2025-03-27T14:50:04.369Z"}
{"level":"debug","message":"Executing query [m8rgzweu6tr6y4d2nfb]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[18]","timestamp":"2025-03-27T14:50:04.374Z"}
{"level":"debug","message":"Executing query [m8rgzwezwctukbohb59]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[18]","timestamp":"2025-03-27T14:50:04.379Z"}
{"level":"debug","message":"Executing query [m8rgzwf1cwo8xqaji14]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T14:50:04.381Z"}
{"level":"debug","message":"Executing query [m8rgzwf3hiul2xymsa]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:50:04.383Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-27T14:50:04.385Z"}
{"level":"debug","message":"Executing query [m8rgzwf69p0kfzkrkn]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:50:04.386Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:50:04.388Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:50:48.025Z"}
{"level":"debug","message":"Executing query [m8rh0u49aavgrc2x6e6]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:50:48.057Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:50:48.105Z"}
{"level":"debug","message":"Executing query [m8rh0u5poa8dmuvoh0g]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-27T14:50:48.109Z"}
{"level":"debug","message":"Executing query [m8rh0u5uuj90gb1dz1]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:50:48.114Z"}
{"level":"debug","message":"Executing query [m8rh0u60ylj0q641ldg]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1743087048055\"]","timestamp":"2025-03-27T14:50:48.120Z"}
{"level":"debug","message":"Executing query [m8rh0u63rl1bqex7jop]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, Detalles,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1743087048055\",\"TEST-OFI-DOSAJE-1743087048055\",3653,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"Detalles de la prueba automatizada\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:50:48.123Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'Detalles' in 'field list'","level":"error","message":"Database query error [m8rh0u63rl1bqex7jop]","params":"[1,\"TEST-DOSAJE-1743087048055\",\"TEST-OFI-DOSAJE-1743087048055\",3653,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"Detalles de la prueba automatizada\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","query":"INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, Detalles,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-27T14:50:48.126Z"}
{"level":"debug","message":"Executing query [m8rh0u6inw3ejo1oyu]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-SP-1743087048138\",\"TEST-SP\",999999,\"TOXICOLÓGICO\",\"ProcAlmacenado\",\"TestUsuario\",\"Prueba SP\",\"Sistema\",\"Creado por procedimiento almacenado de prueba\"]","timestamp":"2025-03-27T14:50:48.139Z"}
{"level":"debug","message":"Executing query [m8rh0u6p3dy2y0rg41f]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-SP-1743087048138\"]","timestamp":"2025-03-27T14:50:48.145Z"}
{"level":"debug","message":"Executing query [m8rh0u6v7rg8l4jl3sx]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:50:48.151Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:50:48.154Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:51:09.537Z"}
{"level":"debug","message":"Executing query [m8rh1apwax0noetd7dg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:51:09.572Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:51:09.619Z"}
{"level":"debug","message":"Executing query [m8rh1arbvekb0hzmxi]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:09.623Z"}
{"level":"debug","message":"Executing query [m8rh1arfmvc64u5qkyf]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:09.628Z"}
{"level":"debug","message":"Executing query [m8rh1arluoxtnho58u]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1743087069569\"]","timestamp":"2025-03-27T14:51:09.633Z"}
{"level":"debug","message":"Executing query [m8rh1aroxacqs809y6i]: \n        INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)\n      ","params":"[1,\"TEST-QUIMICA-1743087069569\",\"TEST-OFI-QUIMICA-1743087069569\",7364,\"SANGRE\",\"Nombre de Prueba\",\"Apellido de Prueba\",\"NEGATIVO\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:51:09.636Z"}
{"level":"debug","message":"Executing query [m8rh1aryhwluwbz6s1j]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-27T14:51:09.646Z"}
{"level":"debug","message":"Executing query [m8rh1asa1swn77sv9la]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1743087069569\"]","timestamp":"2025-03-27T14:51:09.658Z"}
{"level":"debug","message":"Executing query [m8rh1aseqmc5shb6nr]: UPDATE QuimicaToxicologiaForense SET TipoMuestra = ?, ResultadoPreliminar = ? WHERE IDQuimicaToxForense = ?","params":"[\"ORINA\",\"POSITIVO\",8]","timestamp":"2025-03-27T14:51:09.662Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'TipoMuestra' in 'field list'","level":"error","message":"Database query error [m8rh1aseqmc5shb6nr]","params":"[\"ORINA\",\"POSITIVO\",8]","query":"UPDATE QuimicaToxicologiaForense SET TipoMuestra = ?, ResultadoPreliminar = ? WHERE IDQuimicaToxForense = ?","timestamp":"2025-03-27T14:51:09.665Z"}
{"level":"debug","message":"Executing query [m8rh1asjn2xfepv80ub]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-27T14:51:09.667Z"}
{"level":"debug","message":"Executing query [m8rh1asoa8frmbl1v76]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-27T14:51:09.672Z"}
{"level":"debug","message":"Executing query [m8rh1asrb91iepztpsc]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-27T14:51:09.675Z"}
{"level":"debug","message":"Executing query [m8rh1asxpepnzvlo7cg]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-27T14:51:09.681Z"}
{"level":"debug","message":"Executing query [m8rh1at1zxx16dtt9d]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:51:09.685Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:51:09.687Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:51:54.852Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:51:54.895Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:51:54.906Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:51:54.912Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:51:54.919Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:51:54.926Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-27T14:51:54.929Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T14:51:54.950Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T14:51:54.957Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T14:51:54.962Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T14:51:54.965Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-27T14:51:54.969Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:51:55.479Z"}
{"level":"debug","message":"Executing query [m8rh2aci2j64p35n617]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:51:55.746Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:51:55.853Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-27T14:51:55.779Z"}
{"level":"debug","message":"Executing query [m8rh2ag061dwfyvbolr]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743087115736\"]","timestamp":"2025-03-27T14:51:55.873Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-27T14:51:55.824Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Executing query [m8rh2agtxli7xpz2gv]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743087115736\"]","timestamp":"2025-03-27T14:51:55.901Z"}
{"level":"debug","message":"Executing query [m8rh2agxbc422dhv7eg]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743087115736\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:51:55.905Z"}
{"level":"debug","message":"Executing query [m8rh2ahbur20w72dun]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-27T14:51:55.920Z"}
{"level":"debug","message":"Executing query [m8rh2ahjjgenlsfrdyg]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743087115736\"]","timestamp":"2025-03-27T14:51:55.927Z"}
{"level":"debug","message":"Executing query [m8rh2aho64z9iaxr2gb]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1006]","timestamp":"2025-03-27T14:51:55.932Z"}
{"level":"debug","message":"Executing query [m8rh2ahy63ed0cxf9l]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-27T14:51:55.943Z"}
{"level":"debug","message":"Executing query [m8rh2ai8x1ibis6uuh]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-27T14:51:55.953Z"}
{"level":"debug","message":"Executing query [m8rh2aihhl2n4mvy0em]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-27T14:51:55.961Z"}
{"level":"debug","message":"Executing query [m8rh2aimc3g7v11iv3m]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-27T14:51:55.966Z"}
{"level":"debug","message":"Executing query [m8rh2aiq9bh0g9uhnmc]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-27T14:51:55.971Z"}
{"level":"debug","message":"Executing query [m8rh2aiw2l9ij5c4mhp]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-27T14:51:55.977Z"}
{"level":"debug","message":"Executing query [m8rh2aj0gdy1ywbham]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-27T14:51:55.980Z"}
{"level":"debug","message":"Executing query [m8rh2aj509poh8hgy40o]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:51:55.985Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:51:55.990Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:51:56.148Z"}
{"level":"debug","message":"Executing query [m8rh2aq4trw6pcpmd9]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:56.237Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-27T14:51:56.449Z"}
{"level":"debug","message":"Executing query [m8rh2aw2byk3raeu8d]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:56.451Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:51:56.460Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-27T14:51:56.464Z"}
{"level":"debug","message":"Executing query [m8rh2awg3q61n0asxsq]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:56.464Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-27T14:51:56.472Z"}
{"level":"debug","message":"Executing query [m8rh2awo5rke339letp]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:56.473Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-27T14:51:56.478Z"}
{"level":"debug","message":"Executing query [m8rh2awumsm5mpc1wkj]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:56.479Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-27T14:51:56.481Z"}
{"level":"debug","message":"Executing query [m8rh2awza9jhiskzv94]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:56.483Z"}
{"level":"info","message":"✅ La tabla 'DocumentoArchivo' existe en la base de datos.","timestamp":"2025-03-27T14:51:56.493Z"}
{"level":"debug","message":"Executing query [m8rh2axb0ud8dj7zdkd]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:56.495Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-27T14:51:56.506Z"}
{"level":"debug","message":"Executing query [m8rh2axu75ar00pj0jk]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:56.515Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-27T14:51:56.524Z"}
{"level":"debug","message":"Executing query [m8rh2ay4uc2swa2keg]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:56.524Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8rh2ay4uc2swa2keg]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-27T14:51:56.536Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-27T14:51:56.560Z"}
{"level":"warn","message":"❌ Faltan 1 tablas estándar:\n   - Papelera","timestamp":"2025-03-27T14:51:56.561Z"}
{"level":"debug","message":"Executing query [m8rh2azf2k8qfd84yh]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:56.571Z"}
{"level":"info","message":"✅ La tabla especializada 'ForenseDigital' existe en la base de datos.","timestamp":"2025-03-27T14:51:56.576Z"}
{"level":"debug","message":"Executing query [m8rh2azlgeeo5jcqta4]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:56.577Z"}
{"level":"info","message":"✅ La tabla especializada 'QuimicaToxicologiaForense' existe en la base de datos.","timestamp":"2025-03-27T14:51:56.591Z"}
{"level":"debug","message":"Executing query [m8rh2b01lut1husugrq]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:56.593Z"}
{"level":"info","message":"✅ La tabla especializada 'Dosaje' existe en la base de datos.","timestamp":"2025-03-27T14:51:56.601Z"}
{"level":"debug","message":"Executing query [m8rh2b0anyu6hmmmv7s]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:56.602Z"}
{"level":"info","message":"✅ La tabla especializada 'PermisoContextual' existe en la base de datos.","timestamp":"2025-03-27T14:51:56.611Z"}
{"level":"info","message":"✅ Todas las tablas especializadas existen.","timestamp":"2025-03-27T14:51:56.612Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-27T14:51:56.615Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-27T14:51:56.615Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-27T14:51:56.615Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-27T14:51:56.616Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-27T14:51:56.616Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-27T14:51:56.616Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-27T14:51:56.616Z"}
{"level":"info","message":"✅ DocumentoArchivo: exists","timestamp":"2025-03-27T14:51:56.616Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-27T14:51:56.616Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-27T14:51:56.616Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-27T14:51:56.617Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-27T14:51:56.617Z"}
{"level":"info","message":"✅ ForenseDigital: exists","timestamp":"2025-03-27T14:51:56.617Z"}
{"level":"info","message":"✅ QuimicaToxicologiaForense: exists","timestamp":"2025-03-27T14:51:56.617Z"}
{"level":"info","message":"✅ Dosaje: exists","timestamp":"2025-03-27T14:51:56.617Z"}
{"level":"info","message":"✅ PermisoContextual: exists","timestamp":"2025-03-27T14:51:56.617Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-27T14:51:56.617Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:51:56.622Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:51:56.709Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-27T14:51:56.920Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:51:56.464Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:51:57.142Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-27T14:51:57.080Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:51:57.464Z"}
{"level":"debug","message":"Executing query [m8rh2bolki31vpzbmz]: SELECT 1 as test","params":"[]","timestamp":"2025-03-27T14:51:57.477Z"}
{"level":"debug","message":"Executing query [m8rh2boujpnnlev8n9b]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-27T14:51:57.486Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:51:57.320Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8rh2boujpnnlev8n9b]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-27T14:51:57.512Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:51:57.516Z"}
{"level":"debug","message":"Executing query [m8rh2boa51emk9ma6sc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:51:57.467Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:51:57.654Z"}
{"level":"debug","message":"Executing query [m8rh2btrxe43rv9c19f]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:57.672Z"}
{"level":"debug","message":"Executing query [m8rh2bufra315hi6hi]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-27T14:51:57.687Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:51:57.539Z"}
{"level":"debug","message":"Executing query [m8rh2bu0m45yr9u3oi9]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:51:57.672Z"}
{"level":"debug","message":"Executing query [m8rh2bv7xd0mpnq9yx]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-27T14:51:57.716Z"}
{"level":"debug","message":"Executing query [m8rh2bvd99457ix52oq]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:57.722Z"}
{"level":"info","message":"Usando Mesa ID: 1, Áreas ID: 1/2, Usuarios ID: 1/2, Documento ID: 8","timestamp":"2025-03-27T14:51:57.726Z"}
{"level":"debug","message":"Executing query [m8rh2bvkjjgy42bcz2f]: DELETE FROM Derivacion WHERE IDDocumento = ? AND IDAreaOrigen = ? AND IDAreaDestino = ?","params":"[8,1,2]","timestamp":"2025-03-27T14:51:57.728Z"}
{"level":"debug","message":"Executing query [m8rh2bvprye8orj77gm]: INSERT INTO Derivacion (\n          IDDocumento, IDMesaPartes, IDAreaOrigen, IDAreaDestino, \n          IDUsuarioDeriva, EstadoDerivacion, Observacion\n        ) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[8,1,1,2,1,\"PENDIENTE\",\"Derivación creada para pruebas automatizadas\"]","timestamp":"2025-03-27T14:51:57.734Z"}
{"level":"debug","message":"Executing query [m8rh2bw3h65k0ksf02b]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[12]","timestamp":"2025-03-27T14:51:57.748Z"}
{"level":"debug","message":"Executing query [m8rh2bwcbakl2yu77c6]: UPDATE Derivacion SET EstadoDerivacion = ?, Observacion = ?, FechaRecepcion = ?, IDUsuarioRecibe = ? WHERE IDDerivacion = ?","params":"[\"RECIBIDO\",\"Derivación actualizada en pruebas\",\"2025-03-27 14:51:57\",2,12]","timestamp":"2025-03-27T14:51:57.756Z"}
{"level":"debug","message":"Executing query [m8rh2bwk9dc4z6me98w]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[12]","timestamp":"2025-03-27T14:51:57.764Z"}
{"level":"debug","message":"Executing query [m8rh2bwqua5i9flyf4]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-27T14:51:57.770Z"}
{"level":"debug","message":"Executing query [m8rh2bwwuen5j566gwd]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-27T14:51:57.776Z"}
{"level":"debug","message":"Executing query [m8rh2bx0xvomn9y0cv]: DELETE FROM Derivacion WHERE IDDerivacion = ?","params":"[12]","timestamp":"2025-03-27T14:51:57.780Z"}
{"level":"debug","message":"Executing query [m8rh2bxd3socf7vunem]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[12]","timestamp":"2025-03-27T14:51:57.794Z"}
{"level":"debug","message":"Executing query [m8rh2bxhuvxw714qj0i]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[8]","timestamp":"2025-03-27T14:51:57.797Z"}
{"level":"debug","message":"Executing query [m8rh2bxp3w14npx00po]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:51:57.805Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:51:57.828Z"}
{"level":"debug","message":"Executing query [m8rh2byja8w9kgn0ow8]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:57.835Z"}
{"level":"debug","message":"Executing query [m8rh2byqwxcnif6dkh]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:57.843Z"}
{"level":"debug","message":"Executing query [m8rh2bywfyqj9w346q4]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1743087117670\"]","timestamp":"2025-03-27T14:51:57.849Z"}
{"level":"debug","message":"Executing query [m8rh2bz12ecepy71vtm]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, Detalles,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1743087117670\",\"TEST-OFI-DOSAJE-1743087117670\",3888,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"Detalles de la prueba automatizada\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:51:57.853Z"}
{"code":"ER_BAD_FIELD_ERROR","error":"Unknown column 'Detalles' in 'field list'","level":"error","message":"Database query error [m8rh2bz12ecepy71vtm]","params":"[1,\"TEST-DOSAJE-1743087117670\",\"TEST-OFI-DOSAJE-1743087117670\",3888,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"Detalles de la prueba automatizada\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","query":"INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, Detalles,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","timestamp":"2025-03-27T14:51:57.857Z"}
{"level":"debug","message":"Executing query [m8rh2bzdcjm3dqotpyc]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-SP-1743087117865\",\"TEST-SP\",999999,\"TOXICOLÓGICO\",\"ProcAlmacenado\",\"TestUsuario\",\"Prueba SP\",\"Sistema\",\"Creado por procedimiento almacenado de prueba\"]","timestamp":"2025-03-27T14:51:57.866Z"}
{"level":"debug","message":"Executing query [m8rh2bzm00lsqoxfe7j2c]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-SP-1743087117865\"]","timestamp":"2025-03-27T14:51:57.874Z"}
{"level":"debug","message":"Executing query [m8rh2bzxx05uiecrho]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:51:57.885Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:51:57.888Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-27T14:51:58.407Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-27T14:51:58.409Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-27T14:51:58.411Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-27T14:51:58.415Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-27T14:51:58.417Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-27T14:51:58.417Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:51:58.748Z"}
{"level":"debug","message":"Executing query [m8rh2csa11own605akmb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:51:58.906Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:51:58.977Z"}
{"level":"debug","message":"Executing query [m8rh2cxkiu9g9nmhvid]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:59.096Z"}
{"level":"debug","message":"Executing query [m8rh2cxxtkaed44b8ei]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:59.109Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:51:59.115Z"}
{"level":"debug","message":"Executing query [m8rh2cy71edxq4rjjv4]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1743087118902\"]","timestamp":"2025-03-27T14:51:59.120Z"}
{"level":"debug","message":"Executing query [m8rh2cydfftv7pk04wl]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1743087118902\",\"TEST-OFI-FORENSE-1743087118902\",6687,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1743087118902\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:51:59.125Z"}
{"level":"debug","message":"Executing query [m8rh2cuf1f8z06hxa0r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:51:58.983Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:51:59.168Z"}
{"level":"debug","message":"Executing query [m8rh2czmi26bc9mmoep]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:59.170Z"}
{"level":"debug","message":"Executing query [m8rh2czltqlth83v10h]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-27T14:51:59.169Z"}
{"level":"debug","message":"Executing query [m8rh2czqsaqsdo6wks]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-27T14:51:59.174Z"}
{"level":"debug","message":"Executing query [m8rh2czusy385llj9rs]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-27T14:51:59.178Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-27T14:51:59.182Z"}
{"level":"debug","message":"Executing query [m8rh2czywkwd1cb3djo]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-27T14:51:59.183Z"}
{"level":"debug","message":"Executing query [m8rh2d09o2j4c153w7k]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-27T14:51:59.193Z"}
{"level":"debug","message":"Executing query [m8rh2d0f2d4ws65vfht]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1743087118902\"]","timestamp":"2025-03-27T14:51:59.199Z"}
{"level":"debug","message":"Executing query [m8rh2d0fffe4gifkx1g]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-27T14:51:59.199Z"}
{"level":"debug","message":"Executing query [m8rh2d0lqgtd99u7swo]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",17]","timestamp":"2025-03-27T14:51:59.205Z"}
{"level":"debug","message":"Executing query [m8rh2d0u72cp6orryh8]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[22]","timestamp":"2025-03-27T14:51:59.215Z"}
{"level":"debug","message":"Executing query [m8rh2d11d0zhx1nf8mv]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-27T14:51:59.221Z"}
{"level":"debug","message":"Executing query [m8rh2d13zyxws13ryg]: SELECT 1 FROM v_permisos_contextuales LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:59.224Z"}
{"level":"debug","message":"Executing query [m8rh2d18wezu2bb0wmj]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[22]","timestamp":"2025-03-27T14:51:59.228Z"}
{"level":"debug","message":"Executing query [m8rh2d17k04k46c6ixa]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-27T14:51:59.227Z"}
{"level":"debug","message":"Executing query [m8rh2d1edx75b7ye1av]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",22]","timestamp":"2025-03-27T14:51:59.234Z"}
{"level":"debug","message":"Executing query [m8rh2d1ul06oslfjbuo]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-27T14:51:59.250Z"}
{"level":"debug","message":"Executing query [m8rh2d1uwfnzosg8nj]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[22]","timestamp":"2025-03-27T14:51:59.250Z"}
{"level":"debug","message":"Executing query [m8rh2d1z06gt5n48bnrm]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[22]","timestamp":"2025-03-27T14:51:59.255Z"}
{"level":"debug","message":"Executing query [m8rh2d1z4feglscl40n]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-27T14:51:59.255Z"}
{"level":"debug","message":"Executing query [m8rh2d2cyl5fvxfzky9]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[22]","timestamp":"2025-03-27T14:51:59.268Z"}
{"level":"debug","message":"Executing query [m8rh2d2c4k4r1s1l97y]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-27T14:51:59.268Z"}
{"level":"debug","message":"Executing query [m8rh2d2fgz1mowcd7xi]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:51:59.271Z"}
{"level":"debug","message":"Executing query [m8rh2d2g7idcdk2q7xn]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1743087119272\",\"TEST-SP-OFI-FORENSE-1743087119272\",7586,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-27T14:51:59.272Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:51:59.276Z"}
{"level":"debug","message":"Executing query [m8rh2d2og7is94nrr5c]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1743087119272\"]","timestamp":"2025-03-27T14:51:59.281Z"}
{"level":"debug","message":"Executing query [m8rh2d2ul2qi1553ler]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:51:59.287Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:51:59.290Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:51:59.480Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:51:59.715Z"}
{"level":"debug","message":"Executing query [m8rh2dc121vmpt3h863]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:51:59.618Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:51:59.797Z"}
{"level":"debug","message":"Executing query [m8rh2dh9g4z8tf50f3]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743087119616\"]","timestamp":"2025-03-27T14:51:59.806Z"}
{"level":"debug","message":"Executing query [m8rh2dhgws7tvgy14c]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743087119616\",true]","timestamp":"2025-03-27T14:51:59.812Z"}
{"level":"debug","message":"Executing query [m8rh2di8zztxmqxqv3e]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-27T14:51:59.840Z"}
{"level":"debug","message":"Executing query [m8rh2dih3tsa0kio5gs]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743087119616\"]","timestamp":"2025-03-27T14:51:59.849Z"}
{"level":"debug","message":"Executing query [m8rh2dilurdpxt9y6sc]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",14]","timestamp":"2025-03-27T14:51:59.854Z"}
{"level":"debug","message":"Executing query [m8rh2dit6ed5wzqb6ti]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-27T14:51:59.861Z"}
{"level":"debug","message":"Executing query [m8rh2diznnrlixqu9a]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-27T14:51:59.867Z"}
{"level":"debug","message":"Executing query [m8rh2dj6y84ail67pcr]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-27T14:51:59.874Z"}
{"level":"debug","message":"Executing query [m8rh2djbcmv6oyh91on]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-27T14:51:59.880Z"}
{"level":"debug","message":"Executing query [m8rh2djhcub05k0812r]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-27T14:51:59.886Z"}
{"level":"debug","message":"Executing query [m8rh2djp4uu7lbrp6c4]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-27T14:51:59.893Z"}
{"level":"debug","message":"Executing query [m8rh2djsdin9d4oyetj]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-27T14:51:59.896Z"}
{"level":"debug","message":"Executing query [m8rh2djx8nmg0amtj2e]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:51:59.901Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:51:59.905Z"}
{"level":"debug","message":"Executing query [m8rh2dfoed4h05o5u6t]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:51:59.749Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:51:59.961Z"}
{"level":"debug","message":"Executing query [m8rh2dm1toa2jil5k9m]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:59.977Z"}
{"level":"debug","message":"Executing query [m8rh2dmbzc0k0301s2]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T14:51:59.987Z"}
{"level":"debug","message":"Executing query [m8rh2dmi23vi507vnf]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1743087119729\"]","timestamp":"2025-03-27T14:51:59.995Z"}
{"level":"debug","message":"Executing query [m8rh2doz8y5dgam9ojw]: \n        INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)\n      ","params":"[1,\"TEST-QUIMICA-1743087119729\",\"TEST-OFI-QUIMICA-1743087119729\",7361,\"SANGRE\",\"Nombre de Prueba\",\"Apellido de Prueba\",\"NEGATIVO\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T14:52:00.083Z"}
{"level":"debug","message":"Executing query [m8rh2dpajajwsihh15i]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-27T14:52:00.094Z"}
{"level":"debug","message":"Executing query [m8rh2dpj3jjdka9vm1q]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1743087119729\"]","timestamp":"2025-03-27T14:52:00.103Z"}
{"level":"debug","message":"Executing query [m8rh2dpplcj1dwy8d8]: UPDATE QuimicaToxicologiaForense SET Examen = ?, DelitoInfraccion = ? WHERE IDQuimicaToxForense = ?","params":"[\"TOXICOLOGICO\",\"POSITIVO\",9]","timestamp":"2025-03-27T14:52:00.110Z"}
{"level":"debug","message":"Executing query [m8rh2dpvwymjsy3khua]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-27T14:52:00.116Z"}
{"level":"debug","message":"Executing query [m8rh2dq1fq0j69us35d]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-27T14:52:00.121Z"}
{"level":"debug","message":"Executing query [m8rh2dqae9l6i30yr3]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-27T14:52:00.130Z"}
{"level":"debug","message":"Executing query [m8rh2dqfnjh241p3px]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-27T14:52:00.135Z"}
{"level":"debug","message":"Executing query [m8rh2dqknajfzym9mja]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-27T14:52:00.140Z"}
{"level":"debug","message":"Executing query [m8rh2dqno9lfp19zn3q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:52:00.143Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:52:00.149Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:52:00.414Z"}
{"level":"debug","message":"Executing query [m8rh2e0a3d2yu4h2mfh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:52:00.491Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:52:00.617Z"}
{"level":"debug","message":"Executing query [m8rh2e4u5pdwvczhnwa]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-27T14:52:00.655Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8rh2e4u5pdwvczhnwa]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-27T14:52:00.658Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-27T14:52:00.660Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:52:00.645Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:52:00.707Z"}
{"level":"debug","message":"Executing query [m8rh2e6eoodqy2vt959]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-27T14:52:00.710Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:52:00.777Z"}
{"level":"debug","message":"Executing query [m8rh2e8fiev841b6caj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T14:52:00.783Z"}
{"level":"debug","message":"Executing query [m8rh2e8lwnsquozcoj]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-27T14:52:00.789Z"}
{"level":"debug","message":"Executing query [m8rh2e8n73zgg6dcds]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-27T14:52:00.791Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-27T14:52:00.795Z"}
{"level":"debug","message":"Executing query [m8rh2e8smi3d1635g7d]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T14:52:00.796Z"}
{"level":"debug","message":"Executing query [m8rh2e96wx1cwb30km8]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:52:00.810Z"}
{"level":"debug","message":"Executing query [m8rh2e9t97uagyj2zxf]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T14:52:00.837Z"}
{"level":"debug","message":"Executing query [m8rh2e9zek26sl1ebaa]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:52:00.839Z"}
{"level":"debug","message":"Executing query [m8rh2ea2j5ymo8bzkj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:52:00.842Z"}
{"level":"debug","message":"Executing query [m8rh2eeg1it7wcruht4]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Grado) \n                  VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"$2a$04$UCJUvzfY4K8uuR7efxxhC.ecSALIBQIxsOEzyctA9rKV5/XI4qJD2\",999,999,\"PRUEBA\"]","timestamp":"2025-03-27T14:52:01.000Z"}
{"level":"debug","message":"Executing query [m8rh2eerkaq5jdpkt5k]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[19]","timestamp":"2025-03-27T14:52:01.011Z"}
{"level":"debug","message":"Executing query [m8rh2eeylp1521l59ks]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:52:01.018Z"}
{"level":"debug","message":"Executing query [m8rh2ef39b5jylbywep]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",19]","timestamp":"2025-03-27T14:52:01.023Z"}
{"level":"debug","message":"Executing query [m8rh2efaueqklym17da]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[19]","timestamp":"2025-03-27T14:52:01.030Z"}
{"level":"debug","message":"Executing query [m8rh2efefb5b0qqhiir]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[19]","timestamp":"2025-03-27T14:52:01.034Z"}
{"level":"debug","message":"Executing query [m8rh2efm3tp0eqz2oz5]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[19]","timestamp":"2025-03-27T14:52:01.042Z"}
{"level":"debug","message":"Executing query [m8rh2efq7vurs49jiog]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T14:52:01.046Z"}
{"level":"debug","message":"Executing query [m8rh2efthjwz5x96xp]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T14:52:01.049Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-27T14:52:01.052Z"}
{"level":"debug","message":"Executing query [m8rh2efxjtjqyxxyey]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T14:52:01.053Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:52:01.055Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:51:59.456Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:52:01.152Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-27T14:52:01.860Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-27T14:52:01.890Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:52:02.415Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-27T14:52:02.494Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:52:02.607Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:52:02.804Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-27T14:52:03.068Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:52:03.248Z"}
{"level":"debug","message":"Executing query [m8rh2g6zrmr676cobcj]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T14:52:03.323Z"}
{"level":"debug","message":"Executing query [m8rh2g83yxl7m2y3oeb]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T14:52:03.363Z"}
{"level":"debug","message":"Executing query [m8rh2g86l2aecf6j0h]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-27T14:52:03.366Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:52:03.428Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:52:04.930Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T14:52:05.062Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:52:05.334Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T14:52:05.326Z"}
{"duration":"69ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-27T14:52:05.333Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-27T14:52:05.340Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-27T14:52:05.346Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T14:52:05.356Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:00:37.537Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:00:37.721Z"}
{"level":"debug","message":"Executing query [m8rhdh4lapjftx4iywe]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T15:00:37.749Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T15:00:37.780Z"}
{"level":"debug","message":"Executing query [m8rhdh5jzbmemdctb6]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:37.783Z"}
{"level":"debug","message":"Executing query [m8rhdh5ntidarxjj2ae]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:37.787Z"}
{"level":"debug","message":"Executing query [m8rhdh5p6sb6jbftnjb]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1743087637748\"]","timestamp":"2025-03-27T15:00:37.789Z"}
{"level":"debug","message":"Executing query [m8rhdh5sqbukrosdhv8]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, Procedencia,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1743087637748\",\"TEST-OFI-DOSAJE-1743087637748\",9423,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"Procedencia de la prueba automatizada\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T15:00:37.792Z"}
{"level":"debug","message":"Executing query [m8rhdh60iaegeth5rxi]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[16]","timestamp":"2025-03-27T15:00:37.800Z"}
{"level":"debug","message":"Executing query [m8rhdh64nicknmj9s3]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1743087637748\"]","timestamp":"2025-03-27T15:00:37.804Z"}
{"level":"debug","message":"Executing query [m8rhdh68kd3fj0rikgo]: UPDATE Dosaje SET TipoDosaje = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"TOXICOLÓGICO\",\"Registro dosaje actualizado en pruebas\",16]","timestamp":"2025-03-27T15:00:37.808Z"}
{"level":"debug","message":"Executing query [m8rhdh6c0m4ue83wwgto]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[16]","timestamp":"2025-03-27T15:00:37.812Z"}
{"level":"debug","message":"Executing query [m8rhdh6fsoje5ypsok]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[16]","timestamp":"2025-03-27T15:00:37.815Z"}
{"level":"debug","message":"Executing query [m8rhdh6jlnw4gh5jjw]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[16]","timestamp":"2025-03-27T15:00:37.819Z"}
{"level":"debug","message":"Executing query [m8rhdh6mn6l9qip9mer]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[16]","timestamp":"2025-03-27T15:00:37.822Z"}
{"level":"debug","message":"Executing query [m8rhdh6p4gi6n2pj32l]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[16]","timestamp":"2025-03-27T15:00:37.825Z"}
{"level":"debug","message":"Executing query [m8rhdh6slcsi76vvds]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-SP-1743087637828\",\"TEST-SP\",999999,\"TOXICOLÓGICO\",\"ProcAlmacenado\",\"TestUsuario\",\"Prueba SP\",\"Sistema\",\"Creado por procedimiento almacenado de prueba\"]","timestamp":"2025-03-27T15:00:37.828Z"}
{"level":"debug","message":"Executing query [m8rhdh6xrib07to64b]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-SP-1743087637828\"]","timestamp":"2025-03-27T15:00:37.833Z"}
{"level":"debug","message":"Executing query [m8rhdh71ez28t7j61qf]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T15:00:37.838Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T15:00:37.839Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:00:51.772Z"}
{"level":"debug","message":"Executing query [m8rhdryolkotzn3hqo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T15:00:51.792Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T15:00:51.826Z"}
{"level":"debug","message":"Executing query [m8rhdrzoo1lle3npde]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743087651791\"]","timestamp":"2025-03-27T15:00:51.828Z"}
{"level":"debug","message":"Executing query [m8rhdrzso04btu0r24]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743087651791\"]","timestamp":"2025-03-27T15:00:51.832Z"}
{"level":"debug","message":"Executing query [m8rhdrzt9fqr9jewrtr]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1743087651791\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-27T15:00:51.833Z"}
{"level":"debug","message":"Executing query [m8rhds00dubsbtri4no]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-27T15:00:51.840Z"}
{"level":"debug","message":"Executing query [m8rhds048mzrer3wrk]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1743087651791\"]","timestamp":"2025-03-27T15:00:51.844Z"}
{"level":"debug","message":"Executing query [m8rhds067gnql8khz7n]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1007]","timestamp":"2025-03-27T15:00:51.846Z"}
{"level":"debug","message":"Executing query [m8rhds0an1ep3qf29dh]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-27T15:00:51.850Z"}
{"level":"debug","message":"Executing query [m8rhds0crgi7ldoxto]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-27T15:00:51.852Z"}
{"level":"debug","message":"Executing query [m8rhds0f2l1uwm75kmc]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-27T15:00:51.855Z"}
{"level":"debug","message":"Executing query [m8rhds0ij0wd7cb1vzb]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-27T15:00:51.858Z"}
{"level":"debug","message":"Executing query [m8rhds0jh9k1qgb54xi]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-27T15:00:51.859Z"}
{"level":"debug","message":"Executing query [m8rhds0mzg2vheici69]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-27T15:00:51.862Z"}
{"level":"debug","message":"Executing query [m8rhds0ogz1yslux9pr]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-27T15:00:51.864Z"}
{"level":"debug","message":"Executing query [m8rhds0qrjmo5d576js]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T15:00:51.866Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T15:00:51.868Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-27T15:00:51.966Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-27T15:00:51.968Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-27T15:00:51.970Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-27T15:00:51.972Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-27T15:00:51.976Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-27T15:00:51.978Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-27T15:00:51.980Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T15:00:51.983Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T15:00:51.985Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T15:00:51.986Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-27T15:00:51.987Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-27T15:00:51.989Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:00:52.198Z"}
{"error":"Token inválido","ip":"127.0.0.1","level":"warn","message":"Security Event [INVALID_TOKEN]","method":"GET","path":"/api/test","timestamp":"2025-03-27T15:00:52.389Z"}
{"level":"warn","message":"Security Event [UNAUTHORIZED_ACCESS]","method":"GET","path":"/api/test","requiredRoles":["ADMIN","MANAGER"],"timestamp":"2025-03-27T15:00:52.393Z","userId":1,"userRole":"USER"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:00:53.930Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-27T15:00:54.150Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-27T15:00:54.158Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T15:00:54.219Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-27T15:00:54.233Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T15:00:54.283Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:00:54.731Z"}
{"level":"debug","message":"Executing query [m8rhdu8ezcdwb4f4ao]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:54.734Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T15:00:54.750Z"}
{"level":"info","message":"✅ La tabla 'Usuario' existe en la base de datos.","timestamp":"2025-03-27T15:00:54.753Z"}
{"level":"debug","message":"Executing query [m8rhdu8zxyek15opgz]: SELECT 1 FROM Rol LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:54.755Z"}
{"level":"info","message":"✅ La tabla 'Rol' existe en la base de datos.","timestamp":"2025-03-27T15:00:54.756Z"}
{"level":"debug","message":"Executing query [m8rhdu90pcm5qt9ljt]: SELECT 1 FROM Permiso LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:54.756Z"}
{"level":"info","message":"✅ La tabla 'Permiso' existe en la base de datos.","timestamp":"2025-03-27T15:00:54.759Z"}
{"level":"debug","message":"Executing query [m8rhdu94jvmler3ikjb]: SELECT 1 FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:54.760Z"}
{"level":"info","message":"✅ La tabla 'AreaEspecializada' existe en la base de datos.","timestamp":"2025-03-27T15:00:54.761Z"}
{"level":"debug","message":"Executing query [m8rhdu95motyazz17i]: SELECT 1 FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:54.761Z"}
{"level":"info","message":"✅ La tabla 'Documento' existe en la base de datos.","timestamp":"2025-03-27T15:00:54.762Z"}
{"level":"debug","message":"Executing query [m8rhdu96fnu9u22kdx]: SELECT 1 FROM DocumentoArchivo LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:54.762Z"}
{"level":"info","message":"✅ La tabla 'DocumentoArchivo' existe en la base de datos.","timestamp":"2025-03-27T15:00:54.763Z"}
{"level":"debug","message":"Executing query [m8rhdu980yceyjznu56]: SELECT 1 FROM Derivacion LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:54.764Z"}
{"level":"info","message":"✅ La tabla 'Derivacion' existe en la base de datos.","timestamp":"2025-03-27T15:00:54.766Z"}
{"level":"debug","message":"Executing query [m8rhdu9apx7iv1ch0lj]: SELECT 1 FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:54.766Z"}
{"level":"info","message":"✅ La tabla 'MesaPartes' existe en la base de datos.","timestamp":"2025-03-27T15:00:54.767Z"}
{"level":"debug","message":"Executing query [m8rhdu9ce3dt0zwp9y]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:54.768Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8rhdu9ce3dt0zwp9y]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-27T15:00:54.769Z"}
{"level":"warn","message":"❌ La tabla 'Papelera' NO existe en la base de datos.","timestamp":"2025-03-27T15:00:54.770Z"}
{"level":"warn","message":"❌ Faltan 1 tablas estándar:\n   - Papelera","timestamp":"2025-03-27T15:00:54.770Z"}
{"level":"debug","message":"Executing query [m8rhdu9hlpjxvh2k28b]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:54.773Z"}
{"level":"info","message":"✅ La tabla especializada 'ForenseDigital' existe en la base de datos.","timestamp":"2025-03-27T15:00:54.775Z"}
{"level":"debug","message":"Executing query [m8rhdu9k30693r06tfd]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:54.776Z"}
{"level":"info","message":"✅ La tabla especializada 'QuimicaToxicologiaForense' existe en la base de datos.","timestamp":"2025-03-27T15:00:54.777Z"}
{"level":"debug","message":"Executing query [m8rhdu9lk4mblira13]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:54.777Z"}
{"level":"info","message":"✅ La tabla especializada 'Dosaje' existe en la base de datos.","timestamp":"2025-03-27T15:00:54.780Z"}
{"level":"debug","message":"Executing query [m8rhdu9pdfwsi15tss]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:54.781Z"}
{"level":"info","message":"✅ La tabla especializada 'PermisoContextual' existe en la base de datos.","timestamp":"2025-03-27T15:00:54.782Z"}
{"level":"info","message":"✅ Todas las tablas especializadas existen.","timestamp":"2025-03-27T15:00:54.783Z"}
{"level":"info","message":"=== RESUMEN DE TABLAS EN LA BASE DE DATOS ===","timestamp":"2025-03-27T15:00:54.784Z"}
{"level":"info","message":"Tablas estándar:","timestamp":"2025-03-27T15:00:54.784Z"}
{"level":"info","message":"✅ Usuario: exists","timestamp":"2025-03-27T15:00:54.785Z"}
{"level":"info","message":"✅ Rol: exists","timestamp":"2025-03-27T15:00:54.785Z"}
{"level":"info","message":"✅ Permiso: exists","timestamp":"2025-03-27T15:00:54.785Z"}
{"level":"info","message":"✅ AreaEspecializada: exists","timestamp":"2025-03-27T15:00:54.786Z"}
{"level":"info","message":"✅ Documento: exists","timestamp":"2025-03-27T15:00:54.786Z"}
{"level":"info","message":"✅ DocumentoArchivo: exists","timestamp":"2025-03-27T15:00:54.787Z"}
{"level":"info","message":"✅ Derivacion: exists","timestamp":"2025-03-27T15:00:54.787Z"}
{"level":"info","message":"✅ MesaPartes: exists","timestamp":"2025-03-27T15:00:54.788Z"}
{"level":"info","message":"❌ Papelera: missing","timestamp":"2025-03-27T15:00:54.788Z"}
{"level":"info","message":"\nTablas especializadas:","timestamp":"2025-03-27T15:00:54.788Z"}
{"level":"info","message":"✅ ForenseDigital: exists","timestamp":"2025-03-27T15:00:54.789Z"}
{"level":"info","message":"✅ QuimicaToxicologiaForense: exists","timestamp":"2025-03-27T15:00:54.789Z"}
{"level":"info","message":"✅ Dosaje: exists","timestamp":"2025-03-27T15:00:54.789Z"}
{"level":"info","message":"✅ PermisoContextual: exists","timestamp":"2025-03-27T15:00:54.790Z"}
{"level":"info","message":"==========================================","timestamp":"2025-03-27T15:00:54.790Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T15:00:54.792Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:00:55.823Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:00:56.040Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T15:00:56.058Z"}
{"level":"debug","message":"Executing query [m8rhdv99nafn9k1pua]: SELECT 1 as test","params":"[]","timestamp":"2025-03-27T15:00:56.061Z"}
{"level":"debug","message":"Executing query [m8rhdv9cmqe4jn26z0j]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-27T15:00:56.064Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8rhdv9cmqe4jn26z0j]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-27T15:00:56.066Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T15:00:56.068Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:00:56.185Z"}
{"level":"debug","message":"Executing query [m8rhdvct741nlnl8zox]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T15:00:56.189Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T15:00:56.208Z"}
{"level":"debug","message":"Executing query [m8rhdvdddgbhcpvvgok]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:56.209Z"}
{"level":"debug","message":"Executing query [m8rhdvdgvmkd6nd3h3]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-27T15:00:56.212Z"}
{"level":"debug","message":"Executing query [m8rhdvdh3e5avkj1bm9]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-27T15:00:56.213Z"}
{"level":"debug","message":"Executing query [m8rhdvdkvb2wikg0vh]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-27T15:00:56.216Z"}
{"level":"info","message":"Usando Mesa ID: 1, Áreas ID: 1/2, Usuarios ID: 1/2, Documento ID: 10","timestamp":"2025-03-27T15:00:56.219Z"}
{"level":"debug","message":"Executing query [m8rhdvdp2zlf8nck84v]: DELETE FROM Derivacion WHERE IDDocumento = ? AND IDAreaOrigen = ? AND IDAreaDestino = ?","params":"[10,1,2]","timestamp":"2025-03-27T15:00:56.221Z"}
{"level":"debug","message":"Executing query [m8rhdvds9058pzwo8dp]: INSERT INTO Derivacion (\n          IDDocumento, IDMesaPartes, IDAreaOrigen, IDAreaDestino, \n          IDUsuarioDeriva, EstadoDerivacion, Observacion\n        ) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[10,1,1,2,1,\"PENDIENTE\",\"Derivación creada para pruebas automatizadas\"]","timestamp":"2025-03-27T15:00:56.225Z"}
{"level":"debug","message":"Executing query [m8rhdve1lt6nos3w8l]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[13]","timestamp":"2025-03-27T15:00:56.233Z"}
{"level":"debug","message":"Executing query [m8rhdve66n6zfdwgdt5]: UPDATE Derivacion SET EstadoDerivacion = ?, Observacion = ?, FechaRecepcion = ?, IDUsuarioRecibe = ? WHERE IDDerivacion = ?","params":"[\"RECIBIDO\",\"Derivación actualizada en pruebas\",\"2025-03-27 15:00:56\",2,13]","timestamp":"2025-03-27T15:00:56.238Z"}
{"level":"debug","message":"Executing query [m8rhdvea8vdmcpoyp0f]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[13]","timestamp":"2025-03-27T15:00:56.243Z"}
{"level":"debug","message":"Executing query [m8rhdveeo6i6dzjew2m]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-27T15:00:56.247Z"}
{"level":"debug","message":"Executing query [m8rhdvehgtq4s8h631u]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-27T15:00:56.250Z"}
{"level":"debug","message":"Executing query [m8rhdvemyhw351bfugo]: DELETE FROM Derivacion WHERE IDDerivacion = ?","params":"[13]","timestamp":"2025-03-27T15:00:56.254Z"}
{"level":"debug","message":"Executing query [m8rhdverqlbisi920up]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[13]","timestamp":"2025-03-27T15:00:56.259Z"}
{"level":"debug","message":"Executing query [m8rhdvevyukcdsgs2bk]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[10]","timestamp":"2025-03-27T15:00:56.263Z"}
{"level":"debug","message":"Executing query [m8rhdvf08dlur7zszfb]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T15:00:56.268Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:00:59.534Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T15:00:59.656Z"}
{"duration":"19ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-27T15:00:59.661Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-27T15:00:59.664Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T15:00:59.676Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-27T15:00:59.863Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-27T15:01:00.072Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:01:00.268Z"}
{"level":"debug","message":"Executing query [m8rhdyidawt753oj1hp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T15:01:00.277Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T15:01:00.289Z"}
{"level":"debug","message":"Executing query [m8rhdyirbpmdy62adwi]: SELECT 1 FROM Dosaje LIMIT 1","params":"[]","timestamp":"2025-03-27T15:01:00.291Z"}
{"level":"debug","message":"Executing query [m8rhdyiuj3nmvx4aia]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T15:01:00.294Z"}
{"level":"debug","message":"Executing query [m8rhdyiwn6yoksjfdje]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1743087660276\"]","timestamp":"2025-03-27T15:01:00.296Z"}
{"level":"debug","message":"Executing query [m8rhdyixeizpxc6tq8o]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, Procedencia,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1743087660276\",\"TEST-OFI-DOSAJE-1743087660276\",3671,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"Procedencia de la prueba automatizada\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T15:01:00.297Z"}
{"level":"debug","message":"Executing query [m8rhdyj44mfyo7pfanc]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[18]","timestamp":"2025-03-27T15:01:00.304Z"}
{"level":"debug","message":"Executing query [m8rhdyj9hl8nvdqlppc]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1743087660276\"]","timestamp":"2025-03-27T15:01:00.309Z"}
{"level":"debug","message":"Executing query [m8rhdyjc335rqq5vtf8]: UPDATE Dosaje SET TipoDosaje = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"TOXICOLÓGICO\",\"Registro dosaje actualizado en pruebas\",18]","timestamp":"2025-03-27T15:01:00.312Z"}
{"level":"debug","message":"Executing query [m8rhdyjhy5mgp2tyzj]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[18]","timestamp":"2025-03-27T15:01:00.317Z"}
{"level":"debug","message":"Executing query [m8rhdyjkpmgogcnb1w]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[18]","timestamp":"2025-03-27T15:01:00.320Z"}
{"level":"debug","message":"Executing query [m8rhdyjomevellhgxg]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[18]","timestamp":"2025-03-27T15:01:00.324Z"}
{"level":"debug","message":"Executing query [m8rhdyjss3c5abydvm]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[18]","timestamp":"2025-03-27T15:01:00.328Z"}
{"level":"debug","message":"Executing query [m8rhdyjw65tapzexdfp]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[18]","timestamp":"2025-03-27T15:01:00.332Z"}
{"level":"debug","message":"Executing query [m8rhdyjztqyvwyln2v7]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-SP-1743087660335\",\"TEST-SP\",999999,\"TOXICOLÓGICO\",\"ProcAlmacenado\",\"TestUsuario\",\"Prueba SP\",\"Sistema\",\"Creado por procedimiento almacenado de prueba\"]","timestamp":"2025-03-27T15:01:00.335Z"}
{"level":"debug","message":"Executing query [m8rhdyk4jkmc1xsvb]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-SP-1743087660335\"]","timestamp":"2025-03-27T15:01:00.340Z"}
{"level":"debug","message":"Executing query [m8rhdyk85ybndf0ahok]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T15:01:00.344Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T15:01:00.346Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:01:00.959Z"}
{"level":"debug","message":"Executing query [m8rhdz1ftclp5nkwkk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T15:01:00.964Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T15:01:00.983Z"}
{"level":"debug","message":"Executing query [m8rhdz27nvpwbdhwvf8]: SELECT 1 FROM ForenseDigital LIMIT 1","params":"[]","timestamp":"2025-03-27T15:01:00.991Z"}
{"level":"debug","message":"Executing query [m8rhdz2bwsmu2uzc2i]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T15:01:00.995Z"}
{"level":"debug","message":"Executing query [m8rhdz2fl12dzpst3v]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1743087660962\"]","timestamp":"2025-03-27T15:01:00.999Z"}
{"level":"debug","message":"Executing query [m8rhdz2ivj70gvi20vs]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1743087660962\",\"TEST-OFI-FORENSE-1743087660962\",2958,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1743087660962\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T15:01:01.002Z"}
{"level":"debug","message":"Executing query [m8rhdz2r9et1oq5sdwb]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-27T15:01:01.011Z"}
{"level":"debug","message":"Executing query [m8rhdz2wppjz4imp6l]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1743087660962\"]","timestamp":"2025-03-27T15:01:01.016Z"}
{"level":"debug","message":"Executing query [m8rhdz31qtu61um6go]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",19]","timestamp":"2025-03-27T15:01:01.021Z"}
{"level":"debug","message":"Executing query [m8rhdz36n7odo2413xl]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-27T15:01:01.026Z"}
{"level":"debug","message":"Executing query [m8rhdz3axnbnm88f0vf]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-27T15:01:01.030Z"}
{"level":"debug","message":"Executing query [m8rhdz3eaxjwvgoomd]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-27T15:01:01.034Z"}
{"level":"debug","message":"Executing query [m8rhdz3ia1fu3tttt2]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-27T15:01:01.038Z"}
{"level":"debug","message":"Executing query [m8rhdz3n473ia4ogral]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-27T15:01:01.043Z"}
{"level":"debug","message":"Executing query [m8rhdz3qtibxb14mur]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1743087661046\",\"TEST-SP-OFI-FORENSE-1743087661046\",5990,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-27T15:01:01.046Z"}
{"level":"debug","message":"Executing query [m8rhdz3vzs7oczmvry]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1743087661046\"]","timestamp":"2025-03-27T15:01:01.052Z"}
{"level":"debug","message":"Executing query [m8rhdz4295quoo4jp5]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T15:01:01.058Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T15:01:01.060Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:01:02.703Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T15:01:02.798Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\test\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-27T15:01:02.801Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-27T15:01:02.982Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-27T15:01:02.984Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-27T15:01:02.984Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-27T15:01:02.985Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-27T15:01:02.988Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-27T15:01:02.988Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:01:03.752Z"}
{"level":"debug","message":"Executing query [m8rhe16zku6s5oidbdk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T15:01:03.755Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T15:01:03.771Z"}
{"level":"debug","message":"Executing query [m8rhe17h3g8x01wyhb4]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743087663754\"]","timestamp":"2025-03-27T15:01:03.773Z"}
{"level":"debug","message":"Executing query [m8rhe17jcnv6x55h5zj]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1743087663754\",true]","timestamp":"2025-03-27T15:01:03.775Z"}
{"level":"debug","message":"Executing query [m8rhe17q0qvoy4fvltp]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-27T15:01:03.782Z"}
{"level":"debug","message":"Executing query [m8rhe17tyybafz7j0r]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1743087663754\"]","timestamp":"2025-03-27T15:01:03.785Z"}
{"level":"debug","message":"Executing query [m8rhe17wwadsi9m62wg]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",15]","timestamp":"2025-03-27T15:01:03.788Z"}
{"level":"debug","message":"Executing query [m8rhe180fsob4ttwrw]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-27T15:01:03.792Z"}
{"level":"debug","message":"Executing query [m8rhe183tpnjecgx04]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-27T15:01:03.795Z"}
{"level":"debug","message":"Executing query [m8rhe188hyxgeo484th]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-27T15:01:03.800Z"}
{"level":"debug","message":"Executing query [m8rhe18al6w2s9b0z8m]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-27T15:01:03.802Z"}
{"level":"debug","message":"Executing query [m8rhe18co34ok67fo9]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-27T15:01:03.804Z"}
{"level":"debug","message":"Executing query [m8rhe18gnrt5h79tul]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-27T15:01:03.808Z"}
{"level":"debug","message":"Executing query [m8rhe18iksw66y1ob6]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-27T15:01:03.810Z"}
{"level":"debug","message":"Executing query [m8rhe18kqlzw8k1voep]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T15:01:03.812Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T15:01:03.814Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:01:04.056Z"}
{"level":"debug","message":"Executing query [m8rhe1ff0y06c8ulsqrn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T15:01:04.059Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T15:01:04.070Z"}
{"level":"debug","message":"Executing query [m8rhe1fsv77kgxb8b9l]: SELECT 1 FROM Papelera LIMIT 1","params":"[]","timestamp":"2025-03-27T15:01:04.072Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.papelera' doesn't exist","level":"error","message":"Database query error [m8rhe1fsv77kgxb8b9l]","params":"[]","query":"SELECT 1 FROM Papelera LIMIT 1","timestamp":"2025-03-27T15:01:04.074Z"}
{"level":"warn","message":"La tabla Papelera no existe. Las pruebas de esta entidad serán omitidas.","timestamp":"2025-03-27T15:01:04.075Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:01:04.214Z"}
{"level":"debug","message":"Executing query [m8rhe1jto5osbowe4aj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T15:01:04.217Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T15:01:04.235Z"}
{"level":"debug","message":"Executing query [m8rhe1kcjmhmjjn00al]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T15:01:04.236Z"}
{"level":"debug","message":"Executing query [m8rhe1kep0j38su174j]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-27T15:01:04.239Z"}
{"level":"debug","message":"Executing query [m8rhe1kg0zbqvuopp2qc]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-27T15:01:04.241Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-27T15:01:04.242Z"}
{"level":"debug","message":"Executing query [m8rhe1kisx5962chol]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-27T15:01:04.242Z"}
{"level":"debug","message":"Executing query [m8rhe1kkk8di51rgjye]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-27T15:01:04.245Z"}
{"level":"debug","message":"Executing query [m8rhe1kn8bck27pz3c]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-27T15:01:04.247Z"}
{"level":"debug","message":"Executing query [m8rhe1kt067i7tmpam8j]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[23]","timestamp":"2025-03-27T15:01:04.253Z"}
{"level":"debug","message":"Executing query [m8rhe1kxln2gwxlmcrs]: SELECT 1 FROM v_permisos_contextuales LIMIT 1","params":"[]","timestamp":"2025-03-27T15:01:04.257Z"}
{"level":"debug","message":"Executing query [m8rhe1kzr3pnhul4y7]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[23]","timestamp":"2025-03-27T15:01:04.259Z"}
{"level":"debug","message":"Executing query [m8rhe1l2re50e0ebdy]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",23]","timestamp":"2025-03-27T15:01:04.262Z"}
{"level":"debug","message":"Executing query [m8rhe1l66ffrc429abh]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[23]","timestamp":"2025-03-27T15:01:04.266Z"}
{"level":"debug","message":"Executing query [m8rhe1l8a0ocqqbr1go]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[23]","timestamp":"2025-03-27T15:01:04.268Z"}
{"level":"debug","message":"Executing query [m8rhe1lcuhovnylnjz7]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[23]","timestamp":"2025-03-27T15:01:04.272Z"}
{"level":"debug","message":"Executing query [m8rhe1lecrpxjg6gofl]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T15:01:04.274Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T15:01:04.275Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:01:04.499Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:01:05.192Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-27T15:01:05.287Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T15:01:05.367Z"}
{"level":"debug","message":"Executing query [m8rhe2hfe071mc7f7g]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T15:01:05.427Z"}
{"level":"debug","message":"Executing query [m8rhe2hzuxqk8i3jqyg]: SELECT 1 FROM PermisoContextual LIMIT 1","params":"[]","timestamp":"2025-03-27T15:01:05.447Z"}
{"level":"debug","message":"Executing query [m8rhe2i1440j344igu1]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-27T15:01:05.449Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T15:01:05.486Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:01:05.751Z"}
{"level":"debug","message":"Executing query [m8rhe2qig9t19qzv7oh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T15:01:05.754Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T15:01:05.767Z"}
{"level":"debug","message":"Executing query [m8rhe2r0dzem53mvbb4]: SELECT 1 FROM QuimicaToxicologiaForense LIMIT 1","params":"[]","timestamp":"2025-03-27T15:01:05.772Z"}
{"level":"debug","message":"Executing query [m8rhe2r3crz5thbde0v]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-27T15:01:05.775Z"}
{"level":"debug","message":"Executing query [m8rhe2r5q6sqtg9c5r]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1743087665754\"]","timestamp":"2025-03-27T15:01:05.777Z"}
{"level":"debug","message":"Executing query [m8rhe2r6k2oonmi7f2b]: \n        INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?)\n      ","params":"[1,\"TEST-QUIMICA-1743087665754\",\"TEST-OFI-QUIMICA-1743087665754\",4309,\"SANGRE\",\"Nombre de Prueba\",\"Apellido de Prueba\",\"NEGATIVO\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-27T15:01:05.778Z"}
{"level":"debug","message":"Executing query [m8rhe2rd4i36jn3fddi]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-27T15:01:05.785Z"}
{"level":"debug","message":"Executing query [m8rhe2rg9fnrvknpjxi]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1743087665754\"]","timestamp":"2025-03-27T15:01:05.789Z"}
{"level":"debug","message":"Executing query [m8rhe2rjc7gu0vkwubk]: UPDATE QuimicaToxicologiaForense SET Examen = ?, DelitoInfraccion = ? WHERE IDQuimicaToxForense = ?","params":"[\"TOXICOLOGICO\",\"POSITIVO\",10]","timestamp":"2025-03-27T15:01:05.791Z"}
{"level":"debug","message":"Executing query [m8rhe2rnxwxx2bvvt1r]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-27T15:01:05.795Z"}
{"level":"debug","message":"Executing query [m8rhe2rpicdm4f9rdua]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-27T15:01:05.798Z"}
{"level":"debug","message":"Executing query [m8rhe2rtp5g3gvrum1n]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-27T15:01:05.801Z"}
{"level":"debug","message":"Executing query [m8rhe2rwvjibd9qcuoh]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-27T15:01:05.804Z"}
{"level":"debug","message":"Executing query [m8rhe2s0qcgk68z580j]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-27T15:01:05.808Z"}
{"level":"debug","message":"Executing query [m8rhe2s25qtu7uo6ov3]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T15:01:05.810Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T15:01:05.811Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:01:09.049Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-27T15:01:09.054Z"}
{"level":"debug","message":"Executing query [m8rhe5aaen6dv72q5b]: SELECT 1 FROM Usuario LIMIT 1","params":"[]","timestamp":"2025-03-27T15:01:09.058Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-27T15:01:09.076Z"}
{"level":"debug","message":"Executing query [m8rhe5auzbpsk9dqq7k]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-27T15:01:09.078Z"}
{"level":"debug","message":"Executing query [m8rhe5avn8w2y794mm]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-27T15:01:09.079Z"}
{"level":"debug","message":"Executing query [m8rhe5axuhw5xdpf2b]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-27T15:01:09.081Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-27T15:01:09.082Z"}
{"level":"debug","message":"Executing query [m8rhe5azbdvm5z9ena]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T15:01:09.083Z"}
{"level":"debug","message":"Executing query [m8rhe5b2ohhjiw7gkne]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T15:01:09.086Z"}
{"level":"debug","message":"Executing query [m8rhe5b4grwr257wc7m]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T15:01:09.088Z"}
{"level":"debug","message":"Executing query [m8rhe5b6oc5izm707cf]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T15:01:09.090Z"}
{"level":"debug","message":"Executing query [m8rhe5b89kbh82qv3is]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T15:01:09.092Z"}
{"level":"debug","message":"Executing query [m8rhe5bb3fseqg5rma5]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, PasswordHash, IDArea, IDRol, Grado) \n                  VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"T123\",\"Usuario\",\"De Prueba\",\"hashed_password_mock\",999,999,\"PRUEBA\"]","timestamp":"2025-03-27T15:01:09.095Z"}
{"level":"debug","message":"Executing query [m8rhe5bhi6o3bkhf61p]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[20]","timestamp":"2025-03-27T15:01:09.102Z"}
{"level":"debug","message":"Executing query [m8rhe5bmv6cnfcqanvr]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T15:01:09.106Z"}
{"level":"debug","message":"Executing query [m8rhe5bpjqcvigu4i]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",20]","timestamp":"2025-03-27T15:01:09.109Z"}
{"level":"debug","message":"Executing query [m8rhe5bu4hn4c631gzh]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[20]","timestamp":"2025-03-27T15:01:09.114Z"}
{"level":"debug","message":"Executing query [m8rhe5bx6qxonidgj65]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[20]","timestamp":"2025-03-27T15:01:09.117Z"}
{"level":"debug","message":"Executing query [m8rhe5c2oyyr575z4gb]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[20]","timestamp":"2025-03-27T15:01:09.122Z"}
{"level":"debug","message":"Executing query [m8rhe5c58oa4sr1e0wx]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"T123\"]","timestamp":"2025-03-27T15:01:09.125Z"}
{"level":"debug","message":"Executing query [m8rhe5c8tcsd0bpc1fj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"T123\"]","timestamp":"2025-03-27T15:01:09.128Z"}
{"level":"info","message":"Usuario T123 eliminado por CIP","timestamp":"2025-03-27T15:01:09.129Z"}
{"level":"debug","message":"Executing query [m8rhe5cav7yjyp99m9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-27T15:01:09.130Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-27T15:01:09.131Z"}
