{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:05:59.459Z"}
{"level":"debug","message":"Executing query [m8o5jdtncn5uei4smml]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:05:59.483Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:05:59.522Z"}
{"level":"debug","message":"Executing query [m8o5jdutx4b7zwlg7l]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886359482\"]","timestamp":"2025-03-25T07:05:59.525Z"}
{"level":"debug","message":"Executing query [m8o5jduwy13p7xjrnqe]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886359482\"]","timestamp":"2025-03-25T07:05:59.529Z"}
{"level":"debug","message":"Executing query [m8o5jduyiaecx3kgtng]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742886359482\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:05:59.530Z"}
{"level":"debug","message":"Executing query [m8o5jdv5yi1imszg9x]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.537Z"}
{"level":"debug","message":"Executing query [m8o5jdv89cbm1xr7vbg]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886359482\"]","timestamp":"2025-03-25T07:05:59.540Z"}
{"level":"debug","message":"Executing query [m8o5jdvbvqj8jj6m6o]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1003]","timestamp":"2025-03-25T07:05:59.543Z"}
{"level":"debug","message":"Executing query [m8o5jdvg1ysn7xdex9i]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.548Z"}
{"level":"debug","message":"Executing query [m8o5jdvitjlmy02x0y]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.550Z"}
{"level":"debug","message":"Executing query [m8o5jdvlspuzu7yky4k]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.553Z"}
{"level":"debug","message":"Executing query [m8o5jdvoybjd7c8dee]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.556Z"}
{"level":"debug","message":"Executing query [m8o5jdvpoj8yl5bkpx]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.557Z"}
{"level":"debug","message":"Executing query [m8o5jdvs7rqg6j7m496]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.560Z"}
{"level":"debug","message":"Executing query [m8o5jdvvqc26u1cowni]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:05:59.563Z"}
{"level":"debug","message":"Executing query [m8o5jdvxqfcwgyqkw8e]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:05:59.565Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:05:59.566Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.679Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.682Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.684Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.686Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.688Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.692Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.694Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:05:59.697Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:05:59.699Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:05:59.700Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:05:59.701Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:05:59.702Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:05:59.921Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:00.964Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:06:01.147Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:06:01.153Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:01.211Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:06:01.228Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:01.278Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:01.760Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:01.902Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:01.925Z"}
{"level":"debug","message":"Executing query [m8o5jfpky1pftxav3pa]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:06:01.928Z"}
{"level":"debug","message":"Executing query [m8o5jfpni3fkbwra7vs]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:06:01.931Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o5jfpni3fkbwra7vs]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:06:01.933Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:01.936Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:02.065Z"}
{"level":"debug","message":"Executing query [m8o5jfthwc13nh0kz1b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:02.069Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:02.080Z"}
{"level":"debug","message":"Executing query [m8o5jftunvcdu6khig]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:02.082Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:06:02.085Z"}
{"level":"debug","message":"Executing query [m8o5jftx56j2qk2hyf]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:06:02.085Z"}
{"level":"debug","message":"Executing query [m8o5jfty2rmrrcmx4be]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:06:02.086Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:06:02.087Z"}
{"level":"debug","message":"Executing query [m8o5jfu04js47z206la]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:02.088Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:06:02.089Z"}
{"level":"debug","message":"Executing query [m8o5jfu5dqxe43lvnar]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:06:02.093Z"}
{"level":"debug","message":"Executing query [m8o5jfu9ikgl28sgdup]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:06:02.097Z"}
{"level":"debug","message":"Executing query [m8o5jfuby67dn5rp81]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[7]","timestamp":"2025-03-25T07:06:02.099Z"}
{"level":"debug","message":"Executing query [m8o5jfuhq7h99r8lpob]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:02.105Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:04.018Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:06:04.083Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:06:04.087Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:04.094Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:06:04.095Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:06:04.189Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:06:04.289Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:04.436Z"}
{"level":"debug","message":"Executing query [m8o5jhncow9w3m24y69]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:04.440Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:04.450Z"}
{"level":"debug","message":"Executing query [m8o5jhnnhanw6mcy2ym]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:04.451Z"}
{"level":"debug","message":"Executing query [m8o5jhnphxjjy6wnt5i]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886364439\"]","timestamp":"2025-03-25T07:06:04.453Z"}
{"level":"debug","message":"Executing query [m8o5jhnqjglwt7ijwyb]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742886364439\",\"TEST-OFICIO-1742886364439\",8596,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:04.454Z"}
{"level":"debug","message":"Executing query [m8o5jhnvhso2lbvrkdv]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.459Z"}
{"level":"debug","message":"Executing query [m8o5jhnxb5xyvn0acmv]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886364439\"]","timestamp":"2025-03-25T07:06:04.461Z"}
{"level":"debug","message":"Executing query [m8o5jhnyyqrjmu5py9a]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",9]","timestamp":"2025-03-25T07:06:04.462Z"}
{"level":"debug","message":"Executing query [m8o5jho0fpo2meul0uk]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.464Z"}
{"level":"debug","message":"Executing query [m8o5jho2oq0zmdqvybi]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.466Z"}
{"level":"debug","message":"Executing query [m8o5jho5trfv65dsa4n]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.469Z"}
{"level":"debug","message":"Executing query [m8o5jho7l4ml0ho0qzb]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.471Z"}
{"level":"debug","message":"Executing query [m8o5jhoaond09j2k7d]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.474Z"}
{"level":"debug","message":"Executing query [m8o5jhob8hjjatayi9t]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742886364475\",\"TEST-SP-OFICIO-1742886364475\",9589,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:06:04.476Z"}
{"level":"debug","message":"Executing query [m8o5jhog5nagqc3thtt]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886364475\"]","timestamp":"2025-03-25T07:06:04.480Z"}
{"level":"debug","message":"Executing query [m8o5jhoio9iysxbs9ac]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886364475\"]","timestamp":"2025-03-25T07:06:04.482Z"}
{"level":"debug","message":"Executing query [m8o5jholtdrw1mne9f]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:04.485Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:04.487Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:04.692Z"}
{"level":"debug","message":"Executing query [m8o5jhuf274r10shw2v]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:04.695Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:04.712Z"}
{"level":"debug","message":"Executing query [m8o5jhuw75rfymjs5n5]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:04.713Z"}
{"level":"debug","message":"Executing query [m8o5jhuy98xtkbgtyk7]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886364694\"]","timestamp":"2025-03-25T07:06:04.714Z"}
{"level":"debug","message":"Executing query [m8o5jhv0711dbpdcae]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742886364694\",\"TEST-OFI-FORENSE-1742886364694\",8433,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742886364694\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:04.716Z"}
{"level":"debug","message":"Executing query [m8o5jhv52o10n76jf4l]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.721Z"}
{"level":"debug","message":"Executing query [m8o5jhv7zcarbofii3]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886364694\"]","timestamp":"2025-03-25T07:06:04.723Z"}
{"level":"debug","message":"Executing query [m8o5jhv9vvkhn5emj9r]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",9]","timestamp":"2025-03-25T07:06:04.725Z"}
{"level":"debug","message":"Executing query [m8o5jhvbrjdk3dk7yp]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.727Z"}
{"level":"debug","message":"Executing query [m8o5jhvds8pn515rq1a]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.729Z"}
{"level":"debug","message":"Executing query [m8o5jhvf4vzlhao5cjp]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.731Z"}
{"level":"debug","message":"Executing query [m8o5jhvgdh7pzs12wfk]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.732Z"}
{"level":"debug","message":"Executing query [m8o5jhvjmppd18duygg]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.735Z"}
{"level":"debug","message":"Executing query [m8o5jhvlapdcxegss0s]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742886364737\",\"TEST-SP-OFI-FORENSE-1742886364737\",9534,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:06:04.737Z"}
{"level":"debug","message":"Executing query [m8o5jhvo9h5nviytf58]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886364737\"]","timestamp":"2025-03-25T07:06:04.740Z"}
{"level":"debug","message":"Executing query [m8o5jhvpqqy8iepcy1r]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886364737\"]","timestamp":"2025-03-25T07:06:04.741Z"}
{"level":"debug","message":"Executing query [m8o5jhvs57t8hz2l5r9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:04.744Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:04.745Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:05.476Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:05.519Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:06:05.520Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:06:05.620Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:06:05.621Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:06:05.622Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:06:05.622Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:06:05.623Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:06:05.623Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:05.956Z"}
{"level":"debug","message":"Executing query [m8o5jitj8gj4m24q5td]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:05.959Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:05.968Z"}
{"level":"debug","message":"Executing query [m8o5jitual79xdv10bo]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886365958\"]","timestamp":"2025-03-25T07:06:05.970Z"}
{"level":"debug","message":"Executing query [m8o5jitw91zsyi9a6kt]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742886365958\",true]","timestamp":"2025-03-25T07:06:05.972Z"}
{"level":"debug","message":"Executing query [m8o5jiu14trimmtss04]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.977Z"}
{"level":"debug","message":"Executing query [m8o5jiu345c7sjqjkq7]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886365958\"]","timestamp":"2025-03-25T07:06:05.979Z"}
{"level":"debug","message":"Executing query [m8o5jiu5vf83pvzkoh]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",9]","timestamp":"2025-03-25T07:06:05.981Z"}
{"level":"debug","message":"Executing query [m8o5jiu8fy9wkog43t8]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.984Z"}
{"level":"debug","message":"Executing query [m8o5jiua1xsucwharav]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.986Z"}
{"level":"debug","message":"Executing query [m8o5jiuelebdyzheufc]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.990Z"}
{"level":"debug","message":"Executing query [m8o5jiughjzps6sj6b5]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.992Z"}
{"level":"debug","message":"Executing query [m8o5jiukk38f95xxo09]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.996Z"}
{"level":"debug","message":"Executing query [m8o5jiuonjrwheu5pu]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:06.000Z"}
{"level":"debug","message":"Executing query [m8o5jiupgxwwlbzm1ea]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:06:06.001Z"}
{"level":"debug","message":"Executing query [m8o5jiur9knnbdff9p4]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:06.003Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:06.004Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:06.228Z"}
{"level":"debug","message":"Executing query [m8o5jj14udxpn5gmwc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:06.232Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:06.245Z"}
{"level":"debug","message":"Executing query [m8o5jj1ja4s0fd1c8vo]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:06.247Z"}
{"level":"debug","message":"Executing query [m8o5jj1mvoiclqradv]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:06:06.250Z"}
{"level":"debug","message":"Executing query [m8o5jj1o29ax6rxkn87]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:06:06.252Z"}
{"level":"debug","message":"Executing query [m8o5jj1q0z52k5nwx2x9]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:06:06.254Z"}
{"level":"debug","message":"Executing query [m8o5jj1ulwumlg8isu]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:06:06.258Z"}
{"level":"debug","message":"Executing query [m8o5jj1yiv4oboljmt]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[10,888,10,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:06:06.262Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:06:06.262Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 10, Área ID: 888, Rol ID: 888, Documento ID: 9","timestamp":"2025-03-25T07:06:06.265Z"}
{"level":"debug","message":"Executing query [m8o5jj23ko40003yv9k]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[9,10,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:06:06.267Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5jj23ko40003yv9k]","params":"[9,10,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:06:06.272Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:06:06.273Z"}
{"level":"debug","message":"Executing query [m8o5jj29xqb9zq0lkw]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[9]","timestamp":"2025-03-25T07:06:06.273Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5jj29xqb9zq0lkw]","params":"[9]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:06:06.276Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:06:06.276Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:06:06.277Z"}
{"level":"debug","message":"Executing query [m8o5jj2ebv96rh9o1cv]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[9,10,\"RESTAURAR\"]","timestamp":"2025-03-25T07:06:06.278Z"}
{"level":"debug","message":"Executing query [m8o5jj2k4evbcpzul4u]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[9]","timestamp":"2025-03-25T07:06:06.284Z"}
{"level":"debug","message":"Executing query [m8o5jj2o80o1fy2nzz6]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[9,10,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:06:06.288Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5jj2o80o1fy2nzz6]","params":"[9,10,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:06:06.292Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:06:06.292Z"}
{"level":"debug","message":"Executing query [m8o5jj2tvcvoid83adf]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[9]","timestamp":"2025-03-25T07:06:06.293Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5jj2tvcvoid83adf]","params":"[9]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:06:06.296Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:06:06.297Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:06:06.297Z"}
{"level":"debug","message":"Executing query [m8o5jj2ynn7qb22faxj]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[10,888,10,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:06:06.298Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:06:06.298Z"}
{"level":"debug","message":"Executing query [m8o5jj31qbq3h6k8wap]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:06:06.301Z"}
{"level":"debug","message":"Executing query [m8o5jj34p5oadkhknp9]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[10,\"DOCUMENTO\",10,\"ELIMINAR\"]","timestamp":"2025-03-25T07:06:06.304Z"}
{"level":"debug","message":"Executing query [m8o5jj37jwsfusx6bl]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.307Z"}
{"level":"debug","message":"Executing query [m8o5jj3cpbnli22o0x]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:06:06.312Z"}
{"level":"debug","message":"Executing query [m8o5jj3gxsey0xxwmg]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.316Z"}
{"level":"debug","message":"Executing query [m8o5jj3j8r2o8y9754h]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:06.319Z"}
{"level":"debug","message":"Executing query [m8o5jj3liy8p3wwsdk]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:06.321Z"}
{"level":"debug","message":"Executing query [m8o5jj3mwn24a2zzde8]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:06.322Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:06:06.326Z"}
{"level":"debug","message":"Executing query [m8o5jj3qftfmdqocqr]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:06.326Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:06.327Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:06.462Z"}
{"level":"debug","message":"Executing query [m8o5jj7lp8zrriew9h]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:06.465Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:06.484Z"}
{"level":"debug","message":"Executing query [m8o5jj88xfb6ekobfoc]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:06:06.488Z"}
{"level":"debug","message":"Executing query [m8o5jj89f1ua2docbjb]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:06:06.489Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:06:06.491Z"}
{"level":"debug","message":"Executing query [m8o5jj8b77goenh3ier]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:06:06.491Z"}
{"level":"debug","message":"Executing query [m8o5jj8cxhepblkj77r]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:06:06.492Z"}
{"level":"debug","message":"Executing query [m8o5jj8eaqas6f3qx7p]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:06:06.494Z"}
{"level":"debug","message":"Executing query [m8o5jj8ko8p3no3bwt]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.500Z"}
{"level":"debug","message":"Executing query [m8o5jj8nvwvfcbt7wlr]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.504Z"}
{"level":"debug","message":"Executing query [m8o5jj8r9pg509stewr]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",10]","timestamp":"2025-03-25T07:06:06.508Z"}
{"level":"debug","message":"Executing query [m8o5jj8vkzn1kvyq7l]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.511Z"}
{"level":"debug","message":"Executing query [m8o5jj8y0xm33nt45noq]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.514Z"}
{"level":"debug","message":"Executing query [m8o5jj91qfvstyqbzn]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.517Z"}
{"level":"debug","message":"Executing query [m8o5jj937lbs1ikm9vx]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:06.519Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:06.520Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:07.060Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:06:07.147Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:07.200Z"}
{"level":"debug","message":"Executing query [m8o5jjssbx46m19uce4]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:06:07.228Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:07.265Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:07.499Z"}
{"level":"debug","message":"Executing query [m8o5jk0ewby3bdrr8or]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:07.502Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:07.515Z"}
{"level":"debug","message":"Executing query [m8o5jk0spze9gps2gog]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:07.516Z"}
{"level":"debug","message":"Executing query [m8o5jk0vc2puna7in18]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886367501\"]","timestamp":"2025-03-25T07:06:07.519Z"}
{"level":"debug","message":"Executing query [m8o5jk0wuumiviu3yab]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742886367501\",\"TEST-OFI-QUIMICA-1742886367501\",5221,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:07.520Z"}
{"level":"debug","message":"Executing query [m8o5jk1304h3ga69dioh]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.527Z"}
{"level":"debug","message":"Executing query [m8o5jk15orkgpqmtrd]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886367501\"]","timestamp":"2025-03-25T07:06:07.529Z"}
{"level":"debug","message":"Executing query [m8o5jk17qhk596j1t48]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",5]","timestamp":"2025-03-25T07:06:07.531Z"}
{"level":"debug","message":"Executing query [m8o5jk19vm6m3lz514q]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.533Z"}
{"level":"debug","message":"Executing query [m8o5jk1cqa1w92l63kr]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.536Z"}
{"level":"debug","message":"Executing query [m8o5jk1fk6jkdjfpuzg]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.539Z"}
{"level":"debug","message":"Executing query [m8o5jk1h014khlp67iifp]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.541Z"}
{"level":"debug","message":"Executing query [m8o5jk1lr3mq63zah4o]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.545Z"}
{"level":"debug","message":"Executing query [m8o5jk1nwbg69xri16p]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:07.547Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:07.549Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:08.110Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:08.114Z"}
{"level":"debug","message":"Executing query [m8o5jkhfiay2lt6ciwo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:08.115Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:08.127Z"}
{"level":"debug","message":"Executing query [m8o5jkhsikp720kfxd8]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:06:08.128Z"}
{"level":"debug","message":"Executing query [m8o5jkht4yq9a6v3bu4]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:06:08.129Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:06:08.130Z"}
{"level":"debug","message":"Executing query [m8o5jkhuz01qitxmyb]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.131Z"}
{"level":"debug","message":"Executing query [m8o5jkhvcmucrbs9vkr]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.131Z"}
{"level":"debug","message":"Executing query [m8o5jkhxfruqm0gvfrm]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.133Z"}
{"level":"debug","message":"Executing query [m8o5jkhyzc5b3jwb3w]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:06:08.134Z"}
{"level":"debug","message":"Executing query [m8o5jki4tu5llj6lpl]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[11]","timestamp":"2025-03-25T07:06:08.140Z"}
{"level":"debug","message":"Executing query [m8o5jki68qriwwciwsv]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.142Z"}
{"level":"debug","message":"Executing query [m8o5jki895ltbt6e3mi]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",11]","timestamp":"2025-03-25T07:06:08.145Z"}
{"level":"debug","message":"Executing query [m8o5jkidfp2bs851vmr]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[11]","timestamp":"2025-03-25T07:06:08.149Z"}
{"level":"debug","message":"Executing query [m8o5jkigtn1k4hgefhh]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[11]","timestamp":"2025-03-25T07:06:08.152Z"}
{"level":"debug","message":"Executing query [m8o5jkijk62g5ivx2wm]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[11]","timestamp":"2025-03-25T07:06:08.155Z"}
{"level":"debug","message":"Executing query [m8o5jkilf06p1qjama]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.157Z"}
{"level":"debug","message":"Executing query [m8o5jkimb50gpe9npsc]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.158Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:06:08.159Z"}
{"level":"debug","message":"Executing query [m8o5jkinoyb2sqjs1zr]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:08.159Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:08.160Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:25.887Z"}
{"level":"debug","message":"Executing query [m8o5jy7onbef46ht2kl]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:25.908Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:25.940Z"}
{"level":"debug","message":"Executing query [m8o5jy8nfmrohf7yum4]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886385907\"]","timestamp":"2025-03-25T07:06:25.943Z"}
{"level":"debug","message":"Executing query [m8o5jy8r6dgekzhi07q]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886385907\"]","timestamp":"2025-03-25T07:06:25.947Z"}
{"level":"debug","message":"Executing query [m8o5jy8t95qweixxrxu]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742886385907\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:25.949Z"}
{"level":"debug","message":"Executing query [m8o5jy8z5s1ajnwlnza]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.955Z"}
{"level":"debug","message":"Executing query [m8o5jy924ukaf7pp27r]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886385907\"]","timestamp":"2025-03-25T07:06:25.958Z"}
{"level":"debug","message":"Executing query [m8o5jy94fs7cgff26ln]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1004]","timestamp":"2025-03-25T07:06:25.960Z"}
{"level":"debug","message":"Executing query [m8o5jy97rfebmctd8kd]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.963Z"}
{"level":"debug","message":"Executing query [m8o5jy99tx50kdzicg]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.965Z"}
{"level":"debug","message":"Executing query [m8o5jy9dahz1kffui1m]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.969Z"}
{"level":"debug","message":"Executing query [m8o5jy9f69cdxjedybu]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.971Z"}
{"level":"debug","message":"Executing query [m8o5jy9ho0xe8z9ykv]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.973Z"}
{"level":"debug","message":"Executing query [m8o5jy9kjfzreqx34cp]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.976Z"}
{"level":"debug","message":"Executing query [m8o5jy9m15ocjufyuhm]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:06:25.978Z"}
{"level":"debug","message":"Executing query [m8o5jy9nd6d7rqujrq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:25.979Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:25.981Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.084Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.087Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.089Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.091Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.092Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.096Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.098Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:06:26.101Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:06:26.103Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:06:26.104Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:06:26.106Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:06:26.107Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:26.333Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:27.315Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:06:27.489Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:06:27.495Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:27.554Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:06:27.568Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:27.619Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:28.069Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:28.190Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:28.212Z"}
{"level":"debug","message":"Executing query [m8o5jzzsedz3z7blznq]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:06:28.216Z"}
{"level":"debug","message":"Executing query [m8o5jzzuzk4ibhtib]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:06:28.218Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o5jzzuzk4ibhtib]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:06:28.220Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:28.221Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:28.360Z"}
{"level":"debug","message":"Executing query [m8o5k03vruce3dng2va]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:28.363Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:28.374Z"}
{"level":"debug","message":"Executing query [m8o5k047uqvjrnmiaoo]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:28.375Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:06:28.378Z"}
{"level":"debug","message":"Executing query [m8o5k04b19rhpm2xu2s]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:06:28.379Z"}
{"level":"debug","message":"Executing query [m8o5k04c5qhm0zq1do5]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:06:28.380Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:06:28.382Z"}
{"level":"debug","message":"Executing query [m8o5k04egwzsnjwvk]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:28.382Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:06:28.385Z"}
{"level":"debug","message":"Executing query [m8o5k04lcpia5s92pgv]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:06:28.389Z"}
{"level":"debug","message":"Executing query [m8o5k04okuqapfocfk]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:06:28.392Z"}
{"level":"debug","message":"Executing query [m8o5k04r0q1uu7fit0zb]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[9]","timestamp":"2025-03-25T07:06:28.395Z"}
{"level":"debug","message":"Executing query [m8o5k04vakfh97kpp9o]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:28.399Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:30.287Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:06:30.348Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:06:30.352Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:30.359Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:06:30.360Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:06:30.455Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:06:30.559Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:30.700Z"}
{"level":"debug","message":"Executing query [m8o5k1ww6yhvzosbusd]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:30.704Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:30.719Z"}
{"level":"debug","message":"Executing query [m8o5k1xc25tkfkpm5vxh]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:30.720Z"}
{"level":"debug","message":"Executing query [m8o5k1xeb1cg3kr0jeo]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886390703\"]","timestamp":"2025-03-25T07:06:30.722Z"}
{"level":"debug","message":"Executing query [m8o5k1xhe6kg53aeuzf]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742886390703\",\"TEST-OFICIO-1742886390703\",3555,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:30.726Z"}
{"level":"debug","message":"Executing query [m8o5k1xnm6shk4tfv1f]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.731Z"}
{"level":"debug","message":"Executing query [m8o5k1xq9yaiobr1bj4]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886390703\"]","timestamp":"2025-03-25T07:06:30.734Z"}
{"level":"debug","message":"Executing query [m8o5k1xsmb9vf8g20f]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",11]","timestamp":"2025-03-25T07:06:30.736Z"}
{"level":"debug","message":"Executing query [m8o5k1xx6l7kbv2hr7o]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.741Z"}
{"level":"debug","message":"Executing query [m8o5k1xzd1kqz7j6l6a]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.743Z"}
{"level":"debug","message":"Executing query [m8o5k1y3q76f0yxnesd]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.747Z"}
{"level":"debug","message":"Executing query [m8o5k1y4rshdv0v76h]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.749Z"}
{"level":"debug","message":"Executing query [m8o5k1y8mu1edccpa3]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.752Z"}
{"level":"debug","message":"Executing query [m8o5k1ybtbuda8rzs7]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742886390754\",\"TEST-SP-OFICIO-1742886390754\",8172,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:06:30.755Z"}
{"level":"debug","message":"Executing query [m8o5k1yf8kjvgth2ojn]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886390754\"]","timestamp":"2025-03-25T07:06:30.759Z"}
{"level":"debug","message":"Executing query [m8o5k1yhvy5cm7g6bv]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886390754\"]","timestamp":"2025-03-25T07:06:30.761Z"}
{"level":"debug","message":"Executing query [m8o5k1ykt8wrhbphkpc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:30.764Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:30.766Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:30.956Z"}
{"level":"debug","message":"Executing query [m8o5k24091uobektycr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:30.960Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:30.974Z"}
{"level":"debug","message":"Executing query [m8o5k24fc4cj68btuh]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:30.975Z"}
{"level":"debug","message":"Executing query [m8o5k24hp0zcx75286m]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886390958\"]","timestamp":"2025-03-25T07:06:30.977Z"}
{"level":"debug","message":"Executing query [m8o5k24jrjsx6bandpa]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742886390958\",\"TEST-OFI-FORENSE-1742886390958\",8388,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742886390958\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:30.979Z"}
{"level":"debug","message":"Executing query [m8o5k24nhyj69ke6034]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.983Z"}
{"level":"debug","message":"Executing query [m8o5k24qnzhhlkzinen]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886390958\"]","timestamp":"2025-03-25T07:06:30.986Z"}
{"level":"debug","message":"Executing query [m8o5k24sutzvbojrhva]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",11]","timestamp":"2025-03-25T07:06:30.988Z"}
{"level":"debug","message":"Executing query [m8o5k24vp6hqsr1vzv]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.991Z"}
{"level":"debug","message":"Executing query [m8o5k24x55g0qaid0e]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.993Z"}
{"level":"debug","message":"Executing query [m8o5k250jp0ilvzhmm]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.996Z"}
{"level":"debug","message":"Executing query [m8o5k252n218ak8im6]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.998Z"}
{"level":"debug","message":"Executing query [m8o5k2551sy9dagnwtq]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:31.001Z"}
{"level":"debug","message":"Executing query [m8o5k256nbdkhcxvswc]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742886391002\",\"TEST-SP-OFI-FORENSE-1742886391002\",1161,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:06:31.002Z"}
{"level":"debug","message":"Executing query [m8o5k259gepzfnkm7ok]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886391002\"]","timestamp":"2025-03-25T07:06:31.005Z"}
{"level":"debug","message":"Executing query [m8o5k25b5a1rzpi8ctw]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886391002\"]","timestamp":"2025-03-25T07:06:31.007Z"}
{"level":"debug","message":"Executing query [m8o5k25f4d9vjxb13n]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:31.011Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:31.013Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:31.984Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:32.031Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:06:32.033Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:06:32.123Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:06:32.124Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:06:32.124Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:06:32.125Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:06:32.125Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:06:32.125Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:32.443Z"}
{"level":"debug","message":"Executing query [m8o5k3990hlv2bi3mi3]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:32.446Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:32.457Z"}
{"level":"debug","message":"Executing query [m8o5k39mwrg11f8zz0t]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886392445\"]","timestamp":"2025-03-25T07:06:32.458Z"}
{"level":"debug","message":"Executing query [m8o5k39qvmb33t9zlgb]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742886392445\",true]","timestamp":"2025-03-25T07:06:32.462Z"}
{"level":"debug","message":"Executing query [m8o5k39t6f48uztuw98]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.465Z"}
{"level":"debug","message":"Executing query [m8o5k39wi2b5fpleal]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886392445\"]","timestamp":"2025-03-25T07:06:32.468Z"}
{"level":"debug","message":"Executing query [m8o5k39yhp52hm6qc5v]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",11]","timestamp":"2025-03-25T07:06:32.470Z"}
{"level":"debug","message":"Executing query [m8o5k3a1bsukr0ndlt9]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.473Z"}
{"level":"debug","message":"Executing query [m8o5k3a3krwg6d2ghkn]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.475Z"}
{"level":"debug","message":"Executing query [m8o5k3a8hz9vae2o3u5]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.480Z"}
{"level":"debug","message":"Executing query [m8o5k3aat9rd5p294b]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.482Z"}
{"level":"debug","message":"Executing query [m8o5k3abwvuxxow10c]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.483Z"}
{"level":"debug","message":"Executing query [m8o5k3aen5d1vez6nf]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.486Z"}
{"level":"debug","message":"Executing query [m8o5k3afkc1ofcyujj9]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:06:32.487Z"}
{"level":"debug","message":"Executing query [m8o5k3agizf4bb8w9xl]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:32.488Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:32.489Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:32.677Z"}
{"level":"debug","message":"Executing query [m8o5k3fs0ibr76mmv7do]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:32.680Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:32.688Z"}
{"level":"debug","message":"Executing query [m8o5k3g206ytwb563r3]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:32.690Z"}
{"level":"debug","message":"Executing query [m8o5k3g3qp4q28illxk]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:06:32.691Z"}
{"level":"debug","message":"Executing query [m8o5k3g49uc3jd0rg5]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:06:32.692Z"}
{"level":"debug","message":"Executing query [m8o5k3g6a16hhvzjafw]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:06:32.694Z"}
{"level":"debug","message":"Executing query [m8o5k3g8tcw2ngsx4rs]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:06:32.696Z"}
{"level":"debug","message":"Executing query [m8o5k3gbugpxrp5fyir]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[12,888,12,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:06:32.699Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:06:32.699Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 12, Área ID: 888, Rol ID: 888, Documento ID: 11","timestamp":"2025-03-25T07:06:32.703Z"}
{"level":"debug","message":"Executing query [m8o5k3gg5koxsn38t09]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[11,12,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:06:32.704Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5k3gg5koxsn38t09]","params":"[11,12,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:06:32.708Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:06:32.709Z"}
{"level":"debug","message":"Executing query [m8o5k3glkiq8b28i8m]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.709Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5k3glkiq8b28i8m]","params":"[11]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:06:32.711Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:06:32.712Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:06:32.712Z"}
{"level":"debug","message":"Executing query [m8o5k3gpgtkbx7pm0i5]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[11,12,\"RESTAURAR\"]","timestamp":"2025-03-25T07:06:32.713Z"}
{"level":"debug","message":"Executing query [m8o5k3gt05b2jeiw9rtu]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.717Z"}
{"level":"debug","message":"Executing query [m8o5k3gvla9inaa8e2]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[11,12,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:06:32.719Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5k3gvla9inaa8e2]","params":"[11,12,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:06:32.723Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:06:32.723Z"}
{"level":"debug","message":"Executing query [m8o5k3gzmqc513h9in]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.723Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5k3gzmqc513h9in]","params":"[11]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:06:32.725Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:06:32.726Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:06:32.726Z"}
{"level":"debug","message":"Executing query [m8o5k3h30tt4t9me9vw]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[12,888,12,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:06:32.727Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:06:32.727Z"}
{"level":"debug","message":"Executing query [m8o5k3h5fwugifne2fl]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:06:32.729Z"}
{"level":"debug","message":"Executing query [m8o5k3h8igbg1nshh1k]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[12,\"DOCUMENTO\",12,\"ELIMINAR\"]","timestamp":"2025-03-25T07:06:32.732Z"}
{"level":"debug","message":"Executing query [m8o5k3haeapghaumga]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.734Z"}
{"level":"debug","message":"Executing query [m8o5k3hdmi9dmw8ma3c]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:06:32.737Z"}
{"level":"debug","message":"Executing query [m8o5k3hg5twx0tjydfj]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.740Z"}
{"level":"debug","message":"Executing query [m8o5k3hi1o5m17jy3em]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:32.742Z"}
{"level":"debug","message":"Executing query [m8o5k3hk7nahm8ekk83]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:32.744Z"}
{"level":"debug","message":"Executing query [m8o5k3hnurb8yy2vin]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:32.747Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:06:32.750Z"}
{"level":"debug","message":"Executing query [m8o5k3hr279yux8rndk]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:32.751Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:32.752Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:32.853Z"}
{"level":"debug","message":"Executing query [m8o5k3kop3ln9qv14oe]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:32.856Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:32.869Z"}
{"level":"debug","message":"Executing query [m8o5k3l384bbsxbgx19]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:06:32.871Z"}
{"level":"debug","message":"Executing query [m8o5k3l4q6apme6mjcn]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:06:32.872Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:06:32.873Z"}
{"level":"debug","message":"Executing query [m8o5k3l6uhyl6wrpuf]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:06:32.874Z"}
{"level":"debug","message":"Executing query [m8o5k3l7t5xwv5zw73q]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:06:32.875Z"}
{"level":"debug","message":"Executing query [m8o5k3l84zztjlnet7e]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:06:32.876Z"}
{"level":"debug","message":"Executing query [m8o5k3lcdrp6vzlitp7]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.880Z"}
{"level":"debug","message":"Executing query [m8o5k3lfpwfeya7cxf]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.883Z"}
{"level":"debug","message":"Executing query [m8o5k3lhlciz1e8d9ce]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",12]","timestamp":"2025-03-25T07:06:32.885Z"}
{"level":"debug","message":"Executing query [m8o5k3lkm0rdjgpdunq]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.888Z"}
{"level":"debug","message":"Executing query [m8o5k3lmw0uvjomjpr8]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.890Z"}
{"level":"debug","message":"Executing query [m8o5k3lpbnllrz8i3pn]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.893Z"}
{"level":"debug","message":"Executing query [m8o5k3lryy821epaefn]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:32.895Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:32.896Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:33.275Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:06:33.337Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:33.384Z"}
{"level":"debug","message":"Executing query [m8o5k3zynrbsipl0m7m]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:06:33.406Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:33.434Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:33.607Z"}
{"level":"debug","message":"Executing query [m8o5k45l69dwwhbnzlm]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:33.609Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:33.618Z"}
{"level":"debug","message":"Executing query [m8o5k45vvwok4uddmp8]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:33.619Z"}
{"level":"debug","message":"Executing query [m8o5k45x7g5urymxm0e]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886393609\"]","timestamp":"2025-03-25T07:06:33.621Z"}
{"level":"debug","message":"Executing query [m8o5k45yr36rvlwxu3j]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742886393609\",\"TEST-OFI-QUIMICA-1742886393609\",5771,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:33.622Z"}
{"level":"debug","message":"Executing query [m8o5k463560igrb1ry6]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.627Z"}
{"level":"debug","message":"Executing query [m8o5k465zevurd8rrnb]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886393609\"]","timestamp":"2025-03-25T07:06:33.629Z"}
{"level":"debug","message":"Executing query [m8o5k467jsu2u53qj8n]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",6]","timestamp":"2025-03-25T07:06:33.631Z"}
{"level":"debug","message":"Executing query [m8o5k4697m5me53jtz]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.633Z"}
{"level":"debug","message":"Executing query [m8o5k46b41y8gxuqyex]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.636Z"}
{"level":"debug","message":"Executing query [m8o5k46eatzj4wmpd8c]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.638Z"}
{"level":"debug","message":"Executing query [m8o5k46g59680depgrb]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.640Z"}
{"level":"debug","message":"Executing query [m8o5k46j62l15vw6nmu]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.643Z"}
{"level":"debug","message":"Executing query [m8o5k46k6ybhcie7fam]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:33.644Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:33.645Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:34.131Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:34.135Z"}
{"level":"debug","message":"Executing query [m8o5k4ka6tzv6o9e06j]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:34.138Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:34.154Z"}
{"level":"debug","message":"Executing query [m8o5k4krhx32lg3ayzk]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:06:34.155Z"}
{"level":"debug","message":"Executing query [m8o5k4kttpscglgsko]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:06:34.157Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:06:34.159Z"}
{"level":"debug","message":"Executing query [m8o5k4kvnq6ssn7gr6]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.159Z"}
{"level":"debug","message":"Executing query [m8o5k4kxml6mtqc0vol]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.161Z"}
{"level":"debug","message":"Executing query [m8o5k4kzpp8hzqwsayd]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.163Z"}
{"level":"debug","message":"Executing query [m8o5k4l154vih6mwhj6]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:06:34.165Z"}
{"level":"debug","message":"Executing query [m8o5k4l9campcydtrd8]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[13]","timestamp":"2025-03-25T07:06:34.173Z"}
{"level":"debug","message":"Executing query [m8o5k4ldvn0x9ec3qhk]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.177Z"}
{"level":"debug","message":"Executing query [m8o5k4lgvuen02wcbaj]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",13]","timestamp":"2025-03-25T07:06:34.180Z"}
{"level":"debug","message":"Executing query [m8o5k4lje6a3rs37y98]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[13]","timestamp":"2025-03-25T07:06:34.183Z"}
{"level":"debug","message":"Executing query [m8o5k4lmmdumcrnhdom]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[13]","timestamp":"2025-03-25T07:06:34.186Z"}
{"level":"debug","message":"Executing query [m8o5k4lqfqleq1ak9p4]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[13]","timestamp":"2025-03-25T07:06:34.190Z"}
{"level":"debug","message":"Executing query [m8o5k4lsmb4vuot38uk]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.192Z"}
{"level":"debug","message":"Executing query [m8o5k4lu5k5y5kwc9kn]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.194Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:06:34.195Z"}
{"level":"debug","message":"Executing query [m8o5k4lws2iv7l3in2a]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:34.196Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:34.198Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.329Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.340Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.342Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.350Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.355Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.360Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.362Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:10:34.366Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:10:34.368Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:10:34.370Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:10:34.371Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:10:34.373Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:34.654Z"}
{"level":"debug","message":"Executing query [m8o5pa75uncrl1twlx8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:34.722Z"}
{"level":"debug","message":"Executing query [m8o5pa9984bqssj2xai]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886634718\"]","timestamp":"2025-03-25T07:10:34.797Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:34.800Z"}
{"level":"debug","message":"Executing query [m8o5pa9w2wvl3dd5cq6]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886634718\"]","timestamp":"2025-03-25T07:10:34.821Z"}
{"level":"debug","message":"Executing query [m8o5pa9zq4wenn7u4bo]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742886634718\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:10:34.823Z"}
{"level":"debug","message":"Executing query [m8o5paaf7r3kacjuehi]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.839Z"}
{"level":"debug","message":"Executing query [m8o5paarcfa1yv7z9v]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886634718\"]","timestamp":"2025-03-25T07:10:34.851Z"}
{"level":"debug","message":"Executing query [m8o5paavs8x56xvexx]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1005]","timestamp":"2025-03-25T07:10:34.855Z"}
{"level":"debug","message":"Executing query [m8o5pab1cbxfuxf2z2t]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.861Z"}
{"level":"debug","message":"Executing query [m8o5pab464b9dmxo3gt]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.864Z"}
{"level":"debug","message":"Executing query [m8o5pab8goouurjl78i]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.868Z"}
{"level":"debug","message":"Executing query [m8o5pabbb4ovprjevli]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.871Z"}
{"level":"debug","message":"Executing query [m8o5pabdcbjkmjuzyyc]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.873Z"}
{"level":"debug","message":"Executing query [m8o5pabgkm2vmkzes5r]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.876Z"}
{"level":"debug","message":"Executing query [m8o5pabjgfq2h8qmv8]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:10:34.879Z"}
{"level":"debug","message":"Executing query [m8o5pablal1c3w32ze9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:34.882Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:34.886Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:34.945Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.093Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.095Z"}
{"level":"debug","message":"Executing query [m8o5paiuabb4kh33wjv]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:35.142Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.223Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:34.977Z"}
{"level":"debug","message":"Executing query [m8o5pal8d9iq5lhyswg]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:10:35.228Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:10:35.240Z"}
{"level":"debug","message":"Executing query [m8o5pallewcrwk0kqtk]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:10:35.241Z"}
{"level":"debug","message":"Executing query [m8o5paloa4lxuy77ksb]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:10:35.244Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:10:35.248Z"}
{"level":"debug","message":"Executing query [m8o5paltyun2pmaeufd]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:10:35.249Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:10:35.224Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.296Z"}
{"level":"debug","message":"Executing query [m8o5panxpp7jhxy56na]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:10:35.326Z"}
{"level":"debug","message":"Executing query [m8o5pao4t5yd8ml4k1m]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:10:35.332Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.234Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o5pao4t5yd8ml4k1m]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:10:35.336Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:35.341Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:10:35.259Z"}
{"level":"debug","message":"Executing query [m8o5pap2amn33wknqpt]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:10:35.366Z"}
{"level":"debug","message":"Executing query [m8o5panytst9wiyallk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:35.329Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.415Z"}
{"level":"debug","message":"Executing query [m8o5paqo0ctanx458z8g]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:10:35.425Z"}
{"level":"debug","message":"Executing query [m8o5papikdgvytv8tp]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:10:35.382Z"}
{"level":"debug","message":"Executing query [m8o5paqshcmqd749w5]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[11]","timestamp":"2025-03-25T07:10:35.428Z"}
{"level":"debug","message":"Executing query [m8o5paqu33ay9044b8c]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886635325\"]","timestamp":"2025-03-25T07:10:35.430Z"}
{"level":"debug","message":"Executing query [m8o5paqxd9crtj1fecv]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742886635325\",\"TEST-OFI-FORENSE-1742886635325\",4797,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742886635325\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:10:35.433Z"}
{"level":"debug","message":"Executing query [m8o5par87ncdng2jnc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:35.444Z"}
{"level":"debug","message":"Executing query [m8o5parfvngyqb37crj]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.451Z"}
{"level":"debug","message":"Executing query [m8o5park3afcmzqmt5z]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886635325\"]","timestamp":"2025-03-25T07:10:35.456Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.381Z"}
{"level":"debug","message":"Executing query [m8o5parn10w5psiauwm]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",13]","timestamp":"2025-03-25T07:10:35.459Z"}
{"level":"debug","message":"Executing query [m8o5parvusqhmno7e1]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.467Z"}
{"level":"debug","message":"Executing query [m8o5parxwmgqsn6h2rd]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.469Z"}
{"level":"debug","message":"Executing query [m8o5pas1e823cyqajy]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.473Z"}
{"level":"debug","message":"Executing query [m8o5pas4m7l0zyvs3]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.476Z"}
{"level":"debug","message":"Executing query [m8o5pas8fevy7m2q1lw]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.481Z"}
{"level":"debug","message":"Executing query [m8o5pasb3hacue3kk9b]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742886635483\",\"TEST-SP-OFI-FORENSE-1742886635483\",9878,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:10:35.483Z"}
{"level":"debug","message":"Executing query [m8o5paslhik0f5dwp2f]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886635483\"]","timestamp":"2025-03-25T07:10:35.494Z"}
{"level":"debug","message":"Executing query [m8o5pasolkdlngbfj3]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886635483\"]","timestamp":"2025-03-25T07:10:35.496Z"}
{"level":"debug","message":"Executing query [m8o5passhuk15wx013q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:35.500Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:35.503Z"}
{"level":"debug","message":"Executing query [m8o5pare5l1zdeybsxd]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:35.451Z"}
{"level":"debug","message":"Executing query [m8o5pat9s04o3obpkh]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:10:35.518Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.524Z"}
{"level":"debug","message":"Executing query [m8o5patmjh5qscvmax9]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886635449\"]","timestamp":"2025-03-25T07:10:35.530Z"}
{"level":"debug","message":"Executing query [m8o5patp2tajj6bnaaj]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742886635449\",\"TEST-OFICIO-1742886635449\",5746,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:10:35.533Z"}
{"level":"debug","message":"Executing query [m8o5patyqgd44hyrt2h]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.542Z"}
{"level":"debug","message":"Executing query [m8o5pau3pc9b3gr4d1]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886635449\"]","timestamp":"2025-03-25T07:10:35.547Z"}
{"level":"debug","message":"Executing query [m8o5pau64kejy1wklfm]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",13]","timestamp":"2025-03-25T07:10:35.550Z"}
{"level":"debug","message":"Executing query [m8o5paue8zzvj1puymn]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.559Z"}
{"level":"debug","message":"Executing query [m8o5pauhoi4kd9t1emi]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.562Z"}
{"level":"debug","message":"Executing query [m8o5paunlrz562zgojh]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.567Z"}
{"level":"debug","message":"Executing query [m8o5pauqszerdm1cr4p]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.570Z"}
{"level":"debug","message":"Executing query [m8o5pauu7ms6c1m2cpn]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.574Z"}
{"level":"debug","message":"Executing query [m8o5pauxae2d957031d]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742886635577\",\"TEST-SP-OFICIO-1742886635577\",1437,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:10:35.577Z"}
{"level":"debug","message":"Executing query [m8o5pav23ptupqwpa7x]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886635577\"]","timestamp":"2025-03-25T07:10:35.582Z"}
{"level":"debug","message":"Executing query [m8o5pav43ajexc7aeks]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886635577\"]","timestamp":"2025-03-25T07:10:35.584Z"}
{"level":"debug","message":"Executing query [m8o5pav8sz1ilhan3c]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:35.588Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:35.590Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:10:35.285Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.773Z"}
{"level":"debug","message":"Executing query [m8o5pb0jwitxte06udh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:35.779Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.801Z"}
{"level":"debug","message":"Executing query [m8o5pb1d9pgkfu2efwd]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886635777\"]","timestamp":"2025-03-25T07:10:35.809Z"}
{"level":"debug","message":"Executing query [m8o5pb1fibdnuxgolm]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742886635777\",true]","timestamp":"2025-03-25T07:10:35.811Z"}
{"level":"debug","message":"Executing query [m8o5pb25nz92ix785w]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.837Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.840Z"}
{"level":"debug","message":"Executing query [m8o5pb2kt6268uh6ma]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:35.852Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.883Z"}
{"level":"debug","message":"Executing query [m8o5pb3fe0p4znmm57]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886635777\"]","timestamp":"2025-03-25T07:10:35.883Z"}
{"level":"debug","message":"Executing query [m8o5pb3o8p8xrhh8y0u]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:10:35.892Z"}
{"level":"debug","message":"Executing query [m8o5pb3q6tznithyfiw]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:10:35.894Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:10:35.896Z"}
{"level":"debug","message":"Executing query [m8o5pb3sq3j8oogiofk]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:10:35.896Z"}
{"level":"debug","message":"Executing query [m8o5pb3umur1h0mbjfe]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:10:35.898Z"}
{"level":"debug","message":"Executing query [m8o5pb3w7nx4r80ycpk]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:10:35.900Z"}
{"level":"debug","message":"Executing query [m8o5pb40gbp706wcd2b]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",13]","timestamp":"2025-03-25T07:10:35.904Z"}
{"level":"debug","message":"Executing query [m8o5pb45wzd8b2rrxu]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.909Z"}
{"level":"debug","message":"Executing query [m8o5pb45b7809qh6vpf]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.910Z"}
{"level":"debug","message":"Executing query [m8o5pb49d7pvg93aful]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.913Z"}
{"level":"debug","message":"Executing query [m8o5pb4ac58ituyjxqu]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.914Z"}
{"level":"debug","message":"Executing query [m8o5pb4dk07svsn59bo]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.917Z"}
{"level":"debug","message":"Executing query [m8o5pb4f91o95u3x094]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.919Z"}
{"level":"debug","message":"Executing query [m8o5pb4fc5a6klgv45]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",13]","timestamp":"2025-03-25T07:10:35.919Z"}
{"level":"debug","message":"Executing query [m8o5pb4hcklti74kznl]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.921Z"}
{"level":"debug","message":"Executing query [m8o5pb4tfx5o37654ft]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.933Z"}
{"level":"debug","message":"Executing query [m8o5pb4ugw8u5yklp7l]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.934Z"}
{"level":"debug","message":"Executing query [m8o5pb4ww3worznqk6]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:10:35.936Z"}
{"level":"debug","message":"Executing query [m8o5pb4wnumn6zdhgbs]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.936Z"}
{"level":"debug","message":"Executing query [m8o5pb4yb2hq1vn9oy6]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:35.938Z"}
{"level":"debug","message":"Executing query [m8o5pb50oc0x7bnnguc]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.940Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:35.940Z"}
{"level":"debug","message":"Executing query [m8o5pb52gkvgk0rvutu]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:35.942Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:35.945Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:36.071Z"}
{"level":"debug","message":"Executing query [m8o5pb8sny7nur0gwt8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:36.076Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:36.101Z"}
{"level":"debug","message":"Executing query [m8o5pb9h8hldn91buyw]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:10:36.101Z"}
{"level":"debug","message":"Executing query [m8o5pb9kcipwzpesdzv]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886636074\"]","timestamp":"2025-03-25T07:10:36.104Z"}
{"level":"debug","message":"Executing query [m8o5pb9mq07j21hlujs]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742886636074\",\"TEST-OFI-QUIMICA-1742886636074\",3393,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:10:36.106Z"}
{"level":"debug","message":"Executing query [m8o5pb9uum4yo4mxav]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.114Z"}
{"level":"debug","message":"Executing query [m8o5pb9zuz1dfi4l45s]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886636074\"]","timestamp":"2025-03-25T07:10:36.119Z"}
{"level":"debug","message":"Executing query [m8o5pba1fj8pcd9xkei]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",7]","timestamp":"2025-03-25T07:10:36.121Z"}
{"level":"debug","message":"Executing query [m8o5pba5694kzy9q8lm]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.125Z"}
{"level":"debug","message":"Executing query [m8o5pba9wujuwiqhewa]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.129Z"}
{"level":"debug","message":"Executing query [m8o5pbad8lsi0xcp3vm]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.133Z"}
{"level":"debug","message":"Executing query [m8o5pbagozymkuf11q]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.136Z"}
{"level":"debug","message":"Executing query [m8o5pbalsj9mu9zce0l]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.141Z"}
{"level":"debug","message":"Executing query [m8o5pbandhrfoin4eqh]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:36.143Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:36.145Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:10:35.517Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:10:35.518Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:10:35.519Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:10:35.521Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:10:35.522Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:10:35.522Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:36.095Z"}
{"level":"debug","message":"Executing query [m8o5pbamrpboxxh4cah]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:36.142Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:36.194Z"}
{"level":"debug","message":"Executing query [m8o5pbc7at0xrxvnfhh]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:10:36.199Z"}
{"level":"debug","message":"Executing query [m8o5pbcd5gok8dp7orb]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:10:36.205Z"}
{"level":"debug","message":"Executing query [m8o5pbcgmvjfqy10hni]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:10:36.208Z"}
{"level":"debug","message":"Executing query [m8o5pbcj2ppkjl3f0qo]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:10:36.212Z"}
{"level":"debug","message":"Executing query [m8o5pbcqd1amyuhggrs]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:10:36.218Z"}
{"level":"debug","message":"Executing query [m8o5pbcwyeijpw4fuj8]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[14,888,14,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:10:36.224Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:10:36.224Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 14, Área ID: 888, Rol ID: 888, Documento ID: 13","timestamp":"2025-03-25T07:10:36.230Z"}
{"level":"debug","message":"Executing query [m8o5pbd4j8vpmnk1so]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[13,14,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:10:36.232Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5pbd4j8vpmnk1so]","params":"[13,14,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:10:36.238Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:10:36.239Z"}
{"level":"debug","message":"Executing query [m8o5pbdb3z85mt0d7ym]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[13]","timestamp":"2025-03-25T07:10:36.239Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5pbdb3z85mt0d7ym]","params":"[13]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:10:36.241Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:10:36.242Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:10:36.242Z"}
{"level":"debug","message":"Executing query [m8o5pbdfffpp3ia18t9]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[13,14,\"RESTAURAR\"]","timestamp":"2025-03-25T07:10:36.243Z"}
{"level":"debug","message":"Executing query [m8o5pbdmclnljvzqz4t]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[13]","timestamp":"2025-03-25T07:10:36.251Z"}
{"level":"debug","message":"Executing query [m8o5pbdq73lceu8gr9p]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[13,14,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:10:36.254Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5pbdq73lceu8gr9p]","params":"[13,14,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:10:36.258Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:10:36.259Z"}
{"level":"debug","message":"Executing query [m8o5pbdvh1iit0xuey7]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[13]","timestamp":"2025-03-25T07:10:36.259Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5pbdvh1iit0xuey7]","params":"[13]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:10:36.271Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:10:36.272Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:10:36.272Z"}
{"level":"debug","message":"Executing query [m8o5pbe9xy5zf4ypmq]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[14,888,14,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:10:36.273Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:10:36.273Z"}
{"level":"debug","message":"Executing query [m8o5pbedlmnmliqtbd]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:10:36.277Z"}
{"level":"debug","message":"Executing query [m8o5pbeg27r727t0r3f]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[14,\"DOCUMENTO\",14,\"ELIMINAR\"]","timestamp":"2025-03-25T07:10:36.280Z"}
{"level":"debug","message":"Executing query [m8o5pbem22c3dm555yi]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[14]","timestamp":"2025-03-25T07:10:36.286Z"}
{"level":"debug","message":"Executing query [m8o5pbeueoeovd1a4zw]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:10:36.294Z"}
{"level":"debug","message":"Executing query [m8o5pbf1leq0ziydfna]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-25T07:10:36.301Z"}
{"level":"debug","message":"Executing query [m8o5pbf5ieyz69gnw9k]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:10:36.305Z"}
{"level":"debug","message":"Executing query [m8o5pbf7nlnhwqdbz0s]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:10:36.307Z"}
{"level":"debug","message":"Executing query [m8o5pbf9dt9cpprsxd5]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:10:36.309Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:10:36.318Z"}
{"level":"debug","message":"Executing query [m8o5pbfigji5lpw9ana]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:36.318Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:36.320Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:36.433Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:36.457Z"}
{"level":"debug","message":"Executing query [m8o5pbjfyjl6g3snzxg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:36.459Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:36.484Z"}
{"level":"debug","message":"Executing query [m8o5pbkb4y7yainfxev]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:10:36.491Z"}
{"level":"debug","message":"Executing query [m8o5pbkdab46snw5f6m]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:10:36.493Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:10:36.495Z"}
{"level":"debug","message":"Executing query [m8o5pbkfr36is7dllko]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.495Z"}
{"level":"debug","message":"Executing query [m8o5pbkggvkkw6c5ko]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.496Z"}
{"level":"debug","message":"Executing query [m8o5pbkjx6ckogf31g]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.499Z"}
{"level":"debug","message":"Executing query [m8o5pbklw3gzh9js6gk]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:10:36.501Z"}
{"level":"debug","message":"Executing query [m8o5pbks6twlhve40o3]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[15]","timestamp":"2025-03-25T07:10:36.508Z"}
{"level":"debug","message":"Executing query [m8o5pbkxvwzpk1d2aa]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.513Z"}
{"level":"debug","message":"Executing query [m8o5pbl04jnhsz6gxy4]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",15]","timestamp":"2025-03-25T07:10:36.516Z"}
{"level":"debug","message":"Executing query [m8o5pbl4veurfbap7d]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[15]","timestamp":"2025-03-25T07:10:36.520Z"}
{"level":"debug","message":"Executing query [m8o5pbl6yzaj5duw9s]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[15]","timestamp":"2025-03-25T07:10:36.522Z"}
{"level":"debug","message":"Executing query [m8o5pblaqau6jju561i]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[15]","timestamp":"2025-03-25T07:10:36.526Z"}
{"level":"debug","message":"Executing query [m8o5pblcx0bbiwexe]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.528Z"}
{"level":"debug","message":"Executing query [m8o5pblfby4tqrbtaji]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.531Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:10:36.532Z"}
{"level":"debug","message":"Executing query [m8o5pblgttz0jf3ssw]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:36.532Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:36.534Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:36.795Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:10:37.143Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:10:37.170Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:37.425Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:10:37.446Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:37.507Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:37.616Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:10:37.840Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:37.939Z"}
{"level":"debug","message":"Executing query [m8o5pcpi1mi3bj1qn1s]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:10:37.975Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:38.012Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:38.484Z"}
{"duration":"21ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:10:38.652Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:38.653Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:10:38.656Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:38.661Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:38.629Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:38.753Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:10:38.758Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:32.784Z"}
{"level":"debug","message":"Executing query [m8o623p6fajj9upzdr8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:32.826Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:32.875Z"}
{"level":"debug","message":"Executing query [m8o623rb4vh9ta01w16]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887232825\"]","timestamp":"2025-03-25T07:20:32.903Z"}
{"level":"debug","message":"Executing query [m8o623rj4a50z14rdh6]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887232825\"]","timestamp":"2025-03-25T07:20:32.911Z"}
{"level":"debug","message":"Executing query [m8o623rouwckbzgohop]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742887232825\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:20:32.916Z"}
{"level":"debug","message":"Executing query [m8o623sb72x6tirhvku]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.939Z"}
{"level":"debug","message":"Executing query [m8o623slwp67ph7kvd8]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887232825\"]","timestamp":"2025-03-25T07:20:32.949Z"}
{"level":"debug","message":"Executing query [m8o623soi1xiw6f4zgk]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1006]","timestamp":"2025-03-25T07:20:32.952Z"}
{"level":"debug","message":"Executing query [m8o623ssedx49pm6vmh]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.956Z"}
{"level":"debug","message":"Executing query [m8o623sviylgg1p315]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.959Z"}
{"level":"debug","message":"Executing query [m8o623szanprme6r7l]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.963Z"}
{"level":"debug","message":"Executing query [m8o623t3dzc0vgkjjc]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.967Z"}
{"level":"debug","message":"Executing query [m8o623t69p77bj6bnzr]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.970Z"}
{"level":"debug","message":"Executing query [m8o623tamtnv5hryian]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.974Z"}
{"level":"debug","message":"Executing query [m8o623tc1x14w06twdl]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:20:32.976Z"}
{"level":"debug","message":"Executing query [m8o623tdhg7hu2n9nu]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:32.977Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:32.979Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.153Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.159Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.165Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.172Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.176Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.179Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.185Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:20:33.190Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:33.898Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:20:33.192Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:20:33.201Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:20:33.204Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:20:33.207Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:35.688Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:20:36.018Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:20:36.026Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:36.102Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:20:36.122Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:36.185Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:36.763Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:36.969Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:37.009Z"}
{"level":"debug","message":"Executing query [m8o626xqo2hih9ez9kp]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:20:37.022Z"}
{"level":"debug","message":"Executing query [m8o626xvmg3aq7fvqeh]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:20:37.027Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o626xvmg3aq7fvqeh]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:20:37.030Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:37.032Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:37.218Z"}
{"level":"debug","message":"Executing query [m8o6273992l06jk0gkk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:37.221Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:37.235Z"}
{"level":"debug","message":"Executing query [m8o6273sfoh6cvvk8ac]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:20:37.240Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:20:37.241Z"}
{"level":"debug","message":"Executing query [m8o6273u52ed85lpx1n]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:20:37.242Z"}
{"level":"debug","message":"Executing query [m8o6273vfhwuqv0z09n]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:20:37.243Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:20:37.245Z"}
{"level":"debug","message":"Executing query [m8o6273xjjt44m3rlx]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:20:37.245Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:20:37.246Z"}
{"level":"debug","message":"Executing query [m8o62744i1y4bquy32]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:20:37.252Z"}
{"level":"debug","message":"Executing query [m8o62747em3l3l0y9sa]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:20:37.255Z"}
{"level":"debug","message":"Executing query [m8o627490p2qfjtd59ho]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[13]","timestamp":"2025-03-25T07:20:37.257Z"}
{"level":"debug","message":"Executing query [m8o6274el5wzpfzxetm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:37.263Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:40.453Z"}
{"duration":"12ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:20:40.553Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:20:40.559Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:40.567Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:20:40.569Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:20:40.730Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:20:40.894Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:41.180Z"}
{"level":"debug","message":"Executing query [m8o62a5m0qhaszyrcozp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:41.194Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:41.228Z"}
{"level":"debug","message":"Executing query [m8o62a6pan2qn05j5p9]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:20:41.233Z"}
{"level":"debug","message":"Executing query [m8o62a6sxupidaye9ye]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742887241193\"]","timestamp":"2025-03-25T07:20:41.236Z"}
{"level":"debug","message":"Executing query [m8o62a6ud67g53yrwnw]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742887241193\",\"TEST-OFICIO-1742887241193\",1381,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:20:41.239Z"}
{"level":"debug","message":"Executing query [m8o62a73rlswyaoet9]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.247Z"}
{"level":"debug","message":"Executing query [m8o62a76ryci2wnwuc]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742887241193\"]","timestamp":"2025-03-25T07:20:41.250Z"}
{"level":"debug","message":"Executing query [m8o62a7begvtvazlpsj]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",15]","timestamp":"2025-03-25T07:20:41.255Z"}
{"level":"debug","message":"Executing query [m8o62a7end777kzoh78]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.258Z"}
{"level":"debug","message":"Executing query [m8o62a7imp797b26wlh]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.262Z"}
{"level":"debug","message":"Executing query [m8o62a7qo78mg6hz5mq]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.270Z"}
{"level":"debug","message":"Executing query [m8o62a7t5fjt9xe5trk]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.273Z"}
{"level":"debug","message":"Executing query [m8o62a7xp91z1aic9h]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.277Z"}
{"level":"debug","message":"Executing query [m8o62a85qr71ny6009]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742887241285\",\"TEST-SP-OFICIO-1742887241285\",6317,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:20:41.285Z"}
{"level":"debug","message":"Executing query [m8o62a8arclmzq62mrd]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742887241285\"]","timestamp":"2025-03-25T07:20:41.290Z"}
{"level":"debug","message":"Executing query [m8o62a8g9xz53y47ia]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742887241285\"]","timestamp":"2025-03-25T07:20:41.296Z"}
{"level":"debug","message":"Executing query [m8o62a8kb2nqw1suktc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:41.300Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:41.302Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:41.697Z"}
{"level":"debug","message":"Executing query [m8o62ajqp70cyqzcv8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:41.702Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:41.730Z"}
{"level":"debug","message":"Executing query [m8o62akkizklhi8jgap]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:20:41.733Z"}
{"level":"debug","message":"Executing query [m8o62akoe3hxvxz5riv]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742887241700\"]","timestamp":"2025-03-25T07:20:41.736Z"}
{"level":"debug","message":"Executing query [m8o62akr20ac8zsjh10i]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742887241700\",\"TEST-OFI-FORENSE-1742887241700\",2759,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742887241700\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:20:41.740Z"}
{"level":"debug","message":"Executing query [m8o62al0md1dc72tngd]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.748Z"}
{"level":"debug","message":"Executing query [m8o62al3l24kkuqjwl]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742887241700\"]","timestamp":"2025-03-25T07:20:41.752Z"}
{"level":"debug","message":"Executing query [m8o62al84cei8fqu70x]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",15]","timestamp":"2025-03-25T07:20:41.756Z"}
{"level":"debug","message":"Executing query [m8o62alfbbbsz2ghxai]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.763Z"}
{"level":"debug","message":"Executing query [m8o62alkcs5qn6rlxk]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.768Z"}
{"level":"debug","message":"Executing query [m8o62alrswfvsq6hlbk]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.775Z"}
{"level":"debug","message":"Executing query [m8o62alu5ajbgacwg53]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.778Z"}
{"level":"debug","message":"Executing query [m8o62alz4k27kibofri]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.783Z"}
{"level":"debug","message":"Executing query [m8o62am5oxc2ig0zem]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742887241789\",\"TEST-SP-OFI-FORENSE-1742887241789\",8256,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:20:41.789Z"}
{"level":"debug","message":"Executing query [m8o62amalipqf2ted5o]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742887241789\"]","timestamp":"2025-03-25T07:20:41.794Z"}
{"level":"debug","message":"Executing query [m8o62amc7l3y8h6tux8]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742887241789\"]","timestamp":"2025-03-25T07:20:41.796Z"}
{"level":"debug","message":"Executing query [m8o62amo3mf36fuvvu9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:41.808Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:41.810Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:43.099Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:43.179Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:20:43.181Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:20:43.329Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:20:43.330Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:20:43.331Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:20:43.332Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:20:43.334Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:20:43.334Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:43.872Z"}
{"level":"debug","message":"Executing query [m8o62c84dcxxg5ayrfe]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:43.876Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:43.902Z"}
{"level":"debug","message":"Executing query [m8o62c8xysn2ny8eajq]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742887243875\"]","timestamp":"2025-03-25T07:20:43.905Z"}
{"level":"debug","message":"Executing query [m8o62c90lem7o51mqna]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742887243875\",true]","timestamp":"2025-03-25T07:20:43.908Z"}
{"level":"debug","message":"Executing query [m8o62c99giosakegl7]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.917Z"}
{"level":"debug","message":"Executing query [m8o62c9d4m7ci7l4234]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742887243875\"]","timestamp":"2025-03-25T07:20:43.921Z"}
{"level":"debug","message":"Executing query [m8o62c9hufq7yunpah]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",15]","timestamp":"2025-03-25T07:20:43.925Z"}
{"level":"debug","message":"Executing query [m8o62c9kdvokpy1foog]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.928Z"}
{"level":"debug","message":"Executing query [m8o62c9new93f57xt6c]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.931Z"}
{"level":"debug","message":"Executing query [m8o62c9xddq10ie26ad]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.941Z"}
{"level":"debug","message":"Executing query [m8o62c9zq36j51lzb4h]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.943Z"}
{"level":"debug","message":"Executing query [m8o62ca08tmz9pnu177]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.944Z"}
{"level":"debug","message":"Executing query [m8o62ca4a7wdxj8kttk]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.948Z"}
{"level":"debug","message":"Executing query [m8o62ca6egkac2xpvxk]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:20:43.950Z"}
{"level":"debug","message":"Executing query [m8o62ca88bqt5tz0tnn]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:43.952Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:43.954Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:44.291Z"}
{"level":"debug","message":"Executing query [m8o62cjtxu98y00trc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:44.297Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:44.315Z"}
{"level":"debug","message":"Executing query [m8o62ckcz558lnd7kc]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:20:44.316Z"}
{"level":"debug","message":"Executing query [m8o62ckd03iuk3j9c0ms]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:20:44.317Z"}
{"level":"debug","message":"Executing query [m8o62ckeb7zq9putajo]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:20:44.318Z"}
{"level":"debug","message":"Executing query [m8o62ckhw06nx05v9lo]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:20:44.321Z"}
{"level":"debug","message":"Executing query [m8o62ckneo46prlmn1]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:20:44.327Z"}
{"level":"debug","message":"Executing query [m8o62ckqo1ekeukya9]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[16,888,16,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:20:44.330Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:20:44.330Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 16, Área ID: 888, Rol ID: 888, Documento ID: 15","timestamp":"2025-03-25T07:20:44.344Z"}
{"level":"debug","message":"Executing query [m8o62cl5r5yjppkgk5i]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[15,16,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:20:44.345Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o62cl5r5yjppkgk5i]","params":"[15,16,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:20:44.353Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:20:44.354Z"}
{"level":"debug","message":"Executing query [m8o62clfrf54v72hr1]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[15]","timestamp":"2025-03-25T07:20:44.355Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o62clfrf54v72hr1]","params":"[15]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:20:44.357Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:20:44.358Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:20:44.358Z"}
{"level":"debug","message":"Executing query [m8o62cljhpmvqy7ke8]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[15,16,\"RESTAURAR\"]","timestamp":"2025-03-25T07:20:44.359Z"}
{"level":"debug","message":"Executing query [m8o62clpgyepenyi9vt]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[15]","timestamp":"2025-03-25T07:20:44.365Z"}
{"level":"debug","message":"Executing query [m8o62clskoeq1hh70f8]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[15,16,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:20:44.368Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o62clskoeq1hh70f8]","params":"[15,16,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:20:44.372Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:20:44.373Z"}
{"level":"debug","message":"Executing query [m8o62clxpwjcdqn0cab]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[15]","timestamp":"2025-03-25T07:20:44.373Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o62clxpwjcdqn0cab]","params":"[15]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:20:44.377Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:20:44.378Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:20:44.379Z"}
{"level":"debug","message":"Executing query [m8o62cm4pv8pqu69m2h]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[16,888,16,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:20:44.380Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:20:44.380Z"}
{"level":"debug","message":"Executing query [m8o62cm81oueqotjdz2]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:20:44.385Z"}
{"level":"debug","message":"Executing query [m8o62cmg39yu66jqaq2]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[16,\"DOCUMENTO\",16,\"ELIMINAR\"]","timestamp":"2025-03-25T07:20:44.392Z"}
{"level":"debug","message":"Executing query [m8o62cmjf2bvfd00jta]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.395Z"}
{"level":"debug","message":"Executing query [m8o62cmmeizohpuv7od]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:20:44.398Z"}
{"level":"debug","message":"Executing query [m8o62cmuo47t87fm3gm]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.406Z"}
{"level":"debug","message":"Executing query [m8o62cmzozrwxb8mll]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:20:44.411Z"}
{"level":"debug","message":"Executing query [m8o62cn40b1ejzx9xy1m]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:20:44.416Z"}
{"level":"debug","message":"Executing query [m8o62cn649d6bckagp3]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:20:44.418Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:20:44.421Z"}
{"level":"debug","message":"Executing query [m8o62cna9p24p5t2wul]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:44.422Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:44.423Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:44.646Z"}
{"level":"debug","message":"Executing query [m8o62cudlfmmwc668b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:44.678Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:44.727Z"}
{"level":"debug","message":"Executing query [m8o62cvxmj97esq6kzr]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:20:44.733Z"}
{"level":"debug","message":"Executing query [m8o62cw33o5zm945a33]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:20:44.739Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:20:44.742Z"}
{"level":"debug","message":"Executing query [m8o62cw6bm1919gct2]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:20:44.743Z"}
{"level":"debug","message":"Executing query [m8o62cw8pqa7dg7wqc]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:20:44.744Z"}
{"level":"debug","message":"Executing query [m8o62cwcogil4sjayae]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:20:44.748Z"}
{"level":"debug","message":"Executing query [m8o62cwl7lliylnznk]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.757Z"}
{"level":"debug","message":"Executing query [m8o62cwvj44l2s3fsw]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.767Z"}
{"level":"debug","message":"Executing query [m8o62cx0qsz0c8che09]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",16]","timestamp":"2025-03-25T07:20:44.772Z"}
{"level":"debug","message":"Executing query [m8o62cxlmpe3bmookva]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.793Z"}
{"level":"debug","message":"Executing query [m8o62cxovlh29zko3xs]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.796Z"}
{"level":"debug","message":"Executing query [m8o62cxvrljedzbx7o]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.803Z"}
{"level":"debug","message":"Executing query [m8o62cxzvfvaa4xus]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:44.807Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:44.809Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:45.699Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:20:45.795Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:45.871Z"}
{"level":"debug","message":"Executing query [m8o62dsbxo27oslpphl]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:20:45.900Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:45.954Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:46.243Z"}
{"level":"debug","message":"Executing query [m8o62e1y0x6mznocxd6j]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:46.246Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:46.261Z"}
{"level":"debug","message":"Executing query [m8o62e2fgokt7i7f7nc]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:20:46.263Z"}
{"level":"debug","message":"Executing query [m8o62e2isu2dx2ovd7]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742887246245\"]","timestamp":"2025-03-25T07:20:46.266Z"}
{"level":"debug","message":"Executing query [m8o62e2n2yx1f5wayp3]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742887246245\",\"TEST-OFI-QUIMICA-1742887246245\",8201,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:20:46.271Z"}
{"level":"debug","message":"Executing query [m8o62e2v55a5tv8tsrj]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.279Z"}
{"level":"debug","message":"Executing query [m8o62e305itx96htthc]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742887246245\"]","timestamp":"2025-03-25T07:20:46.284Z"}
{"level":"debug","message":"Executing query [m8o62e325zy2or2oj9e]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",8]","timestamp":"2025-03-25T07:20:46.286Z"}
{"level":"debug","message":"Executing query [m8o62e36ldm0a2nv2ej]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.290Z"}
{"level":"debug","message":"Executing query [m8o62e39j260txyx0ng]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.293Z"}
{"level":"debug","message":"Executing query [m8o62e3cz96kdn80t7c]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.296Z"}
{"level":"debug","message":"Executing query [m8o62e3e1ca92j88g7ei]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.298Z"}
{"level":"debug","message":"Executing query [m8o62e3hx9t1aj5n03i]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.301Z"}
{"level":"debug","message":"Executing query [m8o62e3jyfsa8s6jrco]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:46.303Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:46.305Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:47.005Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:47.010Z"}
{"level":"debug","message":"Executing query [m8o62en87ux64zerdo3]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:47.013Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:47.029Z"}
{"level":"debug","message":"Executing query [m8o62enr6avv34srzny]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:20:47.031Z"}
{"level":"debug","message":"Executing query [m8o62ens3ww2y14pl6l]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:20:47.033Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:20:47.033Z"}
{"level":"debug","message":"Executing query [m8o62enu2qklppxgt9q]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.034Z"}
{"level":"debug","message":"Executing query [m8o62env7yycaaxaz5k]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.035Z"}
{"level":"debug","message":"Executing query [m8o62enw48835ifsaey]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.036Z"}
{"level":"debug","message":"Executing query [m8o62enxyt37u8d4bl8]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:20:47.037Z"}
{"level":"debug","message":"Executing query [m8o62eo4pwiicgohved]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[17]","timestamp":"2025-03-25T07:20:47.044Z"}
{"level":"debug","message":"Executing query [m8o62eo7pxr9hr5hd0a]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.047Z"}
{"level":"debug","message":"Executing query [m8o62eo9xy3ukrivwrk]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",17]","timestamp":"2025-03-25T07:20:47.049Z"}
{"level":"debug","message":"Executing query [m8o62eocp5aj36nhg9b]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[17]","timestamp":"2025-03-25T07:20:47.052Z"}
{"level":"debug","message":"Executing query [m8o62eoewyxmia3z3ya]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[17]","timestamp":"2025-03-25T07:20:47.054Z"}
{"level":"debug","message":"Executing query [m8o62eol9awc5fpird6]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[17]","timestamp":"2025-03-25T07:20:47.061Z"}
{"level":"debug","message":"Executing query [m8o62eomh22r6cpcnu6]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.062Z"}
{"level":"debug","message":"Executing query [m8o62eona8kk1h8fsjh]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.063Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:20:47.064Z"}
{"level":"debug","message":"Executing query [m8o62eopuvidwqx2h1q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:47.065Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:47.066Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.474Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.488Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.491Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.505Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.520Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.527Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.532Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:21:29.538Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:21:29.541Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:21:29.543Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:21:29.544Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:21:29.546Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:29.806Z"}
{"level":"debug","message":"Executing query [m8o63bqaxr1x5e1bwm9]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:29.890Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:29.977Z"}
{"level":"debug","message":"Executing query [m8o63btai72b4jpm60d]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887289886\"]","timestamp":"2025-03-25T07:21:29.998Z"}
{"level":"debug","message":"Executing query [m8o63btw877jz440itl]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887289886\"]","timestamp":"2025-03-25T07:21:30.020Z"}
{"level":"debug","message":"Executing query [m8o63btztryq7awjdar]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742887289886\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:21:30.023Z"}
{"level":"debug","message":"Executing query [m8o63buckj08x5totid]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.036Z"}
{"level":"debug","message":"Executing query [m8o63buhldgk3wjiu1]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887289886\"]","timestamp":"2025-03-25T07:21:30.041Z"}
{"level":"debug","message":"Executing query [m8o63buoggl3hmn8clb]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1007]","timestamp":"2025-03-25T07:21:30.048Z"}
{"level":"debug","message":"Executing query [m8o63buup3e36bo4pvi]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.054Z"}
{"level":"debug","message":"Executing query [m8o63bv01us8ktzu9ko]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.060Z"}
{"level":"debug","message":"Executing query [m8o63bv46gizt1ng3fl]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.064Z"}
{"level":"debug","message":"Executing query [m8o63bv6vyhb1jzedg]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.067Z"}
{"level":"debug","message":"Executing query [m8o63bv9mjjjcarebjr]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.069Z"}
{"level":"debug","message":"Executing query [m8o63bvgm1pokgfy0lh]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.076Z"}
{"level":"debug","message":"Executing query [m8o63bvivs38is5t8fq]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:21:30.078Z"}
{"level":"debug","message":"Executing query [m8o63bvlj6b2173yzp]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:30.081Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:30.086Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:30.186Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:21:30.195Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:30.058Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:30.323Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:30.364Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:30.512Z"}
{"level":"debug","message":"Executing query [m8o63c82zy7g9cs8o5]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:21:30.531Z"}
{"level":"debug","message":"Executing query [m8o63c88afckw5v2aqc]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:21:30.536Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o63c88afckw5v2aqc]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:21:30.540Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:30.544Z"}
{"level":"debug","message":"Executing query [m8o63c5t5jd6s6ltkgh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:30.449Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:30.599Z"}
{"level":"debug","message":"Executing query [m8o63ca80hgherrc9nnn]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:21:30.608Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:21:30.613Z"}
{"level":"debug","message":"Executing query [m8o63caer89wobixhu9]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:21:30.614Z"}
{"level":"debug","message":"Executing query [m8o63caq21yyhgtcu3r]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:21:30.626Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:21:30.628Z"}
{"level":"debug","message":"Executing query [m8o63casixijnb9kuph]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:21:30.628Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:21:30.417Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:30.736Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:21:30.632Z"}
{"level":"debug","message":"Executing query [m8o63cejiu3r7qyldmc]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:21:30.767Z"}
{"level":"debug","message":"Executing query [m8o63cf1abfqzyblcjs]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:21:30.781Z"}
{"level":"debug","message":"Executing query [m8o63ce3h0ff87smacv]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:30.747Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:30.784Z"}
{"level":"debug","message":"Executing query [m8o63cf67rfcho118wi]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:21:30.786Z"}
{"level":"debug","message":"Executing query [m8o63cf7jch4wv2n84]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[15]","timestamp":"2025-03-25T07:21:30.787Z"}
{"level":"debug","message":"Executing query [m8o63cfa0pn3c7sb6kds]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742887290744\"]","timestamp":"2025-03-25T07:21:30.790Z"}
{"level":"debug","message":"Executing query [m8o63cferpubrmz89ym]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742887290744\",\"TEST-OFICIO-1742887290744\",4603,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:21:30.794Z"}
{"level":"debug","message":"Executing query [m8o63cfh2h336kv8naw]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:30.797Z"}
{"level":"debug","message":"Executing query [m8o63cflqnigufpa35i]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.801Z"}
{"level":"debug","message":"Executing query [m8o63cfrm9yz1m8mdq]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742887290744\"]","timestamp":"2025-03-25T07:21:30.807Z"}
{"level":"debug","message":"Executing query [m8o63cftxhjljeuamv]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",17]","timestamp":"2025-03-25T07:21:30.809Z"}
{"level":"debug","message":"Executing query [m8o63cfx6kcl5igqiqq]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.813Z"}
{"level":"debug","message":"Executing query [m8o63cg1n9s7ahpc9a]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.817Z"}
{"level":"debug","message":"Executing query [m8o63cg814jukt6ohos]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.824Z"}
{"level":"debug","message":"Executing query [m8o63cga5ff0r83d6fo]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.826Z"}
{"level":"debug","message":"Executing query [m8o63cgi2nvqee96h3c]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.834Z"}
{"level":"debug","message":"Executing query [m8o63cglvmibulmzesd]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742887290837\",\"TEST-SP-OFICIO-1742887290837\",7238,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:21:30.837Z"}
{"level":"debug","message":"Executing query [m8o63cgqwtalo4a3ts8]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742887290837\"]","timestamp":"2025-03-25T07:21:30.842Z"}
{"level":"debug","message":"Executing query [m8o63cguavxmjz7khui]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742887290837\"]","timestamp":"2025-03-25T07:21:30.846Z"}
{"level":"debug","message":"Executing query [m8o63cgzq7c9xjza5em]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:30.851Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:30.853Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:21:30.909Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:21:30.916Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:21:30.917Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:21:30.918Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:21:30.918Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:21:30.918Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:31.110Z"}
{"level":"debug","message":"Executing query [m8o63cpryyoyyrqz87r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:31.167Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:31.279Z"}
{"level":"debug","message":"Executing query [m8o63cszc9byw69foz]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:21:31.283Z"}
{"level":"debug","message":"Executing query [m8o63ctb9w6wu6wdqnl]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742887291165\"]","timestamp":"2025-03-25T07:21:31.295Z"}
{"level":"debug","message":"Executing query [m8o63ctiyret049icsd]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742887291165\",\"TEST-OFI-FORENSE-1742887291165\",2616,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742887291165\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:21:31.302Z"}
{"level":"debug","message":"Executing query [m8o63ctryjcyiawrp8]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.311Z"}
{"level":"debug","message":"Executing query [m8o63ctyprdbayspye]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742887291165\"]","timestamp":"2025-03-25T07:21:31.318Z"}
{"level":"debug","message":"Executing query [m8o63cu29zmvhrxxmac]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",17]","timestamp":"2025-03-25T07:21:31.322Z"}
{"level":"debug","message":"Executing query [m8o63cunxir0rjzd6tt]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.343Z"}
{"level":"debug","message":"Executing query [m8o63curbjhs4vpwaag]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.347Z"}
{"level":"debug","message":"Executing query [m8o63cv0588ggur2hp9]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.356Z"}
{"level":"debug","message":"Executing query [m8o63cv44y1ybz5gvum]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.360Z"}
{"level":"debug","message":"Executing query [m8o63cv8k61xstz99t9]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.365Z"}
{"level":"debug","message":"Executing query [m8o63cvct3qd6t04e0h]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742887291368\",\"TEST-SP-OFI-FORENSE-1742887291368\",1881,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:21:31.368Z"}
{"level":"debug","message":"Executing query [m8o63cvpevuaz18jblo]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742887291368\"]","timestamp":"2025-03-25T07:21:31.381Z"}
{"level":"debug","message":"Executing query [m8o63cvtj5ycrglesq]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742887291368\"]","timestamp":"2025-03-25T07:21:31.385Z"}
{"level":"debug","message":"Executing query [m8o63cw22fr424wueuq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:31.394Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:31.398Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:31.692Z"}
{"level":"debug","message":"Executing query [m8o63d6k8jhvfp0qa59]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:31.772Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:31.854Z"}
{"level":"debug","message":"Executing query [m8o63d95tzs94u7n2f8]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:21:31.865Z"}
{"level":"debug","message":"Executing query [m8o63d9ce3djcud6yrt]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:21:31.872Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:21:31.876Z"}
{"level":"debug","message":"Executing query [m8o63d9gygsdqysifgi]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:21:31.876Z"}
{"level":"debug","message":"Executing query [m8o63d9ig616cnstg47]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:21:31.878Z"}
{"level":"debug","message":"Executing query [m8o63d9l3q80pxdv5s7]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:21:31.881Z"}
{"level":"debug","message":"Executing query [m8o63d9zne45ayzti1a]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.895Z"}
{"level":"debug","message":"Executing query [m8o63da3yz7829fm1ri]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.899Z"}
{"level":"debug","message":"Executing query [m8o63da7cnb0xtptvjk]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",17]","timestamp":"2025-03-25T07:21:31.903Z"}
{"level":"debug","message":"Executing query [m8o63dalv8ubww9l5gj]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.917Z"}
{"level":"debug","message":"Executing query [m8o63dapjnaagwhxc8]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.921Z"}
{"level":"debug","message":"Executing query [m8o63daw00v64rt2lmgv]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.929Z"}
{"level":"debug","message":"Executing query [m8o63db1wco9ite217n]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:31.933Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:31.937Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:31.971Z"}
{"level":"debug","message":"Executing query [m8o63de12ljenlt3wfs]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:32.042Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:32.111Z"}
{"level":"debug","message":"Executing query [m8o63dg6w7u5dl7ztmd]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:21:32.118Z"}
{"level":"debug","message":"Executing query [m8o63dguow3kpilhgul]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:21:32.142Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:32.135Z"}
{"level":"debug","message":"Executing query [m8o63dh086ku2vyjnpu]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:21:32.148Z"}
{"level":"debug","message":"Executing query [m8o63dh50mjvvl2y4ifl]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:21:32.153Z"}
{"level":"debug","message":"Executing query [m8o63dhdze2t3zekvc8]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:21:32.161Z"}
{"level":"debug","message":"Executing query [m8o63dhn8o7gppo9qfu]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[17,888,18,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:21:32.171Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:21:32.171Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 18, Área ID: 888, Rol ID: 888, Documento ID: 17","timestamp":"2025-03-25T07:21:32.179Z"}
{"level":"debug","message":"Executing query [m8o63dhx62nzm6j4xvf]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[17,18,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:21:32.181Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o63dhx62nzm6j4xvf]","params":"[17,18,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:21:32.188Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:21:32.188Z"}
{"level":"debug","message":"Executing query [m8o63di5b84as6953p]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[17]","timestamp":"2025-03-25T07:21:32.189Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o63di5b84as6953p]","params":"[17]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:21:32.194Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:21:32.194Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:21:32.194Z"}
{"level":"debug","message":"Executing query [m8o63dickj13uqf0bn]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[17,18,\"RESTAURAR\"]","timestamp":"2025-03-25T07:21:32.196Z"}
{"level":"debug","message":"Executing query [m8o63dgrmvwmzjtkmfr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:32.140Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:32.194Z"}
{"level":"debug","message":"Executing query [m8o63dieqrwpgvowa9]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:21:32.199Z"}
{"level":"debug","message":"Executing query [m8o63diiwmusk84bj0b]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[17]","timestamp":"2025-03-25T07:21:32.202Z"}
{"level":"debug","message":"Executing query [m8o63dilaeq8f3msrrf]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742887292137\"]","timestamp":"2025-03-25T07:21:32.205Z"}
{"level":"debug","message":"Executing query [m8o63dio22h9rg3o6o4]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[17,18,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:21:32.208Z"}
{"level":"debug","message":"Executing query [m8o63dipm0obyinxfvo]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742887292137\",\"TEST-OFI-QUIMICA-1742887292137\",4050,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:21:32.209Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o63dio22h9rg3o6o4]","params":"[17,18,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:21:32.214Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:21:32.214Z"}
{"level":"debug","message":"Executing query [m8o63diu01chqz6r7mim]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[17]","timestamp":"2025-03-25T07:21:32.214Z"}
{"level":"debug","message":"Executing query [m8o63diw0bruz5ieo67v]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.216Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o63diu01chqz6r7mim]","params":"[17]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:21:32.223Z"}
{"level":"debug","message":"Executing query [m8o63dj5kld02tuuob]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742887292137\"]","timestamp":"2025-03-25T07:21:32.225Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:21:32.224Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:21:32.224Z"}
{"level":"debug","message":"Executing query [m8o63dj5f58hnyx5jlm]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[17,888,18,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:21:32.225Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:21:32.225Z"}
{"level":"debug","message":"Executing query [m8o63dj8vujb7ploqk]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",9]","timestamp":"2025-03-25T07:21:32.228Z"}
{"level":"debug","message":"Executing query [m8o63dj9g5c9s5m431]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:21:32.229Z"}
{"level":"debug","message":"Executing query [m8o63djdz0btu18uooq]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[18,\"DOCUMENTO\",18,\"ELIMINAR\"]","timestamp":"2025-03-25T07:21:32.233Z"}
{"level":"debug","message":"Executing query [m8o63djdjfzhs977hs9]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.233Z"}
{"level":"debug","message":"Executing query [m8o63djgay4mxssoied]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.236Z"}
{"level":"debug","message":"Executing query [m8o63djh136edlqbskw]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.237Z"}
{"level":"debug","message":"Executing query [m8o63djtxv4296lcv7]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.249Z"}
{"level":"debug","message":"Executing query [m8o63djxkn2zmfdoqxs]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.253Z"}
{"level":"debug","message":"Executing query [m8o63djzxwlhsj6bx08]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:21:32.255Z"}
{"level":"debug","message":"Executing query [m8o63dk35k3scqhgmzk]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.259Z"}
{"level":"debug","message":"Executing query [m8o63dkb1jeuciejvmv]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:32.267Z"}
{"level":"debug","message":"Executing query [m8o63dke287tg80kvhej]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[17]","timestamp":"2025-03-25T07:21:32.270Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:32.271Z"}
{"level":"debug","message":"Executing query [m8o63dkkv8yzffwqz7]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:21:32.276Z"}
{"level":"debug","message":"Executing query [m8o63dklrjj2k7lm8v]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:21:32.277Z"}
{"level":"debug","message":"Executing query [m8o63dknmz334gbdes]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:21:32.279Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:21:32.283Z"}
{"level":"debug","message":"Executing query [m8o63dks2wp4bwauzap]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:32.284Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:32.287Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:32.239Z"}
{"level":"debug","message":"Executing query [m8o63dmgssrpcxlxgxd]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:32.344Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:32.427Z"}
{"level":"debug","message":"Executing query [m8o63dp0xjtkw9zftj]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742887292340\"]","timestamp":"2025-03-25T07:21:32.437Z"}
{"level":"debug","message":"Executing query [m8o63dp3runwsu866vo]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742887292340\",true]","timestamp":"2025-03-25T07:21:32.440Z"}
{"level":"debug","message":"Executing query [m8o63dpccirwssj4tka]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.448Z"}
{"level":"debug","message":"Executing query [m8o63dpgq0r3phjrtqc]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742887292340\"]","timestamp":"2025-03-25T07:21:32.453Z"}
{"level":"debug","message":"Executing query [m8o63dpjlr8rs9u4qpj]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",18]","timestamp":"2025-03-25T07:21:32.455Z"}
{"level":"debug","message":"Executing query [m8o63dpw02n4hmxzu3qj]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.468Z"}
{"level":"debug","message":"Executing query [m8o63dq1a3ln2510kvs]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.474Z"}
{"level":"debug","message":"Executing query [m8o63dq6ooybl90ok88]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.478Z"}
{"level":"debug","message":"Executing query [m8o63dqaktwrv1t8j1f]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.482Z"}
{"level":"debug","message":"Executing query [m8o63dqek2y0hnztinn]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.486Z"}
{"level":"debug","message":"Executing query [m8o63dqps0uhfle3jms]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.497Z"}
{"level":"debug","message":"Executing query [m8o63dqsn5f5mc2xbds]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:21:32.500Z"}
{"level":"debug","message":"Executing query [m8o63dqu317sqjwj0p9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:32.502Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:32.505Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:32.771Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:32.804Z"}
{"level":"debug","message":"Executing query [m8o63dzbxibmai3f4x]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:32.807Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:32.867Z"}
{"level":"debug","message":"Executing query [m8o63e14u8aske6hqb]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:21:32.872Z"}
{"level":"debug","message":"Executing query [m8o63e18qotmyt5xcvi]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:21:32.877Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:21:32.879Z"}
{"level":"debug","message":"Executing query [m8o63e1b8v5ql8uq4pw]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.879Z"}
{"level":"debug","message":"Executing query [m8o63e1ditjueg8qyts]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.881Z"}
{"level":"debug","message":"Executing query [m8o63e1g9q4qeamm0qa]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.884Z"}
{"level":"debug","message":"Executing query [m8o63e1k4c5zg297g0e]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:21:32.888Z"}
{"level":"debug","message":"Executing query [m8o63e1qzma8vr819l8]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[19]","timestamp":"2025-03-25T07:21:32.894Z"}
{"level":"debug","message":"Executing query [m8o63e1uzvig9govp]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.898Z"}
{"level":"debug","message":"Executing query [m8o63e1xl1wzsblm3v]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",19]","timestamp":"2025-03-25T07:21:32.901Z"}
{"level":"debug","message":"Executing query [m8o63e22bv0un3q3a3p]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[19]","timestamp":"2025-03-25T07:21:32.906Z"}
{"level":"debug","message":"Executing query [m8o63e25o9tvscxj9im]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[19]","timestamp":"2025-03-25T07:21:32.909Z"}
{"level":"debug","message":"Executing query [m8o63e2embd6zetp6xc]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[19]","timestamp":"2025-03-25T07:21:32.918Z"}
{"level":"debug","message":"Executing query [m8o63e2geo1sxpn7lfl]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.920Z"}
{"level":"debug","message":"Executing query [m8o63e2i599htfhzql6]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.922Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:21:32.924Z"}
{"level":"debug","message":"Executing query [m8o63e2l8z8tdwbs10q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:32.925Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:32.928Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:32.467Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:21:33.006Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:21:33.032Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:33.342Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:21:33.385Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:33.506Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:33.863Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:21:34.156Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:34.289Z"}
{"level":"debug","message":"Executing query [m8o63f5vxvs0ngrrur]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:21:34.340Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:34.386Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:35.232Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:35.333Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:35.490Z"}
{"duration":"30ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:21:35.494Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:21:35.492Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:35.497Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:21:35.503Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:35.508Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T07:24:38.801Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T07:24:38.806Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.811Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.878Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.885Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.899Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.906Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.914Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:39.023Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:39.033Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:39.037Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T07:25:45.050Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T07:25:45.055Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.060Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.122Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.130Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.145Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.161Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.168Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.272Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.286Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.290Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:26:38.309Z"}
{"level":"error","message":"Error al actualizar permiso contextual: No se proporcionaron datos para actualizar","timestamp":"2025-03-25T07:26:38.398Z"}
{"fatal":true,"level":"error","message":"Error al conectar a la base de datos: Encoding not recognized: 'cesu8' (searched as: 'cesu8')","stack":"Error: Encoding not recognized: 'cesu8' (searched as: 'cesu8')\n    at Object.getCodec (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:104:23)\n    at Object.getDecoder (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:125:23)\n    at Object.<anonymous>.exports.decode (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\parsers\\string.js:20:23)\n    at Packet.readNullTerminatedString (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\packet.js:414:25)\n    at Function.fromPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\handshake.js:62:33)\n    at ClientHandshake.handshakeInit (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\client_handshake.js:112:40)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:45:22)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:26:42.425Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:29:12.649Z"}
{"level":"error","message":"Error al actualizar permiso contextual: No se proporcionaron datos para actualizar","timestamp":"2025-03-25T07:29:12.712Z"}
{"fatal":true,"level":"error","message":"Error al conectar a la base de datos: Encoding not recognized: 'cesu8' (searched as: 'cesu8')","stack":"Error: Encoding not recognized: 'cesu8' (searched as: 'cesu8')\n    at Object.getCodec (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:104:23)\n    at Object.getDecoder (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:125:23)\n    at Object.<anonymous>.exports.decode (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\parsers\\string.js:20:23)\n    at Packet.readNullTerminatedString (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\packet.js:414:25)\n    at Function.fromPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\handshake.js:62:33)\n    at ClientHandshake.handshakeInit (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\client_handshake.js:112:40)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:45:22)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:29:16.576Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:32:27.878Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:04.998Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:25.319Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.595Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.604Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.607Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.614Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.617Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.629Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.632Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:33:56.642Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:33:56.644Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:33:56.648Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:33:56.651Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:33:56.652Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:56.870Z"}
{"level":"debug","message":"Executing query [m8o6jc5w9yfm9p2n6t]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:56.948Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:57.037Z"}
{"level":"debug","message":"Executing query [m8o6jc8ojyoy3n2r41e]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888036944\"]","timestamp":"2025-03-25T07:33:57.048Z"}
{"level":"debug","message":"Executing query [m8o6jc9981c6x94iw3d]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888036944\"]","timestamp":"2025-03-25T07:33:57.069Z"}
{"level":"debug","message":"Executing query [m8o6jc9bt3lk00h72y8]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742888036944\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:33:57.072Z"}
{"level":"debug","message":"Executing query [m8o6jc9rna1sv63yjgc]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.087Z"}
{"level":"debug","message":"Executing query [m8o6jca29h0f3isk4y]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888036944\"]","timestamp":"2025-03-25T07:33:57.098Z"}
{"level":"debug","message":"Executing query [m8o6jca7v9dzgfmmew]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1008]","timestamp":"2025-03-25T07:33:57.104Z"}
{"level":"debug","message":"Executing query [m8o6jcagp5qgkql01i8]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.112Z"}
{"level":"debug","message":"Executing query [m8o6jcal62vw7h9et5i]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.117Z"}
{"level":"debug","message":"Executing query [m8o6jcas8claws5oo2c]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.124Z"}
{"level":"debug","message":"Executing query [m8o6jcaxume25ie58h]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.130Z"}
{"level":"debug","message":"Executing query [m8o6jcb1lupjg837fs9]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.133Z"}
{"level":"debug","message":"Executing query [m8o6jcb6k5ql6yx2nz8]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.138Z"}
{"level":"debug","message":"Executing query [m8o6jcb9a3vgr0oqkam]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:33:57.141Z"}
{"level":"debug","message":"Executing query [m8o6jcbcr64rdcyvw1h]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:57.144Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:57.148Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.480Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.529Z"}
{"level":"debug","message":"Executing query [m8o6jcpmujy46l18yeq]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:33:57.658Z"}
{"level":"debug","message":"Executing query [m8o6jcppjs3uao2k0qa]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:33:57.661Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:57.664Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o6jcppjs3uao2k0qa]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:33:57.668Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:57.671Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.655Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.785Z"}
{"level":"debug","message":"Executing query [m8o6jcskgfmrts9gf5n]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:57.765Z"}
{"level":"debug","message":"Executing query [m8o6jctbfzc79noc4b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:57.791Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:57.826Z"}
{"level":"debug","message":"Executing query [m8o6jcubxpbclh9ajxj]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:33:57.827Z"}
{"level":"debug","message":"Executing query [m8o6jcugd8devl4f2i]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742888037789\"]","timestamp":"2025-03-25T07:33:57.832Z"}
{"level":"debug","message":"Executing query [m8o6jcuihc8rfl040tj]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742888037789\",\"TEST-OFI-FORENSE-1742888037789\",8352,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742888037789\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:33:57.835Z"}
{"level":"debug","message":"Executing query [m8o6jcusvyk85w4l06d]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.844Z"}
{"level":"debug","message":"Executing query [m8o6jcuxcshtgya9qc]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742888037789\"]","timestamp":"2025-03-25T07:33:57.849Z"}
{"level":"debug","message":"Executing query [m8o6jcv0hqhineev61i]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",19]","timestamp":"2025-03-25T07:33:57.852Z"}
{"level":"debug","message":"Executing query [m8o6jcv5lctjy3ul2i]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.857Z"}
{"level":"debug","message":"Executing query [m8o6jcv8wa4xql2a9ee]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.860Z"}
{"level":"debug","message":"Executing query [m8o6jcvdhdbxo7mkur8]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.865Z"}
{"level":"debug","message":"Executing query [m8o6jcvhharmp1wbe6m]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.869Z"}
{"level":"debug","message":"Executing query [m8o6jcvkum8vjz1vdah]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.873Z"}
{"level":"debug","message":"Executing query [m8o6jcvp26hnjm9spsf]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742888037877\",\"TEST-SP-OFI-FORENSE-1742888037877\",7780,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:33:57.877Z"}
{"level":"debug","message":"Executing query [m8o6jcvs4d56vc9zfbm]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742888037877\"]","timestamp":"2025-03-25T07:33:57.881Z"}
{"level":"debug","message":"Executing query [m8o6jcvvppfnnx2rlgp]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742888037877\"]","timestamp":"2025-03-25T07:33:57.883Z"}
{"level":"debug","message":"Executing query [m8o6jcw03tmuq2y03b5]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:57.888Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:57.890Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:33:57.852Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.490Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:57.910Z"}
{"level":"debug","message":"Executing query [m8o6jcwqvib8qcli40q]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:33:57.917Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:33:57.925Z"}
{"level":"debug","message":"Executing query [m8o6jcx54hnp7jc5q5k]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:33:57.929Z"}
{"level":"debug","message":"Executing query [m8o6jcx9uk1n74vniog]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:33:57.933Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:33:57.935Z"}
{"level":"debug","message":"Executing query [m8o6jcxcr6p8suvvpxs]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:33:57.936Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:33:57.938Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:33:57.725Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.840Z"}
{"level":"debug","message":"Executing query [m8o6jcxr3sj36c74wo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:57.951Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:58.020Z"}
{"level":"debug","message":"Executing query [m8o6jczyqjajtprvylj]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:33:58.031Z"}
{"level":"debug","message":"Executing query [m8o6jd2i8akhjry5i99]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742888037949\"]","timestamp":"2025-03-25T07:33:58.122Z"}
{"level":"debug","message":"Executing query [m8o6jd2v1j1v6i592tg]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742888037949\",\"TEST-OFICIO-1742888037949\",6138,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:33:58.135Z"}
{"level":"debug","message":"Executing query [m8o6jd34093m536328ge]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.144Z"}
{"level":"debug","message":"Executing query [m8o6jd3ajqqlta0tqu]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742888037949\"]","timestamp":"2025-03-25T07:33:58.150Z"}
{"level":"debug","message":"Executing query [m8o6jd3djyt9ica06p]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",19]","timestamp":"2025-03-25T07:33:58.154Z"}
{"level":"debug","message":"Executing query [m8o6jd3n4n39o07ao14]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.163Z"}
{"level":"debug","message":"Executing query [m8o6jd3qo29tv1849g]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.166Z"}
{"level":"debug","message":"Executing query [m8o6jd42hsa6idl8qp]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.178Z"}
{"level":"debug","message":"Executing query [m8o6jd45ducgsfrz7d]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.181Z"}
{"level":"debug","message":"Executing query [m8o6jd4bdvvbrue0jz]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.187Z"}
{"level":"debug","message":"Executing query [m8o6jd4dtbnwo8aq5ys]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742888038189\",\"TEST-SP-OFICIO-1742888038189\",3390,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:33:58.189Z"}
{"level":"debug","message":"Executing query [m8o6jd4j527e2b3ox43]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742888038189\"]","timestamp":"2025-03-25T07:33:58.195Z"}
{"level":"debug","message":"Executing query [m8o6jd4l09z0ytja81ud]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742888038189\"]","timestamp":"2025-03-25T07:33:58.197Z"}
{"level":"debug","message":"Executing query [m8o6jd4pdjkfxyvbfs8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:58.201Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:58.204Z"}
{"level":"debug","message":"Executing query [m8o6jczi5uieqyxfj2o]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:33:58.014Z"}
{"level":"debug","message":"Executing query [m8o6jczwpb4ghiyz5uf]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:33:58.029Z"}
{"level":"debug","message":"Executing query [m8o6jd4u8rbrnf26ww6]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[17]","timestamp":"2025-03-25T07:33:58.206Z"}
{"level":"debug","message":"Executing query [m8o6jd56j4upbiz8kyd]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:58.218Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:33:58.305Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:33:58.384Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:33:58.385Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:33:58.386Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:33:58.386Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:33:58.386Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:58.828Z"}
{"level":"debug","message":"Executing query [m8o6jdn1gzfrss4e8r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:58.861Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:58.879Z"}
{"level":"debug","message":"Executing query [m8o6jdnm8h8kierd65c]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:33:58.882Z"}
{"level":"debug","message":"Executing query [m8o6jdnocqdk8uhhn96]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:33:58.884Z"}
{"level":"debug","message":"Executing query [m8o6jdnr7wb396wdekk]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:33:58.887Z"}
{"level":"debug","message":"Executing query [m8o6jdntgmp8jysrml4]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:33:58.889Z"}
{"level":"debug","message":"Executing query [m8o6jdo2bremxfl287b]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:33:58.898Z"}
{"level":"debug","message":"Executing query [m8o6jdoa6nqwur2aoj8]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[19,888,20,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:33:58.906Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:33:58.906Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 20, Área ID: 888, Rol ID: 888, Documento ID: 19","timestamp":"2025-03-25T07:33:58.914Z"}
{"level":"debug","message":"Executing query [m8o6jdolbnumjkor1d]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[19,20,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:33:58.917Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6jdolbnumjkor1d]","params":"[19,20,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:33:58.925Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:33:58.926Z"}
{"level":"debug","message":"Executing query [m8o6jdou4kj2dcngof]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.927Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6jdou4kj2dcngof]","params":"[19]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:33:58.931Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:33:58.932Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:33:58.933Z"}
{"level":"debug","message":"Executing query [m8o6jdp2xr3gn4t80v]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[19,20,\"RESTAURAR\"]","timestamp":"2025-03-25T07:33:58.934Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:58.912Z"}
{"level":"debug","message":"Executing query [m8o6jdp8g568uf0iuu]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.940Z"}
{"level":"debug","message":"Executing query [m8o6jdpcq7ros0ron3l]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[19,20,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:33:58.944Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6jdpcq7ros0ron3l]","params":"[19,20,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:33:58.949Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:33:58.949Z"}
{"level":"debug","message":"Executing query [m8o6jdph6ph6r6f0i5]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.949Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6jdph6ph6r6f0i5]","params":"[19]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:33:58.953Z"}
{"level":"debug","message":"Executing query [m8o6jdoljmkul4fx9we]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:58.918Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:33:58.953Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:33:58.954Z"}
{"level":"debug","message":"Executing query [m8o6jdpnmickjvzkrb]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[19,888,20,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:33:58.955Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:33:58.955Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:58.955Z"}
{"level":"debug","message":"Executing query [m8o6jdpye4s3a6msb1g]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:33:58.966Z"}
{"level":"debug","message":"Executing query [m8o6jdq7zkwru76xkh]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:33:58.975Z"}
{"level":"debug","message":"Executing query [m8o6jdq95tzrxt2850y]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[20,\"DOCUMENTO\",20,\"ELIMINAR\"]","timestamp":"2025-03-25T07:33:58.977Z"}
{"level":"debug","message":"Executing query [m8o6jdqbrkh0gqi7sug]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:33:58.979Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:33:58.981Z"}
{"level":"debug","message":"Executing query [m8o6jdqemlz94x8bkmm]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:33:58.982Z"}
{"level":"debug","message":"Executing query [m8o6jdqgcfcs4m72wgd]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[20]","timestamp":"2025-03-25T07:33:58.984Z"}
{"level":"debug","message":"Executing query [m8o6jdqgpvja833a50b]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:33:58.984Z"}
{"level":"debug","message":"Executing query [m8o6jdqjgc23o01gg76]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:33:58.987Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:58.908Z"}
{"level":"debug","message":"Executing query [m8o6jdqmzcse6gkuv1o]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:33:58.990Z"}
{"level":"debug","message":"Executing query [m8o6jdqqlbl69z3lbdm]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-25T07:33:58.994Z"}
{"level":"debug","message":"Executing query [m8o6jdqrzba0bydgez]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.995Z"}
{"level":"debug","message":"Executing query [m8o6jdqvymxf35mw7y]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-25T07:33:58.999Z"}
{"level":"debug","message":"Executing query [m8o6jdqw0uwkkuweh6g8]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:33:59.001Z"}
{"level":"debug","message":"Executing query [m8o6jdqzc4mtrvdf0iw]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:33:59.003Z"}
{"level":"debug","message":"Executing query [m8o6jdqyjfqw0vg5sgq]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",20]","timestamp":"2025-03-25T07:33:59.003Z"}
{"level":"debug","message":"Executing query [m8o6jdr0lkmad30huso]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:33:59.004Z"}
{"level":"debug","message":"Executing query [m8o6jdr3kufcp8pe3ba]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.007Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:33:59.009Z"}
{"level":"debug","message":"Executing query [m8o6jdr6y6mt8jo7so]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.010Z"}
{"level":"debug","message":"Executing query [m8o6jdr5kuzrmb367t]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:59.009Z"}
{"level":"debug","message":"Executing query [m8o6jdr98r1pl07x519]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.013Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:59.012Z"}
{"level":"debug","message":"Executing query [m8o6jdrb90wdmhsjfub]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:59.015Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:59.017Z"}
{"level":"debug","message":"Executing query [m8o6jdqcryl1im6w6yi]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:58.981Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:59.042Z"}
{"level":"debug","message":"Executing query [m8o6jdslzeekji9ya2]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742888038978\"]","timestamp":"2025-03-25T07:33:59.062Z"}
{"level":"debug","message":"Executing query [m8o6jdsrbk0fdsqpvea]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742888038978\",true]","timestamp":"2025-03-25T07:33:59.067Z"}
{"level":"debug","message":"Executing query [m8o6jdswfo5el8an02]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.072Z"}
{"level":"debug","message":"Executing query [m8o6jdt3x0imuwfrih]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742888038978\"]","timestamp":"2025-03-25T07:33:59.079Z"}
{"level":"debug","message":"Executing query [m8o6jdt5a7e3scfpinr]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",20]","timestamp":"2025-03-25T07:33:59.081Z"}
{"level":"debug","message":"Executing query [m8o6jdtcl29h0njebdg]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.089Z"}
{"level":"debug","message":"Executing query [m8o6jdth97pu04lm18]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.094Z"}
{"level":"debug","message":"Executing query [m8o6jdtm0x3g53ogi4fh]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.098Z"}
{"level":"debug","message":"Executing query [m8o6jdtrm7kl4lv27rp]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.103Z"}
{"level":"debug","message":"Executing query [m8o6jdtvnf77s0v7x4f]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.107Z"}
{"level":"debug","message":"Executing query [m8o6jdu4o85ldenyxcm]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.117Z"}
{"level":"debug","message":"Executing query [m8o6jdu83gba4k5leqn]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:33:59.120Z"}
{"level":"debug","message":"Executing query [m8o6jduaxex50gpf55a]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:59.122Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:59.125Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:59.216Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:59.898Z"}
{"level":"debug","message":"Executing query [m8o6jeiv5j1b4l87v9s]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:00.008Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:00.098Z"}
{"level":"debug","message":"Executing query [m8o6jelw45zg8bi2qr2]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:00.116Z"}
{"level":"debug","message":"Executing query [m8o6jem4mho4ui09uto]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742888040005\"]","timestamp":"2025-03-25T07:34:00.124Z"}
{"level":"debug","message":"Executing query [m8o6jem7v94g3i0gzim]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742888040005\",\"TEST-OFI-QUIMICA-1742888040005\",7599,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:34:00.127Z"}
{"level":"debug","message":"Executing query [m8o6jemgrk7b16oso0m]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.136Z"}
{"level":"debug","message":"Executing query [m8o6jemmfc8ewjf11xb]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742888040005\"]","timestamp":"2025-03-25T07:34:00.142Z"}
{"level":"debug","message":"Executing query [m8o6jempnsgsq70jmeh]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",10]","timestamp":"2025-03-25T07:34:00.145Z"}
{"level":"debug","message":"Executing query [m8o6jemvnp6p7lw3wg]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.151Z"}
{"level":"debug","message":"Executing query [m8o6jen05g57qoe9hi4]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.157Z"}
{"level":"debug","message":"Executing query [m8o6jen62wod4o8k5eg]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.162Z"}
{"level":"debug","message":"Executing query [m8o6jena177uf2jzub5]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.166Z"}
{"level":"debug","message":"Executing query [m8o6jenjxct01fsvwh]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.175Z"}
{"level":"debug","message":"Executing query [m8o6jenl9euy925k2x8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:00.177Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:00.181Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:00.322Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:00.353Z"}
{"level":"debug","message":"Executing query [m8o6jesk7qk0dzq7h]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:00.358Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:00.431Z"}
{"level":"debug","message":"Executing query [m8o6jeupi97ex8b57k]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:34:00.433Z"}
{"level":"debug","message":"Executing query [m8o6jeuysl4esnaquj]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:34:00.442Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:34:00.444Z"}
{"level":"debug","message":"Executing query [m8o6jev1s7m7uw0np5]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.445Z"}
{"level":"debug","message":"Executing query [m8o6jev3hoey5xtg7p9]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.447Z"}
{"level":"debug","message":"Executing query [m8o6jev6tn5qdm2mvzq]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.450Z"}
{"level":"debug","message":"Executing query [m8o6jevam4xuy6vajc]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:34:00.454Z"}
{"level":"debug","message":"Executing query [m8o6jevgz8vdvy2cfe]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[21]","timestamp":"2025-03-25T07:34:00.460Z"}
{"level":"debug","message":"Executing query [m8o6jevmwfhmnjff9dj]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.466Z"}
{"level":"debug","message":"Executing query [m8o6jevpdj2v2p2sol]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",21]","timestamp":"2025-03-25T07:34:00.469Z"}
{"level":"debug","message":"Executing query [m8o6jevsvn7o3myegx]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[21]","timestamp":"2025-03-25T07:34:00.472Z"}
{"level":"debug","message":"Executing query [m8o6jevwkww9jogy1eq]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[21]","timestamp":"2025-03-25T07:34:00.476Z"}
{"level":"debug","message":"Executing query [m8o6jew0x0or29j6qsi]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[21]","timestamp":"2025-03-25T07:34:00.480Z"}
{"level":"debug","message":"Executing query [m8o6jew2y4qo719pn7q]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.482Z"}
{"level":"debug","message":"Executing query [m8o6jew4b2eifapsp19]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.484Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:34:00.485Z"}
{"level":"debug","message":"Executing query [m8o6jew6m8u618ip3fq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:00.486Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:00.490Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:59.940Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:34:00.615Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:34:00.666Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:01.050Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:34:01.072Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:01.151Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:01.289Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:34:01.526Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:01.678Z"}
{"level":"debug","message":"Executing query [m8o6jfugpi2krn2zly]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:34:01.721Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:01.757Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:02.516Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:02.550Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:02.707Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:34:02.709Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:02.732Z"}
{"duration":"28ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:34:02.735Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:34:02.739Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:02.747Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.859Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.872Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.875Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.879Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.887Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.914Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.917Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:34:48.926Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:34:48.928Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:34:48.930Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:34:48.932Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:34:48.936Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:49.225Z"}
{"level":"debug","message":"Executing query [m8o6kgk6dwgxmf6h4d]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:49.302Z"}
{"level":"debug","message":"Executing query [m8o6kgnxuw5db301vrg]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888089292\"]","timestamp":"2025-03-25T07:34:49.437Z"}
{"level":"debug","message":"Executing query [m8o6kgozcezvrhvc74]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888089292\"]","timestamp":"2025-03-25T07:34:49.475Z"}
{"level":"debug","message":"Executing query [m8o6kgp27ndhgq6zkv3]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742888089292\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:34:49.478Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:49.484Z"}
{"level":"debug","message":"Executing query [m8o6kgptb210u259y9o]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.505Z"}
{"level":"debug","message":"Executing query [m8o6kgqr98u5d238a8m]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888089292\"]","timestamp":"2025-03-25T07:34:49.539Z"}
{"level":"debug","message":"Executing query [m8o6kgqvlnok77gobkr]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1009]","timestamp":"2025-03-25T07:34:49.543Z"}
{"level":"debug","message":"Executing query [m8o6kgr808uhav3eycsm]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.556Z"}
{"level":"debug","message":"Executing query [m8o6kgred2juz2wdki]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.562Z"}
{"level":"debug","message":"Executing query [m8o6kgs0dtdk2uhbk9g]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.584Z"}
{"level":"debug","message":"Executing query [m8o6kgsb0p3546p1s9x]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.596Z"}
{"level":"debug","message":"Executing query [m8o6kgsmuoziqk30kb]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.606Z"}
{"level":"debug","message":"Executing query [m8o6kgssbqnsixzdul9]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.612Z"}
{"level":"debug","message":"Executing query [m8o6kgsv5wdgyivpeed]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:34:49.615Z"}
{"level":"debug","message":"Executing query [m8o6kgsye7xaipgwad6]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:49.618Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:49.623Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:49.629Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:49.350Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:49.664Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:49.751Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:34:49.679Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:49.842Z"}
{"level":"debug","message":"Executing query [m8o6kgztqynl7orekzi]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:34:49.865Z"}
{"level":"debug","message":"Executing query [m8o6kh01git82qq7iie]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:34:49.874Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o6kh01git82qq7iie]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:34:49.884Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:49.887Z"}
{"level":"debug","message":"Executing query [m8o6kgy706sbttl8t1du]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:49.808Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:49.896Z"}
{"level":"debug","message":"Executing query [m8o6kh0yu9z8slgqaog]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:49.907Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:34:49.929Z"}
{"level":"debug","message":"Executing query [m8o6kh1makn8q1e6tzb]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:34:49.930Z"}
{"level":"debug","message":"Executing query [m8o6kh1pg0fjde8zubq]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:34:49.933Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:34:49.935Z"}
{"level":"debug","message":"Executing query [m8o6kh1sj8id00za15]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:49.936Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:34:49.939Z"}
{"level":"debug","message":"Executing query [m8o6kh4kvy27apo1hd]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:34:50.036Z"}
{"level":"debug","message":"Executing query [m8o6kh51taks92y4ls]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:34:50.054Z"}
{"level":"debug","message":"Executing query [m8o6kh54cmlwlic11i]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[19]","timestamp":"2025-03-25T07:34:50.057Z"}
{"level":"debug","message":"Executing query [m8o6kh5hzxrh0t7nm3]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:50.069Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:50.169Z"}
{"level":"debug","message":"Executing query [m8o6kh8mm5nab9g950q]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:50.182Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:50.217Z"}
{"level":"debug","message":"Executing query [m8o6kh9o5p8jrgmqjbb]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:50.220Z"}
{"level":"debug","message":"Executing query [m8o6kh9qrvucmwadsf]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742888090181\"]","timestamp":"2025-03-25T07:34:50.222Z"}
{"level":"debug","message":"Executing query [m8o6kh9sdfpo71mz0n]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742888090181\",\"TEST-OFICIO-1742888090181\",4826,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:34:50.224Z"}
{"level":"debug","message":"Executing query [m8o6kha01u9ikrfhye1]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.232Z"}
{"level":"debug","message":"Executing query [m8o6kha5fniccgnkvl5]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742888090181\"]","timestamp":"2025-03-25T07:34:50.238Z"}
{"level":"debug","message":"Executing query [m8o6khabiyn47rvx0i]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",21]","timestamp":"2025-03-25T07:34:50.243Z"}
{"level":"debug","message":"Executing query [m8o6khagqxaxiyg8dpo]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.248Z"}
{"level":"debug","message":"Executing query [m8o6khaju1f9byyt19f]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.251Z"}
{"level":"debug","message":"Executing query [m8o6khaw96qohk9ff6u]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.264Z"}
{"level":"debug","message":"Executing query [m8o6khb05rw1tseko6g]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.268Z"}
{"level":"debug","message":"Executing query [m8o6khb884m3dvl91pn]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.276Z"}
{"level":"debug","message":"Executing query [m8o6khbbfgtdhkfrc]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742888090279\",\"TEST-SP-OFICIO-1742888090279\",5435,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:34:50.279Z"}
{"level":"debug","message":"Executing query [m8o6khbi68edywlkj1k]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742888090279\"]","timestamp":"2025-03-25T07:34:50.286Z"}
{"level":"debug","message":"Executing query [m8o6khbkwsfl7cjk72]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742888090279\"]","timestamp":"2025-03-25T07:34:50.288Z"}
{"level":"debug","message":"Executing query [m8o6khboffbu2kx2u7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:50.292Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:50.294Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:50.282Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:34:50.217Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:34:50.358Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:34:50.368Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:34:50.368Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:34:50.371Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:34:50.380Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:34:50.380Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Executing query [m8o6khcznxn9lpgiu2]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:50.339Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:50.418Z"}
{"level":"debug","message":"Executing query [m8o6khfasap2vczmgq8]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:50.423Z"}
{"level":"debug","message":"Executing query [m8o6khfgfx0tf1gf92a]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742888090337\"]","timestamp":"2025-03-25T07:34:50.428Z"}
{"level":"debug","message":"Executing query [m8o6khfj1yec1miu8d3]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742888090337\",\"TEST-OFI-FORENSE-1742888090337\",4455,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742888090337\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:34:50.431Z"}
{"level":"debug","message":"Executing query [m8o6khfvue2okgt2b6]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.443Z"}
{"level":"debug","message":"Executing query [m8o6khg2um0lgi8zc4o]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742888090337\"]","timestamp":"2025-03-25T07:34:50.450Z"}
{"level":"debug","message":"Executing query [m8o6khg7vjiy09q8qps]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",21]","timestamp":"2025-03-25T07:34:50.456Z"}
{"level":"debug","message":"Executing query [m8o6khghhdcl55lhi9h]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.465Z"}
{"level":"debug","message":"Executing query [m8o6khgmd3tru6lfhle]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.470Z"}
{"level":"debug","message":"Executing query [m8o6khgq43enbct4ekg]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.474Z"}
{"level":"debug","message":"Executing query [m8o6khgtq59fnxdelx]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.477Z"}
{"level":"debug","message":"Executing query [m8o6khgzfg488ztsoe4]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.483Z"}
{"level":"debug","message":"Executing query [m8o6khh3vxtarxc87cg]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742888090487\",\"TEST-SP-OFI-FORENSE-1742888090487\",7587,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:34:50.487Z"}
{"level":"debug","message":"Executing query [m8o6khh78grrik1sro]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742888090487\"]","timestamp":"2025-03-25T07:34:50.491Z"}
{"level":"debug","message":"Executing query [m8o6khha8kyzly6cgb5]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742888090487\"]","timestamp":"2025-03-25T07:34:50.494Z"}
{"level":"debug","message":"Executing query [m8o6khhepzpwigxs6l]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:50.498Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:50.501Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:50.938Z"}
{"level":"debug","message":"Executing query [m8o6khtrny7sjdo8y2b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:50.943Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:50.963Z"}
{"level":"debug","message":"Executing query [m8o6khud5p890cyvxm4]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:34:50.966Z"}
{"level":"debug","message":"Executing query [m8o6khufon1wgs4x7p]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:34:50.968Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:34:50.970Z"}
{"level":"debug","message":"Executing query [m8o6khuibpki6puwbs5]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:34:50.970Z"}
{"level":"debug","message":"Executing query [m8o6khujqd3we6qh59p]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:34:50.972Z"}
{"level":"debug","message":"Executing query [m8o6khummvhskzvikv]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:34:50.974Z"}
{"level":"debug","message":"Executing query [m8o6khv3ecjicdogso9]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.991Z"}
{"level":"debug","message":"Executing query [m8o6khvdaxh1ghxhqwd]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.001Z"}
{"level":"debug","message":"Executing query [m8o6khvjj9l65x76d6]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",21]","timestamp":"2025-03-25T07:34:51.007Z"}
{"level":"debug","message":"Executing query [m8o6khvpf857rr6eb4]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.013Z"}
{"level":"debug","message":"Executing query [m8o6khvtmnc1unbf6lc]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.017Z"}
{"level":"debug","message":"Executing query [m8o6khvz35ifaluk8rc]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.023Z"}
{"level":"debug","message":"Executing query [m8o6khw18elmmojno4y]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:51.026Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:51.036Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:51.131Z"}
{"level":"debug","message":"Executing query [m8o6ki19hobdi7zo8sc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:51.214Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:51.153Z"}
{"level":"debug","message":"Executing query [m8o6ki4e30x003xzfj6]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742888091210\"]","timestamp":"2025-03-25T07:34:51.327Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:51.331Z"}
{"level":"debug","message":"Executing query [m8o6ki4nj99kcawht]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742888091210\",true]","timestamp":"2025-03-25T07:34:51.335Z"}
{"level":"debug","message":"Executing query [m8o6ki51zyr2ni7q83d]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.349Z"}
{"level":"debug","message":"Executing query [m8o6ki58rzkaisn0t88]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742888091210\"]","timestamp":"2025-03-25T07:34:51.356Z"}
{"level":"debug","message":"Executing query [m8o6ki5bxuc0fgmo32o]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",21]","timestamp":"2025-03-25T07:34:51.359Z"}
{"level":"debug","message":"Executing query [m8o6ki5h69godxwc67n]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.365Z"}
{"level":"debug","message":"Executing query [m8o6ki5kazxtvc3m3rm]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.368Z"}
{"level":"debug","message":"Executing query [m8o6ki5s2z5hx6e2u8y]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.377Z"}
{"level":"debug","message":"Executing query [m8o6ki5ykarh4wgr9p]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.382Z"}
{"level":"debug","message":"Executing query [m8o6ki62upmytegjdnk]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.386Z"}
{"level":"debug","message":"Executing query [m8o6ki69o7kekni9n9b]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.394Z"}
{"level":"debug","message":"Executing query [m8o6ki6c7ctocpa1nl7]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:34:51.396Z"}
{"level":"debug","message":"Executing query [m8o6ki6eqsny3x6bl4]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:51.399Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:51.404Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:51.537Z"}
{"level":"debug","message":"Executing query [m8o6kiae66bd3u9bs2m]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:51.543Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:51.596Z"}
{"level":"debug","message":"Executing query [m8o6kic0cb0qc8nmgyt]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:51.600Z"}
{"level":"debug","message":"Executing query [m8o6kicdqqgeef3hg5d]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742888091540\"]","timestamp":"2025-03-25T07:34:51.613Z"}
{"level":"debug","message":"Executing query [m8o6kichlnfwmbmp24o]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742888091540\",\"TEST-OFI-QUIMICA-1742888091540\",6828,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:34:51.617Z"}
{"level":"debug","message":"Executing query [m8o6kicqvjoalr2suv]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.626Z"}
{"level":"debug","message":"Executing query [m8o6kicuz9gaap8m3o]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742888091540\"]","timestamp":"2025-03-25T07:34:51.630Z"}
{"level":"debug","message":"Executing query [m8o6kicy86k5lbctc6h]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",11]","timestamp":"2025-03-25T07:34:51.634Z"}
{"level":"debug","message":"Executing query [m8o6kid3eo71t6n61p]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.640Z"}
{"level":"debug","message":"Executing query [m8o6kid7d3xhn8z4qj]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.643Z"}
{"level":"debug","message":"Executing query [m8o6kidc9dhhltktuy]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.648Z"}
{"level":"debug","message":"Executing query [m8o6kidi2m4jzwwq0vf]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.654Z"}
{"level":"debug","message":"Executing query [m8o6kidrh9ymdew1ydt]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.664Z"}
{"level":"debug","message":"Executing query [m8o6kidwpupn0tzfq2]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:51.668Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:51.671Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:51.540Z"}
{"level":"debug","message":"Executing query [m8o6kid9aa2rq5nb4r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:51.645Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:51.762Z"}
{"level":"debug","message":"Executing query [m8o6kigoejq975p1jy]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:34:51.768Z"}
{"level":"debug","message":"Executing query [m8o6kihgwii5iljg35]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:34:51.796Z"}
{"level":"debug","message":"Executing query [m8o6kihpwmb908zw2t]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:34:51.805Z"}
{"level":"debug","message":"Executing query [m8o6kihsd7vna2v594n]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:34:51.808Z"}
{"level":"debug","message":"Executing query [m8o6kii18uefircw8vr]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:34:51.817Z"}
{"level":"debug","message":"Executing query [m8o6kii6jxvjxbqo7ra]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[22,888,22,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:34:51.822Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:34:51.822Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 22, Área ID: 888, Rol ID: 888, Documento ID: 21","timestamp":"2025-03-25T07:34:51.827Z"}
{"level":"debug","message":"Executing query [m8o6kiicof4i9kxe8os]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[21,22,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:34:51.828Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6kiicof4i9kxe8os]","params":"[21,22,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:34:51.838Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:34:51.839Z"}
{"level":"debug","message":"Executing query [m8o6kiin4hikcavqjhd]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.839Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6kiin4hikcavqjhd]","params":"[21]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:34:51.846Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:34:51.847Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:34:51.847Z"}
{"level":"debug","message":"Executing query [m8o6kiiwxw2vh7cltaq]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[21,22,\"RESTAURAR\"]","timestamp":"2025-03-25T07:34:51.848Z"}
{"level":"debug","message":"Executing query [m8o6kij9rpcvwfcajfc]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.861Z"}
{"level":"debug","message":"Executing query [m8o6kijgo08c71w8369]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[21,22,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:34:51.868Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6kijgo08c71w8369]","params":"[21,22,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:34:51.873Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:34:51.873Z"}
{"level":"debug","message":"Executing query [m8o6kijmfpysotzw91]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.874Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6kijmfpysotzw91]","params":"[21]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:34:51.877Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:34:51.877Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:34:51.877Z"}
{"level":"debug","message":"Executing query [m8o6kijsd38abv6v6aj]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[22,888,22,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:34:51.880Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:34:51.880Z"}
{"level":"debug","message":"Executing query [m8o6kijzz7t158io9gr]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:34:51.887Z"}
{"level":"debug","message":"Executing query [m8o6kik34wy3cp9d57]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[22,\"DOCUMENTO\",22,\"ELIMINAR\"]","timestamp":"2025-03-25T07:34:51.891Z"}
{"level":"debug","message":"Executing query [m8o6kik8pyk8r1nxmxk]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[22]","timestamp":"2025-03-25T07:34:51.896Z"}
{"level":"debug","message":"Executing query [m8o6kikegrqfvpwyo0m]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:34:51.902Z"}
{"level":"debug","message":"Executing query [m8o6kikk6qto492n3z]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[22]","timestamp":"2025-03-25T07:34:51.908Z"}
{"level":"debug","message":"Executing query [m8o6kikqirvrq9eilnp]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:34:51.914Z"}
{"level":"debug","message":"Executing query [m8o6kiks6gl5op035ie]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:34:51.916Z"}
{"level":"debug","message":"Executing query [m8o6kikuh816om944x]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:34:51.918Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:34:51.924Z"}
{"level":"debug","message":"Executing query [m8o6kil0ajdu6h8pgg7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:51.924Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:51.927Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:52.160Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:52.198Z"}
{"level":"debug","message":"Executing query [m8o6kissbuexrzrk6h5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:52.204Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:52.270Z"}
{"level":"debug","message":"Executing query [m8o6kiun9yb4n24kksi]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:34:52.271Z"}
{"level":"debug","message":"Executing query [m8o6kiuqusjvyinotxc]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:34:52.274Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:34:52.276Z"}
{"level":"debug","message":"Executing query [m8o6kiuslsvv3efyipd]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.276Z"}
{"level":"debug","message":"Executing query [m8o6kiuuvoiffzpk07]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.278Z"}
{"level":"debug","message":"Executing query [m8o6kiuxoaespwcq65]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.281Z"}
{"level":"debug","message":"Executing query [m8o6kiv19ltqb76c08n]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:34:52.285Z"}
{"level":"debug","message":"Executing query [m8o6kiv8ggerv6yprld]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[23]","timestamp":"2025-03-25T07:34:52.292Z"}
{"level":"debug","message":"Executing query [m8o6kivcnbj9vzydwc]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.296Z"}
{"level":"debug","message":"Executing query [m8o6kivf0mcfffstqkf]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",23]","timestamp":"2025-03-25T07:34:52.299Z"}
{"level":"debug","message":"Executing query [m8o6kivkzm59mejb148]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[23]","timestamp":"2025-03-25T07:34:52.304Z"}
{"level":"debug","message":"Executing query [m8o6kivpu238k147mds]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[23]","timestamp":"2025-03-25T07:34:52.309Z"}
{"level":"debug","message":"Executing query [m8o6kivvsl5n4io7ay]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[23]","timestamp":"2025-03-25T07:34:52.315Z"}
{"level":"debug","message":"Executing query [m8o6kivza74gaw8swic]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.319Z"}
{"level":"debug","message":"Executing query [m8o6kiw1bngghukdytt]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.321Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:34:52.324Z"}
{"level":"debug","message":"Executing query [m8o6kiw51vrqohq674w]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:52.325Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:52.326Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:52.036Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:34:52.608Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:34:52.645Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:52.950Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:34:52.965Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:53.071Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:53.334Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:34:53.620Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:53.808Z"}
{"level":"debug","message":"Executing query [m8o6kk2k3wdr181r977]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:34:53.852Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:53.918Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:54.564Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:54.796Z"}
{"duration":"33ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:34:54.799Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:34:54.810Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:54.820Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:54.807Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:55.006Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:34:55.008Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:43:21.446Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.620Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.641Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.645Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.648Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.651Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.654Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.656Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:52:49.660Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:52:49.662Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:52:49.664Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:52:49.665Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:52:49.667Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.101Z"}
{"level":"debug","message":"Executing query [m8o77mk0u5tqays8k5d]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:50.160Z"}
{"level":"debug","message":"Executing query [m8o77mlrn74nlg2j4xo]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889170156\"]","timestamp":"2025-03-25T07:52:50.224Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:50.226Z"}
{"level":"debug","message":"Executing query [m8o77mmmrleo18ufxe]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889170156\"]","timestamp":"2025-03-25T07:52:50.254Z"}
{"level":"debug","message":"Executing query [m8o77mmpcziuu8tlfb5]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742889170156\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:52:50.257Z"}
{"level":"debug","message":"Executing query [m8o77mmza3hkw97cvdn]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.267Z"}
{"level":"debug","message":"Executing query [m8o77mn4ht3a6hmpa7]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889170156\"]","timestamp":"2025-03-25T07:52:50.272Z"}
{"level":"debug","message":"Executing query [m8o77mnae24ohu0od]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1010]","timestamp":"2025-03-25T07:52:50.278Z"}
{"level":"debug","message":"Executing query [m8o77mnj24fq56u29ff]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.287Z"}
{"level":"debug","message":"Executing query [m8o77mnnlgd9l0sp89]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.292Z"}
{"level":"debug","message":"Executing query [m8o77mnse2d2yf0a87i]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.296Z"}
{"level":"debug","message":"Executing query [m8o77mnvmbrxdmqkg6]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.300Z"}
{"level":"debug","message":"Executing query [m8o77mnyw94r31a9tf]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.302Z"}
{"level":"debug","message":"Executing query [m8o77mo3fuaufmwblcq]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.307Z"}
{"level":"debug","message":"Executing query [m8o77mo6c9qtnvw5f8h]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:52:50.310Z"}
{"level":"debug","message":"Executing query [m8o77mo8cughvvzyt45]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:50.312Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:50.315Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.289Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.361Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:50.477Z"}
{"level":"debug","message":"Executing query [m8o77msyujl9fgl40ne]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:52:50.482Z"}
{"level":"debug","message":"Executing query [m8o77mt2p5nu385qss8]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:52:50.486Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o77mt2p5nu385qss8]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:52:50.491Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:50.494Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.517Z"}
{"level":"debug","message":"Executing query [m8o77mvg83o5zzeqiy]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:50.573Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:50.641Z"}
{"level":"debug","message":"Executing query [m8o77mxhz6uogh2wieh]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:52:50.645Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:52:50.651Z"}
{"level":"debug","message":"Executing query [m8o77mxo9g9196fhekl]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:52:50.652Z"}
{"level":"debug","message":"Executing query [m8o77mxq77txieaydu3]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:52:50.654Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:52:50.656Z"}
{"level":"debug","message":"Executing query [m8o77mxt96ssdlibtgl]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:52:50.657Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:52:50.660Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:52:50.551Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.446Z"}
{"level":"debug","message":"Executing query [m8o77n03fnhbogiaqri]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:52:50.739Z"}
{"level":"debug","message":"Executing query [m8o77n0igwrgb9gxmi]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:52:50.755Z"}
{"level":"debug","message":"Executing query [m8o77n0lv685jraeue]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[21]","timestamp":"2025-03-25T07:52:50.757Z"}
{"level":"debug","message":"Executing query [m8o77n0r8mwnkx9stsy]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:50.763Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.842Z"}
{"level":"debug","message":"Executing query [m8o77n55yriod4vra4b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:50.921Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.934Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:52:50.825Z"}
{"level":"debug","message":"Executing query [m8o77n5vp4reh4ura7]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:50.947Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:50.978Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:50.982Z"}
{"level":"debug","message":"Executing query [m8o77n6ta4ucmolula9]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:52:50.981Z"}
{"level":"debug","message":"Executing query [m8o77n6wj0d11rx9qhf]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889170944\"]","timestamp":"2025-03-25T07:52:50.984Z"}
{"level":"debug","message":"Executing query [m8o77n70gf14vgsk8zw]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742889170944\",\"TEST-OFI-FORENSE-1742889170944\",3680,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742889170944\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:52:50.988Z"}
{"level":"debug","message":"Executing query [m8o77n78h5b91ul4n5a]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:50.996Z"}
{"level":"debug","message":"Executing query [m8o77n6zen3gvm5b5pm]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:52:50.987Z"}
{"level":"debug","message":"Executing query [m8o77n76ey3jy1vg0jc]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889170919\"]","timestamp":"2025-03-25T07:52:50.994Z"}
{"level":"debug","message":"Executing query [m8o77n7d1udqmrcknau]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889170944\"]","timestamp":"2025-03-25T07:52:51.001Z"}
{"level":"debug","message":"Executing query [m8o77n7cmnew1guw4wh]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742889170919\",\"TEST-OFICIO-1742889170919\",5914,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:52:51.000Z"}
{"level":"debug","message":"Executing query [m8o77n7lfno6go2vyd]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.009Z"}
{"level":"debug","message":"Executing query [m8o77n7mnmetmw5rujb]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",23]","timestamp":"2025-03-25T07:52:51.011Z"}
{"level":"debug","message":"Executing query [m8o77n7svggw1y0dmr]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.017Z"}
{"level":"debug","message":"Executing query [m8o77n7shsx6lau73w8]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889170919\"]","timestamp":"2025-03-25T07:52:51.016Z"}
{"level":"debug","message":"Executing query [m8o77n7v6jrdvw8a4rx]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.019Z"}
{"level":"debug","message":"Executing query [m8o77n7vflvglty1q77]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",23]","timestamp":"2025-03-25T07:52:51.019Z"}
{"level":"debug","message":"Executing query [m8o77n7z031h17veihly]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.023Z"}
{"level":"debug","message":"Executing query [m8o77n80likm4eaqh1]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.024Z"}
{"level":"debug","message":"Executing query [m8o77n82fbcrzehgv7k]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.026Z"}
{"level":"debug","message":"Executing query [m8o77n8413psfx2og23]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.028Z"}
{"level":"debug","message":"Executing query [m8o77n86d3gx76tceks]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.030Z"}
{"level":"debug","message":"Executing query [m8o77n89xtq92py16wo]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.033Z"}
{"level":"debug","message":"Executing query [m8o77n8ayocf528btw]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742889171034\",\"TEST-SP-OFI-FORENSE-1742889171034\",3310,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:52:51.034Z"}
{"level":"debug","message":"Executing query [m8o77n8dzruaojl6849]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.037Z"}
{"level":"debug","message":"Executing query [m8o77n8hgz7teju4c9n]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889171034\"]","timestamp":"2025-03-25T07:52:51.041Z"}
{"level":"debug","message":"Executing query [m8o77n8ioflr2ite84q]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.042Z"}
{"level":"debug","message":"Executing query [m8o77n8j8h95qkzyh8j]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889171034\"]","timestamp":"2025-03-25T07:52:51.043Z"}
{"level":"debug","message":"Executing query [m8o77n8lsuacfd92xai]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742889171045\",\"TEST-SP-OFICIO-1742889171045\",7864,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:52:51.045Z"}
{"level":"debug","message":"Executing query [m8o77n8n9pnqpih3zh]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:51.047Z"}
{"level":"debug","message":"Executing query [m8o77n8p5ug9nqih89t]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889171045\"]","timestamp":"2025-03-25T07:52:51.049Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:51.049Z"}
{"level":"debug","message":"Executing query [m8o77n8rrmjvzosf7zi]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889171045\"]","timestamp":"2025-03-25T07:52:51.051Z"}
{"level":"debug","message":"Executing query [m8o77n8yz1wbyv3z8vr]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:51.058Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:51.061Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:52:51.199Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:52:51.201Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:52:51.202Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:52:51.203Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:52:51.207Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:52:51.207Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:51.785Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:51.724Z"}
{"level":"debug","message":"Executing query [m8o77nt9iyk0ohwqyl]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:51.789Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:51.808Z"}
{"level":"debug","message":"Executing query [m8o77ntwx867v5avzwa]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:52:51.812Z"}
{"level":"debug","message":"Executing query [m8o77ntz2po2nrtaov6]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:52:51.815Z"}
{"level":"debug","message":"Executing query [m8o77nu38600aw128ue]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:52:51.819Z"}
{"level":"debug","message":"Executing query [m8o77nu7cg2puqb71vo]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:52:51.823Z"}
{"level":"debug","message":"Executing query [m8o77nuc96o5s1zg1uw]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:52:51.828Z"}
{"level":"debug","message":"Executing query [m8o77nulog579tmidk]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[23,888,24,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:52:51.837Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:52:51.838Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 24, Área ID: 888, Rol ID: 888, Documento ID: 23","timestamp":"2025-03-25T07:52:51.843Z"}
{"level":"debug","message":"Executing query [m8o77nut5f0smku01t5]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[23,24,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:52:51.845Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o77nut5f0smku01t5]","params":"[23,24,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:52:51.855Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:52:51.855Z"}
{"level":"debug","message":"Executing query [m8o77nv379hjyv1r6h]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.855Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o77nv379hjyv1r6h]","params":"[23]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:52:51.860Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:52:51.860Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:52:51.860Z"}
{"level":"debug","message":"Executing query [m8o77nv9bnjlbdgrhgd]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[23,24,\"RESTAURAR\"]","timestamp":"2025-03-25T07:52:51.861Z"}
{"level":"debug","message":"Executing query [m8o77nvhvrpo3jcyqm]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.869Z"}
{"level":"debug","message":"Executing query [m8o77nvltewgi46gpba]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[23,24,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:52:51.873Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o77nvltewgi46gpba]","params":"[23,24,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:52:51.881Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:52:51.881Z"}
{"level":"debug","message":"Executing query [m8o77nvugc1cls0bsx]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.882Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o77nvugc1cls0bsx]","params":"[23]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:52:51.884Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:52:51.885Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:52:51.885Z"}
{"level":"debug","message":"Executing query [m8o77nvyvdqm2fb22t]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[23,888,24,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:52:51.886Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:52:51.886Z"}
{"level":"debug","message":"Executing query [m8o77nw1rz96f34sux]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:52:51.889Z"}
{"level":"debug","message":"Executing query [m8o77ntbpwpiahp41u8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:51.791Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:51.892Z"}
{"level":"debug","message":"Executing query [m8o77nw6kln4dzp7x6t]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[24,\"DOCUMENTO\",24,\"ELIMINAR\"]","timestamp":"2025-03-25T07:52:51.894Z"}
{"level":"debug","message":"Executing query [m8o77nway3b7g9lujg]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889171790\"]","timestamp":"2025-03-25T07:52:51.898Z"}
{"level":"debug","message":"Executing query [m8o77nwdk49z90up96]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742889171790\",true]","timestamp":"2025-03-25T07:52:51.901Z"}
{"level":"debug","message":"Executing query [m8o77nwbtugcuzvdsw]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.899Z"}
{"level":"debug","message":"Executing query [m8o77nwqb35c944xyv]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:52:51.914Z"}
{"level":"debug","message":"Executing query [m8o77nws646awir6x9]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.917Z"}
{"level":"debug","message":"Executing query [m8o77nwusggiccw9oed]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.918Z"}
{"level":"debug","message":"Executing query [m8o77nwxluq57dob4es]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:52:51.921Z"}
{"level":"debug","message":"Executing query [m8o77nwyt0dg2n2bzde]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889171790\"]","timestamp":"2025-03-25T07:52:51.922Z"}
{"level":"debug","message":"Executing query [m8o77nwzdus4iu0strq]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:52:51.923Z"}
{"level":"debug","message":"Executing query [m8o77nx1sdzob6ymst]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:52:51.925Z"}
{"level":"debug","message":"Executing query [m8o77nx1i6xeszu4hn]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",24]","timestamp":"2025-03-25T07:52:51.925Z"}
{"level":"debug","message":"Executing query [m8o77nx5titbgxamon]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.929Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:52:51.929Z"}
{"level":"debug","message":"Executing query [m8o77nx9ohao0j8pgi]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.933Z"}
{"level":"debug","message":"Executing query [m8o77nx63mnxqi1lolu]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:51.930Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:51.932Z"}
{"level":"debug","message":"Executing query [m8o77nxdemvxl1fyjnw]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.937Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:51.858Z"}
{"level":"debug","message":"Executing query [m8o77nxhcbjnggqkvof]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.941Z"}
{"level":"debug","message":"Executing query [m8o77nw3owhgskayjo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:51.891Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:51.940Z"}
{"level":"debug","message":"Executing query [m8o77nxjeancjdbtgq]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:52:51.943Z"}
{"level":"debug","message":"Executing query [m8o77nxk01vas626p3pz]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.945Z"}
{"level":"debug","message":"Executing query [m8o77nxm7z5j4i1cp7r]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:52:51.946Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:52:51.949Z"}
{"level":"debug","message":"Executing query [m8o77nxqiecvr4tv7e]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.951Z"}
{"level":"debug","message":"Executing query [m8o77nxr66kcf7shvpr]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:52:51.951Z"}
{"level":"debug","message":"Executing query [m8o77nxtk9qiw3i4d6o]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:52:51.953Z"}
{"level":"debug","message":"Executing query [m8o77nxuryi7ekpoq9]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:52:51.954Z"}
{"level":"debug","message":"Executing query [m8o77nxvrgxh3zfneh]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:51.955Z"}
{"level":"debug","message":"Executing query [m8o77nxwi38b7humsy]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:52:51.956Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:51.960Z"}
{"level":"debug","message":"Executing query [m8o77ny194dczt1rwas]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.961Z"}
{"level":"debug","message":"Executing query [m8o77ny5m44je58jrec]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.965Z"}
{"level":"debug","message":"Executing query [m8o77nyattxa6yw6iml]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",24]","timestamp":"2025-03-25T07:52:51.970Z"}
{"level":"debug","message":"Executing query [m8o77nyh45e3u49i3i4]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.977Z"}
{"level":"debug","message":"Executing query [m8o77nykso3mupssvs9]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.980Z"}
{"level":"debug","message":"Executing query [m8o77nynpaja8gs1fkr]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.983Z"}
{"level":"debug","message":"Executing query [m8o77nypmt8x0eztdf]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:51.985Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:51.987Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:52.240Z"}
{"level":"debug","message":"Executing query [m8o77o5vlo8erhuipa]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:52.243Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:52.268Z"}
{"level":"debug","message":"Executing query [m8o77o6mawkyesuo4eb]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:52:52.270Z"}
{"level":"debug","message":"Executing query [m8o77o6qv2cnj9hlko]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889172242\"]","timestamp":"2025-03-25T07:52:52.274Z"}
{"level":"debug","message":"Executing query [m8o77o6tplsl1k4aljg]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742889172242\",\"TEST-OFI-QUIMICA-1742889172242\",307,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:52:52.277Z"}
{"level":"debug","message":"Executing query [m8o77o71bw6wqysn48r]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.285Z"}
{"level":"debug","message":"Executing query [m8o77o75wt6ekje4mg]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889172242\"]","timestamp":"2025-03-25T07:52:52.289Z"}
{"level":"debug","message":"Executing query [m8o77o78kdkrxbrgi57]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",12]","timestamp":"2025-03-25T07:52:52.292Z"}
{"level":"debug","message":"Executing query [m8o77o7bzo596bw6lxr]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.295Z"}
{"level":"debug","message":"Executing query [m8o77o7ffj44vk3oide]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.299Z"}
{"level":"debug","message":"Executing query [m8o77o7kpmn7hgx7xpr]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.304Z"}
{"level":"debug","message":"Executing query [m8o77o7n332t4k5d9cw]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.307Z"}
{"level":"debug","message":"Executing query [m8o77o7r0llg3jgaxuu]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.311Z"}
{"level":"debug","message":"Executing query [m8o77o7tg3u21e4nhlw]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:52.313Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:52.315Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:51.751Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:52:52.463Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:52:52.501Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:52.854Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:52:52.905Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:52.721Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:52.996Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:53.049Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:53.063Z"}
{"level":"debug","message":"Executing query [m8o77osqlmy26ims3qp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:53.066Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:53.097Z"}
{"level":"debug","message":"Executing query [m8o77otrxfm1zh9hsf]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:52:53.103Z"}
{"level":"debug","message":"Executing query [m8o77ottzsv9a7j77o]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:52:53.105Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:52:53.106Z"}
{"level":"debug","message":"Executing query [m8o77otufn9p1kmx9n4]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.106Z"}
{"level":"debug","message":"Executing query [m8o77otwgxo85pwmiae]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.108Z"}
{"level":"debug","message":"Executing query [m8o77otye2t23rcwbbt]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.110Z"}
{"level":"debug","message":"Executing query [m8o77otzii244dy2wco]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:52:53.111Z"}
{"level":"debug","message":"Executing query [m8o77ou54wi4r5xfuca]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[25]","timestamp":"2025-03-25T07:52:53.117Z"}
{"level":"debug","message":"Executing query [m8o77ou9mok26no24w]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.121Z"}
{"level":"debug","message":"Executing query [m8o77oue7dqwzt0keba]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",25]","timestamp":"2025-03-25T07:52:53.126Z"}
{"level":"debug","message":"Executing query [m8o77oui6rwf8u5j7gt]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[25]","timestamp":"2025-03-25T07:52:53.131Z"}
{"level":"debug","message":"Executing query [m8o77oulf5n1gq841jt]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[25]","timestamp":"2025-03-25T07:52:53.133Z"}
{"level":"debug","message":"Executing query [m8o77ouowiuwtovu2z]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[25]","timestamp":"2025-03-25T07:52:53.137Z"}
{"level":"debug","message":"Executing query [m8o77ournzfqqnr3rth]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.139Z"}
{"level":"debug","message":"Executing query [m8o77ouszk3jhsuhc9g]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.140Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:52:53.141Z"}
{"level":"debug","message":"Executing query [m8o77ouuizbcl1bj6mk]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:53.142Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:53.143Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:53.798Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:52:53.958Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:54.056Z"}
{"level":"debug","message":"Executing query [m8o77pljffxrncb625]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:52:54.103Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:54.142Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:54.531Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:54.566Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:54.700Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:52:54.702Z"}
{"duration":"30ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:52:54.725Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:54.727Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:52:54.731Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:54.735Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:17.726Z"}
{"level":"debug","message":"Executing query [m8o787uinfw6voj0z1]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:17.754Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:17.789Z"}
{"level":"debug","message":"Executing query [m8o787vjewdi1s9nuc]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889197753\"]","timestamp":"2025-03-25T07:53:17.791Z"}
{"level":"debug","message":"Executing query [m8o787vma4erz4u778b]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889197753\"]","timestamp":"2025-03-25T07:53:17.794Z"}
{"level":"debug","message":"Executing query [m8o787vnnt86jesde6n]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742889197753\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:53:17.795Z"}
{"level":"debug","message":"Executing query [m8o787vrkpgjyhu6vxs]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.799Z"}
{"level":"debug","message":"Executing query [m8o787vv2jx46ylnl9q]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889197753\"]","timestamp":"2025-03-25T07:53:17.803Z"}
{"level":"debug","message":"Executing query [m8o787vxa0d1pg50gu9]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1011]","timestamp":"2025-03-25T07:53:17.805Z"}
{"level":"debug","message":"Executing query [m8o787w1xkys4kecv9k]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.809Z"}
{"level":"debug","message":"Executing query [m8o787w2dxzxjk4ku1q]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.811Z"}
{"level":"debug","message":"Executing query [m8o787w6mwni1zi17sm]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.814Z"}
{"level":"debug","message":"Executing query [m8o787w8hjtjapmdm38]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.816Z"}
{"level":"debug","message":"Executing query [m8o787wagx63yy3v8q]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.818Z"}
{"level":"debug","message":"Executing query [m8o787wcsgxxjrvtfec]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.820Z"}
{"level":"debug","message":"Executing query [m8o787wdgymtc7gg1gu]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:53:17.821Z"}
{"level":"debug","message":"Executing query [m8o787wfttombbu1ouq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:17.823Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:17.824Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.916Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.918Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.920Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.922Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.926Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.928Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.929Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:53:17.932Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:53:17.933Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:53:17.935Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:53:17.937Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:53:17.939Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:18.132Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:19.202Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:53:19.377Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:53:19.382Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:19.435Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:53:19.453Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:19.501Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:19.970Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:20.219Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:20.235Z"}
{"level":"debug","message":"Executing query [m8o789rhcwv6lod38u6]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:53:20.237Z"}
{"level":"debug","message":"Executing query [m8o789rkqwhrwhnwbdi]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:53:20.240Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o789rkqwhrwhnwbdi]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:53:20.246Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:20.249Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:20.359Z"}
{"level":"debug","message":"Executing query [m8o789uz06wqvm9j84kg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:20.363Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:20.381Z"}
{"level":"debug","message":"Executing query [m8o789vj53vg04olb6f]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:53:20.383Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:53:20.384Z"}
{"level":"debug","message":"Executing query [m8o789vloynnb3l4ca]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:53:20.385Z"}
{"level":"debug","message":"Executing query [m8o789vm9d3yxjp4v]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:53:20.386Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:53:20.388Z"}
{"level":"debug","message":"Executing query [m8o789vojt0jqfsuoaf]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:53:20.388Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:53:20.390Z"}
{"level":"debug","message":"Executing query [m8o789vvo44x24i9wm]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:53:20.395Z"}
{"level":"debug","message":"Executing query [m8o789vytg1vi1c677s]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:53:20.398Z"}
{"level":"debug","message":"Executing query [m8o789w12wkwyebcsl7]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[23]","timestamp":"2025-03-25T07:53:20.401Z"}
{"level":"debug","message":"Executing query [m8o789w54n2fsb6h2im]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:20.405Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:22.271Z"}
{"duration":"6ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:53:22.334Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:53:22.338Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:22.344Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:53:22.346Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:53:22.439Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:53:22.537Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:22.671Z"}
{"level":"debug","message":"Executing query [m8o78bn6xmzbmlkcd99]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:22.674Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:22.692Z"}
{"level":"debug","message":"Executing query [m8o78bnqmi16ic3dldj]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:53:22.695Z"}
{"level":"debug","message":"Executing query [m8o78bnts388uk5tyro]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889202673\"]","timestamp":"2025-03-25T07:53:22.697Z"}
{"level":"debug","message":"Executing query [m8o78bnuiwodjhqmu2]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742889202673\",\"TEST-OFICIO-1742889202673\",64,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:53:22.698Z"}
{"level":"debug","message":"Executing query [m8o78bo19zn83x059pv]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.705Z"}
{"level":"debug","message":"Executing query [m8o78bo5quwb8onelnk]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889202673\"]","timestamp":"2025-03-25T07:53:22.709Z"}
{"level":"debug","message":"Executing query [m8o78bo8b9wvv8v51v]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",25]","timestamp":"2025-03-25T07:53:22.712Z"}
{"level":"debug","message":"Executing query [m8o78bocsft2cuuxqas]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.716Z"}
{"level":"debug","message":"Executing query [m8o78bogmg5mpjp009]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.720Z"}
{"level":"debug","message":"Executing query [m8o78bom07o9vsy1oscj]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.726Z"}
{"level":"debug","message":"Executing query [m8o78bopgu8xjwg1mkt]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.729Z"}
{"level":"debug","message":"Executing query [m8o78bosxxaxbihxm7]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.732Z"}
{"level":"debug","message":"Executing query [m8o78bou6g7fzu9czmi]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742889202734\",\"TEST-SP-OFICIO-1742889202734\",17,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:53:22.734Z"}
{"level":"debug","message":"Executing query [m8o78bozjeehlpngfhl]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889202734\"]","timestamp":"2025-03-25T07:53:22.739Z"}
{"level":"debug","message":"Executing query [m8o78bp1zpto71z7jjl]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889202734\"]","timestamp":"2025-03-25T07:53:22.741Z"}
{"level":"debug","message":"Executing query [m8o78bp5s226dh5p5q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:22.745Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:22.747Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:22.986Z"}
{"level":"debug","message":"Executing query [m8o78bvxe89f217vnn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:22.989Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:23.003Z"}
{"level":"debug","message":"Executing query [m8o78bwcbdbdw4mnqhm]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:53:23.004Z"}
{"level":"debug","message":"Executing query [m8o78bwfozemla5e7io]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889202988\"]","timestamp":"2025-03-25T07:53:23.007Z"}
{"level":"debug","message":"Executing query [m8o78bwgr4ng0wjs0ne]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742889202988\",\"TEST-OFI-FORENSE-1742889202988\",8730,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742889202988\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:53:23.008Z"}
{"level":"debug","message":"Executing query [m8o78bwlsm0iqvy4qd]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.013Z"}
{"level":"debug","message":"Executing query [m8o78bwqtlxl2nxdhbb]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889202988\"]","timestamp":"2025-03-25T07:53:23.019Z"}
{"level":"debug","message":"Executing query [m8o78bwtyn9g59g77gb]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",25]","timestamp":"2025-03-25T07:53:23.021Z"}
{"level":"debug","message":"Executing query [m8o78bwxa0t6vvci1q]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.025Z"}
{"level":"debug","message":"Executing query [m8o78bx0cszhf2ncakt]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.028Z"}
{"level":"debug","message":"Executing query [m8o78bx4ywx697s4vd]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.032Z"}
{"level":"debug","message":"Executing query [m8o78bx7xli2f9cdgrp]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.035Z"}
{"level":"debug","message":"Executing query [m8o78bxaj18bxpelgra]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.038Z"}
{"level":"debug","message":"Executing query [m8o78bxdhkpfiijereg]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742889203041\",\"TEST-SP-OFI-FORENSE-1742889203041\",6383,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:53:23.041Z"}
{"level":"debug","message":"Executing query [m8o78bxkk7wx2qeo4c]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889203041\"]","timestamp":"2025-03-25T07:53:23.048Z"}
{"level":"debug","message":"Executing query [m8o78bxmuerzi1hiu8]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889203041\"]","timestamp":"2025-03-25T07:53:23.050Z"}
{"level":"debug","message":"Executing query [m8o78bxr31b2tvj0dmf]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:23.055Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:23.058Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:24.082Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:24.216Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:53:24.221Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:53:24.358Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:53:24.359Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:53:24.359Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:53:24.360Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:53:24.360Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:53:24.360Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:24.872Z"}
{"level":"debug","message":"Executing query [m8o78dcba8kjk0kjlci]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:24.875Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:24.888Z"}
{"level":"debug","message":"Executing query [m8o78dcqfxtocejgz0f]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889204874\"]","timestamp":"2025-03-25T07:53:24.890Z"}
{"level":"debug","message":"Executing query [m8o78dcrghi3lla2o0t]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742889204874\",true]","timestamp":"2025-03-25T07:53:24.891Z"}
{"level":"debug","message":"Executing query [m8o78dd2fun17menl2l]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.902Z"}
{"level":"debug","message":"Executing query [m8o78dd6eo62bopuibj]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889204874\"]","timestamp":"2025-03-25T07:53:24.906Z"}
{"level":"debug","message":"Executing query [m8o78dd8tsaod545rn]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",25]","timestamp":"2025-03-25T07:53:24.908Z"}
{"level":"debug","message":"Executing query [m8o78ddg7w5lv0fyhoe]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.916Z"}
{"level":"debug","message":"Executing query [m8o78ddlzhdt7fm17i]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.921Z"}
{"level":"debug","message":"Executing query [m8o78ddq7kwcaih6nvx]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.926Z"}
{"level":"debug","message":"Executing query [m8o78ddto625v9gimt]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.929Z"}
{"level":"debug","message":"Executing query [m8o78ddvuldm66p884]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.931Z"}
{"level":"debug","message":"Executing query [m8o78ddzvfrrh7ebwk]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.935Z"}
{"level":"debug","message":"Executing query [m8o78de0zuq735syi6]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:53:24.937Z"}
{"level":"debug","message":"Executing query [m8o78de2ls4jbqa6z8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:24.938Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:24.939Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:25.195Z"}
{"level":"debug","message":"Executing query [m8o78dlamu4fcl5u0n8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:25.198Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:25.210Z"}
{"level":"debug","message":"Executing query [m8o78dln9a4uj9hje0e]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:53:25.211Z"}
{"level":"debug","message":"Executing query [m8o78dlp4yivi8fznvj]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:53:25.213Z"}
{"level":"debug","message":"Executing query [m8o78dlq2px30q1x7x7]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:53:25.214Z"}
{"level":"debug","message":"Executing query [m8o78dlsx7e23wclvfi]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:53:25.216Z"}
{"level":"debug","message":"Executing query [m8o78dlw6olrntuseyv]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:53:25.220Z"}
{"level":"debug","message":"Executing query [m8o78dlz6d7i86gla3c]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[26,888,26,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:53:25.223Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:53:25.223Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 26, Área ID: 888, Rol ID: 888, Documento ID: 25","timestamp":"2025-03-25T07:53:25.226Z"}
{"level":"debug","message":"Executing query [m8o78dm3ojf89bt7ej]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[25,26,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:53:25.227Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o78dm3ojf89bt7ej]","params":"[25,26,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:53:25.231Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:53:25.232Z"}
{"level":"debug","message":"Executing query [m8o78dm85c2da0559jq]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[25]","timestamp":"2025-03-25T07:53:25.232Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o78dm85c2da0559jq]","params":"[25]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:53:25.234Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:53:25.235Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:53:25.235Z"}
{"level":"debug","message":"Executing query [m8o78dmc2uovtx2ka5e]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[25,26,\"RESTAURAR\"]","timestamp":"2025-03-25T07:53:25.236Z"}
{"level":"debug","message":"Executing query [m8o78dmibg28srdrao]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[25]","timestamp":"2025-03-25T07:53:25.243Z"}
{"level":"debug","message":"Executing query [m8o78dmo4yim81sqpys]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[25,26,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:53:25.248Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o78dmo4yim81sqpys]","params":"[25,26,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:53:25.251Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:53:25.251Z"}
{"level":"debug","message":"Executing query [m8o78dms1ri1bizmx73]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[25]","timestamp":"2025-03-25T07:53:25.252Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o78dms1ri1bizmx73]","params":"[25]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:53:25.254Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:53:25.255Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:53:25.255Z"}
{"level":"debug","message":"Executing query [m8o78dmwxztw2xdsez]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[26,888,26,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:53:25.256Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:53:25.256Z"}
{"level":"debug","message":"Executing query [m8o78dn0bdr8adnpaw8]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:53:25.260Z"}
{"level":"debug","message":"Executing query [m8o78dn48f6jw27txv5]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[26,\"DOCUMENTO\",26,\"ELIMINAR\"]","timestamp":"2025-03-25T07:53:25.264Z"}
{"level":"debug","message":"Executing query [m8o78dn67vv1e6yydj9]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.266Z"}
{"level":"debug","message":"Executing query [m8o78dnal7rp51ea4pg]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:53:25.271Z"}
{"level":"debug","message":"Executing query [m8o78dne9tqwnzn21oj]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.274Z"}
{"level":"debug","message":"Executing query [m8o78dnh73emidqerwu]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:53:25.277Z"}
{"level":"debug","message":"Executing query [m8o78dniszcfmrr6yl]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:53:25.278Z"}
{"level":"debug","message":"Executing query [m8o78dnj7nimhm8dsep]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:53:25.279Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:53:25.282Z"}
{"level":"debug","message":"Executing query [m8o78dnnwko6jvyda4]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:25.283Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:25.284Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:25.408Z"}
{"level":"debug","message":"Executing query [m8o78dr7dd1at3rq60f]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:25.411Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:25.433Z"}
{"level":"debug","message":"Executing query [m8o78drvnz5jkd2dp8]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:53:25.435Z"}
{"level":"debug","message":"Executing query [m8o78drx2eowaq6xbdi]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:53:25.437Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:53:25.439Z"}
{"level":"debug","message":"Executing query [m8o78ds0liwpj6ibd5r]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:53:25.440Z"}
{"level":"debug","message":"Executing query [m8o78ds433xtjqz1os6]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:53:25.444Z"}
{"level":"debug","message":"Executing query [m8o78ds76w6kq2g2g6f]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:53:25.447Z"}
{"level":"debug","message":"Executing query [m8o78dsed7c7igkv63q]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.454Z"}
{"level":"debug","message":"Executing query [m8o78dsibqyhargua9]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.458Z"}
{"level":"debug","message":"Executing query [m8o78dsmllq352mt5q]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",26]","timestamp":"2025-03-25T07:53:25.462Z"}
{"level":"debug","message":"Executing query [m8o78dspvc521uc2du]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.465Z"}
{"level":"debug","message":"Executing query [m8o78dsrzdskornmsi]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.467Z"}
{"level":"debug","message":"Executing query [m8o78dsvcjj1pkct4d]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.471Z"}
{"level":"debug","message":"Executing query [m8o78dsxlol6nhpn30k]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:25.473Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:25.475Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:25.730Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:26.196Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:53:26.258Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:26.303Z"}
{"level":"debug","message":"Executing query [m8o78egwo5842x2masa]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:53:26.336Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:26.383Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:26.611Z"}
{"level":"debug","message":"Executing query [m8o78eole95kpc3a6nb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:26.613Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:26.626Z"}
{"level":"debug","message":"Executing query [m8o78ep0en4fpyqoait]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:53:26.628Z"}
{"level":"debug","message":"Executing query [m8o78ep2vtqmqwagvj]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889206613\"]","timestamp":"2025-03-25T07:53:26.630Z"}
{"level":"debug","message":"Executing query [m8o78ep3qwunu85sede]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742889206613\",\"TEST-OFI-QUIMICA-1742889206613\",13,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:53:26.631Z"}
{"level":"debug","message":"Executing query [m8o78epbkctk59lu1a]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.639Z"}
{"level":"debug","message":"Executing query [m8o78epe27l5cz03f8c]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889206613\"]","timestamp":"2025-03-25T07:53:26.642Z"}
{"level":"debug","message":"Executing query [m8o78ephhq3sb946xyo]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",13]","timestamp":"2025-03-25T07:53:26.645Z"}
{"level":"debug","message":"Executing query [m8o78epkill4qvf2ml]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.648Z"}
{"level":"debug","message":"Executing query [m8o78epmtc2giny8qpi]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.650Z"}
{"level":"debug","message":"Executing query [m8o78epp1r7z2y6p152]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.653Z"}
{"level":"debug","message":"Executing query [m8o78epqoo8012ufg3]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.654Z"}
{"level":"debug","message":"Executing query [m8o78ept1443rixvex9l]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.657Z"}
{"level":"debug","message":"Executing query [m8o78epvkxd8v6wwnb9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:26.659Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:26.660Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:27.241Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:27.245Z"}
{"level":"debug","message":"Executing query [m8o78f66cfy4qnqsmft]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:27.246Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:27.257Z"}
{"level":"debug","message":"Executing query [m8o78f6jiq7ijn92uz]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:53:27.259Z"}
{"level":"debug","message":"Executing query [m8o78f6ky7em0mal6uc]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:53:27.260Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:53:27.261Z"}
{"level":"debug","message":"Executing query [m8o78f6loqbyslfna2]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.261Z"}
{"level":"debug","message":"Executing query [m8o78f6m8fpy8kek8o9]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.262Z"}
{"level":"debug","message":"Executing query [m8o78f6otbjmz2vzls]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.264Z"}
{"level":"debug","message":"Executing query [m8o78f6p9dj9bezghts]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:53:27.265Z"}
{"level":"debug","message":"Executing query [m8o78f6v7alcrlar4j3]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[27]","timestamp":"2025-03-25T07:53:27.271Z"}
{"level":"debug","message":"Executing query [m8o78f6xj7z0vdmzhl]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.273Z"}
{"level":"debug","message":"Executing query [m8o78f6zso01skp5wj8]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",27]","timestamp":"2025-03-25T07:53:27.275Z"}
{"level":"debug","message":"Executing query [m8o78f72bu34ub0dlws]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[27]","timestamp":"2025-03-25T07:53:27.278Z"}
{"level":"debug","message":"Executing query [m8o78f73o79l7158d9e]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[27]","timestamp":"2025-03-25T07:53:27.279Z"}
{"level":"debug","message":"Executing query [m8o78f75phgwy9q6evr]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[27]","timestamp":"2025-03-25T07:53:27.282Z"}
{"level":"debug","message":"Executing query [m8o78f78lrsdl6voia]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.284Z"}
{"level":"debug","message":"Executing query [m8o78f7a9bk36hou8zo]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.286Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:53:27.287Z"}
{"level":"debug","message":"Executing query [m8o78f7bp686jiojmze]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:27.287Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:27.288Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:48.864Z"}
{"level":"debug","message":"Executing query [m8o7glomuz3o1a46m7s]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:48.934Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.882Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:49.021Z"}
{"level":"debug","message":"Executing query [m8o7glrbg5543w0umrf]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889588927\"]","timestamp":"2025-03-25T07:59:49.032Z"}
{"level":"debug","message":"Executing query [m8o7glrw4r1746hune]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889588927\"]","timestamp":"2025-03-25T07:59:49.052Z"}
{"level":"debug","message":"Executing query [m8o7glrz25wn5fa5m54]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742889588927\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:59:49.055Z"}
{"level":"debug","message":"Executing query [m8o7glscdtrq2c161c4]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.068Z"}
{"level":"debug","message":"Executing query [m8o7glsh0ny333q5n4xk]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889588927\"]","timestamp":"2025-03-25T07:59:49.074Z"}
{"level":"debug","message":"Executing query [m8o7glsn4gppexyn4t6]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1012]","timestamp":"2025-03-25T07:59:49.080Z"}
{"level":"debug","message":"Executing query [m8o7glst2pgx2x308h7]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.085Z"}
{"level":"debug","message":"Executing query [m8o7glsyvnopp4jv3k]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.090Z"}
{"level":"debug","message":"Executing query [m8o7glt7nuozul1djmm]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.099Z"}
{"level":"debug","message":"Executing query [m8o7gltbfpo839osvys]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.103Z"}
{"level":"debug","message":"Executing query [m8o7glteit9cmf7196]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.106Z"}
{"level":"debug","message":"Executing query [m8o7glti491ri8xmu38]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.110Z"}
{"level":"debug","message":"Executing query [m8o7gltkh99pwjjs14h]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:59:49.112Z"}
{"level":"debug","message":"Executing query [m8o7gltnbibeuzd0ue]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:49.116Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:49.121Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:59:49.432Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.720Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.637Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:49.924Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.634Z"}
{"level":"debug","message":"Executing query [m8o7gmgj3k6k26ic7sd]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:59:49.939Z"}
{"level":"debug","message":"Executing query [m8o7gmgryesp6jin8h]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:59:49.947Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o7gmgryesp6jin8h]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:59:49.959Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:49.962Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.889Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.936Z"}
{"level":"debug","message":"Executing query [m8o7gmi0hljbsdu7t2]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:49.992Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.979Z"}
{"level":"debug","message":"Executing query [m8o7gmi1iynwfbtkm6]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:49.993Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.028Z"}
{"level":"debug","message":"Executing query [m8o7gmj2vydg4dldf8g]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:59:50.030Z"}
{"level":"debug","message":"Executing query [m8o7gmj5o8ar0rinly]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889589991\"]","timestamp":"2025-03-25T07:59:50.033Z"}
{"level":"debug","message":"Executing query [m8o7gmj79y8s29fisw]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742889589991\",\"TEST-OFI-FORENSE-1742889589991\",5836,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742889589991\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:59:50.035Z"}
{"level":"debug","message":"Executing query [m8o7gmjg9niv4dtpa2c]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.044Z"}
{"level":"debug","message":"Executing query [m8o7gmjld1wyk9is9gn]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889589991\"]","timestamp":"2025-03-25T07:59:50.049Z"}
{"level":"debug","message":"Executing query [m8o7gmjqo26a1vb0fwp]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",27]","timestamp":"2025-03-25T07:59:50.054Z"}
{"level":"debug","message":"Executing query [m8o7gmjwqg4z0yhjsu]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.060Z"}
{"level":"debug","message":"Executing query [m8o7gmk0cljm0qt65oe]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.064Z"}
{"level":"debug","message":"Executing query [m8o7gmk3jwncfd0lxw8]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.068Z"}
{"level":"debug","message":"Executing query [m8o7gmk6ck2opy2x0n5]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.070Z"}
{"level":"debug","message":"Executing query [m8o7gmkcexm6742t1p7]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.076Z"}
{"level":"debug","message":"Executing query [m8o7gmkgnapzezbzylm]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742889590080\",\"TEST-SP-OFI-FORENSE-1742889590080\",9003,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:59:50.080Z"}
{"level":"debug","message":"Executing query [m8o7gmkpcw5kvyg47x5]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889590080\"]","timestamp":"2025-03-25T07:59:50.089Z"}
{"level":"debug","message":"Executing query [m8o7gmkr01ycusph5wu4]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889590080\"]","timestamp":"2025-03-25T07:59:50.091Z"}
{"level":"debug","message":"Executing query [m8o7gmhcba9618uzn6l]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:49.968Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.068Z"}
{"level":"debug","message":"Executing query [m8o7gmkzfq1l1k1fnh]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.099Z"}
{"level":"debug","message":"Executing query [m8o7gmky4127846gk9w]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:59:50.098Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:50.101Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.069Z"}
{"level":"debug","message":"Executing query [m8o7gmkd60alofrlyg]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:59:50.078Z"}
{"level":"debug","message":"Executing query [m8o7gmkq0n593iwpc30a]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889589991\"]","timestamp":"2025-03-25T07:59:50.094Z"}
{"level":"debug","message":"Executing query [m8o7gml02l8hqdi8fpp]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742889589991\",\"TEST-OFICIO-1742889589991\",7682,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:59:50.100Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:59:50.105Z"}
{"level":"debug","message":"Executing query [m8o7gml6lvl2lqloz8g]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:59:50.106Z"}
{"level":"debug","message":"Executing query [m8o7gmm44c92iniiz7m]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:59:50.140Z"}
{"level":"debug","message":"Executing query [m8o7gmmi4dbp69ooix2]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.154Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:59:50.153Z"}
{"level":"debug","message":"Executing query [m8o7gmmh45il2kosapf]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:59:50.153Z"}
{"level":"debug","message":"Executing query [m8o7gmmva7nhv2e88y]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889589991\"]","timestamp":"2025-03-25T07:59:50.167Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:59:50.173Z"}
{"level":"debug","message":"Executing query [m8o7gmn49mf36pbih4]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",27]","timestamp":"2025-03-25T07:59:50.176Z"}
{"level":"debug","message":"Executing query [m8o7gmn8hdnctl5dx4n]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.181Z"}
{"level":"debug","message":"Executing query [m8o7gmnclez5aei429]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.184Z"}
{"level":"debug","message":"Executing query [m8o7gmngis6zai3ux2b]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.188Z"}
{"level":"debug","message":"Executing query [m8o7gmnkgfejyd0zn4r]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.192Z"}
{"level":"debug","message":"Executing query [m8o7gmnqcszcyp5okou]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.198Z"}
{"level":"debug","message":"Executing query [m8o7gmnt2xh8jtwc9kc]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742889590201\",\"TEST-SP-OFICIO-1742889590201\",5906,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:59:50.201Z"}
{"level":"debug","message":"Executing query [m8o7gmnywpxpb1cs0e]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889590201\"]","timestamp":"2025-03-25T07:59:50.206Z"}
{"level":"debug","message":"Executing query [m8o7gmo1fcd147bswg]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889590201\"]","timestamp":"2025-03-25T07:59:50.209Z"}
{"level":"debug","message":"Executing query [m8o7gmo8up6zyvvsb68]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.216Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:50.219Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:59:50.218Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:59:50.219Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:59:50.220Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:59:50.221Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:59:50.222Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:59:50.222Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Executing query [m8o7gmpu9qoqv4cazqr]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:59:50.274Z"}
{"level":"debug","message":"Executing query [m8o7gmqijpaay7bp2fl]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:59:50.298Z"}
{"level":"debug","message":"Executing query [m8o7gmqlclo2nizj4m]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[25]","timestamp":"2025-03-25T07:59:50.301Z"}
{"level":"debug","message":"Executing query [m8o7gmqs2ou13m7kbz5]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.308Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:59:49.897Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:50.644Z"}
{"level":"debug","message":"Executing query [m8o7gn094xehm6q1q5g]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:50.650Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.673Z"}
{"level":"debug","message":"Executing query [m8o7gn10u3b7x5o45sc]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:59:50.676Z"}
{"level":"debug","message":"Executing query [m8o7gn12bt3fi3n9via]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:59:50.678Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:59:50.680Z"}
{"level":"debug","message":"Executing query [m8o7gn15opzs5u1w4lo]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:59:50.681Z"}
{"level":"debug","message":"Executing query [m8o7gn17y5im8cei67c]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:59:50.683Z"}
{"level":"debug","message":"Executing query [m8o7gn1ads6zy84x2p7]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:59:50.686Z"}
{"level":"debug","message":"Executing query [m8o7gn1mu4h329983n]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.698Z"}
{"level":"debug","message":"Executing query [m8o7gn1qysjtjhm5g]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.702Z"}
{"level":"debug","message":"Executing query [m8o7gn1vnhkwppwa5w]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",27]","timestamp":"2025-03-25T07:59:50.707Z"}
{"level":"debug","message":"Executing query [m8o7gn1z5qhfineuhd2]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.712Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:50.698Z"}
{"level":"debug","message":"Executing query [m8o7gn22esaq977ew16]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.714Z"}
{"level":"debug","message":"Executing query [m8o7gn29yjozhexhf9m]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.721Z"}
{"level":"debug","message":"Executing query [m8o7gn2babx6tdjjsd]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.723Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:50.725Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:50.712Z"}
{"level":"debug","message":"Executing query [m8o7gn1wmfcsjtks82]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:50.708Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.737Z"}
{"level":"debug","message":"Executing query [m8o7gn2rdew74akes2d]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:59:50.739Z"}
{"level":"debug","message":"Executing query [m8o7gn2tozc9havv2eq]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:59:50.741Z"}
{"level":"debug","message":"Executing query [m8o7gn2wvpnueu80wm]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:59:50.744Z"}
{"level":"debug","message":"Executing query [m8o7gn2yt9wbeu8mxsq]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:59:50.746Z"}
{"level":"debug","message":"Executing query [m8o7gn29md1khvi22o]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:50.721Z"}
{"level":"debug","message":"Executing query [m8o7gn32bw7utfvxw8j]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:59:50.751Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.751Z"}
{"level":"debug","message":"Executing query [m8o7gn38fk5omg4hhgp]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889590718\"]","timestamp":"2025-03-25T07:59:50.756Z"}
{"level":"debug","message":"Executing query [m8o7gn38vtti5o05ej]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[27,888,28,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:59:50.756Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:59:50.756Z"}
{"level":"debug","message":"Executing query [m8o7gn3azbne7qlj5p9]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742889590718\",true]","timestamp":"2025-03-25T07:59:50.759Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 28, Área ID: 888, Rol ID: 888, Documento ID: 27","timestamp":"2025-03-25T07:59:50.762Z"}
{"level":"debug","message":"Executing query [m8o7gn3gxx1ba2ra3c]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[27,28,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:59:50.764Z"}
{"level":"debug","message":"Executing query [m8o7gn3k99wfu6wgo79]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.768Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o7gn3gxx1ba2ra3c]","params":"[27,28,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:59:50.770Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:59:50.770Z"}
{"level":"debug","message":"Executing query [m8o7gn3n794wqi3hs2q]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.771Z"}
{"level":"debug","message":"Executing query [m8o7gn3sk5cnb3pv398]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889590718\"]","timestamp":"2025-03-25T07:59:50.776Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o7gn3n794wqi3hs2q]","params":"[27]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:59:50.774Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:59:50.775Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:59:50.775Z"}
{"level":"debug","message":"Executing query [m8o7gn3svdpmye6vkii]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[27,28,\"RESTAURAR\"]","timestamp":"2025-03-25T07:59:50.776Z"}
{"level":"debug","message":"Executing query [m8o7gn3vn4d2z0mab2r]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",28]","timestamp":"2025-03-25T07:59:50.779Z"}
{"level":"debug","message":"Executing query [m8o7gn3zpuej9op7wp]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.783Z"}
{"level":"debug","message":"Executing query [m8o7gn431pzl1gwa4x]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.787Z"}
{"level":"debug","message":"Executing query [m8o7gn48gd1pulviqzb]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[27,28,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:59:50.792Z"}
{"level":"debug","message":"Executing query [m8o7gn477jk4o36ix6m]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.791Z"}
{"level":"debug","message":"Executing query [m8o7gn4dxn1dryx4yts]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.797Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o7gn48gd1pulviqzb]","params":"[27,28,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:59:50.800Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:59:50.800Z"}
{"level":"debug","message":"Executing query [m8o7gn4gqc0wuljpae]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.800Z"}
{"level":"debug","message":"Executing query [m8o7gn4gshufpx8mpad]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.800Z"}
{"level":"debug","message":"Executing query [m8o7gn4igqq0vqpdhvo]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.802Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o7gn4gqc0wuljpae]","params":"[27]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:59:50.803Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:59:50.804Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:59:50.804Z"}
{"level":"debug","message":"Executing query [m8o7gn4lwg44aqxmltp]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[27,888,28,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:59:50.805Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:59:50.805Z"}
{"level":"debug","message":"Executing query [m8o7gn4mnft7uegb0bl]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.806Z"}
{"level":"debug","message":"Executing query [m8o7gn4ouxvzm2rd1mb]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:59:50.808Z"}
{"level":"debug","message":"Executing query [m8o7gn4r4c6a5vhvd9w]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.811Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:50.813Z"}
{"level":"debug","message":"Executing query [m8o7gn4y4vmfm27i28v]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:59:50.818Z"}
{"level":"debug","message":"Executing query [m8o7gn5dhmwb6xl01jg]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[28,\"DOCUMENTO\",28,\"ELIMINAR\"]","timestamp":"2025-03-25T07:59:50.833Z"}
{"level":"debug","message":"Executing query [m8o7gn5hsauksr5bhs]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.837Z"}
{"level":"debug","message":"Executing query [m8o7gn5nsrmhhv3hyfc]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:59:50.844Z"}
{"level":"debug","message":"Executing query [m8o7gn5taqkyxp6izjq]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.849Z"}
{"level":"debug","message":"Executing query [m8o7gn5ycg44zorxesm]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:59:50.854Z"}
{"level":"debug","message":"Executing query [m8o7gn605e5nueph2cq]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:59:50.856Z"}
{"level":"debug","message":"Executing query [m8o7gn6222kshzwiyww]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:59:50.858Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:59:50.863Z"}
{"level":"debug","message":"Executing query [m8o7gn67l7qsj9pilpa]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.863Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:50.868Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:51.175Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:51.208Z"}
{"level":"debug","message":"Executing query [m8o7gnfy87jckkrzoic]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:51.215Z"}
{"level":"debug","message":"Executing query [m8o7gngn66igvnfhbuk]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:59:51.240Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:51.246Z"}
{"level":"debug","message":"Executing query [m8o7gnh8ivvqpyhp9ts]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:59:51.260Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:59:51.263Z"}
{"level":"debug","message":"Executing query [m8o7gnhc21j2lw49vei]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.264Z"}
{"level":"debug","message":"Executing query [m8o7gnhht2yemb0lfbj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.269Z"}
{"level":"debug","message":"Executing query [m8o7gnhk33c845b8bd]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.272Z"}
{"level":"debug","message":"Executing query [m8o7gnhmw87ukljbe4d]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:59:51.274Z"}
{"level":"debug","message":"Executing query [m8o7gni77s3hdq2gtek]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[29]","timestamp":"2025-03-25T07:59:51.295Z"}
{"level":"debug","message":"Executing query [m8o7gnibkwphwru391p]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.299Z"}
{"level":"debug","message":"Executing query [m8o7gnifr8z6sryrmor]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",29]","timestamp":"2025-03-25T07:59:51.303Z"}
{"level":"debug","message":"Executing query [m8o7gnil2ch9jgriqzw]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[29]","timestamp":"2025-03-25T07:59:51.309Z"}
{"level":"debug","message":"Executing query [m8o7gnio3dcvjp19dfq]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[29]","timestamp":"2025-03-25T07:59:51.312Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:51.123Z"}
{"level":"debug","message":"Executing query [m8o7gniy15fqs5qtrpk]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[29]","timestamp":"2025-03-25T07:59:51.322Z"}
{"level":"debug","message":"Executing query [m8o7gnj1vjbmbzv88us]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.325Z"}
{"level":"debug","message":"Executing query [m8o7gnj3dgue1xyow4]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.327Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:59:51.328Z"}
{"level":"debug","message":"Executing query [m8o7gnj4sn5gcr0wjz9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:51.328Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:51.331Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:51.350Z"}
{"level":"debug","message":"Executing query [m8o7gnl6sd59ffl3yj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:51.403Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:51.484Z"}
{"level":"debug","message":"Executing query [m8o7gnnwoxfiz82awks]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:59:51.500Z"}
{"level":"debug","message":"Executing query [m8o7gno26xjz1ehqts3]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889591401\"]","timestamp":"2025-03-25T07:59:51.506Z"}
{"level":"debug","message":"Executing query [m8o7gno59hhvbsoylch]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742889591401\",\"TEST-OFI-QUIMICA-1742889591401\",6080,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:59:51.509Z"}
{"level":"debug","message":"Executing query [m8o7gnof63reatrf5w8]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.519Z"}
{"level":"debug","message":"Executing query [m8o7gnoqfyqax4gq4ts]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889591401\"]","timestamp":"2025-03-25T07:59:51.530Z"}
{"level":"debug","message":"Executing query [m8o7gnouwjzco0w70f]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",14]","timestamp":"2025-03-25T07:59:51.534Z"}
{"level":"debug","message":"Executing query [m8o7gnp6os2y7lx45ur]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.546Z"}
{"level":"debug","message":"Executing query [m8o7gnpb6xw6cv08v8d]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.551Z"}
{"level":"debug","message":"Executing query [m8o7gnpf760mowmlsuh]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.555Z"}
{"level":"debug","message":"Executing query [m8o7gnpjkankc11xqyk]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.559Z"}
{"level":"debug","message":"Executing query [m8o7gnpoczefeu70p2w]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.564Z"}
{"level":"debug","message":"Executing query [m8o7gnpqbdd8b1gavq4]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:51.566Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:51.568Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:51.972Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:59:52.345Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:59:52.365Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:52.598Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:59:52.696Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:52.782Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:52.938Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:59:53.108Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:53.218Z"}
{"level":"debug","message":"Executing query [m8o7gp0vyh5wgnah8pp]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:59:53.263Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:53.312Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.896Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.908Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.911Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.914Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.920Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.923Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:59:48.929Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:59:48.931Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:59:48.933Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:59:48.936Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:59:48.938Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:53.912Z"}
{"duration":"3ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:59:54.124Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:54.008Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:54.126Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:59:54.136Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:54.143Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:54.173Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:59:54.176Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T14:57:56.487Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T14:57:56.497Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T14:57:56.500Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T14:57:56.510Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T14:57:56.514Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T14:57:56.517Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T14:57:56.522Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T14:57:56.528Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T14:57:56.531Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T14:57:56.533Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T14:57:56.534Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T14:57:56.536Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:56.693Z"}
{"level":"debug","message":"Executing query [m8omebk0ak5qlxh9q29]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:56.736Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:56.873Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:56.948Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:57.067Z"}
{"level":"debug","message":"Executing query [m8omebuqbfms8q4z08v]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:57.123Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:56.917Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T14:57:57.095Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:57.448Z"}
{"level":"debug","message":"Executing query [m8omec3xdhvywg4g6xq]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:57.454Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T14:57:57.437Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T14:57:57.576Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:57.547Z"}
{"level":"debug","message":"Executing query [m8omec85oeu5nrj5uki]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:57.605Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T14:57:57.577Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T14:57:57.577Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T14:57:57.578Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T14:57:57.579Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T14:57:57.579Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:58.022Z"}
{"level":"debug","message":"Executing query [m8omecl188cdu45k4rk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:58.070Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:58.133Z"}
{"level":"debug","message":"Executing query [m8omecnw3gffrx33dxg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:58.172Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:58.250Z"}
{"level":"debug","message":"Executing query [m8omedcv21pbvyngfd7]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:59.071Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.214Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.214Z"}
{"executionTime":2481,"level":"warn","message":"Slow query detected [m8omebk0ak5qlxh9q29] - 2481ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-25T14:57:59.217Z"}
{"executionTime":1149,"level":"warn","message":"Slow query detected [m8omecl188cdu45k4rk] - 1149ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-25T14:57:59.218Z"}
{"executionTime":1047,"level":"warn","message":"Slow query detected [m8omecnw3gffrx33dxg] - 1047ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-25T14:57:59.219Z"}
{"level":"debug","message":"Executing query [m8omedgyr4v5c9l7q0l]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742914676733\"]","timestamp":"2025-03-25T14:57:59.218Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.220Z"}
{"level":"debug","message":"Executing query [m8omedgz9q8ffhvmvja]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T14:57:59.219Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.221Z"}
{"level":"debug","message":"Executing query [m8omedgzue0wc0bbrx]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T14:57:59.219Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.221Z"}
{"executionTime":2098,"level":"warn","message":"Slow query detected [m8omebuqbfms8q4z08v] - 2098ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-25T14:57:59.220Z"}
{"level":"debug","message":"Executing query [m8omedh0uktb7gtpew]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742914678170\"]","timestamp":"2025-03-25T14:57:59.220Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.222Z"}
{"level":"debug","message":"Executing query [m8omedh4zmnr4i5zxfo]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T14:57:59.225Z"}
{"executionTime":1618,"level":"warn","message":"Slow query detected [m8omec85oeu5nrj5uki] - 1618ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-25T14:57:59.223Z"}
{"level":"debug","message":"Executing query [m8omedh39avg33cxcul]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T14:57:59.224Z"}
{"level":"debug","message":"Executing query [m8omedh0511op2zltj]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T14:57:59.221Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T14:57:59.225Z"}
{"level":"debug","message":"Executing query [m8omedh52arf1vo62w6]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T14:57:59.225Z"}
{"level":"debug","message":"Executing query [m8omedh56aq8efsojyj]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742914678170\",true]","timestamp":"2025-03-25T14:57:59.225Z"}
{"level":"debug","message":"Executing query [m8omedh7ietyetayhs]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T14:57:59.227Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.224Z"}
{"level":"debug","message":"Executing query [m8omedh7k7qspmgdsvs]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T14:57:59.227Z"}
{"level":"debug","message":"Executing query [m8omedh9xdssi96br3s]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742914677604\"]","timestamp":"2025-03-25T14:57:59.229Z"}
{"level":"debug","message":"Executing query [m8omedh337f3l1yu98v]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T14:57:59.223Z"}
{"level":"debug","message":"Executing query [m8omedh9fdga0ewnzl7]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T14:57:59.229Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T14:57:59.229Z"}
{"level":"debug","message":"Executing query [m8omedhamx2pvu1b93d]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T14:57:59.230Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T14:57:59.226Z"}
{"level":"debug","message":"Executing query [m8omedh65936adoder7]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T14:57:59.226Z"}
{"level":"debug","message":"Executing query [m8omedhagi237g0nc4u]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T14:57:59.230Z"}
{"level":"debug","message":"Executing query [m8omedhdq8dnud07ezr]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742914677604\",\"TEST-OFICIO-1742914677604\",1044,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T14:57:59.233Z"}
{"level":"debug","message":"Executing query [m8omedh9eavty30eq48]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T14:57:59.230Z"}
{"level":"debug","message":"Executing query [m8omedhejp3n0aoi7h]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.234Z"}
{"level":"debug","message":"Executing query [m8omedhdqigsr7han]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T14:57:59.233Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.234Z"}
{"level":"debug","message":"Executing query [m8omedhd0k1qavrrbj5e]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T14:57:59.234Z"}
{"level":"debug","message":"Executing query [m8omedhjmhzqh658yeb]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T14:57:59.239Z"}
{"level":"debug","message":"Executing query [m8omedhjvgfl0bfxymg]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742914678170\"]","timestamp":"2025-03-25T14:57:59.240Z"}
{"executionTime":1785,"level":"warn","message":"Slow query detected [m8omec3xdhvywg4g6xq] - 1785ms","query":"SET FOREIGN_KEY_CHECKS = 0","timestamp":"2025-03-25T14:57:59.238Z"}
{"level":"debug","message":"Executing query [m8omedhigep93biunrm]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T14:57:59.238Z"}
{"level":"debug","message":"Executing query [m8omedhkr9el5jrxgyf]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.240Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8omedhd0k1qavrrbj5e]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T14:57:59.240Z"}
{"level":"debug","message":"Executing query [m8omedhmvjm3i38zi4g]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.242Z"}
{"level":"debug","message":"Executing query [m8omedhotpz41fo98pm]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[30,888,30,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T14:57:59.244Z\",\"ACTIVO\"]","timestamp":"2025-03-25T14:57:59.244Z"}
{"level":"debug","message":"Executing query [m8omedhnbgwxkk02het]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",29]","timestamp":"2025-03-25T14:57:59.243Z"}
{"level":"debug","message":"Executing query [m8omedhptwxodxpmim]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742914677451\"]","timestamp":"2025-03-25T14:57:59.245Z"}
{"level":"debug","message":"Executing query [m8omedhqeciu8kobk7s]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.246Z"}
{"level":"debug","message":"Executing query [m8omedhs5wpgttjmc9o]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742914677451\",\"TEST-OFI-FORENSE-1742914677451\",899,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742914677451\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T14:57:59.248Z"}
{"level":"debug","message":"Executing query [m8omedhrprb1nmzcevo]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742914677604\"]","timestamp":"2025-03-25T14:57:59.247Z"}
{"level":"debug","message":"Executing query [m8omedhscu6njzumqc5]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.248Z"}
{"level":"debug","message":"Executing query [m8omedhuqvgyymqr0n]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",29]","timestamp":"2025-03-25T14:57:59.250Z"}
{"level":"debug","message":"Executing query [m8omedhugaz9p6mtkrt]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.250Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 30, Área ID: 888, Rol ID: 888, Documento ID: 29","timestamp":"2025-03-25T14:57:59.250Z"}
{"level":"debug","message":"Executing query [m8omedhvvfce17ae87d]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[29,30,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T14:57:59.251Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:57:59.242Z"}
{"level":"debug","message":"Executing query [m8omedhu469cs92b569]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",29]","timestamp":"2025-03-25T14:57:59.250Z"}
{"level":"debug","message":"Executing query [m8omedi1vhdo0rxwmh]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.257Z"}
{"level":"debug","message":"Executing query [m8omedi39eecldvgjv]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.259Z"}
{"level":"debug","message":"Executing query [m8omedi2rbyh9g7y4r]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.258Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omedhvvfce17ae87d]","params":"[29,30,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T14:57:59.260Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T14:57:59.260Z"}
{"level":"debug","message":"Executing query [m8omedi5ujggh2k2s3k]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.261Z"}
{"level":"debug","message":"Executing query [m8omedi1ywrc10n1ed]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.257Z"}
{"level":"debug","message":"Executing query [m8omedi5y2vvfcfxhx]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.261Z"}
{"level":"debug","message":"Executing query [m8omedi4ecvwh4crkpg]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.260Z"}
{"level":"debug","message":"Executing query [m8omedi4azc1a11oycf]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.261Z"}
{"level":"debug","message":"Executing query [m8omedi8iw0qjptm87q]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.264Z"}
{"level":"debug","message":"Executing query [m8omedi8nmvchqd7zho]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742914677451\"]","timestamp":"2025-03-25T14:57:59.264Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omedi5ujggh2k2s3k]","params":"[29]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T14:57:59.265Z"}
{"level":"debug","message":"Executing query [m8omedicn6e5im9beb]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",29]","timestamp":"2025-03-25T14:57:59.268Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T14:57:59.266Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T14:57:59.266Z"}
{"level":"debug","message":"Executing query [m8omedibn4p8pjp6lnp]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[29,30,\"RESTAURAR\"]","timestamp":"2025-03-25T14:57:59.267Z"}
{"level":"debug","message":"Executing query [m8omedieyu27cj8atw]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.270Z"}
{"level":"debug","message":"Executing query [m8omedig04cc3c57r6sy]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.272Z"}
{"level":"debug","message":"Executing query [m8omedim1ysih2y6fp8]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.278Z"}
{"level":"debug","message":"Executing query [m8omediow9ps15thb4k]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.280Z"}
{"level":"debug","message":"Executing query [m8omedijm2t2kovo8fs]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.275Z"}
{"level":"debug","message":"Executing query [m8omediljco5uxbxz2f]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T14:57:59.277Z"}
{"level":"debug","message":"Executing query [m8omedipzabx2dqe9gi]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:57:59.281Z"}
{"level":"debug","message":"Executing query [m8omedisvbjtp45t2xf]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[29,30,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T14:57:59.284Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:57:59.283Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omedisvbjtp45t2xf]","params":"[29,30,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T14:57:59.290Z"}
{"level":"debug","message":"Executing query [m8omedikg6xrzwk3ezn]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.276Z"}
{"level":"debug","message":"Executing query [m8omedinm45x8g42rra]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.279Z"}
{"level":"debug","message":"Executing query [m8omediu9wxj9ohjtd]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.286Z"}
{"level":"debug","message":"Executing query [m8omedii54im1bq55zi]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.274Z"}
{"level":"debug","message":"Executing query [m8omedixuyxwy5kh0r]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.289Z"}
{"level":"debug","message":"Executing query [m8omedimwyo8bp93po]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:57:59.278Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:57:59.281Z"}
{"level":"debug","message":"Executing query [m8omedip7medxkejiu3]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742914679281\",\"TEST-SP-OFICIO-1742914679281\",921,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T14:57:59.281Z"}
{"level":"debug","message":"Executing query [m8omediugw0g7w63msk]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742914679281\"]","timestamp":"2025-03-25T14:57:59.286Z"}
{"level":"debug","message":"Executing query [m8omedixcniuvcfsjz]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742914679281\"]","timestamp":"2025-03-25T14:57:59.289Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T14:57:59.290Z"}
{"level":"debug","message":"Executing query [m8omediyel1aqd4imqj]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.290Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omediyel1aqd4imqj]","params":"[29]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T14:57:59.293Z"}
{"level":"debug","message":"Executing query [m8omedj1yxl0x8vp8mj]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[29]","timestamp":"2025-03-25T14:57:59.293Z"}
{"level":"debug","message":"Executing query [m8omedj1qji80hg903r]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:57:59.293Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T14:57:59.293Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T14:57:59.293Z"}
{"level":"debug","message":"Executing query [m8omedj2zsreoarevw]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[30,888,30,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T14:57:59.294Z\",\"ACTIVO\"]","timestamp":"2025-03-25T14:57:59.294Z"}
{"level":"debug","message":"Executing query [m8omedj4ozg223ocn3]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742914679296\",\"TEST-SP-OFI-FORENSE-1742914679296\",8510,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T14:57:59.296Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:57:59.296Z"}
{"level":"debug","message":"Executing query [m8omedj8ogh0gb41gjg]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T14:57:59.300Z"}
{"level":"debug","message":"Executing query [m8omedj9t1d8z24hqjl]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742914679296\"]","timestamp":"2025-03-25T14:57:59.301Z"}
{"level":"debug","message":"Executing query [m8omedjcoeue71y0d0e]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742914679296\"]","timestamp":"2025-03-25T14:57:59.304Z"}
{"level":"debug","message":"Executing query [m8omedjevyynoczrohm]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742914676733\"]","timestamp":"2025-03-25T14:57:59.306Z"}
{"level":"debug","message":"Executing query [m8omedjgrbr6wqmmlzm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:57:59.308Z"}
{"level":"debug","message":"Executing query [m8omedjd50wr4ncmfsg]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[30,\"DOCUMENTO\",30,\"ELIMINAR\"]","timestamp":"2025-03-25T14:57:59.305Z"}
{"level":"debug","message":"Executing query [m8omedji5fofremh88]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[30]","timestamp":"2025-03-25T14:57:59.310Z"}
{"level":"debug","message":"Executing query [m8omedjgxqrvtvu64ne]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742914676733\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T14:57:59.308Z"}
{"level":"debug","message":"Executing query [m8omedjnpkyxy3j1e3]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T14:57:59.315Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:57:59.311Z"}
{"level":"debug","message":"Executing query [m8omedjru77ayrxufpr]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T14:57:59.319Z"}
{"level":"debug","message":"Executing query [m8omedjsodu57i0uqr]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[30]","timestamp":"2025-03-25T14:57:59.321Z"}
{"level":"debug","message":"Executing query [m8omedjx6g5ylrogv0g]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T14:57:59.325Z"}
{"level":"debug","message":"Executing query [m8omedjx7qwhw2rvz8d]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742914676733\"]","timestamp":"2025-03-25T14:57:59.325Z"}
{"level":"debug","message":"Executing query [m8omedjzuhpx1cl5xb]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T14:57:59.327Z"}
{"level":"debug","message":"Executing query [m8omedk1eca8s47s3an]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T14:57:59.329Z"}
{"level":"debug","message":"Executing query [m8omedk1xg1oecfrree]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1013]","timestamp":"2025-03-25T14:57:59.329Z"}
{"level":"debug","message":"Executing query [m8omedk5ntl2nau4yfd]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T14:57:59.334Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T14:57:59.334Z"}
{"level":"debug","message":"Executing query [m8omedk6tiazvxtao3]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:57:59.334Z"}
{"level":"debug","message":"Executing query [m8omedk9htbz3kzvsmc]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T14:57:59.337Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:57:59.337Z"}
{"level":"debug","message":"Executing query [m8omedkgbcmklvej19k]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T14:57:59.344Z"}
{"level":"debug","message":"Executing query [m8omedkjj3v67enn5ed]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T14:57:59.347Z"}
{"level":"debug","message":"Executing query [m8omedkmg8wzbf9xbos]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T14:57:59.350Z"}
{"level":"debug","message":"Executing query [m8omedkq8m0ox5yr9oa]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1013]","timestamp":"2025-03-25T14:57:59.355Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T14:57:59.232Z"}
{"level":"debug","message":"Executing query [m8omedkp1qgsqgzybu3]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T14:57:59.353Z"}
{"level":"debug","message":"Executing query [m8omedktjb7mkey2r2n]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T14:57:59.357Z"}
{"level":"debug","message":"Executing query [m8omedkv46vwvyb2y8a]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:57:59.359Z"}
{"level":"debug","message":"Executing query [m8omedkuqwi7i8a8umh]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T14:57:59.359Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:57:59.362Z"}
{"level":"debug","message":"Executing query [m8omedkynvz82qajmhf]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[27]","timestamp":"2025-03-25T14:57:59.362Z"}
{"level":"debug","message":"Executing query [m8omedl3kv5a2oonapg]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:57:59.367Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:59.652Z"}
{"level":"debug","message":"Executing query [m8omedt5tc2pdci9yxj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:59.657Z"}
{"level":"debug","message":"Executing query [m8omedw0wel515eiyb]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T14:57:59.760Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.762Z"}
{"level":"debug","message":"Executing query [m8omedw57kfbexaij2l]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742914679655\"]","timestamp":"2025-03-25T14:57:59.765Z"}
{"level":"debug","message":"Executing query [m8omedw7smc7ht9utx]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742914679655\",\"TEST-OFI-QUIMICA-1742914679655\",7938,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T14:57:59.767Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:59.603Z"}
{"level":"debug","message":"Executing query [m8omedwe80epxi6xhi]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[15]","timestamp":"2025-03-25T14:57:59.774Z"}
{"level":"debug","message":"Executing query [m8omedwjkteyq10s64]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742914679655\"]","timestamp":"2025-03-25T14:57:59.779Z"}
{"level":"debug","message":"Executing query [m8omedwlsekmehwmk3n]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",15]","timestamp":"2025-03-25T14:57:59.781Z"}
{"level":"debug","message":"Executing query [m8omedwpzhtpcxy7x0k]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[15]","timestamp":"2025-03-25T14:57:59.785Z"}
{"level":"debug","message":"Executing query [m8omedwst8zhkp0jx3]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[15]","timestamp":"2025-03-25T14:57:59.788Z"}
{"level":"debug","message":"Executing query [m8omedwxkh07tuokr5r]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[15]","timestamp":"2025-03-25T14:57:59.793Z"}
{"level":"debug","message":"Executing query [m8omedx0gp2n1d1manj]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[15]","timestamp":"2025-03-25T14:57:59.796Z"}
{"level":"debug","message":"Executing query [m8omedx3x4rybpfn14]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[15]","timestamp":"2025-03-25T14:57:59.799Z"}
{"level":"debug","message":"Executing query [m8omedx654syvnkr9ih]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:57:59.802Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:57:59.804Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:58.369Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T14:57:59.558Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T14:57:59.579Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.944Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:59.920Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:57:59.934Z"}
{"level":"debug","message":"Executing query [m8omee0wb3a72e0wtkw]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T14:57:59.936Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:57:59.961Z"}
{"level":"debug","message":"Executing query [m8omee1npn2salyb19]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T14:57:59.963Z"}
{"level":"debug","message":"Executing query [m8omee1qch0dnmzk6kr]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T14:57:59.966Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T14:57:59.969Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T14:57:59.971Z"}
{"level":"debug","message":"Executing query [m8omee1tvdfajuktvql]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T14:57:59.969Z"}
{"level":"debug","message":"Executing query [m8omee1v2vknpn7sopj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T14:57:59.971Z"}
{"level":"debug","message":"Executing query [m8omee1zn7eem49im3]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T14:57:59.975Z"}
{"level":"debug","message":"Executing query [m8omee20biykxnvy1e]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T14:57:59.976Z"}
{"level":"debug","message":"Executing query [m8omee28zx6aoglixrm]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[31]","timestamp":"2025-03-25T14:57:59.984Z"}
{"level":"debug","message":"Executing query [m8omee2d1mf8j03zozu]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T14:57:59.989Z"}
{"level":"debug","message":"Executing query [m8omee2h46wcjz6qy14]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",31]","timestamp":"2025-03-25T14:57:59.993Z"}
{"level":"debug","message":"Executing query [m8omee2m2gnylzz91m7]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[31]","timestamp":"2025-03-25T14:57:59.998Z"}
{"level":"debug","message":"Executing query [m8omee2pkftt3q11xeh]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[31]","timestamp":"2025-03-25T14:58:00.001Z"}
{"level":"debug","message":"Executing query [m8omee2xdv7yi33a6ff]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[31]","timestamp":"2025-03-25T14:58:00.009Z"}
{"level":"debug","message":"Executing query [m8omee325ms4dryyel8]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T14:58:00.014Z"}
{"level":"debug","message":"Executing query [m8omee35ng0npk6ch0b]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T14:58:00.017Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T14:58:00.019Z"}
{"level":"debug","message":"Executing query [m8omee3780q8sbv0b3g]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T14:58:00.019Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:58:00.021Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:58:00.088Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:58:00.678Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T14:58:00.894Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:58:00.976Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:58:00.864Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T14:58:00.861Z"}
{"level":"debug","message":"Executing query [m8omeeuqhg7c9bxryt7]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T14:58:01.010Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:58:01.023Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T14:58:01.026Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:58:01.041Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T14:58:01.047Z"}
{"duration":"26ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T14:58:01.051Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T14:58:01.057Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T14:58:01.062Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:06:06.079Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:06:06.097Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:06:06.106Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:06:06.112Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:06:06.117Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:06:06.127Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:06:06.132Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:06:06.137Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:06:06.139Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:06:06.142Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:06:06.144Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T15:06:06.146Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:06.330Z"}
{"level":"debug","message":"Executing query [m8omotdx5nut1qzkrxc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:06.405Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:06.474Z"}
{"level":"debug","message":"Executing query [m8omotfyacrefh54r8s]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915166401\"]","timestamp":"2025-03-25T15:06:06.478Z"}
{"level":"debug","message":"Executing query [m8omothf1nfeclze65g]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915166401\"]","timestamp":"2025-03-25T15:06:06.531Z"}
{"level":"debug","message":"Executing query [m8omothi14azkiltkowj]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742915166401\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:06:06.534Z"}
{"level":"debug","message":"Executing query [m8omothuuy4mbd997j]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T15:06:06.546Z"}
{"level":"debug","message":"Executing query [m8omothzxfg3jzr5qed]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915166401\"]","timestamp":"2025-03-25T15:06:06.551Z"}
{"level":"debug","message":"Executing query [m8omoti7et4bcgasliv]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1014]","timestamp":"2025-03-25T15:06:06.559Z"}
{"level":"debug","message":"Executing query [m8omotic5vls1lfkkpw]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T15:06:06.564Z"}
{"level":"debug","message":"Executing query [m8omotif23cdzs391co]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T15:06:06.567Z"}
{"level":"debug","message":"Executing query [m8omotijy6wjt9ylp8]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T15:06:06.571Z"}
{"level":"debug","message":"Executing query [m8omotimwuyql7w1ltd]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T15:06:06.574Z"}
{"level":"debug","message":"Executing query [m8omotipauxbhu4e449]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T15:06:06.577Z"}
{"level":"debug","message":"Executing query [m8omotivc3hq5stji9m]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1014]","timestamp":"2025-03-25T15:06:06.583Z"}
{"level":"debug","message":"Executing query [m8omotix2j7n4upoevw]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T15:06:06.585Z"}
{"level":"debug","message":"Executing query [m8omotj0j7xad648mxj]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:06.588Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:06.590Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T15:06:06.624Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:06.759Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:06.779Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:06.622Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:06.899Z"}
{"level":"debug","message":"Executing query [m8omotrvvon2211wxdp]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T15:06:06.907Z"}
{"level":"debug","message":"Executing query [m8omotrzre1q9rp838]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T15:06:06.911Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8omotrzre1q9rp838]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T15:06:06.916Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:06.920Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:06.890Z"}
{"level":"debug","message":"Executing query [m8omotsyuxuoboh915]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:06.946Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:07.014Z"}
{"level":"debug","message":"Executing query [m8omotuwf1qqhh038gj]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T15:06:07.016Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T15:06:07.021Z"}
{"level":"debug","message":"Executing query [m8omotv2mawxh4kx87h]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T15:06:07.022Z"}
{"level":"debug","message":"Executing query [m8omotv4q6rfbntv3ki]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T15:06:07.024Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T15:06:07.026Z"}
{"level":"debug","message":"Executing query [m8omotv6xx7unm8o22]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T15:06:07.026Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T15:06:07.029Z"}
{"level":"debug","message":"Executing query [m8omotxfce19zwyvvra]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T15:06:07.107Z"}
{"level":"debug","message":"Executing query [m8omotxprzx9li5y89]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T15:06:07.118Z"}
{"level":"debug","message":"Executing query [m8omotxuejuo4fwrv49]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[29]","timestamp":"2025-03-25T15:06:07.122Z"}
{"level":"debug","message":"Executing query [m8omoty3fg124hm8k0t]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:07.131Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T15:06:06.953Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:07.221Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T15:06:07.138Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T15:06:07.139Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T15:06:07.140Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T15:06:07.141Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T15:06:07.142Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T15:06:07.142Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:07.276Z"}
{"level":"debug","message":"Executing query [m8omou24ut3e8q55je]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:07.276Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:07.347Z"}
{"level":"debug","message":"Executing query [m8omou48bmc96owdylq]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:06:07.352Z"}
{"level":"debug","message":"Executing query [m8omou4d55fhl0ortrw]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742915167274\"]","timestamp":"2025-03-25T15:06:07.358Z"}
{"level":"debug","message":"Executing query [m8omou4ggdnfb77butp]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742915167274\",\"TEST-OFI-FORENSE-1742915167274\",8921,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742915167274\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:06:07.360Z"}
{"level":"debug","message":"Executing query [m8omou4qls5hrxv2cj]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.370Z"}
{"level":"debug","message":"Executing query [m8omou4wnn97rdd0dvs]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742915167274\"]","timestamp":"2025-03-25T15:06:07.376Z"}
{"level":"debug","message":"Executing query [m8omou50lmwo31yd4p8]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",31]","timestamp":"2025-03-25T15:06:07.380Z"}
{"level":"debug","message":"Executing query [m8omou540dqoixk9yo68]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.384Z"}
{"level":"debug","message":"Executing query [m8omou57znfwbn6ivx]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.387Z"}
{"level":"debug","message":"Executing query [m8omou5ce1tkanbd2qc]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.392Z"}
{"level":"debug","message":"Executing query [m8omou5fmshokyyatso]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.395Z"}
{"level":"debug","message":"Executing query [m8omou5jpk2zeh4bj4]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.399Z"}
{"level":"debug","message":"Executing query [m8omou5madag4fawva]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742915167402\",\"TEST-SP-OFI-FORENSE-1742915167402\",6356,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T15:06:07.402Z"}
{"level":"debug","message":"Executing query [m8omou5serwu0gaj07r]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742915167402\"]","timestamp":"2025-03-25T15:06:07.409Z"}
{"level":"debug","message":"Executing query [m8omou5vbe7mpgmv1fc]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742915167402\"]","timestamp":"2025-03-25T15:06:07.411Z"}
{"level":"debug","message":"Executing query [m8omou5z0ofl5tsqk7as]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:07.415Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:07.419Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:07.382Z"}
{"level":"debug","message":"Executing query [m8omou5cu45jjm288xr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:07.392Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:07.447Z"}
{"level":"debug","message":"Executing query [m8omou6xnidx6kd75cj]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742915167389\"]","timestamp":"2025-03-25T15:06:07.449Z"}
{"level":"debug","message":"Executing query [m8omou6zpnmsgfnn7g9]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742915167389\",true]","timestamp":"2025-03-25T15:06:07.451Z"}
{"level":"debug","message":"Executing query [m8omou3obkb5s6sxfiw]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:07.332Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:07.448Z"}
{"level":"debug","message":"Executing query [m8omou77c3lr6vfvlkb]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.459Z"}
{"level":"debug","message":"Executing query [m8omou7cjsxcsfnkm2]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742915167389\"]","timestamp":"2025-03-25T15:06:07.464Z"}
{"level":"debug","message":"Executing query [m8omou7goh24yl6aebi]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",31]","timestamp":"2025-03-25T15:06:07.468Z"}
{"level":"debug","message":"Executing query [m8omou7flcbdxyoxk1l]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:06:07.467Z"}
{"level":"debug","message":"Executing query [m8omou7khrj1w1vp7nc]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.472Z"}
{"level":"debug","message":"Executing query [m8omou7nugldj1q989]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.476Z"}
{"level":"debug","message":"Executing query [m8omou7rjglwqfqtc68]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.480Z"}
{"level":"debug","message":"Executing query [m8omou7u40pylr5c9a]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.482Z"}
{"level":"debug","message":"Executing query [m8omou7wr914gw9vet]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.484Z"}
{"level":"debug","message":"Executing query [m8omou80hdws8pgqw99]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.488Z"}
{"level":"debug","message":"Executing query [m8omou82hppe3vvyoyt]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T15:06:07.490Z"}
{"level":"debug","message":"Executing query [m8omou82gkx9ofdbn2l]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742915167325\"]","timestamp":"2025-03-25T15:06:07.490Z"}
{"level":"debug","message":"Executing query [m8omou84yw770s9jhfe]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:07.492Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:07.494Z"}
{"level":"debug","message":"Executing query [m8omou8eqc1r9clkcs]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742915167325\",\"TEST-OFICIO-1742915167325\",6082,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:06:07.502Z"}
{"level":"debug","message":"Executing query [m8omou8ld6h7h0tk1ri]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.509Z"}
{"level":"debug","message":"Executing query [m8omou8rgap2pgvmgbw]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742915167325\"]","timestamp":"2025-03-25T15:06:07.515Z"}
{"level":"debug","message":"Executing query [m8omou8uef34tk959rv]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",31]","timestamp":"2025-03-25T15:06:07.518Z"}
{"level":"debug","message":"Executing query [m8omou8yhxmaeiqytul]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.522Z"}
{"level":"debug","message":"Executing query [m8omou92gknzndeiylc]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.526Z"}
{"level":"debug","message":"Executing query [m8omou9790j9n1w78wa]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.531Z"}
{"level":"debug","message":"Executing query [m8omou9bdxl18x78esa]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.535Z"}
{"level":"debug","message":"Executing query [m8omou9fwx67k2dhn0q]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.539Z"}
{"level":"debug","message":"Executing query [m8omou9ifk29yd9a24j]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742915167542\",\"TEST-SP-OFICIO-1742915167542\",9862,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T15:06:07.543Z"}
{"level":"debug","message":"Executing query [m8omou9mxyajqksge5k]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742915167542\"]","timestamp":"2025-03-25T15:06:07.546Z"}
{"level":"debug","message":"Executing query [m8omou9q49f6ynjya9n]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742915167542\"]","timestamp":"2025-03-25T15:06:07.550Z"}
{"level":"debug","message":"Executing query [m8omou9u9jsno684weo]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:07.554Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:07.556Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:07.554Z"}
{"level":"debug","message":"Executing query [m8omoubgop11p42flyn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:07.612Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:07.707Z"}
{"level":"debug","message":"Executing query [m8omoue9f9aj9s8vij8]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T15:06:07.713Z"}
{"level":"debug","message":"Executing query [m8omouegpd06ux6mcop]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T15:06:07.720Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T15:06:07.724Z"}
{"level":"debug","message":"Executing query [m8omouektqsp81sje5]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T15:06:07.724Z"}
{"level":"debug","message":"Executing query [m8omouencgnmv2zn1jo]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T15:06:07.727Z"}
{"level":"debug","message":"Executing query [m8omoueqmi55n5ek77j]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T15:06:07.730Z"}
{"level":"debug","message":"Executing query [m8omouexv5875rejoi8]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.737Z"}
{"level":"debug","message":"Executing query [m8omouf29o8wad0d45]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.742Z"}
{"level":"debug","message":"Executing query [m8omouf7mqreneyjj6s]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",31]","timestamp":"2025-03-25T15:06:07.747Z"}
{"level":"debug","message":"Executing query [m8omoufcb6sp435dig9]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.752Z"}
{"level":"debug","message":"Executing query [m8omouffkf765sf727]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.755Z"}
{"level":"debug","message":"Executing query [m8omoufkzjlo22a4g89]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.760Z"}
{"level":"debug","message":"Executing query [m8omoufmyf0c0j5emc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:07.762Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:07.764Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:07.614Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:07.820Z"}
{"level":"debug","message":"Executing query [m8omouirnagr7vgcp9m]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:07.875Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:07.944Z"}
{"level":"debug","message":"Executing query [m8omoukrkxx451n0dk]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:06:07.947Z"}
{"level":"debug","message":"Executing query [m8omoukvdyrjkj2jumr]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T15:06:07.951Z"}
{"level":"debug","message":"Executing query [m8omoukyqcj1r2qo1za]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T15:06:07.954Z"}
{"level":"debug","message":"Executing query [m8omoul0gezmln9bs9k]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T15:06:07.956Z"}
{"level":"debug","message":"Executing query [m8omoul62ewesr47ar1]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T15:06:07.962Z"}
{"level":"debug","message":"Executing query [m8omoulan7ssnv36jdr]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[32,888,32,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T15:06:07.966Z\",\"ACTIVO\"]","timestamp":"2025-03-25T15:06:07.966Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 32, Área ID: 888, Rol ID: 888, Documento ID: 31","timestamp":"2025-03-25T15:06:07.970Z"}
{"level":"debug","message":"Executing query [m8omoulfe73p98kpd1v]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[31,32,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T15:06:07.971Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omoulfe73p98kpd1v]","params":"[31,32,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T15:06:07.978Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T15:06:07.979Z"}
{"level":"debug","message":"Executing query [m8omouln2b99v3gmarx]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.979Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omouln2b99v3gmarx]","params":"[31]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T15:06:07.982Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T15:06:07.983Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T15:06:07.983Z"}
{"level":"debug","message":"Executing query [m8omouls2142kfjhipe]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[31,32,\"RESTAURAR\"]","timestamp":"2025-03-25T15:06:07.984Z"}
{"level":"debug","message":"Executing query [m8omoulyjpy6o1dmqu]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.990Z"}
{"level":"debug","message":"Executing query [m8omoum1326v6qr4fox]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[31,32,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T15:06:07.993Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omoum1326v6qr4fox]","params":"[31,32,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T15:06:07.998Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T15:06:07.998Z"}
{"level":"debug","message":"Executing query [m8omoum68f78ivcrb8]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[31]","timestamp":"2025-03-25T15:06:07.998Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omoum68f78ivcrb8]","params":"[31]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T15:06:08.002Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T15:06:08.002Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T15:06:08.002Z"}
{"level":"debug","message":"Executing query [m8omoumbvd6yrgc3zm8]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[32,888,32,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T15:06:08.003Z\",\"ACTIVO\"]","timestamp":"2025-03-25T15:06:08.003Z"}
{"level":"debug","message":"Executing query [m8omoumgnjb3l5g2g5]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T15:06:08.008Z"}
{"level":"debug","message":"Executing query [m8omoummmphtbpbe27h]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[32,\"DOCUMENTO\",32,\"ELIMINAR\"]","timestamp":"2025-03-25T15:06:08.014Z"}
{"level":"debug","message":"Executing query [m8omoumtafrepxs5wyf]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[32]","timestamp":"2025-03-25T15:06:08.022Z"}
{"level":"debug","message":"Executing query [m8omoumzsvkgsodn8bg]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T15:06:08.027Z"}
{"level":"debug","message":"Executing query [m8omoun48niub3y64jh]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[32]","timestamp":"2025-03-25T15:06:08.032Z"}
{"level":"debug","message":"Executing query [m8omoun9q3r2ip8pgqr]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:06:08.037Z"}
{"level":"debug","message":"Executing query [m8omouncqr1c56ru2nm]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:06:08.040Z"}
{"level":"debug","message":"Executing query [m8omounedrb8hp8kpn6]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:06:08.042Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T15:06:08.047Z"}
{"level":"debug","message":"Executing query [m8omounjtzw6bibkfq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:08.047Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:08.050Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:08.048Z"}
{"level":"debug","message":"Executing query [m8omouot516e0ktf7eh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:08.094Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:08.136Z"}
{"level":"debug","message":"Executing query [m8omouq4i4loi1nyct]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:06:08.140Z"}
{"level":"debug","message":"Executing query [m8omouq94ru7hfnn8vv]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742915168092\"]","timestamp":"2025-03-25T15:06:08.145Z"}
{"level":"debug","message":"Executing query [m8omouqbj5wlabb8o6k]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742915168092\",\"TEST-OFI-QUIMICA-1742915168092\",4919,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:06:08.147Z"}
{"level":"debug","message":"Executing query [m8omouqixlmlehxv1nf]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[16]","timestamp":"2025-03-25T15:06:08.154Z"}
{"level":"debug","message":"Executing query [m8omouqnti6hrg6ykae]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742915168092\"]","timestamp":"2025-03-25T15:06:08.159Z"}
{"level":"debug","message":"Executing query [m8omouqqtp7woydh0am]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",16]","timestamp":"2025-03-25T15:06:08.162Z"}
{"level":"debug","message":"Executing query [m8omouqu9t6rx5e3h3e]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[16]","timestamp":"2025-03-25T15:06:08.167Z"}
{"level":"debug","message":"Executing query [m8omouqyo5pmj3ae3nd]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[16]","timestamp":"2025-03-25T15:06:08.170Z"}
{"level":"debug","message":"Executing query [m8omour3r3kugupb1ch]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[16]","timestamp":"2025-03-25T15:06:08.175Z"}
{"level":"debug","message":"Executing query [m8omour5jlq45jjn9q]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[16]","timestamp":"2025-03-25T15:06:08.177Z"}
{"level":"debug","message":"Executing query [m8omour9ilg4ihhj26]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[16]","timestamp":"2025-03-25T15:06:08.181Z"}
{"level":"debug","message":"Executing query [m8omourcews0awhpfir]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:08.184Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:08.186Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:08.157Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:08.174Z"}
{"level":"debug","message":"Executing query [m8omour4rdox6ttvx6j]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:06:08.177Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:08.214Z"}
{"level":"debug","message":"Executing query [m8omousafga5jp48ymk]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T15:06:08.218Z"}
{"level":"debug","message":"Executing query [m8omouscb51y7h26k8t]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T15:06:08.220Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T15:06:08.222Z"}
{"level":"debug","message":"Executing query [m8omousf59scf8xirle]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:06:08.223Z"}
{"level":"debug","message":"Executing query [m8omoushguwg5bxh1f]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:06:08.225Z"}
{"level":"debug","message":"Executing query [m8omouskkccunppub6]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:06:08.228Z"}
{"level":"debug","message":"Executing query [m8omousl4el97k4zcim]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T15:06:08.229Z"}
{"level":"debug","message":"Executing query [m8omousrbig26ivjbgk]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[33]","timestamp":"2025-03-25T15:06:08.235Z"}
{"level":"debug","message":"Executing query [m8omousve3lg782l88]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:06:08.239Z"}
{"level":"debug","message":"Executing query [m8omousxfsv6kyrhlwv]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",33]","timestamp":"2025-03-25T15:06:08.242Z"}
{"level":"debug","message":"Executing query [m8omout2081ze2z3hqfv]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[33]","timestamp":"2025-03-25T15:06:08.246Z"}
{"level":"debug","message":"Executing query [m8omout47jzf0ptt7xc]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[33]","timestamp":"2025-03-25T15:06:08.248Z"}
{"level":"debug","message":"Executing query [m8omout75nbu174ex9k]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[33]","timestamp":"2025-03-25T15:06:08.251Z"}
{"level":"debug","message":"Executing query [m8omout9ukpti4j4d3e]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:06:08.253Z"}
{"level":"debug","message":"Executing query [m8omouta5btxyzsj9ei]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:06:08.254Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T15:06:08.256Z"}
{"level":"debug","message":"Executing query [m8omoutcpb48o2snw8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:06:08.256Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:08.258Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:08.448Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T15:06:08.660Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T15:06:08.674Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:08.874Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T15:06:08.891Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:08.958Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:09.009Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T15:06:09.177Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:09.287Z"}
{"level":"debug","message":"Executing query [m8omovmsnntu6bnbl7h]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T15:06:09.316Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:09.352Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:09.776Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:06:09.945Z"}
{"duration":"28ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T15:06:09.948Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T15:06:09.956Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:09.960Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:06:09.936Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:06:10.064Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T15:06:10.066Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T15:08:24.221Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T15:08:24.224Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.227Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.280Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.286Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.300Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.306Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.311Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.392Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.400Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T15:08:24.403Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:47.820Z"}
{"level":"debug","message":"Executing query [m8omuujnyhh944c2exa]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:47.843Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:47.880Z"}
{"level":"debug","message":"Executing query [m8omuukrq7yhhnaukk]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915447842\"]","timestamp":"2025-03-25T15:10:47.883Z"}
{"level":"debug","message":"Executing query [m8omuukve95mq7qjdrj]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915447842\"]","timestamp":"2025-03-25T15:10:47.887Z"}
{"level":"debug","message":"Executing query [m8omuukwemja70z4y8i]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742915447842\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:10:47.888Z"}
{"level":"debug","message":"Executing query [m8omuul3dz74mhx1k3]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1015]","timestamp":"2025-03-25T15:10:47.895Z"}
{"level":"debug","message":"Executing query [m8omuul55iopuz8u2tx]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915447842\"]","timestamp":"2025-03-25T15:10:47.897Z"}
{"level":"debug","message":"Executing query [m8omuul879l6gqcwlso]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1015]","timestamp":"2025-03-25T15:10:47.900Z"}
{"level":"debug","message":"Executing query [m8omuulbvdz5h75mlc]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1015]","timestamp":"2025-03-25T15:10:47.903Z"}
{"level":"debug","message":"Executing query [m8omuulehiw3i61hiv]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1015]","timestamp":"2025-03-25T15:10:47.906Z"}
{"level":"debug","message":"Executing query [m8omuulir4iivk514v]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1015]","timestamp":"2025-03-25T15:10:47.910Z"}
{"level":"debug","message":"Executing query [m8omuullb9nmjkz752r]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1015]","timestamp":"2025-03-25T15:10:47.913Z"}
{"level":"debug","message":"Executing query [m8omuulm1o96sq7s1c1]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1015]","timestamp":"2025-03-25T15:10:47.914Z"}
{"level":"debug","message":"Executing query [m8omuulqnif1twxmwq]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1015]","timestamp":"2025-03-25T15:10:47.918Z"}
{"level":"debug","message":"Executing query [m8omuulsdb9gxwoj92v]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T15:10:47.920Z"}
{"level":"debug","message":"Executing query [m8omuululcufq9ay6b]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:47.922Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:47.924Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:10:48.016Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:10:48.019Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:10:48.020Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:10:48.022Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:10:48.028Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:10:48.031Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:10:48.033Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:10:48.036Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:10:48.039Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:10:48.040Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:10:48.042Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T15:10:48.043Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:48.226Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:49.177Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T15:10:49.320Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T15:10:49.326Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:49.381Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T15:10:49.395Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:49.438Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:49.924Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:50.044Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:50.062Z"}
{"level":"debug","message":"Executing query [m8omuw9cq0daqacdllb]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T15:10:50.064Z"}
{"level":"debug","message":"Executing query [m8omuw9f11w865s3a0pg]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T15:10:50.067Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8omuw9f11w865s3a0pg]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T15:10:50.069Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:50.071Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:50.188Z"}
{"level":"debug","message":"Executing query [m8omuwcv38f2ud5sfu7]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:50.191Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:50.205Z"}
{"level":"debug","message":"Executing query [m8omuwdbc6dp7swa1al]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T15:10:50.207Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T15:10:50.208Z"}
{"level":"debug","message":"Executing query [m8omuwdcaj5e0soq47e]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T15:10:50.208Z"}
{"level":"debug","message":"Executing query [m8omuwdd2q1l4ivi414]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T15:10:50.209Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T15:10:50.210Z"}
{"level":"debug","message":"Executing query [m8omuwde4yw06lg6cmr]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T15:10:50.210Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T15:10:50.212Z"}
{"level":"debug","message":"Executing query [m8omuwdk5jf0pmwk4z8]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T15:10:50.216Z"}
{"level":"debug","message":"Executing query [m8omuwdnoi3gx1zffqj]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T15:10:50.219Z"}
{"level":"debug","message":"Executing query [m8omuwdpckb6pugzvj8]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[31]","timestamp":"2025-03-25T15:10:50.221Z"}
{"level":"debug","message":"Executing query [m8omuwdutcftgi9tuf9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:50.226Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:51.980Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T15:10:52.042Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T15:10:52.048Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:52.056Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T15:10:52.059Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T15:10:52.160Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T15:10:52.262Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:52.393Z"}
{"level":"debug","message":"Executing query [m8omuy230e56m8udpcb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:52.395Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:52.407Z"}
{"level":"debug","message":"Executing query [m8omuy2gv9cvc3p4x6h]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:10:52.408Z"}
{"level":"debug","message":"Executing query [m8omuy2ijrt7c52t36n]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742915452395\"]","timestamp":"2025-03-25T15:10:52.410Z"}
{"level":"debug","message":"Executing query [m8omuy2j1ypun7w953l]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742915452395\",\"TEST-OFICIO-1742915452395\",157,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:10:52.411Z"}
{"level":"debug","message":"Executing query [m8omuy2p4j8dxf475wu]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.417Z"}
{"level":"debug","message":"Executing query [m8omuy2tb11c8l0x0l8]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742915452395\"]","timestamp":"2025-03-25T15:10:52.421Z"}
{"level":"debug","message":"Executing query [m8omuy2vqzufxrupc5b]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",33]","timestamp":"2025-03-25T15:10:52.423Z"}
{"level":"debug","message":"Executing query [m8omuy2ydy65co165rh]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.426Z"}
{"level":"debug","message":"Executing query [m8omuy30o5mygtewh2]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.428Z"}
{"level":"debug","message":"Executing query [m8omuy330uihrip18p2]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.431Z"}
{"level":"debug","message":"Executing query [m8omuy362jgpugcon1h]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.434Z"}
{"level":"debug","message":"Executing query [m8omuy3989jw6e9a44w]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.437Z"}
{"level":"debug","message":"Executing query [m8omuy3amrwub20p6h]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742915452438\",\"TEST-SP-OFICIO-1742915452438\",5475,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T15:10:52.438Z"}
{"level":"debug","message":"Executing query [m8omuy3ebiljbrwu88r]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742915452438\"]","timestamp":"2025-03-25T15:10:52.442Z"}
{"level":"debug","message":"Executing query [m8omuy3gj0tzbzbkgh]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742915452438\"]","timestamp":"2025-03-25T15:10:52.444Z"}
{"level":"debug","message":"Executing query [m8omuy3lxqav82vmzc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:52.449Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:52.450Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:52.632Z"}
{"level":"debug","message":"Executing query [m8omuy8rjd1gth7aa6]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:52.635Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:52.647Z"}
{"level":"debug","message":"Executing query [m8omuy96tmvb6qvzg19]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:10:52.650Z"}
{"level":"debug","message":"Executing query [m8omuy97ije343y2dcn]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742915452633\"]","timestamp":"2025-03-25T15:10:52.651Z"}
{"level":"debug","message":"Executing query [m8omuy99w28fx09jzbd]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742915452633\",\"TEST-OFI-FORENSE-1742915452633\",7910,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742915452633\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:10:52.653Z"}
{"level":"debug","message":"Executing query [m8omuy9dtl7osioitmb]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.657Z"}
{"level":"debug","message":"Executing query [m8omuy9g5wsno6dwrae]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742915452633\"]","timestamp":"2025-03-25T15:10:52.660Z"}
{"level":"debug","message":"Executing query [m8omuy9hppd6p1in2fo]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",33]","timestamp":"2025-03-25T15:10:52.661Z"}
{"level":"debug","message":"Executing query [m8omuy9ltasl2ylqkof]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.665Z"}
{"level":"debug","message":"Executing query [m8omuy9nodjda4qz1b]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.667Z"}
{"level":"debug","message":"Executing query [m8omuy9qm1pacqi2ca]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.670Z"}
{"level":"debug","message":"Executing query [m8omuy9slqgjh6376hd]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.672Z"}
{"level":"debug","message":"Executing query [m8omuy9upuqzn42h31g]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[33]","timestamp":"2025-03-25T15:10:52.674Z"}
{"level":"debug","message":"Executing query [m8omuy9xhjdbsvah5mg]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742915452677\",\"TEST-SP-OFI-FORENSE-1742915452677\",2795,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T15:10:52.677Z"}
{"level":"debug","message":"Executing query [m8omuya0eqf8771p1zr]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742915452677\"]","timestamp":"2025-03-25T15:10:52.680Z"}
{"level":"debug","message":"Executing query [m8omuya1gyh7u6pamo]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742915452677\"]","timestamp":"2025-03-25T15:10:52.681Z"}
{"level":"debug","message":"Executing query [m8omuya49eomj17lazi]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:52.684Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:52.686Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:53.486Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:53.533Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T15:10:53.534Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T15:10:53.628Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T15:10:53.629Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T15:10:53.630Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T15:10:53.631Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T15:10:53.632Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T15:10:53.632Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:54.004Z"}
{"level":"debug","message":"Executing query [m8omuzau63k5xa6pwnh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:54.007Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:54.018Z"}
{"level":"debug","message":"Executing query [m8omuzb7gyb67y570yq]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742915454006\"]","timestamp":"2025-03-25T15:10:54.019Z"}
{"level":"debug","message":"Executing query [m8omuzb8mu6068q4ujr]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742915454006\",true]","timestamp":"2025-03-25T15:10:54.021Z"}
{"level":"debug","message":"Executing query [m8omuzbf9fp128z235b]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.027Z"}
{"level":"debug","message":"Executing query [m8omuzbhscezlq74gp]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742915454006\"]","timestamp":"2025-03-25T15:10:54.029Z"}
{"level":"debug","message":"Executing query [m8omuzbkbtid5jq6joo]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",33]","timestamp":"2025-03-25T15:10:54.032Z"}
{"level":"debug","message":"Executing query [m8omuzboc9chorcfs27]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.036Z"}
{"level":"debug","message":"Executing query [m8omuzbq6tkfe5mb3bn]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.039Z"}
{"level":"debug","message":"Executing query [m8omuzbui1mtrpp69x]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.042Z"}
{"level":"debug","message":"Executing query [m8omuzbvff7hqiir705]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.043Z"}
{"level":"debug","message":"Executing query [m8omuzbyhf2ujbif8cd]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.046Z"}
{"level":"debug","message":"Executing query [m8omuzc1d0dzbcdxxbu]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.049Z"}
{"level":"debug","message":"Executing query [m8omuzc2n2ie30rkmim]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T15:10:54.050Z"}
{"level":"debug","message":"Executing query [m8omuzc5stzr3t66ufb]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:54.053Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:54.054Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:54.228Z"}
{"level":"debug","message":"Executing query [m8omuzh2eksws9s1494]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:54.230Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:54.241Z"}
{"level":"debug","message":"Executing query [m8omuzhezo2mih2bam8]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:10:54.242Z"}
{"level":"debug","message":"Executing query [m8omuzhf66u9oaq2jdi]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T15:10:54.243Z"}
{"level":"debug","message":"Executing query [m8omuzhgixaabmefj4d]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T15:10:54.244Z"}
{"level":"debug","message":"Executing query [m8omuzhh0fmb5wu2hz04]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T15:10:54.245Z"}
{"level":"debug","message":"Executing query [m8omuzhmqg6rhglcrut]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T15:10:54.250Z"}
{"level":"debug","message":"Executing query [m8omuzhq86dalb6mv4v]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[34,888,34,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T15:10:54.254Z\",\"ACTIVO\"]","timestamp":"2025-03-25T15:10:54.254Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 34, Área ID: 888, Rol ID: 888, Documento ID: 33","timestamp":"2025-03-25T15:10:54.257Z"}
{"level":"debug","message":"Executing query [m8omuzhu5bytxkei5hg]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[33,34,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T15:10:54.258Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omuzhu5bytxkei5hg]","params":"[33,34,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T15:10:54.264Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T15:10:54.264Z"}
{"level":"debug","message":"Executing query [m8omuzi0oubqecmk0sl]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.264Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omuzi0oubqecmk0sl]","params":"[33]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T15:10:54.269Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T15:10:54.270Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T15:10:54.270Z"}
{"level":"debug","message":"Executing query [m8omuzi7cp8mpzuoyy]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[33,34,\"RESTAURAR\"]","timestamp":"2025-03-25T15:10:54.271Z"}
{"level":"debug","message":"Executing query [m8omuzicxgmvgdzu3ql]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.276Z"}
{"level":"debug","message":"Executing query [m8omuziepgfpkzsy0pp]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[33,34,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T15:10:54.278Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omuziepgfpkzsy0pp]","params":"[33,34,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T15:10:54.282Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T15:10:54.282Z"}
{"level":"debug","message":"Executing query [m8omuzij903ykw2a10u]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[33]","timestamp":"2025-03-25T15:10:54.283Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omuzij903ykw2a10u]","params":"[33]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T15:10:54.285Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T15:10:54.285Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T15:10:54.285Z"}
{"level":"debug","message":"Executing query [m8omuzim0ca8y7fh5stt]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[34,888,34,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T15:10:54.286Z\",\"ACTIVO\"]","timestamp":"2025-03-25T15:10:54.286Z"}
{"level":"debug","message":"Executing query [m8omuziqiy4nn3jgci]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T15:10:54.290Z"}
{"level":"debug","message":"Executing query [m8omuzitsz0dgffxtmm]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[34,\"DOCUMENTO\",34,\"ELIMINAR\"]","timestamp":"2025-03-25T15:10:54.293Z"}
{"level":"debug","message":"Executing query [m8omuzixu890g7c8ti]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[34]","timestamp":"2025-03-25T15:10:54.297Z"}
{"level":"debug","message":"Executing query [m8omuzj0l93qaaph0z]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T15:10:54.300Z"}
{"level":"debug","message":"Executing query [m8omuzj471udc9ytsxi]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[34]","timestamp":"2025-03-25T15:10:54.304Z"}
{"level":"debug","message":"Executing query [m8omuzj7sma9vtdmelf]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:10:54.307Z"}
{"level":"debug","message":"Executing query [m8omuzj8vejze7t6rki]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:10:54.308Z"}
{"level":"debug","message":"Executing query [m8omuzj9wf0mngvoo6m]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:10:54.309Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T15:10:54.313Z"}
{"level":"debug","message":"Executing query [m8omuzjdzg0vcsk0n7e]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:54.313Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:54.314Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:54.412Z"}
{"level":"debug","message":"Executing query [m8omuzm74ndkimswtr4]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:54.415Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:54.424Z"}
{"level":"debug","message":"Executing query [m8omuzmi4gekvxh5lul]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T15:10:54.426Z"}
{"level":"debug","message":"Executing query [m8omuzmkbs4c8fxtg9j]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T15:10:54.428Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T15:10:54.429Z"}
{"level":"debug","message":"Executing query [m8omuzmlk26pe4hrji]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T15:10:54.429Z"}
{"level":"debug","message":"Executing query [m8omuzmmkczba2htzok]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T15:10:54.430Z"}
{"level":"debug","message":"Executing query [m8omuzmnb0uiy2m6wwb]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T15:10:54.431Z"}
{"level":"debug","message":"Executing query [m8omuzmrdy97ick5v6t]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[34]","timestamp":"2025-03-25T15:10:54.435Z"}
{"level":"debug","message":"Executing query [m8omuzmuqcdv75kgdok]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[34]","timestamp":"2025-03-25T15:10:54.438Z"}
{"level":"debug","message":"Executing query [m8omuzmwae4hzdpop7m]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",34]","timestamp":"2025-03-25T15:10:54.440Z"}
{"level":"debug","message":"Executing query [m8omuzmz612xhe0gyel]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[34]","timestamp":"2025-03-25T15:10:54.444Z"}
{"level":"debug","message":"Executing query [m8omuzn1wbxag3mgye]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[34]","timestamp":"2025-03-25T15:10:54.445Z"}
{"level":"debug","message":"Executing query [m8omuzn4k0nruzknxk]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[34]","timestamp":"2025-03-25T15:10:54.448Z"}
{"level":"debug","message":"Executing query [m8omuzn6q7jjkf9vif]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:54.450Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:54.451Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:54.618Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:55.024Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T15:10:55.087Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:55.136Z"}
{"level":"debug","message":"Executing query [m8omv06v6pnc40a3ge7]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T15:10:55.159Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:55.186Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:55.367Z"}
{"level":"debug","message":"Executing query [m8omv0cpwy0ginxquvr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:55.369Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:55.382Z"}
{"level":"debug","message":"Executing query [m8omv0d3ei217yg9ly7]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:10:55.383Z"}
{"level":"debug","message":"Executing query [m8omv0d6j2ecxqk21mq]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742915455368\"]","timestamp":"2025-03-25T15:10:55.386Z"}
{"level":"debug","message":"Executing query [m8omv0d7sq6qja8mta9]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742915455368\",\"TEST-OFI-QUIMICA-1742915455368\",1000,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:10:55.387Z"}
{"level":"debug","message":"Executing query [m8omv0dd9oqzzmmcfpu]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[17]","timestamp":"2025-03-25T15:10:55.393Z"}
{"level":"debug","message":"Executing query [m8omv0dg98zxb5lxauh]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742915455368\"]","timestamp":"2025-03-25T15:10:55.396Z"}
{"level":"debug","message":"Executing query [m8omv0dh9vm7o1mzr1d]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",17]","timestamp":"2025-03-25T15:10:55.397Z"}
{"level":"debug","message":"Executing query [m8omv0dloo4mxnidrk]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[17]","timestamp":"2025-03-25T15:10:55.401Z"}
{"level":"debug","message":"Executing query [m8omv0dn821mj2nr02y]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[17]","timestamp":"2025-03-25T15:10:55.403Z"}
{"level":"debug","message":"Executing query [m8omv0dqz6zi9vtm0o]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[17]","timestamp":"2025-03-25T15:10:55.406Z"}
{"level":"debug","message":"Executing query [m8omv0ds0yqb4dizxxsj]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[17]","timestamp":"2025-03-25T15:10:55.408Z"}
{"level":"debug","message":"Executing query [m8omv0dwmioxa8ogiae]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[17]","timestamp":"2025-03-25T15:10:55.412Z"}
{"level":"debug","message":"Executing query [m8omv0dzdxrfslue6el]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:55.415Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:55.416Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:55.965Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:10:55.969Z"}
{"level":"debug","message":"Executing query [m8omv0tf140zr1wwfhr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:10:55.971Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:10:55.980Z"}
{"level":"debug","message":"Executing query [m8omv0tq7ssiq2c9e6v]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T15:10:55.982Z"}
{"level":"debug","message":"Executing query [m8omv0tsa8alu9dla9k]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T15:10:55.984Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T15:10:55.985Z"}
{"level":"debug","message":"Executing query [m8omv0ttpatjbxse1f]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:10:55.985Z"}
{"level":"debug","message":"Executing query [m8omv0tu2vrauq0t7tk]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:10:55.986Z"}
{"level":"debug","message":"Executing query [m8omv0tvjvtodh5imvi]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:10:55.987Z"}
{"level":"debug","message":"Executing query [m8omv0tw3a9jdrl742a]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T15:10:55.988Z"}
{"level":"debug","message":"Executing query [m8omv0u2vg399h4nzb]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[35]","timestamp":"2025-03-25T15:10:55.994Z"}
{"level":"debug","message":"Executing query [m8omv0u6dv03jf8665g]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:10:55.998Z"}
{"level":"debug","message":"Executing query [m8omv0u8f93fsimzc74]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",35]","timestamp":"2025-03-25T15:10:56.000Z"}
{"level":"debug","message":"Executing query [m8omv0udlhwbqus6n1s]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[35]","timestamp":"2025-03-25T15:10:56.005Z"}
{"level":"debug","message":"Executing query [m8omv0uffl2l974rv2]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[35]","timestamp":"2025-03-25T15:10:56.007Z"}
{"level":"debug","message":"Executing query [m8omv0uiqsp7sbk9a6]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[35]","timestamp":"2025-03-25T15:10:56.010Z"}
{"level":"debug","message":"Executing query [m8omv0ujrkfr38po74k]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:10:56.012Z"}
{"level":"debug","message":"Executing query [m8omv0uk8rtf3c9i84j]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:10:56.012Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T15:10:56.013Z"}
{"level":"debug","message":"Executing query [m8omv0ulbu9cm1cxvq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:10:56.013Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:10:56.014Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:13:55.886Z"}
{"level":"debug","message":"Executing query [m8omyvnoj4w07s8mny]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:13:55.908Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:13:55.943Z"}
{"level":"debug","message":"Executing query [m8omyvoqeoby05f3cbe]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915635907\"]","timestamp":"2025-03-25T15:13:55.947Z"}
{"level":"debug","message":"Executing query [m8omyvoutzgnbm6903l]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915635907\"]","timestamp":"2025-03-25T15:13:55.950Z"}
{"level":"debug","message":"Executing query [m8omyvov96aq03qctba]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742915635907\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:13:55.951Z"}
{"level":"debug","message":"Executing query [m8omyvp2pl3pmnbdy7k]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1016]","timestamp":"2025-03-25T15:13:55.958Z"}
{"level":"debug","message":"Executing query [m8omyvp5r93ijffhhni]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742915635907\"]","timestamp":"2025-03-25T15:13:55.961Z"}
{"level":"debug","message":"Executing query [m8omyvp8ad4c8yps5gb]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1016]","timestamp":"2025-03-25T15:13:55.964Z"}
{"level":"debug","message":"Executing query [m8omyvpc7q0nqi28107]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1016]","timestamp":"2025-03-25T15:13:55.968Z"}
{"level":"debug","message":"Executing query [m8omyvpeis6k6v5uwns]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1016]","timestamp":"2025-03-25T15:13:55.970Z"}
{"level":"debug","message":"Executing query [m8omyvpgfb7dhigvn4c]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1016]","timestamp":"2025-03-25T15:13:55.973Z"}
{"level":"debug","message":"Executing query [m8omyvpk1ocwek9xcra]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1016]","timestamp":"2025-03-25T15:13:55.976Z"}
{"level":"debug","message":"Executing query [m8omyvplju4y9ael27]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1016]","timestamp":"2025-03-25T15:13:55.977Z"}
{"level":"debug","message":"Executing query [m8omyvpnud686o6qu7e]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1016]","timestamp":"2025-03-25T15:13:55.979Z"}
{"level":"debug","message":"Executing query [m8omyvpq9goqm1gll9u]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T15:13:55.982Z"}
{"level":"debug","message":"Executing query [m8omyvps2s71d49ulyt]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:13:55.984Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:13:55.986Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:13:56.081Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:13:56.084Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:13:56.086Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:13:56.088Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:13:56.090Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:13:56.095Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T15:13:56.097Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:13:56.100Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:13:56.101Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:13:56.103Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:13:56.104Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T15:13:56.106Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:13:56.284Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:13:57.218Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T15:13:57.359Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T15:13:57.365Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:13:57.417Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T15:13:57.431Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:13:57.478Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:13:58.056Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:13:58.287Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:13:58.304Z"}
{"level":"debug","message":"Executing query [m8omyxi9bek4fr1mppm]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T15:13:58.306Z"}
{"level":"debug","message":"Executing query [m8omyxictx0ontue4pc]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T15:13:58.308Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8omyxictx0ontue4pc]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T15:13:58.310Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:13:58.311Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:13:58.411Z"}
{"level":"debug","message":"Executing query [m8omyxlaspr2h4lk1jn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:13:58.414Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:13:58.430Z"}
{"level":"debug","message":"Executing query [m8omyxls6zemqjxzvth]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T15:13:58.432Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T15:13:58.434Z"}
{"level":"debug","message":"Executing query [m8omyxlv4vvyh2tew76]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T15:13:58.435Z"}
{"level":"debug","message":"Executing query [m8omyxlx55rysr7fsdk]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T15:13:58.437Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T15:13:58.439Z"}
{"level":"debug","message":"Executing query [m8omyxm0p7514t2h2xp]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T15:13:58.440Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T15:13:58.442Z"}
{"level":"debug","message":"Executing query [m8omyxm79r7y5jssdx5]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T15:13:58.447Z"}
{"level":"debug","message":"Executing query [m8omyxmgc0g21ntj4bu]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T15:13:58.456Z"}
{"level":"debug","message":"Executing query [m8omyxmis1baidtzmbs]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[33]","timestamp":"2025-03-25T15:13:58.458Z"}
{"level":"debug","message":"Executing query [m8omyxmo1cajwvf9t5q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:13:58.464Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:00.128Z"}
{"duration":"8ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T15:14:00.194Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:00.195Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T15:14:00.197Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:00.204Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T15:14:00.300Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T15:14:00.398Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:00.519Z"}
{"level":"debug","message":"Executing query [m8omyz7tsm00r5lvy5m]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:14:00.521Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:00.531Z"}
{"level":"debug","message":"Executing query [m8omyz85ex4orty9nnp]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:14:00.533Z"}
{"level":"debug","message":"Executing query [m8omyz87gxbg0z00xr8]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742915640520\"]","timestamp":"2025-03-25T15:14:00.535Z"}
{"level":"debug","message":"Executing query [m8omyz88ip9vgmlxhr]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742915640520\",\"TEST-OFICIO-1742915640520\",5512,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:14:00.537Z"}
{"level":"debug","message":"Executing query [m8omyz8dj41tftan2xe]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.541Z"}
{"level":"debug","message":"Executing query [m8omyz8gpatlpo6mclg]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742915640520\"]","timestamp":"2025-03-25T15:14:00.545Z"}
{"level":"debug","message":"Executing query [m8omyz8lujncdez03d]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",35]","timestamp":"2025-03-25T15:14:00.549Z"}
{"level":"debug","message":"Executing query [m8omyz8psublh4wjxub]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.553Z"}
{"level":"debug","message":"Executing query [m8omyz8rcia08serctm]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.555Z"}
{"level":"debug","message":"Executing query [m8omyz8t0mq7qi372zd]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.558Z"}
{"level":"debug","message":"Executing query [m8omyz8v2cnx7s0y26]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.560Z"}
{"level":"debug","message":"Executing query [m8omyz8y0ueb8wygbxjj]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.562Z"}
{"level":"debug","message":"Executing query [m8omyz913f5dlxuzl0u]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742915640565\",\"TEST-SP-OFICIO-1742915640565\",8760,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T15:14:00.565Z"}
{"level":"debug","message":"Executing query [m8omyz94qfnfwpjoq4m]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742915640565\"]","timestamp":"2025-03-25T15:14:00.568Z"}
{"level":"debug","message":"Executing query [m8omyz952skp5fvhye]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742915640565\"]","timestamp":"2025-03-25T15:14:00.569Z"}
{"level":"debug","message":"Executing query [m8omyz9863b7ocri7c]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:14:00.572Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:00.573Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:00.754Z"}
{"level":"debug","message":"Executing query [m8omyzedpwyrd9v0ac]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:14:00.757Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:00.766Z"}
{"level":"debug","message":"Executing query [m8omyzen4gxfs052y0l]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:14:00.768Z"}
{"level":"debug","message":"Executing query [m8omyzepfvdajz6k58u]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742915640756\"]","timestamp":"2025-03-25T15:14:00.769Z"}
{"level":"debug","message":"Executing query [m8omyzeq4hzz34zt76f]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742915640756\",\"TEST-OFI-FORENSE-1742915640756\",638,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742915640756\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:14:00.770Z"}
{"level":"debug","message":"Executing query [m8omyzex7iaeyk9r7io]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.777Z"}
{"level":"debug","message":"Executing query [m8omyzf0wlz6722t9lq]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742915640756\"]","timestamp":"2025-03-25T15:14:00.780Z"}
{"level":"debug","message":"Executing query [m8omyzf3r7t51333ggc]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",35]","timestamp":"2025-03-25T15:14:00.783Z"}
{"level":"debug","message":"Executing query [m8omyzf7vlvn83znqtr]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.787Z"}
{"level":"debug","message":"Executing query [m8omyzf9w1e7auti7v9]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.789Z"}
{"level":"debug","message":"Executing query [m8omyzfcvhaljh9p63i]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.792Z"}
{"level":"debug","message":"Executing query [m8omyzfflzk6z05z0a7]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.795Z"}
{"level":"debug","message":"Executing query [m8omyzfhw7f5osn1x3]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[35]","timestamp":"2025-03-25T15:14:00.797Z"}
{"level":"debug","message":"Executing query [m8omyzfit5tesdvfqk]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742915640798\",\"TEST-SP-OFI-FORENSE-1742915640798\",1195,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T15:14:00.798Z"}
{"level":"debug","message":"Executing query [m8omyzfmkd9ow32gst]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742915640798\"]","timestamp":"2025-03-25T15:14:00.802Z"}
{"level":"debug","message":"Executing query [m8omyzfowhq7rorkl5r]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742915640798\"]","timestamp":"2025-03-25T15:14:00.804Z"}
{"level":"debug","message":"Executing query [m8omyzfqvh67bklg86p]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:14:00.806Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:00.808Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:01.616Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:01.664Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T15:14:01.666Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T15:14:01.756Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T15:14:01.757Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T15:14:01.758Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T15:14:01.759Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T15:14:01.760Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T15:14:01.760Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:02.123Z"}
{"level":"debug","message":"Executing query [m8omz0gdwxhbfjp9vq]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:14:02.125Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:02.135Z"}
{"level":"debug","message":"Executing query [m8omz0gpy5gfjcf93fs]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742915642124\"]","timestamp":"2025-03-25T15:14:02.137Z"}
{"level":"debug","message":"Executing query [m8omz0gqly3ttot26nb]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742915642124\",true]","timestamp":"2025-03-25T15:14:02.139Z"}
{"level":"debug","message":"Executing query [m8omz0gwlpfvugbbmx]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.144Z"}
{"level":"debug","message":"Executing query [m8omz0gyagx8f2u16lw]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742915642124\"]","timestamp":"2025-03-25T15:14:02.146Z"}
{"level":"debug","message":"Executing query [m8omz0h1wnmah9sr4u]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",35]","timestamp":"2025-03-25T15:14:02.149Z"}
{"level":"debug","message":"Executing query [m8omz0h4e5zb0bamgw9]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.152Z"}
{"level":"debug","message":"Executing query [m8omz0h69cbqkuefoq]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.154Z"}
{"level":"debug","message":"Executing query [m8omz0ha94vf031ihvo]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.158Z"}
{"level":"debug","message":"Executing query [m8omz0hc07enfhcetz85]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.160Z"}
{"level":"debug","message":"Executing query [m8omz0hh0wgvilmtqof]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.165Z"}
{"level":"debug","message":"Executing query [m8omz0hl26jz8dmx6th]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.169Z"}
{"level":"debug","message":"Executing query [m8omz0hmb6k1a77ozuk]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T15:14:02.170Z"}
{"level":"debug","message":"Executing query [m8omz0ho7tfuokvd34a]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:14:02.172Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:02.172Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:02.343Z"}
{"level":"debug","message":"Executing query [m8omz0mh436h6ubttq5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:14:02.345Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:02.355Z"}
{"level":"debug","message":"Executing query [m8omz0mtzg6s3n0m56]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:14:02.357Z"}
{"level":"debug","message":"Executing query [m8omz0muhwbp5gnd6pe]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T15:14:02.358Z"}
{"level":"debug","message":"Executing query [m8omz0mv6llcfjyf6xn]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T15:14:02.359Z"}
{"level":"debug","message":"Executing query [m8omz0mwblb8ee55wk]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T15:14:02.360Z"}
{"level":"debug","message":"Executing query [m8omz0n0jpk6ru0g9i9]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T15:14:02.364Z"}
{"level":"debug","message":"Executing query [m8omz0n3msgdkuwbcna]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[36,888,36,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T15:14:02.367Z\",\"ACTIVO\"]","timestamp":"2025-03-25T15:14:02.367Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 36, Área ID: 888, Rol ID: 888, Documento ID: 35","timestamp":"2025-03-25T15:14:02.371Z"}
{"level":"debug","message":"Executing query [m8omz0n813h4ja34jrjo]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[35,36,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T15:14:02.372Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omz0n813h4ja34jrjo]","params":"[35,36,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T15:14:02.376Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T15:14:02.377Z"}
{"level":"debug","message":"Executing query [m8omz0ndeq8l0wgjywn]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.377Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omz0ndeq8l0wgjywn]","params":"[35]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T15:14:02.379Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T15:14:02.380Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T15:14:02.380Z"}
{"level":"debug","message":"Executing query [m8omz0nh9gqn3qr126]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[35,36,\"RESTAURAR\"]","timestamp":"2025-03-25T15:14:02.381Z"}
{"level":"debug","message":"Executing query [m8omz0nmlkx0dpu87m]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.386Z"}
{"level":"debug","message":"Executing query [m8omz0noey8ew0k0pt5]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[35,36,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T15:14:02.388Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omz0noey8ew0k0pt5]","params":"[35,36,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T15:14:02.392Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T15:14:02.392Z"}
{"level":"debug","message":"Executing query [m8omz0nt8j7mf79duza]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[35]","timestamp":"2025-03-25T15:14:02.393Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8omz0nt8j7mf79duza]","params":"[35]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T15:14:02.394Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T15:14:02.395Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T15:14:02.395Z"}
{"level":"debug","message":"Executing query [m8omz0nw1570w1pgl8q]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[36,888,36,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T15:14:02.396Z\",\"ACTIVO\"]","timestamp":"2025-03-25T15:14:02.396Z"}
{"level":"debug","message":"Executing query [m8omz0nzo4dwgvr5a7]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T15:14:02.399Z"}
{"level":"debug","message":"Executing query [m8omz0o2r6mcr6v8dqi]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[36,\"DOCUMENTO\",36,\"ELIMINAR\"]","timestamp":"2025-03-25T15:14:02.402Z"}
{"level":"debug","message":"Executing query [m8omz0o3q0gb7css1d]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[36]","timestamp":"2025-03-25T15:14:02.403Z"}
{"level":"debug","message":"Executing query [m8omz0o7nwtinew4xss]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T15:14:02.407Z"}
{"level":"debug","message":"Executing query [m8omz0oal2h8lfykr6]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[36]","timestamp":"2025-03-25T15:14:02.410Z"}
{"level":"debug","message":"Executing query [m8omz0oegoophx09jic]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:14:02.414Z"}
{"level":"debug","message":"Executing query [m8omz0ofh3c06689xza]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:14:02.415Z"}
{"level":"debug","message":"Executing query [m8omz0og24rht2u9am4]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:14:02.416Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T15:14:02.419Z"}
{"level":"debug","message":"Executing query [m8omz0ojstq4ma1018]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:14:02.419Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:02.421Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:02.519Z"}
{"level":"debug","message":"Executing query [m8omz0rewwr9evmxjb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:14:02.522Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:02.532Z"}
{"level":"debug","message":"Executing query [m8omz0rpl9brmp3je6c]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T15:14:02.533Z"}
{"level":"debug","message":"Executing query [m8omz0rqf8hqk72fh2p]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T15:14:02.534Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T15:14:02.535Z"}
{"level":"debug","message":"Executing query [m8omz0rrvx2fuf2rs5]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T15:14:02.535Z"}
{"level":"debug","message":"Executing query [m8omz0rtnqplsac8759]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T15:14:02.537Z"}
{"level":"debug","message":"Executing query [m8omz0rx4qvjnq3qh3b]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T15:14:02.541Z"}
{"level":"debug","message":"Executing query [m8omz0s3c6n3jsdzdj]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[36]","timestamp":"2025-03-25T15:14:02.548Z"}
{"level":"debug","message":"Executing query [m8omz0s81str973o6gk]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[36]","timestamp":"2025-03-25T15:14:02.552Z"}
{"level":"debug","message":"Executing query [m8omz0sa7tyvnbftjkj]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",36]","timestamp":"2025-03-25T15:14:02.554Z"}
{"level":"debug","message":"Executing query [m8omz0sehg2qxkxeyyn]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[36]","timestamp":"2025-03-25T15:14:02.558Z"}
{"level":"debug","message":"Executing query [m8omz0sf86uq31fb02r]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[36]","timestamp":"2025-03-25T15:14:02.559Z"}
{"level":"debug","message":"Executing query [m8omz0simlx1wobekp]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[36]","timestamp":"2025-03-25T15:14:02.562Z"}
{"level":"debug","message":"Executing query [m8omz0sj132tn7sls5q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:14:02.563Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:02.565Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:02.727Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:03.113Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T15:14:03.168Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:03.222Z"}
{"level":"debug","message":"Executing query [m8omz1c1r9tuixalvk]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T15:14:03.266Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:03.296Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:03.486Z"}
{"level":"debug","message":"Executing query [m8omz1i9wu4f5teoz3]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:14:03.490Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:03.499Z"}
{"level":"debug","message":"Executing query [m8omz1ikwye8yxiky2]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:14:03.500Z"}
{"level":"debug","message":"Executing query [m8omz1imdv24yr0mwqo]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742915643489\"]","timestamp":"2025-03-25T15:14:03.502Z"}
{"level":"debug","message":"Executing query [m8omz1ios0zuxupmfac]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742915643489\",\"TEST-OFI-QUIMICA-1742915643489\",9182,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:14:03.504Z"}
{"level":"debug","message":"Executing query [m8omz1iua7chqw3uo27]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[18]","timestamp":"2025-03-25T15:14:03.510Z"}
{"level":"debug","message":"Executing query [m8omz1ix3scw8gtx4ar]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742915643489\"]","timestamp":"2025-03-25T15:14:03.513Z"}
{"level":"debug","message":"Executing query [m8omz1j3i7e7z2w1dg8]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",18]","timestamp":"2025-03-25T15:14:03.519Z"}
{"level":"debug","message":"Executing query [m8omz1j6rp9bso8o1vc]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[18]","timestamp":"2025-03-25T15:14:03.522Z"}
{"level":"debug","message":"Executing query [m8omz1j9335jc82l7k]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[18]","timestamp":"2025-03-25T15:14:03.525Z"}
{"level":"debug","message":"Executing query [m8omz1jc659qmssw8aq]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[18]","timestamp":"2025-03-25T15:14:03.528Z"}
{"level":"debug","message":"Executing query [m8omz1jf4afq64qxsgz]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[18]","timestamp":"2025-03-25T15:14:03.531Z"}
{"level":"debug","message":"Executing query [m8omz1jixoaz140ndhq]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[18]","timestamp":"2025-03-25T15:14:03.534Z"}
{"level":"debug","message":"Executing query [m8omz1jjvctwoi9447i]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:14:03.535Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:03.537Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:04.214Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:14:04.217Z"}
{"level":"debug","message":"Executing query [m8omz22jg6kllrr1q48]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:14:04.219Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:14:04.228Z"}
{"level":"debug","message":"Executing query [m8omz22tv2ww0lj3jz9]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T15:14:04.229Z"}
{"level":"debug","message":"Executing query [m8omz22u1mry1lde436]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T15:14:04.230Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T15:14:04.232Z"}
{"level":"debug","message":"Executing query [m8omz22wu6wby75f169]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:14:04.232Z"}
{"level":"debug","message":"Executing query [m8omz22xlzyhofgwztj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:14:04.233Z"}
{"level":"debug","message":"Executing query [m8omz22zo5hhq7mdes]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:14:04.235Z"}
{"level":"debug","message":"Executing query [m8omz22zcaj4xptlr5j]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T15:14:04.235Z"}
{"level":"debug","message":"Executing query [m8omz235hrovr94xok]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[37]","timestamp":"2025-03-25T15:14:04.241Z"}
{"level":"debug","message":"Executing query [m8omz237pw0ko16jnsa]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:14:04.243Z"}
{"level":"debug","message":"Executing query [m8omz23a4elx7nt6z3e]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",37]","timestamp":"2025-03-25T15:14:04.246Z"}
{"level":"debug","message":"Executing query [m8omz23d002cfc02j8tvq]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[37]","timestamp":"2025-03-25T15:14:04.249Z"}
{"level":"debug","message":"Executing query [m8omz23elh82cl8c5es]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[37]","timestamp":"2025-03-25T15:14:04.250Z"}
{"level":"debug","message":"Executing query [m8omz23im9bbb4tvjfo]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[37]","timestamp":"2025-03-25T15:14:04.254Z"}
{"level":"debug","message":"Executing query [m8omz23ke1svmh88dj]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:14:04.256Z"}
{"level":"debug","message":"Executing query [m8omz23kznmlbc8foml]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:14:04.256Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T15:14:04.257Z"}
{"level":"debug","message":"Executing query [m8omz23l9khqbpemotd]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:14:04.257Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:14:04.259Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:23:29.326Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:23:29.344Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:23:29.349Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:23:29.368Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:23:29.392Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:23:29.404Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T15:23:29.407Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:23:29.415Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:23:29.417Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:23:29.419Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T15:23:29.421Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T15:23:29.424Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:29.659Z"}
{"level":"debug","message":"Executing query [m8onb6g46w0x18d041g]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:29.764Z"}
{"level":"debug","message":"Executing query [m8onb6ih9bjczuzg3vi]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742916209760\"]","timestamp":"2025-03-25T15:23:29.849Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:29.853Z"}
{"level":"debug","message":"Executing query [m8onb6jihvuxrakpso7]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742916209760\"]","timestamp":"2025-03-25T15:23:29.887Z"}
{"level":"debug","message":"Executing query [m8onb6jnivsufikq7nt]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742916209760\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:23:29.891Z"}
{"level":"debug","message":"Executing query [m8onb6k17y04lz1qbsx]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1017]","timestamp":"2025-03-25T15:23:29.905Z"}
{"level":"debug","message":"Executing query [m8onb6k7jskqfkaaac]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742916209760\"]","timestamp":"2025-03-25T15:23:29.911Z"}
{"level":"debug","message":"Executing query [m8onb6khea9avave45s]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1017]","timestamp":"2025-03-25T15:23:29.922Z"}
{"level":"debug","message":"Executing query [m8onb6kog902u2jdm14]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1017]","timestamp":"2025-03-25T15:23:29.928Z"}
{"level":"debug","message":"Executing query [m8onb6ksfutuh6qh5l]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1017]","timestamp":"2025-03-25T15:23:29.932Z"}
{"level":"debug","message":"Executing query [m8onb6kwtjywsqplbup]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1017]","timestamp":"2025-03-25T15:23:29.936Z"}
{"level":"debug","message":"Executing query [m8onb6l1ba3x0dkvjpk]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1017]","timestamp":"2025-03-25T15:23:29.941Z"}
{"level":"debug","message":"Executing query [m8onb6l4eck71swpg5r]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1017]","timestamp":"2025-03-25T15:23:29.944Z"}
{"level":"debug","message":"Executing query [m8onb6l9w5j9d6qjds8]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1017]","timestamp":"2025-03-25T15:23:29.949Z"}
{"level":"debug","message":"Executing query [m8onb6lcmocq457xrhc]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T15:23:29.952Z"}
{"level":"debug","message":"Executing query [m8onb6lelhnk1msa7gp]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:29.954Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:29.958Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T15:23:30.031Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:30.257Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:30.226Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:30.040Z"}
{"level":"debug","message":"Executing query [m8onb6u75rt4sr4ugv4]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:30.271Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:30.395Z"}
{"level":"debug","message":"Executing query [m8onb6xp0g8ifgu62bx]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:23:30.397Z"}
{"level":"debug","message":"Executing query [m8onb6xt5o72a4jm4h]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742916210269\"]","timestamp":"2025-03-25T15:23:30.401Z"}
{"level":"debug","message":"Executing query [m8onb6xvtpoz71nodfd]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742916210269\",\"TEST-OFICIO-1742916210269\",3177,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:23:30.403Z"}
{"level":"debug","message":"Executing query [m8onb6y7ezw133gfvl4]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.415Z"}
{"level":"debug","message":"Executing query [m8onb6yblllbur8ljho]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742916210269\"]","timestamp":"2025-03-25T15:23:30.419Z"}
{"level":"debug","message":"Executing query [m8onb6yfwt9pwztsb9]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",37]","timestamp":"2025-03-25T15:23:30.423Z"}
{"level":"debug","message":"Executing query [m8onb6yklbvb74c2qpb]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.428Z"}
{"level":"debug","message":"Executing query [m8onb6yn379okn2h3il]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.431Z"}
{"level":"debug","message":"Executing query [m8onb6ywvt6yn0kw6e]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.440Z"}
{"level":"debug","message":"Executing query [m8onb6z0v9dvfvq6w7]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.444Z"}
{"level":"debug","message":"Executing query [m8onb6z8xf6nhrb9z3o]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.452Z"}
{"level":"debug","message":"Executing query [m8onb6zapsqrfe7sxi7]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742916210454\",\"TEST-SP-OFICIO-1742916210454\",774,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T15:23:30.455Z"}
{"level":"debug","message":"Executing query [m8onb6zhkrsiifg5mt]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742916210454\"]","timestamp":"2025-03-25T15:23:30.461Z"}
{"level":"debug","message":"Executing query [m8onb6zkfd8cby8q89u]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742916210454\"]","timestamp":"2025-03-25T15:23:30.464Z"}
{"level":"debug","message":"Executing query [m8onb6zouynfcdmwy8g]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:30.469Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:30.473Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T15:23:30.432Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:30.535Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:30.658Z"}
{"level":"debug","message":"Executing query [m8onb75749mzkiqsea6]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T15:23:30.668Z"}
{"level":"debug","message":"Executing query [m8onb75ca3ad9gr2855]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T15:23:30.673Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8onb75ca3ad9gr2855]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T15:23:30.677Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:30.681Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:30.598Z"}
{"level":"debug","message":"Executing query [m8onb754vvkc4i8gxt]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:30.665Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:30.734Z"}
{"level":"debug","message":"Executing query [m8onb779xfbjtfe7lp]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T15:23:30.741Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T15:23:30.745Z"}
{"level":"debug","message":"Executing query [m8onb77ea3e1fmz3lwr]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T15:23:30.746Z"}
{"level":"debug","message":"Executing query [m8onb77g8unnwmu9kgr]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T15:23:30.748Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T15:23:30.750Z"}
{"level":"debug","message":"Executing query [m8onb77ilimvvraxiz]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T15:23:30.750Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T15:23:30.773Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:30.747Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T15:23:30.752Z"}
{"level":"debug","message":"Executing query [m8onb7a5jeswan6ml7c]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T15:23:30.845Z"}
{"level":"debug","message":"Executing query [m8onb7almgt6kkld8ym]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T15:23:30.862Z"}
{"level":"debug","message":"Executing query [m8onb7az929lzaxca9]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[35]","timestamp":"2025-03-25T15:23:30.876Z"}
{"level":"debug","message":"Executing query [m8onb7975s08iysgl7]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:30.811Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:30.875Z"}
{"level":"debug","message":"Executing query [m8onb7b3hkuclyv8zjj]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:23:30.879Z"}
{"level":"debug","message":"Executing query [m8onb7baccrtc8c1v2v]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742916210809\"]","timestamp":"2025-03-25T15:23:30.886Z"}
{"level":"debug","message":"Executing query [m8onb7beoly2x1qyie]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742916210809\",\"TEST-OFI-FORENSE-1742916210809\",5312,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742916210810\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:23:30.890Z"}
{"level":"debug","message":"Executing query [m8onb7bni8bxngw1ain]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:30.899Z"}
{"level":"debug","message":"Executing query [m8onb7bo77je4tum264]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.900Z"}
{"level":"debug","message":"Executing query [m8onb7bv7q4co50hesu]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742916210809\"]","timestamp":"2025-03-25T15:23:30.907Z"}
{"level":"debug","message":"Executing query [m8onb7bz01egnj1zjczv]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",37]","timestamp":"2025-03-25T15:23:30.911Z"}
{"level":"debug","message":"Executing query [m8onb7c4o512lw73oa]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.916Z"}
{"level":"debug","message":"Executing query [m8onb7c7vzzy5ylrfdf]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.919Z"}
{"level":"debug","message":"Executing query [m8onb7cdgav936pt6ja]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.925Z"}
{"level":"debug","message":"Executing query [m8onb7chfo946mspxsl]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.929Z"}
{"level":"debug","message":"Executing query [m8onb7cnuvb3dwlho6]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[37]","timestamp":"2025-03-25T15:23:30.935Z"}
{"level":"debug","message":"Executing query [m8onb7cqdeytz12ccwn]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742916210938\",\"TEST-SP-OFI-FORENSE-1742916210938\",5149,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T15:23:30.938Z"}
{"level":"debug","message":"Executing query [m8onb7d0f706b6kkg3p]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742916210938\"]","timestamp":"2025-03-25T15:23:30.948Z"}
{"level":"debug","message":"Executing query [m8onb7d333o2nph9gtd]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742916210938\"]","timestamp":"2025-03-25T15:23:30.951Z"}
{"level":"debug","message":"Executing query [m8onb7d6sx0y8oruwiq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:30.954Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:30.957Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T15:23:30.774Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T15:23:30.775Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T15:23:30.776Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T15:23:30.777Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T15:23:30.777Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:31.143Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:31.148Z"}
{"level":"debug","message":"Executing query [m8onb7ip288g2n34vp3]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:31.153Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:31.181Z"}
{"level":"debug","message":"Executing query [m8onb7jjwubi5cs0vgf]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T15:23:31.183Z"}
{"level":"debug","message":"Executing query [m8onb7jmoszw6ppt8ac]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T15:23:31.186Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T15:23:31.188Z"}
{"level":"debug","message":"Executing query [m8onb7jp48xyf16vt5c]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T15:23:31.189Z"}
{"level":"debug","message":"Executing query [m8onb7jsl77f8spxn]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T15:23:31.192Z"}
{"level":"debug","message":"Executing query [m8onb7jvbee1g5uuoce]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T15:23:31.196Z"}
{"level":"debug","message":"Executing query [m8onb7k4txws871jut7]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.204Z"}
{"level":"debug","message":"Executing query [m8onb7kax0dfys3f81]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.210Z"}
{"level":"debug","message":"Executing query [m8onb7kfw1778kx2y59]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",37]","timestamp":"2025-03-25T15:23:31.215Z"}
{"level":"debug","message":"Executing query [m8onb7ilybg7n3hv77m]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:31.150Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:31.213Z"}
{"level":"debug","message":"Executing query [m8onb7kkpsxzeub64i9]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.220Z"}
{"level":"debug","message":"Executing query [m8onb7kpiyagvz6ox9b]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.225Z"}
{"level":"debug","message":"Executing query [m8onb7kuhictvbq55b]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.230Z"}
{"level":"debug","message":"Executing query [m8onb7kujif56k2wmyp]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:23:31.230Z"}
{"level":"debug","message":"Executing query [m8onb7kxjhcsogeqdkn]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:31.233Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:31.235Z"}
{"level":"debug","message":"Executing query [m8onb7kzy4zsrkfyifd]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T15:23:31.235Z"}
{"level":"debug","message":"Executing query [m8onb7l2pm532xckuq8]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T15:23:31.238Z"}
{"level":"debug","message":"Executing query [m8onb7l6gek9vpcn84n]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T15:23:31.242Z"}
{"level":"debug","message":"Executing query [m8onb7la7uptg3tccqf]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T15:23:31.247Z"}
{"level":"debug","message":"Executing query [m8onb7lf8o1nfbb5o97]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[37,888,38,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T15:23:31.251Z\",\"ACTIVO\"]","timestamp":"2025-03-25T15:23:31.251Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 38, Área ID: 888, Rol ID: 888, Documento ID: 37","timestamp":"2025-03-25T15:23:31.258Z"}
{"level":"debug","message":"Executing query [m8onb7lndvfibb2rho]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[37,38,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T15:23:31.259Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8onb7lndvfibb2rho]","params":"[37,38,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T15:23:31.268Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T15:23:31.268Z"}
{"level":"debug","message":"Executing query [m8onb7lxxbkdkw3yayt]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.269Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8onb7lxxbkdkw3yayt]","params":"[37]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T15:23:31.274Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T15:23:31.275Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T15:23:31.275Z"}
{"level":"debug","message":"Executing query [m8onb7m4q62ui5y0yua]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[37,38,\"RESTAURAR\"]","timestamp":"2025-03-25T15:23:31.276Z"}
{"level":"debug","message":"Executing query [m8onb7mfhqy4eeisofr]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.287Z"}
{"level":"debug","message":"Executing query [m8onb7mje3zj9it34n4]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[37,38,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T15:23:31.291Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8onb7mje3zj9it34n4]","params":"[37,38,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T15:23:31.298Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T15:23:31.299Z"}
{"level":"debug","message":"Executing query [m8onb7mrupfz7imoh9j]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.299Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8onb7mrupfz7imoh9j]","params":"[37]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T15:23:31.307Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T15:23:31.308Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T15:23:31.308Z"}
{"level":"debug","message":"Executing query [m8onb7n1qznew1zeyge]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[37,888,38,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T15:23:31.309Z\",\"ACTIVO\"]","timestamp":"2025-03-25T15:23:31.309Z"}
{"level":"debug","message":"Executing query [m8onb7n61na04tskigh]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T15:23:31.314Z"}
{"level":"debug","message":"Executing query [m8onb7nb29jkq17y7n7]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[38,\"DOCUMENTO\",38,\"ELIMINAR\"]","timestamp":"2025-03-25T15:23:31.319Z"}
{"level":"debug","message":"Executing query [m8onb7ng88bmdapgsww]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[38]","timestamp":"2025-03-25T15:23:31.324Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:31.201Z"}
{"level":"debug","message":"Executing query [m8onb7nqo22euta22la]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T15:23:31.334Z"}
{"level":"debug","message":"Executing query [m8onb7nw7skzgsjg8pw]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[37]","timestamp":"2025-03-25T15:23:31.340Z"}
{"level":"debug","message":"Executing query [m8onb7o175pvng70czf]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:23:31.345Z"}
{"level":"debug","message":"Executing query [m8onb7o2l4jg0o11zjc]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:23:31.346Z"}
{"level":"debug","message":"Executing query [m8onb7o4phoiewgn4cg]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T15:23:31.348Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T15:23:31.353Z"}
{"level":"debug","message":"Executing query [m8onb7o9dkwj3i798su]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:31.353Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:31.356Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:31.579Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:31.618Z"}
{"level":"debug","message":"Executing query [m8onb7w7an5v84dk4y]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:31.639Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:31.686Z"}
{"level":"debug","message":"Executing query [m8onb7xps77kw3dz1ws]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T15:23:31.693Z"}
{"level":"debug","message":"Executing query [m8onb7xvp3xujxvhh0a]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742916211637\"]","timestamp":"2025-03-25T15:23:31.699Z"}
{"level":"debug","message":"Executing query [m8onb7xx28fu2n25upt]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742916211637\",\"TEST-OFI-QUIMICA-1742916211637\",1512,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T15:23:31.701Z"}
{"level":"debug","message":"Executing query [m8onb7y6bp8aido2m1p]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[19]","timestamp":"2025-03-25T15:23:31.710Z"}
{"level":"debug","message":"Executing query [m8onb7wydqfug1vm1bp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:31.667Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:31.713Z"}
{"level":"debug","message":"Executing query [m8onb7ybrxcyvtuckx]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742916211637\"]","timestamp":"2025-03-25T15:23:31.715Z"}
{"level":"debug","message":"Executing query [m8onb7yf4bh2kicmhhk]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",19]","timestamp":"2025-03-25T15:23:31.719Z"}
{"level":"debug","message":"Executing query [m8onb7yfabs3i270r4a]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742916211665\"]","timestamp":"2025-03-25T15:23:31.720Z"}
{"level":"debug","message":"Executing query [m8onb7yjgdsw0445t98]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742916211665\",true]","timestamp":"2025-03-25T15:23:31.723Z"}
{"level":"debug","message":"Executing query [m8onb7yksn4iu9tpq5m]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[19]","timestamp":"2025-03-25T15:23:31.724Z"}
{"level":"debug","message":"Executing query [m8onb7yol55p9c4oyyk]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[19]","timestamp":"2025-03-25T15:23:31.728Z"}
{"level":"debug","message":"Executing query [m8onb7yrvs5dlzccy3]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-25T15:23:31.731Z"}
{"level":"debug","message":"Executing query [m8onb7yvzbg21en17t]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[19]","timestamp":"2025-03-25T15:23:31.735Z"}
{"level":"debug","message":"Executing query [m8onb7yz3e67vi2vkoe]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[19]","timestamp":"2025-03-25T15:23:31.739Z"}
{"level":"debug","message":"Executing query [m8onb7yzyvg5efr9k7h]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742916211665\"]","timestamp":"2025-03-25T15:23:31.739Z"}
{"level":"debug","message":"Executing query [m8onb7z2m1x2stx9t0a]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",38]","timestamp":"2025-03-25T15:23:31.742Z"}
{"level":"debug","message":"Executing query [m8onb7z4l1xa67l0qvo]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[19]","timestamp":"2025-03-25T15:23:31.744Z"}
{"level":"debug","message":"Executing query [m8onb7z6nt88dy5i4hn]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-25T15:23:31.746Z"}
{"level":"debug","message":"Executing query [m8onb7z67xf2joho5hx]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:31.746Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:31.749Z"}
{"level":"debug","message":"Executing query [m8onb7z993pbpdrsrx]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-25T15:23:31.749Z"}
{"level":"debug","message":"Executing query [m8onb7zdudxta4bz9w]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-25T15:23:31.753Z"}
{"level":"debug","message":"Executing query [m8onb7zg3clhsirk6re]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-25T15:23:31.756Z"}
{"level":"debug","message":"Executing query [m8onb7zimvdg17vaiy8]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-25T15:23:31.758Z"}
{"level":"debug","message":"Executing query [m8onb7zmhstqvfrgtit]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[38]","timestamp":"2025-03-25T15:23:31.762Z"}
{"level":"debug","message":"Executing query [m8onb7zon9i5hy4mqdk]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T15:23:31.764Z"}
{"level":"debug","message":"Executing query [m8onb7zqaq1gszm2jtg]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:31.766Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:31.769Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:31.778Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:31.789Z"}
{"level":"debug","message":"Executing query [m8onb80gmi2cv254iwg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T15:23:31.793Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:31.825Z"}
{"level":"debug","message":"Executing query [m8onb81fxjgdnwepy4n]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T15:23:31.827Z"}
{"level":"debug","message":"Executing query [m8onb81huqvta1opuib]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T15:23:31.829Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T15:23:31.830Z"}
{"level":"debug","message":"Executing query [m8onb81jpff1zrm3m1d]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:23:31.831Z"}
{"level":"debug","message":"Executing query [m8onb81kjhc3xx369u]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:23:31.832Z"}
{"level":"debug","message":"Executing query [m8onb81mi1dpd79fnhh]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:23:31.834Z"}
{"level":"debug","message":"Executing query [m8onb81npf6ni03kw8]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T15:23:31.835Z"}
{"level":"debug","message":"Executing query [m8onb81u4fg1at74ew3]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[39]","timestamp":"2025-03-25T15:23:31.842Z"}
{"level":"debug","message":"Executing query [m8onb81yod3x3m43qhj]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:23:31.846Z"}
{"level":"debug","message":"Executing query [m8onb821d5nxyg86v1w]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",39]","timestamp":"2025-03-25T15:23:31.849Z"}
{"level":"debug","message":"Executing query [m8onb824ce9w9j1e72f]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[39]","timestamp":"2025-03-25T15:23:31.852Z"}
{"level":"debug","message":"Executing query [m8onb826kiyyw34bu5r]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[39]","timestamp":"2025-03-25T15:23:31.854Z"}
{"level":"debug","message":"Executing query [m8onb82aqv0aso4ojd]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[39]","timestamp":"2025-03-25T15:23:31.858Z"}
{"level":"debug","message":"Executing query [m8onb82bc64wqaob74b]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:23:31.860Z"}
{"level":"debug","message":"Executing query [m8onb82d5lixc4s9uw7]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T15:23:31.861Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T15:23:31.862Z"}
{"level":"debug","message":"Executing query [m8onb82ebencojzyphu]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T15:23:31.862Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:31.863Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:32.013Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T15:23:32.359Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T15:23:32.379Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:32.632Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T15:23:32.662Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:32.732Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:32.784Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T15:23:32.986Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:33.136Z"}
{"level":"debug","message":"Executing query [m8onb92v1v8zifndtiy]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T15:23:33.176Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:33.219Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:33.833Z"}
{"duration":"20ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T15:23:33.988Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T15:23:33.993Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T15:23:33.997Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:34.001Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T15:23:33.926Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T15:23:34.032Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T15:23:34.034Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T17:29:54.699Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T17:29:54.715Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T17:29:54.719Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T17:29:54.723Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T17:29:54.727Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T17:29:54.731Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T17:29:54.734Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:29:54.738Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:29:54.740Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:29:54.743Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:29:54.746Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T17:29:54.749Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:55.158Z"}
{"level":"debug","message":"Executing query [m8ortrfypxr800ivdl]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:55.247Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:55.328Z"}
{"level":"debug","message":"Executing query [m8ortribfwh8dr4q99w]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742923795242\"]","timestamp":"2025-03-25T17:29:55.331Z"}
{"level":"debug","message":"Executing query [m8ortriwa58ckjttldi]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742923795242\"]","timestamp":"2025-03-25T17:29:55.352Z"}
{"level":"debug","message":"Executing query [m8ortrj0sg4fs3a6ev]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742923795242\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:29:55.356Z"}
{"level":"debug","message":"Executing query [m8ortrjc3p4qbjssq1e]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1018]","timestamp":"2025-03-25T17:29:55.368Z"}
{"level":"debug","message":"Executing query [m8ortrjil9k0ag7efwk]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742923795242\"]","timestamp":"2025-03-25T17:29:55.374Z"}
{"level":"debug","message":"Executing query [m8ortrjmn0qs8gt9nl]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1018]","timestamp":"2025-03-25T17:29:55.378Z"}
{"level":"debug","message":"Executing query [m8ortrjznva7ynfxw5]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1018]","timestamp":"2025-03-25T17:29:55.391Z"}
{"level":"debug","message":"Executing query [m8ortrk4xhsy4wp8fh]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1018]","timestamp":"2025-03-25T17:29:55.396Z"}
{"level":"debug","message":"Executing query [m8ortrk9e056jsd4cob]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1018]","timestamp":"2025-03-25T17:29:55.401Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:55.341Z"}
{"level":"debug","message":"Executing query [m8ortrkcwnjneovbiyi]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1018]","timestamp":"2025-03-25T17:29:55.405Z"}
{"level":"debug","message":"Executing query [m8ortrki96oh4f1fug]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1018]","timestamp":"2025-03-25T17:29:55.410Z"}
{"level":"debug","message":"Executing query [m8ortrkmyjruxjyqpn]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1018]","timestamp":"2025-03-25T17:29:55.414Z"}
{"level":"debug","message":"Executing query [m8ortrkpmc0g2wmaayn]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T17:29:55.417Z"}
{"level":"debug","message":"Executing query [m8ortrksrougnllf5ea]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:55.420Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:55.424Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T17:29:55.345Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:55.231Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:55.587Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:55.591Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:55.708Z"}
{"level":"debug","message":"Executing query [m8ortrt8i1fih40b2ys]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T17:29:55.724Z"}
{"level":"debug","message":"Executing query [m8ortrtb45vehdbmr7v]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T17:29:55.728Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8ortrtb45vehdbmr7v]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T17:29:55.733Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:55.737Z"}
{"level":"debug","message":"Executing query [m8ortrrtplovcmwnasd]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:55.673Z"}
{"level":"debug","message":"Executing query [m8ortruf5q4l43fex8g]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T17:29:55.767Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:55.770Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T17:29:55.774Z"}
{"level":"debug","message":"Executing query [m8ortrunbpsap3xtc7e]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T17:29:55.775Z"}
{"level":"debug","message":"Executing query [m8ortruut2axr4pwlbm]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T17:29:55.782Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T17:29:55.786Z"}
{"level":"debug","message":"Executing query [m8ortruznqane1jagpd]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T17:29:55.787Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T17:29:55.790Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:55.740Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T17:29:55.741Z"}
{"level":"debug","message":"Executing query [m8ortrxskk8pmg1v71j]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T17:29:55.889Z"}
{"level":"debug","message":"Executing query [m8ortry2jhxpdlk48]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T17:29:55.899Z"}
{"level":"debug","message":"Executing query [m8ortry6zj3z390y5tf]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[37]","timestamp":"2025-03-25T17:29:55.902Z"}
{"level":"debug","message":"Executing query [m8ortrwaau6zjyogbww]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:55.835Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:55.902Z"}
{"level":"debug","message":"Executing query [m8ortryaql1mdiz2d2]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:29:55.906Z"}
{"level":"debug","message":"Executing query [m8ortryd8hfgwvqkysc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:55.909Z"}
{"level":"debug","message":"Executing query [m8ortryo47n11ic0cuh]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742923795831\"]","timestamp":"2025-03-25T17:29:55.920Z"}
{"level":"debug","message":"Executing query [m8ortrysszg1iquotsq]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742923795831\",\"TEST-OFICIO-1742923795831\",8663,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:29:55.924Z"}
{"level":"debug","message":"Executing query [m8ortrz3mfm6z4h73h]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[39]","timestamp":"2025-03-25T17:29:55.935Z"}
{"level":"debug","message":"Executing query [m8ortrzau4ks9hi98ae]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742923795831\"]","timestamp":"2025-03-25T17:29:55.942Z"}
{"level":"debug","message":"Executing query [m8ortrzk4lsp16ex85]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",39]","timestamp":"2025-03-25T17:29:55.952Z"}
{"level":"debug","message":"Executing query [m8ortrzqy5t2nbmonq]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[39]","timestamp":"2025-03-25T17:29:55.958Z"}
{"level":"debug","message":"Executing query [m8ortrzu1gfxmj9992uh]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[39]","timestamp":"2025-03-25T17:29:55.962Z"}
{"level":"debug","message":"Executing query [m8orts00uyz9fbqz1zn]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[39]","timestamp":"2025-03-25T17:29:55.968Z"}
{"level":"debug","message":"Executing query [m8orts043zwqbaxm0ut]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[39]","timestamp":"2025-03-25T17:29:55.972Z"}
{"level":"debug","message":"Executing query [m8orts08u0x8u0cysn]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[39]","timestamp":"2025-03-25T17:29:55.976Z"}
{"level":"debug","message":"Executing query [m8orts0c8ozxfdsr1xq]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742923795980\",\"TEST-SP-OFICIO-1742923795980\",3890,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T17:29:55.980Z"}
{"level":"debug","message":"Executing query [m8orts0j1lb8fvqvymb]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742923795980\"]","timestamp":"2025-03-25T17:29:55.987Z"}
{"level":"debug","message":"Executing query [m8orts0ljmvj7i230d]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742923795980\"]","timestamp":"2025-03-25T17:29:55.989Z"}
{"level":"debug","message":"Executing query [m8orts0qps8g2j86ep]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:55.994Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:55.997Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T17:29:56.100Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T17:29:56.101Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T17:29:56.102Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T17:29:56.103Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T17:29:56.105Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T17:29:56.105Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:56.136Z"}
{"level":"debug","message":"Executing query [m8orts6kz5m0zxosvb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:56.204Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:56.268Z"}
{"level":"debug","message":"Executing query [m8orts8he28mhcz9vu]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:29:56.273Z"}
{"level":"debug","message":"Executing query [m8orts8loy4u28s74br]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742923796188\"]","timestamp":"2025-03-25T17:29:56.278Z"}
{"level":"debug","message":"Executing query [m8orts8o4kufcj0roxx]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742923796188\",\"TEST-OFI-FORENSE-1742923796188\",9014,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742923796188\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:29:56.280Z"}
{"level":"debug","message":"Executing query [m8orts8x8nr18a07e6j]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.289Z"}
{"level":"debug","message":"Executing query [m8orts93o1ot57ind4f]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742923796188\"]","timestamp":"2025-03-25T17:29:56.295Z"}
{"level":"debug","message":"Executing query [m8orts989phbt8hz6un]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",39]","timestamp":"2025-03-25T17:29:56.300Z"}
{"level":"debug","message":"Executing query [m8orts9cjthrlzvkmlk]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.304Z"}
{"level":"debug","message":"Executing query [m8orts9g9bsiy2kalc]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.308Z"}
{"level":"debug","message":"Executing query [m8orts9lpnouh87bhri]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.313Z"}
{"level":"debug","message":"Executing query [m8orts9p67hugim9a95]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.317Z"}
{"level":"debug","message":"Executing query [m8orts9uoqelru3mcd]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.322Z"}
{"level":"debug","message":"Executing query [m8orts9z3uj0l54eb3]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742923796327\",\"TEST-SP-OFI-FORENSE-1742923796327\",8087,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T17:29:56.327Z"}
{"level":"debug","message":"Executing query [m8ortsa4vd69crb1oec]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742923796327\"]","timestamp":"2025-03-25T17:29:56.333Z"}
{"level":"debug","message":"Executing query [m8ortsa7cov2xmd43ml]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742923796327\"]","timestamp":"2025-03-25T17:29:56.336Z"}
{"level":"debug","message":"Executing query [m8ortsabmrd7pycyy2l]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:56.339Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:56.342Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:56.428Z"}
{"level":"debug","message":"Executing query [m8ortsd1gj65nrp6fn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:56.437Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:56.463Z"}
{"level":"debug","message":"Executing query [m8ortsds1mtnmcchspp]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:29:56.464Z"}
{"level":"debug","message":"Executing query [m8ortsdw4vn20ecyej3]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T17:29:56.468Z"}
{"level":"debug","message":"Executing query [m8ortsdyg1gmypi8m5]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T17:29:56.471Z"}
{"level":"debug","message":"Executing query [m8ortse2878btxr52mk]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T17:29:56.474Z"}
{"level":"debug","message":"Executing query [m8ortse6b2nmqdtopep]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T17:29:56.479Z"}
{"level":"debug","message":"Executing query [m8ortsebbxlz75x2ll9]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[39,888,40,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T17:29:56.483Z\",\"ACTIVO\"]","timestamp":"2025-03-25T17:29:56.484Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 40, Área ID: 888, Rol ID: 888, Documento ID: 39","timestamp":"2025-03-25T17:29:56.489Z"}
{"level":"debug","message":"Executing query [m8ortseiuo05i63auq]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[39,40,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T17:29:56.490Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8ortseiuo05i63auq]","params":"[39,40,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T17:29:56.501Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T17:29:56.501Z"}
{"level":"debug","message":"Executing query [m8ortseu5xikfietlew]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.502Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8ortseu5xikfietlew]","params":"[39]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T17:29:56.509Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T17:29:56.509Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T17:29:56.509Z"}
{"level":"debug","message":"Executing query [m8ortsf24sypsh5r662]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[39,40,\"RESTAURAR\"]","timestamp":"2025-03-25T17:29:56.510Z"}
{"level":"debug","message":"Executing query [m8ortsfnwyr8aiz591i]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.532Z"}
{"level":"debug","message":"Executing query [m8ortsfrycmr2etirs]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[39,40,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T17:29:56.535Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8ortsfrycmr2etirs]","params":"[39,40,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T17:29:56.543Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T17:29:56.544Z"}
{"level":"debug","message":"Executing query [m8ortsg07w91bsgn0hp]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.544Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8ortsg07w91bsgn0hp]","params":"[39]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T17:29:56.548Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T17:29:56.549Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T17:29:56.549Z"}
{"level":"debug","message":"Executing query [m8ortsg69njmq1xabm7]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[39,888,40,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T17:29:56.550Z\",\"ACTIVO\"]","timestamp":"2025-03-25T17:29:56.550Z"}
{"level":"debug","message":"Executing query [m8ortsg9jn4z1bywbe]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T17:29:56.553Z"}
{"level":"debug","message":"Executing query [m8ortsgdfcvmhgf8qof]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[40,\"DOCUMENTO\",40,\"ELIMINAR\"]","timestamp":"2025-03-25T17:29:56.557Z"}
{"level":"debug","message":"Executing query [m8ortsgwi2vcvjttioa]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.576Z"}
{"level":"debug","message":"Executing query [m8ortsh1enoz1rtzk4m]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T17:29:56.581Z"}
{"level":"debug","message":"Executing query [m8ortsh65mrn5428s07]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[39]","timestamp":"2025-03-25T17:29:56.586Z"}
{"level":"debug","message":"Executing query [m8ortshalgjblw5mtt]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:29:56.590Z"}
{"level":"debug","message":"Executing query [m8ortshcgr3n4jh6rm]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:29:56.592Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:56.504Z"}
{"level":"debug","message":"Executing query [m8ortshffbb5d8i4br6]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:29:56.595Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T17:29:56.599Z"}
{"level":"debug","message":"Executing query [m8ortshk61f91we2qo8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:56.600Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:56.602Z"}
{"level":"debug","message":"Executing query [m8ortsgqiw9n4co922n]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:56.570Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:56.650Z"}
{"level":"debug","message":"Executing query [m8ortsj2sroky3ajszl]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:29:56.654Z"}
{"level":"debug","message":"Executing query [m8ortsj73ku9sncr7fk]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:29:56.659Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T17:29:56.661Z"}
{"level":"debug","message":"Executing query [m8ortsj9swgcohzb07]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T17:29:56.662Z"}
{"level":"debug","message":"Executing query [m8ortsjd4wmjz01j87]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T17:29:56.665Z"}
{"level":"debug","message":"Executing query [m8ortsjfs8elxuilxi]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T17:29:56.667Z"}
{"level":"debug","message":"Executing query [m8ortsjnaswzmc80g3]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.675Z"}
{"level":"debug","message":"Executing query [m8ortsjramwa1wwri6q]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.680Z"}
{"level":"debug","message":"Executing query [m8ortsjxe3a56opmlvb]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",40]","timestamp":"2025-03-25T17:29:56.685Z"}
{"level":"debug","message":"Executing query [m8ortsk299qrj12sr4r]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.691Z"}
{"level":"debug","message":"Executing query [m8ortsk65kragem1ffe]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.695Z"}
{"level":"debug","message":"Executing query [m8ortskbx8t8bl9tre]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.699Z"}
{"level":"debug","message":"Executing query [m8ortskegge2v3ohd1w]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:56.702Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:56.705Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:56.784Z"}
{"level":"debug","message":"Executing query [m8ortsntw73u1vie86r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:56.825Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:56.895Z"}
{"level":"debug","message":"Executing query [m8ortspw2yv4t5405od]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742923796823\"]","timestamp":"2025-03-25T17:29:56.900Z"}
{"level":"debug","message":"Executing query [m8ortspzed12obu8vtu]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742923796823\",true]","timestamp":"2025-03-25T17:29:56.903Z"}
{"level":"debug","message":"Executing query [m8ortsq70sabfuavy7xo]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.911Z"}
{"level":"debug","message":"Executing query [m8ortsqd5o7jk3deuhn]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742923796823\"]","timestamp":"2025-03-25T17:29:56.917Z"}
{"level":"debug","message":"Executing query [m8ortsqg8b1wyaap5pl]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",40]","timestamp":"2025-03-25T17:29:56.920Z"}
{"level":"debug","message":"Executing query [m8ortsqlpttc9kkgj6k]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.925Z"}
{"level":"debug","message":"Executing query [m8ortsqohtd8p098bg]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.929Z"}
{"level":"debug","message":"Executing query [m8ortsqvkbrj40845ia]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.935Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:56.922Z"}
{"level":"debug","message":"Executing query [m8ortsqyv1mrwy4mpr]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.939Z"}
{"level":"debug","message":"Executing query [m8ortsr2stnenvoa41]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.942Z"}
{"level":"debug","message":"Executing query [m8ortsr66hqziz0bkwb]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[40]","timestamp":"2025-03-25T17:29:56.946Z"}
{"level":"debug","message":"Executing query [m8ortsr9blxo1n0pvio]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T17:29:56.949Z"}
{"level":"debug","message":"Executing query [m8ortsrbeb9t0aj8ee7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:56.951Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:56.956Z"}
{"level":"debug","message":"Executing query [m8ortsqp4hq1q7pts07]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:56.929Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:56.966Z"}
{"level":"debug","message":"Executing query [m8ortsrskqxgsf0opas]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:29:56.968Z"}
{"level":"debug","message":"Executing query [m8ortsrzrtong5dlf]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742923796927\"]","timestamp":"2025-03-25T17:29:56.975Z"}
{"level":"debug","message":"Executing query [m8ortss1vk34lcattup]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742923796927\",\"TEST-OFI-QUIMICA-1742923796927\",4204,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:29:56.977Z"}
{"level":"debug","message":"Executing query [m8ortss8xkr3fde490q]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[20]","timestamp":"2025-03-25T17:29:56.984Z"}
{"level":"debug","message":"Executing query [m8ortssdos0gmnpka5]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742923796927\"]","timestamp":"2025-03-25T17:29:56.989Z"}
{"level":"debug","message":"Executing query [m8ortssgavy4qj4yunr]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",20]","timestamp":"2025-03-25T17:29:56.992Z"}
{"level":"debug","message":"Executing query [m8ortsslyk8aqezteu]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[20]","timestamp":"2025-03-25T17:29:56.997Z"}
{"level":"debug","message":"Executing query [m8ortssp34omum99xdm]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[20]","timestamp":"2025-03-25T17:29:57.001Z"}
{"level":"debug","message":"Executing query [m8ortsssvqvql18vxul]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[20]","timestamp":"2025-03-25T17:29:57.004Z"}
{"level":"debug","message":"Executing query [m8ortssvg1ec3qfhzz]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[20]","timestamp":"2025-03-25T17:29:57.007Z"}
{"level":"debug","message":"Executing query [m8ortst0rend2qspqh]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[20]","timestamp":"2025-03-25T17:29:57.012Z"}
{"level":"debug","message":"Executing query [m8ortst3cfj3jsha4ml]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:57.015Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:57.016Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:57.112Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:57.482Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:29:57.492Z"}
{"level":"debug","message":"Executing query [m8ortt6ej1ja9a4nft8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:29:57.494Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:29:57.520Z"}
{"level":"debug","message":"Executing query [m8ortt77dgj1swoqdrd]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:29:57.523Z"}
{"level":"debug","message":"Executing query [m8ortt7ae6619ug3vtl]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:29:57.526Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T17:29:57.528Z"}
{"level":"debug","message":"Executing query [m8ortt7cx274ibkes5g]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:29:57.528Z"}
{"level":"debug","message":"Executing query [m8ortt7diwhw3xqo1y]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:29:57.530Z"}
{"level":"debug","message":"Executing query [m8ortt7fiz8d30z3w5d]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:29:57.531Z"}
{"level":"debug","message":"Executing query [m8ortt7gk6kyksoly]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T17:29:57.532Z"}
{"level":"debug","message":"Executing query [m8ortt7mjsya8w8x3e]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[41]","timestamp":"2025-03-25T17:29:57.538Z"}
{"level":"debug","message":"Executing query [m8ortt7qxtl9ksc2hk]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:29:57.542Z"}
{"level":"debug","message":"Executing query [m8ortt7txel2ytvv2ci]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",41]","timestamp":"2025-03-25T17:29:57.545Z"}
{"level":"debug","message":"Executing query [m8ortt7ydcdimqhviz4]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[41]","timestamp":"2025-03-25T17:29:57.550Z"}
{"level":"debug","message":"Executing query [m8ortt80xocveqm3vfc]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[41]","timestamp":"2025-03-25T17:29:57.552Z"}
{"level":"debug","message":"Executing query [m8ortt84vlgbwtli9e]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[41]","timestamp":"2025-03-25T17:29:57.556Z"}
{"level":"debug","message":"Executing query [m8ortt86slbncf5evhq]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:29:57.558Z"}
{"level":"debug","message":"Executing query [m8ortt870fos5wpimeid]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:29:57.559Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T17:29:57.561Z"}
{"level":"debug","message":"Executing query [m8ortt89oukawjp05p]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:29:57.561Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:29:57.563Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:30:00.208Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:30:00.432Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:30:00.525Z"}
{"level":"debug","message":"Executing query [m8ortvk1gwgpvbuztlg]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T17:30:00.577Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:30:00.614Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:30:00.420Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:30:00.675Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T17:30:00.686Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:30:00.822Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T17:30:00.835Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:30:00.888Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:30:08.450Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:30:08.559Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T17:30:08.561Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:30:08.514Z"}
{"duration":"28ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T17:30:08.686Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:30:08.689Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T17:30:08.692Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:30:08.697Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:32.588Z"}
{"level":"debug","message":"Executing query [m8orx4v74f29rc2xsb5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:32.611Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:32.660Z"}
{"level":"debug","message":"Executing query [m8orx4wnydhjdwa4jg]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742923952610\"]","timestamp":"2025-03-25T17:32:32.663Z"}
{"level":"debug","message":"Executing query [m8orx4wrulnwkmol5fb]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742923952610\"]","timestamp":"2025-03-25T17:32:32.667Z"}
{"level":"debug","message":"Executing query [m8orx4wt0uhce1y2ggp]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742923952610\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:32:32.669Z"}
{"level":"debug","message":"Executing query [m8orx4x1dtdodrr1jp]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1019]","timestamp":"2025-03-25T17:32:32.677Z"}
{"level":"debug","message":"Executing query [m8orx4x65ojfuap2e5t]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742923952610\"]","timestamp":"2025-03-25T17:32:32.682Z"}
{"level":"debug","message":"Executing query [m8orx4x9i8y08euotf8]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1019]","timestamp":"2025-03-25T17:32:32.685Z"}
{"level":"debug","message":"Executing query [m8orx4xd2os9tig5jz8]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1019]","timestamp":"2025-03-25T17:32:32.689Z"}
{"level":"debug","message":"Executing query [m8orx4xghza4j8thxg7]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1019]","timestamp":"2025-03-25T17:32:32.692Z"}
{"level":"debug","message":"Executing query [m8orx4xjd9mazmlmwd5]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1019]","timestamp":"2025-03-25T17:32:32.696Z"}
{"level":"debug","message":"Executing query [m8orx4xmaupje95cncf]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1019]","timestamp":"2025-03-25T17:32:32.698Z"}
{"level":"debug","message":"Executing query [m8orx4xp0n0o9kjl20o]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1019]","timestamp":"2025-03-25T17:32:32.701Z"}
{"level":"debug","message":"Executing query [m8orx4xsuvyf3b22e6i]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1019]","timestamp":"2025-03-25T17:32:32.704Z"}
{"level":"debug","message":"Executing query [m8orx4xv7hee67a0jn9]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T17:32:32.707Z"}
{"level":"debug","message":"Executing query [m8orx4xx5b9w5famre]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:32.709Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:32.711Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:32:32.810Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:32:32.812Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:32:32.814Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:32:32.815Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:32:32.818Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:32:32.822Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:32:32.825Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:32:32.828Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:32:32.830Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:32:32.832Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:32:32.833Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T17:32:32.835Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:33.019Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:33.997Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:32:34.142Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T17:32:34.147Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:34.203Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T17:32:34.217Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:34.263Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:34.918Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:35.124Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:35.140Z"}
{"level":"debug","message":"Executing query [m8orx6tjzbfyqiqgpvg]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T17:32:35.143Z"}
{"level":"debug","message":"Executing query [m8orx6tlntvsb775rmm]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T17:32:35.145Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8orx6tlntvsb775rmm]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T17:32:35.148Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:35.149Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:35.258Z"}
{"level":"debug","message":"Executing query [m8orx6wtj7id37z80w8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:35.261Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:35.279Z"}
{"level":"debug","message":"Executing query [m8orx6xc756t31vejcv]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T17:32:35.280Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T17:32:35.283Z"}
{"level":"debug","message":"Executing query [m8orx6xg1bxvezvgotk]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T17:32:35.284Z"}
{"level":"debug","message":"Executing query [m8orx6xjp1xnw3l9el]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T17:32:35.287Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T17:32:35.289Z"}
{"level":"debug","message":"Executing query [m8orx6xmiquzpmkasa]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T17:32:35.290Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T17:32:35.292Z"}
{"level":"debug","message":"Executing query [m8orx6xviuglgpqfwa]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T17:32:35.299Z"}
{"level":"debug","message":"Executing query [m8orx6y7mdanugz7o]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T17:32:35.311Z"}
{"level":"debug","message":"Executing query [m8orx6ybm8a9wledq5k]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[39]","timestamp":"2025-03-25T17:32:35.315Z"}
{"level":"debug","message":"Executing query [m8orx6yj8owvn3pkzz9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:35.323Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:37.083Z"}
{"duration":"6ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T17:32:37.146Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T17:32:37.150Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:37.158Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T17:32:37.159Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T17:32:37.262Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T17:32:37.368Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:37.495Z"}
{"level":"debug","message":"Executing query [m8orx8mz2yk3jzz5kae]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:37.499Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:37.508Z"}
{"level":"debug","message":"Executing query [m8orx8nanydjxjensue]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:32:37.510Z"}
{"level":"debug","message":"Executing query [m8orx8ncvhoelrtkobr]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742923957498\"]","timestamp":"2025-03-25T17:32:37.512Z"}
{"level":"debug","message":"Executing query [m8orx8ne3ew7xata2x8]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742923957498\",\"TEST-OFICIO-1742923957498\",3911,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:32:37.514Z"}
{"level":"debug","message":"Executing query [m8orx8nlo6i9xhtp7r]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.521Z"}
{"level":"debug","message":"Executing query [m8orx8nox8nqv6m6f7i]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742923957498\"]","timestamp":"2025-03-25T17:32:37.524Z"}
{"level":"debug","message":"Executing query [m8orx8nu3gtj4llmpng]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",41]","timestamp":"2025-03-25T17:32:37.530Z"}
{"level":"debug","message":"Executing query [m8orx8ny2oa4puzayr7]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.534Z"}
{"level":"debug","message":"Executing query [m8orx8o1gh0oqc8hkpm]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.537Z"}
{"level":"debug","message":"Executing query [m8orx8o5n3l4pf62zgi]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.541Z"}
{"level":"debug","message":"Executing query [m8orx8o7gmvzjjph0re]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.543Z"}
{"level":"debug","message":"Executing query [m8orx8ob738zvq7zyhs]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.547Z"}
{"level":"debug","message":"Executing query [m8orx8oet9x8orq3ryb]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742923957550\",\"TEST-SP-OFICIO-1742923957550\",3254,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T17:32:37.550Z"}
{"level":"debug","message":"Executing query [m8orx8ok94oasb4bpon]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742923957550\"]","timestamp":"2025-03-25T17:32:37.556Z"}
{"level":"debug","message":"Executing query [m8orx8omk4s8gnp5ige]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742923957550\"]","timestamp":"2025-03-25T17:32:37.558Z"}
{"level":"debug","message":"Executing query [m8orx8ot6nfdybhlrfg]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:37.566Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:37.568Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:37.775Z"}
{"level":"debug","message":"Executing query [m8orx8uqixl3349l8r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:37.778Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:37.787Z"}
{"level":"debug","message":"Executing query [m8orx8v0ophbb18pl7d]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:32:37.788Z"}
{"level":"debug","message":"Executing query [m8orx8v3w1pkkibiwzp]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742923957777\"]","timestamp":"2025-03-25T17:32:37.791Z"}
{"level":"debug","message":"Executing query [m8orx8v49rvrd3nbbdg]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742923957777\",\"TEST-OFI-FORENSE-1742923957777\",5451,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742923957777\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:32:37.792Z"}
{"level":"debug","message":"Executing query [m8orx8varw2skasrhq]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.798Z"}
{"level":"debug","message":"Executing query [m8orx8vdvkuzgj0lk48]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742923957777\"]","timestamp":"2025-03-25T17:32:37.801Z"}
{"level":"debug","message":"Executing query [m8orx8vfdvorv0ynvht]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",41]","timestamp":"2025-03-25T17:32:37.803Z"}
{"level":"debug","message":"Executing query [m8orx8vjbgalmlema64]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.807Z"}
{"level":"debug","message":"Executing query [m8orx8vn2mgbow35r9m]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.811Z"}
{"level":"debug","message":"Executing query [m8orx8vqx81n8bkmrl]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.814Z"}
{"level":"debug","message":"Executing query [m8orx8vu4yha9ger2xs]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.818Z"}
{"level":"debug","message":"Executing query [m8orx8vxdsx7atq9a1g]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[41]","timestamp":"2025-03-25T17:32:37.821Z"}
{"level":"debug","message":"Executing query [m8orx8vyuqixques67]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742923957822\",\"TEST-SP-OFI-FORENSE-1742923957822\",2427,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T17:32:37.822Z"}
{"level":"debug","message":"Executing query [m8orx8w2o6tu66y9tpm]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742923957822\"]","timestamp":"2025-03-25T17:32:37.826Z"}
{"level":"debug","message":"Executing query [m8orx8w4wz4kkvgx5b]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742923957822\"]","timestamp":"2025-03-25T17:32:37.828Z"}
{"level":"debug","message":"Executing query [m8orx8w7pum5amxhz0f]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:37.831Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:37.833Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:38.626Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:38.676Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T17:32:38.678Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T17:32:38.776Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T17:32:38.777Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T17:32:38.778Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T17:32:38.778Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T17:32:38.779Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T17:32:38.779Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:39.146Z"}
{"level":"debug","message":"Executing query [m8orx9wssd8er1ufqa]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:39.148Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:39.158Z"}
{"level":"debug","message":"Executing query [m8orx9x46c34c8k19w]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742923959147\"]","timestamp":"2025-03-25T17:32:39.160Z"}
{"level":"debug","message":"Executing query [m8orx9x54k6r5gc3czs]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742923959147\",true]","timestamp":"2025-03-25T17:32:39.161Z"}
{"level":"debug","message":"Executing query [m8orx9xbxuv1fyzt06]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.168Z"}
{"level":"debug","message":"Executing query [m8orx9xfe71uyjpcuwr]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742923959147\"]","timestamp":"2025-03-25T17:32:39.171Z"}
{"level":"debug","message":"Executing query [m8orx9xi02kxhmctabo]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",41]","timestamp":"2025-03-25T17:32:39.174Z"}
{"level":"debug","message":"Executing query [m8orx9xmlbtcq7jve5n]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.179Z"}
{"level":"debug","message":"Executing query [m8orx9xp50ihlpacxlb]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.181Z"}
{"level":"debug","message":"Executing query [m8orx9xsrn982ymiu7k]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.184Z"}
{"level":"debug","message":"Executing query [m8orx9xvnl6vxqz6h7]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.187Z"}
{"level":"debug","message":"Executing query [m8orx9xyn256711tr0f]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.190Z"}
{"level":"debug","message":"Executing query [m8orx9y2hcv7a9376pn]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.194Z"}
{"level":"debug","message":"Executing query [m8orx9y3vga33avfuz]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T17:32:39.195Z"}
{"level":"debug","message":"Executing query [m8orx9y5kckwvieh0wj]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:39.197Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:39.198Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:39.378Z"}
{"level":"debug","message":"Executing query [m8orxa39bf0uvmm61o8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:39.381Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:39.390Z"}
{"level":"debug","message":"Executing query [m8orxa3k46n38s82wph]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:32:39.392Z"}
{"level":"debug","message":"Executing query [m8orxa3mwjoet4mitra]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T17:32:39.394Z"}
{"level":"debug","message":"Executing query [m8orxa3n9h3ej6g4a0s]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T17:32:39.395Z"}
{"level":"debug","message":"Executing query [m8orxa3oqrtvh7n0m3c]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T17:32:39.396Z"}
{"level":"debug","message":"Executing query [m8orxa3t0zqm1b6159m]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T17:32:39.401Z"}
{"level":"debug","message":"Executing query [m8orxa3xx9d7aij8f6]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[42,888,42,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T17:32:39.405Z\",\"ACTIVO\"]","timestamp":"2025-03-25T17:32:39.405Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 42, Área ID: 888, Rol ID: 888, Documento ID: 41","timestamp":"2025-03-25T17:32:39.409Z"}
{"level":"debug","message":"Executing query [m8orxa43cnp8ulufpct]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[41,42,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T17:32:39.411Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8orxa43cnp8ulufpct]","params":"[41,42,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T17:32:39.416Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T17:32:39.416Z"}
{"level":"debug","message":"Executing query [m8orxa49ycftl9r74ur]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.417Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8orxa49ycftl9r74ur]","params":"[41]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T17:32:39.419Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T17:32:39.419Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T17:32:39.419Z"}
{"level":"debug","message":"Executing query [m8orxa4dvccgf8y7s4]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[41,42,\"RESTAURAR\"]","timestamp":"2025-03-25T17:32:39.421Z"}
{"level":"debug","message":"Executing query [m8orxa4ia8i2q5ov7nq]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.426Z"}
{"level":"debug","message":"Executing query [m8orxa4lknugwl0ilo]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[41,42,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T17:32:39.429Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8orxa4lknugwl0ilo]","params":"[41,42,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T17:32:39.432Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T17:32:39.433Z"}
{"level":"debug","message":"Executing query [m8orxa4p4o78ns2gvbq]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[41]","timestamp":"2025-03-25T17:32:39.433Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8orxa4p4o78ns2gvbq]","params":"[41]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T17:32:39.436Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T17:32:39.437Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T17:32:39.437Z"}
{"level":"debug","message":"Executing query [m8orxa4umbi1c33ge6r]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[42,888,42,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T17:32:39.438Z\",\"ACTIVO\"]","timestamp":"2025-03-25T17:32:39.438Z"}
{"level":"debug","message":"Executing query [m8orxa4wz6jilf3oac9]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T17:32:39.440Z"}
{"level":"debug","message":"Executing query [m8orxa4z1s427379p6m]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[42,\"DOCUMENTO\",42,\"ELIMINAR\"]","timestamp":"2025-03-25T17:32:39.443Z"}
{"level":"debug","message":"Executing query [m8orxa51o6vq290z88]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[42]","timestamp":"2025-03-25T17:32:39.445Z"}
{"level":"debug","message":"Executing query [m8orxa55exvfdrom8o]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T17:32:39.449Z"}
{"level":"debug","message":"Executing query [m8orxa58pi38hkox2q]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[42]","timestamp":"2025-03-25T17:32:39.452Z"}
{"level":"debug","message":"Executing query [m8orxa5bqrp7jl10ds]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:32:39.455Z"}
{"level":"debug","message":"Executing query [m8orxa5dahq06fnn8t]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:32:39.457Z"}
{"level":"debug","message":"Executing query [m8orxa5e0ew5rg06inoo]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:32:39.458Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T17:32:39.461Z"}
{"level":"debug","message":"Executing query [m8orxa5hbwfkh2tnu9v]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:39.461Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:39.462Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:39.567Z"}
{"level":"debug","message":"Executing query [m8orxa8i61fh3gffu6l]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:39.570Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:39.584Z"}
{"level":"debug","message":"Executing query [m8orxa8xd2r73bvoz9j]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:32:39.585Z"}
{"level":"debug","message":"Executing query [m8orxa8yzkxzatpi1vh]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:32:39.586Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T17:32:39.588Z"}
{"level":"debug","message":"Executing query [m8orxa91lblf9afw0f]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T17:32:39.589Z"}
{"level":"debug","message":"Executing query [m8orxa92bkq4l16d78m]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T17:32:39.591Z"}
{"level":"debug","message":"Executing query [m8orxa94bsoxwi555z]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T17:32:39.592Z"}
{"level":"debug","message":"Executing query [m8orxa988x8f079wcdt]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[42]","timestamp":"2025-03-25T17:32:39.596Z"}
{"level":"debug","message":"Executing query [m8orxa9anqd4losu3lk]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[42]","timestamp":"2025-03-25T17:32:39.598Z"}
{"level":"debug","message":"Executing query [m8orxa9de37cdumord]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",42]","timestamp":"2025-03-25T17:32:39.601Z"}
{"level":"debug","message":"Executing query [m8orxa9gar1hulmga3]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[42]","timestamp":"2025-03-25T17:32:39.604Z"}
{"level":"debug","message":"Executing query [m8orxa9iq615b4jwvth]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[42]","timestamp":"2025-03-25T17:32:39.606Z"}
{"level":"debug","message":"Executing query [m8orxa9l746k80qvdzk]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[42]","timestamp":"2025-03-25T17:32:39.609Z"}
{"level":"debug","message":"Executing query [m8orxa9n3kw1465fkk2]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:39.611Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:39.612Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:39.782Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:40.185Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:32:40.239Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:40.293Z"}
{"level":"debug","message":"Executing query [m8orxatpyn2vo4f8k7]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T17:32:40.333Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:40.368Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:40.561Z"}
{"level":"debug","message":"Executing query [m8orxb03nlczdqni47]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:40.564Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:40.573Z"}
{"level":"debug","message":"Executing query [m8orxb0fq1gm75plq5]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:32:40.575Z"}
{"level":"debug","message":"Executing query [m8orxb0hers4m350vhg]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742923960563\"]","timestamp":"2025-03-25T17:32:40.577Z"}
{"level":"debug","message":"Executing query [m8orxb0i15pjjbpxqpm]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742923960563\",\"TEST-OFI-QUIMICA-1742923960563\",4480,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:32:40.578Z"}
{"level":"debug","message":"Executing query [m8orxb0njoqlrmimste]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[21]","timestamp":"2025-03-25T17:32:40.583Z"}
{"level":"debug","message":"Executing query [m8orxb0paed2kpdd3h]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742923960563\"]","timestamp":"2025-03-25T17:32:40.585Z"}
{"level":"debug","message":"Executing query [m8orxb0rsxlqyd5rkhq]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",21]","timestamp":"2025-03-25T17:32:40.587Z"}
{"level":"debug","message":"Executing query [m8orxb0wworesg0psgg]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[21]","timestamp":"2025-03-25T17:32:40.592Z"}
{"level":"debug","message":"Executing query [m8orxb0xzho6z9j4pa]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[21]","timestamp":"2025-03-25T17:32:40.593Z"}
{"level":"debug","message":"Executing query [m8orxb11ehhb5il4gd]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[21]","timestamp":"2025-03-25T17:32:40.597Z"}
{"level":"debug","message":"Executing query [m8orxb1398k6a7zppp]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[21]","timestamp":"2025-03-25T17:32:40.599Z"}
{"level":"debug","message":"Executing query [m8orxb163eqlgjocdjc]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[21]","timestamp":"2025-03-25T17:32:40.602Z"}
{"level":"debug","message":"Executing query [m8orxb188nyy3epojvb]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:40.604Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:40.605Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:41.938Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:32:41.942Z"}
{"level":"debug","message":"Executing query [m8orxc2f4dimmx4px8i]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:32:41.943Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:32:41.953Z"}
{"level":"debug","message":"Executing query [m8orxc2qr0g1p3bj1c]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:32:41.954Z"}
{"level":"debug","message":"Executing query [m8orxc2r3uz5we4m0fo]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:32:41.956Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T17:32:41.957Z"}
{"level":"debug","message":"Executing query [m8orxc2ux1bkwjjx33i]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:32:41.958Z"}
{"level":"debug","message":"Executing query [m8orxc2vfvtyrj3ead]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:32:41.959Z"}
{"level":"debug","message":"Executing query [m8orxc2wb48stcg41l]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:32:41.960Z"}
{"level":"debug","message":"Executing query [m8orxc2xzufh7itfnbj]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T17:32:41.961Z"}
{"level":"debug","message":"Executing query [m8orxc31ha0cyv3m0yd]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[43]","timestamp":"2025-03-25T17:32:41.965Z"}
{"level":"debug","message":"Executing query [m8orxc32emtqv0fjt4t]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:32:41.966Z"}
{"level":"debug","message":"Executing query [m8orxc34fvdmh5u1lna]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",43]","timestamp":"2025-03-25T17:32:41.968Z"}
{"level":"debug","message":"Executing query [m8orxc37vve7rwtas1d]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[43]","timestamp":"2025-03-25T17:32:41.971Z"}
{"level":"debug","message":"Executing query [m8orxc395w4vmpw4k8v]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[43]","timestamp":"2025-03-25T17:32:41.973Z"}
{"level":"debug","message":"Executing query [m8orxc3cbjii36h4hid]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[43]","timestamp":"2025-03-25T17:32:41.976Z"}
{"level":"debug","message":"Executing query [m8orxc3eufsh2r5mzbj]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:32:41.978Z"}
{"level":"debug","message":"Executing query [m8orxc3fnur2hn1j2yj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:32:41.979Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T17:32:41.980Z"}
{"level":"debug","message":"Executing query [m8orxc3hk0il75ojvy7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:32:41.981Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:32:41.982Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:23.366Z"}
{"level":"debug","message":"Executing query [m8ory81nbl2wvx4puu5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:23.387Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:23.414Z"}
{"level":"debug","message":"Executing query [m8ory82igjvlysl9dy]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742924003386\"]","timestamp":"2025-03-25T17:33:23.418Z"}
{"level":"debug","message":"Executing query [m8ory82m4vtcljjt2mf]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742924003386\"]","timestamp":"2025-03-25T17:33:23.422Z"}
{"level":"debug","message":"Executing query [m8ory82pbxugpz23qgp]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742924003386\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:33:23.425Z"}
{"level":"debug","message":"Executing query [m8ory82y3vumpju3z4h]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1020]","timestamp":"2025-03-25T17:33:23.434Z"}
{"level":"debug","message":"Executing query [m8ory831b0nvtcer5n]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742924003386\"]","timestamp":"2025-03-25T17:33:23.437Z"}
{"level":"debug","message":"Executing query [m8ory83430tqbogmtaq]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1020]","timestamp":"2025-03-25T17:33:23.440Z"}
{"level":"debug","message":"Executing query [m8ory8375dw7pwkpkwe]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1020]","timestamp":"2025-03-25T17:33:23.443Z"}
{"level":"debug","message":"Executing query [m8ory83aoz43ynryy68]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1020]","timestamp":"2025-03-25T17:33:23.446Z"}
{"level":"debug","message":"Executing query [m8ory83e1lan2mfnbkr]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1020]","timestamp":"2025-03-25T17:33:23.450Z"}
{"level":"debug","message":"Executing query [m8ory83glbafek9hft7]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1020]","timestamp":"2025-03-25T17:33:23.452Z"}
{"level":"debug","message":"Executing query [m8ory83igawzara181]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1020]","timestamp":"2025-03-25T17:33:23.454Z"}
{"level":"debug","message":"Executing query [m8ory83lvqm1e5lj14d]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1020]","timestamp":"2025-03-25T17:33:23.457Z"}
{"level":"debug","message":"Executing query [m8ory83o4o5kc43o2ue]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T17:33:23.460Z"}
{"level":"debug","message":"Executing query [m8ory83q67ecxlm57t]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:23.462Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:23.464Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:33:23.557Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:33:23.559Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:33:23.561Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:33:23.563Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:33:23.566Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:33:23.568Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:33:23.572Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:33:23.576Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:33:23.577Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:33:23.579Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:33:23.580Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T17:33:23.581Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:23.763Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:24.761Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:33:24.905Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T17:33:24.910Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:24.967Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T17:33:24.980Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:25.026Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:25.621Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:25.850Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:25.866Z"}
{"level":"debug","message":"Executing query [m8ory9yl6c7vwbuqra]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T17:33:25.869Z"}
{"level":"debug","message":"Executing query [m8ory9yn2535k9yy1ogi]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T17:33:25.871Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8ory9yn2535k9yy1ogi]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T17:33:25.873Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:25.874Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:25.976Z"}
{"level":"debug","message":"Executing query [m8orya1nvq80fcf790o]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:25.979Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:25.996Z"}
{"level":"debug","message":"Executing query [m8orya26nz09ookpy8l]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T17:33:25.998Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T17:33:25.999Z"}
{"level":"debug","message":"Executing query [m8orya282o5hf1zhm3j]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T17:33:26.000Z"}
{"level":"debug","message":"Executing query [m8orya2a7gkk36py93m]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T17:33:26.002Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T17:33:26.004Z"}
{"level":"debug","message":"Executing query [m8orya2csp8kapil8dm]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T17:33:26.004Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T17:33:26.006Z"}
{"level":"debug","message":"Executing query [m8orya2jx6ii9ptnqm]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T17:33:26.011Z"}
{"level":"debug","message":"Executing query [m8orya2m4ihw4s07da]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T17:33:26.014Z"}
{"level":"debug","message":"Executing query [m8orya2wmn9ssfxawf]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[41]","timestamp":"2025-03-25T17:33:26.024Z"}
{"level":"debug","message":"Executing query [m8orya31z9pngz9zm0k]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:26.029Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:27.686Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T17:33:27.745Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T17:33:27.751Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:27.759Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T17:33:27.761Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T17:33:27.854Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T17:33:27.955Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:28.078Z"}
{"level":"debug","message":"Executing query [m8orybo1f8dsw2k9z2j]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:28.081Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:28.090Z"}
{"level":"debug","message":"Executing query [m8oryboc59wjtqqn6er]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:33:28.092Z"}
{"level":"debug","message":"Executing query [m8oryboebgejn3zi55]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742924008080\"]","timestamp":"2025-03-25T17:33:28.094Z"}
{"level":"debug","message":"Executing query [m8orybof34t7dk04d6i]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742924008080\",\"TEST-OFICIO-1742924008080\",4751,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:33:28.095Z"}
{"level":"debug","message":"Executing query [m8orybolj12o54yn61s]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.101Z"}
{"level":"debug","message":"Executing query [m8orybonhfcueptc2n]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742924008080\"]","timestamp":"2025-03-25T17:33:28.103Z"}
{"level":"debug","message":"Executing query [m8orybotteaeytkyak]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",43]","timestamp":"2025-03-25T17:33:28.109Z"}
{"level":"debug","message":"Executing query [m8orybowcna8ai0oymu]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.112Z"}
{"level":"debug","message":"Executing query [m8orybozu1ly3bq8tsr]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.115Z"}
{"level":"debug","message":"Executing query [m8orybp23uqai5enpei]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.118Z"}
{"level":"debug","message":"Executing query [m8orybp4qgapw1yd9ql]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.120Z"}
{"level":"debug","message":"Executing query [m8orybp7sba3738kmh]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.123Z"}
{"level":"debug","message":"Executing query [m8orybp8his4khmgauv]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742924008124\",\"TEST-SP-OFICIO-1742924008124\",201,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T17:33:28.124Z"}
{"level":"debug","message":"Executing query [m8orybpbw28jp9ygxlf]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742924008124\"]","timestamp":"2025-03-25T17:33:28.127Z"}
{"level":"debug","message":"Executing query [m8orybpdzfgr9ggfmt]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742924008124\"]","timestamp":"2025-03-25T17:33:28.129Z"}
{"level":"debug","message":"Executing query [m8orybpf07ebflm3toso]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:28.131Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:28.132Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:28.314Z"}
{"level":"debug","message":"Executing query [m8orybul2p53svwcu6u]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:28.317Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:28.326Z"}
{"level":"debug","message":"Executing query [m8orybuvowmrf9tp7ee]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:33:28.327Z"}
{"level":"debug","message":"Executing query [m8orybuyoxm1oi6908i]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742924008316\"]","timestamp":"2025-03-25T17:33:28.330Z"}
{"level":"debug","message":"Executing query [m8orybuzkbh0brfz94k]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742924008316\",\"TEST-OFI-FORENSE-1742924008316\",3391,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742924008316\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:33:28.331Z"}
{"level":"debug","message":"Executing query [m8orybv5xnatjxo43ba]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.337Z"}
{"level":"debug","message":"Executing query [m8orybv88iocqauouuk]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742924008316\"]","timestamp":"2025-03-25T17:33:28.340Z"}
{"level":"debug","message":"Executing query [m8orybv9d6rnw60wqk4]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",43]","timestamp":"2025-03-25T17:33:28.341Z"}
{"level":"debug","message":"Executing query [m8orybve94fiwj4cew7]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.346Z"}
{"level":"debug","message":"Executing query [m8orybvglujv12x7u1p]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.348Z"}
{"level":"debug","message":"Executing query [m8orybvkr2szx72n0t9]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.352Z"}
{"level":"debug","message":"Executing query [m8orybvmjs90onvnlen]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.354Z"}
{"level":"debug","message":"Executing query [m8orybvpzikwobx34pc]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[43]","timestamp":"2025-03-25T17:33:28.357Z"}
{"level":"debug","message":"Executing query [m8orybvrg16jnz936a7]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742924008359\",\"TEST-SP-OFI-FORENSE-1742924008359\",3933,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T17:33:28.359Z"}
{"level":"debug","message":"Executing query [m8orybvuq8tr0i58c1]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742924008359\"]","timestamp":"2025-03-25T17:33:28.363Z"}
{"level":"debug","message":"Executing query [m8orybvwbmqum2j40qi]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742924008359\"]","timestamp":"2025-03-25T17:33:28.364Z"}
{"level":"debug","message":"Executing query [m8orybvz6fsndkqomce]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:28.367Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:28.368Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:29.155Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:29.201Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T17:33:29.204Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T17:33:29.296Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T17:33:29.297Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T17:33:29.298Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T17:33:29.298Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T17:33:29.299Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T17:33:29.299Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:29.687Z"}
{"level":"debug","message":"Executing query [m8orycwqggp4vchykn5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:29.690Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:29.700Z"}
{"level":"debug","message":"Executing query [m8orycx15aaa3qnw2do]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742924009690\"]","timestamp":"2025-03-25T17:33:29.701Z"}
{"level":"debug","message":"Executing query [m8orycx3vls09d1a2gl]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742924009690\",true]","timestamp":"2025-03-25T17:33:29.703Z"}
{"level":"debug","message":"Executing query [m8orycxaepq71xe9z66]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.710Z"}
{"level":"debug","message":"Executing query [m8orycxdbkhwz69b2mj]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742924009690\"]","timestamp":"2025-03-25T17:33:29.713Z"}
{"level":"debug","message":"Executing query [m8orycxf62m9kow5va8]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",43]","timestamp":"2025-03-25T17:33:29.715Z"}
{"level":"debug","message":"Executing query [m8orycxioj0vicknb4p]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.718Z"}
{"level":"debug","message":"Executing query [m8orycxkl2uc1949kts]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.720Z"}
{"level":"debug","message":"Executing query [m8orycxm9ic7atbu2sp]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.722Z"}
{"level":"debug","message":"Executing query [m8orycxpnvkbqzpcg2k]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.725Z"}
{"level":"debug","message":"Executing query [m8orycxtdg0t1ujmmt6]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.729Z"}
{"level":"debug","message":"Executing query [m8orycxwlwqj0653dhb]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.732Z"}
{"level":"debug","message":"Executing query [m8orycxxvu8apgy22tl]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T17:33:29.734Z"}
{"level":"debug","message":"Executing query [m8orycxzkd4ntgvvsxp]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:29.735Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:29.735Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:29.909Z"}
{"level":"debug","message":"Executing query [m8oryd2xljbf1us7iu]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:29.913Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:29.922Z"}
{"level":"debug","message":"Executing query [m8oryd37cxhzhe32155]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:33:29.923Z"}
{"level":"debug","message":"Executing query [m8oryd396gzvd1t1i4m]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T17:33:29.925Z"}
{"level":"debug","message":"Executing query [m8oryd3akmossfyo59o]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T17:33:29.926Z"}
{"level":"debug","message":"Executing query [m8oryd3b8ifc7mldk1c]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T17:33:29.927Z"}
{"level":"debug","message":"Executing query [m8oryd3gi3omtl0epa]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T17:33:29.932Z"}
{"level":"debug","message":"Executing query [m8oryd3jvnv8g6otape]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[44,888,44,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T17:33:29.935Z\",\"ACTIVO\"]","timestamp":"2025-03-25T17:33:29.935Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 44, Área ID: 888, Rol ID: 888, Documento ID: 43","timestamp":"2025-03-25T17:33:29.939Z"}
{"level":"debug","message":"Executing query [m8oryd3oxep8qch0e7k]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[43,44,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T17:33:29.940Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8oryd3oxep8qch0e7k]","params":"[43,44,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T17:33:29.945Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T17:33:29.946Z"}
{"level":"debug","message":"Executing query [m8oryd3u7rj2ud2qo83]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.946Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8oryd3u7rj2ud2qo83]","params":"[43]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T17:33:29.949Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T17:33:29.950Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T17:33:29.950Z"}
{"level":"debug","message":"Executing query [m8oryd3zgj3xmhyovxt]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[43,44,\"RESTAURAR\"]","timestamp":"2025-03-25T17:33:29.951Z"}
{"level":"debug","message":"Executing query [m8oryd45xnzkxm0lp9n]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.957Z"}
{"level":"debug","message":"Executing query [m8oryd4765btgkn9w8n]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[43,44,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T17:33:29.959Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8oryd4765btgkn9w8n]","params":"[43,44,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T17:33:29.965Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T17:33:29.966Z"}
{"level":"debug","message":"Executing query [m8oryd4fbr2qjgfnkbh]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[43]","timestamp":"2025-03-25T17:33:29.967Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8oryd4fbr2qjgfnkbh]","params":"[43]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T17:33:29.969Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T17:33:29.970Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T17:33:29.970Z"}
{"level":"debug","message":"Executing query [m8oryd4jclynzvrab5r]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[44,888,44,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T17:33:29.971Z\",\"ACTIVO\"]","timestamp":"2025-03-25T17:33:29.971Z"}
{"level":"debug","message":"Executing query [m8oryd4m51ykeq3eaqe]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T17:33:29.974Z"}
{"level":"debug","message":"Executing query [m8oryd4puyd3tsfmf3]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[44,\"DOCUMENTO\",44,\"ELIMINAR\"]","timestamp":"2025-03-25T17:33:29.977Z"}
{"level":"debug","message":"Executing query [m8oryd4rifub95hiuz9]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[44]","timestamp":"2025-03-25T17:33:29.979Z"}
{"level":"debug","message":"Executing query [m8oryd4umtwjljj54w]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T17:33:29.982Z"}
{"level":"debug","message":"Executing query [m8oryd4yntqa2oosmk]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[44]","timestamp":"2025-03-25T17:33:29.986Z"}
{"level":"debug","message":"Executing query [m8oryd51zow0jvkzrp]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:33:29.989Z"}
{"level":"debug","message":"Executing query [m8oryd523ak6k125e8m]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:33:29.990Z"}
{"level":"debug","message":"Executing query [m8oryd53shq7rejurvp]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:33:29.991Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T17:33:29.994Z"}
{"level":"debug","message":"Executing query [m8oryd57zw0hee83mo]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:29.995Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:29.996Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:30.094Z"}
{"level":"debug","message":"Executing query [m8oryd8115ro89251ja]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:30.097Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:30.110Z"}
{"level":"debug","message":"Executing query [m8oryd8fhic6dc3kq7t]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:33:30.111Z"}
{"level":"debug","message":"Executing query [m8oryd8hdzr4ywf0xlo]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:33:30.113Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T17:33:30.115Z"}
{"level":"debug","message":"Executing query [m8oryd8j36ns7kifs6]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T17:33:30.115Z"}
{"level":"debug","message":"Executing query [m8oryd8k2zz8b6s6wz3]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T17:33:30.116Z"}
{"level":"debug","message":"Executing query [m8oryd8lerl3inao6gf]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T17:33:30.117Z"}
{"level":"debug","message":"Executing query [m8oryd8p3b02fkqh1vt]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[44]","timestamp":"2025-03-25T17:33:30.121Z"}
{"level":"debug","message":"Executing query [m8oryd8sf64cwazhk05]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[44]","timestamp":"2025-03-25T17:33:30.124Z"}
{"level":"debug","message":"Executing query [m8oryd8u2n16zyvk6q2]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",44]","timestamp":"2025-03-25T17:33:30.126Z"}
{"level":"debug","message":"Executing query [m8oryd8xsgvw1m45cv]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[44]","timestamp":"2025-03-25T17:33:30.129Z"}
{"level":"debug","message":"Executing query [m8oryd8zubzslzlpyw9]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[44]","timestamp":"2025-03-25T17:33:30.131Z"}
{"level":"debug","message":"Executing query [m8oryd92va498ciqsa]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[44]","timestamp":"2025-03-25T17:33:30.134Z"}
{"level":"debug","message":"Executing query [m8oryd93bc3c6uz1oc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:30.135Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:30.137Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:30.305Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:30.697Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:33:30.752Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:30.800Z"}
{"level":"debug","message":"Executing query [m8oryds5d5xi81onlkv]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T17:33:30.821Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:30.854Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:31.037Z"}
{"level":"debug","message":"Executing query [m8orydy7bo73nzyc3wu]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:31.039Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:31.048Z"}
{"level":"debug","message":"Executing query [m8orydyidkdk17nr1i6]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:33:31.050Z"}
{"level":"debug","message":"Executing query [m8orydyk6cdg8s7cu0t]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742924011039\"]","timestamp":"2025-03-25T17:33:31.052Z"}
{"level":"debug","message":"Executing query [m8orydymvq4s81awd1d]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742924011039\",\"TEST-OFI-QUIMICA-1742924011039\",9999,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:33:31.054Z"}
{"level":"debug","message":"Executing query [m8orydyssbszhdq330j]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[22]","timestamp":"2025-03-25T17:33:31.060Z"}
{"level":"debug","message":"Executing query [m8orydyv4mpb2womg17]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742924011039\"]","timestamp":"2025-03-25T17:33:31.063Z"}
{"level":"debug","message":"Executing query [m8orydyy3lf4rjchqhb]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",22]","timestamp":"2025-03-25T17:33:31.066Z"}
{"level":"debug","message":"Executing query [m8orydz1nbgvsqa20nq]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[22]","timestamp":"2025-03-25T17:33:31.069Z"}
{"level":"debug","message":"Executing query [m8orydz4nmvtrzdywd]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[22]","timestamp":"2025-03-25T17:33:31.072Z"}
{"level":"debug","message":"Executing query [m8orydz71x9knc83du3j]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[22]","timestamp":"2025-03-25T17:33:31.075Z"}
{"level":"debug","message":"Executing query [m8orydz8tzv65pup6qk]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[22]","timestamp":"2025-03-25T17:33:31.076Z"}
{"level":"debug","message":"Executing query [m8orydzc5ymz4re94qd]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[22]","timestamp":"2025-03-25T17:33:31.080Z"}
{"level":"debug","message":"Executing query [m8orydzeqcay0la27pj]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:31.082Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:31.086Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:32.420Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:33:32.423Z"}
{"level":"debug","message":"Executing query [m8oryf0p4754wpmn82h]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:33:32.425Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:33:32.435Z"}
{"level":"debug","message":"Executing query [m8oryf10yjehmg8e6vm]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:33:32.436Z"}
{"level":"debug","message":"Executing query [m8oryf11uvxwspt26pf]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:33:32.437Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T17:33:32.438Z"}
{"level":"debug","message":"Executing query [m8oryf131euyz01ebxi]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:33:32.439Z"}
{"level":"debug","message":"Executing query [m8oryf14rwxgjvebvpj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:33:32.440Z"}
{"level":"debug","message":"Executing query [m8oryf168te4qbabf1y]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:33:32.442Z"}
{"level":"debug","message":"Executing query [m8oryf16r7xatupj94]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T17:33:32.442Z"}
{"level":"debug","message":"Executing query [m8oryf1c79qkcl1yhgh]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[45]","timestamp":"2025-03-25T17:33:32.448Z"}
{"level":"debug","message":"Executing query [m8oryf1fy1rcq7f0uv]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:33:32.451Z"}
{"level":"debug","message":"Executing query [m8oryf1gxwgs1026zum]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",45]","timestamp":"2025-03-25T17:33:32.452Z"}
{"level":"debug","message":"Executing query [m8oryf1kgghaqkdwl5]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[45]","timestamp":"2025-03-25T17:33:32.456Z"}
{"level":"debug","message":"Executing query [m8oryf1lygp921o49mj]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[45]","timestamp":"2025-03-25T17:33:32.457Z"}
{"level":"debug","message":"Executing query [m8oryf25a42f4g6z8a5]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[45]","timestamp":"2025-03-25T17:33:32.477Z"}
{"level":"debug","message":"Executing query [m8oryf26kndmucgqd2s]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:33:32.478Z"}
{"level":"debug","message":"Executing query [m8oryf27imwcj9ryhul]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:33:32.479Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T17:33:32.480Z"}
{"level":"debug","message":"Executing query [m8oryf28o9xhe78pwqj]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:33:32.481Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:33:32.482Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T17:34:29.522Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T17:34:29.526Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T17:34:29.527Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T17:34:29.527Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T17:34:29.528Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T17:34:29.528Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:34:43.055Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:34:43.085Z"}
{"level":"debug","message":"Executing query [m8orzxjkop9nxy6jce]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:34:43.089Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:34:43.124Z"}
{"level":"debug","message":"Executing query [m8orzxknh54w15amwwk]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:34:43.127Z"}
{"level":"debug","message":"Executing query [m8orzxkq6zkwq2dfcc]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:34:43.130Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T17:34:43.132Z"}
{"level":"debug","message":"Executing query [m8orzxktlw5sfxpjmr]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:34:43.133Z"}
{"level":"debug","message":"Executing query [m8orzxku27fifou27f5]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:34:43.134Z"}
{"level":"debug","message":"Executing query [m8orzxky2m45h53we3w]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:34:43.138Z"}
{"level":"debug","message":"Executing query [m8orzxkztjroawc7ykg]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T17:34:43.139Z"}
{"level":"debug","message":"Executing query [m8orzxl7q2vmoi4hjx]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[46]","timestamp":"2025-03-25T17:34:43.147Z"}
{"level":"debug","message":"Executing query [m8orzxlafs39m61sbgu]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:34:43.151Z"}
{"level":"debug","message":"Executing query [m8orzxlf2lyeic4465w]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",46]","timestamp":"2025-03-25T17:34:43.155Z"}
{"level":"debug","message":"Executing query [m8orzxlki561xkcemn]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[46]","timestamp":"2025-03-25T17:34:43.160Z"}
{"level":"debug","message":"Executing query [m8orzxlmz7ltktyfyd]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[46]","timestamp":"2025-03-25T17:34:43.162Z"}
{"level":"debug","message":"Executing query [m8orzxlpn6jk1t8w6jn]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[46]","timestamp":"2025-03-25T17:34:43.165Z"}
{"level":"debug","message":"Executing query [m8orzxlrlx21qoft7v]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:34:43.167Z"}
{"level":"debug","message":"Executing query [m8orzxlsmvspw3ry0gd]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:34:43.168Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T17:34:43.169Z"}
{"level":"debug","message":"Executing query [m8orzxlubzmt0k0ank]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:34:43.170Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:34:43.172Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:34:57.269Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:34:57.450Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T17:34:57.461Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:34:57.578Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T17:34:57.592Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:34:57.641Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:35:34.768Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:35:34.954Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:35:35.074Z"}
{"level":"debug","message":"Executing query [m8os11oi6an3ohpmcqk]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T17:35:35.106Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:35:35.143Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T17:36:13.184Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T17:36:13.187Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.191Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.236Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.243Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.255Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.261Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.265Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.343Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.353Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:36:13.356Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T17:37:56.644Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T17:37:56.648Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.651Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.701Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.707Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.720Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.726Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.731Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.814Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.823Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T17:37:56.826Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:42.085Z"}
{"level":"debug","message":"Executing query [m8osw26xvafgnypicvt]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:42.106Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:42.137Z"}
{"level":"debug","message":"Executing query [m8osw27wrzsllqx38jl]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742925582105\"]","timestamp":"2025-03-25T17:59:42.140Z"}
{"level":"debug","message":"Executing query [m8osw27zuv3m2uorckj]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742925582105\"]","timestamp":"2025-03-25T17:59:42.143Z"}
{"level":"debug","message":"Executing query [m8osw281j5ad2fhlwzm]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742925582105\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:59:42.145Z"}
{"level":"debug","message":"Executing query [m8osw286s3jzc1vs76]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T17:59:42.150Z"}
{"level":"debug","message":"Executing query [m8osw289k9ue0bend2]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742925582105\"]","timestamp":"2025-03-25T17:59:42.153Z"}
{"level":"debug","message":"Executing query [m8osw28bsoj8emx772o]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",6]","timestamp":"2025-03-25T17:59:42.155Z"}
{"level":"debug","message":"Executing query [m8osw28eu72xj0m5o5]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T17:59:42.158Z"}
{"level":"debug","message":"Executing query [m8osw28gj1c13c9b9zi]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T17:59:42.160Z"}
{"level":"debug","message":"Executing query [m8osw28jy88gpx5ti2]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T17:59:42.163Z"}
{"level":"debug","message":"Executing query [m8osw28lsrmlr1965pn]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T17:59:42.165Z"}
{"level":"debug","message":"Executing query [m8osw28ngjlcniti7p]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T17:59:42.167Z"}
{"level":"debug","message":"Executing query [m8osw28p7hmk13l3fqo]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T17:59:42.169Z"}
{"level":"debug","message":"Executing query [m8osw28rck81nbt8p0d]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T17:59:42.171Z"}
{"level":"debug","message":"Executing query [m8osw28sewafiiyxjo9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:42.172Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:42.173Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:59:42.261Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:59:42.263Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:59:42.265Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:59:42.266Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:59:42.268Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:59:42.271Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T17:59:42.273Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:59:42.276Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:59:42.277Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:59:42.278Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T17:59:42.279Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T17:59:42.280Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:42.459Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:43.290Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:59:43.414Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T17:59:43.419Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:43.486Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T17:59:43.502Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:43.553Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:44.164Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:44.352Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:44.367Z"}
{"level":"debug","message":"Executing query [m8osw3xuykw1gpjrap]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T17:59:44.370Z"}
{"level":"debug","message":"Executing query [m8osw3xxr88emjmkqw]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T17:59:44.373Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8osw3xxr88emjmkqw]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T17:59:44.375Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:44.376Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:44.469Z"}
{"level":"debug","message":"Executing query [m8osw40oqsaiyghple]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:44.472Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:44.493Z"}
{"level":"debug","message":"Executing query [m8osw41bvxv81bgbsy]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T17:59:44.495Z"}
{"level":"debug","message":"Executing query [m8osw41eji5vjgmovir]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T17:59:44.498Z"}
{"level":"debug","message":"Executing query [m8osw41hhyubbp198g7]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T17:59:44.501Z"}
{"level":"debug","message":"Executing query [m8osw41jm1bjwhf6l3]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T17:59:44.503Z"}
{"level":"info","message":"Usando Mesa ID: 1, Áreas ID: 1/2, Usuarios ID: 1/2, Documento ID: 1","timestamp":"2025-03-25T17:59:44.506Z"}
{"level":"debug","message":"Executing query [m8osw41o4exl43fibie]: DELETE FROM Derivacion WHERE IDDocumento = ? AND IDAreaOrigen = ? AND IDAreaDestino = ?","params":"[1,1,2]","timestamp":"2025-03-25T17:59:44.508Z"}
{"level":"debug","message":"Executing query [m8osw41zn9wf0gnprdm]: INSERT INTO Derivacion (\n          IDDocumento, IDMesaPartes, IDAreaOrigen, IDAreaDestino, \n          IDUsuarioDeriva, EstadoDerivacion, Observacion\n        ) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[1,1,1,2,1,\"PENDIENTE\",\"Derivación creada para pruebas automatizadas\"]","timestamp":"2025-03-25T17:59:44.519Z"}
{"level":"debug","message":"Executing query [m8osw427za8ssvxx95]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[5]","timestamp":"2025-03-25T17:59:44.527Z"}
{"level":"debug","message":"Executing query [m8osw42cxwvvjemoso]: UPDATE Derivacion SET EstadoDerivacion = ?, Observacion = ?, FechaRecepcion = ?, IDUsuarioRecibe = ? WHERE IDDerivacion = ?","params":"[\"RECIBIDO\",\"Derivación actualizada en pruebas\",\"2025-03-25 17:59:44\",2,5]","timestamp":"2025-03-25T17:59:44.532Z"}
{"level":"debug","message":"Executing query [m8osw42izsv5yoevdt]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[5]","timestamp":"2025-03-25T17:59:44.538Z"}
{"level":"debug","message":"Executing query [m8osw42l80mzycva1o]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T17:59:44.542Z"}
{"level":"debug","message":"Executing query [m8osw42o73xvwoxylm]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T17:59:44.544Z"}
{"level":"debug","message":"Executing query [m8osw42rcxuk0gjtej]: DELETE FROM Derivacion WHERE IDDerivacion = ?","params":"[5]","timestamp":"2025-03-25T17:59:44.547Z"}
{"level":"debug","message":"Executing query [m8osw42vrox2yhdz4]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[5]","timestamp":"2025-03-25T17:59:44.551Z"}
{"level":"debug","message":"Executing query [m8osw42xttnq9an26z]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[1]","timestamp":"2025-03-25T17:59:44.553Z"}
{"level":"debug","message":"Executing query [m8osw432e8heeiv8lxt]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:44.558Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:45.995Z"}
{"duration":"6ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T17:59:46.052Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T17:59:46.056Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:46.062Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T17:59:46.065Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T17:59:46.153Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T17:59:46.247Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:46.363Z"}
{"level":"debug","message":"Executing query [m8osw5h9mkldfefy9h]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:46.365Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:46.377Z"}
{"level":"debug","message":"Executing query [m8osw5hn6xemvu3wumu]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:59:46.379Z"}
{"level":"debug","message":"Executing query [m8osw5hpaob14e66oo]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742925586365\"]","timestamp":"2025-03-25T17:59:46.381Z"}
{"level":"debug","message":"Executing query [m8osw5hrmehpuoc0oge]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742925586365\",\"TEST-OFICIO-1742925586365\",350,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:59:46.383Z"}
{"level":"debug","message":"Executing query [m8osw5hxf82uoqwjrp]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.389Z"}
{"level":"debug","message":"Executing query [m8osw5i1bdl3ty8cfz]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742925586365\"]","timestamp":"2025-03-25T17:59:46.393Z"}
{"level":"debug","message":"Executing query [m8osw5i27ingmkk6aca]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",3]","timestamp":"2025-03-25T17:59:46.395Z"}
{"level":"debug","message":"Executing query [m8osw5i66wjqdj62xbr]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.398Z"}
{"level":"debug","message":"Executing query [m8osw5i870wl4c97igl]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.400Z"}
{"level":"debug","message":"Executing query [m8osw5ibmcdqwt28vej]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.403Z"}
{"level":"debug","message":"Executing query [m8osw5icfyhmx6w5o48]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.404Z"}
{"level":"debug","message":"Executing query [m8osw5iguyfl8lk3pw]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.408Z"}
{"level":"debug","message":"Executing query [m8osw5ihta3ybzbns3]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742925586409\",\"TEST-SP-OFICIO-1742925586409\",5062,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T17:59:46.409Z"}
{"level":"debug","message":"Executing query [m8osw5ikwi0izidv6a]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742925586409\"]","timestamp":"2025-03-25T17:59:46.412Z"}
{"level":"debug","message":"Executing query [m8osw5il0goxfva3uxj]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742925586409\"]","timestamp":"2025-03-25T17:59:46.413Z"}
{"level":"debug","message":"Executing query [m8osw5iot9olfts375]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:46.416Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:46.417Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:46.585Z"}
{"level":"debug","message":"Executing query [m8osw5nft0b6lrmi8at]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:46.587Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:46.595Z"}
{"level":"debug","message":"Executing query [m8osw5np56f5m9hfhs9]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:59:46.597Z"}
{"level":"debug","message":"Executing query [m8osw5nr0n4rzzmzco3]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742925586586\"]","timestamp":"2025-03-25T17:59:46.599Z"}
{"level":"debug","message":"Executing query [m8osw5nsmz4kqjyxlh]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742925586586\",\"TEST-OFI-FORENSE-1742925586586\",4416,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742925586586\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:59:46.600Z"}
{"level":"debug","message":"Executing query [m8osw5nxocat4dg0q1e]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.606Z"}
{"level":"debug","message":"Executing query [m8osw5o0gj0k1pzzbp]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742925586586\"]","timestamp":"2025-03-25T17:59:46.608Z"}
{"level":"debug","message":"Executing query [m8osw5o2gongbprfrqu]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",3]","timestamp":"2025-03-25T17:59:46.610Z"}
{"level":"debug","message":"Executing query [m8osw5o6hu0ey0lsfo]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.614Z"}
{"level":"debug","message":"Executing query [m8osw5o8tkworymyayn]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.616Z"}
{"level":"debug","message":"Executing query [m8osw5oa1w2ntyh7j4a]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.618Z"}
{"level":"debug","message":"Executing query [m8osw5odvp7fdrhhyp]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.621Z"}
{"level":"debug","message":"Executing query [m8osw5ofddzmvm88oia]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T17:59:46.623Z"}
{"level":"debug","message":"Executing query [m8osw5oho4rb0pbu7p9]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742925586625\",\"TEST-SP-OFI-FORENSE-1742925586625\",3264,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T17:59:46.625Z"}
{"level":"debug","message":"Executing query [m8osw5okmb7dciadqp]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742925586625\"]","timestamp":"2025-03-25T17:59:46.628Z"}
{"level":"debug","message":"Executing query [m8osw5omwjne74uveks]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742925586625\"]","timestamp":"2025-03-25T17:59:46.630Z"}
{"level":"debug","message":"Executing query [m8osw5orbimppj3i7sd]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:46.635Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:46.636Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:47.339Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:47.383Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T17:59:47.385Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T17:59:47.471Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T17:59:47.471Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T17:59:47.472Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T17:59:47.472Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T17:59:47.473Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T17:59:47.473Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:47.807Z"}
{"level":"debug","message":"Executing query [m8osw6lectjb3kify6r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:47.810Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:47.820Z"}
{"level":"debug","message":"Executing query [m8osw6lqfaapknuj83]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742925587809\"]","timestamp":"2025-03-25T17:59:47.822Z"}
{"level":"debug","message":"Executing query [m8osw6lsqu1dzraaxil]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742925587809\",true]","timestamp":"2025-03-25T17:59:47.824Z"}
{"level":"debug","message":"Executing query [m8osw6lz6p7ysqkmhzc]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T17:59:47.831Z"}
{"level":"debug","message":"Executing query [m8osw6m1myinl1bgrc]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742925587809\"]","timestamp":"2025-03-25T17:59:47.833Z"}
{"level":"debug","message":"Executing query [m8osw6m2ewxemfpkhkp]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",3]","timestamp":"2025-03-25T17:59:47.834Z"}
{"level":"debug","message":"Executing query [m8osw6m6wailbgnkskn]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T17:59:47.838Z"}
{"level":"debug","message":"Executing query [m8osw6m75psn5blb2eh]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T17:59:47.839Z"}
{"level":"debug","message":"Executing query [m8osw6maq8yfrhd90jd]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T17:59:47.842Z"}
{"level":"debug","message":"Executing query [m8osw6mcfq6f73rnfca]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T17:59:47.844Z"}
{"level":"debug","message":"Executing query [m8osw6me7o70wev1fr2]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T17:59:47.846Z"}
{"level":"debug","message":"Executing query [m8osw6milwfsfo8ap7]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T17:59:47.850Z"}
{"level":"debug","message":"Executing query [m8osw6mk74rng70kqca]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T17:59:47.852Z"}
{"level":"debug","message":"Executing query [m8osw6mlvh1t3rfu5ul]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:47.853Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:47.854Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:48.014Z"}
{"level":"debug","message":"Executing query [m8osw6r5wtd9kci6buh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:48.017Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:48.024Z"}
{"level":"debug","message":"Executing query [m8osw6re7a2y2z5a8ba]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:59:48.026Z"}
{"level":"debug","message":"Executing query [m8osw6rg4hn4fj3pd56]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T17:59:48.028Z"}
{"level":"debug","message":"Executing query [m8osw6rhbu0nm7a7oe]: INSERT INTO AreaEspecializada (IDArea, NombreArea, CodigoIdentificacion, TipoArea, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Área Papelera\",\"TEST-PAPELERA\",\"PRUEBA\",1]","timestamp":"2025-03-25T17:59:48.029Z"}
{"level":"debug","message":"Executing query [m8osw6rmqt45q850l7]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T17:59:48.034Z"}
{"level":"debug","message":"Executing query [m8osw6ro0k865crm5rz7]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","timestamp":"2025-03-25T17:59:48.037Z"}
{"level":"debug","message":"Executing query [m8osw6rs13jny9c5q9pr]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T17:59:48.040Z"}
{"level":"debug","message":"Executing query [m8osw6rvz5y19lwvuj]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T17:59:48.043Z"}
{"level":"debug","message":"Executing query [m8osw6rzq6uxnrulgn]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[4,888,9,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T17:59:48.047Z\",\"ACTIVO\"]","timestamp":"2025-03-25T17:59:48.047Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 9, Área ID: 888, Rol ID: 888, Documento ID: 8","timestamp":"2025-03-25T17:59:48.050Z"}
{"level":"debug","message":"Executing query [m8osw6s4r5lkooiywd8]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[8,9,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T17:59:48.052Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8osw6s4r5lkooiywd8]","params":"[8,9,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T17:59:48.055Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T17:59:48.056Z"}
{"level":"debug","message":"Executing query [m8osw6s9lls1a0ni5r]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[8]","timestamp":"2025-03-25T17:59:48.057Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8osw6s9lls1a0ni5r]","params":"[8]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T17:59:48.059Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T17:59:48.059Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T17:59:48.060Z"}
{"level":"debug","message":"Executing query [m8osw6scb9h5wj5aen]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[8,9,\"RESTAURAR\"]","timestamp":"2025-03-25T17:59:48.060Z"}
{"level":"debug","message":"Executing query [m8osw6sii8n335dolpr]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[8]","timestamp":"2025-03-25T17:59:48.066Z"}
{"level":"debug","message":"Executing query [m8osw6sk444uhqjxhkg]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[8,9,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T17:59:48.068Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8osw6sk444uhqjxhkg]","params":"[8,9,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T17:59:48.072Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T17:59:48.072Z"}
{"level":"debug","message":"Executing query [m8osw6sp3r23q1xcalc]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[8]","timestamp":"2025-03-25T17:59:48.073Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8osw6sp3r23q1xcalc]","params":"[8]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T17:59:48.074Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T17:59:48.075Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T17:59:48.075Z"}
{"level":"debug","message":"Executing query [m8osw6ss0dth04as8wv]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[4,888,9,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T17:59:48.076Z\",\"ACTIVO\"]","timestamp":"2025-03-25T17:59:48.076Z"}
{"level":"debug","message":"Executing query [m8osw6sv7m5fkj1bz6t]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T17:59:48.079Z"}
{"level":"debug","message":"Executing query [m8osw6sxbo15ni5v0x9]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[9,\"DOCUMENTO\",9,\"ELIMINAR\"]","timestamp":"2025-03-25T17:59:48.082Z"}
{"level":"debug","message":"Executing query [m8osw6szwvttqupyup]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[9]","timestamp":"2025-03-25T17:59:48.083Z"}
{"level":"debug","message":"Executing query [m8osw6t3x05pmn7itk]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T17:59:48.087Z"}
{"level":"debug","message":"Executing query [m8osw6t6n8ss3pyjjro]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[4]","timestamp":"2025-03-25T17:59:48.090Z"}
{"level":"debug","message":"Executing query [m8osw6tbs5i5dgjoyer]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:59:48.095Z"}
{"level":"debug","message":"Executing query [m8osw6tfzen9wkkg4er]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:59:48.099Z"}
{"level":"debug","message":"Executing query [m8osw6tgphczfqypbsf]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T17:59:48.100Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T17:59:48.103Z"}
{"level":"debug","message":"Executing query [m8osw6tj0xb0jgy8bpd]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:48.103Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:48.104Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:48.198Z"}
{"level":"debug","message":"Executing query [m8osw6w8coho051rzk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:48.200Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:48.211Z"}
{"level":"debug","message":"Executing query [m8osw6wk3de7gv2kr7j]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:59:48.212Z"}
{"level":"debug","message":"Executing query [m8osw6wmat91s3tene]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:59:48.214Z"}
{"level":"debug","message":"Executing query [m8osw6woyl6vo1jn73j]: INSERT INTO AreaEspecializada (IDArea, NombreArea, CodigoIdentificacion, TipoArea, IsActive, Descripcion) VALUES (?, ?, ?, ?, ?, ?)","params":"[999,\"Área de Prueba\",\"TEST-AREA\",\"PRUEBA\",1,\"Área creada para pruebas\"]","timestamp":"2025-03-25T17:59:48.216Z"}
{"level":"debug","message":"Executing query [m8osw6wrtkq2f5xgtsi]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[999,\"Rol de Prueba\",\"Rol creado para pruebas\",1,255]","timestamp":"2025-03-25T17:59:48.219Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T17:59:48.222Z"}
{"level":"debug","message":"Executing query [m8osw6wuml7oehj12ap]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T17:59:48.222Z"}
{"level":"debug","message":"Executing query [m8osw6wwybl16zds16f]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T17:59:48.224Z"}
{"level":"debug","message":"Executing query [m8osw6wxl7jkg0wwnai]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T17:59:48.225Z"}
{"level":"debug","message":"Executing query [m8osw6x2pw726sdbu1]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T17:59:48.230Z"}
{"level":"debug","message":"Executing query [m8osw6x5kvrs8ck0459]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T17:59:48.233Z"}
{"level":"debug","message":"Executing query [m8osw6x8clxx15uqxbl]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",12]","timestamp":"2025-03-25T17:59:48.236Z"}
{"level":"debug","message":"Executing query [m8osw6xba57ec3ck2q8]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T17:59:48.239Z"}
{"level":"debug","message":"Executing query [m8osw6xco57j3ctocz]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T17:59:48.240Z"}
{"level":"debug","message":"Executing query [m8osw6xfv7spc2gqkys]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T17:59:48.243Z"}
{"level":"debug","message":"Executing query [m8osw6xhl1qdrzunh1]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:48.245Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:48.246Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:48.396Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:48.739Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T17:59:48.794Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:48.832Z"}
{"level":"debug","message":"Executing query [m8osw7ecrd3q4u80rfk]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T17:59:48.852Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:48.880Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:49.074Z"}
{"level":"debug","message":"Executing query [m8osw7kmgb97yxa33v7]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:49.078Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:49.088Z"}
{"level":"debug","message":"Executing query [m8osw7kyr5vabcg9g3r]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T17:59:49.090Z"}
{"level":"debug","message":"Executing query [m8osw7kzhvwgd7nn3mo]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742925589077\"]","timestamp":"2025-03-25T17:59:49.091Z"}
{"level":"debug","message":"Executing query [m8osw7l1itb0omt8kc]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742925589077\",\"TEST-OFI-QUIMICA-1742925589077\",1070,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T17:59:49.093Z"}
{"level":"debug","message":"Executing query [m8osw7l8e24sqymxm7]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T17:59:49.100Z"}
{"level":"debug","message":"Executing query [m8osw7lau2twg0d00i]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742925589077\"]","timestamp":"2025-03-25T17:59:49.102Z"}
{"level":"debug","message":"Executing query [m8osw7ld5uji2uz6kwu]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",3]","timestamp":"2025-03-25T17:59:49.106Z"}
{"level":"debug","message":"Executing query [m8osw7lhy53aeqe647c]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T17:59:49.109Z"}
{"level":"debug","message":"Executing query [m8osw7lkjyw8hvkj2t]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T17:59:49.112Z"}
{"level":"debug","message":"Executing query [m8osw7lo66d6wo0qiw]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T17:59:49.116Z"}
{"level":"debug","message":"Executing query [m8osw7lraq4nzyy2956]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T17:59:49.119Z"}
{"level":"debug","message":"Executing query [m8osw7lux0eh8by760r]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T17:59:49.123Z"}
{"level":"debug","message":"Executing query [m8osw7lxwhbgoc17n6]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:49.125Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:49.129Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:50.290Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T17:59:50.293Z"}
{"level":"debug","message":"Executing query [m8osw8ieljdp4wz88u]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T17:59:50.294Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T17:59:50.303Z"}
{"level":"debug","message":"Executing query [m8osw8ipmjp79lez7mb]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T17:59:50.305Z"}
{"level":"debug","message":"Executing query [m8osw8iq8jsvbs69khi]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T17:59:50.306Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T17:59:50.307Z"}
{"level":"debug","message":"Executing query [m8osw8ise5r3ihzu84]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:59:50.308Z"}
{"level":"debug","message":"Executing query [m8osw8iuxxtaw4fc08l]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:59:50.310Z"}
{"level":"debug","message":"Executing query [m8osw8ivko9z4wruc1]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:59:50.311Z"}
{"level":"debug","message":"Executing query [m8osw8iw2v8gzspsqen]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T17:59:50.312Z"}
{"level":"debug","message":"Executing query [m8osw8j1kaymootfuz]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[10]","timestamp":"2025-03-25T17:59:50.317Z"}
{"level":"debug","message":"Executing query [m8osw8j3sa55b44y95]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:59:50.319Z"}
{"level":"debug","message":"Executing query [m8osw8j59miucg64gfk]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",10]","timestamp":"2025-03-25T17:59:50.321Z"}
{"level":"debug","message":"Executing query [m8osw8j91ltb0h19dwz]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[10]","timestamp":"2025-03-25T17:59:50.325Z"}
{"level":"debug","message":"Executing query [m8osw8ja1nnd1lgdvjf]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[10]","timestamp":"2025-03-25T17:59:50.326Z"}
{"level":"debug","message":"Executing query [m8osw8jdj5t0tdtwnu]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[10]","timestamp":"2025-03-25T17:59:50.329Z"}
{"level":"debug","message":"Executing query [m8osw8jfz41szrk3hk8]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:59:50.331Z"}
{"level":"debug","message":"Executing query [m8osw8jfbtfkwac2qmu]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T17:59:50.331Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T17:59:50.332Z"}
{"level":"debug","message":"Executing query [m8osw8jg91g83tx28]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T17:59:50.332Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T17:59:50.333Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T18:02:25.854Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T18:02:25.858Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:25.861Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:25.906Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:25.912Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:25.946Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:25.952Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:25.958Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:25.962Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:25.971Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:26.052Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:26.059Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:02:26.063Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T18:17:08.692Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T18:17:08.695Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.699Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.747Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.752Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.784Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.790Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.795Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.799Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.810Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.890Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.899Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T18:17:08.904Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T21:32:40.467Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T21:32:40.470Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.473Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.555Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.560Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.572Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.609Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.617Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.697Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.712Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:32:40.715Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T21:46:19.369Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T21:46:19.373Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.376Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.424Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.432Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.448Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.457Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.463Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.551Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.558Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:46:19.564Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T21:47:44.664Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T21:47:44.667Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.670Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.717Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.723Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.734Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.739Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.743Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.820Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.831Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T21:47:44.836Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:04.885Z"}
{"level":"debug","message":"Executing query [m8p16wizce5tgqbg98d]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:04.908Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:04.947Z"}
{"level":"debug","message":"Executing query [m8p16wk65oymyzx5bii]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742939524906\"]","timestamp":"2025-03-25T21:52:04.950Z"}
{"level":"debug","message":"Executing query [m8p16wk90usaajfizxy]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742939524906\"]","timestamp":"2025-03-25T21:52:04.953Z"}
{"level":"debug","message":"Executing query [m8p16wkahnennp27rd8]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742939524906\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T21:52:04.955Z"}
{"level":"debug","message":"Executing query [m8p16wkimrnovz4coqr]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T21:52:04.962Z"}
{"level":"debug","message":"Executing query [m8p16wkkt33nzr477wj]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742939524906\"]","timestamp":"2025-03-25T21:52:04.964Z"}
{"level":"debug","message":"Executing query [m8p16wknjjuytwn29ha]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",6]","timestamp":"2025-03-25T21:52:04.967Z"}
{"level":"debug","message":"Executing query [m8p16wkr6ki9ld6jtvf]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T21:52:04.971Z"}
{"level":"debug","message":"Executing query [m8p16wktz69vto4xpun]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T21:52:04.973Z"}
{"level":"debug","message":"Executing query [m8p16wkxjwy5gc2spuo]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T21:52:04.977Z"}
{"level":"debug","message":"Executing query [m8p16wkz5kyc02ymked]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T21:52:04.979Z"}
{"level":"debug","message":"Executing query [m8p16wl1pggs8ysoqog]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T21:52:04.981Z"}
{"level":"debug","message":"Executing query [m8p16wl56wgzixythhu]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[6]","timestamp":"2025-03-25T21:52:04.985Z"}
{"level":"debug","message":"Executing query [m8p16wl7cnbhixxc2y6]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T21:52:04.987Z"}
{"level":"debug","message":"Executing query [m8p16wlagf8ruy8dv3u]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:04.990Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:04.992Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T21:52:05.085Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T21:52:05.087Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T21:52:05.088Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T21:52:05.090Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T21:52:05.093Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T21:52:05.098Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T21:52:05.100Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T21:52:05.103Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T21:52:05.104Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T21:52:05.105Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T21:52:05.106Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T21:52:05.109Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:05.284Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:06.279Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T21:52:06.437Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T21:52:06.442Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:06.501Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T21:52:06.512Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:06.555Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:07.122Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:07.309Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:07.323Z"}
{"level":"debug","message":"Executing query [m8p16ye6cav6bqcdcgi]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T21:52:07.326Z"}
{"level":"debug","message":"Executing query [m8p16ye81hwz1gn9dzx]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T21:52:07.328Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8p16ye81hwz1gn9dzx]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T21:52:07.331Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:07.333Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:07.429Z"}
{"level":"debug","message":"Executing query [m8p16yh4ikyz7kudne]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:07.432Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:07.445Z"}
{"level":"debug","message":"Executing query [m8p16yhirus6kv6h54]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T21:52:07.446Z"}
{"level":"debug","message":"Executing query [m8p16yhsvsi2h4ylbj]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T21:52:07.456Z"}
{"level":"debug","message":"Executing query [m8p16yhug6mtbj3ogr5]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T21:52:07.458Z"}
{"level":"debug","message":"Executing query [m8p16yhv79f61y2cwh]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T21:52:07.459Z"}
{"level":"info","message":"Usando Mesa ID: 1, Áreas ID: 1/2, Usuarios ID: 1/2, Documento ID: 1","timestamp":"2025-03-25T21:52:07.466Z"}
{"level":"debug","message":"Executing query [m8p16yi4boayl3wxyp9]: DELETE FROM Derivacion WHERE IDDocumento = ? AND IDAreaOrigen = ? AND IDAreaDestino = ?","params":"[1,1,2]","timestamp":"2025-03-25T21:52:07.468Z"}
{"level":"debug","message":"Executing query [m8p16yi68z3vyy1qmqq]: INSERT INTO Derivacion (\n          IDDocumento, IDMesaPartes, IDAreaOrigen, IDAreaDestino, \n          IDUsuarioDeriva, EstadoDerivacion, Observacion\n        ) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[1,1,1,2,1,\"PENDIENTE\",\"Derivación creada para pruebas automatizadas\"]","timestamp":"2025-03-25T21:52:07.470Z"}
{"level":"debug","message":"Executing query [m8p16yibw9a9e2kq1db]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[5]","timestamp":"2025-03-25T21:52:07.475Z"}
{"level":"debug","message":"Executing query [m8p16yifzv4jpeaaprq]: UPDATE Derivacion SET EstadoDerivacion = ?, Observacion = ?, FechaRecepcion = ?, IDUsuarioRecibe = ? WHERE IDDerivacion = ?","params":"[\"RECIBIDO\",\"Derivación actualizada en pruebas\",\"2025-03-25 21:52:07\",2,5]","timestamp":"2025-03-25T21:52:07.479Z"}
{"level":"debug","message":"Executing query [m8p16yii3wkkh82w8re]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[5]","timestamp":"2025-03-25T21:52:07.482Z"}
{"level":"debug","message":"Executing query [m8p16yikz4am2twl3cd]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T21:52:07.484Z"}
{"level":"debug","message":"Executing query [m8p16yimxclxz68m5bm]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[2]","timestamp":"2025-03-25T21:52:07.486Z"}
{"level":"debug","message":"Executing query [m8p16yinwzncm96f7ic]: DELETE FROM Derivacion WHERE IDDerivacion = ?","params":"[5]","timestamp":"2025-03-25T21:52:07.488Z"}
{"level":"debug","message":"Executing query [m8p16yir38mq3grn1u]: SELECT * FROM Derivacion WHERE IDDerivacion = ?","params":"[5]","timestamp":"2025-03-25T21:52:07.491Z"}
{"level":"debug","message":"Executing query [m8p16yitga8e0w0v16p]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[1]","timestamp":"2025-03-25T21:52:07.493Z"}
{"level":"debug","message":"Executing query [m8p16yiwkr1udngd4d]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:07.496Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:09.419Z"}
{"duration":"5ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T21:52:09.478Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T21:52:09.482Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:09.488Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T21:52:09.490Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T21:52:09.580Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T21:52:09.674Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:09.794Z"}
{"level":"debug","message":"Executing query [m8p170aslk321p8lsr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:09.796Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:09.805Z"}
{"level":"debug","message":"Executing query [m8p170b2macs1schqi9]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T21:52:09.806Z"}
{"level":"debug","message":"Executing query [m8p170b3k9qployvg9]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742939529795\"]","timestamp":"2025-03-25T21:52:09.807Z"}
{"level":"debug","message":"Executing query [m8p170b6y098bvpytpg]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742939529795\",\"TEST-OFICIO-1742939529795\",949,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T21:52:09.810Z"}
{"level":"debug","message":"Executing query [m8p170bcd8titxfrm5v]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T21:52:09.816Z"}
{"level":"debug","message":"Executing query [m8p170bfnf11vxsggh]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742939529795\"]","timestamp":"2025-03-25T21:52:09.819Z"}
{"level":"debug","message":"Executing query [m8p170bhhj5ih6zqak]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",3]","timestamp":"2025-03-25T21:52:09.821Z"}
{"level":"debug","message":"Executing query [m8p170bk1wdqq2bgvgc]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T21:52:09.824Z"}
{"level":"debug","message":"Executing query [m8p170bmur6u57xwjz]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T21:52:09.826Z"}
{"level":"debug","message":"Executing query [m8p170bpr0aa1a0jil]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T21:52:09.829Z"}
{"level":"debug","message":"Executing query [m8p170brl7mxqmshmle]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T21:52:09.831Z"}
{"level":"debug","message":"Executing query [m8p170buv3xt5mdo2no]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[3]","timestamp":"2025-03-25T21:52:09.834Z"}
{"level":"debug","message":"Executing query [m8p170bwxlh82y5s9yq]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742939529836\",\"TEST-SP-OFICIO-1742939529836\",9391,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T21:52:09.836Z"}
{"level":"debug","message":"Executing query [m8p170c7r2zmjke8dc]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742939529836\"]","timestamp":"2025-03-25T21:52:09.847Z"}
{"level":"debug","message":"Executing query [m8p170c9d64wy6ccve8]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742939529836\"]","timestamp":"2025-03-25T21:52:09.849Z"}
{"level":"debug","message":"Executing query [m8p170ccidbqpcajss7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:09.853Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:09.854Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:10.026Z"}
{"level":"debug","message":"Executing query [m8p170h9rnvgs2re9l]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:10.029Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:10.037Z"}
{"level":"debug","message":"Executing query [m8p170hi3xa47blc83m]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T21:52:10.038Z"}
{"level":"debug","message":"Executing query [m8p170hkvvmiyrbef5e]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742939530028\"]","timestamp":"2025-03-25T21:52:10.040Z"}
{"level":"debug","message":"Executing query [m8p170hmpxsk03uc8gf]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742939530028\",\"TEST-OFI-FORENSE-1742939530028\",6819,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742939530028\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T21:52:10.042Z"}
{"level":"debug","message":"Executing query [m8p170hti501vq4cpkf]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T21:52:10.049Z"}
{"level":"debug","message":"Executing query [m8p170hvhyon4s18e9d]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742939530028\"]","timestamp":"2025-03-25T21:52:10.051Z"}
{"level":"debug","message":"Executing query [m8p170hycw4kr8m2clb]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",3]","timestamp":"2025-03-25T21:52:10.054Z"}
{"level":"debug","message":"Executing query [m8p170i1391fpxp4evt]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T21:52:10.058Z"}
{"level":"debug","message":"Executing query [m8p170i4tg7kv2p34k]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T21:52:10.060Z"}
{"level":"debug","message":"Executing query [m8p170i7xz1tt7zsqpf]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T21:52:10.063Z"}
{"level":"debug","message":"Executing query [m8p170i8x844r6ccgp9]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T21:52:10.064Z"}
{"level":"debug","message":"Executing query [m8p170ich5n13p1klyc]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[3]","timestamp":"2025-03-25T21:52:10.068Z"}
{"level":"debug","message":"Executing query [m8p170ietir82ar4kz]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742939530070\",\"TEST-SP-OFI-FORENSE-1742939530070\",6575,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T21:52:10.070Z"}
{"level":"debug","message":"Executing query [m8p170ih6io63efapee]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742939530070\"]","timestamp":"2025-03-25T21:52:10.073Z"}
{"level":"debug","message":"Executing query [m8p170ijym2z8pno1p8]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742939530070\"]","timestamp":"2025-03-25T21:52:10.075Z"}
{"level":"debug","message":"Executing query [m8p170in7t2wung9mwm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:10.079Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:10.080Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:10.795Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:10.840Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T21:52:10.841Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T21:52:10.930Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T21:52:10.931Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T21:52:10.932Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T21:52:10.932Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T21:52:10.933Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T21:52:10.933Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:11.286Z"}
{"level":"debug","message":"Executing query [m8p171g9woypnxvadho]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:11.289Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:11.302Z"}
{"level":"debug","message":"Executing query [m8p171gpb1bt002nrkk]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742939531288\"]","timestamp":"2025-03-25T21:52:11.305Z"}
{"level":"debug","message":"Executing query [m8p171gr8hdoawny6hw]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742939531288\",true]","timestamp":"2025-03-25T21:52:11.307Z"}
{"level":"debug","message":"Executing query [m8p171gwmnyfve096ck]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T21:52:11.312Z"}
{"level":"debug","message":"Executing query [m8p171gzt8dpyk3auy]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742939531288\"]","timestamp":"2025-03-25T21:52:11.315Z"}
{"level":"debug","message":"Executing query [m8p171h1ak6d57nhov]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",3]","timestamp":"2025-03-25T21:52:11.317Z"}
{"level":"debug","message":"Executing query [m8p171h4ft23edu1ocd]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T21:52:11.320Z"}
{"level":"debug","message":"Executing query [m8p171h5ebrpe02a9er]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T21:52:11.321Z"}
{"level":"debug","message":"Executing query [m8p171h962sfgkcm05]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T21:52:11.325Z"}
{"level":"debug","message":"Executing query [m8p171hariwqcmevtk]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T21:52:11.326Z"}
{"level":"debug","message":"Executing query [m8p171hcmmlue1zbdb]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T21:52:11.328Z"}
{"level":"debug","message":"Executing query [m8p171hfpy4gluxbmp]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[3]","timestamp":"2025-03-25T21:52:11.331Z"}
{"level":"debug","message":"Executing query [m8p171hhk8g54195y9l]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T21:52:11.333Z"}
{"level":"debug","message":"Executing query [m8p171hipbi29qs84ws]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:11.334Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:11.335Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:11.497Z"}
{"level":"debug","message":"Executing query [m8p171m4uc9rlz4fu9q]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:11.500Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:11.508Z"}
{"level":"debug","message":"Executing query [m8p171mdtggjuk2ky8b]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T21:52:11.509Z"}
{"level":"debug","message":"Executing query [m8p171mfawe7u0bw50o]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T21:52:11.511Z"}
{"level":"debug","message":"Executing query [m8p171mgibobw2lviy]: INSERT INTO AreaEspecializada (IDArea, NombreArea, CodigoIdentificacion, TipoArea, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Área Papelera\",\"TEST-PAPELERA\",\"PRUEBA\",1]","timestamp":"2025-03-25T21:52:11.512Z"}
{"level":"debug","message":"Executing query [m8p171mll8lrpp1zwy]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T21:52:11.517Z"}
{"level":"debug","message":"Executing query [m8p171mm64w8ql5tsqu]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[888,\"Rol Papelera\",\"Rol para pruebas de papelera\",2,4]","timestamp":"2025-03-25T21:52:11.518Z"}
{"level":"debug","message":"Executing query [m8p171mpy807iqc4jb]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T21:52:11.521Z"}
{"level":"debug","message":"Executing query [m8p171msue9kbil1mrn]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T21:52:11.524Z"}
{"level":"debug","message":"Executing query [m8p171n9np813061bu]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[4,888,9,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T21:52:11.541Z\",\"ACTIVO\"]","timestamp":"2025-03-25T21:52:11.541Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 9, Área ID: 888, Rol ID: 888, Documento ID: 8","timestamp":"2025-03-25T21:52:11.545Z"}
{"level":"debug","message":"Executing query [m8p171neumzu7myqqt]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[8,9,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T21:52:11.546Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p171neumzu7myqqt]","params":"[8,9,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T21:52:11.550Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T21:52:11.551Z"}
{"level":"debug","message":"Executing query [m8p171nja6orn52vicf]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[8]","timestamp":"2025-03-25T21:52:11.551Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p171nja6orn52vicf]","params":"[8]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T21:52:11.554Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T21:52:11.554Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T21:52:11.555Z"}
{"level":"debug","message":"Executing query [m8p171nnu8kincpv5s]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[8,9,\"RESTAURAR\"]","timestamp":"2025-03-25T21:52:11.555Z"}
{"level":"debug","message":"Executing query [m8p171ns7wbzqy1s21n]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[8]","timestamp":"2025-03-25T21:52:11.560Z"}
{"level":"debug","message":"Executing query [m8p171nu28fcc4kxwo1]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[8,9,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T21:52:11.562Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p171nu28fcc4kxwo1]","params":"[8,9,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T21:52:11.566Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T21:52:11.567Z"}
{"level":"debug","message":"Executing query [m8p171nzz8cucq28lw]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[8]","timestamp":"2025-03-25T21:52:11.567Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8p171nzz8cucq28lw]","params":"[8]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T21:52:11.569Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T21:52:11.570Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T21:52:11.570Z"}
{"level":"debug","message":"Executing query [m8p171o36dbnz7xu0v]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[4,888,9,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T21:52:11.571Z\",\"ACTIVO\"]","timestamp":"2025-03-25T21:52:11.571Z"}
{"level":"debug","message":"Executing query [m8p171o7c267xzsguqv]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T21:52:11.575Z"}
{"level":"debug","message":"Executing query [m8p171oace2xh3ybxlu]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[9,\"DOCUMENTO\",9,\"ELIMINAR\"]","timestamp":"2025-03-25T21:52:11.578Z"}
{"level":"debug","message":"Executing query [m8p171oe108rsbw7v8yk]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[9]","timestamp":"2025-03-25T21:52:11.582Z"}
{"level":"debug","message":"Executing query [m8p171ohiuqnaxb81a]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T21:52:11.585Z"}
{"level":"debug","message":"Executing query [m8p171olyntagha09ph]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[4]","timestamp":"2025-03-25T21:52:11.589Z"}
{"level":"debug","message":"Executing query [m8p171ooo6p0w36jr8]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T21:52:11.592Z"}
{"level":"debug","message":"Executing query [m8p171oqlw0dm1csmei]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T21:52:11.594Z"}
{"level":"debug","message":"Executing query [m8p171ot8liqg136r98]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T21:52:11.597Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T21:52:11.600Z"}
{"level":"debug","message":"Executing query [m8p171oxj215f1zljj]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:11.601Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:11.602Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:11.698Z"}
{"level":"debug","message":"Executing query [m8p171rpcw0rjv20zaj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:11.701Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:11.715Z"}
{"level":"debug","message":"Executing query [m8p171s4w3jag813jp]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T21:52:11.716Z"}
{"level":"debug","message":"Executing query [m8p171s6bo9qpfq8tx]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T21:52:11.718Z"}
{"level":"debug","message":"Executing query [m8p171s83xu8v5tnpof]: INSERT INTO AreaEspecializada (IDArea, NombreArea, CodigoIdentificacion, TipoArea, IsActive, Descripcion) VALUES (?, ?, ?, ?, ?, ?)","params":"[999,\"Área de Prueba\",\"TEST-AREA\",\"PRUEBA\",1,\"Área creada para pruebas\"]","timestamp":"2025-03-25T21:52:11.720Z"}
{"level":"debug","message":"Executing query [m8p171sbt2unppjfrv]: INSERT INTO Rol (IDRol, NombreRol, Descripcion, NivelAcceso, Permisos) VALUES (?, ?, ?, ?, ?)","params":"[999,\"Rol de Prueba\",\"Rol creado para pruebas\",1,255]","timestamp":"2025-03-25T21:52:11.723Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T21:52:11.726Z"}
{"level":"debug","message":"Executing query [m8p171sfexl0qv260i]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T21:52:11.727Z"}
{"level":"debug","message":"Executing query [m8p171sgsnpl61heos]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T21:52:11.728Z"}
{"level":"debug","message":"Executing query [m8p171sih5lkbwphwlj]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T21:52:11.730Z"}
{"level":"debug","message":"Executing query [m8p171sm63tlfu9pyaw]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T21:52:11.734Z"}
{"level":"debug","message":"Executing query [m8p171sp8r8m2umow2r]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T21:52:11.737Z"}
{"level":"debug","message":"Executing query [m8p171st4neoy22m36e]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",12]","timestamp":"2025-03-25T21:52:11.742Z"}
{"level":"debug","message":"Executing query [m8p171swcvpjvdgq12c]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T21:52:11.744Z"}
{"level":"debug","message":"Executing query [m8p171sztjnwx4b8aw9]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T21:52:11.747Z"}
{"level":"debug","message":"Executing query [m8p171t2aovz5mo0l49]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T21:52:11.750Z"}
{"level":"debug","message":"Executing query [m8p171t4hpf8imzmnre]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:11.752Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:11.754Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:11.925Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:12.285Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T21:52:12.339Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:12.378Z"}
{"level":"debug","message":"Executing query [m8p172b6k0b5zg00z4]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T21:52:12.402Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:12.432Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:12.609Z"}
{"level":"debug","message":"Executing query [m8p172h0k36qn2a4nct]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:12.612Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:12.621Z"}
{"level":"debug","message":"Executing query [m8p172hbnx9qrx21gfo]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T21:52:12.623Z"}
{"level":"debug","message":"Executing query [m8p172hd77ot0hby3wk]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742939532611\"]","timestamp":"2025-03-25T21:52:12.625Z"}
{"level":"debug","message":"Executing query [m8p172hfl10b5fqyjjj]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742939532611\",\"TEST-OFI-QUIMICA-1742939532611\",484,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T21:52:12.627Z"}
{"level":"debug","message":"Executing query [m8p172hmx8l6y1z275]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T21:52:12.634Z"}
{"level":"debug","message":"Executing query [m8p172hpu4rrkt9ytnd]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742939532611\"]","timestamp":"2025-03-25T21:52:12.637Z"}
{"level":"debug","message":"Executing query [m8p172hrtn39ku037zr]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",3]","timestamp":"2025-03-25T21:52:12.639Z"}
{"level":"debug","message":"Executing query [m8p172hwbckboce4r1n]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T21:52:12.644Z"}
{"level":"debug","message":"Executing query [m8p172hyfbxnrky1vl]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T21:52:12.646Z"}
{"level":"debug","message":"Executing query [m8p172i1j8rd62wt5ea]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T21:52:12.649Z"}
{"level":"debug","message":"Executing query [m8p172i3gmid6am43ji]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T21:52:12.651Z"}
{"level":"debug","message":"Executing query [m8p172i65snu6c63zql]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[3]","timestamp":"2025-03-25T21:52:12.654Z"}
{"level":"debug","message":"Executing query [m8p172i75hz62ynjcbt]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:12.655Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:12.657Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:13.866Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T21:52:13.869Z"}
{"level":"debug","message":"Executing query [m8p173fzbaclcikjtf]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T21:52:13.871Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T21:52:13.879Z"}
{"level":"debug","message":"Executing query [m8p173g85a9n3bjlgxh]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T21:52:13.880Z"}
{"level":"debug","message":"Executing query [m8p173gacu61lm2aww]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T21:52:13.882Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T21:52:13.884Z"}
{"level":"debug","message":"Executing query [m8p173gcvbduge8tqia]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T21:52:13.884Z"}
{"level":"debug","message":"Executing query [m8p173geqv339grc9pa]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T21:52:13.886Z"}
{"level":"debug","message":"Executing query [m8p173gfjdsfre5h6hp]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T21:52:13.887Z"}
{"level":"debug","message":"Executing query [m8p173gg1edxi1s24kf]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T21:52:13.889Z"}
{"level":"debug","message":"Executing query [m8p173gmi35qthg4989]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[10]","timestamp":"2025-03-25T21:52:13.894Z"}
{"level":"debug","message":"Executing query [m8p173go6m99eb3q1wi]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T21:52:13.896Z"}
{"level":"debug","message":"Executing query [m8p173gqe4c97ql0n85]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",10]","timestamp":"2025-03-25T21:52:13.898Z"}
{"level":"debug","message":"Executing query [m8p173gt60vqwcpms1]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[10]","timestamp":"2025-03-25T21:52:13.901Z"}
{"level":"debug","message":"Executing query [m8p173gu49i9ul4rj9y]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[10]","timestamp":"2025-03-25T21:52:13.902Z"}
{"level":"debug","message":"Executing query [m8p173gxqj2jcykucqa]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[10]","timestamp":"2025-03-25T21:52:13.905Z"}
{"level":"debug","message":"Executing query [m8p173gz27m7wwqdndp]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T21:52:13.907Z"}
{"level":"debug","message":"Executing query [m8p173h1v4xzlof0wkj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T21:52:13.909Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T21:52:13.909Z"}
{"level":"debug","message":"Executing query [m8p173h1hw42nk25kw7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T21:52:13.909Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T21:52:13.910Z"}
