{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:05:59.459Z"}
{"level":"debug","message":"Executing query [m8o5jdtncn5uei4smml]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:05:59.483Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:05:59.522Z"}
{"level":"debug","message":"Executing query [m8o5jdutx4b7zwlg7l]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886359482\"]","timestamp":"2025-03-25T07:05:59.525Z"}
{"level":"debug","message":"Executing query [m8o5jduwy13p7xjrnqe]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886359482\"]","timestamp":"2025-03-25T07:05:59.529Z"}
{"level":"debug","message":"Executing query [m8o5jduyiaecx3kgtng]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742886359482\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:05:59.530Z"}
{"level":"debug","message":"Executing query [m8o5jdv5yi1imszg9x]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.537Z"}
{"level":"debug","message":"Executing query [m8o5jdv89cbm1xr7vbg]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886359482\"]","timestamp":"2025-03-25T07:05:59.540Z"}
{"level":"debug","message":"Executing query [m8o5jdvbvqj8jj6m6o]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1003]","timestamp":"2025-03-25T07:05:59.543Z"}
{"level":"debug","message":"Executing query [m8o5jdvg1ysn7xdex9i]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.548Z"}
{"level":"debug","message":"Executing query [m8o5jdvitjlmy02x0y]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.550Z"}
{"level":"debug","message":"Executing query [m8o5jdvlspuzu7yky4k]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.553Z"}
{"level":"debug","message":"Executing query [m8o5jdvoybjd7c8dee]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.556Z"}
{"level":"debug","message":"Executing query [m8o5jdvpoj8yl5bkpx]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.557Z"}
{"level":"debug","message":"Executing query [m8o5jdvs7rqg6j7m496]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1003]","timestamp":"2025-03-25T07:05:59.560Z"}
{"level":"debug","message":"Executing query [m8o5jdvvqc26u1cowni]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:05:59.563Z"}
{"level":"debug","message":"Executing query [m8o5jdvxqfcwgyqkw8e]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:05:59.565Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:05:59.566Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.679Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.682Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.684Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.686Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.688Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.692Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:05:59.694Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:05:59.697Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:05:59.699Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:05:59.700Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:05:59.701Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:05:59.702Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:05:59.921Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:00.964Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:06:01.147Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:06:01.153Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:01.211Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:06:01.228Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:01.278Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:01.760Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:01.902Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:01.925Z"}
{"level":"debug","message":"Executing query [m8o5jfpky1pftxav3pa]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:06:01.928Z"}
{"level":"debug","message":"Executing query [m8o5jfpni3fkbwra7vs]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:06:01.931Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o5jfpni3fkbwra7vs]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:06:01.933Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:01.936Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:02.065Z"}
{"level":"debug","message":"Executing query [m8o5jfthwc13nh0kz1b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:02.069Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:02.080Z"}
{"level":"debug","message":"Executing query [m8o5jftunvcdu6khig]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:02.082Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:06:02.085Z"}
{"level":"debug","message":"Executing query [m8o5jftx56j2qk2hyf]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:06:02.085Z"}
{"level":"debug","message":"Executing query [m8o5jfty2rmrrcmx4be]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:06:02.086Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:06:02.087Z"}
{"level":"debug","message":"Executing query [m8o5jfu04js47z206la]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:02.088Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:06:02.089Z"}
{"level":"debug","message":"Executing query [m8o5jfu5dqxe43lvnar]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:06:02.093Z"}
{"level":"debug","message":"Executing query [m8o5jfu9ikgl28sgdup]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:06:02.097Z"}
{"level":"debug","message":"Executing query [m8o5jfuby67dn5rp81]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[7]","timestamp":"2025-03-25T07:06:02.099Z"}
{"level":"debug","message":"Executing query [m8o5jfuhq7h99r8lpob]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:02.105Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:04.018Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:06:04.083Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:06:04.087Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:04.094Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:06:04.095Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:06:04.189Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:06:04.289Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:04.436Z"}
{"level":"debug","message":"Executing query [m8o5jhncow9w3m24y69]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:04.440Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:04.450Z"}
{"level":"debug","message":"Executing query [m8o5jhnnhanw6mcy2ym]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:04.451Z"}
{"level":"debug","message":"Executing query [m8o5jhnphxjjy6wnt5i]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886364439\"]","timestamp":"2025-03-25T07:06:04.453Z"}
{"level":"debug","message":"Executing query [m8o5jhnqjglwt7ijwyb]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742886364439\",\"TEST-OFICIO-1742886364439\",8596,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:04.454Z"}
{"level":"debug","message":"Executing query [m8o5jhnvhso2lbvrkdv]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.459Z"}
{"level":"debug","message":"Executing query [m8o5jhnxb5xyvn0acmv]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886364439\"]","timestamp":"2025-03-25T07:06:04.461Z"}
{"level":"debug","message":"Executing query [m8o5jhnyyqrjmu5py9a]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",9]","timestamp":"2025-03-25T07:06:04.462Z"}
{"level":"debug","message":"Executing query [m8o5jho0fpo2meul0uk]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.464Z"}
{"level":"debug","message":"Executing query [m8o5jho2oq0zmdqvybi]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.466Z"}
{"level":"debug","message":"Executing query [m8o5jho5trfv65dsa4n]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.469Z"}
{"level":"debug","message":"Executing query [m8o5jho7l4ml0ho0qzb]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.471Z"}
{"level":"debug","message":"Executing query [m8o5jhoaond09j2k7d]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.474Z"}
{"level":"debug","message":"Executing query [m8o5jhob8hjjatayi9t]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742886364475\",\"TEST-SP-OFICIO-1742886364475\",9589,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:06:04.476Z"}
{"level":"debug","message":"Executing query [m8o5jhog5nagqc3thtt]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886364475\"]","timestamp":"2025-03-25T07:06:04.480Z"}
{"level":"debug","message":"Executing query [m8o5jhoio9iysxbs9ac]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886364475\"]","timestamp":"2025-03-25T07:06:04.482Z"}
{"level":"debug","message":"Executing query [m8o5jholtdrw1mne9f]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:04.485Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:04.487Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:04.692Z"}
{"level":"debug","message":"Executing query [m8o5jhuf274r10shw2v]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:04.695Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:04.712Z"}
{"level":"debug","message":"Executing query [m8o5jhuw75rfymjs5n5]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:04.713Z"}
{"level":"debug","message":"Executing query [m8o5jhuy98xtkbgtyk7]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886364694\"]","timestamp":"2025-03-25T07:06:04.714Z"}
{"level":"debug","message":"Executing query [m8o5jhv0711dbpdcae]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742886364694\",\"TEST-OFI-FORENSE-1742886364694\",8433,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742886364694\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:04.716Z"}
{"level":"debug","message":"Executing query [m8o5jhv52o10n76jf4l]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.721Z"}
{"level":"debug","message":"Executing query [m8o5jhv7zcarbofii3]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886364694\"]","timestamp":"2025-03-25T07:06:04.723Z"}
{"level":"debug","message":"Executing query [m8o5jhv9vvkhn5emj9r]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",9]","timestamp":"2025-03-25T07:06:04.725Z"}
{"level":"debug","message":"Executing query [m8o5jhvbrjdk3dk7yp]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.727Z"}
{"level":"debug","message":"Executing query [m8o5jhvds8pn515rq1a]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.729Z"}
{"level":"debug","message":"Executing query [m8o5jhvf4vzlhao5cjp]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.731Z"}
{"level":"debug","message":"Executing query [m8o5jhvgdh7pzs12wfk]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.732Z"}
{"level":"debug","message":"Executing query [m8o5jhvjmppd18duygg]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[9]","timestamp":"2025-03-25T07:06:04.735Z"}
{"level":"debug","message":"Executing query [m8o5jhvlapdcxegss0s]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742886364737\",\"TEST-SP-OFI-FORENSE-1742886364737\",9534,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:06:04.737Z"}
{"level":"debug","message":"Executing query [m8o5jhvo9h5nviytf58]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886364737\"]","timestamp":"2025-03-25T07:06:04.740Z"}
{"level":"debug","message":"Executing query [m8o5jhvpqqy8iepcy1r]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886364737\"]","timestamp":"2025-03-25T07:06:04.741Z"}
{"level":"debug","message":"Executing query [m8o5jhvs57t8hz2l5r9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:04.744Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:04.745Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:05.476Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:05.519Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:06:05.520Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:06:05.620Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:06:05.621Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:06:05.622Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:06:05.622Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:06:05.623Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:06:05.623Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:05.956Z"}
{"level":"debug","message":"Executing query [m8o5jitj8gj4m24q5td]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:05.959Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:05.968Z"}
{"level":"debug","message":"Executing query [m8o5jitual79xdv10bo]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886365958\"]","timestamp":"2025-03-25T07:06:05.970Z"}
{"level":"debug","message":"Executing query [m8o5jitw91zsyi9a6kt]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742886365958\",true]","timestamp":"2025-03-25T07:06:05.972Z"}
{"level":"debug","message":"Executing query [m8o5jiu14trimmtss04]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.977Z"}
{"level":"debug","message":"Executing query [m8o5jiu345c7sjqjkq7]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886365958\"]","timestamp":"2025-03-25T07:06:05.979Z"}
{"level":"debug","message":"Executing query [m8o5jiu5vf83pvzkoh]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",9]","timestamp":"2025-03-25T07:06:05.981Z"}
{"level":"debug","message":"Executing query [m8o5jiu8fy9wkog43t8]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.984Z"}
{"level":"debug","message":"Executing query [m8o5jiua1xsucwharav]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.986Z"}
{"level":"debug","message":"Executing query [m8o5jiuelebdyzheufc]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.990Z"}
{"level":"debug","message":"Executing query [m8o5jiughjzps6sj6b5]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.992Z"}
{"level":"debug","message":"Executing query [m8o5jiukk38f95xxo09]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:05.996Z"}
{"level":"debug","message":"Executing query [m8o5jiuonjrwheu5pu]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[9]","timestamp":"2025-03-25T07:06:06.000Z"}
{"level":"debug","message":"Executing query [m8o5jiupgxwwlbzm1ea]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:06:06.001Z"}
{"level":"debug","message":"Executing query [m8o5jiur9knnbdff9p4]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:06.003Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:06.004Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:06.228Z"}
{"level":"debug","message":"Executing query [m8o5jj14udxpn5gmwc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:06.232Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:06.245Z"}
{"level":"debug","message":"Executing query [m8o5jj1ja4s0fd1c8vo]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:06.247Z"}
{"level":"debug","message":"Executing query [m8o5jj1mvoiclqradv]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:06:06.250Z"}
{"level":"debug","message":"Executing query [m8o5jj1o29ax6rxkn87]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:06:06.252Z"}
{"level":"debug","message":"Executing query [m8o5jj1q0z52k5nwx2x9]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:06:06.254Z"}
{"level":"debug","message":"Executing query [m8o5jj1ulwumlg8isu]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:06:06.258Z"}
{"level":"debug","message":"Executing query [m8o5jj1yiv4oboljmt]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[10,888,10,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:06:06.262Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:06:06.262Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 10, Área ID: 888, Rol ID: 888, Documento ID: 9","timestamp":"2025-03-25T07:06:06.265Z"}
{"level":"debug","message":"Executing query [m8o5jj23ko40003yv9k]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[9,10,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:06:06.267Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5jj23ko40003yv9k]","params":"[9,10,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:06:06.272Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:06:06.273Z"}
{"level":"debug","message":"Executing query [m8o5jj29xqb9zq0lkw]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[9]","timestamp":"2025-03-25T07:06:06.273Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5jj29xqb9zq0lkw]","params":"[9]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:06:06.276Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:06:06.276Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:06:06.277Z"}
{"level":"debug","message":"Executing query [m8o5jj2ebv96rh9o1cv]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[9,10,\"RESTAURAR\"]","timestamp":"2025-03-25T07:06:06.278Z"}
{"level":"debug","message":"Executing query [m8o5jj2k4evbcpzul4u]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[9]","timestamp":"2025-03-25T07:06:06.284Z"}
{"level":"debug","message":"Executing query [m8o5jj2o80o1fy2nzz6]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[9,10,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:06:06.288Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5jj2o80o1fy2nzz6]","params":"[9,10,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:06:06.292Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:06:06.292Z"}
{"level":"debug","message":"Executing query [m8o5jj2tvcvoid83adf]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[9]","timestamp":"2025-03-25T07:06:06.293Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5jj2tvcvoid83adf]","params":"[9]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:06:06.296Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:06:06.297Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:06:06.297Z"}
{"level":"debug","message":"Executing query [m8o5jj2ynn7qb22faxj]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[10,888,10,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:06:06.298Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:06:06.298Z"}
{"level":"debug","message":"Executing query [m8o5jj31qbq3h6k8wap]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:06:06.301Z"}
{"level":"debug","message":"Executing query [m8o5jj34p5oadkhknp9]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[10,\"DOCUMENTO\",10,\"ELIMINAR\"]","timestamp":"2025-03-25T07:06:06.304Z"}
{"level":"debug","message":"Executing query [m8o5jj37jwsfusx6bl]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.307Z"}
{"level":"debug","message":"Executing query [m8o5jj3cpbnli22o0x]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:06:06.312Z"}
{"level":"debug","message":"Executing query [m8o5jj3gxsey0xxwmg]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.316Z"}
{"level":"debug","message":"Executing query [m8o5jj3j8r2o8y9754h]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:06.319Z"}
{"level":"debug","message":"Executing query [m8o5jj3liy8p3wwsdk]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:06.321Z"}
{"level":"debug","message":"Executing query [m8o5jj3mwn24a2zzde8]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:06.322Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:06:06.326Z"}
{"level":"debug","message":"Executing query [m8o5jj3qftfmdqocqr]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:06.326Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:06.327Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:06.462Z"}
{"level":"debug","message":"Executing query [m8o5jj7lp8zrriew9h]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:06.465Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:06.484Z"}
{"level":"debug","message":"Executing query [m8o5jj88xfb6ekobfoc]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:06:06.488Z"}
{"level":"debug","message":"Executing query [m8o5jj89f1ua2docbjb]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:06:06.489Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:06:06.491Z"}
{"level":"debug","message":"Executing query [m8o5jj8b77goenh3ier]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:06:06.491Z"}
{"level":"debug","message":"Executing query [m8o5jj8cxhepblkj77r]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:06:06.492Z"}
{"level":"debug","message":"Executing query [m8o5jj8eaqas6f3qx7p]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:06:06.494Z"}
{"level":"debug","message":"Executing query [m8o5jj8ko8p3no3bwt]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.500Z"}
{"level":"debug","message":"Executing query [m8o5jj8nvwvfcbt7wlr]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.504Z"}
{"level":"debug","message":"Executing query [m8o5jj8r9pg509stewr]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",10]","timestamp":"2025-03-25T07:06:06.508Z"}
{"level":"debug","message":"Executing query [m8o5jj8vkzn1kvyq7l]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.511Z"}
{"level":"debug","message":"Executing query [m8o5jj8y0xm33nt45noq]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.514Z"}
{"level":"debug","message":"Executing query [m8o5jj91qfvstyqbzn]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[10]","timestamp":"2025-03-25T07:06:06.517Z"}
{"level":"debug","message":"Executing query [m8o5jj937lbs1ikm9vx]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:06.519Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:06.520Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:07.060Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:06:07.147Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:07.200Z"}
{"level":"debug","message":"Executing query [m8o5jjssbx46m19uce4]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:06:07.228Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:07.265Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:07.499Z"}
{"level":"debug","message":"Executing query [m8o5jk0ewby3bdrr8or]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:07.502Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:07.515Z"}
{"level":"debug","message":"Executing query [m8o5jk0spze9gps2gog]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:07.516Z"}
{"level":"debug","message":"Executing query [m8o5jk0vc2puna7in18]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886367501\"]","timestamp":"2025-03-25T07:06:07.519Z"}
{"level":"debug","message":"Executing query [m8o5jk0wuumiviu3yab]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742886367501\",\"TEST-OFI-QUIMICA-1742886367501\",5221,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:07.520Z"}
{"level":"debug","message":"Executing query [m8o5jk1304h3ga69dioh]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.527Z"}
{"level":"debug","message":"Executing query [m8o5jk15orkgpqmtrd]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886367501\"]","timestamp":"2025-03-25T07:06:07.529Z"}
{"level":"debug","message":"Executing query [m8o5jk17qhk596j1t48]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",5]","timestamp":"2025-03-25T07:06:07.531Z"}
{"level":"debug","message":"Executing query [m8o5jk19vm6m3lz514q]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.533Z"}
{"level":"debug","message":"Executing query [m8o5jk1cqa1w92l63kr]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.536Z"}
{"level":"debug","message":"Executing query [m8o5jk1fk6jkdjfpuzg]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.539Z"}
{"level":"debug","message":"Executing query [m8o5jk1h014khlp67iifp]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.541Z"}
{"level":"debug","message":"Executing query [m8o5jk1lr3mq63zah4o]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[5]","timestamp":"2025-03-25T07:06:07.545Z"}
{"level":"debug","message":"Executing query [m8o5jk1nwbg69xri16p]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:07.547Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:07.549Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:08.110Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:08.114Z"}
{"level":"debug","message":"Executing query [m8o5jkhfiay2lt6ciwo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:08.115Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:08.127Z"}
{"level":"debug","message":"Executing query [m8o5jkhsikp720kfxd8]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:06:08.128Z"}
{"level":"debug","message":"Executing query [m8o5jkht4yq9a6v3bu4]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:06:08.129Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:06:08.130Z"}
{"level":"debug","message":"Executing query [m8o5jkhuz01qitxmyb]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.131Z"}
{"level":"debug","message":"Executing query [m8o5jkhvcmucrbs9vkr]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.131Z"}
{"level":"debug","message":"Executing query [m8o5jkhxfruqm0gvfrm]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.133Z"}
{"level":"debug","message":"Executing query [m8o5jkhyzc5b3jwb3w]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:06:08.134Z"}
{"level":"debug","message":"Executing query [m8o5jki4tu5llj6lpl]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[11]","timestamp":"2025-03-25T07:06:08.140Z"}
{"level":"debug","message":"Executing query [m8o5jki68qriwwciwsv]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.142Z"}
{"level":"debug","message":"Executing query [m8o5jki895ltbt6e3mi]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",11]","timestamp":"2025-03-25T07:06:08.145Z"}
{"level":"debug","message":"Executing query [m8o5jkidfp2bs851vmr]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[11]","timestamp":"2025-03-25T07:06:08.149Z"}
{"level":"debug","message":"Executing query [m8o5jkigtn1k4hgefhh]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[11]","timestamp":"2025-03-25T07:06:08.152Z"}
{"level":"debug","message":"Executing query [m8o5jkijk62g5ivx2wm]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[11]","timestamp":"2025-03-25T07:06:08.155Z"}
{"level":"debug","message":"Executing query [m8o5jkilf06p1qjama]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.157Z"}
{"level":"debug","message":"Executing query [m8o5jkimb50gpe9npsc]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:08.158Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:06:08.159Z"}
{"level":"debug","message":"Executing query [m8o5jkinoyb2sqjs1zr]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:08.159Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:08.160Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:25.887Z"}
{"level":"debug","message":"Executing query [m8o5jy7onbef46ht2kl]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:25.908Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:25.940Z"}
{"level":"debug","message":"Executing query [m8o5jy8nfmrohf7yum4]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886385907\"]","timestamp":"2025-03-25T07:06:25.943Z"}
{"level":"debug","message":"Executing query [m8o5jy8r6dgekzhi07q]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886385907\"]","timestamp":"2025-03-25T07:06:25.947Z"}
{"level":"debug","message":"Executing query [m8o5jy8t95qweixxrxu]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742886385907\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:25.949Z"}
{"level":"debug","message":"Executing query [m8o5jy8z5s1ajnwlnza]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.955Z"}
{"level":"debug","message":"Executing query [m8o5jy924ukaf7pp27r]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886385907\"]","timestamp":"2025-03-25T07:06:25.958Z"}
{"level":"debug","message":"Executing query [m8o5jy94fs7cgff26ln]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1004]","timestamp":"2025-03-25T07:06:25.960Z"}
{"level":"debug","message":"Executing query [m8o5jy97rfebmctd8kd]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.963Z"}
{"level":"debug","message":"Executing query [m8o5jy99tx50kdzicg]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.965Z"}
{"level":"debug","message":"Executing query [m8o5jy9dahz1kffui1m]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.969Z"}
{"level":"debug","message":"Executing query [m8o5jy9f69cdxjedybu]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.971Z"}
{"level":"debug","message":"Executing query [m8o5jy9ho0xe8z9ykv]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.973Z"}
{"level":"debug","message":"Executing query [m8o5jy9kjfzreqx34cp]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1004]","timestamp":"2025-03-25T07:06:25.976Z"}
{"level":"debug","message":"Executing query [m8o5jy9m15ocjufyuhm]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:06:25.978Z"}
{"level":"debug","message":"Executing query [m8o5jy9nd6d7rqujrq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:25.979Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:25.981Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.084Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.087Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.089Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.091Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.092Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.096Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:06:26.098Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:06:26.101Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:06:26.103Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:06:26.104Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:06:26.106Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:06:26.107Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:26.333Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:27.315Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:06:27.489Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:06:27.495Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:27.554Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:06:27.568Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:27.619Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:28.069Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:28.190Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:28.212Z"}
{"level":"debug","message":"Executing query [m8o5jzzsedz3z7blznq]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:06:28.216Z"}
{"level":"debug","message":"Executing query [m8o5jzzuzk4ibhtib]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:06:28.218Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o5jzzuzk4ibhtib]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:06:28.220Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:28.221Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:28.360Z"}
{"level":"debug","message":"Executing query [m8o5k03vruce3dng2va]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:28.363Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:28.374Z"}
{"level":"debug","message":"Executing query [m8o5k047uqvjrnmiaoo]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:28.375Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:06:28.378Z"}
{"level":"debug","message":"Executing query [m8o5k04b19rhpm2xu2s]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:06:28.379Z"}
{"level":"debug","message":"Executing query [m8o5k04c5qhm0zq1do5]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:06:28.380Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:06:28.382Z"}
{"level":"debug","message":"Executing query [m8o5k04egwzsnjwvk]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:28.382Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:06:28.385Z"}
{"level":"debug","message":"Executing query [m8o5k04lcpia5s92pgv]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:06:28.389Z"}
{"level":"debug","message":"Executing query [m8o5k04okuqapfocfk]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:06:28.392Z"}
{"level":"debug","message":"Executing query [m8o5k04r0q1uu7fit0zb]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[9]","timestamp":"2025-03-25T07:06:28.395Z"}
{"level":"debug","message":"Executing query [m8o5k04vakfh97kpp9o]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:28.399Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:30.287Z"}
{"duration":"7ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:06:30.348Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:06:30.352Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:30.359Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:06:30.360Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:06:30.455Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:06:30.559Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:30.700Z"}
{"level":"debug","message":"Executing query [m8o5k1ww6yhvzosbusd]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:30.704Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:30.719Z"}
{"level":"debug","message":"Executing query [m8o5k1xc25tkfkpm5vxh]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:30.720Z"}
{"level":"debug","message":"Executing query [m8o5k1xeb1cg3kr0jeo]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886390703\"]","timestamp":"2025-03-25T07:06:30.722Z"}
{"level":"debug","message":"Executing query [m8o5k1xhe6kg53aeuzf]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742886390703\",\"TEST-OFICIO-1742886390703\",3555,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:30.726Z"}
{"level":"debug","message":"Executing query [m8o5k1xnm6shk4tfv1f]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.731Z"}
{"level":"debug","message":"Executing query [m8o5k1xq9yaiobr1bj4]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886390703\"]","timestamp":"2025-03-25T07:06:30.734Z"}
{"level":"debug","message":"Executing query [m8o5k1xsmb9vf8g20f]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",11]","timestamp":"2025-03-25T07:06:30.736Z"}
{"level":"debug","message":"Executing query [m8o5k1xx6l7kbv2hr7o]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.741Z"}
{"level":"debug","message":"Executing query [m8o5k1xzd1kqz7j6l6a]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.743Z"}
{"level":"debug","message":"Executing query [m8o5k1y3q76f0yxnesd]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.747Z"}
{"level":"debug","message":"Executing query [m8o5k1y4rshdv0v76h]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.749Z"}
{"level":"debug","message":"Executing query [m8o5k1y8mu1edccpa3]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.752Z"}
{"level":"debug","message":"Executing query [m8o5k1ybtbuda8rzs7]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742886390754\",\"TEST-SP-OFICIO-1742886390754\",8172,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:06:30.755Z"}
{"level":"debug","message":"Executing query [m8o5k1yf8kjvgth2ojn]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886390754\"]","timestamp":"2025-03-25T07:06:30.759Z"}
{"level":"debug","message":"Executing query [m8o5k1yhvy5cm7g6bv]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886390754\"]","timestamp":"2025-03-25T07:06:30.761Z"}
{"level":"debug","message":"Executing query [m8o5k1ykt8wrhbphkpc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:30.764Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:30.766Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:30.956Z"}
{"level":"debug","message":"Executing query [m8o5k24091uobektycr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:30.960Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:30.974Z"}
{"level":"debug","message":"Executing query [m8o5k24fc4cj68btuh]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:30.975Z"}
{"level":"debug","message":"Executing query [m8o5k24hp0zcx75286m]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886390958\"]","timestamp":"2025-03-25T07:06:30.977Z"}
{"level":"debug","message":"Executing query [m8o5k24jrjsx6bandpa]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742886390958\",\"TEST-OFI-FORENSE-1742886390958\",8388,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742886390958\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:30.979Z"}
{"level":"debug","message":"Executing query [m8o5k24nhyj69ke6034]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.983Z"}
{"level":"debug","message":"Executing query [m8o5k24qnzhhlkzinen]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886390958\"]","timestamp":"2025-03-25T07:06:30.986Z"}
{"level":"debug","message":"Executing query [m8o5k24sutzvbojrhva]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",11]","timestamp":"2025-03-25T07:06:30.988Z"}
{"level":"debug","message":"Executing query [m8o5k24vp6hqsr1vzv]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.991Z"}
{"level":"debug","message":"Executing query [m8o5k24x55g0qaid0e]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.993Z"}
{"level":"debug","message":"Executing query [m8o5k250jp0ilvzhmm]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.996Z"}
{"level":"debug","message":"Executing query [m8o5k252n218ak8im6]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:30.998Z"}
{"level":"debug","message":"Executing query [m8o5k2551sy9dagnwtq]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[11]","timestamp":"2025-03-25T07:06:31.001Z"}
{"level":"debug","message":"Executing query [m8o5k256nbdkhcxvswc]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742886391002\",\"TEST-SP-OFI-FORENSE-1742886391002\",1161,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:06:31.002Z"}
{"level":"debug","message":"Executing query [m8o5k259gepzfnkm7ok]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886391002\"]","timestamp":"2025-03-25T07:06:31.005Z"}
{"level":"debug","message":"Executing query [m8o5k25b5a1rzpi8ctw]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886391002\"]","timestamp":"2025-03-25T07:06:31.007Z"}
{"level":"debug","message":"Executing query [m8o5k25f4d9vjxb13n]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:31.011Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:31.013Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:31.984Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:32.031Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:06:32.033Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:06:32.123Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:06:32.124Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:06:32.124Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:06:32.125Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:06:32.125Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:06:32.125Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:32.443Z"}
{"level":"debug","message":"Executing query [m8o5k3990hlv2bi3mi3]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:32.446Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:32.457Z"}
{"level":"debug","message":"Executing query [m8o5k39mwrg11f8zz0t]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886392445\"]","timestamp":"2025-03-25T07:06:32.458Z"}
{"level":"debug","message":"Executing query [m8o5k39qvmb33t9zlgb]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742886392445\",true]","timestamp":"2025-03-25T07:06:32.462Z"}
{"level":"debug","message":"Executing query [m8o5k39t6f48uztuw98]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.465Z"}
{"level":"debug","message":"Executing query [m8o5k39wi2b5fpleal]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886392445\"]","timestamp":"2025-03-25T07:06:32.468Z"}
{"level":"debug","message":"Executing query [m8o5k39yhp52hm6qc5v]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",11]","timestamp":"2025-03-25T07:06:32.470Z"}
{"level":"debug","message":"Executing query [m8o5k3a1bsukr0ndlt9]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.473Z"}
{"level":"debug","message":"Executing query [m8o5k3a3krwg6d2ghkn]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.475Z"}
{"level":"debug","message":"Executing query [m8o5k3a8hz9vae2o3u5]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.480Z"}
{"level":"debug","message":"Executing query [m8o5k3aat9rd5p294b]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.482Z"}
{"level":"debug","message":"Executing query [m8o5k3abwvuxxow10c]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.483Z"}
{"level":"debug","message":"Executing query [m8o5k3aen5d1vez6nf]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.486Z"}
{"level":"debug","message":"Executing query [m8o5k3afkc1ofcyujj9]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:06:32.487Z"}
{"level":"debug","message":"Executing query [m8o5k3agizf4bb8w9xl]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:32.488Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:32.489Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:32.677Z"}
{"level":"debug","message":"Executing query [m8o5k3fs0ibr76mmv7do]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:32.680Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:32.688Z"}
{"level":"debug","message":"Executing query [m8o5k3g206ytwb563r3]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:32.690Z"}
{"level":"debug","message":"Executing query [m8o5k3g3qp4q28illxk]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:06:32.691Z"}
{"level":"debug","message":"Executing query [m8o5k3g49uc3jd0rg5]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:06:32.692Z"}
{"level":"debug","message":"Executing query [m8o5k3g6a16hhvzjafw]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:06:32.694Z"}
{"level":"debug","message":"Executing query [m8o5k3g8tcw2ngsx4rs]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:06:32.696Z"}
{"level":"debug","message":"Executing query [m8o5k3gbugpxrp5fyir]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[12,888,12,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:06:32.699Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:06:32.699Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 12, Área ID: 888, Rol ID: 888, Documento ID: 11","timestamp":"2025-03-25T07:06:32.703Z"}
{"level":"debug","message":"Executing query [m8o5k3gg5koxsn38t09]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[11,12,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:06:32.704Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5k3gg5koxsn38t09]","params":"[11,12,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:06:32.708Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:06:32.709Z"}
{"level":"debug","message":"Executing query [m8o5k3glkiq8b28i8m]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.709Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5k3glkiq8b28i8m]","params":"[11]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:06:32.711Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:06:32.712Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:06:32.712Z"}
{"level":"debug","message":"Executing query [m8o5k3gpgtkbx7pm0i5]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[11,12,\"RESTAURAR\"]","timestamp":"2025-03-25T07:06:32.713Z"}
{"level":"debug","message":"Executing query [m8o5k3gt05b2jeiw9rtu]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.717Z"}
{"level":"debug","message":"Executing query [m8o5k3gvla9inaa8e2]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[11,12,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:06:32.719Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5k3gvla9inaa8e2]","params":"[11,12,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:06:32.723Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:06:32.723Z"}
{"level":"debug","message":"Executing query [m8o5k3gzmqc513h9in]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[11]","timestamp":"2025-03-25T07:06:32.723Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5k3gzmqc513h9in]","params":"[11]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:06:32.725Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:06:32.726Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:06:32.726Z"}
{"level":"debug","message":"Executing query [m8o5k3h30tt4t9me9vw]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[12,888,12,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:06:32.727Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:06:32.727Z"}
{"level":"debug","message":"Executing query [m8o5k3h5fwugifne2fl]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:06:32.729Z"}
{"level":"debug","message":"Executing query [m8o5k3h8igbg1nshh1k]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[12,\"DOCUMENTO\",12,\"ELIMINAR\"]","timestamp":"2025-03-25T07:06:32.732Z"}
{"level":"debug","message":"Executing query [m8o5k3haeapghaumga]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.734Z"}
{"level":"debug","message":"Executing query [m8o5k3hdmi9dmw8ma3c]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:06:32.737Z"}
{"level":"debug","message":"Executing query [m8o5k3hg5twx0tjydfj]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.740Z"}
{"level":"debug","message":"Executing query [m8o5k3hi1o5m17jy3em]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:32.742Z"}
{"level":"debug","message":"Executing query [m8o5k3hk7nahm8ekk83]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:32.744Z"}
{"level":"debug","message":"Executing query [m8o5k3hnurb8yy2vin]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:06:32.747Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:06:32.750Z"}
{"level":"debug","message":"Executing query [m8o5k3hr279yux8rndk]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:32.751Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:32.752Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:32.853Z"}
{"level":"debug","message":"Executing query [m8o5k3kop3ln9qv14oe]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:32.856Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:32.869Z"}
{"level":"debug","message":"Executing query [m8o5k3l384bbsxbgx19]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:06:32.871Z"}
{"level":"debug","message":"Executing query [m8o5k3l4q6apme6mjcn]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:06:32.872Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:06:32.873Z"}
{"level":"debug","message":"Executing query [m8o5k3l6uhyl6wrpuf]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:06:32.874Z"}
{"level":"debug","message":"Executing query [m8o5k3l7t5xwv5zw73q]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:06:32.875Z"}
{"level":"debug","message":"Executing query [m8o5k3l84zztjlnet7e]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:06:32.876Z"}
{"level":"debug","message":"Executing query [m8o5k3lcdrp6vzlitp7]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.880Z"}
{"level":"debug","message":"Executing query [m8o5k3lfpwfeya7cxf]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.883Z"}
{"level":"debug","message":"Executing query [m8o5k3lhlciz1e8d9ce]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",12]","timestamp":"2025-03-25T07:06:32.885Z"}
{"level":"debug","message":"Executing query [m8o5k3lkm0rdjgpdunq]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.888Z"}
{"level":"debug","message":"Executing query [m8o5k3lmw0uvjomjpr8]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.890Z"}
{"level":"debug","message":"Executing query [m8o5k3lpbnllrz8i3pn]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[12]","timestamp":"2025-03-25T07:06:32.893Z"}
{"level":"debug","message":"Executing query [m8o5k3lryy821epaefn]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:32.895Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:32.896Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:33.275Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:06:33.337Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:33.384Z"}
{"level":"debug","message":"Executing query [m8o5k3zynrbsipl0m7m]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:06:33.406Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:33.434Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:33.607Z"}
{"level":"debug","message":"Executing query [m8o5k45l69dwwhbnzlm]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:33.609Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:33.618Z"}
{"level":"debug","message":"Executing query [m8o5k45vvwok4uddmp8]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:06:33.619Z"}
{"level":"debug","message":"Executing query [m8o5k45x7g5urymxm0e]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886393609\"]","timestamp":"2025-03-25T07:06:33.621Z"}
{"level":"debug","message":"Executing query [m8o5k45yr36rvlwxu3j]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742886393609\",\"TEST-OFI-QUIMICA-1742886393609\",5771,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:06:33.622Z"}
{"level":"debug","message":"Executing query [m8o5k463560igrb1ry6]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.627Z"}
{"level":"debug","message":"Executing query [m8o5k465zevurd8rrnb]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886393609\"]","timestamp":"2025-03-25T07:06:33.629Z"}
{"level":"debug","message":"Executing query [m8o5k467jsu2u53qj8n]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",6]","timestamp":"2025-03-25T07:06:33.631Z"}
{"level":"debug","message":"Executing query [m8o5k4697m5me53jtz]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.633Z"}
{"level":"debug","message":"Executing query [m8o5k46b41y8gxuqyex]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.636Z"}
{"level":"debug","message":"Executing query [m8o5k46eatzj4wmpd8c]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.638Z"}
{"level":"debug","message":"Executing query [m8o5k46g59680depgrb]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.640Z"}
{"level":"debug","message":"Executing query [m8o5k46j62l15vw6nmu]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[6]","timestamp":"2025-03-25T07:06:33.643Z"}
{"level":"debug","message":"Executing query [m8o5k46k6ybhcie7fam]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:33.644Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:33.645Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:34.131Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:06:34.135Z"}
{"level":"debug","message":"Executing query [m8o5k4ka6tzv6o9e06j]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:06:34.138Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:06:34.154Z"}
{"level":"debug","message":"Executing query [m8o5k4krhx32lg3ayzk]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:06:34.155Z"}
{"level":"debug","message":"Executing query [m8o5k4kttpscglgsko]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:06:34.157Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:06:34.159Z"}
{"level":"debug","message":"Executing query [m8o5k4kvnq6ssn7gr6]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.159Z"}
{"level":"debug","message":"Executing query [m8o5k4kxml6mtqc0vol]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.161Z"}
{"level":"debug","message":"Executing query [m8o5k4kzpp8hzqwsayd]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.163Z"}
{"level":"debug","message":"Executing query [m8o5k4l154vih6mwhj6]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:06:34.165Z"}
{"level":"debug","message":"Executing query [m8o5k4l9campcydtrd8]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[13]","timestamp":"2025-03-25T07:06:34.173Z"}
{"level":"debug","message":"Executing query [m8o5k4ldvn0x9ec3qhk]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.177Z"}
{"level":"debug","message":"Executing query [m8o5k4lgvuen02wcbaj]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",13]","timestamp":"2025-03-25T07:06:34.180Z"}
{"level":"debug","message":"Executing query [m8o5k4lje6a3rs37y98]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[13]","timestamp":"2025-03-25T07:06:34.183Z"}
{"level":"debug","message":"Executing query [m8o5k4lmmdumcrnhdom]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[13]","timestamp":"2025-03-25T07:06:34.186Z"}
{"level":"debug","message":"Executing query [m8o5k4lqfqleq1ak9p4]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[13]","timestamp":"2025-03-25T07:06:34.190Z"}
{"level":"debug","message":"Executing query [m8o5k4lsmb4vuot38uk]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.192Z"}
{"level":"debug","message":"Executing query [m8o5k4lu5k5y5kwc9kn]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:06:34.194Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:06:34.195Z"}
{"level":"debug","message":"Executing query [m8o5k4lws2iv7l3in2a]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:06:34.196Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:06:34.198Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.329Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.340Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.342Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.350Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.355Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.360Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:10:34.362Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:10:34.366Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:10:34.368Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:10:34.370Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:10:34.371Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:10:34.373Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:34.654Z"}
{"level":"debug","message":"Executing query [m8o5pa75uncrl1twlx8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:34.722Z"}
{"level":"debug","message":"Executing query [m8o5pa9984bqssj2xai]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886634718\"]","timestamp":"2025-03-25T07:10:34.797Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:34.800Z"}
{"level":"debug","message":"Executing query [m8o5pa9w2wvl3dd5cq6]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886634718\"]","timestamp":"2025-03-25T07:10:34.821Z"}
{"level":"debug","message":"Executing query [m8o5pa9zq4wenn7u4bo]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742886634718\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:10:34.823Z"}
{"level":"debug","message":"Executing query [m8o5paaf7r3kacjuehi]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.839Z"}
{"level":"debug","message":"Executing query [m8o5paarcfa1yv7z9v]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742886634718\"]","timestamp":"2025-03-25T07:10:34.851Z"}
{"level":"debug","message":"Executing query [m8o5paavs8x56xvexx]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1005]","timestamp":"2025-03-25T07:10:34.855Z"}
{"level":"debug","message":"Executing query [m8o5pab1cbxfuxf2z2t]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.861Z"}
{"level":"debug","message":"Executing query [m8o5pab464b9dmxo3gt]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.864Z"}
{"level":"debug","message":"Executing query [m8o5pab8goouurjl78i]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.868Z"}
{"level":"debug","message":"Executing query [m8o5pabbb4ovprjevli]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.871Z"}
{"level":"debug","message":"Executing query [m8o5pabdcbjkmjuzyyc]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.873Z"}
{"level":"debug","message":"Executing query [m8o5pabgkm2vmkzes5r]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1005]","timestamp":"2025-03-25T07:10:34.876Z"}
{"level":"debug","message":"Executing query [m8o5pabjgfq2h8qmv8]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:10:34.879Z"}
{"level":"debug","message":"Executing query [m8o5pablal1c3w32ze9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:34.882Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:34.886Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:34.945Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.093Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.095Z"}
{"level":"debug","message":"Executing query [m8o5paiuabb4kh33wjv]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:35.142Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.223Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:34.977Z"}
{"level":"debug","message":"Executing query [m8o5pal8d9iq5lhyswg]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:10:35.228Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:10:35.240Z"}
{"level":"debug","message":"Executing query [m8o5pallewcrwk0kqtk]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:10:35.241Z"}
{"level":"debug","message":"Executing query [m8o5paloa4lxuy77ksb]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:10:35.244Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:10:35.248Z"}
{"level":"debug","message":"Executing query [m8o5paltyun2pmaeufd]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:10:35.249Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:10:35.224Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.296Z"}
{"level":"debug","message":"Executing query [m8o5panxpp7jhxy56na]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:10:35.326Z"}
{"level":"debug","message":"Executing query [m8o5pao4t5yd8ml4k1m]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:10:35.332Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.234Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o5pao4t5yd8ml4k1m]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:10:35.336Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:35.341Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:10:35.259Z"}
{"level":"debug","message":"Executing query [m8o5pap2amn33wknqpt]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:10:35.366Z"}
{"level":"debug","message":"Executing query [m8o5panytst9wiyallk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:35.329Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.415Z"}
{"level":"debug","message":"Executing query [m8o5paqo0ctanx458z8g]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:10:35.425Z"}
{"level":"debug","message":"Executing query [m8o5papikdgvytv8tp]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:10:35.382Z"}
{"level":"debug","message":"Executing query [m8o5paqshcmqd749w5]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[11]","timestamp":"2025-03-25T07:10:35.428Z"}
{"level":"debug","message":"Executing query [m8o5paqu33ay9044b8c]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886635325\"]","timestamp":"2025-03-25T07:10:35.430Z"}
{"level":"debug","message":"Executing query [m8o5paqxd9crtj1fecv]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742886635325\",\"TEST-OFI-FORENSE-1742886635325\",4797,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742886635325\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:10:35.433Z"}
{"level":"debug","message":"Executing query [m8o5par87ncdng2jnc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:35.444Z"}
{"level":"debug","message":"Executing query [m8o5parfvngyqb37crj]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.451Z"}
{"level":"debug","message":"Executing query [m8o5park3afcmzqmt5z]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742886635325\"]","timestamp":"2025-03-25T07:10:35.456Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.381Z"}
{"level":"debug","message":"Executing query [m8o5parn10w5psiauwm]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",13]","timestamp":"2025-03-25T07:10:35.459Z"}
{"level":"debug","message":"Executing query [m8o5parvusqhmno7e1]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.467Z"}
{"level":"debug","message":"Executing query [m8o5parxwmgqsn6h2rd]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.469Z"}
{"level":"debug","message":"Executing query [m8o5pas1e823cyqajy]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.473Z"}
{"level":"debug","message":"Executing query [m8o5pas4m7l0zyvs3]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.476Z"}
{"level":"debug","message":"Executing query [m8o5pas8fevy7m2q1lw]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.481Z"}
{"level":"debug","message":"Executing query [m8o5pasb3hacue3kk9b]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742886635483\",\"TEST-SP-OFI-FORENSE-1742886635483\",9878,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:10:35.483Z"}
{"level":"debug","message":"Executing query [m8o5paslhik0f5dwp2f]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886635483\"]","timestamp":"2025-03-25T07:10:35.494Z"}
{"level":"debug","message":"Executing query [m8o5pasolkdlngbfj3]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742886635483\"]","timestamp":"2025-03-25T07:10:35.496Z"}
{"level":"debug","message":"Executing query [m8o5passhuk15wx013q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:35.500Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:35.503Z"}
{"level":"debug","message":"Executing query [m8o5pare5l1zdeybsxd]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:35.451Z"}
{"level":"debug","message":"Executing query [m8o5pat9s04o3obpkh]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:10:35.518Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.524Z"}
{"level":"debug","message":"Executing query [m8o5patmjh5qscvmax9]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886635449\"]","timestamp":"2025-03-25T07:10:35.530Z"}
{"level":"debug","message":"Executing query [m8o5patp2tajj6bnaaj]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742886635449\",\"TEST-OFICIO-1742886635449\",5746,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:10:35.533Z"}
{"level":"debug","message":"Executing query [m8o5patyqgd44hyrt2h]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.542Z"}
{"level":"debug","message":"Executing query [m8o5pau3pc9b3gr4d1]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742886635449\"]","timestamp":"2025-03-25T07:10:35.547Z"}
{"level":"debug","message":"Executing query [m8o5pau64kejy1wklfm]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",13]","timestamp":"2025-03-25T07:10:35.550Z"}
{"level":"debug","message":"Executing query [m8o5paue8zzvj1puymn]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.559Z"}
{"level":"debug","message":"Executing query [m8o5pauhoi4kd9t1emi]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.562Z"}
{"level":"debug","message":"Executing query [m8o5paunlrz562zgojh]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.567Z"}
{"level":"debug","message":"Executing query [m8o5pauqszerdm1cr4p]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.570Z"}
{"level":"debug","message":"Executing query [m8o5pauu7ms6c1m2cpn]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.574Z"}
{"level":"debug","message":"Executing query [m8o5pauxae2d957031d]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742886635577\",\"TEST-SP-OFICIO-1742886635577\",1437,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:10:35.577Z"}
{"level":"debug","message":"Executing query [m8o5pav23ptupqwpa7x]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886635577\"]","timestamp":"2025-03-25T07:10:35.582Z"}
{"level":"debug","message":"Executing query [m8o5pav43ajexc7aeks]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742886635577\"]","timestamp":"2025-03-25T07:10:35.584Z"}
{"level":"debug","message":"Executing query [m8o5pav8sz1ilhan3c]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:35.588Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:35.590Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:10:35.285Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.773Z"}
{"level":"debug","message":"Executing query [m8o5pb0jwitxte06udh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:35.779Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.801Z"}
{"level":"debug","message":"Executing query [m8o5pb1d9pgkfu2efwd]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886635777\"]","timestamp":"2025-03-25T07:10:35.809Z"}
{"level":"debug","message":"Executing query [m8o5pb1fibdnuxgolm]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742886635777\",true]","timestamp":"2025-03-25T07:10:35.811Z"}
{"level":"debug","message":"Executing query [m8o5pb25nz92ix785w]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.837Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:35.840Z"}
{"level":"debug","message":"Executing query [m8o5pb2kt6268uh6ma]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:35.852Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:35.883Z"}
{"level":"debug","message":"Executing query [m8o5pb3fe0p4znmm57]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742886635777\"]","timestamp":"2025-03-25T07:10:35.883Z"}
{"level":"debug","message":"Executing query [m8o5pb3o8p8xrhh8y0u]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:10:35.892Z"}
{"level":"debug","message":"Executing query [m8o5pb3q6tznithyfiw]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:10:35.894Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:10:35.896Z"}
{"level":"debug","message":"Executing query [m8o5pb3sq3j8oogiofk]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:10:35.896Z"}
{"level":"debug","message":"Executing query [m8o5pb3umur1h0mbjfe]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:10:35.898Z"}
{"level":"debug","message":"Executing query [m8o5pb3w7nx4r80ycpk]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:10:35.900Z"}
{"level":"debug","message":"Executing query [m8o5pb40gbp706wcd2b]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",13]","timestamp":"2025-03-25T07:10:35.904Z"}
{"level":"debug","message":"Executing query [m8o5pb45wzd8b2rrxu]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.909Z"}
{"level":"debug","message":"Executing query [m8o5pb45b7809qh6vpf]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.910Z"}
{"level":"debug","message":"Executing query [m8o5pb49d7pvg93aful]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.913Z"}
{"level":"debug","message":"Executing query [m8o5pb4ac58ituyjxqu]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.914Z"}
{"level":"debug","message":"Executing query [m8o5pb4dk07svsn59bo]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.917Z"}
{"level":"debug","message":"Executing query [m8o5pb4f91o95u3x094]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.919Z"}
{"level":"debug","message":"Executing query [m8o5pb4fc5a6klgv45]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",13]","timestamp":"2025-03-25T07:10:35.919Z"}
{"level":"debug","message":"Executing query [m8o5pb4hcklti74kznl]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.921Z"}
{"level":"debug","message":"Executing query [m8o5pb4tfx5o37654ft]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.933Z"}
{"level":"debug","message":"Executing query [m8o5pb4ugw8u5yklp7l]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.934Z"}
{"level":"debug","message":"Executing query [m8o5pb4ww3worznqk6]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:10:35.936Z"}
{"level":"debug","message":"Executing query [m8o5pb4wnumn6zdhgbs]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.936Z"}
{"level":"debug","message":"Executing query [m8o5pb4yb2hq1vn9oy6]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:35.938Z"}
{"level":"debug","message":"Executing query [m8o5pb50oc0x7bnnguc]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[13]","timestamp":"2025-03-25T07:10:35.940Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:35.940Z"}
{"level":"debug","message":"Executing query [m8o5pb52gkvgk0rvutu]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:35.942Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:35.945Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:36.071Z"}
{"level":"debug","message":"Executing query [m8o5pb8sny7nur0gwt8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:36.076Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:36.101Z"}
{"level":"debug","message":"Executing query [m8o5pb9h8hldn91buyw]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:10:36.101Z"}
{"level":"debug","message":"Executing query [m8o5pb9kcipwzpesdzv]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886636074\"]","timestamp":"2025-03-25T07:10:36.104Z"}
{"level":"debug","message":"Executing query [m8o5pb9mq07j21hlujs]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742886636074\",\"TEST-OFI-QUIMICA-1742886636074\",3393,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:10:36.106Z"}
{"level":"debug","message":"Executing query [m8o5pb9uum4yo4mxav]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.114Z"}
{"level":"debug","message":"Executing query [m8o5pb9zuz1dfi4l45s]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742886636074\"]","timestamp":"2025-03-25T07:10:36.119Z"}
{"level":"debug","message":"Executing query [m8o5pba1fj8pcd9xkei]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",7]","timestamp":"2025-03-25T07:10:36.121Z"}
{"level":"debug","message":"Executing query [m8o5pba5694kzy9q8lm]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.125Z"}
{"level":"debug","message":"Executing query [m8o5pba9wujuwiqhewa]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.129Z"}
{"level":"debug","message":"Executing query [m8o5pbad8lsi0xcp3vm]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.133Z"}
{"level":"debug","message":"Executing query [m8o5pbagozymkuf11q]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.136Z"}
{"level":"debug","message":"Executing query [m8o5pbalsj9mu9zce0l]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[7]","timestamp":"2025-03-25T07:10:36.141Z"}
{"level":"debug","message":"Executing query [m8o5pbandhrfoin4eqh]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:36.143Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:36.145Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:10:35.517Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:10:35.518Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:10:35.519Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:10:35.521Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:10:35.522Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:10:35.522Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:36.095Z"}
{"level":"debug","message":"Executing query [m8o5pbamrpboxxh4cah]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:36.142Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:36.194Z"}
{"level":"debug","message":"Executing query [m8o5pbc7at0xrxvnfhh]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:10:36.199Z"}
{"level":"debug","message":"Executing query [m8o5pbcd5gok8dp7orb]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:10:36.205Z"}
{"level":"debug","message":"Executing query [m8o5pbcgmvjfqy10hni]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:10:36.208Z"}
{"level":"debug","message":"Executing query [m8o5pbcj2ppkjl3f0qo]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:10:36.212Z"}
{"level":"debug","message":"Executing query [m8o5pbcqd1amyuhggrs]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:10:36.218Z"}
{"level":"debug","message":"Executing query [m8o5pbcwyeijpw4fuj8]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[14,888,14,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:10:36.224Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:10:36.224Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 14, Área ID: 888, Rol ID: 888, Documento ID: 13","timestamp":"2025-03-25T07:10:36.230Z"}
{"level":"debug","message":"Executing query [m8o5pbd4j8vpmnk1so]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[13,14,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:10:36.232Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5pbd4j8vpmnk1so]","params":"[13,14,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:10:36.238Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:10:36.239Z"}
{"level":"debug","message":"Executing query [m8o5pbdb3z85mt0d7ym]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[13]","timestamp":"2025-03-25T07:10:36.239Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5pbdb3z85mt0d7ym]","params":"[13]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:10:36.241Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:10:36.242Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:10:36.242Z"}
{"level":"debug","message":"Executing query [m8o5pbdfffpp3ia18t9]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[13,14,\"RESTAURAR\"]","timestamp":"2025-03-25T07:10:36.243Z"}
{"level":"debug","message":"Executing query [m8o5pbdmclnljvzqz4t]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[13]","timestamp":"2025-03-25T07:10:36.251Z"}
{"level":"debug","message":"Executing query [m8o5pbdq73lceu8gr9p]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[13,14,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:10:36.254Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5pbdq73lceu8gr9p]","params":"[13,14,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:10:36.258Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:10:36.259Z"}
{"level":"debug","message":"Executing query [m8o5pbdvh1iit0xuey7]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[13]","timestamp":"2025-03-25T07:10:36.259Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o5pbdvh1iit0xuey7]","params":"[13]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:10:36.271Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:10:36.272Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:10:36.272Z"}
{"level":"debug","message":"Executing query [m8o5pbe9xy5zf4ypmq]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[14,888,14,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:10:36.273Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:10:36.273Z"}
{"level":"debug","message":"Executing query [m8o5pbedlmnmliqtbd]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:10:36.277Z"}
{"level":"debug","message":"Executing query [m8o5pbeg27r727t0r3f]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[14,\"DOCUMENTO\",14,\"ELIMINAR\"]","timestamp":"2025-03-25T07:10:36.280Z"}
{"level":"debug","message":"Executing query [m8o5pbem22c3dm555yi]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[14]","timestamp":"2025-03-25T07:10:36.286Z"}
{"level":"debug","message":"Executing query [m8o5pbeueoeovd1a4zw]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:10:36.294Z"}
{"level":"debug","message":"Executing query [m8o5pbf1leq0ziydfna]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[14]","timestamp":"2025-03-25T07:10:36.301Z"}
{"level":"debug","message":"Executing query [m8o5pbf5ieyz69gnw9k]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:10:36.305Z"}
{"level":"debug","message":"Executing query [m8o5pbf7nlnhwqdbz0s]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:10:36.307Z"}
{"level":"debug","message":"Executing query [m8o5pbf9dt9cpprsxd5]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:10:36.309Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:10:36.318Z"}
{"level":"debug","message":"Executing query [m8o5pbfigji5lpw9ana]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:36.318Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:36.320Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:36.433Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:36.457Z"}
{"level":"debug","message":"Executing query [m8o5pbjfyjl6g3snzxg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:10:36.459Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:36.484Z"}
{"level":"debug","message":"Executing query [m8o5pbkb4y7yainfxev]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:10:36.491Z"}
{"level":"debug","message":"Executing query [m8o5pbkdab46snw5f6m]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:10:36.493Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:10:36.495Z"}
{"level":"debug","message":"Executing query [m8o5pbkfr36is7dllko]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.495Z"}
{"level":"debug","message":"Executing query [m8o5pbkggvkkw6c5ko]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.496Z"}
{"level":"debug","message":"Executing query [m8o5pbkjx6ckogf31g]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.499Z"}
{"level":"debug","message":"Executing query [m8o5pbklw3gzh9js6gk]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:10:36.501Z"}
{"level":"debug","message":"Executing query [m8o5pbks6twlhve40o3]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[15]","timestamp":"2025-03-25T07:10:36.508Z"}
{"level":"debug","message":"Executing query [m8o5pbkxvwzpk1d2aa]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.513Z"}
{"level":"debug","message":"Executing query [m8o5pbl04jnhsz6gxy4]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",15]","timestamp":"2025-03-25T07:10:36.516Z"}
{"level":"debug","message":"Executing query [m8o5pbl4veurfbap7d]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[15]","timestamp":"2025-03-25T07:10:36.520Z"}
{"level":"debug","message":"Executing query [m8o5pbl6yzaj5duw9s]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[15]","timestamp":"2025-03-25T07:10:36.522Z"}
{"level":"debug","message":"Executing query [m8o5pblaqau6jju561i]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[15]","timestamp":"2025-03-25T07:10:36.526Z"}
{"level":"debug","message":"Executing query [m8o5pblcx0bbiwexe]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.528Z"}
{"level":"debug","message":"Executing query [m8o5pblfby4tqrbtaji]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:10:36.531Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:10:36.532Z"}
{"level":"debug","message":"Executing query [m8o5pblgttz0jf3ssw]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:10:36.532Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:36.534Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:36.795Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:10:37.143Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:10:37.170Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:37.425Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:10:37.446Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:37.507Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:37.616Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:10:37.840Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:37.939Z"}
{"level":"debug","message":"Executing query [m8o5pcpi1mi3bj1qn1s]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:10:37.975Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:38.012Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:38.484Z"}
{"duration":"21ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:10:38.652Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:10:38.653Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:10:38.656Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:38.661Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:10:38.629Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:10:38.753Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:10:38.758Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:32.784Z"}
{"level":"debug","message":"Executing query [m8o623p6fajj9upzdr8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:32.826Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:32.875Z"}
{"level":"debug","message":"Executing query [m8o623rb4vh9ta01w16]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887232825\"]","timestamp":"2025-03-25T07:20:32.903Z"}
{"level":"debug","message":"Executing query [m8o623rj4a50z14rdh6]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887232825\"]","timestamp":"2025-03-25T07:20:32.911Z"}
{"level":"debug","message":"Executing query [m8o623rouwckbzgohop]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742887232825\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:20:32.916Z"}
{"level":"debug","message":"Executing query [m8o623sb72x6tirhvku]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.939Z"}
{"level":"debug","message":"Executing query [m8o623slwp67ph7kvd8]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887232825\"]","timestamp":"2025-03-25T07:20:32.949Z"}
{"level":"debug","message":"Executing query [m8o623soi1xiw6f4zgk]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1006]","timestamp":"2025-03-25T07:20:32.952Z"}
{"level":"debug","message":"Executing query [m8o623ssedx49pm6vmh]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.956Z"}
{"level":"debug","message":"Executing query [m8o623sviylgg1p315]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.959Z"}
{"level":"debug","message":"Executing query [m8o623szanprme6r7l]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.963Z"}
{"level":"debug","message":"Executing query [m8o623t3dzc0vgkjjc]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.967Z"}
{"level":"debug","message":"Executing query [m8o623t69p77bj6bnzr]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.970Z"}
{"level":"debug","message":"Executing query [m8o623tamtnv5hryian]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1006]","timestamp":"2025-03-25T07:20:32.974Z"}
{"level":"debug","message":"Executing query [m8o623tc1x14w06twdl]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:20:32.976Z"}
{"level":"debug","message":"Executing query [m8o623tdhg7hu2n9nu]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:32.977Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:32.979Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.153Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.159Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.165Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.172Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.176Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.179Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:20:33.185Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:20:33.190Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:33.898Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:20:33.192Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:20:33.201Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:20:33.204Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:20:33.207Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:35.688Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:20:36.018Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:20:36.026Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:36.102Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:20:36.122Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:36.185Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:36.763Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:36.969Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:37.009Z"}
{"level":"debug","message":"Executing query [m8o626xqo2hih9ez9kp]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:20:37.022Z"}
{"level":"debug","message":"Executing query [m8o626xvmg3aq7fvqeh]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:20:37.027Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o626xvmg3aq7fvqeh]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:20:37.030Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:37.032Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:37.218Z"}
{"level":"debug","message":"Executing query [m8o6273992l06jk0gkk]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:37.221Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:37.235Z"}
{"level":"debug","message":"Executing query [m8o6273sfoh6cvvk8ac]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:20:37.240Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:20:37.241Z"}
{"level":"debug","message":"Executing query [m8o6273u52ed85lpx1n]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:20:37.242Z"}
{"level":"debug","message":"Executing query [m8o6273vfhwuqv0z09n]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:20:37.243Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:20:37.245Z"}
{"level":"debug","message":"Executing query [m8o6273xjjt44m3rlx]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:20:37.245Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:20:37.246Z"}
{"level":"debug","message":"Executing query [m8o62744i1y4bquy32]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:20:37.252Z"}
{"level":"debug","message":"Executing query [m8o62747em3l3l0y9sa]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:20:37.255Z"}
{"level":"debug","message":"Executing query [m8o627490p2qfjtd59ho]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[13]","timestamp":"2025-03-25T07:20:37.257Z"}
{"level":"debug","message":"Executing query [m8o6274el5wzpfzxetm]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:37.263Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:40.453Z"}
{"duration":"12ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:20:40.553Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:20:40.559Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:40.567Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:20:40.569Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:20:40.730Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:20:40.894Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:41.180Z"}
{"level":"debug","message":"Executing query [m8o62a5m0qhaszyrcozp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:41.194Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:41.228Z"}
{"level":"debug","message":"Executing query [m8o62a6pan2qn05j5p9]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:20:41.233Z"}
{"level":"debug","message":"Executing query [m8o62a6sxupidaye9ye]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742887241193\"]","timestamp":"2025-03-25T07:20:41.236Z"}
{"level":"debug","message":"Executing query [m8o62a6ud67g53yrwnw]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742887241193\",\"TEST-OFICIO-1742887241193\",1381,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:20:41.239Z"}
{"level":"debug","message":"Executing query [m8o62a73rlswyaoet9]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.247Z"}
{"level":"debug","message":"Executing query [m8o62a76ryci2wnwuc]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742887241193\"]","timestamp":"2025-03-25T07:20:41.250Z"}
{"level":"debug","message":"Executing query [m8o62a7begvtvazlpsj]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",15]","timestamp":"2025-03-25T07:20:41.255Z"}
{"level":"debug","message":"Executing query [m8o62a7end777kzoh78]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.258Z"}
{"level":"debug","message":"Executing query [m8o62a7imp797b26wlh]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.262Z"}
{"level":"debug","message":"Executing query [m8o62a7qo78mg6hz5mq]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.270Z"}
{"level":"debug","message":"Executing query [m8o62a7t5fjt9xe5trk]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.273Z"}
{"level":"debug","message":"Executing query [m8o62a7xp91z1aic9h]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.277Z"}
{"level":"debug","message":"Executing query [m8o62a85qr71ny6009]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742887241285\",\"TEST-SP-OFICIO-1742887241285\",6317,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:20:41.285Z"}
{"level":"debug","message":"Executing query [m8o62a8arclmzq62mrd]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742887241285\"]","timestamp":"2025-03-25T07:20:41.290Z"}
{"level":"debug","message":"Executing query [m8o62a8g9xz53y47ia]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742887241285\"]","timestamp":"2025-03-25T07:20:41.296Z"}
{"level":"debug","message":"Executing query [m8o62a8kb2nqw1suktc]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:41.300Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:41.302Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:41.697Z"}
{"level":"debug","message":"Executing query [m8o62ajqp70cyqzcv8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:41.702Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:41.730Z"}
{"level":"debug","message":"Executing query [m8o62akkizklhi8jgap]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:20:41.733Z"}
{"level":"debug","message":"Executing query [m8o62akoe3hxvxz5riv]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742887241700\"]","timestamp":"2025-03-25T07:20:41.736Z"}
{"level":"debug","message":"Executing query [m8o62akr20ac8zsjh10i]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742887241700\",\"TEST-OFI-FORENSE-1742887241700\",2759,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742887241700\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:20:41.740Z"}
{"level":"debug","message":"Executing query [m8o62al0md1dc72tngd]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.748Z"}
{"level":"debug","message":"Executing query [m8o62al3l24kkuqjwl]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742887241700\"]","timestamp":"2025-03-25T07:20:41.752Z"}
{"level":"debug","message":"Executing query [m8o62al84cei8fqu70x]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",15]","timestamp":"2025-03-25T07:20:41.756Z"}
{"level":"debug","message":"Executing query [m8o62alfbbbsz2ghxai]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.763Z"}
{"level":"debug","message":"Executing query [m8o62alkcs5qn6rlxk]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.768Z"}
{"level":"debug","message":"Executing query [m8o62alrswfvsq6hlbk]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.775Z"}
{"level":"debug","message":"Executing query [m8o62alu5ajbgacwg53]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.778Z"}
{"level":"debug","message":"Executing query [m8o62alz4k27kibofri]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[15]","timestamp":"2025-03-25T07:20:41.783Z"}
{"level":"debug","message":"Executing query [m8o62am5oxc2ig0zem]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742887241789\",\"TEST-SP-OFI-FORENSE-1742887241789\",8256,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:20:41.789Z"}
{"level":"debug","message":"Executing query [m8o62amalipqf2ted5o]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742887241789\"]","timestamp":"2025-03-25T07:20:41.794Z"}
{"level":"debug","message":"Executing query [m8o62amc7l3y8h6tux8]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742887241789\"]","timestamp":"2025-03-25T07:20:41.796Z"}
{"level":"debug","message":"Executing query [m8o62amo3mf36fuvvu9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:41.808Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:41.810Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:43.099Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:43.179Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:20:43.181Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:20:43.329Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:20:43.330Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:20:43.331Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:20:43.332Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:20:43.334Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:20:43.334Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:43.872Z"}
{"level":"debug","message":"Executing query [m8o62c84dcxxg5ayrfe]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:43.876Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:43.902Z"}
{"level":"debug","message":"Executing query [m8o62c8xysn2ny8eajq]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742887243875\"]","timestamp":"2025-03-25T07:20:43.905Z"}
{"level":"debug","message":"Executing query [m8o62c90lem7o51mqna]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742887243875\",true]","timestamp":"2025-03-25T07:20:43.908Z"}
{"level":"debug","message":"Executing query [m8o62c99giosakegl7]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.917Z"}
{"level":"debug","message":"Executing query [m8o62c9d4m7ci7l4234]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742887243875\"]","timestamp":"2025-03-25T07:20:43.921Z"}
{"level":"debug","message":"Executing query [m8o62c9hufq7yunpah]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",15]","timestamp":"2025-03-25T07:20:43.925Z"}
{"level":"debug","message":"Executing query [m8o62c9kdvokpy1foog]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.928Z"}
{"level":"debug","message":"Executing query [m8o62c9new93f57xt6c]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.931Z"}
{"level":"debug","message":"Executing query [m8o62c9xddq10ie26ad]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.941Z"}
{"level":"debug","message":"Executing query [m8o62c9zq36j51lzb4h]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.943Z"}
{"level":"debug","message":"Executing query [m8o62ca08tmz9pnu177]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.944Z"}
{"level":"debug","message":"Executing query [m8o62ca4a7wdxj8kttk]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[15]","timestamp":"2025-03-25T07:20:43.948Z"}
{"level":"debug","message":"Executing query [m8o62ca6egkac2xpvxk]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:20:43.950Z"}
{"level":"debug","message":"Executing query [m8o62ca88bqt5tz0tnn]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:43.952Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:43.954Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:44.291Z"}
{"level":"debug","message":"Executing query [m8o62cjtxu98y00trc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:44.297Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:44.315Z"}
{"level":"debug","message":"Executing query [m8o62ckcz558lnd7kc]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:20:44.316Z"}
{"level":"debug","message":"Executing query [m8o62ckd03iuk3j9c0ms]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:20:44.317Z"}
{"level":"debug","message":"Executing query [m8o62ckeb7zq9putajo]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:20:44.318Z"}
{"level":"debug","message":"Executing query [m8o62ckhw06nx05v9lo]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:20:44.321Z"}
{"level":"debug","message":"Executing query [m8o62ckneo46prlmn1]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:20:44.327Z"}
{"level":"debug","message":"Executing query [m8o62ckqo1ekeukya9]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[16,888,16,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:20:44.330Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:20:44.330Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 16, Área ID: 888, Rol ID: 888, Documento ID: 15","timestamp":"2025-03-25T07:20:44.344Z"}
{"level":"debug","message":"Executing query [m8o62cl5r5yjppkgk5i]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[15,16,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:20:44.345Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o62cl5r5yjppkgk5i]","params":"[15,16,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:20:44.353Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:20:44.354Z"}
{"level":"debug","message":"Executing query [m8o62clfrf54v72hr1]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[15]","timestamp":"2025-03-25T07:20:44.355Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o62clfrf54v72hr1]","params":"[15]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:20:44.357Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:20:44.358Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:20:44.358Z"}
{"level":"debug","message":"Executing query [m8o62cljhpmvqy7ke8]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[15,16,\"RESTAURAR\"]","timestamp":"2025-03-25T07:20:44.359Z"}
{"level":"debug","message":"Executing query [m8o62clpgyepenyi9vt]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[15]","timestamp":"2025-03-25T07:20:44.365Z"}
{"level":"debug","message":"Executing query [m8o62clskoeq1hh70f8]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[15,16,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:20:44.368Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o62clskoeq1hh70f8]","params":"[15,16,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:20:44.372Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:20:44.373Z"}
{"level":"debug","message":"Executing query [m8o62clxpwjcdqn0cab]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[15]","timestamp":"2025-03-25T07:20:44.373Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o62clxpwjcdqn0cab]","params":"[15]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:20:44.377Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:20:44.378Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:20:44.379Z"}
{"level":"debug","message":"Executing query [m8o62cm4pv8pqu69m2h]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[16,888,16,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:20:44.380Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:20:44.380Z"}
{"level":"debug","message":"Executing query [m8o62cm81oueqotjdz2]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:20:44.385Z"}
{"level":"debug","message":"Executing query [m8o62cmg39yu66jqaq2]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[16,\"DOCUMENTO\",16,\"ELIMINAR\"]","timestamp":"2025-03-25T07:20:44.392Z"}
{"level":"debug","message":"Executing query [m8o62cmjf2bvfd00jta]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.395Z"}
{"level":"debug","message":"Executing query [m8o62cmmeizohpuv7od]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:20:44.398Z"}
{"level":"debug","message":"Executing query [m8o62cmuo47t87fm3gm]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.406Z"}
{"level":"debug","message":"Executing query [m8o62cmzozrwxb8mll]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:20:44.411Z"}
{"level":"debug","message":"Executing query [m8o62cn40b1ejzx9xy1m]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:20:44.416Z"}
{"level":"debug","message":"Executing query [m8o62cn649d6bckagp3]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:20:44.418Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:20:44.421Z"}
{"level":"debug","message":"Executing query [m8o62cna9p24p5t2wul]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:44.422Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:44.423Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:44.646Z"}
{"level":"debug","message":"Executing query [m8o62cudlfmmwc668b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:44.678Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:44.727Z"}
{"level":"debug","message":"Executing query [m8o62cvxmj97esq6kzr]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:20:44.733Z"}
{"level":"debug","message":"Executing query [m8o62cw33o5zm945a33]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:20:44.739Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:20:44.742Z"}
{"level":"debug","message":"Executing query [m8o62cw6bm1919gct2]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:20:44.743Z"}
{"level":"debug","message":"Executing query [m8o62cw8pqa7dg7wqc]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:20:44.744Z"}
{"level":"debug","message":"Executing query [m8o62cwcogil4sjayae]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:20:44.748Z"}
{"level":"debug","message":"Executing query [m8o62cwl7lliylnznk]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.757Z"}
{"level":"debug","message":"Executing query [m8o62cwvj44l2s3fsw]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.767Z"}
{"level":"debug","message":"Executing query [m8o62cx0qsz0c8che09]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",16]","timestamp":"2025-03-25T07:20:44.772Z"}
{"level":"debug","message":"Executing query [m8o62cxlmpe3bmookva]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.793Z"}
{"level":"debug","message":"Executing query [m8o62cxovlh29zko3xs]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.796Z"}
{"level":"debug","message":"Executing query [m8o62cxvrljedzbx7o]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[16]","timestamp":"2025-03-25T07:20:44.803Z"}
{"level":"debug","message":"Executing query [m8o62cxzvfvaa4xus]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:44.807Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:44.809Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:45.699Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:20:45.795Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:45.871Z"}
{"level":"debug","message":"Executing query [m8o62dsbxo27oslpphl]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:20:45.900Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:45.954Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:46.243Z"}
{"level":"debug","message":"Executing query [m8o62e1y0x6mznocxd6j]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:46.246Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:46.261Z"}
{"level":"debug","message":"Executing query [m8o62e2fgokt7i7f7nc]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:20:46.263Z"}
{"level":"debug","message":"Executing query [m8o62e2isu2dx2ovd7]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742887246245\"]","timestamp":"2025-03-25T07:20:46.266Z"}
{"level":"debug","message":"Executing query [m8o62e2n2yx1f5wayp3]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742887246245\",\"TEST-OFI-QUIMICA-1742887246245\",8201,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:20:46.271Z"}
{"level":"debug","message":"Executing query [m8o62e2v55a5tv8tsrj]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.279Z"}
{"level":"debug","message":"Executing query [m8o62e305itx96htthc]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742887246245\"]","timestamp":"2025-03-25T07:20:46.284Z"}
{"level":"debug","message":"Executing query [m8o62e325zy2or2oj9e]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",8]","timestamp":"2025-03-25T07:20:46.286Z"}
{"level":"debug","message":"Executing query [m8o62e36ldm0a2nv2ej]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.290Z"}
{"level":"debug","message":"Executing query [m8o62e39j260txyx0ng]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.293Z"}
{"level":"debug","message":"Executing query [m8o62e3cz96kdn80t7c]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.296Z"}
{"level":"debug","message":"Executing query [m8o62e3e1ca92j88g7ei]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.298Z"}
{"level":"debug","message":"Executing query [m8o62e3hx9t1aj5n03i]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[8]","timestamp":"2025-03-25T07:20:46.301Z"}
{"level":"debug","message":"Executing query [m8o62e3jyfsa8s6jrco]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:46.303Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:46.305Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:47.005Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:20:47.010Z"}
{"level":"debug","message":"Executing query [m8o62en87ux64zerdo3]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:20:47.013Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:20:47.029Z"}
{"level":"debug","message":"Executing query [m8o62enr6avv34srzny]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:20:47.031Z"}
{"level":"debug","message":"Executing query [m8o62ens3ww2y14pl6l]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:20:47.033Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:20:47.033Z"}
{"level":"debug","message":"Executing query [m8o62enu2qklppxgt9q]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.034Z"}
{"level":"debug","message":"Executing query [m8o62env7yycaaxaz5k]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.035Z"}
{"level":"debug","message":"Executing query [m8o62enw48835ifsaey]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.036Z"}
{"level":"debug","message":"Executing query [m8o62enxyt37u8d4bl8]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:20:47.037Z"}
{"level":"debug","message":"Executing query [m8o62eo4pwiicgohved]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[17]","timestamp":"2025-03-25T07:20:47.044Z"}
{"level":"debug","message":"Executing query [m8o62eo7pxr9hr5hd0a]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.047Z"}
{"level":"debug","message":"Executing query [m8o62eo9xy3ukrivwrk]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",17]","timestamp":"2025-03-25T07:20:47.049Z"}
{"level":"debug","message":"Executing query [m8o62eocp5aj36nhg9b]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[17]","timestamp":"2025-03-25T07:20:47.052Z"}
{"level":"debug","message":"Executing query [m8o62eoewyxmia3z3ya]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[17]","timestamp":"2025-03-25T07:20:47.054Z"}
{"level":"debug","message":"Executing query [m8o62eol9awc5fpird6]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[17]","timestamp":"2025-03-25T07:20:47.061Z"}
{"level":"debug","message":"Executing query [m8o62eomh22r6cpcnu6]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.062Z"}
{"level":"debug","message":"Executing query [m8o62eona8kk1h8fsjh]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:20:47.063Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:20:47.064Z"}
{"level":"debug","message":"Executing query [m8o62eopuvidwqx2h1q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:20:47.065Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:20:47.066Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.474Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.488Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.491Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.505Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.520Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.527Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:21:29.532Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:21:29.538Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:21:29.541Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:21:29.543Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:21:29.544Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:21:29.546Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:29.806Z"}
{"level":"debug","message":"Executing query [m8o63bqaxr1x5e1bwm9]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:29.890Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:29.977Z"}
{"level":"debug","message":"Executing query [m8o63btai72b4jpm60d]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887289886\"]","timestamp":"2025-03-25T07:21:29.998Z"}
{"level":"debug","message":"Executing query [m8o63btw877jz440itl]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887289886\"]","timestamp":"2025-03-25T07:21:30.020Z"}
{"level":"debug","message":"Executing query [m8o63btztryq7awjdar]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742887289886\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:21:30.023Z"}
{"level":"debug","message":"Executing query [m8o63buckj08x5totid]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.036Z"}
{"level":"debug","message":"Executing query [m8o63buhldgk3wjiu1]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742887289886\"]","timestamp":"2025-03-25T07:21:30.041Z"}
{"level":"debug","message":"Executing query [m8o63buoggl3hmn8clb]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1007]","timestamp":"2025-03-25T07:21:30.048Z"}
{"level":"debug","message":"Executing query [m8o63buup3e36bo4pvi]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.054Z"}
{"level":"debug","message":"Executing query [m8o63bv01us8ktzu9ko]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.060Z"}
{"level":"debug","message":"Executing query [m8o63bv46gizt1ng3fl]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.064Z"}
{"level":"debug","message":"Executing query [m8o63bv6vyhb1jzedg]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.067Z"}
{"level":"debug","message":"Executing query [m8o63bv9mjjjcarebjr]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.069Z"}
{"level":"debug","message":"Executing query [m8o63bvgm1pokgfy0lh]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1007]","timestamp":"2025-03-25T07:21:30.076Z"}
{"level":"debug","message":"Executing query [m8o63bvivs38is5t8fq]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:21:30.078Z"}
{"level":"debug","message":"Executing query [m8o63bvlj6b2173yzp]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:30.081Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:30.086Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:30.186Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:21:30.195Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:30.058Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:30.323Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:30.364Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:30.512Z"}
{"level":"debug","message":"Executing query [m8o63c82zy7g9cs8o5]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:21:30.531Z"}
{"level":"debug","message":"Executing query [m8o63c88afckw5v2aqc]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:21:30.536Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o63c88afckw5v2aqc]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:21:30.540Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:30.544Z"}
{"level":"debug","message":"Executing query [m8o63c5t5jd6s6ltkgh]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:30.449Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:30.599Z"}
{"level":"debug","message":"Executing query [m8o63ca80hgherrc9nnn]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:21:30.608Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:21:30.613Z"}
{"level":"debug","message":"Executing query [m8o63caer89wobixhu9]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:21:30.614Z"}
{"level":"debug","message":"Executing query [m8o63caq21yyhgtcu3r]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:21:30.626Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:21:30.628Z"}
{"level":"debug","message":"Executing query [m8o63casixijnb9kuph]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:21:30.628Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:21:30.417Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:30.736Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:21:30.632Z"}
{"level":"debug","message":"Executing query [m8o63cejiu3r7qyldmc]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:21:30.767Z"}
{"level":"debug","message":"Executing query [m8o63cf1abfqzyblcjs]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:21:30.781Z"}
{"level":"debug","message":"Executing query [m8o63ce3h0ff87smacv]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:30.747Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:30.784Z"}
{"level":"debug","message":"Executing query [m8o63cf67rfcho118wi]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:21:30.786Z"}
{"level":"debug","message":"Executing query [m8o63cf7jch4wv2n84]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[15]","timestamp":"2025-03-25T07:21:30.787Z"}
{"level":"debug","message":"Executing query [m8o63cfa0pn3c7sb6kds]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742887290744\"]","timestamp":"2025-03-25T07:21:30.790Z"}
{"level":"debug","message":"Executing query [m8o63cferpubrmz89ym]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742887290744\",\"TEST-OFICIO-1742887290744\",4603,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:21:30.794Z"}
{"level":"debug","message":"Executing query [m8o63cfh2h336kv8naw]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:30.797Z"}
{"level":"debug","message":"Executing query [m8o63cflqnigufpa35i]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.801Z"}
{"level":"debug","message":"Executing query [m8o63cfrm9yz1m8mdq]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742887290744\"]","timestamp":"2025-03-25T07:21:30.807Z"}
{"level":"debug","message":"Executing query [m8o63cftxhjljeuamv]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",17]","timestamp":"2025-03-25T07:21:30.809Z"}
{"level":"debug","message":"Executing query [m8o63cfx6kcl5igqiqq]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.813Z"}
{"level":"debug","message":"Executing query [m8o63cg1n9s7ahpc9a]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.817Z"}
{"level":"debug","message":"Executing query [m8o63cg814jukt6ohos]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.824Z"}
{"level":"debug","message":"Executing query [m8o63cga5ff0r83d6fo]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.826Z"}
{"level":"debug","message":"Executing query [m8o63cgi2nvqee96h3c]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[17]","timestamp":"2025-03-25T07:21:30.834Z"}
{"level":"debug","message":"Executing query [m8o63cglvmibulmzesd]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742887290837\",\"TEST-SP-OFICIO-1742887290837\",7238,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:21:30.837Z"}
{"level":"debug","message":"Executing query [m8o63cgqwtalo4a3ts8]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742887290837\"]","timestamp":"2025-03-25T07:21:30.842Z"}
{"level":"debug","message":"Executing query [m8o63cguavxmjz7khui]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742887290837\"]","timestamp":"2025-03-25T07:21:30.846Z"}
{"level":"debug","message":"Executing query [m8o63cgzq7c9xjza5em]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:30.851Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:30.853Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:21:30.909Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:21:30.916Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:21:30.917Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:21:30.918Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:21:30.918Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:21:30.918Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:31.110Z"}
{"level":"debug","message":"Executing query [m8o63cpryyoyyrqz87r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:31.167Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:31.279Z"}
{"level":"debug","message":"Executing query [m8o63cszc9byw69foz]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:21:31.283Z"}
{"level":"debug","message":"Executing query [m8o63ctb9w6wu6wdqnl]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742887291165\"]","timestamp":"2025-03-25T07:21:31.295Z"}
{"level":"debug","message":"Executing query [m8o63ctiyret049icsd]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742887291165\",\"TEST-OFI-FORENSE-1742887291165\",2616,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742887291165\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:21:31.302Z"}
{"level":"debug","message":"Executing query [m8o63ctryjcyiawrp8]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.311Z"}
{"level":"debug","message":"Executing query [m8o63ctyprdbayspye]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742887291165\"]","timestamp":"2025-03-25T07:21:31.318Z"}
{"level":"debug","message":"Executing query [m8o63cu29zmvhrxxmac]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",17]","timestamp":"2025-03-25T07:21:31.322Z"}
{"level":"debug","message":"Executing query [m8o63cunxir0rjzd6tt]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.343Z"}
{"level":"debug","message":"Executing query [m8o63curbjhs4vpwaag]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.347Z"}
{"level":"debug","message":"Executing query [m8o63cv0588ggur2hp9]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.356Z"}
{"level":"debug","message":"Executing query [m8o63cv44y1ybz5gvum]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.360Z"}
{"level":"debug","message":"Executing query [m8o63cv8k61xstz99t9]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.365Z"}
{"level":"debug","message":"Executing query [m8o63cvct3qd6t04e0h]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742887291368\",\"TEST-SP-OFI-FORENSE-1742887291368\",1881,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:21:31.368Z"}
{"level":"debug","message":"Executing query [m8o63cvpevuaz18jblo]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742887291368\"]","timestamp":"2025-03-25T07:21:31.381Z"}
{"level":"debug","message":"Executing query [m8o63cvtj5ycrglesq]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742887291368\"]","timestamp":"2025-03-25T07:21:31.385Z"}
{"level":"debug","message":"Executing query [m8o63cw22fr424wueuq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:31.394Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:31.398Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:31.692Z"}
{"level":"debug","message":"Executing query [m8o63d6k8jhvfp0qa59]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:31.772Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:31.854Z"}
{"level":"debug","message":"Executing query [m8o63d95tzs94u7n2f8]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:21:31.865Z"}
{"level":"debug","message":"Executing query [m8o63d9ce3djcud6yrt]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:21:31.872Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:21:31.876Z"}
{"level":"debug","message":"Executing query [m8o63d9gygsdqysifgi]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:21:31.876Z"}
{"level":"debug","message":"Executing query [m8o63d9ig616cnstg47]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:21:31.878Z"}
{"level":"debug","message":"Executing query [m8o63d9l3q80pxdv5s7]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:21:31.881Z"}
{"level":"debug","message":"Executing query [m8o63d9zne45ayzti1a]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.895Z"}
{"level":"debug","message":"Executing query [m8o63da3yz7829fm1ri]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.899Z"}
{"level":"debug","message":"Executing query [m8o63da7cnb0xtptvjk]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",17]","timestamp":"2025-03-25T07:21:31.903Z"}
{"level":"debug","message":"Executing query [m8o63dalv8ubww9l5gj]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.917Z"}
{"level":"debug","message":"Executing query [m8o63dapjnaagwhxc8]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.921Z"}
{"level":"debug","message":"Executing query [m8o63daw00v64rt2lmgv]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[17]","timestamp":"2025-03-25T07:21:31.929Z"}
{"level":"debug","message":"Executing query [m8o63db1wco9ite217n]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:31.933Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:31.937Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:31.971Z"}
{"level":"debug","message":"Executing query [m8o63de12ljenlt3wfs]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:32.042Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:32.111Z"}
{"level":"debug","message":"Executing query [m8o63dg6w7u5dl7ztmd]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:21:32.118Z"}
{"level":"debug","message":"Executing query [m8o63dguow3kpilhgul]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:21:32.142Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:32.135Z"}
{"level":"debug","message":"Executing query [m8o63dh086ku2vyjnpu]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:21:32.148Z"}
{"level":"debug","message":"Executing query [m8o63dh50mjvvl2y4ifl]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:21:32.153Z"}
{"level":"debug","message":"Executing query [m8o63dhdze2t3zekvc8]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:21:32.161Z"}
{"level":"debug","message":"Executing query [m8o63dhn8o7gppo9qfu]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[17,888,18,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:21:32.171Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:21:32.171Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 18, Área ID: 888, Rol ID: 888, Documento ID: 17","timestamp":"2025-03-25T07:21:32.179Z"}
{"level":"debug","message":"Executing query [m8o63dhx62nzm6j4xvf]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[17,18,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:21:32.181Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o63dhx62nzm6j4xvf]","params":"[17,18,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:21:32.188Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:21:32.188Z"}
{"level":"debug","message":"Executing query [m8o63di5b84as6953p]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[17]","timestamp":"2025-03-25T07:21:32.189Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o63di5b84as6953p]","params":"[17]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:21:32.194Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:21:32.194Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:21:32.194Z"}
{"level":"debug","message":"Executing query [m8o63dickj13uqf0bn]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[17,18,\"RESTAURAR\"]","timestamp":"2025-03-25T07:21:32.196Z"}
{"level":"debug","message":"Executing query [m8o63dgrmvwmzjtkmfr]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:32.140Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:32.194Z"}
{"level":"debug","message":"Executing query [m8o63dieqrwpgvowa9]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:21:32.199Z"}
{"level":"debug","message":"Executing query [m8o63diiwmusk84bj0b]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[17]","timestamp":"2025-03-25T07:21:32.202Z"}
{"level":"debug","message":"Executing query [m8o63dilaeq8f3msrrf]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742887292137\"]","timestamp":"2025-03-25T07:21:32.205Z"}
{"level":"debug","message":"Executing query [m8o63dio22h9rg3o6o4]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[17,18,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:21:32.208Z"}
{"level":"debug","message":"Executing query [m8o63dipm0obyinxfvo]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742887292137\",\"TEST-OFI-QUIMICA-1742887292137\",4050,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:21:32.209Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o63dio22h9rg3o6o4]","params":"[17,18,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:21:32.214Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:21:32.214Z"}
{"level":"debug","message":"Executing query [m8o63diu01chqz6r7mim]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[17]","timestamp":"2025-03-25T07:21:32.214Z"}
{"level":"debug","message":"Executing query [m8o63diw0bruz5ieo67v]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.216Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o63diu01chqz6r7mim]","params":"[17]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:21:32.223Z"}
{"level":"debug","message":"Executing query [m8o63dj5kld02tuuob]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742887292137\"]","timestamp":"2025-03-25T07:21:32.225Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:21:32.224Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:21:32.224Z"}
{"level":"debug","message":"Executing query [m8o63dj5f58hnyx5jlm]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[17,888,18,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:21:32.225Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:21:32.225Z"}
{"level":"debug","message":"Executing query [m8o63dj8vujb7ploqk]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",9]","timestamp":"2025-03-25T07:21:32.228Z"}
{"level":"debug","message":"Executing query [m8o63dj9g5c9s5m431]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:21:32.229Z"}
{"level":"debug","message":"Executing query [m8o63djdz0btu18uooq]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[18,\"DOCUMENTO\",18,\"ELIMINAR\"]","timestamp":"2025-03-25T07:21:32.233Z"}
{"level":"debug","message":"Executing query [m8o63djdjfzhs977hs9]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.233Z"}
{"level":"debug","message":"Executing query [m8o63djgay4mxssoied]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.236Z"}
{"level":"debug","message":"Executing query [m8o63djh136edlqbskw]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.237Z"}
{"level":"debug","message":"Executing query [m8o63djtxv4296lcv7]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.249Z"}
{"level":"debug","message":"Executing query [m8o63djxkn2zmfdoqxs]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.253Z"}
{"level":"debug","message":"Executing query [m8o63djzxwlhsj6bx08]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:21:32.255Z"}
{"level":"debug","message":"Executing query [m8o63dk35k3scqhgmzk]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[9]","timestamp":"2025-03-25T07:21:32.259Z"}
{"level":"debug","message":"Executing query [m8o63dkb1jeuciejvmv]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:32.267Z"}
{"level":"debug","message":"Executing query [m8o63dke287tg80kvhej]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[17]","timestamp":"2025-03-25T07:21:32.270Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:32.271Z"}
{"level":"debug","message":"Executing query [m8o63dkkv8yzffwqz7]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:21:32.276Z"}
{"level":"debug","message":"Executing query [m8o63dklrjj2k7lm8v]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:21:32.277Z"}
{"level":"debug","message":"Executing query [m8o63dknmz334gbdes]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:21:32.279Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:21:32.283Z"}
{"level":"debug","message":"Executing query [m8o63dks2wp4bwauzap]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:32.284Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:32.287Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:32.239Z"}
{"level":"debug","message":"Executing query [m8o63dmgssrpcxlxgxd]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:32.344Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:32.427Z"}
{"level":"debug","message":"Executing query [m8o63dp0xjtkw9zftj]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742887292340\"]","timestamp":"2025-03-25T07:21:32.437Z"}
{"level":"debug","message":"Executing query [m8o63dp3runwsu866vo]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742887292340\",true]","timestamp":"2025-03-25T07:21:32.440Z"}
{"level":"debug","message":"Executing query [m8o63dpccirwssj4tka]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.448Z"}
{"level":"debug","message":"Executing query [m8o63dpgq0r3phjrtqc]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742887292340\"]","timestamp":"2025-03-25T07:21:32.453Z"}
{"level":"debug","message":"Executing query [m8o63dpjlr8rs9u4qpj]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",18]","timestamp":"2025-03-25T07:21:32.455Z"}
{"level":"debug","message":"Executing query [m8o63dpw02n4hmxzu3qj]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.468Z"}
{"level":"debug","message":"Executing query [m8o63dq1a3ln2510kvs]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.474Z"}
{"level":"debug","message":"Executing query [m8o63dq6ooybl90ok88]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.478Z"}
{"level":"debug","message":"Executing query [m8o63dqaktwrv1t8j1f]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.482Z"}
{"level":"debug","message":"Executing query [m8o63dqek2y0hnztinn]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.486Z"}
{"level":"debug","message":"Executing query [m8o63dqps0uhfle3jms]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[18]","timestamp":"2025-03-25T07:21:32.497Z"}
{"level":"debug","message":"Executing query [m8o63dqsn5f5mc2xbds]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:21:32.500Z"}
{"level":"debug","message":"Executing query [m8o63dqu317sqjwj0p9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:32.502Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:32.505Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:32.771Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:32.804Z"}
{"level":"debug","message":"Executing query [m8o63dzbxibmai3f4x]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:21:32.807Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:32.867Z"}
{"level":"debug","message":"Executing query [m8o63e14u8aske6hqb]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:21:32.872Z"}
{"level":"debug","message":"Executing query [m8o63e18qotmyt5xcvi]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:21:32.877Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:21:32.879Z"}
{"level":"debug","message":"Executing query [m8o63e1b8v5ql8uq4pw]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.879Z"}
{"level":"debug","message":"Executing query [m8o63e1ditjueg8qyts]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.881Z"}
{"level":"debug","message":"Executing query [m8o63e1g9q4qeamm0qa]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.884Z"}
{"level":"debug","message":"Executing query [m8o63e1k4c5zg297g0e]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:21:32.888Z"}
{"level":"debug","message":"Executing query [m8o63e1qzma8vr819l8]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[19]","timestamp":"2025-03-25T07:21:32.894Z"}
{"level":"debug","message":"Executing query [m8o63e1uzvig9govp]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.898Z"}
{"level":"debug","message":"Executing query [m8o63e1xl1wzsblm3v]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",19]","timestamp":"2025-03-25T07:21:32.901Z"}
{"level":"debug","message":"Executing query [m8o63e22bv0un3q3a3p]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[19]","timestamp":"2025-03-25T07:21:32.906Z"}
{"level":"debug","message":"Executing query [m8o63e25o9tvscxj9im]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[19]","timestamp":"2025-03-25T07:21:32.909Z"}
{"level":"debug","message":"Executing query [m8o63e2embd6zetp6xc]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[19]","timestamp":"2025-03-25T07:21:32.918Z"}
{"level":"debug","message":"Executing query [m8o63e2geo1sxpn7lfl]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.920Z"}
{"level":"debug","message":"Executing query [m8o63e2i599htfhzql6]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:21:32.922Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:21:32.924Z"}
{"level":"debug","message":"Executing query [m8o63e2l8z8tdwbs10q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:21:32.925Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:32.928Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:32.467Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:21:33.006Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:21:33.032Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:33.342Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:21:33.385Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:33.506Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:33.863Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:21:34.156Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:34.289Z"}
{"level":"debug","message":"Executing query [m8o63f5vxvs0ngrrur]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:21:34.340Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:34.386Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:35.232Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:21:35.333Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:35.490Z"}
{"duration":"30ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:21:35.494Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:21:35.492Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:21:35.497Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:21:35.503Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:21:35.508Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T07:24:38.801Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T07:24:38.806Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.811Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.878Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.885Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.899Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.906Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:38.914Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:39.023Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:39.033Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:24:39.037Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T07:25:45.050Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=oficri_sistema","timestamp":"2025-03-25T07:25:45.055Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.060Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.122Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.130Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.145Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.161Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.168Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.272Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.286Z"}
{"level":"debug","message":"Conexión a: localhost@oficri_sistema como root","timestamp":"2025-03-25T07:25:45.290Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:26:38.309Z"}
{"level":"error","message":"Error al actualizar permiso contextual: No se proporcionaron datos para actualizar","timestamp":"2025-03-25T07:26:38.398Z"}
{"fatal":true,"level":"error","message":"Error al conectar a la base de datos: Encoding not recognized: 'cesu8' (searched as: 'cesu8')","stack":"Error: Encoding not recognized: 'cesu8' (searched as: 'cesu8')\n    at Object.getCodec (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:104:23)\n    at Object.getDecoder (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:125:23)\n    at Object.<anonymous>.exports.decode (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\parsers\\string.js:20:23)\n    at Packet.readNullTerminatedString (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\packet.js:414:25)\n    at Function.fromPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\handshake.js:62:33)\n    at ClientHandshake.handshakeInit (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\client_handshake.js:112:40)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:45:22)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:26:42.425Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:29:12.649Z"}
{"level":"error","message":"Error al actualizar permiso contextual: No se proporcionaron datos para actualizar","timestamp":"2025-03-25T07:29:12.712Z"}
{"fatal":true,"level":"error","message":"Error al conectar a la base de datos: Encoding not recognized: 'cesu8' (searched as: 'cesu8')","stack":"Error: Encoding not recognized: 'cesu8' (searched as: 'cesu8')\n    at Object.getCodec (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:104:23)\n    at Object.getDecoder (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\node_modules\\iconv-lite\\lib\\index.js:125:23)\n    at Object.<anonymous>.exports.decode (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\parsers\\string.js:20:23)\n    at Packet.readNullTerminatedString (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\packet.js:414:25)\n    at Function.fromPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packets\\handshake.js:62:33)\n    at ClientHandshake.handshakeInit (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\client_handshake.js:112:40)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:45:22)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:29:16.576Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:32:27.878Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:04.998Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:25.319Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.595Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.604Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.607Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.614Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.617Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.629Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:33:56.632Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:33:56.642Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:33:56.644Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:33:56.648Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:33:56.651Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:33:56.652Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:56.870Z"}
{"level":"debug","message":"Executing query [m8o6jc5w9yfm9p2n6t]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:56.948Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:57.037Z"}
{"level":"debug","message":"Executing query [m8o6jc8ojyoy3n2r41e]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888036944\"]","timestamp":"2025-03-25T07:33:57.048Z"}
{"level":"debug","message":"Executing query [m8o6jc9981c6x94iw3d]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888036944\"]","timestamp":"2025-03-25T07:33:57.069Z"}
{"level":"debug","message":"Executing query [m8o6jc9bt3lk00h72y8]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742888036944\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:33:57.072Z"}
{"level":"debug","message":"Executing query [m8o6jc9rna1sv63yjgc]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.087Z"}
{"level":"debug","message":"Executing query [m8o6jca29h0f3isk4y]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888036944\"]","timestamp":"2025-03-25T07:33:57.098Z"}
{"level":"debug","message":"Executing query [m8o6jca7v9dzgfmmew]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1008]","timestamp":"2025-03-25T07:33:57.104Z"}
{"level":"debug","message":"Executing query [m8o6jcagp5qgkql01i8]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.112Z"}
{"level":"debug","message":"Executing query [m8o6jcal62vw7h9et5i]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.117Z"}
{"level":"debug","message":"Executing query [m8o6jcas8claws5oo2c]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.124Z"}
{"level":"debug","message":"Executing query [m8o6jcaxume25ie58h]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.130Z"}
{"level":"debug","message":"Executing query [m8o6jcb1lupjg837fs9]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.133Z"}
{"level":"debug","message":"Executing query [m8o6jcb6k5ql6yx2nz8]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1008]","timestamp":"2025-03-25T07:33:57.138Z"}
{"level":"debug","message":"Executing query [m8o6jcb9a3vgr0oqkam]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:33:57.141Z"}
{"level":"debug","message":"Executing query [m8o6jcbcr64rdcyvw1h]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:57.144Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:57.148Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.480Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.529Z"}
{"level":"debug","message":"Executing query [m8o6jcpmujy46l18yeq]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:33:57.658Z"}
{"level":"debug","message":"Executing query [m8o6jcppjs3uao2k0qa]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:33:57.661Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:57.664Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o6jcppjs3uao2k0qa]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:33:57.668Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:57.671Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.655Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.785Z"}
{"level":"debug","message":"Executing query [m8o6jcskgfmrts9gf5n]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:57.765Z"}
{"level":"debug","message":"Executing query [m8o6jctbfzc79noc4b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:57.791Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:57.826Z"}
{"level":"debug","message":"Executing query [m8o6jcubxpbclh9ajxj]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:33:57.827Z"}
{"level":"debug","message":"Executing query [m8o6jcugd8devl4f2i]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742888037789\"]","timestamp":"2025-03-25T07:33:57.832Z"}
{"level":"debug","message":"Executing query [m8o6jcuihc8rfl040tj]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742888037789\",\"TEST-OFI-FORENSE-1742888037789\",8352,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742888037789\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:33:57.835Z"}
{"level":"debug","message":"Executing query [m8o6jcusvyk85w4l06d]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.844Z"}
{"level":"debug","message":"Executing query [m8o6jcuxcshtgya9qc]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742888037789\"]","timestamp":"2025-03-25T07:33:57.849Z"}
{"level":"debug","message":"Executing query [m8o6jcv0hqhineev61i]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",19]","timestamp":"2025-03-25T07:33:57.852Z"}
{"level":"debug","message":"Executing query [m8o6jcv5lctjy3ul2i]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.857Z"}
{"level":"debug","message":"Executing query [m8o6jcv8wa4xql2a9ee]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.860Z"}
{"level":"debug","message":"Executing query [m8o6jcvdhdbxo7mkur8]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.865Z"}
{"level":"debug","message":"Executing query [m8o6jcvhharmp1wbe6m]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.869Z"}
{"level":"debug","message":"Executing query [m8o6jcvkum8vjz1vdah]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[19]","timestamp":"2025-03-25T07:33:57.873Z"}
{"level":"debug","message":"Executing query [m8o6jcvp26hnjm9spsf]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742888037877\",\"TEST-SP-OFI-FORENSE-1742888037877\",7780,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:33:57.877Z"}
{"level":"debug","message":"Executing query [m8o6jcvs4d56vc9zfbm]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742888037877\"]","timestamp":"2025-03-25T07:33:57.881Z"}
{"level":"debug","message":"Executing query [m8o6jcvvppfnnx2rlgp]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742888037877\"]","timestamp":"2025-03-25T07:33:57.883Z"}
{"level":"debug","message":"Executing query [m8o6jcw03tmuq2y03b5]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:57.888Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:57.890Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:33:57.852Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.490Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:57.910Z"}
{"level":"debug","message":"Executing query [m8o6jcwqvib8qcli40q]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:33:57.917Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:33:57.925Z"}
{"level":"debug","message":"Executing query [m8o6jcx54hnp7jc5q5k]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:33:57.929Z"}
{"level":"debug","message":"Executing query [m8o6jcx9uk1n74vniog]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:33:57.933Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:33:57.935Z"}
{"level":"debug","message":"Executing query [m8o6jcxcr6p8suvvpxs]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:33:57.936Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:33:57.938Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:33:57.725Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:57.840Z"}
{"level":"debug","message":"Executing query [m8o6jcxr3sj36c74wo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:57.951Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:58.020Z"}
{"level":"debug","message":"Executing query [m8o6jczyqjajtprvylj]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:33:58.031Z"}
{"level":"debug","message":"Executing query [m8o6jd2i8akhjry5i99]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742888037949\"]","timestamp":"2025-03-25T07:33:58.122Z"}
{"level":"debug","message":"Executing query [m8o6jd2v1j1v6i592tg]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742888037949\",\"TEST-OFICIO-1742888037949\",6138,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:33:58.135Z"}
{"level":"debug","message":"Executing query [m8o6jd34093m536328ge]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.144Z"}
{"level":"debug","message":"Executing query [m8o6jd3ajqqlta0tqu]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742888037949\"]","timestamp":"2025-03-25T07:33:58.150Z"}
{"level":"debug","message":"Executing query [m8o6jd3djyt9ica06p]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",19]","timestamp":"2025-03-25T07:33:58.154Z"}
{"level":"debug","message":"Executing query [m8o6jd3n4n39o07ao14]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.163Z"}
{"level":"debug","message":"Executing query [m8o6jd3qo29tv1849g]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.166Z"}
{"level":"debug","message":"Executing query [m8o6jd42hsa6idl8qp]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.178Z"}
{"level":"debug","message":"Executing query [m8o6jd45ducgsfrz7d]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.181Z"}
{"level":"debug","message":"Executing query [m8o6jd4bdvvbrue0jz]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.187Z"}
{"level":"debug","message":"Executing query [m8o6jd4dtbnwo8aq5ys]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742888038189\",\"TEST-SP-OFICIO-1742888038189\",3390,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:33:58.189Z"}
{"level":"debug","message":"Executing query [m8o6jd4j527e2b3ox43]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742888038189\"]","timestamp":"2025-03-25T07:33:58.195Z"}
{"level":"debug","message":"Executing query [m8o6jd4l09z0ytja81ud]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742888038189\"]","timestamp":"2025-03-25T07:33:58.197Z"}
{"level":"debug","message":"Executing query [m8o6jd4pdjkfxyvbfs8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:58.201Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:58.204Z"}
{"level":"debug","message":"Executing query [m8o6jczi5uieqyxfj2o]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:33:58.014Z"}
{"level":"debug","message":"Executing query [m8o6jczwpb4ghiyz5uf]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:33:58.029Z"}
{"level":"debug","message":"Executing query [m8o6jd4u8rbrnf26ww6]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[17]","timestamp":"2025-03-25T07:33:58.206Z"}
{"level":"debug","message":"Executing query [m8o6jd56j4upbiz8kyd]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:58.218Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:33:58.305Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:33:58.384Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:33:58.385Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:33:58.386Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:33:58.386Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:33:58.386Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:58.828Z"}
{"level":"debug","message":"Executing query [m8o6jdn1gzfrss4e8r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:58.861Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:58.879Z"}
{"level":"debug","message":"Executing query [m8o6jdnm8h8kierd65c]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:33:58.882Z"}
{"level":"debug","message":"Executing query [m8o6jdnocqdk8uhhn96]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:33:58.884Z"}
{"level":"debug","message":"Executing query [m8o6jdnr7wb396wdekk]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:33:58.887Z"}
{"level":"debug","message":"Executing query [m8o6jdntgmp8jysrml4]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:33:58.889Z"}
{"level":"debug","message":"Executing query [m8o6jdo2bremxfl287b]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:33:58.898Z"}
{"level":"debug","message":"Executing query [m8o6jdoa6nqwur2aoj8]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[19,888,20,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:33:58.906Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:33:58.906Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 20, Área ID: 888, Rol ID: 888, Documento ID: 19","timestamp":"2025-03-25T07:33:58.914Z"}
{"level":"debug","message":"Executing query [m8o6jdolbnumjkor1d]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[19,20,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:33:58.917Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6jdolbnumjkor1d]","params":"[19,20,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:33:58.925Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:33:58.926Z"}
{"level":"debug","message":"Executing query [m8o6jdou4kj2dcngof]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.927Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6jdou4kj2dcngof]","params":"[19]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:33:58.931Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:33:58.932Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:33:58.933Z"}
{"level":"debug","message":"Executing query [m8o6jdp2xr3gn4t80v]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[19,20,\"RESTAURAR\"]","timestamp":"2025-03-25T07:33:58.934Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:58.912Z"}
{"level":"debug","message":"Executing query [m8o6jdp8g568uf0iuu]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.940Z"}
{"level":"debug","message":"Executing query [m8o6jdpcq7ros0ron3l]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[19,20,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:33:58.944Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6jdpcq7ros0ron3l]","params":"[19,20,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:33:58.949Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:33:58.949Z"}
{"level":"debug","message":"Executing query [m8o6jdph6ph6r6f0i5]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.949Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6jdph6ph6r6f0i5]","params":"[19]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:33:58.953Z"}
{"level":"debug","message":"Executing query [m8o6jdoljmkul4fx9we]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:58.918Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:33:58.953Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:33:58.954Z"}
{"level":"debug","message":"Executing query [m8o6jdpnmickjvzkrb]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[19,888,20,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:33:58.955Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:33:58.955Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:58.955Z"}
{"level":"debug","message":"Executing query [m8o6jdpye4s3a6msb1g]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:33:58.966Z"}
{"level":"debug","message":"Executing query [m8o6jdq7zkwru76xkh]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:33:58.975Z"}
{"level":"debug","message":"Executing query [m8o6jdq95tzrxt2850y]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[20,\"DOCUMENTO\",20,\"ELIMINAR\"]","timestamp":"2025-03-25T07:33:58.977Z"}
{"level":"debug","message":"Executing query [m8o6jdqbrkh0gqi7sug]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:33:58.979Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:33:58.981Z"}
{"level":"debug","message":"Executing query [m8o6jdqemlz94x8bkmm]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:33:58.982Z"}
{"level":"debug","message":"Executing query [m8o6jdqgcfcs4m72wgd]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[20]","timestamp":"2025-03-25T07:33:58.984Z"}
{"level":"debug","message":"Executing query [m8o6jdqgpvja833a50b]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:33:58.984Z"}
{"level":"debug","message":"Executing query [m8o6jdqjgc23o01gg76]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:33:58.987Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:58.908Z"}
{"level":"debug","message":"Executing query [m8o6jdqmzcse6gkuv1o]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:33:58.990Z"}
{"level":"debug","message":"Executing query [m8o6jdqqlbl69z3lbdm]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-25T07:33:58.994Z"}
{"level":"debug","message":"Executing query [m8o6jdqrzba0bydgez]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[19]","timestamp":"2025-03-25T07:33:58.995Z"}
{"level":"debug","message":"Executing query [m8o6jdqvymxf35mw7y]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-25T07:33:58.999Z"}
{"level":"debug","message":"Executing query [m8o6jdqw0uwkkuweh6g8]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:33:59.001Z"}
{"level":"debug","message":"Executing query [m8o6jdqzc4mtrvdf0iw]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:33:59.003Z"}
{"level":"debug","message":"Executing query [m8o6jdqyjfqw0vg5sgq]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",20]","timestamp":"2025-03-25T07:33:59.003Z"}
{"level":"debug","message":"Executing query [m8o6jdr0lkmad30huso]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:33:59.004Z"}
{"level":"debug","message":"Executing query [m8o6jdr3kufcp8pe3ba]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.007Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:33:59.009Z"}
{"level":"debug","message":"Executing query [m8o6jdr6y6mt8jo7so]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.010Z"}
{"level":"debug","message":"Executing query [m8o6jdr5kuzrmb367t]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:59.009Z"}
{"level":"debug","message":"Executing query [m8o6jdr98r1pl07x519]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.013Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:59.012Z"}
{"level":"debug","message":"Executing query [m8o6jdrb90wdmhsjfub]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:59.015Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:59.017Z"}
{"level":"debug","message":"Executing query [m8o6jdqcryl1im6w6yi]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:33:58.981Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:33:59.042Z"}
{"level":"debug","message":"Executing query [m8o6jdslzeekji9ya2]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742888038978\"]","timestamp":"2025-03-25T07:33:59.062Z"}
{"level":"debug","message":"Executing query [m8o6jdsrbk0fdsqpvea]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742888038978\",true]","timestamp":"2025-03-25T07:33:59.067Z"}
{"level":"debug","message":"Executing query [m8o6jdswfo5el8an02]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.072Z"}
{"level":"debug","message":"Executing query [m8o6jdt3x0imuwfrih]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742888038978\"]","timestamp":"2025-03-25T07:33:59.079Z"}
{"level":"debug","message":"Executing query [m8o6jdt5a7e3scfpinr]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",20]","timestamp":"2025-03-25T07:33:59.081Z"}
{"level":"debug","message":"Executing query [m8o6jdtcl29h0njebdg]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.089Z"}
{"level":"debug","message":"Executing query [m8o6jdth97pu04lm18]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.094Z"}
{"level":"debug","message":"Executing query [m8o6jdtm0x3g53ogi4fh]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.098Z"}
{"level":"debug","message":"Executing query [m8o6jdtrm7kl4lv27rp]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.103Z"}
{"level":"debug","message":"Executing query [m8o6jdtvnf77s0v7x4f]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.107Z"}
{"level":"debug","message":"Executing query [m8o6jdu4o85ldenyxcm]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[20]","timestamp":"2025-03-25T07:33:59.117Z"}
{"level":"debug","message":"Executing query [m8o6jdu83gba4k5leqn]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:33:59.120Z"}
{"level":"debug","message":"Executing query [m8o6jduaxex50gpf55a]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:33:59.122Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:33:59.125Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:59.216Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:59.898Z"}
{"level":"debug","message":"Executing query [m8o6jeiv5j1b4l87v9s]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:00.008Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:00.098Z"}
{"level":"debug","message":"Executing query [m8o6jelw45zg8bi2qr2]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:00.116Z"}
{"level":"debug","message":"Executing query [m8o6jem4mho4ui09uto]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742888040005\"]","timestamp":"2025-03-25T07:34:00.124Z"}
{"level":"debug","message":"Executing query [m8o6jem7v94g3i0gzim]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742888040005\",\"TEST-OFI-QUIMICA-1742888040005\",7599,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:34:00.127Z"}
{"level":"debug","message":"Executing query [m8o6jemgrk7b16oso0m]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.136Z"}
{"level":"debug","message":"Executing query [m8o6jemmfc8ewjf11xb]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742888040005\"]","timestamp":"2025-03-25T07:34:00.142Z"}
{"level":"debug","message":"Executing query [m8o6jempnsgsq70jmeh]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",10]","timestamp":"2025-03-25T07:34:00.145Z"}
{"level":"debug","message":"Executing query [m8o6jemvnp6p7lw3wg]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.151Z"}
{"level":"debug","message":"Executing query [m8o6jen05g57qoe9hi4]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.157Z"}
{"level":"debug","message":"Executing query [m8o6jen62wod4o8k5eg]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.162Z"}
{"level":"debug","message":"Executing query [m8o6jena177uf2jzub5]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.166Z"}
{"level":"debug","message":"Executing query [m8o6jenjxct01fsvwh]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[10]","timestamp":"2025-03-25T07:34:00.175Z"}
{"level":"debug","message":"Executing query [m8o6jenl9euy925k2x8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:00.177Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:00.181Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:00.322Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:00.353Z"}
{"level":"debug","message":"Executing query [m8o6jesk7qk0dzq7h]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:00.358Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:00.431Z"}
{"level":"debug","message":"Executing query [m8o6jeupi97ex8b57k]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:34:00.433Z"}
{"level":"debug","message":"Executing query [m8o6jeuysl4esnaquj]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:34:00.442Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:34:00.444Z"}
{"level":"debug","message":"Executing query [m8o6jev1s7m7uw0np5]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.445Z"}
{"level":"debug","message":"Executing query [m8o6jev3hoey5xtg7p9]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.447Z"}
{"level":"debug","message":"Executing query [m8o6jev6tn5qdm2mvzq]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.450Z"}
{"level":"debug","message":"Executing query [m8o6jevam4xuy6vajc]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:34:00.454Z"}
{"level":"debug","message":"Executing query [m8o6jevgz8vdvy2cfe]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[21]","timestamp":"2025-03-25T07:34:00.460Z"}
{"level":"debug","message":"Executing query [m8o6jevmwfhmnjff9dj]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.466Z"}
{"level":"debug","message":"Executing query [m8o6jevpdj2v2p2sol]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",21]","timestamp":"2025-03-25T07:34:00.469Z"}
{"level":"debug","message":"Executing query [m8o6jevsvn7o3myegx]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[21]","timestamp":"2025-03-25T07:34:00.472Z"}
{"level":"debug","message":"Executing query [m8o6jevwkww9jogy1eq]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[21]","timestamp":"2025-03-25T07:34:00.476Z"}
{"level":"debug","message":"Executing query [m8o6jew0x0or29j6qsi]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[21]","timestamp":"2025-03-25T07:34:00.480Z"}
{"level":"debug","message":"Executing query [m8o6jew2y4qo719pn7q]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.482Z"}
{"level":"debug","message":"Executing query [m8o6jew4b2eifapsp19]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:00.484Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:34:00.485Z"}
{"level":"debug","message":"Executing query [m8o6jew6m8u618ip3fq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:00.486Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:00.490Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:33:59.940Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:34:00.615Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:34:00.666Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:01.050Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:34:01.072Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:01.151Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:01.289Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:34:01.526Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:01.678Z"}
{"level":"debug","message":"Executing query [m8o6jfugpi2krn2zly]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:34:01.721Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:01.757Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:02.516Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:02.550Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:02.707Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:34:02.709Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:02.732Z"}
{"duration":"28ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:34:02.735Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:34:02.739Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:02.747Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.859Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.872Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.875Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.879Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.887Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.914Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:34:48.917Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:34:48.926Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:34:48.928Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:34:48.930Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:34:48.932Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:34:48.936Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:49.225Z"}
{"level":"debug","message":"Executing query [m8o6kgk6dwgxmf6h4d]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:49.302Z"}
{"level":"debug","message":"Executing query [m8o6kgnxuw5db301vrg]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888089292\"]","timestamp":"2025-03-25T07:34:49.437Z"}
{"level":"debug","message":"Executing query [m8o6kgozcezvrhvc74]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888089292\"]","timestamp":"2025-03-25T07:34:49.475Z"}
{"level":"debug","message":"Executing query [m8o6kgp27ndhgq6zkv3]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742888089292\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:34:49.478Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:49.484Z"}
{"level":"debug","message":"Executing query [m8o6kgptb210u259y9o]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.505Z"}
{"level":"debug","message":"Executing query [m8o6kgqr98u5d238a8m]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742888089292\"]","timestamp":"2025-03-25T07:34:49.539Z"}
{"level":"debug","message":"Executing query [m8o6kgqvlnok77gobkr]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1009]","timestamp":"2025-03-25T07:34:49.543Z"}
{"level":"debug","message":"Executing query [m8o6kgr808uhav3eycsm]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.556Z"}
{"level":"debug","message":"Executing query [m8o6kgred2juz2wdki]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.562Z"}
{"level":"debug","message":"Executing query [m8o6kgs0dtdk2uhbk9g]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.584Z"}
{"level":"debug","message":"Executing query [m8o6kgsb0p3546p1s9x]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.596Z"}
{"level":"debug","message":"Executing query [m8o6kgsmuoziqk30kb]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.606Z"}
{"level":"debug","message":"Executing query [m8o6kgssbqnsixzdul9]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1009]","timestamp":"2025-03-25T07:34:49.612Z"}
{"level":"debug","message":"Executing query [m8o6kgsv5wdgyivpeed]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:34:49.615Z"}
{"level":"debug","message":"Executing query [m8o6kgsye7xaipgwad6]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:49.618Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:49.623Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:49.629Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:49.350Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:49.664Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:49.751Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:34:49.679Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:49.842Z"}
{"level":"debug","message":"Executing query [m8o6kgztqynl7orekzi]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:34:49.865Z"}
{"level":"debug","message":"Executing query [m8o6kh01git82qq7iie]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:34:49.874Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o6kh01git82qq7iie]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:34:49.884Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:49.887Z"}
{"level":"debug","message":"Executing query [m8o6kgy706sbttl8t1du]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:49.808Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:49.896Z"}
{"level":"debug","message":"Executing query [m8o6kh0yu9z8slgqaog]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:49.907Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:34:49.929Z"}
{"level":"debug","message":"Executing query [m8o6kh1makn8q1e6tzb]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:34:49.930Z"}
{"level":"debug","message":"Executing query [m8o6kh1pg0fjde8zubq]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:34:49.933Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:34:49.935Z"}
{"level":"debug","message":"Executing query [m8o6kh1sj8id00za15]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:49.936Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:34:49.939Z"}
{"level":"debug","message":"Executing query [m8o6kh4kvy27apo1hd]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:34:50.036Z"}
{"level":"debug","message":"Executing query [m8o6kh51taks92y4ls]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:34:50.054Z"}
{"level":"debug","message":"Executing query [m8o6kh54cmlwlic11i]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[19]","timestamp":"2025-03-25T07:34:50.057Z"}
{"level":"debug","message":"Executing query [m8o6kh5hzxrh0t7nm3]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:50.069Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:50.169Z"}
{"level":"debug","message":"Executing query [m8o6kh8mm5nab9g950q]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:50.182Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:50.217Z"}
{"level":"debug","message":"Executing query [m8o6kh9o5p8jrgmqjbb]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:50.220Z"}
{"level":"debug","message":"Executing query [m8o6kh9qrvucmwadsf]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742888090181\"]","timestamp":"2025-03-25T07:34:50.222Z"}
{"level":"debug","message":"Executing query [m8o6kh9sdfpo71mz0n]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742888090181\",\"TEST-OFICIO-1742888090181\",4826,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:34:50.224Z"}
{"level":"debug","message":"Executing query [m8o6kha01u9ikrfhye1]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.232Z"}
{"level":"debug","message":"Executing query [m8o6kha5fniccgnkvl5]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742888090181\"]","timestamp":"2025-03-25T07:34:50.238Z"}
{"level":"debug","message":"Executing query [m8o6khabiyn47rvx0i]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",21]","timestamp":"2025-03-25T07:34:50.243Z"}
{"level":"debug","message":"Executing query [m8o6khagqxaxiyg8dpo]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.248Z"}
{"level":"debug","message":"Executing query [m8o6khaju1f9byyt19f]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.251Z"}
{"level":"debug","message":"Executing query [m8o6khaw96qohk9ff6u]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.264Z"}
{"level":"debug","message":"Executing query [m8o6khb05rw1tseko6g]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.268Z"}
{"level":"debug","message":"Executing query [m8o6khb884m3dvl91pn]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.276Z"}
{"level":"debug","message":"Executing query [m8o6khbbfgtdhkfrc]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742888090279\",\"TEST-SP-OFICIO-1742888090279\",5435,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:34:50.279Z"}
{"level":"debug","message":"Executing query [m8o6khbi68edywlkj1k]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742888090279\"]","timestamp":"2025-03-25T07:34:50.286Z"}
{"level":"debug","message":"Executing query [m8o6khbkwsfl7cjk72]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742888090279\"]","timestamp":"2025-03-25T07:34:50.288Z"}
{"level":"debug","message":"Executing query [m8o6khboffbu2kx2u7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:50.292Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:50.294Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:50.282Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:34:50.217Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:34:50.358Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:34:50.368Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:34:50.368Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:34:50.371Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:34:50.380Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:34:50.380Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Executing query [m8o6khcznxn9lpgiu2]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:50.339Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:50.418Z"}
{"level":"debug","message":"Executing query [m8o6khfasap2vczmgq8]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:50.423Z"}
{"level":"debug","message":"Executing query [m8o6khfgfx0tf1gf92a]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742888090337\"]","timestamp":"2025-03-25T07:34:50.428Z"}
{"level":"debug","message":"Executing query [m8o6khfj1yec1miu8d3]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742888090337\",\"TEST-OFI-FORENSE-1742888090337\",4455,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742888090337\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:34:50.431Z"}
{"level":"debug","message":"Executing query [m8o6khfvue2okgt2b6]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.443Z"}
{"level":"debug","message":"Executing query [m8o6khg2um0lgi8zc4o]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742888090337\"]","timestamp":"2025-03-25T07:34:50.450Z"}
{"level":"debug","message":"Executing query [m8o6khg7vjiy09q8qps]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",21]","timestamp":"2025-03-25T07:34:50.456Z"}
{"level":"debug","message":"Executing query [m8o6khghhdcl55lhi9h]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.465Z"}
{"level":"debug","message":"Executing query [m8o6khgmd3tru6lfhle]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.470Z"}
{"level":"debug","message":"Executing query [m8o6khgq43enbct4ekg]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.474Z"}
{"level":"debug","message":"Executing query [m8o6khgtq59fnxdelx]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.477Z"}
{"level":"debug","message":"Executing query [m8o6khgzfg488ztsoe4]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.483Z"}
{"level":"debug","message":"Executing query [m8o6khh3vxtarxc87cg]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742888090487\",\"TEST-SP-OFI-FORENSE-1742888090487\",7587,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:34:50.487Z"}
{"level":"debug","message":"Executing query [m8o6khh78grrik1sro]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742888090487\"]","timestamp":"2025-03-25T07:34:50.491Z"}
{"level":"debug","message":"Executing query [m8o6khha8kyzly6cgb5]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742888090487\"]","timestamp":"2025-03-25T07:34:50.494Z"}
{"level":"debug","message":"Executing query [m8o6khhepzpwigxs6l]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:50.498Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:50.501Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:50.938Z"}
{"level":"debug","message":"Executing query [m8o6khtrny7sjdo8y2b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:50.943Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:50.963Z"}
{"level":"debug","message":"Executing query [m8o6khud5p890cyvxm4]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:34:50.966Z"}
{"level":"debug","message":"Executing query [m8o6khufon1wgs4x7p]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:34:50.968Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:34:50.970Z"}
{"level":"debug","message":"Executing query [m8o6khuibpki6puwbs5]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:34:50.970Z"}
{"level":"debug","message":"Executing query [m8o6khujqd3we6qh59p]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:34:50.972Z"}
{"level":"debug","message":"Executing query [m8o6khummvhskzvikv]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:34:50.974Z"}
{"level":"debug","message":"Executing query [m8o6khv3ecjicdogso9]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-25T07:34:50.991Z"}
{"level":"debug","message":"Executing query [m8o6khvdaxh1ghxhqwd]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.001Z"}
{"level":"debug","message":"Executing query [m8o6khvjj9l65x76d6]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",21]","timestamp":"2025-03-25T07:34:51.007Z"}
{"level":"debug","message":"Executing query [m8o6khvpf857rr6eb4]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.013Z"}
{"level":"debug","message":"Executing query [m8o6khvtmnc1unbf6lc]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.017Z"}
{"level":"debug","message":"Executing query [m8o6khvz35ifaluk8rc]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.023Z"}
{"level":"debug","message":"Executing query [m8o6khw18elmmojno4y]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:51.026Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:51.036Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:51.131Z"}
{"level":"debug","message":"Executing query [m8o6ki19hobdi7zo8sc]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:51.214Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:51.153Z"}
{"level":"debug","message":"Executing query [m8o6ki4e30x003xzfj6]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742888091210\"]","timestamp":"2025-03-25T07:34:51.327Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:51.331Z"}
{"level":"debug","message":"Executing query [m8o6ki4nj99kcawht]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742888091210\",true]","timestamp":"2025-03-25T07:34:51.335Z"}
{"level":"debug","message":"Executing query [m8o6ki51zyr2ni7q83d]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.349Z"}
{"level":"debug","message":"Executing query [m8o6ki58rzkaisn0t88]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742888091210\"]","timestamp":"2025-03-25T07:34:51.356Z"}
{"level":"debug","message":"Executing query [m8o6ki5bxuc0fgmo32o]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",21]","timestamp":"2025-03-25T07:34:51.359Z"}
{"level":"debug","message":"Executing query [m8o6ki5h69godxwc67n]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.365Z"}
{"level":"debug","message":"Executing query [m8o6ki5kazxtvc3m3rm]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.368Z"}
{"level":"debug","message":"Executing query [m8o6ki5s2z5hx6e2u8y]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.377Z"}
{"level":"debug","message":"Executing query [m8o6ki5ykarh4wgr9p]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.382Z"}
{"level":"debug","message":"Executing query [m8o6ki62upmytegjdnk]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.386Z"}
{"level":"debug","message":"Executing query [m8o6ki69o7kekni9n9b]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.394Z"}
{"level":"debug","message":"Executing query [m8o6ki6c7ctocpa1nl7]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:34:51.396Z"}
{"level":"debug","message":"Executing query [m8o6ki6eqsny3x6bl4]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:51.399Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:51.404Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:51.537Z"}
{"level":"debug","message":"Executing query [m8o6kiae66bd3u9bs2m]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:51.543Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:51.596Z"}
{"level":"debug","message":"Executing query [m8o6kic0cb0qc8nmgyt]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:34:51.600Z"}
{"level":"debug","message":"Executing query [m8o6kicdqqgeef3hg5d]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742888091540\"]","timestamp":"2025-03-25T07:34:51.613Z"}
{"level":"debug","message":"Executing query [m8o6kichlnfwmbmp24o]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742888091540\",\"TEST-OFI-QUIMICA-1742888091540\",6828,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:34:51.617Z"}
{"level":"debug","message":"Executing query [m8o6kicqvjoalr2suv]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.626Z"}
{"level":"debug","message":"Executing query [m8o6kicuz9gaap8m3o]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742888091540\"]","timestamp":"2025-03-25T07:34:51.630Z"}
{"level":"debug","message":"Executing query [m8o6kicy86k5lbctc6h]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",11]","timestamp":"2025-03-25T07:34:51.634Z"}
{"level":"debug","message":"Executing query [m8o6kid3eo71t6n61p]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.640Z"}
{"level":"debug","message":"Executing query [m8o6kid7d3xhn8z4qj]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.643Z"}
{"level":"debug","message":"Executing query [m8o6kidc9dhhltktuy]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.648Z"}
{"level":"debug","message":"Executing query [m8o6kidi2m4jzwwq0vf]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.654Z"}
{"level":"debug","message":"Executing query [m8o6kidrh9ymdew1ydt]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[11]","timestamp":"2025-03-25T07:34:51.664Z"}
{"level":"debug","message":"Executing query [m8o6kidwpupn0tzfq2]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:51.668Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:51.671Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:51.540Z"}
{"level":"debug","message":"Executing query [m8o6kid9aa2rq5nb4r]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:51.645Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:51.762Z"}
{"level":"debug","message":"Executing query [m8o6kigoejq975p1jy]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:34:51.768Z"}
{"level":"debug","message":"Executing query [m8o6kihgwii5iljg35]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:34:51.796Z"}
{"level":"debug","message":"Executing query [m8o6kihpwmb908zw2t]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:34:51.805Z"}
{"level":"debug","message":"Executing query [m8o6kihsd7vna2v594n]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:34:51.808Z"}
{"level":"debug","message":"Executing query [m8o6kii18uefircw8vr]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:34:51.817Z"}
{"level":"debug","message":"Executing query [m8o6kii6jxvjxbqo7ra]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[22,888,22,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:34:51.822Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:34:51.822Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 22, Área ID: 888, Rol ID: 888, Documento ID: 21","timestamp":"2025-03-25T07:34:51.827Z"}
{"level":"debug","message":"Executing query [m8o6kiicof4i9kxe8os]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[21,22,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:34:51.828Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6kiicof4i9kxe8os]","params":"[21,22,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:34:51.838Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:34:51.839Z"}
{"level":"debug","message":"Executing query [m8o6kiin4hikcavqjhd]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.839Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6kiin4hikcavqjhd]","params":"[21]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:34:51.846Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:34:51.847Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:34:51.847Z"}
{"level":"debug","message":"Executing query [m8o6kiiwxw2vh7cltaq]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[21,22,\"RESTAURAR\"]","timestamp":"2025-03-25T07:34:51.848Z"}
{"level":"debug","message":"Executing query [m8o6kij9rpcvwfcajfc]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.861Z"}
{"level":"debug","message":"Executing query [m8o6kijgo08c71w8369]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[21,22,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:34:51.868Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6kijgo08c71w8369]","params":"[21,22,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:34:51.873Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:34:51.873Z"}
{"level":"debug","message":"Executing query [m8o6kijmfpysotzw91]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[21]","timestamp":"2025-03-25T07:34:51.874Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o6kijmfpysotzw91]","params":"[21]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:34:51.877Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:34:51.877Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:34:51.877Z"}
{"level":"debug","message":"Executing query [m8o6kijsd38abv6v6aj]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[22,888,22,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:34:51.880Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:34:51.880Z"}
{"level":"debug","message":"Executing query [m8o6kijzz7t158io9gr]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:34:51.887Z"}
{"level":"debug","message":"Executing query [m8o6kik34wy3cp9d57]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[22,\"DOCUMENTO\",22,\"ELIMINAR\"]","timestamp":"2025-03-25T07:34:51.891Z"}
{"level":"debug","message":"Executing query [m8o6kik8pyk8r1nxmxk]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[22]","timestamp":"2025-03-25T07:34:51.896Z"}
{"level":"debug","message":"Executing query [m8o6kikegrqfvpwyo0m]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:34:51.902Z"}
{"level":"debug","message":"Executing query [m8o6kikk6qto492n3z]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[22]","timestamp":"2025-03-25T07:34:51.908Z"}
{"level":"debug","message":"Executing query [m8o6kikqirvrq9eilnp]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:34:51.914Z"}
{"level":"debug","message":"Executing query [m8o6kiks6gl5op035ie]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:34:51.916Z"}
{"level":"debug","message":"Executing query [m8o6kikuh816om944x]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:34:51.918Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:34:51.924Z"}
{"level":"debug","message":"Executing query [m8o6kil0ajdu6h8pgg7]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:51.924Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:51.927Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:52.160Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:52.198Z"}
{"level":"debug","message":"Executing query [m8o6kissbuexrzrk6h5]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:34:52.204Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:52.270Z"}
{"level":"debug","message":"Executing query [m8o6kiun9yb4n24kksi]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:34:52.271Z"}
{"level":"debug","message":"Executing query [m8o6kiuqusjvyinotxc]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:34:52.274Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:34:52.276Z"}
{"level":"debug","message":"Executing query [m8o6kiuslsvv3efyipd]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.276Z"}
{"level":"debug","message":"Executing query [m8o6kiuuvoiffzpk07]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.278Z"}
{"level":"debug","message":"Executing query [m8o6kiuxoaespwcq65]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.281Z"}
{"level":"debug","message":"Executing query [m8o6kiv19ltqb76c08n]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:34:52.285Z"}
{"level":"debug","message":"Executing query [m8o6kiv8ggerv6yprld]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[23]","timestamp":"2025-03-25T07:34:52.292Z"}
{"level":"debug","message":"Executing query [m8o6kivcnbj9vzydwc]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.296Z"}
{"level":"debug","message":"Executing query [m8o6kivf0mcfffstqkf]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",23]","timestamp":"2025-03-25T07:34:52.299Z"}
{"level":"debug","message":"Executing query [m8o6kivkzm59mejb148]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[23]","timestamp":"2025-03-25T07:34:52.304Z"}
{"level":"debug","message":"Executing query [m8o6kivpu238k147mds]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[23]","timestamp":"2025-03-25T07:34:52.309Z"}
{"level":"debug","message":"Executing query [m8o6kivvsl5n4io7ay]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[23]","timestamp":"2025-03-25T07:34:52.315Z"}
{"level":"debug","message":"Executing query [m8o6kivza74gaw8swic]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.319Z"}
{"level":"debug","message":"Executing query [m8o6kiw1bngghukdytt]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:34:52.321Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:34:52.324Z"}
{"level":"debug","message":"Executing query [m8o6kiw51vrqohq674w]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:34:52.325Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:52.326Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:52.036Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:34:52.608Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:34:52.645Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:52.950Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:34:52.965Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:53.071Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:53.334Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:34:53.620Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:53.808Z"}
{"level":"debug","message":"Executing query [m8o6kk2k3wdr181r977]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:34:53.852Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:53.918Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:54.564Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:34:54.796Z"}
{"duration":"33ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:34:54.799Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:34:54.810Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:54.820Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:34:54.807Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:34:55.006Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:34:55.008Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:43:21.446Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.620Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.641Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.645Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.648Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.651Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.654Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:52:49.656Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:52:49.660Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:52:49.662Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:52:49.664Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:52:49.665Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:52:49.667Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.101Z"}
{"level":"debug","message":"Executing query [m8o77mk0u5tqays8k5d]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:50.160Z"}
{"level":"debug","message":"Executing query [m8o77mlrn74nlg2j4xo]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889170156\"]","timestamp":"2025-03-25T07:52:50.224Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:50.226Z"}
{"level":"debug","message":"Executing query [m8o77mmmrleo18ufxe]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889170156\"]","timestamp":"2025-03-25T07:52:50.254Z"}
{"level":"debug","message":"Executing query [m8o77mmpcziuu8tlfb5]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742889170156\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:52:50.257Z"}
{"level":"debug","message":"Executing query [m8o77mmza3hkw97cvdn]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.267Z"}
{"level":"debug","message":"Executing query [m8o77mn4ht3a6hmpa7]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889170156\"]","timestamp":"2025-03-25T07:52:50.272Z"}
{"level":"debug","message":"Executing query [m8o77mnae24ohu0od]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1010]","timestamp":"2025-03-25T07:52:50.278Z"}
{"level":"debug","message":"Executing query [m8o77mnj24fq56u29ff]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.287Z"}
{"level":"debug","message":"Executing query [m8o77mnnlgd9l0sp89]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.292Z"}
{"level":"debug","message":"Executing query [m8o77mnse2d2yf0a87i]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.296Z"}
{"level":"debug","message":"Executing query [m8o77mnvmbrxdmqkg6]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.300Z"}
{"level":"debug","message":"Executing query [m8o77mnyw94r31a9tf]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.302Z"}
{"level":"debug","message":"Executing query [m8o77mo3fuaufmwblcq]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1010]","timestamp":"2025-03-25T07:52:50.307Z"}
{"level":"debug","message":"Executing query [m8o77mo6c9qtnvw5f8h]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:52:50.310Z"}
{"level":"debug","message":"Executing query [m8o77mo8cughvvzyt45]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:50.312Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:50.315Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.289Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.361Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:50.477Z"}
{"level":"debug","message":"Executing query [m8o77msyujl9fgl40ne]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:52:50.482Z"}
{"level":"debug","message":"Executing query [m8o77mt2p5nu385qss8]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:52:50.486Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o77mt2p5nu385qss8]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:52:50.491Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:50.494Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.517Z"}
{"level":"debug","message":"Executing query [m8o77mvg83o5zzeqiy]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:50.573Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:50.641Z"}
{"level":"debug","message":"Executing query [m8o77mxhz6uogh2wieh]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:52:50.645Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:52:50.651Z"}
{"level":"debug","message":"Executing query [m8o77mxo9g9196fhekl]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:52:50.652Z"}
{"level":"debug","message":"Executing query [m8o77mxq77txieaydu3]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:52:50.654Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:52:50.656Z"}
{"level":"debug","message":"Executing query [m8o77mxt96ssdlibtgl]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:52:50.657Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:52:50.660Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:52:50.551Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.446Z"}
{"level":"debug","message":"Executing query [m8o77n03fnhbogiaqri]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:52:50.739Z"}
{"level":"debug","message":"Executing query [m8o77n0igwrgb9gxmi]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:52:50.755Z"}
{"level":"debug","message":"Executing query [m8o77n0lv685jraeue]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[21]","timestamp":"2025-03-25T07:52:50.757Z"}
{"level":"debug","message":"Executing query [m8o77n0r8mwnkx9stsy]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:50.763Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.842Z"}
{"level":"debug","message":"Executing query [m8o77n55yriod4vra4b]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:50.921Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:50.934Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:52:50.825Z"}
{"level":"debug","message":"Executing query [m8o77n5vp4reh4ura7]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:50.947Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:50.978Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:50.982Z"}
{"level":"debug","message":"Executing query [m8o77n6ta4ucmolula9]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:52:50.981Z"}
{"level":"debug","message":"Executing query [m8o77n6wj0d11rx9qhf]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889170944\"]","timestamp":"2025-03-25T07:52:50.984Z"}
{"level":"debug","message":"Executing query [m8o77n70gf14vgsk8zw]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742889170944\",\"TEST-OFI-FORENSE-1742889170944\",3680,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742889170944\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:52:50.988Z"}
{"level":"debug","message":"Executing query [m8o77n78h5b91ul4n5a]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:50.996Z"}
{"level":"debug","message":"Executing query [m8o77n6zen3gvm5b5pm]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:52:50.987Z"}
{"level":"debug","message":"Executing query [m8o77n76ey3jy1vg0jc]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889170919\"]","timestamp":"2025-03-25T07:52:50.994Z"}
{"level":"debug","message":"Executing query [m8o77n7d1udqmrcknau]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889170944\"]","timestamp":"2025-03-25T07:52:51.001Z"}
{"level":"debug","message":"Executing query [m8o77n7cmnew1guw4wh]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742889170919\",\"TEST-OFICIO-1742889170919\",5914,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:52:51.000Z"}
{"level":"debug","message":"Executing query [m8o77n7lfno6go2vyd]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.009Z"}
{"level":"debug","message":"Executing query [m8o77n7mnmetmw5rujb]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",23]","timestamp":"2025-03-25T07:52:51.011Z"}
{"level":"debug","message":"Executing query [m8o77n7svggw1y0dmr]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.017Z"}
{"level":"debug","message":"Executing query [m8o77n7shsx6lau73w8]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889170919\"]","timestamp":"2025-03-25T07:52:51.016Z"}
{"level":"debug","message":"Executing query [m8o77n7v6jrdvw8a4rx]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.019Z"}
{"level":"debug","message":"Executing query [m8o77n7vflvglty1q77]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",23]","timestamp":"2025-03-25T07:52:51.019Z"}
{"level":"debug","message":"Executing query [m8o77n7z031h17veihly]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.023Z"}
{"level":"debug","message":"Executing query [m8o77n80likm4eaqh1]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.024Z"}
{"level":"debug","message":"Executing query [m8o77n82fbcrzehgv7k]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.026Z"}
{"level":"debug","message":"Executing query [m8o77n8413psfx2og23]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.028Z"}
{"level":"debug","message":"Executing query [m8o77n86d3gx76tceks]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.030Z"}
{"level":"debug","message":"Executing query [m8o77n89xtq92py16wo]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.033Z"}
{"level":"debug","message":"Executing query [m8o77n8ayocf528btw]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742889171034\",\"TEST-SP-OFI-FORENSE-1742889171034\",3310,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:52:51.034Z"}
{"level":"debug","message":"Executing query [m8o77n8dzruaojl6849]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.037Z"}
{"level":"debug","message":"Executing query [m8o77n8hgz7teju4c9n]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889171034\"]","timestamp":"2025-03-25T07:52:51.041Z"}
{"level":"debug","message":"Executing query [m8o77n8ioflr2ite84q]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.042Z"}
{"level":"debug","message":"Executing query [m8o77n8j8h95qkzyh8j]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889171034\"]","timestamp":"2025-03-25T07:52:51.043Z"}
{"level":"debug","message":"Executing query [m8o77n8lsuacfd92xai]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742889171045\",\"TEST-SP-OFICIO-1742889171045\",7864,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:52:51.045Z"}
{"level":"debug","message":"Executing query [m8o77n8n9pnqpih3zh]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:51.047Z"}
{"level":"debug","message":"Executing query [m8o77n8p5ug9nqih89t]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889171045\"]","timestamp":"2025-03-25T07:52:51.049Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:51.049Z"}
{"level":"debug","message":"Executing query [m8o77n8rrmjvzosf7zi]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889171045\"]","timestamp":"2025-03-25T07:52:51.051Z"}
{"level":"debug","message":"Executing query [m8o77n8yz1wbyv3z8vr]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:51.058Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:51.061Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:52:51.199Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:52:51.201Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:52:51.202Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:52:51.203Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:52:51.207Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:52:51.207Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:51.785Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:51.724Z"}
{"level":"debug","message":"Executing query [m8o77nt9iyk0ohwqyl]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:51.789Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:51.808Z"}
{"level":"debug","message":"Executing query [m8o77ntwx867v5avzwa]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:52:51.812Z"}
{"level":"debug","message":"Executing query [m8o77ntz2po2nrtaov6]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:52:51.815Z"}
{"level":"debug","message":"Executing query [m8o77nu38600aw128ue]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:52:51.819Z"}
{"level":"debug","message":"Executing query [m8o77nu7cg2puqb71vo]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:52:51.823Z"}
{"level":"debug","message":"Executing query [m8o77nuc96o5s1zg1uw]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:52:51.828Z"}
{"level":"debug","message":"Executing query [m8o77nulog579tmidk]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[23,888,24,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:52:51.837Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:52:51.838Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 24, Área ID: 888, Rol ID: 888, Documento ID: 23","timestamp":"2025-03-25T07:52:51.843Z"}
{"level":"debug","message":"Executing query [m8o77nut5f0smku01t5]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[23,24,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:52:51.845Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o77nut5f0smku01t5]","params":"[23,24,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:52:51.855Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:52:51.855Z"}
{"level":"debug","message":"Executing query [m8o77nv379hjyv1r6h]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.855Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o77nv379hjyv1r6h]","params":"[23]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:52:51.860Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:52:51.860Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:52:51.860Z"}
{"level":"debug","message":"Executing query [m8o77nv9bnjlbdgrhgd]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[23,24,\"RESTAURAR\"]","timestamp":"2025-03-25T07:52:51.861Z"}
{"level":"debug","message":"Executing query [m8o77nvhvrpo3jcyqm]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.869Z"}
{"level":"debug","message":"Executing query [m8o77nvltewgi46gpba]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[23,24,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:52:51.873Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o77nvltewgi46gpba]","params":"[23,24,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:52:51.881Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:52:51.881Z"}
{"level":"debug","message":"Executing query [m8o77nvugc1cls0bsx]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.882Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o77nvugc1cls0bsx]","params":"[23]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:52:51.884Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:52:51.885Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:52:51.885Z"}
{"level":"debug","message":"Executing query [m8o77nvyvdqm2fb22t]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[23,888,24,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:52:51.886Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:52:51.886Z"}
{"level":"debug","message":"Executing query [m8o77nw1rz96f34sux]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:52:51.889Z"}
{"level":"debug","message":"Executing query [m8o77ntbpwpiahp41u8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:51.791Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:51.892Z"}
{"level":"debug","message":"Executing query [m8o77nw6kln4dzp7x6t]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[24,\"DOCUMENTO\",24,\"ELIMINAR\"]","timestamp":"2025-03-25T07:52:51.894Z"}
{"level":"debug","message":"Executing query [m8o77nway3b7g9lujg]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889171790\"]","timestamp":"2025-03-25T07:52:51.898Z"}
{"level":"debug","message":"Executing query [m8o77nwdk49z90up96]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742889171790\",true]","timestamp":"2025-03-25T07:52:51.901Z"}
{"level":"debug","message":"Executing query [m8o77nwbtugcuzvdsw]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.899Z"}
{"level":"debug","message":"Executing query [m8o77nwqb35c944xyv]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:52:51.914Z"}
{"level":"debug","message":"Executing query [m8o77nws646awir6x9]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.917Z"}
{"level":"debug","message":"Executing query [m8o77nwusggiccw9oed]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[23]","timestamp":"2025-03-25T07:52:51.918Z"}
{"level":"debug","message":"Executing query [m8o77nwxluq57dob4es]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:52:51.921Z"}
{"level":"debug","message":"Executing query [m8o77nwyt0dg2n2bzde]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889171790\"]","timestamp":"2025-03-25T07:52:51.922Z"}
{"level":"debug","message":"Executing query [m8o77nwzdus4iu0strq]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:52:51.923Z"}
{"level":"debug","message":"Executing query [m8o77nx1sdzob6ymst]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:52:51.925Z"}
{"level":"debug","message":"Executing query [m8o77nx1i6xeszu4hn]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",24]","timestamp":"2025-03-25T07:52:51.925Z"}
{"level":"debug","message":"Executing query [m8o77nx5titbgxamon]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.929Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:52:51.929Z"}
{"level":"debug","message":"Executing query [m8o77nx9ohao0j8pgi]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.933Z"}
{"level":"debug","message":"Executing query [m8o77nx63mnxqi1lolu]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:51.930Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:51.932Z"}
{"level":"debug","message":"Executing query [m8o77nxdemvxl1fyjnw]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.937Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:51.858Z"}
{"level":"debug","message":"Executing query [m8o77nxhcbjnggqkvof]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.941Z"}
{"level":"debug","message":"Executing query [m8o77nw3owhgskayjo]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:51.891Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:51.940Z"}
{"level":"debug","message":"Executing query [m8o77nxjeancjdbtgq]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:52:51.943Z"}
{"level":"debug","message":"Executing query [m8o77nxk01vas626p3pz]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.945Z"}
{"level":"debug","message":"Executing query [m8o77nxm7z5j4i1cp7r]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:52:51.946Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:52:51.949Z"}
{"level":"debug","message":"Executing query [m8o77nxqiecvr4tv7e]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.951Z"}
{"level":"debug","message":"Executing query [m8o77nxr66kcf7shvpr]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:52:51.951Z"}
{"level":"debug","message":"Executing query [m8o77nxtk9qiw3i4d6o]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:52:51.953Z"}
{"level":"debug","message":"Executing query [m8o77nxuryi7ekpoq9]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:52:51.954Z"}
{"level":"debug","message":"Executing query [m8o77nxvrgxh3zfneh]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:51.955Z"}
{"level":"debug","message":"Executing query [m8o77nxwi38b7humsy]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:52:51.956Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:51.960Z"}
{"level":"debug","message":"Executing query [m8o77ny194dczt1rwas]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.961Z"}
{"level":"debug","message":"Executing query [m8o77ny5m44je58jrec]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.965Z"}
{"level":"debug","message":"Executing query [m8o77nyattxa6yw6iml]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",24]","timestamp":"2025-03-25T07:52:51.970Z"}
{"level":"debug","message":"Executing query [m8o77nyh45e3u49i3i4]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.977Z"}
{"level":"debug","message":"Executing query [m8o77nykso3mupssvs9]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.980Z"}
{"level":"debug","message":"Executing query [m8o77nynpaja8gs1fkr]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[24]","timestamp":"2025-03-25T07:52:51.983Z"}
{"level":"debug","message":"Executing query [m8o77nypmt8x0eztdf]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:51.985Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:51.987Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:52.240Z"}
{"level":"debug","message":"Executing query [m8o77o5vlo8erhuipa]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:52.243Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:52.268Z"}
{"level":"debug","message":"Executing query [m8o77o6mawkyesuo4eb]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:52:52.270Z"}
{"level":"debug","message":"Executing query [m8o77o6qv2cnj9hlko]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889172242\"]","timestamp":"2025-03-25T07:52:52.274Z"}
{"level":"debug","message":"Executing query [m8o77o6tplsl1k4aljg]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742889172242\",\"TEST-OFI-QUIMICA-1742889172242\",307,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:52:52.277Z"}
{"level":"debug","message":"Executing query [m8o77o71bw6wqysn48r]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.285Z"}
{"level":"debug","message":"Executing query [m8o77o75wt6ekje4mg]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889172242\"]","timestamp":"2025-03-25T07:52:52.289Z"}
{"level":"debug","message":"Executing query [m8o77o78kdkrxbrgi57]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",12]","timestamp":"2025-03-25T07:52:52.292Z"}
{"level":"debug","message":"Executing query [m8o77o7bzo596bw6lxr]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.295Z"}
{"level":"debug","message":"Executing query [m8o77o7ffj44vk3oide]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.299Z"}
{"level":"debug","message":"Executing query [m8o77o7kpmn7hgx7xpr]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.304Z"}
{"level":"debug","message":"Executing query [m8o77o7n332t4k5d9cw]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.307Z"}
{"level":"debug","message":"Executing query [m8o77o7r0llg3jgaxuu]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[12]","timestamp":"2025-03-25T07:52:52.311Z"}
{"level":"debug","message":"Executing query [m8o77o7tg3u21e4nhlw]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:52.313Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:52.315Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:51.751Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:52:52.463Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:52:52.501Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:52.854Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:52:52.905Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:52.721Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:52.996Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:53.049Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:53.063Z"}
{"level":"debug","message":"Executing query [m8o77osqlmy26ims3qp]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:52:53.066Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:53.097Z"}
{"level":"debug","message":"Executing query [m8o77otrxfm1zh9hsf]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:52:53.103Z"}
{"level":"debug","message":"Executing query [m8o77ottzsv9a7j77o]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:52:53.105Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:52:53.106Z"}
{"level":"debug","message":"Executing query [m8o77otufn9p1kmx9n4]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.106Z"}
{"level":"debug","message":"Executing query [m8o77otwgxo85pwmiae]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.108Z"}
{"level":"debug","message":"Executing query [m8o77otye2t23rcwbbt]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.110Z"}
{"level":"debug","message":"Executing query [m8o77otzii244dy2wco]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:52:53.111Z"}
{"level":"debug","message":"Executing query [m8o77ou54wi4r5xfuca]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[25]","timestamp":"2025-03-25T07:52:53.117Z"}
{"level":"debug","message":"Executing query [m8o77ou9mok26no24w]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.121Z"}
{"level":"debug","message":"Executing query [m8o77oue7dqwzt0keba]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",25]","timestamp":"2025-03-25T07:52:53.126Z"}
{"level":"debug","message":"Executing query [m8o77oui6rwf8u5j7gt]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[25]","timestamp":"2025-03-25T07:52:53.131Z"}
{"level":"debug","message":"Executing query [m8o77oulf5n1gq841jt]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[25]","timestamp":"2025-03-25T07:52:53.133Z"}
{"level":"debug","message":"Executing query [m8o77ouowiuwtovu2z]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[25]","timestamp":"2025-03-25T07:52:53.137Z"}
{"level":"debug","message":"Executing query [m8o77ournzfqqnr3rth]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.139Z"}
{"level":"debug","message":"Executing query [m8o77ouszk3jhsuhc9g]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:52:53.140Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:52:53.141Z"}
{"level":"debug","message":"Executing query [m8o77ouuizbcl1bj6mk]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:52:53.142Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:53.143Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:53.798Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:52:53.958Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:54.056Z"}
{"level":"debug","message":"Executing query [m8o77pljffxrncb625]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:52:54.103Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:54.142Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:54.531Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:52:54.566Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:54.700Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:52:54.702Z"}
{"duration":"30ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:52:54.725Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:52:54.727Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:52:54.731Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:52:54.735Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:17.726Z"}
{"level":"debug","message":"Executing query [m8o787uinfw6voj0z1]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:17.754Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:17.789Z"}
{"level":"debug","message":"Executing query [m8o787vjewdi1s9nuc]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889197753\"]","timestamp":"2025-03-25T07:53:17.791Z"}
{"level":"debug","message":"Executing query [m8o787vma4erz4u778b]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889197753\"]","timestamp":"2025-03-25T07:53:17.794Z"}
{"level":"debug","message":"Executing query [m8o787vnnt86jesde6n]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742889197753\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:53:17.795Z"}
{"level":"debug","message":"Executing query [m8o787vrkpgjyhu6vxs]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.799Z"}
{"level":"debug","message":"Executing query [m8o787vv2jx46ylnl9q]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889197753\"]","timestamp":"2025-03-25T07:53:17.803Z"}
{"level":"debug","message":"Executing query [m8o787vxa0d1pg50gu9]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1011]","timestamp":"2025-03-25T07:53:17.805Z"}
{"level":"debug","message":"Executing query [m8o787w1xkys4kecv9k]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.809Z"}
{"level":"debug","message":"Executing query [m8o787w2dxzxjk4ku1q]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.811Z"}
{"level":"debug","message":"Executing query [m8o787w6mwni1zi17sm]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.814Z"}
{"level":"debug","message":"Executing query [m8o787w8hjtjapmdm38]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.816Z"}
{"level":"debug","message":"Executing query [m8o787wagx63yy3v8q]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.818Z"}
{"level":"debug","message":"Executing query [m8o787wcsgxxjrvtfec]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1011]","timestamp":"2025-03-25T07:53:17.820Z"}
{"level":"debug","message":"Executing query [m8o787wdgymtc7gg1gu]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:53:17.821Z"}
{"level":"debug","message":"Executing query [m8o787wfttombbu1ouq]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:17.823Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:17.824Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.916Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.918Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.920Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.922Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.926Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.928Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)","timestamp":"2025-03-25T07:53:17.929Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:53:17.932Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:53:17.933Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:53:17.935Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:53:17.937Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:53:17.939Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:18.132Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:19.202Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:53:19.377Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:53:19.382Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:19.435Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:53:19.453Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:19.501Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:19.970Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:20.219Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:20.235Z"}
{"level":"debug","message":"Executing query [m8o789rhcwv6lod38u6]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:53:20.237Z"}
{"level":"debug","message":"Executing query [m8o789rkqwhrwhnwbdi]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:53:20.240Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o789rkqwhrwhnwbdi]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:53:20.246Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:20.249Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:20.359Z"}
{"level":"debug","message":"Executing query [m8o789uz06wqvm9j84kg]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:20.363Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:20.381Z"}
{"level":"debug","message":"Executing query [m8o789vj53vg04olb6f]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:53:20.383Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:53:20.384Z"}
{"level":"debug","message":"Executing query [m8o789vloynnb3l4ca]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:53:20.385Z"}
{"level":"debug","message":"Executing query [m8o789vm9d3yxjp4v]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:53:20.386Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:53:20.388Z"}
{"level":"debug","message":"Executing query [m8o789vojt0jqfsuoaf]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:53:20.388Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:53:20.390Z"}
{"level":"debug","message":"Executing query [m8o789vvo44x24i9wm]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:53:20.395Z"}
{"level":"debug","message":"Executing query [m8o789vytg1vi1c677s]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:53:20.398Z"}
{"level":"debug","message":"Executing query [m8o789w12wkwyebcsl7]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[23]","timestamp":"2025-03-25T07:53:20.401Z"}
{"level":"debug","message":"Executing query [m8o789w54n2fsb6h2im]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:20.405Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:22.271Z"}
{"duration":"6ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:53:22.334Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:53:22.338Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:22.344Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:53:22.346Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:53:22.439Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:53:22.537Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:22.671Z"}
{"level":"debug","message":"Executing query [m8o78bn6xmzbmlkcd99]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:22.674Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:22.692Z"}
{"level":"debug","message":"Executing query [m8o78bnqmi16ic3dldj]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:53:22.695Z"}
{"level":"debug","message":"Executing query [m8o78bnts388uk5tyro]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889202673\"]","timestamp":"2025-03-25T07:53:22.697Z"}
{"level":"debug","message":"Executing query [m8o78bnuiwodjhqmu2]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742889202673\",\"TEST-OFICIO-1742889202673\",64,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:53:22.698Z"}
{"level":"debug","message":"Executing query [m8o78bo19zn83x059pv]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.705Z"}
{"level":"debug","message":"Executing query [m8o78bo5quwb8onelnk]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889202673\"]","timestamp":"2025-03-25T07:53:22.709Z"}
{"level":"debug","message":"Executing query [m8o78bo8b9wvv8v51v]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",25]","timestamp":"2025-03-25T07:53:22.712Z"}
{"level":"debug","message":"Executing query [m8o78bocsft2cuuxqas]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.716Z"}
{"level":"debug","message":"Executing query [m8o78bogmg5mpjp009]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.720Z"}
{"level":"debug","message":"Executing query [m8o78bom07o9vsy1oscj]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.726Z"}
{"level":"debug","message":"Executing query [m8o78bopgu8xjwg1mkt]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.729Z"}
{"level":"debug","message":"Executing query [m8o78bosxxaxbihxm7]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[25]","timestamp":"2025-03-25T07:53:22.732Z"}
{"level":"debug","message":"Executing query [m8o78bou6g7fzu9czmi]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742889202734\",\"TEST-SP-OFICIO-1742889202734\",17,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:53:22.734Z"}
{"level":"debug","message":"Executing query [m8o78bozjeehlpngfhl]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889202734\"]","timestamp":"2025-03-25T07:53:22.739Z"}
{"level":"debug","message":"Executing query [m8o78bp1zpto71z7jjl]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889202734\"]","timestamp":"2025-03-25T07:53:22.741Z"}
{"level":"debug","message":"Executing query [m8o78bp5s226dh5p5q]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:22.745Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:22.747Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:22.986Z"}
{"level":"debug","message":"Executing query [m8o78bvxe89f217vnn]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:22.989Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:23.003Z"}
{"level":"debug","message":"Executing query [m8o78bwcbdbdw4mnqhm]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:53:23.004Z"}
{"level":"debug","message":"Executing query [m8o78bwfozemla5e7io]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889202988\"]","timestamp":"2025-03-25T07:53:23.007Z"}
{"level":"debug","message":"Executing query [m8o78bwgr4ng0wjs0ne]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742889202988\",\"TEST-OFI-FORENSE-1742889202988\",8730,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742889202988\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:53:23.008Z"}
{"level":"debug","message":"Executing query [m8o78bwlsm0iqvy4qd]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.013Z"}
{"level":"debug","message":"Executing query [m8o78bwqtlxl2nxdhbb]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889202988\"]","timestamp":"2025-03-25T07:53:23.019Z"}
{"level":"debug","message":"Executing query [m8o78bwtyn9g59g77gb]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",25]","timestamp":"2025-03-25T07:53:23.021Z"}
{"level":"debug","message":"Executing query [m8o78bwxa0t6vvci1q]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.025Z"}
{"level":"debug","message":"Executing query [m8o78bx0cszhf2ncakt]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.028Z"}
{"level":"debug","message":"Executing query [m8o78bx4ywx697s4vd]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.032Z"}
{"level":"debug","message":"Executing query [m8o78bx7xli2f9cdgrp]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.035Z"}
{"level":"debug","message":"Executing query [m8o78bxaj18bxpelgra]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[25]","timestamp":"2025-03-25T07:53:23.038Z"}
{"level":"debug","message":"Executing query [m8o78bxdhkpfiijereg]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742889203041\",\"TEST-SP-OFI-FORENSE-1742889203041\",6383,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:53:23.041Z"}
{"level":"debug","message":"Executing query [m8o78bxkk7wx2qeo4c]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889203041\"]","timestamp":"2025-03-25T07:53:23.048Z"}
{"level":"debug","message":"Executing query [m8o78bxmuerzi1hiu8]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889203041\"]","timestamp":"2025-03-25T07:53:23.050Z"}
{"level":"debug","message":"Executing query [m8o78bxr31b2tvj0dmf]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:23.055Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:23.058Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:24.082Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:24.216Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:53:24.221Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:53:24.358Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:53:24.359Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:53:24.359Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:53:24.360Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:53:24.360Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:53:24.360Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:24.872Z"}
{"level":"debug","message":"Executing query [m8o78dcba8kjk0kjlci]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:24.875Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:24.888Z"}
{"level":"debug","message":"Executing query [m8o78dcqfxtocejgz0f]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889204874\"]","timestamp":"2025-03-25T07:53:24.890Z"}
{"level":"debug","message":"Executing query [m8o78dcrghi3lla2o0t]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742889204874\",true]","timestamp":"2025-03-25T07:53:24.891Z"}
{"level":"debug","message":"Executing query [m8o78dd2fun17menl2l]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.902Z"}
{"level":"debug","message":"Executing query [m8o78dd6eo62bopuibj]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889204874\"]","timestamp":"2025-03-25T07:53:24.906Z"}
{"level":"debug","message":"Executing query [m8o78dd8tsaod545rn]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",25]","timestamp":"2025-03-25T07:53:24.908Z"}
{"level":"debug","message":"Executing query [m8o78ddg7w5lv0fyhoe]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.916Z"}
{"level":"debug","message":"Executing query [m8o78ddlzhdt7fm17i]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.921Z"}
{"level":"debug","message":"Executing query [m8o78ddq7kwcaih6nvx]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.926Z"}
{"level":"debug","message":"Executing query [m8o78ddto625v9gimt]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.929Z"}
{"level":"debug","message":"Executing query [m8o78ddvuldm66p884]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.931Z"}
{"level":"debug","message":"Executing query [m8o78ddzvfrrh7ebwk]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[25]","timestamp":"2025-03-25T07:53:24.935Z"}
{"level":"debug","message":"Executing query [m8o78de0zuq735syi6]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:53:24.937Z"}
{"level":"debug","message":"Executing query [m8o78de2ls4jbqa6z8]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:24.938Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:24.939Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:25.195Z"}
{"level":"debug","message":"Executing query [m8o78dlamu4fcl5u0n8]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:25.198Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:25.210Z"}
{"level":"debug","message":"Executing query [m8o78dln9a4uj9hje0e]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:53:25.211Z"}
{"level":"debug","message":"Executing query [m8o78dlp4yivi8fznvj]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:53:25.213Z"}
{"level":"debug","message":"Executing query [m8o78dlq2px30q1x7x7]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:53:25.214Z"}
{"level":"debug","message":"Executing query [m8o78dlsx7e23wclvfi]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:53:25.216Z"}
{"level":"debug","message":"Executing query [m8o78dlw6olrntuseyv]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:53:25.220Z"}
{"level":"debug","message":"Executing query [m8o78dlz6d7i86gla3c]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[26,888,26,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:53:25.223Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:53:25.223Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 26, Área ID: 888, Rol ID: 888, Documento ID: 25","timestamp":"2025-03-25T07:53:25.226Z"}
{"level":"debug","message":"Executing query [m8o78dm3ojf89bt7ej]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[25,26,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:53:25.227Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o78dm3ojf89bt7ej]","params":"[25,26,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:53:25.231Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:53:25.232Z"}
{"level":"debug","message":"Executing query [m8o78dm85c2da0559jq]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[25]","timestamp":"2025-03-25T07:53:25.232Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o78dm85c2da0559jq]","params":"[25]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:53:25.234Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:53:25.235Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:53:25.235Z"}
{"level":"debug","message":"Executing query [m8o78dmc2uovtx2ka5e]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[25,26,\"RESTAURAR\"]","timestamp":"2025-03-25T07:53:25.236Z"}
{"level":"debug","message":"Executing query [m8o78dmibg28srdrao]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[25]","timestamp":"2025-03-25T07:53:25.243Z"}
{"level":"debug","message":"Executing query [m8o78dmo4yim81sqpys]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[25,26,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:53:25.248Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o78dmo4yim81sqpys]","params":"[25,26,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:53:25.251Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:53:25.251Z"}
{"level":"debug","message":"Executing query [m8o78dms1ri1bizmx73]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[25]","timestamp":"2025-03-25T07:53:25.252Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o78dms1ri1bizmx73]","params":"[25]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:53:25.254Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:53:25.255Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:53:25.255Z"}
{"level":"debug","message":"Executing query [m8o78dmwxztw2xdsez]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[26,888,26,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:53:25.256Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:53:25.256Z"}
{"level":"debug","message":"Executing query [m8o78dn0bdr8adnpaw8]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:53:25.260Z"}
{"level":"debug","message":"Executing query [m8o78dn48f6jw27txv5]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[26,\"DOCUMENTO\",26,\"ELIMINAR\"]","timestamp":"2025-03-25T07:53:25.264Z"}
{"level":"debug","message":"Executing query [m8o78dn67vv1e6yydj9]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.266Z"}
{"level":"debug","message":"Executing query [m8o78dnal7rp51ea4pg]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:53:25.271Z"}
{"level":"debug","message":"Executing query [m8o78dne9tqwnzn21oj]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.274Z"}
{"level":"debug","message":"Executing query [m8o78dnh73emidqerwu]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:53:25.277Z"}
{"level":"debug","message":"Executing query [m8o78dniszcfmrr6yl]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:53:25.278Z"}
{"level":"debug","message":"Executing query [m8o78dnj7nimhm8dsep]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:53:25.279Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:53:25.282Z"}
{"level":"debug","message":"Executing query [m8o78dnnwko6jvyda4]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:25.283Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:25.284Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:25.408Z"}
{"level":"debug","message":"Executing query [m8o78dr7dd1at3rq60f]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:25.411Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:25.433Z"}
{"level":"debug","message":"Executing query [m8o78drvnz5jkd2dp8]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:53:25.435Z"}
{"level":"debug","message":"Executing query [m8o78drx2eowaq6xbdi]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:53:25.437Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:53:25.439Z"}
{"level":"debug","message":"Executing query [m8o78ds0liwpj6ibd5r]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:53:25.440Z"}
{"level":"debug","message":"Executing query [m8o78ds433xtjqz1os6]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:53:25.444Z"}
{"level":"debug","message":"Executing query [m8o78ds76w6kq2g2g6f]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:53:25.447Z"}
{"level":"debug","message":"Executing query [m8o78dsed7c7igkv63q]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.454Z"}
{"level":"debug","message":"Executing query [m8o78dsibqyhargua9]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.458Z"}
{"level":"debug","message":"Executing query [m8o78dsmllq352mt5q]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",26]","timestamp":"2025-03-25T07:53:25.462Z"}
{"level":"debug","message":"Executing query [m8o78dspvc521uc2du]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.465Z"}
{"level":"debug","message":"Executing query [m8o78dsrzdskornmsi]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.467Z"}
{"level":"debug","message":"Executing query [m8o78dsvcjj1pkct4d]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[26]","timestamp":"2025-03-25T07:53:25.471Z"}
{"level":"debug","message":"Executing query [m8o78dsxlol6nhpn30k]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:25.473Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:25.475Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:25.730Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:26.196Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:53:26.258Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:26.303Z"}
{"level":"debug","message":"Executing query [m8o78egwo5842x2masa]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:53:26.336Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:26.383Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:26.611Z"}
{"level":"debug","message":"Executing query [m8o78eole95kpc3a6nb]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:26.613Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:26.626Z"}
{"level":"debug","message":"Executing query [m8o78ep0en4fpyqoait]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:53:26.628Z"}
{"level":"debug","message":"Executing query [m8o78ep2vtqmqwagvj]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889206613\"]","timestamp":"2025-03-25T07:53:26.630Z"}
{"level":"debug","message":"Executing query [m8o78ep3qwunu85sede]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742889206613\",\"TEST-OFI-QUIMICA-1742889206613\",13,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:53:26.631Z"}
{"level":"debug","message":"Executing query [m8o78epbkctk59lu1a]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.639Z"}
{"level":"debug","message":"Executing query [m8o78epe27l5cz03f8c]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889206613\"]","timestamp":"2025-03-25T07:53:26.642Z"}
{"level":"debug","message":"Executing query [m8o78ephhq3sb946xyo]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",13]","timestamp":"2025-03-25T07:53:26.645Z"}
{"level":"debug","message":"Executing query [m8o78epkill4qvf2ml]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.648Z"}
{"level":"debug","message":"Executing query [m8o78epmtc2giny8qpi]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.650Z"}
{"level":"debug","message":"Executing query [m8o78epp1r7z2y6p152]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.653Z"}
{"level":"debug","message":"Executing query [m8o78epqoo8012ufg3]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.654Z"}
{"level":"debug","message":"Executing query [m8o78ept1443rixvex9l]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[13]","timestamp":"2025-03-25T07:53:26.657Z"}
{"level":"debug","message":"Executing query [m8o78epvkxd8v6wwnb9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:26.659Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:26.660Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:27.241Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:53:27.245Z"}
{"level":"debug","message":"Executing query [m8o78f66cfy4qnqsmft]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:53:27.246Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:53:27.257Z"}
{"level":"debug","message":"Executing query [m8o78f6jiq7ijn92uz]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:53:27.259Z"}
{"level":"debug","message":"Executing query [m8o78f6ky7em0mal6uc]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:53:27.260Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:53:27.261Z"}
{"level":"debug","message":"Executing query [m8o78f6loqbyslfna2]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.261Z"}
{"level":"debug","message":"Executing query [m8o78f6m8fpy8kek8o9]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.262Z"}
{"level":"debug","message":"Executing query [m8o78f6otbjmz2vzls]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.264Z"}
{"level":"debug","message":"Executing query [m8o78f6p9dj9bezghts]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:53:27.265Z"}
{"level":"debug","message":"Executing query [m8o78f6v7alcrlar4j3]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[27]","timestamp":"2025-03-25T07:53:27.271Z"}
{"level":"debug","message":"Executing query [m8o78f6xj7z0vdmzhl]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.273Z"}
{"level":"debug","message":"Executing query [m8o78f6zso01skp5wj8]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",27]","timestamp":"2025-03-25T07:53:27.275Z"}
{"level":"debug","message":"Executing query [m8o78f72bu34ub0dlws]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[27]","timestamp":"2025-03-25T07:53:27.278Z"}
{"level":"debug","message":"Executing query [m8o78f73o79l7158d9e]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[27]","timestamp":"2025-03-25T07:53:27.279Z"}
{"level":"debug","message":"Executing query [m8o78f75phgwy9q6evr]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[27]","timestamp":"2025-03-25T07:53:27.282Z"}
{"level":"debug","message":"Executing query [m8o78f78lrsdl6voia]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.284Z"}
{"level":"debug","message":"Executing query [m8o78f7a9bk36hou8zo]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:53:27.286Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:53:27.287Z"}
{"level":"debug","message":"Executing query [m8o78f7bp686jiojmze]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:53:27.287Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:53:27.288Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:48.864Z"}
{"level":"debug","message":"Executing query [m8o7glomuz3o1a46m7s]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:48.934Z"}
{"error":"Error interno","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Error interno\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:66:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.882Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:49.021Z"}
{"level":"debug","message":"Executing query [m8o7glrbg5543w0umrf]: SELECT IDArea FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889588927\"]","timestamp":"2025-03-25T07:59:49.032Z"}
{"level":"debug","message":"Executing query [m8o7glrw4r1746hune]: DELETE FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889588927\"]","timestamp":"2025-03-25T07:59:49.052Z"}
{"level":"debug","message":"Executing query [m8o7glrz25wn5fa5m54]: INSERT INTO AreaEspecializada (NombreArea, CodigoIdentificacion, TipoArea, Descripcion, IsActive) VALUES (?, ?, ?, ?, ?)","params":"[\"Área de Prueba Automatizada\",\"TEST-AUTO-AREA-1742889588927\",\"ESPECIALIZADA\",\"Área creada para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:59:49.055Z"}
{"level":"debug","message":"Executing query [m8o7glscdtrq2c161c4]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.068Z"}
{"level":"debug","message":"Executing query [m8o7glsh0ny333q5n4xk]: SELECT * FROM AreaEspecializada WHERE CodigoIdentificacion = ?","params":"[\"TEST-AUTO-AREA-1742889588927\"]","timestamp":"2025-03-25T07:59:49.074Z"}
{"level":"debug","message":"Executing query [m8o7glsn4gppexyn4t6]: UPDATE AreaEspecializada SET NombreArea = ?, Descripcion = ? WHERE IDArea = ?","params":"[\"Área Actualizada\",\"Descripción actualizada para pruebas\",1012]","timestamp":"2025-03-25T07:59:49.080Z"}
{"level":"debug","message":"Executing query [m8o7glst2pgx2x308h7]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.085Z"}
{"level":"debug","message":"Executing query [m8o7glsyvnopp4jv3k]: UPDATE AreaEspecializada SET IsActive = FALSE WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.090Z"}
{"level":"debug","message":"Executing query [m8o7glt7nuozul1djmm]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.099Z"}
{"level":"debug","message":"Executing query [m8o7gltbfpo839osvys]: SELECT COUNT(*) as count FROM Usuario WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.103Z"}
{"level":"debug","message":"Executing query [m8o7glteit9cmf7196]: DELETE FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.106Z"}
{"level":"debug","message":"Executing query [m8o7glti491ri8xmu38]: SELECT * FROM AreaEspecializada WHERE IDArea = ?","params":"[1012]","timestamp":"2025-03-25T07:59:49.110Z"}
{"level":"debug","message":"Executing query [m8o7gltkh99pwjjs14h]: SELECT * FROM AreaEspecializada WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:59:49.112Z"}
{"level":"debug","message":"Executing query [m8o7gltnbibeuzd0ue]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:49.116Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:49.121Z"}
{"level":"info","message":"Usando Documento ID: 1 para las pruebas de DocumentoArchivo","timestamp":"2025-03-25T07:59:49.432Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.720Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.637Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:49.924Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.634Z"}
{"level":"debug","message":"Executing query [m8o7gmgj3k6k26ic7sd]: SELECT 1 as test","params":"[]","timestamp":"2025-03-25T07:59:49.939Z"}
{"level":"debug","message":"Executing query [m8o7gmgryesp6jin8h]: SELECT * FROM tabla_que_no_existe","params":"[]","timestamp":"2025-03-25T07:59:49.947Z"}
{"code":"ER_NO_SUCH_TABLE","error":"Table 'oficri_sistema.tabla_que_no_existe' doesn't exist","level":"error","message":"Database query error [m8o7gmgryesp6jin8h]","params":"[]","query":"SELECT * FROM tabla_que_no_existe","timestamp":"2025-03-25T07:59:49.959Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:49.962Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.889Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.936Z"}
{"level":"debug","message":"Executing query [m8o7gmi0hljbsdu7t2]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:49.992Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:49.979Z"}
{"level":"debug","message":"Executing query [m8o7gmi1iynwfbtkm6]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:49.993Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.028Z"}
{"level":"debug","message":"Executing query [m8o7gmj2vydg4dldf8g]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:59:50.030Z"}
{"level":"debug","message":"Executing query [m8o7gmj5o8ar0rinly]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889589991\"]","timestamp":"2025-03-25T07:59:50.033Z"}
{"level":"debug","message":"Executing query [m8o7gmj79y8s29fisw]: INSERT INTO ForenseDigital (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoPericia, Nombres, Apellidos, DelitoInvestigado,\n          DispositivoTipo, DispositivoMarca, DispositivoModelo, DispositivoNumeroSerie, MetodoExtraccion,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-FORENSE-1742889589991\",\"TEST-OFI-FORENSE-1742889589991\",5836,\"EXTRACCIÓN DE INFORMACIÓN\",\"Investigador\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"CELULAR\",\"TEST BRAND\",\"TEST MODEL\",\"SN-1742889589991\",\"MANUAL\",\"Perito de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:59:50.035Z"}
{"level":"debug","message":"Executing query [m8o7gmjg9niv4dtpa2c]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.044Z"}
{"level":"debug","message":"Executing query [m8o7gmjld1wyk9is9gn]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-FORENSE-1742889589991\"]","timestamp":"2025-03-25T07:59:50.049Z"}
{"level":"debug","message":"Executing query [m8o7gmjqo26a1vb0fwp]: UPDATE ForenseDigital SET TipoPericia = ?, Observaciones = ? WHERE IDForenseDigital = ?","params":"[\"ANALISIS DE METADATOS\",\"Registro forense actualizado en pruebas\",27]","timestamp":"2025-03-25T07:59:50.054Z"}
{"level":"debug","message":"Executing query [m8o7gmjwqg4z0yhjsu]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.060Z"}
{"level":"debug","message":"Executing query [m8o7gmk0cljm0qt65oe]: UPDATE ForenseDigital SET IsActive = FALSE WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.064Z"}
{"level":"debug","message":"Executing query [m8o7gmk3jwncfd0lxw8]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.068Z"}
{"level":"debug","message":"Executing query [m8o7gmk6ck2opy2x0n5]: DELETE FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.070Z"}
{"level":"debug","message":"Executing query [m8o7gmkcexm6742t1p7]: SELECT * FROM ForenseDigital WHERE IDForenseDigital = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.076Z"}
{"level":"debug","message":"Executing query [m8o7gmkgnapzezbzylm]: CALL sp_insertar_forense_digital(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-FORENSE-1742889590080\",\"TEST-SP-OFI-FORENSE-1742889590080\",9003,\"EXTRACCIÓN DE DATOS\",\"Investigador SP\",\"De Prueba SP\",\"PRUEBA SP\",\"LAPTOP\",\"Perito SP\"]","timestamp":"2025-03-25T07:59:50.080Z"}
{"level":"debug","message":"Executing query [m8o7gmkpcw5kvyg47x5]: SELECT * FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889590080\"]","timestamp":"2025-03-25T07:59:50.089Z"}
{"level":"debug","message":"Executing query [m8o7gmkr01ycusph5wu4]: DELETE FROM ForenseDigital WHERE NumeroRegistro = ?","params":"[\"TEST-SP-FORENSE-1742889590080\"]","timestamp":"2025-03-25T07:59:50.091Z"}
{"level":"debug","message":"Executing query [m8o7gmhcba9618uzn6l]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:49.968Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.068Z"}
{"level":"debug","message":"Executing query [m8o7gmkzfq1l1k1fnh]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.099Z"}
{"level":"debug","message":"Executing query [m8o7gmky4127846gk9w]: SELECT IDMesaPartes FROM MesaPartes LIMIT 1","params":"[]","timestamp":"2025-03-25T07:59:50.098Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:50.101Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.069Z"}
{"level":"debug","message":"Executing query [m8o7gmkd60alofrlyg]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:59:50.078Z"}
{"level":"debug","message":"Executing query [m8o7gmkq0n593iwpc30a]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889589991\"]","timestamp":"2025-03-25T07:59:50.094Z"}
{"level":"debug","message":"Executing query [m8o7gml02l8hqdi8fpp]: INSERT INTO Dosaje (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          TipoDosaje, Nombres, Apellidos, DocumentoIdentidad, Procedencia,\n          ResultadoCualitativo, ResultadoCuantitativo, UnidadMedida, MetodoAnalisis,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-DOSAJE-1742889589991\",\"TEST-OFICIO-1742889589991\",7682,\"ETÍLICO\",\"Persona\",\"De Prueba\",\"12345678\",\"Pruebas Automatizadas\",\"POSITIVO\",1.25,\"g/L\",\"Espectrofotometría\",\"Técnico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:59:50.100Z"}
{"level":"info","message":"No se encontraron Mesas de Partes. Se requiere al menos una Mesa de Partes para las pruebas.","timestamp":"2025-03-25T07:59:50.105Z"}
{"level":"debug","message":"Executing query [m8o7gml6lvl2lqloz8g]: SELECT IDArea FROM AreaEspecializada LIMIT 2","params":"[]","timestamp":"2025-03-25T07:59:50.106Z"}
{"level":"debug","message":"Executing query [m8o7gmm44c92iniiz7m]: SELECT IDUsuario FROM Usuario LIMIT 2","params":"[]","timestamp":"2025-03-25T07:59:50.140Z"}
{"level":"debug","message":"Executing query [m8o7gmmi4dbp69ooix2]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.154Z"}
{"level":"info","message":"No se encontraron suficientes Usuarios. Se requieren al menos dos Usuarios para las pruebas de derivación.","timestamp":"2025-03-25T07:59:50.153Z"}
{"level":"debug","message":"Executing query [m8o7gmmh45il2kosapf]: SELECT IDDocumento FROM Documento LIMIT 1","params":"[]","timestamp":"2025-03-25T07:59:50.153Z"}
{"level":"debug","message":"Executing query [m8o7gmmva7nhv2e88y]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-DOSAJE-1742889589991\"]","timestamp":"2025-03-25T07:59:50.167Z"}
{"level":"warn","message":"No se pueden ejecutar todas las pruebas de Derivación debido a la falta de datos necesarios.","timestamp":"2025-03-25T07:59:50.173Z"}
{"level":"debug","message":"Executing query [m8o7gmn49mf36pbih4]: UPDATE Dosaje SET ResultadoCualitativo = ?, Observaciones = ? WHERE IDDosaje = ?","params":"[\"NEGATIVO\",\"Registro de dosaje actualizado en pruebas\",27]","timestamp":"2025-03-25T07:59:50.176Z"}
{"level":"debug","message":"Executing query [m8o7gmn8hdnctl5dx4n]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.181Z"}
{"level":"debug","message":"Executing query [m8o7gmnclez5aei429]: UPDATE Dosaje SET IsActive = FALSE WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.184Z"}
{"level":"debug","message":"Executing query [m8o7gmngis6zai3ux2b]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.188Z"}
{"level":"debug","message":"Executing query [m8o7gmnkgfejyd0zn4r]: DELETE FROM Dosaje WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.192Z"}
{"level":"debug","message":"Executing query [m8o7gmnqcszcyp5okou]: SELECT * FROM Dosaje WHERE IDDosaje = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.198Z"}
{"level":"debug","message":"Executing query [m8o7gmnt2xh8jtwc9kc]: CALL sp_insertar_dosaje(?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-SP-DOSAJE-1742889590201\",\"TEST-SP-OFICIO-1742889590201\",5906,\"ETÍLICO-SP\",\"Persona SP\",\"De Prueba SP\",\"Prueba SP\",\"Técnico SP\"]","timestamp":"2025-03-25T07:59:50.201Z"}
{"level":"debug","message":"Executing query [m8o7gmnywpxpb1cs0e]: SELECT * FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889590201\"]","timestamp":"2025-03-25T07:59:50.206Z"}
{"level":"debug","message":"Executing query [m8o7gmo1fcd147bswg]: DELETE FROM Dosaje WHERE NumeroRegistro = ?","params":"[\"TEST-SP-DOSAJE-1742889590201\"]","timestamp":"2025-03-25T07:59:50.209Z"}
{"level":"debug","message":"Executing query [m8o7gmo8up6zyvvsb68]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.216Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:50.219Z"}
{"level":"info","message":"Test info message","timestamp":"2025-03-25T07:59:50.218Z"}
{"level":"error","message":"Test error message","timestamp":"2025-03-25T07:59:50.219Z"}
{"level":"warn","message":"Test warning message","timestamp":"2025-03-25T07:59:50.220Z"}
{"level":"debug","message":"Test debug message","timestamp":"2025-03-25T07:59:50.221Z"}
{"action":"test","level":"info","message":"Test message with object","timestamp":"2025-03-25T07:59:50.222Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"action":"test","error":{},"level":"error","message":"Test error with object","timestamp":"2025-03-25T07:59:50.222Z","user":{"id":1,"name":"Test User","roles":["admin","user"]}}
{"level":"debug","message":"Executing query [m8o7gmpu9qoqv4cazqr]: SELECT * FROM Derivacion WHERE EstadoDerivacion = ? LIMIT 10","params":"[\"PENDIENTE\"]","timestamp":"2025-03-25T07:59:50.274Z"}
{"level":"debug","message":"Executing query [m8o7gmqijpaay7bp2fl]: SELECT * FROM Derivacion WHERE IDAreaDestino = ? LIMIT 10","params":"[888]","timestamp":"2025-03-25T07:59:50.298Z"}
{"level":"debug","message":"Executing query [m8o7gmqlclo2nizj4m]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[25]","timestamp":"2025-03-25T07:59:50.301Z"}
{"level":"debug","message":"Executing query [m8o7gmqs2ou13m7kbz5]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.308Z"}
{"level":"info","message":"Usando Mesa de Partes ID: 1, Área ID: 1 y Usuario ID: 1 para las pruebas de Documento","timestamp":"2025-03-25T07:59:49.897Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:50.644Z"}
{"level":"debug","message":"Executing query [m8o7gn094xehm6q1q5g]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:50.650Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.673Z"}
{"level":"debug","message":"Executing query [m8o7gn10u3b7x5o45sc]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:59:50.676Z"}
{"level":"debug","message":"Executing query [m8o7gn12bt3fi3n9via]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:59:50.678Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de PermisoContextual","timestamp":"2025-03-25T07:59:50.680Z"}
{"level":"debug","message":"Executing query [m8o7gn15opzs5u1w4lo]: DELETE FROM PermisoContextualLog WHERE IDPermisoContextual IN (SELECT IDPermisoContextual FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?)","params":"[999,999]","timestamp":"2025-03-25T07:59:50.681Z"}
{"level":"debug","message":"Executing query [m8o7gn17y5im8cei67c]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ?","params":"[999,999]","timestamp":"2025-03-25T07:59:50.683Z"}
{"level":"debug","message":"Executing query [m8o7gn1ads6zy84x2p7]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[999,999,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:59:50.686Z"}
{"level":"debug","message":"Executing query [m8o7gn1mu4h329983n]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.698Z"}
{"level":"debug","message":"Executing query [m8o7gn1qysjtjhm5g]: SELECT * FROM v_permisos_contextuales WHERE IDPermisoContextual = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.702Z"}
{"level":"debug","message":"Executing query [m8o7gn1vnhkwppwa5w]: UPDATE PermisoContextual SET ReglaContexto = ? WHERE IDPermisoContextual = ?","params":"[\"{\\\"condicion\\\":\\\"MISMA_AREA\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",27]","timestamp":"2025-03-25T07:59:50.707Z"}
{"level":"debug","message":"Executing query [m8o7gn1z5qhfineuhd2]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.712Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:50.698Z"}
{"level":"debug","message":"Executing query [m8o7gn22esaq977ew16]: DELETE FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.714Z"}
{"level":"debug","message":"Executing query [m8o7gn29yjozhexhf9m]: SELECT * FROM PermisoContextual WHERE IDPermisoContextual = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.721Z"}
{"level":"debug","message":"Executing query [m8o7gn2babx6tdjjsd]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.723Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:50.725Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:50.712Z"}
{"level":"debug","message":"Executing query [m8o7gn1wmfcsjtks82]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:50.708Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.737Z"}
{"level":"debug","message":"Executing query [m8o7gn2rdew74akes2d]: SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:59:50.739Z"}
{"level":"debug","message":"Executing query [m8o7gn2tozc9havv2eq]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = ?","params":"[888]","timestamp":"2025-03-25T07:59:50.741Z"}
{"level":"debug","message":"Executing query [m8o7gn2wvpnueu80wm]: SELECT IDRol FROM Rol WHERE IDRol = ?","params":"[888]","timestamp":"2025-03-25T07:59:50.744Z"}
{"level":"debug","message":"Executing query [m8o7gn2yt9wbeu8mxsq]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TESTPAP123\",\"Usuario\",\"Papelera\",\"Teniente\",\"$2a$10$abcdefghijklmnopqrstuvwxyz12345678901234\",888,888]","timestamp":"2025-03-25T07:59:50.746Z"}
{"level":"debug","message":"Executing query [m8o7gn29md1khvi22o]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:50.721Z"}
{"level":"debug","message":"Executing query [m8o7gn32bw7utfvxw8j]: INSERT INTO MesaPartes (Descripcion, IsActive, CodigoIdentificacion) VALUES (?, ?, ?)","params":"[\"Mesa Papelera\",1,\"MP-TEST\"]","timestamp":"2025-03-25T07:59:50.751Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:50.751Z"}
{"level":"debug","message":"Executing query [m8o7gn38fk5omg4hhgp]: DELETE FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889590718\"]","timestamp":"2025-03-25T07:59:50.756Z"}
{"level":"debug","message":"Executing query [m8o7gn38vtti5o05ej]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[27,888,28,\"DOC-TEST-001\",\"OFICIO-TEST-001\",\"2025-03-25T07:59:50.756Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:59:50.756Z"}
{"level":"debug","message":"Executing query [m8o7gn3azbne7qlj5p9]: INSERT INTO MesaPartes (Descripcion, CodigoIdentificacion, IsActive) VALUES (?, ?, ?)","params":"[\"Mesa de Partes de Prueba Automatizada\",\"TEST-MP-1742889590718\",true]","timestamp":"2025-03-25T07:59:50.759Z"}
{"level":"info","message":"Preparación completa - Usuario ID: 28, Área ID: 888, Rol ID: 888, Documento ID: 27","timestamp":"2025-03-25T07:59:50.762Z"}
{"level":"debug","message":"Executing query [m8o7gn3gxx1ba2ra3c]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[27,28,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:59:50.764Z"}
{"level":"debug","message":"Executing query [m8o7gn3k99wfu6wgo79]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.768Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o7gn3gxx1ba2ra3c]","params":"[27,28,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:59:50.770Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:59:50.770Z"}
{"level":"debug","message":"Executing query [m8o7gn3n794wqi3hs2q]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.771Z"}
{"level":"debug","message":"Executing query [m8o7gn3sk5cnb3pv398]: SELECT * FROM MesaPartes WHERE CodigoIdentificacion = ?","params":"[\"TEST-MP-1742889590718\"]","timestamp":"2025-03-25T07:59:50.776Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o7gn3n794wqi3hs2q]","params":"[27]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:59:50.774Z"}
{"level":"error","message":"Error al mover documento a papelera: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:59:50.775Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:59:50.775Z"}
{"level":"debug","message":"Executing query [m8o7gn3svdpmye6vkii]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[27,28,\"RESTAURAR\"]","timestamp":"2025-03-25T07:59:50.776Z"}
{"level":"debug","message":"Executing query [m8o7gn3vn4d2z0mab2r]: UPDATE MesaPartes SET Descripcion = ? WHERE IDMesaPartes = ?","params":"[\"Mesa de Partes Actualizada\",28]","timestamp":"2025-03-25T07:59:50.779Z"}
{"level":"debug","message":"Executing query [m8o7gn3zpuej9op7wp]: SELECT Estado FROM Documento WHERE IDDocumento = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.783Z"}
{"level":"debug","message":"Executing query [m8o7gn431pzl1gwa4x]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.787Z"}
{"level":"debug","message":"Executing query [m8o7gn48gd1pulviqzb]: CALL sp_papelera_reciclaje(?, ?, ?)","params":"[27,28,\"MOVER_PAPELERA\"]","timestamp":"2025-03-25T07:59:50.792Z"}
{"level":"debug","message":"Executing query [m8o7gn477jk4o36ix6m]: UPDATE MesaPartes SET IsActive = FALSE WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.791Z"}
{"level":"debug","message":"Executing query [m8o7gn4dxn1dryx4yts]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.797Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o7gn48gd1pulviqzb]","params":"[27,28,\"MOVER_PAPELERA\"]","query":"CALL sp_papelera_reciclaje(?, ?, ?)","timestamp":"2025-03-25T07:59:50.800Z"}
{"level":"warn","message":"Error al llamar al procedimiento sp_papelera_reciclaje: Column 'IDUsuario' cannot be null. Realizando actualización manual...","timestamp":"2025-03-25T07:59:50.800Z"}
{"level":"debug","message":"Executing query [m8o7gn4gqc0wuljpae]: UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.800Z"}
{"level":"debug","message":"Executing query [m8o7gn4gshufpx8mpad]: SELECT COUNT(*) as count FROM Documento WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.800Z"}
{"level":"debug","message":"Executing query [m8o7gn4igqq0vqpdhvo]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.802Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Column 'IDUsuario' cannot be null","level":"error","message":"Database query error [m8o7gn4gqc0wuljpae]","params":"[27]","query":"UPDATE Documento SET \n            Estado = 'PAPELERA', \n            Observaciones = CONCAT(IFNULL(Observaciones, ''), ' | Movido a papelera por test en ', NOW()) \n          WHERE IDDocumento = ?","timestamp":"2025-03-25T07:59:50.803Z"}
{"level":"error","message":"Error al eliminar permanentemente documento: Column 'IDUsuario' cannot be null","timestamp":"2025-03-25T07:59:50.804Z"}
{"level":"info","message":"Continuando con la prueba a pesar del error...","timestamp":"2025-03-25T07:59:50.804Z"}
{"level":"debug","message":"Executing query [m8o7gn4lwg44aqxmltp]: INSERT INTO Documento (IDMesaPartes, IDAreaActual, IDUsuarioCreador, NroRegistro, NumeroOficioDocumento, FechaDocumento, Estado) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[27,888,28,\"DOC-TEST-002\",\"OFICIO-TEST-002\",\"2025-03-25T07:59:50.805Z\",\"ACTIVO\"]","timestamp":"2025-03-25T07:59:50.805Z"}
{"level":"debug","message":"Executing query [m8o7gn4mnft7uegb0bl]: SELECT * FROM MesaPartes WHERE IDMesaPartes = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.806Z"}
{"level":"debug","message":"Executing query [m8o7gn4ouxvzm2rd1mb]: SELECT * FROM MesaPartes WHERE IsActive = TRUE","params":"[]","timestamp":"2025-03-25T07:59:50.808Z"}
{"level":"debug","message":"Executing query [m8o7gn4r4c6a5vhvd9w]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.811Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:50.813Z"}
{"level":"debug","message":"Executing query [m8o7gn4y4vmfm27i28v]: INSERT INTO PermisoContextual (IDRol, IDArea, TipoRecurso, ReglaContexto, Activo) VALUES (?, ?, ?, ?, ?)","params":"[888,888,\"DOCUMENTO\",\"{\\\"condicion\\\":\\\"PROPIETARIO\\\",\\\"accion\\\":\\\"ELIMINAR\\\"}\",true]","timestamp":"2025-03-25T07:59:50.818Z"}
{"level":"debug","message":"Executing query [m8o7gn5dhmwb6xl01jg]: SELECT fn_verificar_permiso_contextual(?, ?, ?, ?) AS tienePermiso","params":"[28,\"DOCUMENTO\",28,\"ELIMINAR\"]","timestamp":"2025-03-25T07:59:50.833Z"}
{"level":"debug","message":"Executing query [m8o7gn5hsauksr5bhs]: DELETE FROM Documento WHERE IDDocumento = ?","params":"[28]","timestamp":"2025-03-25T07:59:50.837Z"}
{"level":"debug","message":"Executing query [m8o7gn5nsrmhhv3hyfc]: DELETE FROM PermisoContextual WHERE IDRol = ? AND IDArea = ? AND TipoRecurso = ?","params":"[888,888,\"DOCUMENTO\"]","timestamp":"2025-03-25T07:59:50.844Z"}
{"level":"debug","message":"Executing query [m8o7gn5taqkyxp6izjq]: DELETE FROM MesaPartes WHERE IDMesaPartes = ?","params":"[27]","timestamp":"2025-03-25T07:59:50.849Z"}
{"level":"debug","message":"Executing query [m8o7gn5ycg44zorxesm]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:59:50.854Z"}
{"level":"debug","message":"Executing query [m8o7gn605e5nueph2cq]: DELETE FROM PermisoContextualLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:59:50.856Z"}
{"level":"debug","message":"Executing query [m8o7gn6222kshzwiyww]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TESTPAP123\"]","timestamp":"2025-03-25T07:59:50.858Z"}
{"level":"info","message":"Usuario TESTPAP123 eliminado después de las pruebas","timestamp":"2025-03-25T07:59:50.863Z"}
{"level":"debug","message":"Executing query [m8o7gn67l7qsj9pilpa]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:50.863Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:50.868Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:51.175Z"}
{"level":"debug","message":"Configuración DB: host=localhost, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:51.208Z"}
{"level":"debug","message":"Executing query [m8o7gnfy87jckkrzoic]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:51.215Z"}
{"level":"debug","message":"Executing query [m8o7gngn66igvnfhbuk]: SELECT IDArea FROM AreaEspecializada WHERE IDArea = 999","params":"[]","timestamp":"2025-03-25T07:59:51.240Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:51.246Z"}
{"level":"debug","message":"Executing query [m8o7gnh8ivvqpyhp9ts]: SELECT IDRol FROM Rol WHERE IDRol = 999","params":"[]","timestamp":"2025-03-25T07:59:51.260Z"}
{"level":"info","message":"Usando Área ID: 999 y Rol ID: 999 para las pruebas de Usuario","timestamp":"2025-03-25T07:59:51.263Z"}
{"level":"debug","message":"Executing query [m8o7gnhc21j2lw49vei]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.264Z"}
{"level":"debug","message":"Executing query [m8o7gnhht2yemb0lfbj]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.269Z"}
{"level":"debug","message":"Executing query [m8o7gnhk33c845b8bd]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.272Z"}
{"level":"debug","message":"Executing query [m8o7gnhmw87ukljbe4d]: INSERT INTO Usuario (CodigoCIP, Nombres, Apellidos, Grado, PasswordHash, IDArea, IDRol) VALUES (?, ?, ?, ?, ?, ?, ?)","params":"[\"TEST123456\",\"Usuario\",\"De Prueba\",\"Suboficial\",\"$2a$10$mBpQoMfPGGjYV2NzvL.YHeTw0znNqptBsYKrn.zxr5Hd2zQvmCv9q\",999,999]","timestamp":"2025-03-25T07:59:51.274Z"}
{"level":"debug","message":"Executing query [m8o7gni77s3hdq2gtek]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[29]","timestamp":"2025-03-25T07:59:51.295Z"}
{"level":"debug","message":"Executing query [m8o7gnibkwphwru391p]: SELECT * FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.299Z"}
{"level":"debug","message":"Executing query [m8o7gnifr8z6sryrmor]: UPDATE Usuario SET Nombres = ? WHERE IDUsuario = ?","params":"[\"NombreActualizado\",29]","timestamp":"2025-03-25T07:59:51.303Z"}
{"level":"debug","message":"Executing query [m8o7gnil2ch9jgriqzw]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[29]","timestamp":"2025-03-25T07:59:51.309Z"}
{"level":"debug","message":"Executing query [m8o7gnio3dcvjp19dfq]: DELETE FROM Usuario WHERE IDUsuario = ?","params":"[29]","timestamp":"2025-03-25T07:59:51.312Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:51.123Z"}
{"level":"debug","message":"Executing query [m8o7gniy15fqs5qtrpk]: SELECT * FROM Usuario WHERE IDUsuario = ?","params":"[29]","timestamp":"2025-03-25T07:59:51.322Z"}
{"level":"debug","message":"Executing query [m8o7gnj1vjbmbzv88us]: DELETE FROM UsuarioLog WHERE IDUsuario IN (SELECT IDUsuario FROM Usuario WHERE CodigoCIP = ?)","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.325Z"}
{"level":"debug","message":"Executing query [m8o7gnj3dgue1xyow4]: DELETE FROM Usuario WHERE CodigoCIP = ?","params":"[\"TEST123456\"]","timestamp":"2025-03-25T07:59:51.327Z"}
{"level":"info","message":"Usuario TEST123456 eliminado por CIP","timestamp":"2025-03-25T07:59:51.328Z"}
{"level":"debug","message":"Executing query [m8o7gnj4sn5gcr0wjz9]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:51.328Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:51.331Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:51.350Z"}
{"level":"debug","message":"Executing query [m8o7gnl6sd59ffl3yj]: SET FOREIGN_KEY_CHECKS = 0","params":"[]","timestamp":"2025-03-25T07:59:51.403Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:51.484Z"}
{"level":"debug","message":"Executing query [m8o7gnnwoxfiz82awks]: SELECT IDArea FROM AreaEspecializada LIMIT 1","params":"[]","timestamp":"2025-03-25T07:59:51.500Z"}
{"level":"debug","message":"Executing query [m8o7gno26xjz1ehqts3]: DELETE FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889591401\"]","timestamp":"2025-03-25T07:59:51.506Z"}
{"level":"debug","message":"Executing query [m8o7gno59hhvbsoylch]: INSERT INTO QuimicaToxicologiaForense (\n          IDArea, NumeroRegistro, FechaIngreso, OficioDoc, NumeroOficio,\n          Examen, Nombres, Apellidos, DelitoInfraccion, Como,\n          Responsable, Observaciones, IsActive\n        ) VALUES (?, ?, CURDATE(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","params":"[1,\"TEST-QUIMICA-1742889591401\",\"TEST-OFI-QUIMICA-1742889591401\",6080,\"TOXICOLOGÍA\",\"Sujeto\",\"De Prueba\",\"PRUEBA AUTOMATIZADA\",\"SUSTANCIA INCAUTADA\",\"Químico de prueba\",\"Registro creado para pruebas automatizadas\",true]","timestamp":"2025-03-25T07:59:51.509Z"}
{"level":"debug","message":"Executing query [m8o7gnof63reatrf5w8]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.519Z"}
{"level":"debug","message":"Executing query [m8o7gnoqfyqax4gq4ts]: SELECT * FROM QuimicaToxicologiaForense WHERE NumeroRegistro = ?","params":"[\"TEST-QUIMICA-1742889591401\"]","timestamp":"2025-03-25T07:59:51.530Z"}
{"level":"debug","message":"Executing query [m8o7gnouwjzco0w70f]: UPDATE QuimicaToxicologiaForense SET Examen = ?, Observaciones = ? WHERE IDQuimicaToxForense = ?","params":"[\"ANÁLISIS QUÍMICO\",\"Registro químico actualizado en pruebas\",14]","timestamp":"2025-03-25T07:59:51.534Z"}
{"level":"debug","message":"Executing query [m8o7gnp6os2y7lx45ur]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.546Z"}
{"level":"debug","message":"Executing query [m8o7gnpb6xw6cv08v8d]: UPDATE QuimicaToxicologiaForense SET IsActive = FALSE WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.551Z"}
{"level":"debug","message":"Executing query [m8o7gnpf760mowmlsuh]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.555Z"}
{"level":"debug","message":"Executing query [m8o7gnpjkankc11xqyk]: DELETE FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.559Z"}
{"level":"debug","message":"Executing query [m8o7gnpoczefeu70p2w]: SELECT * FROM QuimicaToxicologiaForense WHERE IDQuimicaToxForense = ?","params":"[14]","timestamp":"2025-03-25T07:59:51.564Z"}
{"level":"debug","message":"Executing query [m8o7gnpqbdd8b1gavq4]: SET FOREIGN_KEY_CHECKS = 1","params":"[]","timestamp":"2025-03-25T07:59:51.566Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:51.568Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:51.972Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:59:52.345Z"}
{"level":"info","message":"Iniciando pruebas de autenticación","timestamp":"2025-03-25T07:59:52.365Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:52.598Z"}
{"authTokenExists":true,"level":"info","message":"Estado de tokens después del login:","refreshTokenExists":true,"timestamp":"2025-03-25T07:59:52.696Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:52.782Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:52.938Z"}
{"level":"info","message":"📚 Documentación Swagger disponible en /api-docs","timestamp":"2025-03-25T07:59:53.108Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:53.218Z"}
{"level":"debug","message":"Executing query [m8o7gp0vyh5wgnah8pp]: SELECT * FROM v_permisos_contextuales","params":"[]","timestamp":"2025-03-25T07:59:53.263Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:53.312Z"}
{"error":"Detalles del error","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"Error: Detalles del error\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:91:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.896Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ValidationError: Error de validación\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:110:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.908Z"}
{"error":"No autorizado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"UnauthorizedError: No autorizado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:133:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.911Z"}
{"error":"Acceso denegado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ForbiddenError: Acceso denegado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:156:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.914Z"}
{"error":"Recurso no encontrado","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"NotFoundError: Recurso no encontrado\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:179:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.920Z"}
{"error":"Conflicto de recursos","ip":"127.0.0.1","level":"error","message":"Error asíncrono no manejado:","method":"GET","path":"/test","stack":"ConflictError: Conflicto de recursos\n    at Object.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\server\\tests\\middleware\\async-handler.test.js:202:21)\n    at Promise.then.completed (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2025-03-25T07:59:48.923Z"}
{"code":"ER_DUP_ENTRY","error":"Duplicidad","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:59:48.929Z"}
{"code":"ER_NO_REFERENCED_ROW","error":"Referencia inexistente","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:59:48.931Z"}
{"code":"ER_BAD_NULL_ERROR","error":"Campo nulo","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:59:48.933Z"}
{"code":"UNKNOWN_ERROR","error":"Error desconocido","ip":"127.0.0.1","level":"error","message":"Error de base de datos:","method":"GET","path":"/test","timestamp":"2025-03-25T07:59:48.936Z"}
{"error":"Error de validación","ip":"127.0.0.1","level":"warn","message":"Error de validación Joi:","method":"GET","path":"/test","timestamp":"2025-03-25T07:59:48.938Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:53.912Z"}
{"duration":"3ms","level":"info","message":"Request completed","method":"POST","path":"/api/auth/login","status":404,"timestamp":"2025-03-25T07:59:54.124Z"}
{"level":"debug","message":"Configuración de base de datos: host=localhost, port=3306, user=root, database=Oficri_sistema","timestamp":"2025-03-25T07:59:54.008Z"}
{"level":"info","message":"Conexión a la base de datos establecida","timestamp":"2025-03-25T07:59:54.126Z"}
{"level":"error","message":"Failed to obtain auth token for document API tests","timestamp":"2025-03-25T07:59:54.136Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:54.143Z"}
{"level":"info","message":"Database connection pool closed successfully","timestamp":"2025-03-25T07:59:54.173Z"}
{"level":"error","message":"Error al conectar a la base de datos: Pool is closed.","stack":"Error: Pool is closed.\n    at D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\pool.js:55:21\n    at PoolConnection.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:818:13)\n    at Object.onceWrapper (node:events:628:26)\n    at PoolConnection.emit (node:events:513:28)\n    at ClientHandshake.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:137:14)\n    at ClientHandshake.emit (node:events:513:28)\n    at ClientHandshake.execute (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\commands\\command.js:49:10)\n    at PoolConnection.handlePacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:475:34)\n    at PacketParser.onPacket (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:93:12)\n    at PacketParser.executeStart (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\packet_parser.js:75:16)\n    at Socket.<anonymous> (D:\\proye\\OFICRI\\pagina\\Final\\refactored\\OFICRI\\node_modules\\mysql2\\lib\\base\\connection.js:100:25)\n    at Socket.emit (node:events:513:28)\n    at addChunk (node:internal/streams/readable:559:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\n    at Socket.Readable.push (node:internal/streams/readable:390:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)","timestamp":"2025-03-25T07:59:54.176Z"}
